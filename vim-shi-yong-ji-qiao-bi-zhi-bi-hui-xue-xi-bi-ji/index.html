<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="《Vim实用技巧必知必会》学习笔记, kiba, zen, amor, kibazen, kibaamor, 木叶, 木叶禅">
    <meta name="description" content="一个普通游戏程序员的博客">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>《Vim实用技巧必知必会》学习笔记 | 木叶禅</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/css/my.css">

    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="木叶禅" type="application/atom+xml">
</head>



   <style>
    body{
       background-image: url(/medias/background.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">木叶禅</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/leetcode/" class="waves-effect waves-light">
      
      <i class="fas fa-code" style="zoom: 0.6;"></i>
      
      <span>LeetCode</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/learn/" class="waves-effect waves-light">
      
      <i class="fas fa-book" style="zoom: 0.6;"></i>
      
      <span>学习</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tool/" class="waves-effect waves-light">
      
      <i class="fas fa-toolbox" style="zoom: 0.6;"></i>
      
      <span>工具</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories/" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags/" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about/" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">木叶禅</div>
        <div class="logo-desc">
            
            一个普通游戏程序员的博客
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/leetcode/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-code"></i>
			
			LeetCode
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/learn/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-book"></i>
			
			学习
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tool/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-toolbox"></i>
			
			工具
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = 'f65e070788a2647953051a7a1b70ada7fd2b3f70cd4d93c977207f5b762987d4';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/featureimages/3.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">《Vim实用技巧必知必会》学习笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/">
                                <span class="chip bg-color">极客时间</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                学习笔记
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-23
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-01-24
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    16.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    59 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><a target="_blank" rel="noopener" href="http://service.qbjavawa.top/time/VIMPracticalSkills.html">http://service.qbjavawa.top/time/VIMPracticalSkills.html</a></p>
<h2 id="01｜各平台下的-Vim-安装方法：上路前准备好你的宝马"><a href="#01｜各平台下的-Vim-安装方法：上路前准备好你的宝马" class="headerlink" title="01｜各平台下的 Vim 安装方法：上路前准备好你的宝马"></a>01｜各平台下的 Vim 安装方法：上路前准备好你的宝马</h2><h2 id="02｜基本概念和基础命令：应对简单的编辑任务"><a href="#02｜基本概念和基础命令：应对简单的编辑任务" class="headerlink" title="02｜基本概念和基础命令：应对简单的编辑任务"></a>02｜基本概念和基础命令：应对简单的编辑任务</h2><h3 id="2-1-Vim-教程的内容概要"><a href="#2-1-Vim-教程的内容概要" class="headerlink" title="2.1 Vim 教程的内容概要"></a>2.1 Vim 教程的内容概要</h3><p><img src="/images/《Vim实用技巧必知必会》学习笔记/Vim命令速查（教程版）.png" alt="Vim命令速查（教程版）"></p>
<p>图中的“•”表示，单个字母不是完整的命令，必须再有进一步的输入。比如，单个“g”没有意义，而“gg”表示跳转到文件开头。（对于命令后面明确跟一个动作的，如“c”，我们不使用“•”。）一个键最多有三排内容：最底下是直接按键的结果，中间是按下 Shift 的结果（变大写），上面偏右的小字是按下 Ctrl 的结果。</p>
<p>一些命令行命令：</p>
<ul>
<li>“:q!”：退出 Vim</li>
<li>“:wq”：存盘退出</li>
<li>“:s”：执行替换</li>
<li>“:!”：执行外部命令</li>
<li>“:edit”（一般缩写为 “:e”）：编辑文件</li>
<li>“:w”：写文件</li>
<li>“:r”：读文件</li>
<li>“:help”：查看帮助</li>
<li>使用键 Ctrl-D 和 Tab 来进行命令行补全</li>
</ul>
<h3 id="2-2-Vim-的模式"><a href="#2-2-Vim-的模式" class="headerlink" title="2.2 Vim 的模式"></a>2.2 Vim 的模式</h3><p>Vim 有以下四种主要模式：</p>
<ul>
<li>正常（normal）模式（也称为普通模式），缺省的编辑模式；如果不加特殊说明，一般提到的命令都直接在正常模式下输入；在任何其他模式中，都可以通过键盘上的 Esc 键回到正常模式。</li>
<li>插入（insert）模式，输入文本时使用；比如在正常模式下键入 i（insert）或 a（append）即可进入插入模式。</li>
<li>可视（visual）模式，用于选定文本块；教程中已经提到可以用键 v（小写）来按字符选定，Vim 里也提供其他不同的选定方法，包括按行和按列块。</li>
<li>命令行（command-line）模式，用于执行较长、较复杂的命令；在正常模式下键入冒号（:）即可进入该模式；使用斜杠（/）和问号（?）开始搜索也算作命令行模式。命令行模式下的命令要输入回车键（Enter）才算完成。</li>
</ul>
<p>此外，Vim 也有个选择（select）模式，与普通的 Windows 编辑器行为较为接近，选择内容后再输入任何内容，将会替换选择的内容。在以可视模式和选择模式之一选定文本块之后，可以使用 Ctrl-G 切换到另一模式。</p>
<h3 id="2-3-Vim-的键描述体例"><a href="#2-3-Vim-的键描述体例" class="headerlink" title="2.3 Vim 的键描述体例"></a>2.3 Vim 的键描述体例</h3><p>Vim 里的标准键描述方式：</p>
<ul>
<li><code>&lt;Esc&gt;</code> 表示 Esc 键；显示为“⎋”</li>
<li><code>&lt;CR&gt;</code> 表示回车键；显示为“↩”</li>
<li><code>&lt;Space&gt;</code> 表示空格键；显示为“␣”</li>
<li><code>&lt;Tab&gt;</code> 表示 Tab 键；显示为“⇥”</li>
<li><code>&lt;BS&gt;</code> 表示退格键；显示为“⌫”</li>
<li><code>&lt;Del&gt;</code> 表示删除键；显示为“⌦”</li>
<li><code>&lt;lt&gt;</code> 表示 &lt; 键；显示为“&lt;”</li>
<li><code>&lt;Up&gt;</code> 表示光标上移键；显示为“⇡”</li>
<li><code>&lt;Down&gt;</code> 表示光标下移键；显示为“⇣”</li>
<li><code>&lt;Left&gt;</code> 表示光标左移键；显示为“⇠”</li>
<li><code>&lt;Right&gt;</code> 表示光标右移键；显示为“⇢”</li>
<li><code>&lt;PageUp&gt;</code> 表示 Page Up 键；显示为“⇞”</li>
<li><code>&lt;PageDown&gt;</code> 表示 Page Down 键；显示为“⇟”</li>
<li><code>&lt;Home&gt;</code> 表示 Home 键；显示为“↖”</li>
<li><code>&lt;End&gt;</code> 表示 End 键；显示为“↘”</li>
<li><code>&lt;F1&gt; - &lt;F12&gt;</code> 表示功能键 1 到 12；显示为“F1”到“F12”</li>
<li><code>&lt;S-…&gt;</code> Shift 组合键；显示为“⇧”（较少使用，因为我们需要写 ! 而不是 <code>&lt;S-1&gt;</code>； 和特殊键组合时仍然有用）</li>
<li><code>&lt;C-…&gt;</code> Control 组合键；显示为“⌃”</li>
<li><code>&lt;M-…&gt;</code> Alt 组合键；显示为“⌥”（对于大部分用户，它的原始键名 Meta 应该只具有历史意义）</li>
<li><code>&lt;D-…&gt;</code> Command 组合键；显示为“⌘”（Mac 键盘）</li>
</ul>
<p>Esc、Enter、v、V 和 Ctrl-V 以后就会写成 <code>&lt;Esc&gt;</code>、<code>&lt;CR&gt;</code>、<code>v</code>、<code>V</code>、<code>&lt;C-V&gt;</code>。这也是以后在 Vim 里对键进行重映射的写法。</p>
<p>这里我要强调一下，对“&lt;”的特殊解释仅在描述输入时生效。在描述命令行和代码时，我们写“<code>&lt;CR&gt;</code>”仍表示四个字符，而非回车键。特别是，如果我们描述的命令行首是“:”，表示这是一个输入 : 开始的 Vim 命令行模式命令（以回车键结束）；如果行首是“/”或“?”，表示这是一个输入 / 或 ? 开始的搜索命令（以回车键结束）；如果行首是“$”，表示这是一个在 shell 命令行上输入的命令（以回车键结束），“$”（和后面的空格）不是命令的一部分，通常后续行也不是命令的一部分，除非行尾有“\”或“^”字符，或行首有“$”字符。</p>
<p>也就是说，下面的命令是在 Vim 里输入“<code>:set ft?&lt;CR&gt;</code>”（用来显示当前编辑文件的文件类型）：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token punctuation">:</span><span class="token keyword">set</span> <span class="token builtin">ft</span><span class="token operator">?</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/Vim命令示例.gif" alt="Vim命令示例"></p>
<p>下面的命令则是在 shell 里输入“<code>which vim&lt;CR&gt;</code>”（用来检查 vim 命令的位置）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">which</span> <span class="token function">vim</span>
/usr/bin/vim<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/Shell命令示例.gif" alt="Shell命令示例"></p>
<p>此外，当我用“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/help.html">:help</a>”描述帮助命令时，你不仅可以在 Vim 里输入这个命令来得到帮助，也可以点击这个帮助的链接，直接在线查看相应的中文帮助页面。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/Vim的内置帮助功能.jpeg" alt="Vim的内置帮助功能"></p>
<p>这节内容不需要死记。建议使用“收藏”功能，这样，你可以在以后碰到不认识的符号标记的时候，返回来查看这一节的内容。</p>
<h3 id="2-4-Vim-的选项和配置"><a href="#2-4-Vim-的选项和配置" class="headerlink" title="2.4 Vim 的选项和配置"></a>2.4 Vim 的选项和配置</h3><p>Vim 的配置文件放在用户的主目录下，文件名通常是 .vimrc；而它在 Windows 下名字是 _vimrc。最基本的配置文件：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">enc</span><span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span>
<span class="token keyword">set</span> <span class="token builtin">nocompatible</span>
<span class="token keyword">source</span> $VIMRUNTIME<span class="token operator">/</span>vimrc_example<span class="token operator">.</span><span class="token keyword">vim</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这三行完成了下列功能：</p>
<ul>
<li>设置编辑文件的内码是 UTF-8（非所有平台缺省，但为编辑多语言文件所必需）</li>
<li>设置 Vim 不需要和 vi 兼容（仅为万一起见，目前大部分情况下这是缺省情况）</li>
<li>导入 Vim 的示例配置（这会打开一些有用的选项，如语法加亮、搜索加亮、命令历史、记住上次的文件位置，等等）</li>
</ul>
<p>对于现代 Unix 系统上的 Vim 8，实际上只需要最后一句就足够了。对于现代 Windows 系统上的 Vim 8，中间的这句 <code>set nocompatible</code> 也可以删除。如果你在较老的 Vim 版本上进行配置，那么把这三行全放进去会比较安全。</p>
<h4 id="2-4-1-备份和撤销文件"><a href="#2-4-1-备份和撤销文件" class="headerlink" title="2.4.1 备份和撤销文件"></a>2.4.1 备份和撤销文件</h4><p>上面的基本设置会产生一个有人喜欢、但也有很多人感到困惑的结果：你修改文件时会出现结尾为“~”的文件，有文件名后面直接加“~”的，还有前面加“.”后面加“.un~”的。这是因为在示例配置里，Vim 自动设置了下面两个选项：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">backup</span>
<span class="token keyword">set</span> undofile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>前一个选项使得我们每次编辑会保留上一次的备份文件，后一个选项使得 Vim 在重新打开一个文件时，仍然能够撤销之前的编辑（undo），这就会产生一个保留编辑历史的“撤销文件”（undofile）了。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/有撤销文件时，再次打开文件仍然可以撤销上次的编辑.gif" alt="有撤销文件时，再次打开文件仍然可以撤销上次的编辑"></p>
<p>我的通常做法是，不产生备份文件，但保留跨会话撤销编辑的能力；因为有了撤销文件，备份其实也就没有必要了。同时，把撤销文件放在用户个人的特定目录下，既保证了安全，又免去了其他目录下出现不必要文件的麻烦。</p>
<p>要达到这个目的，我在 Linux/macOS 下会这么写：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">nobackup</span>
<span class="token keyword">set</span> undodir<span class="token operator">=~</span><span class="token operator">/</span><span class="token operator">.</span><span class="token keyword">vim</span><span class="token operator">/</span>undodir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>在 Windows 下这么写：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">nobackup</span>
<span class="token keyword">set</span> undodir<span class="token operator">=~</span>\vimfiles\undodir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>无论哪种环境，你都需要创建这个目录。我们可以用下面的命令来让 Vim 在启动时自动创建这个目录：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">isdirectory</span><span class="token punctuation">(</span>&amp;undodir<span class="token punctuation">)</span>
  <span class="token keyword">call</span> <span class="token function">mkdir</span><span class="token punctuation">(</span>&amp;undodir<span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token number">0700</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>其中 <code>&amp;undodir</code> 代表 <code>undodir</code> 这个选项的值。相关的帮助文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/eval.html#isdirectory%28%29">:help isdirectory()</a></li>
<li><a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/eval.html#mkdir%28%29">:help mkdir()</a></li>
<li><a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/eval.html#:call">:help :call</a></li>
</ul>
<p>这个跨会话撤销的能力，我还真不知道其他哪个编辑器也有。更妙的是，Vim 还有撤销树的概念，可以帮助你回到任一历史状态。</p>
<h4 id="2-4-2-鼠标支持"><a href="#2-4-2-鼠标支持" class="headerlink" title="2.4.2 鼠标支持"></a>2.4.2 鼠标支持</h4><p>在 Vim 的终端使用场景下，鼠标的选择有一定的歧义：你希望是使用 Vim 的可视模式选择内容，并且只能在 Vim 里使用呢，还是产生 Vim 外的操作系统的文本选择，用于跟其他应用程序的交互呢？这是一个基本的使用问题，两种情况都可能发生，都需要照顾。</p>
<p>如果你使用 xterm 兼容终端的话，通常的建议是：</p>
<ul>
<li>在不按下修饰键时，鼠标选择产生 Vim 内部的可视选择。</li>
<li>在按下 Shift 时，鼠标选择产生操作系统的文本选择。</li>
</ul>
<p>对于不兼容 xterm、不支持对 Shift 键做这样特殊处理的终端，我们一般会采用一种“绕过”方式，让 Vim 在某种情况下暂时不接管鼠标事件。通常的选择是在命令行模式下不使用鼠标。下面，我们就分这两种情况来配置。</p>
<p>虽然最新的 Vim 缺省配置文件（示例配置文件会包含缺省配置），在大部分情况下已经可以自动设置合适的鼠标选项了，不过为照顾我们课程的三种不同平台，我们还是手工设置一下：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">if</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'mouse'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'gui_running'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>&amp;<span class="token builtin">term</span> <span class="token operator">=~</span> <span class="token string">'xterm'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'mac'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span> <span class="token builtin">mouse</span><span class="token operator">=</span>a
  <span class="token keyword">else</span>
    <span class="token keyword">set</span> <span class="token builtin">mouse</span><span class="token operator">=</span>nvi
  <span class="token keyword">endif</span>
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面代码说的是，如果 Vim 有鼠标支持的话，那在以下任一条件满足时：</p>
<ul>
<li>图形界面正在运行</li>
<li>终端是 xterm 兼容，并且不是 Mac（Mac 上的终端声称自己是 xterm，但行为并不完全相同）</li>
</ul>
<p>我们将启用完全的鼠标支持（<code>mouse=a</code>）。特别是，此时鼠标拖拽就会在 Vim 里使用可视模式选择内容（只能在 Vim 里使用）。而当用户按下 Shift 键时，窗口系统接管鼠标事件，用户可以使用鼠标复制 Vim 窗口里的内容供其他应用程序使用。</p>
<p>否则（非图形界面的的终端，且终端类型不是 xterm），就只在正常模式（n）、可视模式（v）、插入模式（i）中使用鼠标。这意味着，当用户按下 <code>:</code> 键进入命令行模式时，Vim 将不对鼠标进行响应，这时，用户就可以使用鼠标复制 Vim 窗口里的内容到其他应用程序里去了。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/可视模式的选取和按：后的选取.gif" alt="可视模式的选取和按：后的选取"></p>
<p>非 xterm 的鼠标支持在 macOS 和 Windows 下都有效。但在 Windows 下需要注意的一点是，如果使用非图形界面的 Vim 的话，应当在命令提示符（Command Prompt）的属性里关闭“快速编辑模式”（QuickEdit Mode），否则 Vim 在运行时将无法对鼠标事件进行响应。</p>
<p>鉴于命令提示符的行为有很多怪异和不一致之处，强烈建议你在 Windows 下，要么使用图形界面的 Vim，要么使用 Cygwin/MSYS2 里、运行在 mintty 下的 Vim。</p>
<h4 id="2-4-3-中文支持"><a href="#2-4-3-中文支持" class="headerlink" title="2.4.3 中文支持"></a>2.4.3 中文支持</h4><p>完整的 Unicode 历史和原理从实用的角度可以简化成下面几条：</p>
<ul>
<li>整个世界基本上在向 UTF-8 编码靠拢。</li>
<li>微软由于历史原因，内部使用 UTF-16；UTF-16 可以跟 UTF-8 无损转换。</li>
<li>GB2312、GBK、GB18030 是一系列向后兼容的中文标准编码方式，GB2312 编码的文件是合法的 GBK 文件，GBK 编码的文件是合法的 GB18030 文件。但除了 GB18030，都不能做到跟 UTF-8 无损转换；目前非 UTF-8 的简体中文文本基本上都用 GBK/GB18030 编码（繁体中文文本则以 Big5 居多）。鉴于 GB18030 是国家标准，其他两种编码也和 GB18030 兼容，我们就重点讲如何在 Vim 中支持 GB18030 了。</li>
</ul>
<p>举一个具体的例子，“你好😄”这个字符串，在 UTF-8 编码下是下面 10 个字节（我按字符进行了分组）：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">e4bda0 e5a5bd f09f9884<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果使用 GB18030 编码（GB2312/GBK 不能支持表情字符）的话，会编码成 8 个字节：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">c4e3 bac3 9439fd30<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这么看起来，GB18030 处理中文在存储效率上是优势的。但它也有缺点：</p>
<ul>
<li>GBK 外的 Unicode 字符一般需要四字节编码（非中文情况会劣化）</li>
<li>GBK 外的 Unicode 字符跟 Unicode 码点需要查表才能转换（UTF-8 则可以用非常简单的条件判断、移位、与、或操作来转换）</li>
<li>一旦出现文件中有单字节发生损毁，后续的所有中文字符都可能发生紊乱（而 UTF-8 可以在一个字符之后恢复）</li>
</ul>
<p>因此，GB18030 在国际化的软件中不会作为内码来使用，只会是读取/写入文件时使用的转换编码。我们要让 Vim 支持 GB18030 也同样是如此。由于 UTF-8 编码是有明显规律的，并非任意文件都能成功地当成 UTF-8 来解码，我们一般使用的解码顺序是：</p>
<ul>
<li>首先，检查文件是不是有 Unicode 的 BOM（字节顺序标记）字符，有的话按照 BOM 字符来转换文件内容。</li>
<li>其次，检查文件能不能当作 UTF-8 来解码；如果可以，就当作 UTF-8 来解释。</li>
<li>否则，尝试用 GB18030 来解码；如果能成功，就当作 GB18030 来转换文件内容。</li>
<li>最后，如果上面的解码都不成功，就按 Latin1 字符集来解码；由于这是单字节的编码，转换必定成功。</li>
</ul>
<p>事实上，Vim 缺省差不多就是按这样的顺序，但第三步使用何种编码跟系统配置有关。如果你明确需要处理中文，那在配置文件里最好明确写下下面的选项设定：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">fileencodings</span><span class="token operator">=</span>ucs<span class="token operator">-</span>bom<span class="token punctuation">,</span>utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span>gb18030<span class="token punctuation">,</span>latin1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="2-4-4-图形界面的字体配置"><a href="#2-4-4-图形界面的字体配置" class="headerlink" title="2.4.4 图形界面的字体配置"></a>2.4.4 图形界面的字体配置</h4><p>图形界面的 Vim 可以自行配置使用的字体，但在大部分环境里，这只是起到美化作用，而非必需项。不过，对于高分辨率屏幕的 Windows，这是一个必需项：Vim 在 Windows 下缺省使用的不是 TrueType 字体，不进行配置的话，字体会小得没法看。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/高分辨率屏下的Windows图形界面Vim.png" alt="高分辨率屏下的Windows图形界面Vim"></p>
<p>在 Windows 的缺省字体里，一般而言，Consolas 和 Courier New 还比较合适。以 Courier New 为例，在 <code>_vimrc</code> 里可以这样配置（Windows 上的基本写法是字体名称加冒号、“h”加字号；用“_”取代空格，否则空格需要用“\”转义）：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">if</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'gui_running'</span><span class="token punctuation">)</span>
  <span class="token keyword">set</span> <span class="token builtin">guifont</span><span class="token operator">=</span>Courier_New<span class="token punctuation">:</span>h10
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/设置了10磅Consolas字体的Vim.png" alt="设置了10磅Consolas字体的Vim"></p>
<p>字体名称如何写是件平台相关的事（可参见帮助文档“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/gui.html#gui-font">:help gui-font</a>”）。如果你不确定怎么写出你需要的字体配置，或者你怎么写都写不对的话，可以先使用图形界面的菜单来选择（通常是“编辑 &gt; 选择字体”；在 MacVim 里是“Edit &gt; Font &gt; Show Fonts”），然后使用命令“:set guifont?”来查看。</p>
<p>注意，Vim 在设置选项时，空格需要用“\”进行转义。比如，如果我们要在 Ubuntu 下把字体设成 10 磅的 DejaVu Sans Mono，就需要写：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token comment">" Linux 和 Windows 不同，不能用 </span><span class="token string">'_'</span> 取代空格
<span class="token keyword">set</span> <span class="token builtin">guifont</span><span class="token operator">=</span>DejaVu\ Sans\ Mono\ <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>此外，宽字符字体（对我们来讲，就是中文字体了）是可以单独配置的。这可能就更是一件仁者见仁、智者见智的事了。对于纯中文的操作系统，这一般反而是不需要配置的；但如果你的语言设定里，中文不是第一选择的话，就有可能在显示中文时出现操作系统误用日文字体的情况。这时你会想要手工选择一个中文字体，比如在 Ubuntu 下，可以用：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">guifontwide</span><span class="token operator">=</span>Noto\ Sans\ Mono\ CJK\ SC\ <span class="token number">11</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意，在不同的中英文字体搭配时，并不需要字号相同。事实上，在 Windows 和 Linux 上我通常都是使用不同字号的中英文字体的。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/Ubuntu下gvim设置中文字体.gif" alt="Ubuntu下gvim设置中文字体"></p>
<p>在上面的动图中，你可以观察到设了中文字体之后，不仅中文字变大，更美观了，“将”、“适”、“关”、“复”、“启”等字的字形也同时发生了变化。</p>
<p>由于字体在各平台上差异较大，字体配置我就不写到 Vim 的参考配置中去了，只把如何选择和配置的方法写出来供你参考。</p>
<h4 id="2-4-5-内容小结"><a href="#2-4-5-内容小结" class="headerlink" title="2.4.5 内容小结"></a>2.4.5 内容小结</h4><p>最终的 Vim 配置文件可以在 GitHub 上找到：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/adah1972/geek_time_vim">https://github.com/adah1972/geek_time_vim</a></p>
<p>关于这个配置文件，我这里做个备注说明：主（master）分支可以用在类 Unix 平台上，windows 分支则用在 Windows 上。适用于今天这一讲的内容标签是 <code>l2-unix</code> 和 <code>l2-windows</code> 。</p>
<h2 id="03｜更多常用命令：应对稍复杂的编辑任务"><a href="#03｜更多常用命令：应对稍复杂的编辑任务" class="headerlink" title="03｜更多常用命令：应对稍复杂的编辑任务"></a>03｜更多常用命令：应对稍复杂的编辑任务</h2><h3 id="3-1-光标移动"><a href="#3-1-光标移动" class="headerlink" title="3.1 光标移动"></a>3.1 光标移动</h3><p>Vim 里的基本光标移动是通过 h、j、k、l 四个键实现的。之所以使用这四个键，是有历史原因的。你看一下 Bill Joy 开发 vi 时使用的键盘就明白了：这个键盘上没有独立的光标键，而四个光标符号直接标注在 H、J、K、L 四个字母按键上。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/LearSieglerADM-3A终端键盘的排布（图片源自维基百科）.png" alt="LearSieglerADM-3A终端键盘的排布（图片源自维基百科）"></p>
<p>当然，除了历史原因外，这四个键一直使用至今，还是有其合理性的。它们都处于打字机的本位排（home row）上，这样打字的时候，手指基本不用移动就可以敲击到。</p>
<p>顺便提一句，你有没有注意到 ADM-3A 键盘上的 Esc 键在今天 Tab 的位置？在 Bill Joy 决定使用 Esc 来退出插入模式的时候，Esc 在键盘上的位置还没像今天那样跑到遥远的左上角去……</p>
<p>Vim 跳转到行首的命令是 0，跳转到行尾的命令是 $，它们与 <code>&lt;Home&gt;</code> 和 <code>&lt;End&gt;</code> 的区别可以参考帮助：<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/motion.html#%3CHome%3E"><code>:help &lt;Home&gt;</code></a> 。此外，我们也有 ^，用来跳转到行首的第一个非空白字符。</p>
<p>对于一次移动超过一个字符的情况，Vim 支持使用 b/w 和 B/W，来进行以单词为单位的跳转。它们的意思分别是 words Backward 和 Words forward，用来向后或向前跳转一个单词。小写和大写命令的区别在于，小写的跟编程语言里的标识符的规则相似，认为一个单词是由字母、数字、下划线组成的（不严格的说法），而大写的命令则认为非空格字符都是单词。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/小写w和大写W的区别.gif" alt="小写w和大写W的区别"></p>
<p>根据单个字符来进行选择也很常见。比如，现在光标在 <code>if (frame-&gt;fr_child != NULL)</code> 第五个字符上，如果我们想要修改括号里的所有内容，需要仔细考虑 w 的选词规则，然后输入 <code>c5w</code> 吗？这样显然不够方便。</p>
<p>这种情况下，我们就需要使用 f（find）和 t（till）了。它们的作用都是找到下一个（如果在输入它们之前先输入数字 n 的话，那就是下面第 n 个）紧接着输入的字符。两者的区别是，f 会包含这个字符，而 t 不会包含这个字符。在上面的情况下，我们用 t 就可以了：<code>ct)</code> 就可以达到目的。如果需要反方向搜索的话，使用大写的 F 和 T 就可以。</p>
<p>对于写文字的情况，比如给开源项目写英文的 README，下面的光标移动键也会比较有用：</p>
<ul>
<li>( 和 ) 移到上一句和下一句</li>
<li>{ 和 } 移到上一段和下一段</li>
</ul>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/整句和整段的移动.gif" alt="整句和整段的移动"></p>
<p>在很多环境（特别是图形界面）里，Vim 支持使用 <code>&lt;C-Home&gt;</code> 和 <code>&lt;C-End&gt;</code> 跳转到文件的开头和结尾。如果遇到困难，则可以使用 vi 兼容的 gg 和 G 跳转到开头和结尾行（小区别：G 是跳转到最后一行的第一个字符，而不是最后一个字符）。</p>
<h3 id="3-2-文本修改"><a href="#3-2-文本修改" class="headerlink" title="3.2 文本修改"></a>3.2 文本修改</h3><p>Vim 中 c 和 d 配合方向键，可以对文本进行更改。本质上，我们可以认为 c（修改）的功能就是执行 d（删除）然后 i（插入）。在 Vim 里，一般的原则就是，常用的功能，按键应尽可能少。因此很多相近的功能在 Vim 里会有不同的按键。不仅如此，大写键也一般会重载一个相近但稍稍不同的含义：</p>
<ul>
<li>d 加动作来进行删除（dd 删除整行）；D 则相当于 d$，删除到行尾。</li>
<li>c 加动作来进行修改（cc 修改整行）；C 则相当于 c$，删除到行尾然后进入插入模式。</li>
<li>s 相当于 cl，删除一个字符然后进入插入模式；S 相当于 cc，替换整行的内容。</li>
<li>i 在当前字符前面进入插入模式；I 则相当于 ^i，把光标移到行首非空白字符上然后进入插入模式。</li>
<li>a 在当前字符后面进入插入模式；A 相当于 $a，把光标移到行尾然后进入插入模式。</li>
<li>o 在当前行下方插入一个新行，然后在这行进入插入模式；O 在当前行上方插入一个新行，然后在这行进入插入模式。</li>
<li>r 替换光标下的字符；R 则进入替换模式，每次按键（直到 <code>&lt;Esc&gt;</code>）替换一个字符。</li>
<li>u 撤销最近的一个修改动作；U 撤销当前行上的所有修改。</li>
</ul>
<h3 id="3-3-文本对象选择"><a href="#3-3-文本对象选择" class="headerlink" title="3.3 文本对象选择"></a>3.3 文本对象选择</h3><p>可以使用 c、d 加动作键对这个动作选定的文本块进行操作，也可以使用 v 加动作键来选定文本块（以便后续进行操作）。不过，还有几个动作只能在 c、d、v 这样命令之后用。</p>
<p>这些选择动作的基本附加键是 a 和 i。其中，a 可以简单理解为英文单词 a，表示选定后续动作要求的完整内容，而 i 可理解为英文单词 inner，代表后续动作要求的内容的“内部”。</p>
<p>具体的例子，假设有下面的文本内容：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">if (message == "sesame open")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们进一步假设光标停在“sesame”的“a”上，那么：</p>
<ul>
<li>dw（理解为 delete word）会删除 ame␣，结果是 if (message == “sesopen”)</li>
<li>diw（理解为 delete inside word）会删除 sesame，结果是 if (message == “ open”)</li>
<li>daw（理解为 delete a word）会删除 sesame␣，结果是 if (message == “open”)</li>
<li>diW 会删除 “sesame，结果是 if (message == open”)</li>
<li>daW 会删除 “sesame␣，结果是 if (message == open”)</li>
<li>di” 会删除 sesame open，结果是 if (message == “”)</li>
<li>da” 会删除 “sesame open”，结果是 if (message ==)</li>
<li>di( 或 di) 会删除 message == “sesame open”，结果是 if ()</li>
<li>da( 或 da) 会删除 (message == “sesame open”)，结果是 if␣</li>
</ul>
<p>上面演示了 a、i 和 w、双引号、圆括号搭配使用，这些对于任何语言的代码编辑都是非常有用的。实际上，可以搭配的还有更多：</p>
<ul>
<li>搭配 s（sentence）对句子进行操作——适合西文文本编辑</li>
<li>搭配 p（paragraph) 对段落进行操作——适合西文文本编辑，及带空行的代码编辑</li>
<li>搭配 t（tag）对 HTML/XML 标签进行操作——适合 HTML、XML 等语言的代码编辑</li>
<li>搭配 ` 和 ‘ 对这两种引号里的内容进行操作——适合使用这些引号的代码，如 shell 和 Python</li>
<li>搭配方括号（“[”和“]”）对方括号里的内容进行操作——适合各种语言（大部分都会用到方括号吧）</li>
<li>搭配花括号（“{”和“}”）对花括号里的内容进行操作——适合类 C 的语言</li>
<li>搭配角括号（“&lt;”和“&gt;”）对角括号里的内容进行操作——适合 C++ 的模板代码</li>
</ul>
<p>再进一步，在 a 和 i 前可以加上数字，对多个（层）文本对象进行操作。下面图中是一个示例：</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/修改往上第2层花括号内的所有内容.gif" alt="修改往上第2层花括号内的所有内容"></p>
<h3 id="3-4-更快地移动"><a href="#3-4-更快地移动" class="headerlink" title="3.4 更快地移动"></a>3.4 更快地移动</h3><p>可以使用 <code>&lt;PageUp&gt;</code> 和 <code>&lt;PageDown&gt;</code> 来翻页，但 Vim 更传统的用法是 <code>&lt;C-B&gt;</code> 和 <code>&lt;C-F&gt;</code>，分别代表 Backward 和 Forward。</p>
<p>除了翻页，Vim 里还能翻半页，有时也许这种方式更方便，需要的键是 <code>&lt;C-U&gt;</code> 和 <code>&lt;C-D&gt;</code>，Up 和 Down。</p>
<p>如果你知道出错位置的行号，那你可以用数字加 G 来跳转到指定行。类似地，你可以用数字加 | 来跳转到指定列。这在调试代码的时候非常有用，尤其适合进行自动化。</p>
<p>下图中展示了 iTerm2 中<a target="_blank" rel="noopener" href="https://www.iterm2.com/documentation-captured-output.html">捕获输出</a>并执行 Vim 命令的过程（用 vim -c ‘normal 5G36|’ 来执行跳转到出错位置第 5 行第 36 列）：</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/捕获错误信息并自动通过Vim命令行来跳转到指定位置.gif" alt="捕获错误信息并自动通过Vim命令行来跳转到指定位置"></p>
<p>（如果你用 iTerm2 并对这个功能感兴趣，我设置的正则表达式是 <code>^([_a-zA-Z0-9+/.-]+):([0-9]+):([0-9]+): (?:fatal error|error|warning|note):</code>，捕获输出后执行的命令是 <code>echo "vim -c 'normal \2G\3|' \1"</code>。）</p>
<p>你只关心当前屏幕的话，可以快速移动光标到屏幕的顶部、中间和底部：用 H（High）、M（Middle）和 L（Low）就可以做到。</p>
<p>顺便提一句，vimrc_example 有一个设定，我不太喜欢：它会设 set scrolloff=5，导致只要屏幕能滚动，光标就移不到最上面的 4 行和最下面的 4 行里，因为一移进去屏幕就会自动滚动。这同样也会导致 H 和 L 的功能发生变化：本来是移动光标到屏幕的最上面和最下面，现在则变成了移动到上数第 6 行和下数第 6 行，和没有这个设定时的 6H 与 6L 一样了。所以我一般会在 Vim 配置文件里设置 set scrolloff=1（你也可以考虑设成 0），减少这个设置的干扰。</p>
<p>只要光标还在屏幕上，你也可以滚动屏幕而不移动光标（不像某些其他编辑器，Vim 不允许光标在当前屏幕以外）。需要的按键是 <code>&lt;C-E&gt;</code> 和 <code>&lt;C-Y&gt;</code>。</p>
<p>另外一种可能更实用的滚动屏幕方式是，把当前行“滚动”到屏幕的顶部、中部或底部。Vim 里的对应按键是 zt、zz 和 zb。和上面的几个滚动相关的按键一样，它们同样受选项 scrolloff 的影响。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/光标移动和屏幕滚动.gif" alt="光标移动和屏幕滚动"></p>
<h3 id="3-5-重复，重复，再重复"><a href="#3-5-重复，重复，再重复" class="headerlink" title="3.5 重复，重复，再重复"></a>3.5 重复，重复，再重复</h3><p>Vim 对很多简单操作已经定义了重复键：</p>
<ul>
<li>; 重复最近的字符查找（f、t 等）操作</li>
<li>, 重复最近的字符查找操作，反方向</li>
<li>n 重复最近的字符串查找操作（/ 和 ?）</li>
<li>N 重复最近的字符串查找操作（/ 和 ?），反方向</li>
<li>. 重复执行最近的修改操作</li>
</ul>
<h2 id="04｜初步定制：让你的-Vim-更顺手"><a href="#04｜初步定制：让你的-Vim-更顺手" class="headerlink" title="04｜初步定制：让你的 Vim 更顺手"></a>04｜初步定制：让你的 Vim 更顺手</h2><h3 id="4-1-Vim-的目录结构"><a href="#4-1-Vim-的目录结构" class="headerlink" title="4.1 Vim 的目录结构"></a>4.1 Vim 的目录结构</h3><p>Vim 的工作环境是由运行支持文件来设定的。Vim 比较有意思的一点的是，虽然运行支持文件是在 Vim 的安装目录下，但用户自己是可以“克隆”这个目录结构的。也就是说，你自己目录下的用户配置，到你深度定制的时候，也有相似的目录结构。</p>
<h3 id="4-2-安装目录下的运行支持文件"><a href="#4-2-安装目录下的运行支持文件" class="headerlink" title="4.2 安装目录下的运行支持文件"></a>4.2 安装目录下的运行支持文件</h3><p>Vim 的运行支持文件在不同的平台上有着相似的目录结构。以 Vim 8.2 为例，它们的标准安装位置分别在：</p>
<ul>
<li>大部分 Unix 下面：/usr/share/vim/vim82</li>
<li>macOS Homebrew 下：/usr/local/opt/macvim/MacVim.app/Contents/Resources/vim/runtime</li>
<li>Windows 下：C:\Program Files (x86)\Vim\vim82</li>
</ul>
<p>最常用的子目录：</p>
<ul>
<li>syntax：Vim 的语法加亮文件</li>
<li>doc：Vim 的帮助文件</li>
<li>colors：Vim 的配色方案</li>
<li>plugin：Vim 的“插件”，即用来增强 Vim 功能的工具</li>
</ul>
<p>这里面的文件去掉“.vim”后缀后，就是文件类型的名字，你可以用类似 <code>:setfiletype java</code> 这样的命令来设置文件的类型，从而进行语法加亮。</p>
<p>在图形界面的 Vim 里，你可以通过“语法 &gt; 在菜单中显示文件类型”（“Syntax &gt; Show File Types in Menu”）来展示 Vim 的所有文件类型，然后可以选择某一类型来对当前文件进行设置。这儿的菜单项，跟 syntax 目录下的文件就基本是一一对应的了。</p>
<p>在菜单中显示文件类型这个额外的步骤，可能是因为很久很久以前，加载所有文件类型的菜单是一个耗时的操作吧。在 menu.vim 里，目前有这样的代码：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token comment">" Skip setting up the individual syntax selection menus unless</span>
<span class="token comment">" do_syntax_sel_menu is defined (it takes quite a bit of time).</span>
<span class="token keyword">if</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">"do_syntax_sel_menu"</span><span class="token punctuation">)</span>
  <span class="token keyword">runtime</span><span class="token operator">!</span> synmenu<span class="token operator">.</span><span class="token keyword">vim</span>
<span class="token keyword">else</span>
  …
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>不知道这段注释是什么年代加上的……但显然，我们的电脑已经不会再在乎加载几百个菜单项所占的时间了。即使我不怎么用菜单，我也找不出不直接展示这个菜单的理由；我可不想在需要使用的时候再多点一次鼠标。</p>
<p>所以，我会在我的 vimrc 文件里写上：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">let</span> do_syntax_sel_menu <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>同理，我会加载其他一些可能会被 Vim 延迟加载的菜单，减少需要在菜单上点击的次数：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">let</span> do_no_lazyload_menus <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们用“:help”命令查看的帮助文件就放在 doc 目录下。我们可以用菜单“编辑 &gt; 配色方案”（“Edit &gt; Color Scheme”）浏览配色方案，相应的文件就在 colors 目录下。</p>
<p>在 plugin 目录下的系统内置插件不多，我们下面就快速讲解一下：</p>
<ul>
<li>getscriptPlugin：获得最新的 Vim 脚本的插件（在目前广泛使用 Git 的年代，这个插件过时了，我们不讲）</li>
<li>gzip：编辑 .gz 压缩文件（能在编辑后缀为 .gz 的文件时自动解压和压缩，你会感觉不到这个文件是压缩的）</li>
<li>logiPat：模式匹配的逻辑运算符（允许以逻辑运算、而非标准正则表达式的方式来写模式匹配表达式）</li>
<li>manpager：使用 Vim 来查看 man 帮助（强烈建议试一下，记得使用 Vim 的跳转键C-] 和 C-T）</li>
<li>matchparen：对括号进行高亮匹配（现代编辑器基本都有类似的功能）</li>
<li>netrwPlugin：从网络上编辑文件和浏览（远程）目录（支持多种常见协议如 ftp 和scp，可直接打开目录来选择文件）</li>
<li>rrhelper：用于支持 —remote-wait 编辑（Vim 的多服务器会用到这一功能）</li>
<li>spellfile：在拼写文件缺失时自动下载（Vim 一般只安装了英文的拼写文件）</li>
<li>tarPlugin：编辑（压缩的）tar 文件（注意，和 gzip 情况不同，这儿不支持写入）</li>
<li>tohtml：把语法加亮的结果转成 HTML（自己打开个文件，输入命令“:TOhtml”就知道效果了）</li>
<li>vimballPlugin：创建和解开 .vba 文件（这个目前也略过时了，我们不讲）</li>
<li>zipPlugin：编辑 zip 文件（和 tar 文件不同，zip 文件可支持写入）</li>
</ul>
<p>除了 rrhelper 和 spellfile 属于功能支持插件，没有自己的帮助页面，其他功能都可以使用“:help”命令来查看帮助。查看帮助时，插件名称中的“Plugin”后缀需要去掉：查看 zip 文件编辑的帮助时，应当使用“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/pi_zip.html#zip">:help zip</a>”而不是“:help zipPlugin”。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/浏览远程目录，打开一个tar.gz文件.gif" alt="浏览远程目录，打开一个tar.gz文件"></p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/使用Vim查看man帮助.gif" alt="使用Vim查看man帮助"></p>
<h3 id="4-3-用户的-Vim-配置目录"><a href="#4-3-用户的-Vim-配置目录" class="headerlink" title="4.3 用户的 Vim 配置目录"></a>4.3 用户的 Vim 配置目录</h3><p>Vim 的安装目录你是不应该去修改的。首先，你可能没有权限去修改这个目录；其次，即使你有修改权限，这个目录会在 Vim 升级时被覆盖，你做的修改也会丢失。用户自己的配置应当放在自己的目录下，这也就是用户自己的主目录下的 Vim 配置目录（Unix 下的 .vim，Windows 下的 vimfiles）。这个目录应和 Vim 安装目录下的运行支持文件目录有相同的结构，但下面的子目录你在需要修改 Vim 的相关行为时才有必要创建。如果一个同名文件出现用户自己的 Vim 配置目录里和 Vim 的安装目录里，用户的文件优先。</p>
<h3 id="4-4-Vim-8-新功能"><a href="#4-4-Vim-8-新功能" class="headerlink" title="4.4 Vim 8 新功能"></a>4.4 Vim 8 新功能</h3><p>站在我个人的角度看，从 Vim 7.4 到 Vim 8.2，最大的新功能是：</p>
<ul>
<li>Vim 软件包的支持（“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/repeat.html#packages">:help packages</a>”）</li>
<li>异步任务支持（“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/channel.html">:help channel</a>”、“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/channel.html#job">:help job</a>”和“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/eval.html#timers">:helptimers</a>”）</li>
<li>终端支持（“<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/terminal.html">:help terminal</a>”）</li>
</ul>
<h3 id="4-5-Vim-软件包"><a href="#4-5-Vim-软件包" class="headerlink" title="4.5 Vim 软件包"></a>4.5 Vim 软件包</h3><p>Vim 的目录结构有点传统 Unix 式：一个功能用到的文件可能会分散在多个目录下。，一个 Vim 的插件（严格来讲，应该叫包）通常也会分散在多个目录下：</p>
<ul>
<li>插件的主体通常在 plugin 目录下</li>
<li>插件的帮助文件在 doc 目录下</li>
<li>有些插件只对某些文件类型有效，会有文件放在 ftplugin 目录下</li>
<li>有些插件有自己的文件类型检测规则，会有文件放在 ftdetect 目录下</li>
<li>有些插件有特殊的语法加亮，会有文件放在 syntax 目录下</li>
<li>……</li>
</ul>
<p>以前我们安装插件，一般是一次性安装后就不管了。安装过程基本上就是到 .vim 目录（Windows 上是 vimfiles 目录）下，解出压缩包的内容，然后执行 vim -c ‘helptags doc|q’ 生成帮助文件的索引。到了“互联网式更新”的年代，这种方式就显得落伍了。尤其糟糕的地方在于，它是按文件类型来组织目录的，而不是按相关性，这就没法用 Git 来管理了。</p>
<p>Vim 上后来就出现了一些包管理器，它们的基本模式都是相通的：每个包有自己的目录，然后这些目录会被加到 Vim 的运行时路径（runtimepath）选项里。最早的 runtimepath 较为简单，在 Unix 上缺省为：</p>
<ul>
<li>$HOME/.vim,</li>
<li>$VIM/vimfiles,</li>
<li>$VIMRUNTIME,</li>
<li>$VIM/vimfiles/after,</li>
<li>$HOME/.vim/after</li>
</ul>
<p>而在有了包管理器之后，runtimepath 就会非常复杂，每个包都会增加一个自己的目录进去。但是，好处也是非常明显的，包的管理变得非常方便。从 Vim 8 开始，Vim 官方也采用了类似的体系。Vim 会在用户的配置目录（Unix 下是 $HOME/.vim ，Windows 下是 $HOME/vimfiles ）下识别名字叫 pack 的目录，并在这个目录的子目录的 start 和 opt 目录下寻找包的目录。</p>
<p>听着有点绕吧？我们看一个实际的 Vim 配置目录的结构就清楚了：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">.
├── colors
├── doc
├── pack
│   ├── minpac
│   │   ├── opt
│   │   │   ├── minpac
│   │   │   ├── vim-airline
│   │   │   └── vimcdoc
│   │   └── start
│   │       ├── VimExplorer
│   │       ├── asyncrun.vim
│   │       ├── fzf.vim
│   │       ├── gruvbox
│   │       ├── killersheep
│   │       ├── nerdcommenter
│   │       ├── nerdtree
│   │       ├── tagbar
│   │       ├── undotree
│   │       ├── vim-fugitive
│   │       ├── vim-matrix-screensaver
│   │       ├── vim-rainbow
│   │       ├── vim-repeat
│   │       ├── vim-rhubarb
│   │       └── vim-surround
│   └── my
│       ├── opt
│       │   ├── YouCompleteMe
│       │   ├── ale
│       │   ├── clang_complete
│       │   ├── cvsmenu
│       │   └── syntastic
│       └── start
│           ├── vim-gitgutter
│           └── ycmconf
├── plugin
├── syntax
└── undodir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到，pack 目录下有 minpac 和 my 两个子目录（这些名字 Vim 不关心），每个目录下面又有 opt 和 start 两个子目录，再下面就是每个包自己的目录了，里面又可以有自己的一套 colors、doc、plugin 这样的子目录，这样就方便管理了。Vim 8 在启动时会加载所有 pack/*/start 下面的包，而用户可以用 <code>:packadd</code> 命令来加载某个 opt 目录下的包，如 <code>:packadd vimcdoc</code> 命令可加载 vimcdoc 包，来显示中文帮助信息。</p>
<p>有了这样的目录结构，用户要自己安装、管理包就方便多了。不过，我们还是推荐使用一个包管理器。包管理器可以带来下面的好处：</p>
<ul>
<li>根据文本的配置（一般写在 vimrc 配置文件里）决定要安装哪些包</li>
<li>自动化安装、升级和卸载，包括帮助文件的索引生成</li>
</ul>
<p>在我们这门课程里，我会使用 minpac，一个利用 Vim 8 功能的小巧的包管理器。如果你已经在使用其他包管理器，我接下来讲的两个小节你可以考虑跳过。</p>
<h3 id="4-6-安装-minpac"><a href="#4-6-安装-minpac" class="headerlink" title="4.6 安装 minpac"></a>4.6 安装 minpac</h3><p>根据 minpac 网页上的说明，我们在 Windows 下可以使用下面的命令：</p>
<pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">cd /d %USERPROFILE%
git clone https://github.com/k-takata/minpac.git ^
    vimfiles\pack\minpac\opt\minpac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在 Linux 和 macOS 下则可以使用下面的命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/k-takata/minpac.git <span class="token punctuation">\</span>
    ~/.vim/pack/minpac/opt/minpac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后，我们在 vimrc 配置文件中加入以下内容（先不用理解其含义）：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">if</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">'*minpac#init'</span><span class="token punctuation">)</span>
  <span class="token comment">" Minpac is loaded.</span>
  <span class="token keyword">call</span> minpac#<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">call</span> minpac#<span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'k-takata/minpac'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'opt'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">" Other plugins</span>
<span class="token keyword">endif</span>

<span class="token keyword">if</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'eval'</span><span class="token punctuation">)</span>
  <span class="token comment">" Minpac commands</span>
  command<span class="token operator">!</span> PackUpdate packadd minpac | <span class="token keyword">source</span> $MYVIMRC | <span class="token keyword">call</span> minpac#<span class="token function">update</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'do'</span><span class="token punctuation">:</span> <span class="token string">'call minpac#status()'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  command<span class="token operator">!</span> PackClean  packadd minpac | <span class="token keyword">source</span> $MYVIMRC | <span class="token keyword">call</span> minpac#<span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  command<span class="token operator">!</span> PackStatus packadd minpac | <span class="token keyword">source</span> $MYVIMRC | <span class="token keyword">call</span> minpac#<span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>存盘、重启 Vim 之后，我们就有了三个新的命令，可以用来更新（安装）包、清理包和检查当前包的状态。</p>
<h3 id="4-7-通过-minpac-安装扩展包"><a href="#4-7-通过-minpac-安装扩展包" class="headerlink" title="4.7 通过 minpac 安装扩展包"></a>4.7 通过 minpac 安装扩展包</h3><p>下面我们就来试验一下通过 minpac 来安装扩展包。我们在“Other plugins”那行下面加入以下内容：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">call</span> minpac#<span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'tpope/vim-eunuch'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>保存文件，然后我们使用 <code>:PackUpdate</code> 命令。略微等待之后，我们就能看到类似下面的界面：</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/插件安装之后的状态界面.png" alt="插件安装之后的状态界面"></p>
<p>这就说明安装成功了。我们可以按 <code>q</code> 来退出这个状态窗口。我们也可以使用 <code>:PackStatus</code> 来重新打开这个状态窗口。要删除一个插件，在 vimrc 中删除对应的那行，保存，然后使用 <code>:PackClean</code> 命令就可以了。</p>
<h3 id="4-8-最近使用的文件"><a href="#4-8-最近使用的文件" class="headerlink" title="4.8 最近使用的文件"></a>4.8 最近使用的文件</h3><p>安装好 Vim 软件包之后，我们进一步来实现一个小功能。</p>
<p>Vim 的缺省安装缺了一个很多编辑器都有的功能：最近使用的文件。</p>
<p>我们就把这个功能补上吧。你只需要按照上一节的步骤安装 yegappan/mru 包就可以了（MRU 代表 most recently used）。安装完之后，重新打开 vimrc 文件，你就可以在图形界面里看到下面的菜单了：</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/最近文件的菜单.png" alt="最近文件的菜单.png"></p>
<p>估计你很可能会问：如果是远程连接，没有图形界面怎么办？</p>
<p>我们仍可以在文本界面上唤起菜单，虽然美观程度会差点。你需要在 vimrc 配置文件中加入以下内容（同样，我们暂时先不用去理解其意义）：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'gui_running'</span><span class="token punctuation">)</span>
  <span class="token comment">" 设置文本菜单</span>
  <span class="token keyword">if</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'wildmenu'</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span> <span class="token builtin">wildmenu</span>
    <span class="token keyword">set</span> <span class="token builtin">cpoptions</span><span class="token operator">-=</span><span class="token operator">&lt;</span>
    <span class="token keyword">set</span> <span class="token builtin">wildcharm</span><span class="token operator">=</span><span class="token operator">&lt;</span>C<span class="token operator">-</span>Z<span class="token operator">&gt;</span>
    nnoremap <span class="token operator">&lt;</span>F10<span class="token operator">&gt;</span>      <span class="token punctuation">:</span><span class="token keyword">emenu</span> <span class="token operator">&lt;</span>C<span class="token operator">-</span>Z<span class="token operator">&gt;</span>
    inoremap <span class="token operator">&lt;</span>F10<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>C<span class="token operator">-</span>O<span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token keyword">emenu</span> <span class="token operator">&lt;</span>C<span class="token operator">-</span>Z<span class="token operator">&gt;</span>
  <span class="token keyword">endif</span>
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在增加上面的配置之后，你就可以使用键 <code>&lt;F10&gt;</code> （当然你也可以换用其他键）加 <code>&lt;Tab&gt;</code> 来唤起 Vim 的文本菜单了。如下图所示：</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/文本菜单的使用.gif" alt="文本菜单的使用"></p>
<h2 id="05｜多文件打开与缓冲区：复制粘贴的正确姿势"><a href="#05｜多文件打开与缓冲区：复制粘贴的正确姿势" class="headerlink" title="05｜多文件打开与缓冲区：复制粘贴的正确姿势"></a>05｜多文件打开与缓冲区：复制粘贴的正确姿势</h2><p>今天，我们就来细细讨论一下这个话题，什么是编辑多个文件的正确姿势。</p>
<p>先来假设一个简单的使用场景，我们现在需要在某个目录下的所有 .cpp 和 .h 文件开头贴入一段版权声明，该如何操作？</p>
<h3 id="5-1-单文件的打开方式"><a href="#5-1-单文件的打开方式" class="headerlink" title="5.1 单文件的打开方式"></a>5.1 单文件的打开方式</h3><h4 id="5-1-1-图形界面"><a href="#5-1-1-图形界面" class="headerlink" title="5.1.1 图形界面"></a>5.1.1 图形界面</h4><p>使用图形界面的话，我们可以在操作系统的资源管理器里进入到合适的目录，然后逐个使用 Vim 来打开文件。我们可以使用右键菜单（“Edit with Vim”、“Open with…”等），也可以直接把文件拖拽到 Vim 里。使用“文件 &gt; 打开”（File &gt; Open）菜单当然也是一种选择，但这需要你记住上次打开到第几个文件，并不如使用资源管理器方便。</p>
<p>使用这几种编辑方式的话，你可以把需要粘贴的内容放到操作系统的剪贴板里，然后在图形界面的 Vim 里用以下方法之一粘贴进去（当然，如果光标不在开头的话，先用鼠标或用 gg 命令跳转到开头）：</p>
<ul>
<li>正常模式 Vim 命令 “+P（意义我们后面再解释）</li>
<li>快捷键 <code>&lt;D-V&gt;</code>（提醒：这是我们对 ⌘V 的标记方式；仅适用于 macOS）或 <code>&lt;SInsert&gt;</code>（PC 键盘）</li>
<li>鼠标右键加“粘贴”（Paste）</li>
<li>菜单“编辑 &gt; 粘贴”（Edit &gt; Paste）</li>
</ul>
<p>注意，如果你通常使用 Ctrl-V 键粘贴的话，这个快捷键在 Vim 里并不适用。即使你使用的是图形界面的 Vim 也是如此，因为这个键在 Vim 里有其他用途。顺便说一句，这个键在 Unix 终端上也一样是不能用作粘贴的。</p>
<h4 id="5-1-2-终端-Vim"><a href="#5-1-2-终端-Vim" class="headerlink" title="5.1.2 终端 Vim"></a>5.1.2 终端 Vim</h4><p>如果直接把图形界面下的基本步骤，翻译成终端 Vim（非图形界面）的用法的话，应该是这样子的：</p>
<ol>
<li>在终端里进入到目标目录下</li>
<li>使用 vim 文件名 来逐一打开需要编辑的文件</li>
<li>如果光标不在开头的话，用鼠标或 gg 命令跳转到开头</li>
<li>使用命令 i 进入插入模式</li>
<li>使用终端窗口的粘贴命令或快捷键（如 <code>&lt;S-Insert&gt;</code>）来粘贴内容</li>
<li>按 <code>&lt;Esc&gt;</code> 回到正常模式并用 ZZ 存盘退出</li>
</ol>
<p>或者，我们还可以采用下面的不退出 Vim 的处理方法：</p>
<ul>
<li>打开文件使用 :e 文件名；可以使用 <code>&lt;C-D&gt;</code> 来查看有哪些文件，及用 <code>&lt;Tab&gt;</code> 进行自动完成</li>
<li>存盘使用 :w</li>
</ul>
<p>但是如果粘贴的内容含缩进、而 Vim 又不够新的话，我们还会有特殊的麻烦。请继续往下看。</p>
<h4 id="5-1-3-Vim-老版本的特殊处理"><a href="#5-1-3-Vim-老版本的特殊处理" class="headerlink" title="5.1.3 Vim 老版本的特殊处理"></a>5.1.3 Vim 老版本的特殊处理</h4><p><img src="/images/《Vim实用技巧必知必会》学习笔记/老版本Vim下直接粘贴可能出现的错误结果.png" alt="老版本Vim下直接粘贴可能出现的错误结果"></p>
<p>上面的图片展示了 Vim 用户可能遇到的一种错误情况。这是因为对于终端 Vim 来说，一般而言，它是没法分辨用户输入和粘贴的。因此，在粘贴内容时，Vim 的很多功能，特别是和自动缩进相关的，就会和输入打架，导致最后的结果不对。</p>
<p>要解决这个问题，你就得让 Vim 知道，你到底是在输入还是在粘贴。Vim 有一个 paste 选项，就是用来切换输入 / 粘贴状态的。如果这个选项打开的话（:set paste），Vim 就认为你在粘贴，智能缩进、制表符转换等功能就不会修改粘贴的内容。</p>
<p>不过，手工设置该选项（及事后用 set nopaste 取消）是件烦人的事。所幸 xterm 里有一个“括号粘贴模式”（bracketed paste mode）可以帮 Vim 判断目前是输入还是粘贴。这个模式启用后，终端在发送剪贴板的内容之前和之后都会发送特殊的控制字符序列，来通知应用程序进行特殊的处理。</p>
<p>启用括号粘贴模式需要向 xterm 发送启用序列 <code>&lt;Esc&gt;[?2004h</code>，关闭括号粘贴模式需要向 xterm 发送关闭序列 <code>&lt;Esc&gt;[?2004l</code>；在启用了括号粘贴模式后，xterm 在发送剪贴板内容时会在前后分别加上开始粘贴序列 <code>&lt;Esc&gt;[200~</code> 和结束粘贴序列 <code>&lt;Esc&gt;[201~</code>。</p>
<p>Vim 8.0.0210 开始引入了对括号粘贴模式的支持。在兼容 xterm 的终端里进行粘贴时，你不再需要使用 paste 这个选项了。更棒的是，目前你甚至都不需要进入插入模式就可以粘贴了。</p>
<p>如果你使用的是 Vim 8.0.0210 之前的版本的话，那我们至少也可以通过代码来使得手工设置 paste 选项变得不必要。你可以在 vimrc 里加入下面的代码：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'patch-8.0.210'</span><span class="token punctuation">)</span>
  <span class="token comment">" 进入插入模式时启用括号粘贴模式</span>
  <span class="token keyword">let</span> &amp;<span class="token builtin">t_SI</span> <span class="token operator">.=</span> <span class="token string">"\&lt;Esc&gt;[?2004h"</span>
  <span class="token comment">" 退出插入模式时停用括号粘贴模式</span>
  <span class="token keyword">let</span> &amp;<span class="token builtin">t_EI</span> <span class="token operator">.=</span> <span class="token string">"\&lt;Esc&gt;[?2004l"</span>
  <span class="token comment">" 见到 &lt;Esc&gt;[200~ 就调用 XTermPasteBegin</span>
  inoremap <span class="token operator">&lt;</span>special<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>expr<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Esc<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token number">200</span>~ <span class="token function">XTermPasteBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">XTermPasteBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">" 设置使用 &lt;Esc&gt;[201~ 关闭粘贴模式</span>
    <span class="token keyword">set</span> <span class="token builtin">pastetoggle</span><span class="token operator">=</span><span class="token operator">&lt;</span>Esc<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token number">201</span>~
    <span class="token comment">" 开启粘贴模式</span>
    <span class="token keyword">set</span> <span class="token builtin">paste</span>
    <span class="token keyword">return</span> <span class="token string">""</span>
  <span class="token keyword">endfunction</span>
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="5-1-4-“已经存在交换文件！”"><a href="#5-1-4-“已经存在交换文件！”" class="headerlink" title="5.1.4 “已经存在交换文件！”"></a>5.1.4 “已经存在交换文件！”</h4><p>对每个文件单独使用一个 Vim 会话来编辑，很容易出现冲突的情况，所以你迟早会遇到“已经存在交换文件！”（Swap file “…” already exists!）的错误提示。出现这个提示，有两种可能的原因：</p>
<ol>
<li>你上次编辑这个文件时，发生了意外崩溃。</li>
<li>你已经在使用另外一个 Vim 会话编辑这个文件了。</li>
</ol>
<p>原因不同，我们处理的策略自然也不相同。当进程 ID（process ID）后面没有“STILL RUNNING”这样的字样时，那就是情况 1；否则，就是情况 2 了。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/上次编辑这个文件时发生了意外崩溃的错误提示.png" alt="上次编辑这个文件时发生了意外崩溃的错误提示"></p>
<p>上图中没有“STILL RUNNING”的字样，说明是情况 1。这时你需要按 r 来恢复上次的编辑状态——Vim 支持即使在你没有存盘的情况下仍然保存你的编辑状态，因而这种方法可以恢复你上次没有存盘的内容。</p>
<p>需要注意的是，在恢复之后，Vim 仍然不会删除崩溃时保留下来的那个交换文件。因此，在确定内容无误、保存文件之后，你需要重新再打开文件，并按 d 键把交换文件删除。当然，如果你确定目前保存的文件版本就是你想要的，也可以直接按 d 把交换文件删除、重新编辑文件。</p>
<p>反过来，如果你已经在另一个 Vim 会话里编辑文件的话，我们就会在进程 ID 后面看到“STILL RUNNING”的字样；同时，Vim 界面上也没有了删除（Delete）交换文件这一选项。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/文件正在其他地方被编辑的错误提示.png" alt="文件正在其他地方被编辑的错误提示"></p>
<p>这时，大部分情况侠我们应当使用 q 或 a（绝大部分情况下没有区别）放弃编辑，并找到目前已经打开的 Vim 窗口，从那里继续。少数情况下，我们只是要查看文件，那也可以选择 o 只读打开文件。需要使用 e 强行编辑的情况很少，需要非常谨慎——比如，你确认另外有 Vim 会话，但里面不会去做任何修改，这是我目前想得出来的唯一的合理需求。</p>
<p>如果我们使用图形界面 Vim 8 的话，Vim 支持在文件已经打开时自动切换到已经打开的 Vim 窗口上。这个功能在文件处于一个不活跃的标签页（下一讲会讨论标签页支持）时特别有用，因为 Vim 能把这个标签页自动切到最前面。不过，这个功能不是默认激活的，我们需要在 vimrc 中加入以下内容：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">if</span> v<span class="token punctuation">:</span><span class="token keyword">version</span> <span class="token operator">&gt;=</span> <span class="token number">800</span>
  packadd<span class="token operator">!</span> editexisting
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="5-2-多文件的打开方式"><a href="#5-2-多文件的打开方式" class="headerlink" title="5.2 多文件的打开方式"></a>5.2 多文件的打开方式</h3><p>首先，我们需要知道，Vim 支持一次性打开多个文件，你只需要在命令行上写出多个文件即可，或者使用通配符。比如，就我们刚才所说的编辑场景，我们可以使用 <code>vim *.cpp *.h</code> 。</p>
<p>有可能让你吃惊的是，输入这个命令之后，Vim 只打开了一个文件，那就是所有文件中的第一个。</p>
<p>原来，为了确保在配置较差的环境里仍然能够正常工作，Vim 绝对不会不必要地消耗内存，包括打开不必要立即打开的文件。所以在上面的命令后，Vim 建立了一个文件列表，并且暂时只打开其中的第一个文件。接下来，用户可以决定，要编辑哪个文件，或者查看列表，或者提前退出，等等。</p>
<p>为此，Vim 提供了以下命令：</p>
<ul>
<li>:args：可以显示“参数”，即需要编辑的多个文件的列表</li>
<li>:args 文件名：使用新的文件名替换参数列表</li>
<li>:next（可缩写为 :n）：打开下一个文件；如当前文件修改（未存盘）则会报错中止，但如果命令后面加 ! 则会放弃修改内容，其他命令也类似</li>
<li>:Next（缩写 :N）或 :previous（缩写 :prev）：打开上一个文件</li>
<li>:first 或 :rewind：回到列表中的第一个文件</li>
<li>:last：打开列表中的最后一个文件</li>
</ul>
<p>使用这些命令，我们的工作流当然就会发生变化了：</p>
<ol>
<li>在终端里进入到目标目录下</li>
<li>使用 vim <em>.cpp </em>.h 或 gvim <em>.cpp </em>.h 来打开需要编辑的文件</li>
<li>对于第一个文件，使用之前的方法贴入所需的文本</li>
<li>使用 V 进入行选择的可视模式，移动光标选中所需的文本，然后使用 y 复制选中的各行</li>
<li>执行命令 :set autowrite，告诉 Vim 在切换文件时自动存盘</li>
<li>执行命令 :n|normal ggP，切换到下一个文件并执行正常模式命令 ggP，跳转到文件开头并贴入文本</li>
<li>确认修改无误后，键入 :、上箭头和回车，重复执行上面的命令</li>
<li>待 Vim 报错说已经在最后一个文件里，使用 :w 存盘，或 :wq（抑或更快的 ZZ）存盘退出</li>
</ol>
<p>注意，第 6 步可以拆成 :n 和 ggP 两步，但文件数量较多时，反复手工敲 ggP 也挺累的。因此，我这儿使用了 normal 命令，在命令行模式下执行正常模式命令，下面就可以直接 重复切换命令加粘贴命令，我们的编辑效率也得以大大提升。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/第4步到第7步的演示（注意倒数第二行的变化）.gif" alt="第4步到第7步的演示（注意倒数第二行的变化）"></p>
<p>另外，Vim 还能解决一个 shell 相关的不一致性问题。如果我们要编辑的文件除了当前目录下的，还有所有子目录下的，在大部分 shell 下，包括 Linux 上缺省的 Bash，我们需要使用“<code>*.cpp *.h **/*.cpp **/*.h</code>”来挑选这些文件，重复、麻烦。Vim 在此处采用了类似于 Zsh 的简化语法，“**”也包含了当前目录。这样，我们只需把上面第 2 步改成下面这样即可：</p>
<ul>
<li>键入 vim 进入 Vim，然后使用 <code>:args **/*.cpp **/*.h</code> 来打开需要编辑的文件</li>
</ul>
<h3 id="5-3-缓冲区的管理和切换"><a href="#5-3-缓冲区的管理和切换" class="headerlink" title="5.3 缓冲区的管理和切换"></a>5.3 缓冲区的管理和切换</h3><p>跟多文件相关又略微不同的一个概念是缓冲区（buffer）。它是 Vim 里的一个基本概念，和今天讲的很多其他内容有相关性和相似性。</p>
<p>Vim 里会对每一个已打开或要打开的文件创建一个缓冲区，这个缓冲区就是文件在 Vim 中的映射。在多文件编辑的时候你也会有同样数量的缓冲区。不过，缓冲区的数量常常会更高，因为你用 :e 等命令打开的文件不会改变“命令行参数”（只被命令行或 :args 命令修改），但同样会增加缓冲区的数量。</p>
<p>此外，:args 代表参数列表 / 文件列表，真的只是文件的列表而已。缓冲区中有更多信息的，最最基本的就是记忆了光标的位置。在 Vim 里，除了切换到下一个文件这样的批处理操作外，操作缓冲区的命令比简单操作文件的命令更为方便。</p>
<p>作为对比，我们来看一下文件列表和缓冲区列表的命令的结果。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/文件列表命令args的结果.png" alt="文件列表命令args的结果"></p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/缓冲区列表命令ls的结果.png" alt="缓冲区列表命令ls的结果"></p>
<p>可以看到，两者都展示了文件，都标示出了当前编辑的文件（分别使用方括号和“%a”）。不过，缓冲区列表中明显有更多的信息：</p>
<ul>
<li>文件名前面有编号；我们也马上就会说到利用编号的命令。</li>
<li>除了当前活跃文件的标记“%a”，还有个文件被标成了“#”，这表示最近的缓冲区；缓冲区列表里还可能有其他标记，如“+”表示缓冲区已经被修改。</li>
<li>文件名后面有行号，表示光标在文件中的位置。</li>
</ul>
<p>常用的缓冲区命令跟前面文件列表相关的命令有很大的相似性，因此我在这儿一起讲，可以帮助你记忆：</p>
<ul>
<li>:buffers 或 :ls：可以显示缓冲区的列表</li>
<li>:buffer 缓冲区列表里的编号（:buffer 可缩写为 :b）：跳转到编号对应的缓冲区；如当前缓冲区已被修改（未存盘）则会报错中止，但如果命令后面加 ! 则会放弃修改内容；其他命令也类似</li>
<li>:bdelete 缓冲区列表里的编号（:bdelete 可缩写为 :bd）：删除编号对应的缓冲区；编号省略的话删除当前缓冲区</li>
<li>:bnext（缩写 :bn）：跳转到下一个缓冲区</li>
<li>:bNext（缩写 :bN）或 :bprevious（缩写 :bp）：跳转到上一个缓冲区</li>
<li>:bfirst 或 :brewind：跳转到缓冲区列表中的第一个文件</li>
<li>:blast：跳转到缓冲区列表中的最后一个文件</li>
</ul>
<p>还有很常见的一种情况是，我们需要在两个文件之间切换。Vim 对最近编辑的文件（上面提到的列表里标有“#”的文件）有特殊的支持，使用快捷键 <code>&lt;C-^&gt;</code> 可以在最近的两个缓冲区之间来回切换。这个快捷键还有一个用法是在前面输入缓冲区的编号：比如，用 <code>1&lt;C-^&gt;</code> 可以跳转到第一个缓冲区（跟命令行模式的命令 :bfirst 或 :b1 效果相同）。</p>
<p>从实际使用的角度，使用缓冲区列表有点像打开最近使用的文件菜单（但缓冲区列表不会存盘），可以当作一种快速切换到最近使用的文件的方式。</p>
<p>缓冲区是文件在某个 Vim 会话里的映射。这意味着，如果某个 Vim 会话里不同的窗口或标签页（下一讲里会讨论）编辑的是同一个文件，它们对应到的也会是同一个缓冲区。更重要的是，文件 / 缓冲区的修改在同一个 Vim 会话里是完全同步的——这就不会像在多会话编辑时那样发生冲突和产生错误了。</p>
<h2 id="06｜窗口和标签页：修改、对比多个文件的正确姿势"><a href="#06｜窗口和标签页：修改、对比多个文件的正确姿势" class="headerlink" title="06｜窗口和标签页：修改、对比多个文件的正确姿势"></a>06｜窗口和标签页：修改、对比多个文件的正确姿势</h2><h3 id="6-1-多窗口编辑"><a href="#6-1-多窗口编辑" class="headerlink" title="6.1 多窗口编辑"></a>6.1 多窗口编辑</h3><p>Vim 有窗口的概念。事实上，如果你使用过 Vim 的帮助功能的话，那你就已经见过 Vim 的多窗口界面了。在那种情况下，Vim 自动打开了一个水平分割的帮助窗口。</p>
<p>那如果我们想要自己同时查看、编辑多个文件呢？最基本的命令就是 :split（缩写 :sp）了。这个命令后面如果有文件名，表示分割窗口并打开指定的文件；如果没有文件名，那就表示仅仅把当前窗口分割开，当前编辑的文件在两个窗口里都显示。跟显示帮助文件一样，:split 默认使用水平分割的方式。</p>
<p>可以在会产生分割的命令（如 help 和 split）之前加上 vertical（缩写 vert），来进行竖直分割。对于最常见的竖直分割操作，我们则可以直接写成 :vsplit（缩写 :vs）。</p>
<p>下面的动画展示了我们进行一次竖直分割后，再进行水平分割的过程：</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/窗口分割演示.gif" alt="窗口分割演示"></p>
<p>多窗口编辑是一个比较适宜使用鼠标的情况。你可以使用鼠标来激活想要使用的窗口，也可以使用鼠标来拖拉窗口的大小——只要启用了鼠标支持，终端窗口（包括远程连接的 mintty、PuTTY 等）里的 Vim 的窗口分割线也是可以拖动的（上面动画里的分割线拖动就是在一个终端窗口里）。</p>
<p>当然，作为 Vim 用户，基本的键盘使用肯定是少不了的：</p>
<ul>
<li><code>&lt;C-W&gt;</code> 加方向键（h、j、k、l、<code>&lt;Left&gt;</code> 等等）可以在窗口之间跳转</li>
<li><code>&lt;C-W&gt;w</code> 跳转到下一个（往右和往下）窗口，如果已经是右下角的窗口，则跳转到左上角的窗口</li>
<li><code>&lt;C-W&gt;W</code> 跳转到上一个（往左和往上）窗口，如果已经是左上角的窗口，则跳转到右下角的窗口</li>
<li><code>&lt;C-W&gt;n</code> 或 :new 打开一个新窗口</li>
<li><code>&lt;C-W&gt;c</code> 或 :close 关闭当前窗口；当前窗口如果已经是最后一个则无效</li>
<li><code>&lt;C-W&gt;q</code> 或 :quit 退出当前窗口，当最后一个窗口退出时则退出 Vim</li>
<li><code>&lt;C-W&gt;o</code> 或 :only 只保留当前窗口，关闭其他所有窗口</li>
<li><code>&lt;C-W&gt;s</code> 和 :split 作用相同，把当前窗口横向一分为二</li>
<li><code>&lt;C-W&gt;v</code> 和 :vsplit 作用相同，把当前窗口纵向一分为二</li>
<li><code>&lt;C-W&gt;=</code> 使得所有窗口大小相同（当调整过终端或图形界面 Vim 的窗口大小后特别有用）</li>
<li><code>&lt;C-W&gt;_</code> 设置窗口高度，命令前的数字表示高度行数，默认为纵向占满（想专心编辑某个文件时很有用）</li>
<li><code>&lt;C-W&gt;|</code> 设置窗口宽度，命令前的数字表示宽度列数，默认为横向占满</li>
<li><code>&lt;C-W&gt;+</code> 增加窗口的高度，命令前的数字表示需要增加的行数，默认为 1</li>
<li><code>&lt;C-W&gt;-</code> 减少窗口的高度，命令前的数字表示需要减少的行数，默认为 1</li>
<li><code>&lt;C-W&gt;&gt;</code> 增加窗口的宽度，命令前的数字表示需要增加的列数，默认为 1</li>
<li><code>&lt;C-W&gt;&lt;lt&gt;</code>（提醒，我们用 <code>&lt;lt&gt;</code> 表示“&lt;”键）减少窗口的宽度，命令前的数字表示需要增加的列数，默认为 1</li>
</ul>
<p>由于切换窗口是一个非常常见的操作，我通常会映射一下快捷键。为了跟一般的图形界面程序一致，我使用了 Ctrl-Tab 和 Ctrl-Shift-Tab：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim">nnoremap <span class="token operator">&lt;</span>C<span class="token operator">-</span>Tab<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>C<span class="token operator">-</span>W<span class="token operator">&gt;</span><span class="token keyword">w</span>
inoremap <span class="token operator">&lt;</span>C<span class="token operator">-</span>Tab<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>C<span class="token operator">-</span>O<span class="token operator">&gt;</span><span class="token operator">&lt;</span>C<span class="token operator">-</span>W<span class="token operator">&gt;</span><span class="token keyword">w</span>
nnoremap <span class="token operator">&lt;</span>C<span class="token operator">-</span>S<span class="token operator">-</span>Tab<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>C<span class="token operator">-</span>W<span class="token operator">&gt;</span>W
inoremap <span class="token operator">&lt;</span>C<span class="token operator">-</span>S<span class="token operator">-</span>Tab<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>C<span class="token operator">-</span>O<span class="token operator">&gt;</span><span class="token operator">&lt;</span>C<span class="token operator">-</span>W<span class="token operator">&gt;</span>W<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>简单解释一下：nnoremap 命令映射正常模式下的键盘，inoremap 命令映射插入模式下的键盘；正常模式的映射简单直白，应该不需要解释，插入模式的映射使用了临时模式切换键 <code>&lt;C-O&gt;</code>（<a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/insert.html#i_CTRL-O">:help i_CTRL-O</a>），在正常模式下执行相应的窗口命令，然后返回插入模式。使用这样的键盘映射之后，这两个快捷键在正常模式和插入模式下就都可以使用了。</p>
<h3 id="6-2-双窗口比较"><a href="#6-2-双窗口比较" class="headerlink" title="6.2 双窗口比较"></a>6.2 双窗口比较</h3><p>多窗口编辑中有一个非常有用的使用方式，那就是比较两个文件，Vim 对此也有特殊的支持。使用 vimdiff 或 gvimdiff 命令，后面跟两个文件名，我们就可以对这两个文件进行比较。在比较时，Vim 会自动折叠相同的代码行，并加亮两边文本的不同部分。窗口的滚动也是联动的。一个实际的截图如下所示：</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/比较两个CPP文件.png" alt="比较两个CPP文件"></p>
<p>顺便说一句，因为使用双窗口比较功能要求 Vim 的宽度是平时的两倍左右，所以我通常都会对 Vim 窗口使用最大化、拖拉之类的操作。这些操作一般只影响右边的窗口的大小，因此，在放大窗口的操作后，我通常紧跟着就会执行 <code>&lt;C-W&gt;=</code> 来使两个窗口的宽度相同——事实上，我使用 <code>&lt;C-W&gt;=</code> 主要就在这种场合。你也可以试试。</p>
<p>当然了，在 Vim 内部也可以发起这样的比较。你需要做的是打开第一个文件，然后使用命令 :vert diffsplit 第二个文件。这一点只要了解一下就好，毕竟大部分情况下你不需要这样去做。</p>
<h3 id="6-3-多标签页编辑"><a href="#6-3-多标签页编辑" class="headerlink" title="6.3 多标签页编辑"></a>6.3 多标签页编辑</h3><p>接下来我们继续讨论和多窗口编辑构成互补的另外一种方式，也就是多标签页。</p>
<p>这里我先给你一个结论：<strong>单窗口多文件编辑最适合的场景是批量修改具有相似性质的文件，多窗口编辑最适合的场景是需要对多个文件进行对比编辑，而其他的一些同时编辑多个文件的场景，就可以考虑多标签页的编辑方式</strong>。</p>
<p>多标签页的基本特性：</p>
<ul>
<li>多标签页编辑允许在编辑器里同时修改多个（未存盘的）文件</li>
<li>多标签页编辑一次只展示一个文件</li>
<li>通过选择标签页（或使用键盘）可以方便地在多个标签页中进行切换</li>
</ul>
<p>Vim 中的标签页在图形界面或终端模式下都能支持上面描述的这些特性。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/终端里运行的有两个标签页的Vim.png" alt="终端里运行的有两个标签页的Vim"></p>
<p>和某些图形界面应用程序不同，Vim 里标签页可包含多个窗口（一个标签页里默认有一个窗口），而不是窗口可包含多个标签页——这也意味着，在标签页里关闭最后一个窗口就关闭了整个标签页。</p>
<p>此外，Vim 的标签页在纯文本的终端模式里也是可用的。在存在多个标签页的情况下，即使在终端里，你也可以用鼠标点击标签页来进行切换，双击标签栏的空白处添加新标签页，以及点击“X”标记来关闭标签页。</p>
<p>当然，Vim 用户更经常会使用键盘：</p>
<ul>
<li>在已有命令行模式命令前加 tab␣ 可以在新标签页中展示命令的结果，如 :tab help 可以在新标签页中打开帮助，:tab split 可以在新标签页中打开当前缓冲区</li>
<li>:tabs 展示所有标签页的列表</li>
<li>:tabnew 或 :tabedit 可以打开一个空白的新标签页，后面有文件名的话则打开该文件</li>
<li>:tabclose 可以关闭当前标签页（如果标签页里只有一个窗口，使用窗口关闭命令 <code>&lt;C-W&gt;c</code> 应该更快）</li>
<li>:tabnext、gt 或 <code>&lt;C-PageDown&gt;</code> 可以切换到下一个标签页</li>
<li>:tabNext、:tabprevious 、gT 或 <code>&lt;C-PageUp&gt;</code> 可以切换到上一个标签页</li>
<li>:tabfirst 或 :tabrewind 切换到第一个标签页</li>
<li>:tablast 切换到最后一个标签页</li>
</ul>
<p>如果一开始用多窗口编辑，后来发现不需要一直参照这个文件了，或者屏幕空间不足了，该怎么办呢？Vim 提供了一个命令，可以把当前窗口转变成一个新标签页：按下 <code>&lt;C-W&gt;T</code> 即可（仅当当前屏幕上有多个窗口时有效）。</p>
<p>上一讲我们说过，如果某个 Vim 会话里不同的窗口（或标签页；以下略）编辑的是同一个文件，它们对应到的也会是同一个缓冲区。这意味着多个窗口编辑同一个文件不会有冲突，同时，如果缓冲区被修改了，但只要当前关闭的窗口不是包含这个缓冲区的唯一窗口，那关闭窗口不会有任何问题，也不会影响文件的状态。在任何一个瞬间，任何一个窗口都指向一个缓冲区，而任何一个缓冲区都属于一个或多个窗口。（例外情况是你使用了一个不那么常用的功能，隐藏缓冲区；这个功能在本课程中不会讨论。）</p>
<h3 id="6-4-NERDTree-插件"><a href="#6-4-NERDTree-插件" class="headerlink" title="6.4 NERDTree 插件"></a>6.4 NERDTree 插件</h3><p>来看几个利用这些特性的插件。我们讨论的第一个插件就是 NERDTree。</p>
<p>对于找文件这件事，NERDTree 就是你知道文件大概在哪里、但不知道文件具体名字时的一个好选择。跟很多 Vim 插件一样，NERDTree 会利用多窗口（少数情况下利用标签页）的特性。</p>
<p><img src="/images/《Vim实用技巧必知必会》学习笔记/NERDTree的使用界面.png" alt="NERDTree的使用界面"></p>
<h4 id="6-4-1-安装"><a href="#6-4-1-安装" class="headerlink" title="6.4.1 安装"></a>6.4.1 安装</h4><p>如果使用 minpac 的话，我们需要在 vimrc 中“Other plugins”那行下面加入下面的语句，并运行 :PackUpdate 来安装一下：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">call</span> minpac#<span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'preservim/nerdtree'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>NERDTree 缺省就会抢占 netrw 使用的路径形式，所以我们可以用 :e . 来打开 NERDTree。不过，更常用的方式仍然是使用 :NERDTreeToggle，NERDTree 窗口的切换命令。我们使用这个命令可以打开上面左侧的那个 NERDTree 窗口，也可以关闭。</p>
<h4 id="6-4-2-使用"><a href="#6-4-2-使用" class="headerlink" title="6.4.2 使用"></a>6.4.2 使用</h4><p>在打开 NERDTree 窗口之后，使用还是相当直观的，并且按下 ? 就可以查看帮助信息。提一下最重要的几个功能点：</p>
<ul>
<li>顾名思义，这个插件以树形方式展示文件系统，在目录上敲回车或双击即可打开或关闭光标下的目录树。</li>
<li>在文件上敲回车或双击立即打开该文件，并且光标跳转到文件窗口中，这样你就可以立即开始编辑了。</li>
<li>在文件上使用 go 会预览该文件，也就是光标不会跳转到文件所在的窗口中，方便快速查看多个文件的内容。</li>
<li>按 i 会打开文件到一个新的水平分割的窗口中，按 s 会打开文件到一个新的竖直分割的窗口中，按 t 会打开文件到一个新的标签页中。</li>
<li>NERDTree 会自动过滤隐藏文件和目录，但如果你需要看到它们的话，也可以用 I 来开启和关闭隐藏文件的显示。</li>
<li>按 m 会出现一个菜单，允许添加、删除、更名等操作。</li>
</ul>
<h3 id="6-5-类似插件"><a href="#6-5-类似插件" class="headerlink" title="6.5 类似插件"></a>6.5 类似插件</h3><p><a target="_blank" rel="noopener" href="https://github.com/mbbill/VimExplorer">VimExplorer</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://kibazen.cn" rel="external nofollow noreferrer">Kiba Amor</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                    </span>
                <span class="reprint-info">
                    <a href="https://kibazen.cn/vim-shi-yong-ji-qiao-bi-zhi-bi-hui-xue-xi-bi-ji/">https://kibazen.cn/vim-shi-yong-ji-qiao-bi-zhi-bi-hui-xue-xi-bi-ji/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-ND 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://kibazen.cn" target="_blank">Kiba Amor</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/">
                                    <span class="chip bg-color">极客时间</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/vim-shi-yong-ji-qiao-bi-zhi-bi-hui-xue-xi-bi-ji/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/featureimages/3.jpg" class="responsive-img" alt="《Vim实用技巧必知必会》学习笔记">
                        
                        <span class="card-title">《Vim实用技巧必知必会》学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-23
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/">
                        <span class="chip bg-color">极客时间</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/cheng-xu-yuan-jin-jie-gong-lue-xue-xi-bi-ji/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/featureimages/18.jpg" class="responsive-img" alt="《程序员进阶攻略》学习笔记">
                        
                        <span class="card-title">《程序员进阶攻略》学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-11
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/">
                        <span class="chip bg-color">极客时间</span>
                    </a>
                    
                    <a href="/tags/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/">
                        <span class="chip bg-color">职业规划</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (true) {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 木叶禅<br />'
            + '文章作者: Kiba Amor<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者木叶禅所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">Kiba Amor</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">750.5k</span>&nbsp;字
            
            
            
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/kibaamor" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>









    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=562236616" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 562236616" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>





    <a href="https://www.zhihu.com/people/kibaamor" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/kibaamor" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    

    

    

	
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
