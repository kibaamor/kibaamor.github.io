<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="领域驱动设计相关的软件架构, kiba, zen, amor, kibazen, kibaamor, 木叶, 木叶禅">
    <meta name="description" content="You are too concerned with what was and what will be">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>领域驱动设计相关的软件架构 | 木叶禅</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/css/my.css">

    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="木叶禅" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">木叶禅</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/learn/" class="waves-effect waves-light">
      
      <i class="fas fa-book" style="zoom: 0.6;"></i>
      
      <span>Learn</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/memo/" class="waves-effect waves-light">
      
      <i class="fas fa-sticky-note" style="zoom: 0.6;"></i>
      
      <span>Memo</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories/" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags/" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about/" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">木叶禅</div>
        <div class="logo-desc">
            
            You are too concerned with what was and what will be
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/learn/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-book"></i>
			
			Learn
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/memo/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-sticky-note"></i>
			
			Memo
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">领域驱动设计相关的软件架构</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/">
                                <span class="chip bg-color">领域驱动设计</span>
                            </a>
                        
                            <a href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/">
                                <span class="chip bg-color">软件架构</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" class="post-category">
                                软件工程
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-11-01
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-10-29
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    25 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="架构风格和架构模式"><a href="#架构风格和架构模式" class="headerlink" title="架构风格和架构模式"></a>架构风格和架构模式</h2><h3 id="架构风格（Architectural-Styles）"><a href="#架构风格（Architectural-Styles）" class="headerlink" title="架构风格（Architectural Styles）"></a>架构风格（Architectural Styles）</h3><h4 id="架构风格的定义"><a href="#架构风格的定义" class="headerlink" title="架构风格的定义"></a>架构风格的定义</h4><p><a target="_blank" rel="noopener" href="https://ics.uci.edu/~fielding/">Roy Thomas Fielding</a> 在其 2000 年的博士论文 <a target="_blank" rel="noopener" href="https://ics.uci.edu/~fielding/pubs/dissertation/software_arch.htm">Architectural Styles and<br>the Design of Network-based Software Architectures</a> 中指出：</p>
<blockquote>
<p>An architectural style is a coordinated set of architectural constraints that restricts the roles/features of architectural elements and the allowed relationships among those elements within any architecture that conforms to that style.</p>
<p><strong>架构风格是一组协调的架构约束</strong>，它限定了架构元素的角色、特性及在符合该风格的架构中这些元素之间所允许的相互关系。</p>
</blockquote>
<p>这些约束不仅定义了系统的结构形态，也影响其非功能性特征，如可扩展性、可演化性和可维护性。</p>
<p>因此，架构风格可以被视为对系统架构中”设计约束集合”的抽象，不同的风格体现了不同的设计取舍与系统特征。</p>
<p>Vaughn Vernon 在其 2013 年出版的书籍 <a target="_blank" rel="noopener" href="https://www.oreilly.com/library/view/implementing-domain-driven-design/9780133039900/">《Implementing Domain-Driven Design》</a> 中指出：</p>
<blockquote>
<p>An architectural style is to architecture what a design pattern is to a specific design. It is an abstraction of those aspects that are common to different concrete implementations, enabling discussion of their relevant benefits without getting lost in technical detail.</p>
<p>架构风格之于架构，如同设计模式之于具体设计。它将不同架构实现中的共性抽象出来，使讨论架构时能够关注其核心优势，而不陷入技术细节。</p>
</blockquote>
<p>这一类比揭示了架构风格的抽象层次：正如设计模式体现了通用的设计思想，架构风格则概括了系统结构与交互机制的普遍特征。</p>
<p>换言之，架构风格通过约束系统元素的角色与关系，为架构提供可复用的结构范式。任何满足特定约束集合的架构实例，都可被视为该风格的具体化形式。</p>
<h4 id="微服务架构风格"><a href="#微服务架构风格" class="headerlink" title="微服务架构风格"></a>微服务架构风格</h4><p>在分布式系统领域，<strong>微服务（Microservices）</strong> 是一种典型的架构风格。</p>
<p>James Lewis 和 Martin Fowler 在 2014 年发布的 <a target="_blank" rel="noopener" href="https://www.martinfowler.com/microservices/">Microservices Guide</a> 一文中将其定义为：</p>
<blockquote>
<p>In short, <strong>the microservice architectural style</strong> is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services, which may be written in different programming languages and use different data storage technologies.</p>
<p>简而言之，<strong>微服务架构风格</strong> 是一种将单个应用程序开发为一组小型服务的方法，每个服务都在自己的进程中运行并用轻量级机制（通常是 HTTP 资源 API）进行通信。 这些服务围绕业务功能构建，并可通过全自动部署机制独立部署。 这些服务的集中管理是最低限度的，这些服务可能用不同的编程语言编写并使用不同的数据存储技术。</p>
</blockquote>
<p>基于 Fowler 与 Lewis 的总结，微服务架构风格的特征可归纳为以下三个层面：</p>
<ol>
<li><p><strong>组织层面特征</strong></p>
<ul>
<li><strong>围绕业务能力构建（Organized around Business Capabilities）</strong>：服务边界以业务领域为中心，而非技术分层。</li>
<li><strong>产品化思维（Products not Projects）</strong>：团队承担服务的全生命周期责任，形成长期维护的产品团队文化。</li>
<li><strong>分散治理（Decentralized Governance）</strong>：团队在技术选型与设计决策上保持自治，减少集中化控制带来的瓶颈。</li>
</ul>
</li>
<li><p><strong>技术层面特征</strong></p>
<ul>
<li><strong>服务化组件化（Componentization via Services）</strong>：系统通过服务实现高内聚、低耦合的组件化。</li>
<li><strong>轻量级通信机制（Smart Endpoints and Dumb Pipes）</strong>：服务间通信依赖轻量级协议（如 HTTP/REST、消息队列），避免复杂中间层。</li>
<li><strong>数据去中心化（Decentralized Data Management）</strong>：各服务独立拥有数据存储，以保障自治性与独立演化能力。</li>
<li><strong>基础设施自动化（Infrastructure Automation）</strong>：自动化的部署与运维机制支持服务的快速交付与弹性伸缩。</li>
</ul>
</li>
<li><p><strong>设计层面特征</strong></p>
<ul>
<li><strong>容错性设计（Design for Failure）</strong>：系统具备冗余与隔离机制，确保局部故障不会影响整体运行。</li>
<li><strong>演进式设计（Evolutionary Design）</strong>：系统结构允许随着业务变化持续演化，支持持续交付与渐进重构。</li>
</ul>
</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>综上，<strong>架构风格（Architectural Style）</strong> 是由一组协调约束所定义的结构与交互范式，这些约束决定了系统的结构形态及其非功能特征。</p>
<p>微服务作为一种特定的架构风格，通过在组织、技术与设计层面的多重约束，形成了以自治性、可演化性与持续交付为核心的架构特征。</p>
<p>因此，从架构理论角度而言，<strong>微服务不是一种具体技术，而是一种体现分布式自治思想的架构风格。</strong></p>
<h3 id="架构模式（Architectural-Patterns）"><a href="#架构模式（Architectural-Patterns）" class="headerlink" title="架构模式（Architectural Patterns）"></a>架构模式（Architectural Patterns）</h3><p>Len Bass、Paul C. Clements 和 Rick Kazman 在 2012 年出版的书籍《Software Architecture in Practice》对架构模式的定义是：</p>
<blockquote>
<p>An architectural pattern is a general, reusable resolution to a commonly occurring problem in software architecture within a given context.</p>
<p>架构模式是针对给定上下文中软件架构中常见问题的通用的、可重用的解决方案。</p>
</blockquote>
<p>与架构风格相比，架构模式侧重于<strong>解决问题的方法</strong>，而架构风格则描述系统的<strong>结构特征和交互机制</strong>。</p>
<p>换言之，架构风格回答”系统是什么样的”，架构模式回答”如何设计系统以满足这些特征”。</p>
<h4 id="微服务架构模式"><a href="#微服务架构模式" class="headerlink" title="微服务架构模式"></a>微服务架构模式</h4><p>微服务（Microservices）作为一种分布式架构风格，其典型模式可以被抽象为一系列可复用的设计方案，用以解决分布式系统中的通用问题。</p>
<p>这些模式通常包括但不限于：</p>
<ol>
<li><strong>服务自治模式（Self-contained Service Pattern）</strong>：每个服务独立部署和管理，实现高内聚、低耦合。</li>
<li><strong>服务发现模式（Service Discovery Pattern）</strong>：服务实例能够动态注册与发现，实现服务间的灵活调用。</li>
<li><strong>网关模式（API Gateway Pattern）</strong>：通过统一入口管理请求路由、负载均衡和安全控制。</li>
<li><strong>熔断模式（Circuit Breaker Pattern）</strong>：提供故障隔离，防止局部失败蔓延至整个系统。</li>
<li><strong>事件驱动模式（Event-driven Pattern）</strong>：通过消息或事件通信解耦服务，提高系统可伸缩性。</li>
</ol>
<p>在实际微服务系统中，这些模式通常依赖于具体技术和基础设施实现，如：</p>
<ol>
<li>弹性伸缩</li>
<li>服务发现</li>
<li>配置中心</li>
<li>服务网关</li>
<li>负载均衡</li>
<li>服务安全</li>
<li>跟踪监控</li>
<li>降级熔断</li>
</ol>
<p>需要注意的是，这些实现细节并非模式本身，而是模式在工程实践中的具体落地方式。</p>
<h3 id="架构风格与架构模式的关系"><a href="#架构风格与架构模式的关系" class="headerlink" title="架构风格与架构模式的关系"></a>架构风格与架构模式的关系</h3><p>架构风格提供了系统结构和设计约束，而架构模式则为在这一风格下构建系统提供可复用的解决方案。风格决定了系统的结构特征（如自治性、演进性），模式指导如何在具体实现中解决相关问题（如服务发现、容错、监控）。</p>
<p>因此，从理论上讲：</p>
<ul>
<li><strong>架构风格（Architectural Style）</strong>：描述系统高层结构特征与交互机制，如微服务强调自治性和演进性。</li>
<li><strong>架构模式（Architectural Pattern）</strong>：提供通用设计方案以实现风格特征，如服务发现、熔断、网关。</li>
<li><strong>具体实现（Implementation / Technical Solution）</strong>：利用具体技术手段落地模式，如服务注册中心、负载均衡器、监控系统。</li>
</ul>
<h2 id="常见软件架构"><a href="#常见软件架构" class="headerlink" title="常见软件架构"></a>常见软件架构</h2><h3 id="Boundary-Control-Entity"><a href="#Boundary-Control-Entity" class="headerlink" title="Boundary-Control-Entity"></a>Boundary-Control-Entity</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Entity-control-boundary">Boundary-Control-Entity（BCE）</a> 架构由 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ivar_Jacobson">Ivar Jacobson</a> 于 1992 年在 <a target="_blank" rel="noopener" href="https://www.amazon.com/Object-Oriented-Software-Engineering-Driven-Approach/dp/0201403471">Object-Oriented Software Engineering: A use case driven approach</a> 中提出。</p>
<blockquote>
<p>Boundary-Control-Entity（BCE）也叫 Entity-Control-Boundary（ECB）或 Entity-Boundary-Control（EBC）。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/EICObjects.webp" alt="EICObjects"></p>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/EIC.webp" alt="EIC"></p>
<ol>
<li><p>Boundary</p>
<p> 外界与系统交互的接口。</p>
</li>
<li><p>Control</p>
<p> 包含所有不适合放在 Entity 和 Boundary 的行为。</p>
<p> Robert C. Martin 对 Interactor 的描述是包含特定于应用程序的业务规则（The interactors on the other hand, have application specific business rules）。</p>
</li>
<li><p>Entity</p>
<p> 包含与问题域相关的数据和行为。</p>
<p> Robert C. Martin 对 Entity 的描述是包含与应用无关的的业务逻辑（contain application independent business rules）。</p>
</li>
</ol>
<h4 id="其他资料"><a href="#其他资料" class="headerlink" title="其他资料"></a>其他资料</h4><ol>
<li><a target="_blank" rel="noopener" href="https://youtu.be/Nltqi7ODZTM?t=2442">Clean Architecture</a></li>
<li><a target="_blank" rel="noopener" href="https://herbertograca.com/2017/08/24/ebi-architecture/">EBI Architecture</a></li>
</ol>
<h3 id="分层架构（Layered-Architecture）"><a href="#分层架构（Layered-Architecture）" class="headerlink" title="分层架构（Layered Architecture）"></a>分层架构（Layered Architecture）</h3><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><p><strong>分层架构</strong>是一种经典的软件设计模式，其核心思想是<strong>通过分离关注点降低系统复杂性。</strong></p>
<p><strong>分层架构</strong>的基本原则是将系统划分为不同层，每层只关注特定职责，并通过依赖方向管理层间关系。</p>
<p>虽然 Eric Evans 在 2003 年的 <a target="_blank" rel="noopener" href="https://book.douban.com/subject/26819666/">《领域驱动设计：软件核心复杂性应对之道》</a> 强调了分层思想在 DDD 中的应用，但<strong>分层架构</strong>概念本身则要早于 DDD，并广泛应用于软件开发实践中。</p>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/LayeredArchitecture.webp" alt="LayeredArchitecture"></p>
<p>常见分层如下：</p>
<ol>
<li><p><strong>用户界面层（User Interface）</strong></p>
<ul>
<li>负责与用户交互，展示信息并接收用户请求。</li>
<li>“用户”可以是人，也可以是其他应用或脚本。交互形式包括 GUI、CLI 或 API。</li>
<li>UI 层仅负责交互，不包含业务逻辑或数据持久化逻辑。</li>
</ul>
</li>
<li><p><strong>应用层（Application Layer）</strong></p>
<ul>
<li>描述系统提供的用例和业务流程，包含用例逻辑、流程控制和业务编排。</li>
<li>主要职责是协调领域对象完成用例，不包含核心业务规则。</li>
<li>可执行操作包括调用微服务、事务管理、权限校验、发送领域事件等。</li>
</ul>
</li>
<li><p><strong>领域层（Domain Layer）</strong></p>
<ul>
<li>核心业务逻辑所在，表达业务概念和规则。</li>
<li>包含聚合根、实体、值对象、领域服务等。</li>
<li>任何业务规则或状态变化都应在此层实现。</li>
</ul>
</li>
<li><p><strong>基础设施层（Infrastructure）</strong></p>
<ul>
<li>提供通用技术服务，如数据库、缓存、消息中间件、外部 API 等。</li>
<li>实现领域层接口，支持持久化和外部通信。</li>
</ul>
</li>
</ol>
<p>实现规则：</p>
<ol>
<li>依赖方向是从<strong>用户界面层（User Interface）</strong>到<strong>基础设施层（Infrastructure）</strong>。</li>
<li>每层只包含自身职责逻辑。</li>
</ol>
<h4 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h4><p>Vaughn Vernon 在 <a target="_blank" rel="noopener" href="https://book.douban.com/subject/25844633/">《实现领域驱动设计》</a> 书中提出了使用 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">依赖倒置原则</a> 改进后的<strong>分层架构</strong>：</p>
<blockquote>
<p>we would have a Repository implemented in Infrastructure for an interface defined in Domain. Focusing on the Domain Layer, using DIP enables both the Domain and Infrastructure to depend on abstractions (interfaces) defined by the domain model.</p>
<p>我们可以在领域层中定义资源库接口，然后在基础设施层中实现该接口。我们将关注点放在领域层上，采用依赖倒置原则，使领域层和基础设施层都只依赖于由领域模型定义的抽象接口。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/LayeredArchitectureWithDIP.webp" alt="LayeredArchitectureWithDIP"></p>
<p>即<strong>领域层定义接口，基础设施层实现接口</strong>，实现了<strong>内层依赖抽象、外层实现抽象</strong>，使核心业务逻辑独立于外部技术，从而增强可测试性和可维护性。</p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p><strong>分层架构</strong>的目标是通过代码组织实现关注点分离，降低复杂性。</p>
<p><strong>分层架构</strong>可以进一步细分为<strong>严格分层架构</strong>和<strong>松散分层架构</strong>。<strong>严格分层架构</strong>不允许跨层访问接口，而<strong>松散分层架构</strong>则允许跨层访问接口。</p>
<h4 id="其他资料-1"><a href="#其他资料-1" class="headerlink" title="其他资料"></a>其他资料</h4><ol>
<li><a target="_blank" rel="noopener" href="https://dzone.com/articles/layered-architecture-is-good">Layered Architecture Is Good</a></li>
<li><a target="_blank" rel="noopener" href="https://herbertograca.com/2017/08/03/layered-architecture/">Layered Architecture</a></li>
</ol>
<h3 id="六边形架构（Hexagonal-Architecture）"><a href="#六边形架构（Hexagonal-Architecture）" class="headerlink" title="六边形架构（Hexagonal Architecture）"></a>六边形架构（Hexagonal Architecture）</h3><p><strong>六边形架构</strong>由 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Alistair_Cockburn">Alistair Cockburn</a> 于 2005 年在其 <a target="_blank" rel="noopener" href="https://web.archive.org/web/20180822100852/http://alistair.cockburn.us/Hexagonal+architecture">个人博客</a> 中提出，其核心思想是<strong>隔离业务逻辑与外部实现</strong>，强调系统核心独立性。</p>
<blockquote>
<p><strong>六边形架构</strong>之所以叫六边形是为了强调内部通过多个<strong>端口</strong>与外部连接，而避免大家像分层架构层层依赖那样一维的去思考。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/HexagonalArchitecture.webp" alt="HexagonalArchitecture"></p>
<p>特点：</p>
<ol>
<li><strong>内部（Core）</strong>：核心业务逻辑（领域层 + 用例层/应用服务层）。</li>
<li><strong>外部（Peripheral）</strong>：外部系统实现（UI、数据库、消息队列等）。</li>
<li><strong>连接方式</strong>：通过 <strong>端口（Ports）</strong> 与 <strong>适配器（Adapters）</strong> 实现内外交互。</li>
<li>核心业务不依赖外部实现，所有外部交互通过<strong>端口</strong>完成。</li>
</ol>
<p>实现规则：</p>
<ol>
<li>核心业务仅依赖抽象接口，不依赖外部实现。</li>
<li>外部实现通过适配器实现接口，不包含业务逻辑。</li>
<li>核心业务可独立测试与部署，支持外部实现替换。</li>
</ol>
<h4 id="其他资料-2"><a href="#其他资料-2" class="headerlink" title="其他资料"></a>其他资料</h4><ol>
<li><a target="_blank" rel="noopener" href="https://dzone.com/articles/hexagonal-architecture-is-powerful">Hexagonal Architecture Is Powerful</a></li>
<li><a target="_blank" rel="noopener" href="https://jmgarridopaz.github.io/content/hexagonalarchitecture.html">Ports and Adapters Pattern (Hexagonal Architecture)</a></li>
<li><a target="_blank" rel="noopener" href="https://herbertograca.com/2017/09/14/ports-adapters-architecture/">Ports &amp; Adapters Architecture</a></li>
</ol>
<h3 id="洋葱架构（Onion-Architecture）"><a href="#洋葱架构（Onion-Architecture）" class="headerlink" title="洋葱架构（Onion Architecture）"></a>洋葱架构（Onion Architecture）</h3><h4 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h4><p><strong>洋葱架构</strong>由 <a target="_blank" rel="noopener" href="https://jeffreypalermo.com/author/jeffreypalermo/">Jeffrey Palermo</a> 于 2008 年在其 <a target="_blank" rel="noopener" href="https://jeffreypalermo.com/2008/07/the-onion-architecture-part-1/">个人博客</a> 中提出。</p>
<p><strong>洋葱架构</strong>并不是一个全新的架构，而是基于<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">依赖倒置原则</a>对传统<strong>分层架构</strong>与<strong>六边形架构</strong>的改进和优化。</p>
<p>它通过明确依赖方向、强化领域核心，帮助系统实现高内聚、低耦合的设计目标。</p>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/OnionArchitecture.webp" alt="OnionArchitecture"></p>
<p>分层结构从内到外依次是：</p>
<ol>
<li><p><strong>领域模型层（Domain Model）</strong></p>
<p> 架构的核心，包含实体（Entity）和值对象（Value Object）等领域模型，封装了业务规则与行为。这一层完全独立，不依赖任何外部组件。</p>
</li>
<li><p><strong>领域服务层（Domain Service）</strong></p>
<p> 封装那些不适合放入单个实体或值对象中的领域逻辑（例如跨实体操作的业务规则）。</p>
<p> 领域服务通常依赖仓储（Repository）接口进行数据访问，但其职责是业务逻辑而非数据持久化。</p>
<p> 仓储接口通常也在领域层中定义，用于抽象数据访问。</p>
</li>
<li><p><strong>应用服务层（Application Service）</strong></p>
<p> 负责协调领域对象完成具体的业务用例。</p>
<p> 它定义事务边界，调用领域模型和领域服务来实现功能，但不包含具体的业务规则。</p>
<p> 应用服务层向外提供统一的接口，供用户界面或外部系统使用。</p>
</li>
<li><p><strong>UI（User Interface）</strong>、<strong>基础设施（Infrastructure）</strong>以及<strong>测试用例（Tests）层</strong></p>
<ul>
<li><strong>UI（User Interface）</strong>：调用应用服务层以响应用户请求并展示结果。</li>
<li><strong>基础设施层（Infrastructure）</strong>：实现领域层定义的仓储接口、消息总线、文件系统等外部资源访问逻辑。</li>
<li><strong>测试（Tests）</strong>：通过调用应用服务层或接口层，验证系统的整体行为。测试本身通常位于架构的最外层。</li>
</ul>
</li>
</ol>
<p>实现规则：</p>
<ol>
<li>应用程序围绕独立的对象模型构建（The application is built around an independent object model）</li>
<li>内层定义接口，外层实现接口（Inner layers define interfaces. Outer layers implement interfaces）</li>
<li>层向中心耦合（Direction of coupling is toward the center）</li>
<li>所有应用程序核心代码都可以与基础设施分开编译和运行（All application core code can be compiled and run separate from infrastructure）</li>
</ol>
<p><strong>洋葱架构</strong>与其他架构之间的区别和联系：</p>
<ol>
<li>在经典<strong>分层架构</strong>中，一个层只能调用其正下方的层。而在<strong>洋葱架构</strong>中，任何外层可以调用任何内层。</li>
<li><strong>洋葱架构</strong>与<strong>六边形架构</strong>在思想上相近，都基于<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">依赖倒置原则</a>，强调领域核心与外部隔离。区别在于，<strong>洋葱架构</strong>通过多层同心结构更清晰地表达依赖关系和分层职责。各层的依赖方向均指向中心的领域模型层。</li>
</ol>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p><strong>洋葱架构</strong>的核心思想是<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">依赖倒置原则</a>的应用和内层不能对外层有直接的依赖。</p>
<h4 id="其他资料-3"><a href="#其他资料-3" class="headerlink" title="其他资料"></a>其他资料</h4><ol>
<li><a target="_blank" rel="noopener" href="https://dzone.com/articles/onion-architecture-is-interesting">Onion Architecture Is Interesting</a></li>
<li><a target="_blank" rel="noopener" href="https://herbertograca.com/2017/09/21/onion-architecture/">Onion Architecture</a></li>
</ol>
<h3 id="整洁架构（Clean-Architecture）"><a href="#整洁架构（Clean-Architecture）" class="headerlink" title="整洁架构（Clean Architecture）"></a>整洁架构（Clean Architecture）</h3><p><strong>整洁架构</strong>由 <a target="_blank" rel="noopener" href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Robert C. Martin</a> 于 2012 年提出，综合和提炼了以下几种架构思想：</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://alistair.cockburn.us/Hexagonal+architecture">Hexagonal Architecture (a.k.a. Ports and Adapters)</a></li>
<li><a target="_blank" rel="noopener" href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/">Onion Architecture</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.cleancoders.com/2011-09-30-Screaming-Architecture">Screaming Architecture</a></li>
<li><a target="_blank" rel="noopener" href="http://www.amazon.com/Lean-Architecture-Agile-Software-Development/dp/0470684208/">DCI</a>, <a target="_blank" rel="noopener" href="https://www.artima.com/articles/the-dci-architecture-a-new-vision-of-object-oriented-programming">The DCI Architecture: A New Vision of Object-Oriented Programming</a></li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.com/Object-Oriented-Software-Engineering-Approach/dp/0201544350">BCE</a></li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/TheCleanArchitectureDiagram.webp" alt="TheCleanArchitectureDiagram"></p>
<p>整洁架构通常由四层同心圆组成（层数可根据项目调整）：</p>
<ol>
<li><p><strong>实体（Entities）</strong></p>
<p> 封装系统范围内最核心、最稳定的业务规则。</p>
<p> 可以是带有方法的对象，也可以是函数集合。</p>
<p> 类似于 DDD 中的”领域模型”，但范围更广，代表整个系统的企业级业务规则。</p>
</li>
<li><p><strong>用例（Use Cases）</strong></p>
<p> 封装应用特定的业务逻辑，实现系统的业务用例场景。</p>
<p> 每个用例应有独立实现，通常以单一职责类或交互器（Interactor）形式体现。</p>
<p> 负责协调实体执行，定义事务边界。</p>
</li>
<li><p><strong>接口适配器（Interface Adapters）</strong></p>
<p> 负责在内层（用例与实体）与外层（UI、数据库、外部系统）之间进行数据转换与适配。</p>
<p> MVC 模式中的 Controller、Presenter、View 通常位于此层。</p>
</li>
<li><p><strong>框架和驱动（Frameworks and Drivers）</strong></p>
<p> 最外层包含数据库、Web 框架、UI 框架、第三方库等。</p>
<p> 这一层主要提供基础设施支持，一般不包含核心业务逻辑。</p>
</li>
</ol>
<p>圆圈之间存在很强的依赖规则：<strong>内层永远不依赖外层，所有通信通过接口进行。</strong> 这与<strong>洋葱架构</strong>和<strong>六边形架构</strong>的依赖方向一致。</p>
<p>除了层之外，Clean Architecture 还提供了一些有关需要实现的类的提示。在架构图的右下角：控制器通过 <strong>输入端口（Input Port）</strong> 调用用例，用例通过 <strong>输出端口（Output Port）</strong> 向演示器返回结果，从而实现 UI 与业务逻辑的完全解耦。</p>
<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h4><p><strong>整洁架构</strong>的核心思想有两点：</p>
<ol>
<li>严格遵守<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">依赖倒置原则</a>。</li>
<li>用例驱动（Use Case Driven）。系统围绕业务用例组织代码。</li>
<li>框架独立（Framework Independence）。业务逻辑不依赖任何具体技术、框架或数据库。</li>
</ol>
<h4 id="其他资料-4"><a href="#其他资料-4" class="headerlink" title="其他资料"></a>其他资料</h4><ol>
<li><a target="_blank" rel="noopener" href="https://dzone.com/articles/dci-architecture-is-visionary">DCI Architecture Is Visionary</a></li>
<li><a target="_blank" rel="noopener" href="https://fulloo.info/">DCI - Data Context Interaction</a></li>
<li><a target="_blank" rel="noopener" href="https://dzone.com/articles/clean-architecture-is-screaming">Clean Architecture Is Screaming</a></li>
<li><a target="_blank" rel="noopener" href="https://youtu.be/Nltqi7ODZTM">Clean Architecture</a></li>
<li><a target="_blank" rel="noopener" href="https://herbertograca.com/2017/09/28/clean-architecture-standing-on-the-shoulders-of-giants/">Clean Architecture: Standing on the shoulders of giants</a></li>
</ol>
<h3 id="几种架构之间的关系"><a href="#几种架构之间的关系" class="headerlink" title="几种架构之间的关系"></a>几种架构之间的关系</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">传统分层架构（Layered）
   ↓ 改进依赖倒置
六边形架构（Hexagonal）
   ↓ 抽象为"内核+适配器"
洋葱架构（Onion）
   ↓ 用例中心化、框架无关
整洁架构（Clean）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li><strong>六边形架构</strong>解决了”应用如何与外界通信”的问题；</li>
<li><strong>洋葱架构</strong>解决了”依赖如何反转，核心如何纯净”的问题；</li>
<li><strong>整洁架构</strong>解决了”系统如何围绕用例组织、框架如何可替换”的问题。</li>
</ol>
<h2 id="一些不错的总结"><a href="#一些不错的总结" class="headerlink" title="一些不错的总结"></a>一些不错的总结</h2><p>摘录自来自：<a target="_blank" rel="noopener" href="https://www.codingblocks.net/podcast/clean-architecture-make-your-architecture-scream/">Clean Architecture - Make Your Architecture Scream</a></p>
<h3 id="Make-Your-Architecture-Scream"><a href="#Make-Your-Architecture-Scream" class="headerlink" title="Make Your Architecture Scream"></a>Make Your Architecture Scream</h3><h4 id="Policy-and-Level"><a href="#Policy-and-Level" class="headerlink" title="Policy and Level"></a>Policy and Level</h4><ul>
<li>A computer program is a statement of policy - known inputs and expected outputs</li>
<li>Most systems have many statements of separate policies<br>  -Business rules, formatting, ETL, etc</li>
<li>Policies that change for the same reasons should be grouped into the same components and vice versa</li>
<li>Goal is to create acyclic dependency graphs where items with similar policies are at the same level, and dependencies are at the edges<ul>
<li>Direction of dependencies is based on the level of components they connect<ul>
<li>Level is the distance from the inputs and outputs</li>
<li>The further the policy is from the inputs and outputs, the higher the level</li>
</ul>
</li>
</ul>
</li>
<li>Data flows and source code dependencies do not always point in the same direction<ul>
<li>Dependencies should be decoupled from data flow but coupled to the level</li>
</ul>
</li>
<li>The importance of this is the fact that the higher level components are now reusable with different input and output sources</li>
<li>Policies that change for the same reason or at the same time are bounded by the SRP or CCP<ul>
<li>Higher level components typically change less frequently than the lower level components</li>
<li>Lower level components (those that change frequently) should be plugins to the higher level components</li>
</ul>
</li>
</ul>
<h4 id="Business-Rules"><a href="#Business-Rules" class="headerlink" title="Business Rules"></a>Business Rules</h4><ul>
<li>“Business rules are rules or procedures that make or save the business money” (whether or not they were implemented on a computer)</li>
<li>Critical business rules - rules critical to the business itself, with or without a computer, for example, calculating interest on a loan.</li>
<li>Critical business data - critical data that would exist even if there wasn’t an automated system.</li>
<li>Critical business rules and data are tightly bound and therefore a good space for an object, also called…</li>
</ul>
<h5 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h5><ul>
<li>An object that contains critical business rules and critical business data</li>
<li>These should be separated from every other concern in the application<ul>
<li>No dependencies on databases, 3rd party dependencies, user interfaces, etc.</li>
</ul>
</li>
<li>These objects are pure business.</li>
</ul>
<h5 id="Use-Cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases</h5><ul>
<li>There are additional business rules that are not “critical” - they define how the automated system should work, but would have no impact on a manual business operation</li>
<li>Use case - description of how an automated system is to be used<ul>
<li>These indicate how and when a critical business entity should be invoked</li>
<li>These also indicate the inputs and outputs but not where they come from (database, UI, etc.)<ul>
<li>The how of data gets in and out is irrelevant to the use case</li>
</ul>
</li>
</ul>
</li>
<li>Entities have no knowledge of how use cases use them<ul>
<li>Follows the Dependency Inversion Principle - higher level components know nothing of the lower level components - the direction is inverted</li>
</ul>
</li>
<li>Use cases are specific to a single application</li>
<li>Entities are generalizations</li>
</ul>
<h5 id="Request-and-Response-Models"><a href="#Request-and-Response-Models" class="headerlink" title="Request and Response Models"></a>Request and Response Models</h5><ul>
<li>Use cases accept simple request objects for input and return simple response objects for outputs<ul>
<li>They SHOULD NOT depend on any frameworks or other dependencies - simple objects</li>
<li>Seems like a good idea to return a reference to an entity object - do NOT do this<ul>
<li>Entity objects are higher level components that will change for different reasons so stick to the simple request / response objects</li>
<li>Coupling them together violates the Common Closer and Single Responsibility Principles</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="So-Business-Rules-…"><a href="#So-Business-Rules-…" class="headerlink" title="So, Business Rules …"></a>So, Business Rules …</h5><ul>
<li>“Business rules are the reason a software system exists”</li>
<li>Should remain pristine</li>
<li>Are independent and reusable</li>
</ul>
<h4 id="Screaming-Architecture"><a href="#Screaming-Architecture" class="headerlink" title="Screaming Architecture"></a>Screaming Architecture</h4><ul>
<li>Upon initial inspection, does your application structure scream Spring, or does it scream Healthcare software?</li>
<li>Architecture should scream the use cases of the application, not the frameworks or dependencies in the application</li>
<li>“If your architecture is based on frameworks, then it cannot be based on your use cases”</li>
<li>A house’s architecture is focused on usability, not whether the house is built of bricks or stucco<ul>
<li>Again, going back to deferring decisions like that until further down the road</li>
</ul>
</li>
<li>The “web” is a delivery mechanism - it’s your IO layer - much like a mobile app, desktop application or any other</li>
</ul>
<h4 id="The-Theme-and-Purpose"><a href="#The-Theme-and-Purpose" class="headerlink" title="The Theme and Purpose"></a>The Theme and Purpose</h4><ul>
<li>The architecture is all about structures that support the use cases of the application</li>
<li>Architecture is not a framework nor is it supplied by a framework.</li>
<li>Good architecture allows you to defer and delay decisions as well as make it easy to change your mind about those decisions.</li>
</ul>
<h4 id="Frameworks-are-Tools-NOT-Ways-of-Life"><a href="#Frameworks-are-Tools-NOT-Ways-of-Life" class="headerlink" title="Frameworks are Tools, NOT Ways of Life"></a>Frameworks are Tools, NOT Ways of Life</h4><ul>
<li>Look at frameworks with skepticism - you don’t want to adopt the be all end all position<ul>
<li>They should NOT dictate your application architecture</li>
</ul>
</li>
<li>How should you use it?</li>
<li>How should you protect yourself from it?</li>
</ul>
<h4 id="Testable-Architectures"><a href="#Testable-Architectures" class="headerlink" title="Testable Architectures"></a>Testable Architectures</h4><ul>
<li>If you’ve done your job right, then unit testing should be easy to do as everything was decoupled properly<ul>
<li>Entity objects will be plain old objects with no external dependencies</li>
<li>Use case objects will coordinate the use of entity objects, again with no infrastructure dependencies</li>
</ul>
</li>
</ul>
<h4 id="Does-your-Architecture-Scream"><a href="#Does-your-Architecture-Scream" class="headerlink" title="Does your Architecture Scream?"></a>Does your Architecture Scream?</h4><ul>
<li>Your architecture should quickly identify the purpose of your system.</li>
</ul>
<p>They: “<em>We see some things that look like models - where are the views and controllers?</em>“</p>
<p>You: “<em>Oh, those are details that needn’t concern us at the moment. We’ll decide about them later.</em>“</p>
<h3 id="The-Clean-Architecture"><a href="#The-Clean-Architecture" class="headerlink" title="The Clean Architecture"></a>The Clean Architecture</h3><p>Uncle Bob’s version of the Clean Architecture diagram:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/TheCleanArchitectureDiagram.webp" alt="TheCleanArchitectureDiagram"></p>
<p>Our re-imagining of it as a cone:</p>
<p><img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/images/领域驱动设计相关的软件架构/The-Clean-Architecture-Cone.webp" alt="The-Clean-Architecture-Cone"></p>
<ul>
<li>It’s really about the Separation of Concerns<ul>
<li>Dividing software into layers</li>
</ul>
</li>
<li>Should be independent of frameworks</li>
<li>They should be testable</li>
<li>They should be independent of a UI</li>
<li>They should be independent of a database</li>
<li>They should be independent of interfaces to 3rd party dependencies</li>
<li>The Clean Architecture Diagram<ul>
<li>Innermost: “Enterprise / Critical Business Rules” - Entities</li>
<li>Next out: “Application business rules” - Use Cases</li>
<li>Next out: “Interface adapters” - Gateways, Controllers, Presenters</li>
<li>Outer: “Frameworks and drivers” - Devices, Web, UI, External Interfaces, DB</li>
</ul>
</li>
<li>Moving inward, the level of abstraction and policy increase</li>
<li>The innermost circle is the most general/highest level</li>
<li>Inner circles are policies</li>
<li>Outer circles are mechanisms</li>
<li>Inner circles cannot depend on outer circles</li>
<li>Outer circles cannot influence inner circles</li>
</ul>
<h4 id="Entities"><a href="#Entities" class="headerlink" title="Entities"></a>Entities</h4><ul>
<li>Entities should be usable by many applications (critical business rules) and should not be impacted by anything other than a change to the critical business rule itself</li>
<li>They encapsulate the most general/high-level rules.</li>
</ul>
<h4 id="Use-Cases-1"><a href="#Use-Cases-1" class="headerlink" title="Use Cases"></a>Use Cases</h4><ul>
<li>Use cases are application specific business rules<ul>
<li>Changes should not impact the Entities</li>
<li>Changes should not be impacted by infrastructure such as a database</li>
</ul>
</li>
<li>The use cases orchestrate the flow of data in/out of the Entities and direct the Entities to use their Critical Business Rules to achieve the use case</li>
</ul>
<h4 id="Interface-Adapters"><a href="#Interface-Adapters" class="headerlink" title="Interface Adapters"></a>Interface Adapters</h4><ul>
<li>Converts data from data layers to use case or entity layers<ul>
<li>Presenters, views and controllers all belong here</li>
</ul>
</li>
<li>No code further in (use cases, entities) should have any knowledge of the db</li>
</ul>
<h4 id="Frameworks-and-Drivers"><a href="#Frameworks-and-Drivers" class="headerlink" title="Frameworks and Drivers"></a>Frameworks and Drivers</h4><ul>
<li>These are the glue that hook the various layers up</li>
<li>The infrastructure details live here</li>
<li>You’re not writing much of this code, i.e. we use SQL Server, but we don’t write it.</li>
</ul>
<h4 id="Crossing-Boundaries"><a href="#Crossing-Boundaries" class="headerlink" title="Crossing Boundaries"></a>Crossing Boundaries</h4><ul>
<li>Flow of control went from the controller, through the application use case, then to the presenter</li>
<li>Source code dependencies point in towards the use cases</li>
<li>Dependency Inversion Principle<ul>
<li>Use case needs to call a presenter - doing so would violate the dependency rule - inner circles cannot call (or know about) outer circles….<ul>
<li>The use case would need to call an interface<ul>
<li>The implementation of that interface would be provided by the interface adapter layer - this is how the dependency is inverted<ul>
<li>This same type of inversion of control is used all throughout the architecture to invert the flow of control</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Data-Crossing-Boundaries"><a href="#Data-Crossing-Boundaries" class="headerlink" title="Data Crossing Boundaries"></a>Data Crossing Boundaries</h4><ul>
<li>Typically data crossing the boundaries consist of simple data structures</li>
<li>DO NOT PASS ENTITY OBJECTS OR DATA ROWS!<ul>
<li>This would violate the dependency rules</li>
</ul>
</li>
<li>Data is passed in the format that is most convenient to the inner circle / layer</li>
<li>These are isolated, simple data structures<ul>
<li>Meaning our DTOs needed to cross the boundaries should belong in the inner circle, or at least their definition (interface, abstract class)</li>
</ul>
</li>
</ul>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><ul>
<li>Conforming to the rules is not difficult (but requires work) and will set you up to be able to plug and play pieces in the future</li>
</ul>
<h2 id="其他常见的术语"><a href="#其他常见的术语" class="headerlink" title="其他常见的术语"></a>其他常见的术语</h2><ol>
<li><p>阻抗失衡（Impedance Mismatch）</p>
<p> <a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/impedance-mismatch-in-dbms/">Impedance Mismatch in DBMS</a></p>
<blockquote>
<p>Impedance mismatch is a term used in computer science to describe the problem that arises when two systems or components that are supposed to work together have different data models, structures, or interfaces that make communication difficult or inefficient.</p>
<p>In the context of databases, impedance mismatch refers to the discrepancy between the object-oriented programming (OOP) model used in application code and the relational model used in database management systems (DBMS). While OOP models are designed to represent data as objects with properties and methods, relational models represent data as tables with columns and rows.</p>
</blockquote>
</li>
</ol>
<h2 id="其他资料-5"><a href="#其他资料-5" class="headerlink" title="其他资料"></a>其他资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.domainlanguage.com/wp-content/uploads/2016/05/DDD_Reference_2015-03.pdf">Domain-Driven Design Reference</a>, <a target="_blank" rel="noopener" href="https://github.com/zhongjinggz/ddd-reference-cn">“Domain-Driven Design Reference” 中文版</a></li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://kibazen.cn" rel="external nofollow noreferrer">Kiba Amor</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                    </span>
                <span class="reprint-info">
                    <a href="https://kibazen.cn/ling-yu-qu-dong-she-ji-xiang-guan-de-ruan-jian-jia-gou/">https://kibazen.cn/ling-yu-qu-dong-she-ji-xiang-guan-de-ruan-jian-jia-gou/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-ND 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://kibazen.cn" target="_blank">Kiba Amor</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/">
                                    <span class="chip bg-color">领域驱动设计</span>
                                </a>
                            
                                <a href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/">
                                    <span class="chip bg-color">软件架构</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/share/css/share.min.css">
<div id="article-share">

    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/yun-yuan-sheng-xun-lian-ying-xue-xi-bi-ji/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/featureimages/7.jpg" class="responsive-img" alt="《云原生训练营》学习笔记">
                        
                        <span class="card-title">《云原生训练营》学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-03-16
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/">
                        <span class="chip bg-color">极客时间</span>
                    </a>
                    
                    <a href="/tags/kubernetes/">
                        <span class="chip bg-color">kubernetes</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/ddd-shi-zhan-ke-xue-xi-bi-ji/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/medias/featureimages/23.jpg" class="responsive-img" alt="《DDD实战课》学习笔记">
                        
                        <span class="card-title">《DDD实战课》学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-09-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-category">
                                    学习笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/">
                        <span class="chip bg-color">领域驱动设计</span>
                    </a>
                    
                    <a href="/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/">
                        <span class="chip bg-color">极客时间</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">Kiba Amor</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/kibaamor" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:5093911+kibaamor@users.noreply.github.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

    
    

    

    

	
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/kibaamor/kibaamor.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
