<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="dong-shou-xue-shen-du-xue-xi-di-er-ban-du-shu-bi-ji/"/>
      <url>dong-shou-xue-shen-du-xue-xi-di-er-ban-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="1-KæŠ˜äº¤å‰éªŒè¯"><a href="#1-KæŠ˜äº¤å‰éªŒè¯" class="headerlink" title="1. KæŠ˜äº¤å‰éªŒè¯"></a>1. <a href="https://zh-v2.d2l.ai/chapter_multilayer-perceptrons/underfit-overfit.html#k">KæŠ˜äº¤å‰éªŒè¯</a></h2><h3 id="1-1-KæŠ˜äº¤å‰éªŒè¯åŸç†"><a href="#1-1-KæŠ˜äº¤å‰éªŒè¯åŸç†" class="headerlink" title="1.1 KæŠ˜äº¤å‰éªŒè¯åŸç†"></a>1.1 KæŠ˜äº¤å‰éªŒè¯åŸç†</h3><p>åŸå§‹è®­ç»ƒæ•°æ®è¢«åˆ†æˆ $ğ¾$ ä¸ªä¸é‡å çš„å­é›†ã€‚ç„¶åæ‰§è¡Œ $ğ¾$ æ¬¡æ¨¡å‹è®­ç»ƒå’ŒéªŒè¯ï¼Œæ¯æ¬¡åœ¨ $ğ¾âˆ’1$ ä¸ªå­é›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå¹¶åœ¨å‰©ä½™çš„ä¸€ä¸ªå­é›†ï¼ˆåœ¨è¯¥è½®ä¸­æ²¡æœ‰ç”¨äºè®­ç»ƒçš„å­é›†ï¼‰ä¸Šè¿›è¡ŒéªŒè¯ã€‚æœ€åï¼Œé€šè¿‡å¯¹ $ğ¾$ æ¬¡å®éªŒçš„ç»“æœå–å¹³å‡æ¥ä¼°è®¡è®­ç»ƒå’ŒéªŒè¯è¯¯å·®ã€‚</p><h3 id="1-2-ä½¿ç”¨KæŠ˜äº¤å‰éªŒè¯"><a href="#1-2-ä½¿ç”¨KæŠ˜äº¤å‰éªŒè¯" class="headerlink" title="1.2 ä½¿ç”¨KæŠ˜äº¤å‰éªŒè¯"></a>1.2 ä½¿ç”¨KæŠ˜äº¤å‰éªŒè¯</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> torch<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataset <span class="token keyword">import</span> Subset<span class="token keyword">def</span> <span class="token function">cross_valid</span><span class="token punctuation">(</span>k_fold<span class="token punctuation">,</span> model<span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>    kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span>k_fold<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> train_indices<span class="token punctuation">,</span> test_indices <span class="token keyword">in</span> kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>        train_dataset <span class="token operator">=</span> Subset<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> train_indices<span class="token punctuation">)</span>        test_dataset <span class="token operator">=</span> Subset<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> test_indices<span class="token punctuation">)</span>        train_losses<span class="token punctuation">,</span> test_losses <span class="token operator">=</span> train<span class="token punctuation">(</span>            model<span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> train_dataset<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> test_dataset<span class="token operator">=</span>test_dataset        <span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train loss"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>train_losses<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"test loss"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>test_losses<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> test_dataset<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    train_losses<span class="token punctuation">,</span> test_losses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> drop_last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>        model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> features<span class="token punctuation">,</span> labels <span class="token keyword">in</span> dataloader<span class="token punctuation">:</span>            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>model<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">)</span>            loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>        model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            train_loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>model<span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            train_losses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> test_dataset<span class="token punctuation">:</span>                test_loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>model<span class="token punctuation">(</span>test_dataset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_dataset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                test_losses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>test_loss<span class="token punctuation">)</span>    <span class="token keyword">return</span> train_losses<span class="token punctuation">,</span> test_losses<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®Œæ•´ä»£ç ï¼š<a href="/images/ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹è¯»ä¹¦ç¬”è®°/kaggle.py">kaggle.py</a></p><h2 id="2-Dropout"><a href="#2-Dropout" class="headerlink" title="2. Dropout"></a>2. <a href="https://zh-v2.d2l.ai/chapter_multilayer-perceptrons/dropout.html">Dropout</a></h2><h3 id="2-1-DropoutåŸç†"><a href="#2-1-DropoutåŸç†" class="headerlink" title="2.1 DropoutåŸç†"></a>2.1 DropoutåŸç†</h3><p>åœ¨è®­ç»ƒè¿‡ç¨‹çš„æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œdropout åœ¨è®¡ç®—ä¸‹ä¸€å±‚ä¹‹å‰å°†å½“å‰å±‚ä¸­çš„ä¸€äº›èŠ‚ç‚¹ç½®é›¶ã€‚</p><p>dropout çš„ä½œè€…è®¤ä¸ºï¼Œç¥ç»ç½‘ç»œè¿‡æ‹Ÿåˆçš„ç‰¹å¾æ˜¯æ¯ä¸€å±‚éƒ½ä¾èµ–äºå‰ä¸€å±‚æ¿€æ´»å€¼çš„ç‰¹å®šæ¨¡å¼ï¼Œç§°è¿™ç§æƒ…å†µä¸ºâ€œå…±é€‚åº”æ€§â€ã€‚dropout ä¼šç ´åå…±é€‚åº”æ€§ã€‚</p><p>å…³é”®çš„æŒ‘æˆ˜å°±æ˜¯å¦‚ä½•æ³¨å…¥è¿™ç§å™ªå£°ã€‚ä¸€ç§æƒ³æ³•æ˜¯ä»¥ä¸€ç§æ— åçš„æ–¹å¼æ³¨å…¥å™ªå£°ã€‚è¿™æ ·åœ¨å›ºå®šä½å…¶ä»–å±‚æ—¶ï¼Œæ¯ä¸€å±‚çš„æœŸæœ›å€¼ç­‰äºæ²¡æœ‰å™ªéŸ³æ—¶çš„å€¼ã€‚</p><p>åœ¨æ¯•æ™“æ™®çš„å·¥ä½œä¸­ï¼Œä»–å°†é«˜æ–¯å™ªå£°æ·»åŠ åˆ°çº¿æ€§æ¨¡å‹çš„è¾“å…¥ä¸­ã€‚åœ¨æ¯æ¬¡è®­ç»ƒè¿­ä»£ä¸­ï¼Œä»–å°†ä»å‡å€¼ä¸ºé›¶çš„åˆ†å¸ƒ $\epsilon \sim \mathcal{N}(0,\sigma^2)$ é‡‡æ ·å™ªå£°æ·»åŠ åˆ°è¾“å…¥ $\mathbf{x}$ ï¼Œä»è€Œäº§ç”Ÿæ‰°åŠ¨ç‚¹ $\mathbf{x}â€™ = \mathbf{x} + \epsilon$ ã€‚é¢„æœŸæ˜¯ $E[\mathbf{x}â€™] = \mathbf{x}$ ã€‚</p><p>åœ¨æ ‡å‡† dropout æ­£åˆ™åŒ–ä¸­ï¼Œé€šè¿‡æŒ‰ä¿ç•™ï¼ˆæœªä¸¢å¼ƒï¼‰çš„èŠ‚ç‚¹çš„åˆ†æ•°è¿›è¡Œå½’ä¸€åŒ–æ¥æ¶ˆé™¤æ¯ä¸€å±‚çš„åå·®ã€‚æ¢è¨€ä¹‹ï¼Œæ¯ä¸ªä¸­é—´æ¿€æ´»å€¼ $h$ ä»¥ <em>ä¸¢å¼ƒæ¦‚ç‡</em> $p$ ç”±éšæœºå˜é‡ $hâ€™$ æ›¿æ¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><script type="math/tex; mode=display">\begin{aligned}h' =\begin{cases}    0 & \text{ æ¦‚ç‡ä¸º } p \\    \frac{h}{1-p} & \text{ å…¶ä»–æƒ…å†µ}\end{cases}\end{aligned}</script><p>æ ¹æ®è®¾è®¡ï¼ŒæœŸæœ›å€¼ä¿æŒä¸å˜ï¼Œå³ $E[hâ€™] = h$ ã€‚</p><h3 id="2-2-å®ç°Dropout"><a href="#2-2-å®ç°Dropout" class="headerlink" title="2.2 å®ç°Dropout"></a>2.2 å®ç°Dropout</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">dropout_layer</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">assert</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> dropout <span class="token operator">&lt;=</span> <span class="token number">1</span>    <span class="token comment"># åœ¨æœ¬æƒ…å†µä¸­ï¼Œæ‰€æœ‰å…ƒç´ éƒ½è¢«ä¸¢å¼ƒã€‚</span>    <span class="token keyword">if</span> dropout <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>X<span class="token punctuation">)</span>    <span class="token comment"># åœ¨æœ¬æƒ…å†µä¸­ï¼Œæ‰€æœ‰å…ƒç´ éƒ½è¢«ä¿ç•™ã€‚</span>    <span class="token keyword">if</span> dropout <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> X    mask <span class="token operator">=</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> dropout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> mask <span class="token operator">*</span> X <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> dropout<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Net</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_inputs<span class="token punctuation">,</span> num_outputs<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> num_outputs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> dropout    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        H1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>            H1 <span class="token operator">=</span> dropout_layer<span class="token punctuation">(</span>H1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>H1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-Xavieråˆå§‹åŒ–"><a href="#3-Xavieråˆå§‹åŒ–" class="headerlink" title="3. Xavieråˆå§‹åŒ–"></a>3. <a href="https://zh-v2.d2l.ai/chapter_multilayer-perceptrons/numerical-stability-and-init.html#xavier">Xavieråˆå§‹åŒ–</a></h2><h3 id="3-1-Xavierçš„åŸç†"><a href="#3-1-Xavierçš„åŸç†" class="headerlink" title="3.1 Xavierçš„åŸç†"></a>3.1 Xavierçš„åŸç†</h3><p>å¯¹äº <em>æ²¡æœ‰éçº¿æ€§</em> çš„å…¨è¿æ¥å±‚è¾“å‡ºï¼Œè¯¥å±‚ $n_\mathrm{in}$ è¾“å…¥ $x_j$ åŠå…¶ç›¸å…³æƒé‡ $w_{ij}$ ï¼Œå…¶è¾“å‡ºç”±ä¸‹å¼ç»™å‡º</p><script type="math/tex; mode=display">o_{i} = \sum_{j=1}^{n_\mathrm{in}} w_{ij} x_j</script><p>æƒé‡ $w_{ij}$ éƒ½æ˜¯ä»åŒä¸€åˆ†å¸ƒä¸­ç‹¬ç«‹æŠ½å–çš„ã€‚å‡è®¾è¯¥åˆ†å¸ƒå…·æœ‰é›¶å‡å€¼å’Œæ–¹å·® $\sigma^2$ ã€‚æ³¨æ„ï¼Œè¿™å¹¶ä¸æ„å‘³ç€åˆ†å¸ƒå¿…é¡»æ˜¯é«˜æ–¯çš„ï¼Œåªæ˜¯å‡å€¼å’Œæ–¹å·®éœ€è¦å­˜åœ¨ã€‚</p><p>åŒæ—¶ï¼Œå‡è®¾å±‚ $x_j$ çš„è¾“å…¥ä¹Ÿå…·æœ‰é›¶å‡å€¼å’Œæ–¹å·® $\gamma^2$ ï¼ˆ<strong>å› ä¸ºå¯¹äºè®­ç»ƒæ•°æ®ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šåšå½’ä¸€åŒ–</strong>ï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬ç‹¬ç«‹äº $w_{ij}$ å¹¶ä¸”å½¼æ­¤ç‹¬ç«‹ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¡ç®— $o_i$ çš„å¹³å‡å€¼å’Œæ–¹å·®ï¼š</p><script type="math/tex; mode=display">\begin{aligned}E[o_i]& = \sum_{j=1}^{n_\mathrm{in}} E[w_{ij} x_j] \\& = \sum_{j=1}^{n_\mathrm{in}} E[w_{ij}] E[x_j] \\& = 0 \\\\\mathrm{Var}[o_i]& = E[o_i^2] - (E[o_i])^2 \\& = \sum_{j=1}^{n_\mathrm{in}} E[w^2_{ij} x^2_j] - 0 \\& = \sum_{j=1}^{n_\mathrm{in}} E[w^2_{ij}] E[x^2_j] \\& = n_\mathrm{in} \sigma^2 \gamma^2\end{aligned}</script><p>ä¸ºäº†é¿å…æ¢¯åº¦çˆ†ç‚¸ï¼Œæ‰€ä»¥éœ€è¦ä¿æŒè¾“å‡ºæ–¹å·® $n_\mathrm{in} \sigma^2 \gamma^2$ ä¸è¾“å…¥æ–¹å·® $\gamma^2$ ä¸å˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯è®¾ç½® $n_\mathrm{in} \sigma^2 = 1$ ã€‚åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ï¼Œæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œå°½ç®¡æ¢¯åº¦æ˜¯ä»æ›´é è¿‘è¾“å‡ºçš„å±‚ä¼ æ’­çš„ã€‚ä¸æ­£å‘ä¼ æ’­ç±»ä¼¼ï¼Œé™¤é $n_\mathrm{out} \sigma^2 = 1$ ï¼Œå¦åˆ™æ¢¯åº¦çš„æ–¹å·®å¯èƒ½ä¼šå¢å¤§ï¼Œå…¶ä¸­ $n_\mathrm{out}$ æ˜¯è¯¥å±‚çš„è¾“å‡ºçš„æ•°é‡ã€‚</p><p>æˆ‘ä»¬ä¸å¯èƒ½åŒæ—¶æ»¡è¶³ $n_\mathrm{in} \sigma^2 = 1$ å’Œ $n_\mathrm{out} \sigma^2 = 1$ è¿™ä¸¤ä¸ªæ¡ä»¶ã€‚ç›¸åï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼š</p><script type="math/tex; mode=display">\begin{aligned}\frac{1}{2} (n_\mathrm{in} + n_\mathrm{out}) \sigma^2 = 1 \text{ æˆ–ç­‰ä»·äº }\sigma = \sqrt{\frac{2}{n_\mathrm{in} + n_\mathrm{out}}}\end{aligned}</script><p>è¿™å°±æ˜¯ <em>Xavieråˆå§‹åŒ–</em> çš„åŸºç¡€ï¼Œé€šå¸¸ï¼ŒXavier åˆå§‹åŒ–ä»å‡å€¼ä¸ºé›¶ï¼Œæ–¹å·® $\sigma^2 = \frac{2}{n_\mathrm{in} + n_\mathrm{out}}$ çš„é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·æƒé‡ã€‚</p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨ Xavier çš„ç›´è§‰æ¥é€‰æ‹©ä»å‡åŒ€åˆ†å¸ƒä¸­æŠ½å–æƒé‡æ—¶çš„æ–¹å·®ã€‚æ³¨æ„ï¼Œå…¬å¼æœ‰å¯¹äºå‡åŒ€åˆ†å¸ƒ $U(-a, a)$ å…¶æ–¹å·®ä¸º $\frac{a^2}{3}$ ã€‚å°† $\frac{a^2}{3}$ ä»£å…¥åˆ° $\sigma^2$ çš„æ¡ä»¶ä¸­ï¼Œå¾—åˆ°ï¼š</p><script type="math/tex; mode=display">U\left(-\sqrt{\frac{6}{n_\mathrm{in} + n_\mathrm{out}}}, \sqrt{\frac{6}{n_\mathrm{in} + n_\mathrm{out}}}\right)</script><p>å°½ç®¡ä¸Šè¿°æ•°å­¦æ¨ç†ä¸­ï¼Œä¸å­˜åœ¨éçº¿æ€§çš„å‡è®¾åœ¨ç¥ç»ç½‘ç»œä¸­å¾ˆå®¹æ˜“è¢«è¿åï¼Œä½† Xavier åˆå§‹åŒ–æ–¹æ³•åœ¨å®è·µä¸­è¢«è¯æ˜æ˜¯æœ‰æ•ˆçš„ã€‚</p><h3 id="3-2-åº”ç”¨åˆ°çº¿æ€§æ¿€æ´»å‡½æ•°"><a href="#3-2-åº”ç”¨åˆ°çº¿æ€§æ¿€æ´»å‡½æ•°" class="headerlink" title="3.2 åº”ç”¨åˆ°çº¿æ€§æ¿€æ´»å‡½æ•°"></a>3.2 åº”ç”¨åˆ°çº¿æ€§æ¿€æ´»å‡½æ•°</h3><p><a href="https://www.bilibili.com/video/BV1u64y1i75a?p=2">æ•°å€¼ç¨³å®šæ€§ + æ¨¡å‹åˆå§‹åŒ–å’Œæ¿€æ´»å‡½æ•°ã€åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ v2ã€‘</a></p><p>å¯¹äº <strong>çº¿æ€§æ¿€æ´»å‡½æ•°</strong> $\sigma(x) = \alpha x + \beta$ ï¼Œå‡è®¾å…¶è¾“å…¥ $x$ å…·æœ‰é›¶å‡å€¼å’Œæ–¹å·® $\alpha^2$ã€‚</p><p>æ¿€æ´»å‡½æ•°è¾“å‡º $o_i$ çš„å‡å€¼ï¼š</p><script type="math/tex; mode=display">E[o_i] = E[\alpha x_i + \beta] = \beta</script><p>ä¸ºäº†ä¿æŒè¾“å‡ºå‡å€¼ä¸å˜ï¼Œåˆ™ $\beta$ åº”å½“ç­‰äº 0ï¼Œå³ $\beta = 0$ ã€‚</p><p>æ¿€æ´»å‡½æ•°è¾“å‡º $o_i$ çš„æ–¹å·®ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathrm{Var}[o_i]& = E[o_i^2] - E[o_i]^2 \\& = E[(\alpha x_i + \beta)^2] - \beta^2 \\& = E[\alpha^2 x_i^2 + 2 \alpha \beta x_i + \beta^2] - \beta^2 \\& = \alpha^2 \mathrm{Var}[x_i]\end{aligned}</script><p>ä¸ºäº†ä¿æŒè¾“å‡ºæ–¹å·®ä¾ç„¶ä¸º $\alpha^2$ ï¼Œåˆ™ $\alpha^2 \mathrm{Var}[x_i]$ åº”å½“ç­‰äº $\mathrm{Var}[x_i]$ ï¼Œå³ $\alpha = 1$ ã€‚</p><p>åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ï¼Œç»“è®ºä¾ç„¶æ˜¯ä¸€æ ·çš„ï¼Œå³ $\beta = 0$ å’Œ $\alpha = 1$ ã€‚</p><p>ç»¼ä¸Šï¼Œå¦‚æœæƒ³è¦è®©æ¿€æ´»å‡½æ•°ä¸æ”¹å˜è¾“å…¥è¾“å‡ºæ•°æ®çš„å‡å€¼å’Œæ–¹å·®çš„è¯ï¼Œéœ€è¦ $\beta = 0$ å’Œ $\alpha = 1$ ï¼Œå³æ¿€æ´»å‡½æ•°éœ€è¦è®©è¾“å‡ºæ•°æ®ç­‰äºè¾“å…¥æ•°æ® $f(x) = x$ã€‚</p><h3 id="3-3-å¸¸ç”¨æ¿€æ´»å‡½æ•°çš„æ€§è´¨"><a href="#3-3-å¸¸ç”¨æ¿€æ´»å‡½æ•°çš„æ€§è´¨" class="headerlink" title="3.3 å¸¸ç”¨æ¿€æ´»å‡½æ•°çš„æ€§è´¨"></a>3.3 å¸¸ç”¨æ¿€æ´»å‡½æ•°çš„æ€§è´¨</h3><p><img src="/images/ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹è¯»ä¹¦ç¬”è®°/å¸¸ç”¨æ¿€æ´»å‡½æ•°çš„æ›²çº¿.png" alt="å¸¸ç”¨æ¿€æ´»å‡½æ•°çš„æ›²çº¿"></p><p>å¯¹äºå¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ä½¿ç”¨æ³°å‹’å±•å¼€ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathrm{sigmoid}(x) &= \frac{1}{2} + \frac{x}{4} - \frac{x^3}{48} + O(x^5) \\\mathrm{tanh}(x) &= 0 + x - \frac{x^3}{3} + O(x^5) \\\mathrm{relu}(x) &= 0 + x \text{ for } \ge 0 \\\end{aligned}</script><p>å¯ä»¥å‘ç°ï¼Œåœ¨é›¶ç‚¹é™„è¿‘ï¼ˆç¥ç»ç½‘ç»œçš„å€¼é€šå¸¸ä¹Ÿåœ¨é›¶ç‚¹é™„è¿‘ï¼‰ï¼Œ $\mathrm{tanh}(x)$ å’Œ $\mathrm{relu}(x)$ éƒ½æ˜¯è¿‘ä¼¼äº $f(x) = x$ è¿™æ ·çš„å‡½æ•°ã€‚ä½†æ˜¯ $\mathrm{sigmoid}(x)$ å´ä¸æ˜¯çš„ã€‚æ‰€ä»¥å¯ä»¥è°ƒæ•´ sigmoid å‡½æ•°æ¥æ»¡è¶³éœ€æ±‚ï¼š</p><script type="math/tex; mode=display">4 \times \mathrm{sigmoid}(x) - 2</script><h2 id="4-å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#4-å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="4. å·ç§¯ç¥ç»ç½‘ç»œ"></a>4. å·ç§¯ç¥ç»ç½‘ç»œ</h2><h3 id="4-1-åŸºæœ¬çš„å·ç§¯è¿ç®—"><a href="#4-1-åŸºæœ¬çš„å·ç§¯è¿ç®—" class="headerlink" title="4.1 åŸºæœ¬çš„å·ç§¯è¿ç®—"></a>4.1 åŸºæœ¬çš„å·ç§¯è¿ç®—</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">corr2d</span><span class="token punctuation">(</span>X<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> K<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    &gt;&gt;&gt; X = torch.tensor([[0.0, 1.0, 2.0],    ...                   [3.0, 4.0, 5.0],    ...                   [6.0, 7.0, 8.0]])    &gt;&gt;&gt; K = torch.tensor([[0.0, 1.0],    ...                   [2.0, 3.0]])    &gt;&gt;&gt; corr2d(X, K)    tensor([[19., 25.],            [37., 43.]])    """</span>    h<span class="token punctuation">,</span> w <span class="token operator">=</span> K<span class="token punctuation">.</span>shape    Y <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> h <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>Y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>Y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            Y<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>X<span class="token punctuation">[</span>i <span class="token punctuation">:</span> i <span class="token operator">+</span> h<span class="token punctuation">,</span> j <span class="token punctuation">:</span> j <span class="token operator">+</span> w<span class="token punctuation">]</span> <span class="token operator">*</span> K<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> Y<span class="token keyword">class</span> <span class="token class-name">Conv2D</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> kernel_size<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>kernel_size<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bias <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> corr2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>weight<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>bias<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-å¤šé€šé“è¾“å…¥çš„å·ç§¯è¿ç®—"><a href="#4-2-å¤šé€šé“è¾“å…¥çš„å·ç§¯è¿ç®—" class="headerlink" title="4.2 å¤šé€šé“è¾“å…¥çš„å·ç§¯è¿ç®—"></a>4.2 å¤šé€šé“è¾“å…¥çš„å·ç§¯è¿ç®—</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">corr2d_multi_in</span><span class="token punctuation">(</span>X<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> K<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    &gt;&gt;&gt; X = torch.tensor([[[0.0, 1.0, 2.0],    ...                    [3.0, 4.0, 5.0],    ...                    [6.0, 7.0, 8.0]],    ...                   [[1.0, 2.0, 3.0],    ...                    [4.0, 5.0, 6.0],    ...                    [7.0, 8.0, 9.0]]])    &gt;&gt;&gt; K = torch.tensor([[[0.0, 1.0],    ...                    [2.0, 3.0]],    ...                   [[1.0, 2.0],    ...                    [3.0, 4.0]]])    &gt;&gt;&gt; corr2d_multi_in(X, K)    tensor([[ 56.,  72.],            [104., 120.]])    """</span>    <span class="token keyword">return</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>corr2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">for</span> x<span class="token punctuation">,</span> k <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> K<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-3-å¤šé€šé“è¾“å…¥è¾“å‡ºçš„å·ç§¯è¿ç®—"><a href="#4-3-å¤šé€šé“è¾“å…¥è¾“å‡ºçš„å·ç§¯è¿ç®—" class="headerlink" title="4.3 å¤šé€šé“è¾“å…¥è¾“å‡ºçš„å·ç§¯è¿ç®—"></a>4.3 å¤šé€šé“è¾“å…¥è¾“å‡ºçš„å·ç§¯è¿ç®—</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">corr2d_multi_in_out</span><span class="token punctuation">(</span>X<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> K<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    &gt;&gt;&gt; X = torch.tensor([[[0.0, 1.0, 2.0],    ...                    [3.0, 4.0, 5.0],    ...                    [6.0, 7.0, 8.0]],    ...                   [[1.0, 2.0, 3.0],    ...                    [4.0, 5.0, 6.0],    ...                    [7.0, 8.0, 9.0]]])    &gt;&gt;&gt; K = torch.tensor([[[0.0, 1.0],    ...                    [2.0, 3.0]],    ...                   [[1.0, 2.0],    ...                    [3.0, 4.0]]])    &gt;&gt;&gt; K = torch.stack((K, K + 1, K + 2), 0)    &gt;&gt;&gt; K.shape    torch.Size([3, 2, 2, 2])    &gt;&gt;&gt; corr2d_multi_in_out(X, K)    tensor([[[ 56.,  72.],             [104., 120.]],    &lt;BLANKLINE&gt;            [[ 76., 100.],             [148., 172.]],    &lt;BLANKLINE&gt;            [[ 96., 128.],             [192., 224.]]])    """</span>    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>corr2d_multi_in<span class="token punctuation">(</span>X<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> K<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-æ‰¹é‡å½’ä¸€åŒ–"><a href="#5-æ‰¹é‡å½’ä¸€åŒ–" class="headerlink" title="5. æ‰¹é‡å½’ä¸€åŒ–"></a>5. <a href="https://zh-v2.d2l.ai/chapter_convolutional-modern/batch-norm.html">æ‰¹é‡å½’ä¸€åŒ–</a></h2><h3 id="5-1-æ‰¹é‡å½’ä¸€åŒ–åŸç†"><a href="#5-1-æ‰¹é‡å½’ä¸€åŒ–åŸç†" class="headerlink" title="5.1 æ‰¹é‡å½’ä¸€åŒ–åŸç†"></a>5.1 æ‰¹é‡å½’ä¸€åŒ–åŸç†</h3><p>æ‰¹é‡å½’ä¸€åŒ–åº”ç”¨äºå•ä¸ªå¯é€‰å±‚ï¼ˆä¹Ÿå¯ä»¥åº”ç”¨åˆ°æ‰€æœ‰å±‚ï¼‰ï¼Œå…¶åŸç†æ˜¯ï¼šåœ¨æ¯æ¬¡è®­ç»ƒè¿­ä»£ä¸­ï¼Œå½’ä¸€åŒ–è¾“å…¥ï¼Œå³é€šè¿‡å‡å»å…¶å‡å€¼å¹¶é™¤ä»¥å…¶æ ‡å‡†å·®ï¼Œå…¶ä¸­ä¸¤è€…å‡åŸºäºå½“å‰å°æ‰¹é‡å¤„ç†ã€‚</p><p>æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨å¤§å°ä¸º 1 çš„æ‰¹é‡åº”ç”¨æ‰¹é‡å½’ä¸€åŒ–ã€‚å› ä¸ºåœ¨å‡å»å‡å€¼ä¹‹åï¼Œæ¯ä¸ªéšè—å•å…ƒå°†ä¸º 0ã€‚åœ¨åº”ç”¨æ‰¹é‡å½’ä¸€åŒ–æ—¶ï¼Œæ‰¹é‡å¤§å°çš„é€‰æ‹©å¯èƒ½æ¯”æ²¡æœ‰æ‰¹é‡å½’ä¸€åŒ–æ—¶æ›´é‡è¦ã€‚</p><p>ç”¨ $\mathbf{x} \in \mathcal{B}$ è¡¨ç¤ºä¸€ä¸ªæ¥è‡ªå°æ‰¹é‡ $\mathcal{B}$ çš„è¾“å…¥ï¼Œæ‰¹é‡å½’ä¸€åŒ– $\mathrm{BN}$ è¡¨è¾¾å¼ä¸ºï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathrm{BN}(\mathbf{x}) &= \boldsymbol{\gamma} \odot \frac{\mathbf{x} - \hat{\boldsymbol{\mu}}_\mathcal{B}}{\hat{\boldsymbol{\sigma}}_\mathcal{B}} + \boldsymbol{\beta} \\\\\hat{\boldsymbol{\mu}}_\mathcal{B} &= \frac{1}{|\mathcal{B}|} \sum_{\mathbf{x} \in \mathcal{B}} \mathbf{x}\\\hat{\boldsymbol{\sigma}}_\mathcal{B}^2 &= \frac{1}{|\mathcal{B}|} \sum_{\mathbf{x} \in \mathcal{B}} (\mathbf{x} - \hat{\boldsymbol{\mu}}_{\mathcal{B}})^2 + \epsilon\end{aligned}</script><p>å…¶ä¸­ï¼Œ$\hat{\boldsymbol{\mu}}_\mathcal{B}$ æ˜¯æ ·æœ¬å‡å€¼ï¼Œ$\hat{\boldsymbol{\sigma}}_\mathcal{B}$ æ˜¯å°æ‰¹é‡ $\mathcal{B}$ çš„æ ·æœ¬æ ‡å‡†å·®ã€‚å°å¸¸é‡ $\epsilon &gt; 0$ ç¡®ä¿ä¸ä¼šé™¤ä»¥é›¶ã€‚</p><p>åº”ç”¨æ ‡å‡†åŒ–åï¼Œç”Ÿæˆçš„å°æ‰¹é‡çš„å¹³å‡å€¼ä¸º 0 å’Œå•ä½æ–¹å·®ä¸º 1ã€‚ç”±äºå•ä½æ–¹å·®ï¼ˆä¸å…¶ä»–ä¸€äº›é­”æ³•æ•°ï¼‰æ˜¯ä¸€ä¸ªä»»æ„çš„é€‰æ‹©ï¼Œå› æ­¤é€šå¸¸åŒ…å« <em>æ‹‰ä¼¸å‚æ•°</em>ï¼ˆscaleï¼‰ $\boldsymbol{\gamma}$ å’Œ <em>åç§»å‚æ•°</em>ï¼ˆshiftï¼‰ $\boldsymbol{\beta}$ï¼Œå®ƒä»¬çš„å½¢çŠ¶ä¸ $\mathbf{x}$ ç›¸åŒã€‚æ³¨æ„ï¼Œ$\boldsymbol{\gamma}$ å’Œ $\boldsymbol{\beta}$ ä¹Ÿæ˜¯éœ€è¦ä¸å…¶ä»–æ¨¡å‹å‚æ•°ä¸€èµ·å­¦ä¹ çš„å‚æ•°ã€‚</p><h3 id="5-2-åº”ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚"><a href="#5-2-åº”ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚" class="headerlink" title="5.2 åº”ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚"></a>5.2 åº”ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚</h3><ol><li><p>å…¨è¿æ¥å±‚</p><p> é€šå¸¸å°†æ‰¹é‡å½’ä¸€åŒ–å±‚ç½®äºå…¨è¿æ¥å±‚ä¸­çš„ä»¿å°„å˜æ¢å’Œæ¿€æ´»å‡½æ•°ä¹‹é—´ã€‚</p></li><li><p>å·ç§¯å±‚</p><p> é€šå¸¸åœ¨å·ç§¯å±‚ä¹‹åå’Œéçº¿æ€§æ¿€æ´»å‡½æ•°ä¹‹å‰åº”ç”¨æ‰¹é‡å½’ä¸€åŒ–ã€‚</p><p> å½“å·ç§¯æœ‰å¤šä¸ªè¾“å‡ºé€šé“æ—¶ï¼Œéœ€è¦å¯¹è¿™äº›é€šé“çš„â€œæ¯ä¸ªâ€è¾“å‡ºæ‰§è¡Œæ‰¹é‡å½’ä¸€åŒ–ï¼Œæ¯ä¸ªé€šé“éƒ½æœ‰è‡ªå·±çš„æ‹‰ä¼¸ï¼ˆscaleï¼‰å’Œåç§»ï¼ˆshiftï¼‰å‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯æ ‡é‡ã€‚</p></li><li><p>é¢„æµ‹è¿‡ç¨‹ä¸­çš„æ‰¹é‡å½’ä¸€åŒ–</p><p> ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡ç§»åŠ¨å¹³å‡ä¼°ç®—æ•´ä¸ªè®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬å‡å€¼å’Œæ–¹å·®ï¼Œå¹¶åœ¨é¢„æµ‹æ—¶ä½¿ç”¨å®ƒä»¬å¾—åˆ°ç¡®å®šçš„è¾“å‡ºã€‚</p></li></ol><h3 id="5-3-å®ç°æ‰¹é‡å½’ä¸€åŒ–"><a href="#5-3-å®ç°æ‰¹é‡å½’ä¸€åŒ–" class="headerlink" title="5.3 å®ç°æ‰¹é‡å½’ä¸€åŒ–"></a>5.3 å®ç°æ‰¹é‡å½’ä¸€åŒ–</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">batch_norm</span><span class="token punctuation">(</span>    X<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>    gamma<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>    beta<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>    moving_mean<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>    moving_var<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>    eps<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span>    momentum<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Tuple<span class="token punctuation">[</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token comment"># é€šè¿‡ `is_grad_enabled` æ¥åˆ¤æ–­å½“å‰æ¨¡å¼æ˜¯è®­ç»ƒæ¨¡å¼è¿˜æ˜¯é¢„æµ‹æ¨¡å¼</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> torch<span class="token punctuation">.</span>is_grad_enabled<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å¦‚æœæ˜¯åœ¨é¢„æµ‹æ¨¡å¼ä¸‹ï¼Œç›´æ¥ä½¿ç”¨ä¼ å…¥çš„ç§»åŠ¨å¹³å‡æ‰€å¾—çš„å‡å€¼å’Œæ–¹å·®</span>        X_hat <span class="token operator">=</span> <span class="token punctuation">(</span>X <span class="token operator">-</span> moving_mean<span class="token punctuation">)</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>moving_var <span class="token operator">+</span> eps<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>            <span class="token comment"># ä½¿ç”¨å…¨è¿æ¥å±‚çš„æƒ…å†µï¼Œè®¡ç®—ç‰¹å¾ç»´ä¸Šçš„å‡å€¼å’Œæ–¹å·®</span>            mean <span class="token operator">=</span> X<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>            var <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># ä½¿ç”¨äºŒç»´å·ç§¯å±‚çš„æƒ…å†µï¼Œè®¡ç®—é€šé“ç»´ä¸Šï¼ˆaxis=1ï¼‰çš„å‡å€¼å’Œæ–¹å·®ã€‚</span>            <span class="token comment"># è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¿æŒXçš„å½¢çŠ¶ä»¥ä¾¿åé¢å¯ä»¥åšå¹¿æ’­è¿ç®—</span>            mean <span class="token operator">=</span> X<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>            var <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token comment"># è®­ç»ƒæ¨¡å¼ä¸‹ï¼Œç”¨å½“å‰çš„å‡å€¼å’Œæ–¹å·®åšæ ‡å‡†åŒ–</span>        X_hat <span class="token operator">=</span> <span class="token punctuation">(</span>X <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>var <span class="token operator">+</span> eps<span class="token punctuation">)</span>        <span class="token comment"># æ›´æ–°ç§»åŠ¨å¹³å‡çš„å‡å€¼å’Œæ–¹å·®</span>        moving_mean <span class="token operator">=</span> momentum <span class="token operator">*</span> moving_mean <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> momentum<span class="token punctuation">)</span> <span class="token operator">*</span> mean        moving_var <span class="token operator">=</span> momentum <span class="token operator">*</span> moving_var <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> momentum<span class="token punctuation">)</span> <span class="token operator">*</span> var    Y <span class="token operator">=</span> gamma <span class="token operator">*</span> X_hat <span class="token operator">+</span> beta  <span class="token comment"># ç¼©æ”¾å’Œç§»ä½</span>    <span class="token keyword">return</span> Y<span class="token punctuation">,</span> moving_mean<span class="token punctuation">.</span>data<span class="token punctuation">,</span> moving_var<span class="token punctuation">.</span>data<span class="token keyword">class</span> <span class="token class-name">BatchNorm</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># `num_features`ï¼šå®Œå…¨è¿æ¥å±‚çš„è¾“å‡ºæ•°é‡æˆ–å·ç§¯å±‚çš„è¾“å‡ºé€šé“æ•°</span>    <span class="token comment"># `num_dims`ï¼š2è¡¨ç¤ºå®Œå…¨è¿æ¥å±‚ï¼Œ4è¡¨ç¤ºå·ç§¯å±‚</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_features<span class="token punctuation">,</span> num_dims<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> num_dims <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>            shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> num_features<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> num_features<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># å‚ä¸æ±‚æ¢¯åº¦å’Œè¿­ä»£çš„æ‹‰ä¼¸å’Œåç§»å‚æ•°ï¼Œåˆ†åˆ«åˆå§‹åŒ–æˆ1å’Œ0</span>        self<span class="token punctuation">.</span>gamma <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>beta <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># éæ¨¡å‹å‚æ•°çš„å˜é‡åˆå§‹åŒ–ä¸º0å’Œ1</span>        self<span class="token punctuation">.</span>moving_mean <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>moving_var <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å¦‚æœ `X` ä¸åœ¨å†…å­˜ä¸Šï¼Œå°† `moving_mean` å’Œ `moving_var`</span>        <span class="token comment"># å¤åˆ¶åˆ° `X` æ‰€åœ¨æ˜¾å­˜ä¸Š</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>moving_mean<span class="token punctuation">.</span>device <span class="token operator">!=</span> X<span class="token punctuation">.</span>device<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>moving_mean <span class="token operator">=</span> self<span class="token punctuation">.</span>moving_mean<span class="token punctuation">.</span>to<span class="token punctuation">(</span>X<span class="token punctuation">.</span>device<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>moving_var <span class="token operator">=</span> self<span class="token punctuation">.</span>moving_var<span class="token punctuation">.</span>to<span class="token punctuation">(</span>X<span class="token punctuation">.</span>device<span class="token punctuation">)</span>        <span class="token comment"># ä¿å­˜æ›´æ–°è¿‡çš„ `moving_mean` å’Œ `moving_var`</span>        Y<span class="token punctuation">,</span> self<span class="token punctuation">.</span>moving_mean<span class="token punctuation">,</span> self<span class="token punctuation">.</span>moving_var <span class="token operator">=</span> batch_norm<span class="token punctuation">(</span>            X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>gamma<span class="token punctuation">,</span> self<span class="token punctuation">.</span>beta<span class="token punctuation">,</span> self<span class="token punctuation">.</span>moving_mean<span class="token punctuation">,</span> self<span class="token punctuation">.</span>moving_var<span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> Y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-æ¢¯åº¦è£å‰ª"><a href="#6-æ¢¯åº¦è£å‰ª" class="headerlink" title="6. æ¢¯åº¦è£å‰ª"></a>6. <a href="https://zh-v2.d2l.ai/chapter_recurrent-neural-networks/rnn-scratch.html">æ¢¯åº¦è£å‰ª</a></h2><h3 id="6-1-æ¢¯åº¦è£å‰ªåŸç†"><a href="#6-1-æ¢¯åº¦è£å‰ªåŸç†" class="headerlink" title="6.1 æ¢¯åº¦è£å‰ªåŸç†"></a>6.1 æ¢¯åº¦è£å‰ªåŸç†</h3><p>è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶æ¢¯åº¦å¯èƒ½å¾ˆå¤§ï¼Œä»è€Œå¯¼è‡´ç®—æ³•æ— æ³•æ”¶æ•›ã€‚è™½ç„¶å¯ä»¥é™ä½å­¦ä¹ ç‡æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœè®­ç»ƒè¿‡ç¨‹ä¸­å¾ˆå°‘å¾—åˆ°å¤§çš„æ¢¯åº¦æ—¶å°±ä¸å¯è¡Œäº†ã€‚</p><p>ä¸€ä¸ªæµè¡Œçš„æ–¹æ¡ˆæ˜¯é€šè¿‡å°†æ¢¯åº¦ $\mathbf{g}$ æŠ•å½±å›ç»™å®šåŠå¾„ï¼ˆä¾‹å¦‚ $\theta$ ï¼‰çš„çƒæ¥è£å‰ªæ¢¯åº¦ $\mathbf{g}$ ã€‚å¦‚ä¸‹å¼ï¼š</p><script type="math/tex; mode=display">\mathbf{g} \leftarrow \min\left(1, \frac{\theta}{\|\mathbf{g}\|}\right) \mathbf{g}</script><p>è£å‰ªåçš„æ¢¯åº¦èŒƒæ•°ä¸ä¼šè¶…è¿‡ $\theta$ ï¼Œæ–¹å‘ä¸ $\mathbf{g}$ çš„åŸå§‹æ–¹å‘å¯¹é½ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯é™åˆ¶ä»»ä½•ç»™å®šçš„å°æ‰¹é‡æ•°æ®ï¼ˆä»¥åŠå…¶ä¸­ä»»ä½•ç»™å®šçš„æ ·æœ¬ï¼‰å¯¹å‚æ•°å‘é‡çš„å½±å“ï¼Œè®©æ¨¡å‹çš„è®­ç»ƒæ›´åŠ ç¨³å®šã€‚</p><p>æ¢¯åº¦è£å‰ªæä¾›äº†ä¸€ä¸ªå¿«é€Ÿä¿®å¤æ¢¯åº¦çˆ†ç‚¸çš„æ–¹æ³•ã€‚</p><h3 id="6-2-å®ç°æ¢¯åº¦è£å‰ª"><a href="#6-2-å®ç°æ¢¯åº¦è£å‰ª" class="headerlink" title="6.2 å®ç°æ¢¯åº¦è£å‰ª"></a>6.2 å®ç°æ¢¯åº¦è£å‰ª</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">grad_clipping</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> theta<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>        params <span class="token operator">=</span> <span class="token punctuation">[</span>p <span class="token keyword">for</span> p <span class="token keyword">in</span> net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> p<span class="token punctuation">.</span>requires_grad<span class="token punctuation">]</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        params <span class="token operator">=</span> net<span class="token punctuation">.</span>params    norm <span class="token operator">=</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>grad <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> params<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> norm <span class="token operator">&gt;</span> theta<span class="token punctuation">:</span>        <span class="token keyword">for</span> param <span class="token keyword">in</span> params<span class="token punctuation">:</span>            param<span class="token punctuation">.</span>grad<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">*=</span> theta <span class="token operator">/</span> norm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-è¯­è¨€æ¨¡å‹"><a href="#7-è¯­è¨€æ¨¡å‹" class="headerlink" title="7. è¯­è¨€æ¨¡å‹"></a>7. <a href="https://zh-v2.d2l.ai/chapter_recurrent-neural-networks/language-models-and-dataset.html#sec-language-model">è¯­è¨€æ¨¡å‹</a></h2><h3 id="7-1-è¯­è¨€æ¨¡å‹çš„å®šä¹‰"><a href="#7-1-è¯­è¨€æ¨¡å‹çš„å®šä¹‰" class="headerlink" title="7.1 è¯­è¨€æ¨¡å‹çš„å®šä¹‰"></a>7.1 è¯­è¨€æ¨¡å‹çš„å®šä¹‰</h3><p>è¯­è¨€æ¨¡å‹çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæ¨¡å‹ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°ï¼‰ã€‚å¯¹äºä¸€æ®µé•¿åº¦ä¸º $T$ çš„æ–‡æœ¬åºåˆ—ï¼Œå…¶è¯å…ƒä¾æ¬¡ä¸º $x_1, x_2, \ldots, x_T$ ï¼Œé€šè¿‡è¿™ä¸ªæ¨¡å‹å¯ä»¥è®¡ç®—å‡ºè¯¥åºåˆ—å‡ºç°çš„æ¦‚ç‡ï¼Œå³ï¼š</p><script type="math/tex; mode=display">P(x_1, x_2, \ldots, x_T)</script><h3 id="7-2-å­¦ä¹ è¯­è¨€æ¨¡å‹"><a href="#7-2-å­¦ä¹ è¯­è¨€æ¨¡å‹" class="headerlink" title="7.2 å­¦ä¹ è¯­è¨€æ¨¡å‹"></a>7.2 å­¦ä¹ è¯­è¨€æ¨¡å‹</h3><p>å­¦ä¹ è¯­è¨€æ¨¡å‹çš„è¿‡ç¨‹å°±æ˜¯ç”¨ä¸€ä¸ªç¥ç»ç½‘ç»œå»æ‹ŸåˆçœŸå®çš„è¯­è¨€æ¨¡å‹çš„è¿‡ç¨‹ã€‚</p><p>åŸºæœ¬çš„æ¦‚ç‡è§„åˆ™ï¼š</p><script type="math/tex; mode=display">P(x_1, x_2, \ldots, x_T) = \prod_{t=1}^T P(x_t  \mid  x_1, \ldots, x_{t-1})</script><p>ä¾‹å¦‚ï¼ŒåŒ…å«äº†å››ä¸ªå•è¯çš„ä¸€ä¸ªæ–‡æœ¬åºåˆ—çš„æ¦‚ç‡æ˜¯ï¼š</p><script type="math/tex; mode=display">P(\text{deep}, \text{learning}, \text{is}, \text{fun}) =  P(\text{deep}) P(\text{learning}  \mid  \text{deep}) P(\text{is}  \mid  \text{deep}, \text{learning}) P(\text{fun}  \mid  \text{deep}, \text{learning}, \text{is})</script><p>ä¸ºäº†è®¡ç®—è¯­è¨€æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å•è¯çš„æ¦‚ç‡å’Œç»™å®šå‰é¢å‡ ä¸ªå•è¯åå‡ºç°æŸä¸ªå•è¯çš„æ¡ä»¶æ¦‚ç‡ã€‚è¿™äº›æ¦‚ç‡æœ¬è´¨ä¸Šå°±æ˜¯è¯­è¨€æ¨¡å‹çš„å‚æ•°ã€‚</p><h2 id="8-å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰"><a href="#8-å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰" class="headerlink" title="8. å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰"></a>8. <a href="https://zh-v2.d2l.ai/chapter_recurrent-neural-networks/rnn.html#perplexity">å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰</a></h2><p>å¦‚æœæƒ³è¦å‹ç¼©æ–‡æœ¬ï¼ˆåœ¨å¾ªç¯ç¥ç»ç½‘ç»œä¸­ï¼Œä¼šæŠŠä¸€æ®µæ–‡æœ¬éƒ½å‹ç¼©è¿›éšçŠ¶æ€ä¸­ï¼‰ï¼Œå¯ä»¥è¯¢é—®æ ¹æ®å½“å‰è¯å…ƒé›†é¢„æµ‹çš„ä¸‹ä¸€ä¸ªè¯å…ƒã€‚ä¸€ä¸ªæ›´å¥½çš„è¯­è¨€æ¨¡å‹åº”è¯¥èƒ½æ›´å‡†ç¡®åœ°é¢„æµ‹ä¸‹ä¸€ä¸ªè¯å…ƒã€‚</p><p>æ‰€ä»¥å¯ä»¥é€šè¿‡ä¸€ä¸ªåºåˆ—ä¸­æ‰€æœ‰çš„ $n$ ä¸ªè¯å…ƒçš„äº¤å‰ç†µæŸå¤±çš„å¹³å‡å€¼æ¥è¡¡é‡ï¼š</p><script type="math/tex; mode=display">\frac{1}{n} \sum_{t=1}^n -\log P(x_t \mid x_{t-1}, \ldots, x_1)</script><p>å…¶ä¸­ $P$ ç”±è¯­è¨€æ¨¡å‹ç»™å‡ºï¼Œ $x_t$ æ˜¯åœ¨æ—¶é—´æ­¥ $t$ ä»è¯¥åºåˆ—ä¸­è§‚å¯Ÿåˆ°çš„å®é™…è¯å…ƒã€‚ç”±äºå†å²åŸå› ï¼Œè‡ªç„¶è¯­è¨€å¤„ç†çš„ç§‘å­¦å®¶æ›´å–œæ¬¢ä½¿ç”¨ä¸€ä¸ªå«åš <em>å›°æƒ‘åº¦</em>ï¼ˆperplexityï¼‰çš„é‡ã€‚å®ƒæ˜¯ä¸Šé¢å…¬å¼çš„æŒ‡æ•°ï¼š</p><script type="math/tex; mode=display">\exp\left(-\frac{1}{n} \sum_{t=1}^n \log P(x_t \mid x_{t-1}, \ldots, x_1)\right)</script><p>å½“éœ€è¦å†³å®šä¸‹ä¸€ä¸ªè¯å…ƒæ˜¯å“ªä¸ªæ—¶ï¼Œå›°æƒ‘åº¦æœ€å¥½çš„ç†è§£æ˜¯ä¸‹ä¸€ä¸ªè¯å…ƒçš„å®é™…é€‰æ‹©æ•°çš„è°ƒå’Œå¹³å‡æ•°ã€‚æ¯”å¦‚ï¼š</p><ul><li>åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯å®Œç¾åœ°ä¼°è®¡æ ‡ç­¾è¯å…ƒçš„æ¦‚ç‡ä¸º1ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨¡å‹çš„å›°æƒ‘åº¦ä¸º1ã€‚</li><li>åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯é¢„æµ‹æ ‡ç­¾è¯å…ƒçš„æ¦‚ç‡ä¸º0ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›°æƒ‘åº¦æ˜¯æ­£æ— ç©·å¤§ã€‚</li><li>åœ¨åŸºçº¿ä¸Šï¼Œè¯¥æ¨¡å‹çš„é¢„æµ‹æ˜¯è¯æ±‡è¡¨çš„æ‰€æœ‰å¯ç”¨è¯å…ƒä¸Šçš„å‡åŒ€åˆ†å¸ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›°æƒ‘åº¦ç­‰äºè¯æ±‡è¡¨ä¸­å”¯ä¸€è¯å…ƒçš„æ•°é‡ã€‚äº‹å®ä¸Šï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ²¡æœ‰ä»»ä½•å‹ç¼©çš„æƒ…å†µä¸‹å­˜å‚¨åºåˆ—ï¼Œè¿™å°†æ˜¯æˆ‘ä»¬èƒ½åšçš„æœ€å¥½çš„ç¼–ç æ–¹å¼ã€‚å› æ­¤ï¼Œè¿™ç§æ–¹å¼æä¾›äº†ä¸€ä¸ªé‡è¦çš„ä¸Šé™ï¼Œè€Œä»»ä½•å®é™…çš„è¯­è¨€æ¨¡å‹éƒ½å¿…é¡»è¶…è¶Šè¿™ä¸ªä¸Šé™ã€‚</li></ul><h2 id="9-å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#9-å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="9. å¾ªç¯ç¥ç»ç½‘ç»œ"></a>9. <a href="https://zh-v2.d2l.ai/chapter_recurrent-neural-networks/index.html">å¾ªç¯ç¥ç»ç½‘ç»œ</a></h2><p>å®Œæ•´çš„ä»£ç ï¼š<a href="/images/ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹è¯»ä¹¦ç¬”è®°/rnn.py">rnn.py</a></p><h3 id="9-1-ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œé¢„æµ‹"><a href="#9-1-ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œé¢„æµ‹" class="headerlink" title="9.1 ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œé¢„æµ‹"></a>9.1 <a href="https://zh-v2.d2l.ai/chapter_recurrent-neural-networks/rnn-scratch.html">ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œé¢„æµ‹</a></h3><p>prefix æ˜¯ç”¨äºé¢„æµ‹çš„å­—ç¬¦ä¸²ã€‚å¾ªç¯éå† prefix ä¸­çš„å­—ç¬¦ï¼Œä¸æ–­åœ°å°†éšè—çŠ¶æ€ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œä½†ä¸ç”Ÿæˆä»»ä½•è¾“å‡ºã€‚è¿™è¢«ç§°ä¸ºâ€œé¢„çƒ­â€ï¼ˆwarm-upï¼‰æœŸï¼Œå› ä¸ºåœ¨æ­¤æœŸé—´æ¨¡å‹ä¼šè‡ªæˆ‘æ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œæ›´æ–°éšè—çŠ¶æ€ï¼‰ï¼Œä½†ä¸ä¼šè¿›è¡Œé¢„æµ‹ã€‚é¢„çƒ­æœŸç»“æŸåï¼Œéšè—çŠ¶æ€çš„å€¼é€šå¸¸æ¯”åˆšå¼€å§‹çš„åˆå§‹å€¼æ›´é€‚åˆé¢„æµ‹ï¼Œä»è€Œé¢„æµ‹å­—ç¬¦å¹¶è¾“å‡ºå®ƒä»¬ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">predict_ch8</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> num_preds<span class="token punctuation">,</span> net<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""åœ¨`prefix`åé¢ç”Ÿæˆæ–°å­—ç¬¦ã€‚"""</span>    state <span class="token operator">=</span> net<span class="token punctuation">.</span>begin_state<span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span>    outputs <span class="token operator">=</span> <span class="token punctuation">[</span>vocab<span class="token punctuation">[</span>prefix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">get_input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>outputs<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> y <span class="token keyword">in</span> prefix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># é¢„çƒ­æœŸ</span>        _<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>get_input<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>vocab<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_preds<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># é¢„æµ‹`num_preds`æ­¥</span>        y<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>get_input<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>vocab<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="9-2-ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒ"><a href="#9-2-ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒ" class="headerlink" title="9.2 ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒ"></a>9.2 <a href="https://zh-v2.d2l.ai/chapter_recurrent-neural-networks/rnn-scratch.html">ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œè¿›è¡Œè®­ç»ƒ</a></h3><p>åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸå†…è®­ç»ƒæ¨¡å‹ã€‚</p><ol><li><p>åºåˆ—æ•°æ®çš„ä¸åŒé‡‡æ ·æ–¹æ³•ï¼ˆ<a href="https://zh-v2.d2l.ai/chapter_recurrent-neural-networks/language-models-and-dataset.html">éšæœºé‡‡æ ·å’Œé¡ºåºåˆ†åŒº</a>ï¼‰å°†å¯¼è‡´éšè—çŠ¶æ€åˆå§‹åŒ–çš„å·®å¼‚ã€‚</p><blockquote><p>éšæœºé‡‡æ ·å’Œé¡ºåºåˆ†åŒºè¿™ä¸¤ç§é‡‡æ ·çš„ä¸»è¦åŒºåˆ«å°±æ˜¯ï¼Œé¡ºåºåˆ†åŒºé‡‡æ ·å‡ºæ¥çš„æ•°æ®ä¸¤ä¸ªç›¸é‚»çš„å°æ‰¹é‡ä¸­çš„å­åºåˆ—åœ¨åŸå§‹åºåˆ—ä¸Šä¹Ÿæ˜¯ç›¸é‚»çš„ï¼Œè€Œéšæœºé‡‡æ ·ä¸æ˜¯ã€‚</p></blockquote></li><li><p>åœ¨æ›´æ–°æ¨¡å‹å‚æ•°ä¹‹å‰è£å‰ªæ¢¯åº¦ã€‚è¿™æ ·çš„æ“ä½œå³ä½¿è®­ç»ƒè¿‡ç¨‹ä¸­æŸä¸ªç‚¹ä¸Šå‘ç”Ÿäº†æ¢¯åº¦çˆ†ç‚¸ï¼Œä¹Ÿèƒ½ä¿è¯æ¨¡å‹ä¸ä¼šå‘æ•£ã€‚</p></li><li><p>ç”¨å›°æƒ‘åº¦æ¥è¯„ä»·æ¨¡å‹ã€‚è¿™æ ·çš„åº¦é‡ç¡®ä¿äº†ä¸åŒé•¿åº¦çš„åºåˆ—å…·æœ‰å¯æ¯”æ€§ã€‚</p></li></ol><p>å…·ä½“æ¥è¯´ï¼Œå½“ä½¿ç”¨é¡ºåºåˆ†åŒºæ—¶ï¼Œåªåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸçš„å¼€å§‹ä½ç½®åˆå§‹åŒ–éšè—çŠ¶æ€ã€‚ç”±äºä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¸­çš„ç¬¬ $i$ ä¸ªå­åºåˆ—æ ·æœ¬ä¸å½“å‰ç¬¬ $i$ ä¸ªå­åºåˆ—æ ·æœ¬ç›¸é‚»ï¼Œå› æ­¤å½“å‰å°æ‰¹é‡æ•°æ®æœ€åä¸€ä¸ªæ ·æœ¬çš„éšè—çŠ¶æ€ï¼Œå°†ç”¨äºåˆå§‹åŒ–ä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ç¬¬ä¸€ä¸ªæ ·æœ¬çš„éšè—çŠ¶æ€ã€‚è¿™æ ·ï¼Œå­˜å‚¨åœ¨éšè—çŠ¶æ€ä¸­çš„åºåˆ—çš„å†å²ä¿¡æ¯å¯ä»¥åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸå†…æµç»ç›¸é‚»çš„å­åºåˆ—ã€‚ç„¶è€Œï¼Œåœ¨ä»»ä½•ä¸€ç‚¹éšè—çŠ¶æ€çš„è®¡ç®—ï¼Œéƒ½ä¾èµ–äºåŒä¸€è¿­ä»£å‘¨æœŸä¸­å‰é¢æ‰€æœ‰çš„å°æ‰¹é‡æ•°æ®ï¼Œè¿™ä½¿å¾—æ¢¯åº¦è®¡ç®—å˜å¾—å¤æ‚ã€‚ä¸ºäº†é™ä½è®¡ç®—é‡ï¼Œæˆ‘ä»¬åœ¨å¤„ç†ä»»ä½•ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¹‹å‰å…ˆåˆ†ç¦»æ¢¯åº¦ï¼Œä½¿å¾—éšè—çŠ¶æ€çš„æ¢¯åº¦è®¡ç®—æ€»æ˜¯é™åˆ¶åœ¨ä¸€ä¸ªå°æ‰¹é‡æ•°æ®çš„æ—¶é—´æ­¥å†…ã€‚</p><p>å½“ä½¿ç”¨éšæœºæŠ½æ ·æ—¶ï¼Œå› ä¸ºæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯åœ¨ä¸€ä¸ªéšæœºä½ç½®æŠ½æ ·çš„ï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ªè¿­ä»£å‘¨æœŸé‡æ–°åˆå§‹åŒ–éšè—çŠ¶æ€ã€‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">train_epoch_ch8</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> updater<span class="token punctuation">,</span> device<span class="token punctuation">,</span> use_random_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""è®­ç»ƒæ¨¡å‹ä¸€ä¸ªè¿­ä»£å‘¨æœŸï¼ˆå®šä¹‰è§ç¬¬8ç« ï¼‰ã€‚"""</span>    state <span class="token operator">=</span> <span class="token boolean">None</span>    metrics <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>  <span class="token comment"># è®­ç»ƒæŸå¤±ä¹‹å’Œ, è¯å…ƒæ•°é‡</span>    <span class="token keyword">for</span> X<span class="token punctuation">,</span> Y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span>        <span class="token keyword">if</span> state <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> use_random_iter<span class="token punctuation">:</span>            <span class="token comment"># åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æˆ–ä½¿ç”¨éšæœºæŠ½æ ·æ—¶åˆå§‹åŒ–`state`</span>            state <span class="token operator">=</span> net<span class="token punctuation">.</span>begin_state<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># `state`æˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°çš„æ¨¡å‹æ˜¯ä¸ªå¼ é‡</span>            <span class="token keyword">for</span> s <span class="token keyword">in</span> state<span class="token punctuation">:</span>                s<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span>        y <span class="token operator">=</span> Y<span class="token punctuation">.</span>T<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>        y_hat<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">)</span>        l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>        l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        grad_clipping<span class="token punctuation">(</span>net<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># å› ä¸ºå·²ç»è°ƒç”¨äº†`mean`å‡½æ•°</span>        updater<span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        metrics<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> metrics<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> l <span class="token operator">*</span> y<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span>        metrics<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> metrics<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> math<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>metrics<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> metrics<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># å›°æƒ‘åº¦</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠC++è¯­è¨€å¯¼å­¦ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="c-yu-yan-dao-xue-di-er-ban-du-shu-bi-ji/"/>
      <url>c-yu-yan-dao-xue-di-er-ban-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬1ç« -åŸºç¡€çŸ¥è¯†"><a href="#ç¬¬1ç« -åŸºç¡€çŸ¥è¯†" class="headerlink" title="ç¬¬1ç«  åŸºç¡€çŸ¥è¯†"></a>ç¬¬1ç«  åŸºç¡€çŸ¥è¯†</h2><ol><li><p>ä¸ºäº†ä½¿é•¿å­—é¢å¸¸é‡æ›´æ˜“è¯»ï¼Œå¯ä»¥ä½¿ç”¨å•å¼•å·ï¼ˆâ€™ï¼‰ä½œä¸ºæ•°å­—åˆ†éš”ç¬¦ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">123'456'789</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¯¹äºå¸¦åˆå§‹åŒ–çš„ <code>if</code> è¯­å¥ï¼Œå¦‚æœæ¡ä»¶æ˜¯æ£€éªŒå˜é‡æ˜¯å¦ä¸º 0ï¼ˆæˆ–è€… nullptrï¼‰ï¼Œå¯ä»¥çœç•¥æ¡ä»¶çš„æ˜¾ç¤ºæè¿°ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v<span class="token punctuation">;</span><span class="token comment">// ä¸‹é¢ä¸¤ä¸ªifè¯­å¥æ„ä¹‰ç›¸åŒ</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> n <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">0</span> <span class="token operator">!=</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> n <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬2ç« -ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹"><a href="#ç¬¬2ç« -ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="ç¬¬2ç«  ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹"></a>ç¬¬2ç«  ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹</h2><ol><li><p>ä½¿ç”¨ <code>variant</code> ä»£æ›¿ <code>union</code> ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span>variant<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> string<span class="token operator">&gt;&gt;</span> vv <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"kibazen.cn"</span><span class="token punctuation">,</span> <span class="token number">8888</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">:</span> vv<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>holds_alternative<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"int value with: "</span> <span class="token operator">&lt;&lt;</span> get<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>holds_alternative<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"string value with: "</span> <span class="token operator">&lt;&lt;</span> get<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>enum</code> åªå®šä¹‰äº†èµ‹å€¼ã€åˆå§‹åŒ–å’Œæ¯”è¾ƒï¼ˆå¦‚ == å’Œ &lt;ï¼‰æ“ä½œã€‚ä½†æ˜¯æšä¸¾ç±»å‹æ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥ä¸ºæšä¸¾ç±»å‹å®šä¹‰åˆ«çš„è¿ç®—ç¬¦ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// enum å’Œ enum class éƒ½å¯ä»¥</span><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>    red<span class="token punctuation">,</span>    green<span class="token punctuation">,</span>    blue<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Color<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span>Color<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> Color<span class="token operator">::</span>red<span class="token operator">:</span>        <span class="token keyword">return</span> c <span class="token operator">=</span> Color<span class="token operator">::</span>green<span class="token punctuation">;</span>    <span class="token keyword">case</span> Color<span class="token operator">::</span>green<span class="token operator">:</span>        <span class="token keyword">return</span> c <span class="token operator">=</span> Color<span class="token operator">::</span>blue<span class="token punctuation">;</span>    <span class="token keyword">case</span> Color<span class="token operator">::</span>blue<span class="token operator">:</span>        <span class="token keyword">return</span> c <span class="token operator">=</span> Color<span class="token operator">::</span>red<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬3ç« -æ¨¡å—åŒ–"><a href="#ç¬¬3ç« -æ¨¡å—åŒ–" class="headerlink" title="ç¬¬3ç«  æ¨¡å—åŒ–"></a>ç¬¬3ç«  æ¨¡å—åŒ–</h2><ol><li><p>ä¸€ä¸ªå•ç‹¬ç¼–è¯‘çš„ <code>.cpp</code> æ–‡ä»¶ï¼ˆåŒ…æ‹¬å®ƒä½¿ç”¨ <code>#include</code> åŒ…å«çš„ <code>.h</code> æ–‡ä»¶ï¼‰ç§°ä¸ºä¸€ä¸ª <strong>ç¼–è¯‘å•å…ƒï¼ˆtranslation unitï¼‰</strong> ã€‚</p></li><li><p>å¤´æ–‡ä»¶ <code>include</code> å’Œæ¨¡å— <code>module</code> çš„å·®å¼‚ä¸ä»…æ˜¯è¯­è¨€ä¸Šçš„ã€‚</p><ul><li>ä¸€ä¸ªæ¨¡å—åªä¼šç¼–è¯‘ä¸€éï¼ˆè€Œä¸æ˜¯åƒå¤´æ–‡ä»¶ä¸€æ ·åœ¨ä½¿ç”¨å®ƒçš„æ¯ä¸ªç¼–è¯‘å•å…ƒä¸­éƒ½ç¼–è¯‘ä¸€éï¼‰ã€‚</li><li>ä¸¤ä¸ªæ¨¡å—å¯ä»¥æŒ‰ä»»æ„é¡ºåºå¯¼å…¥ï¼ˆimportï¼‰è€Œä¸ä¼šæ”¹å˜å®ƒä»¬çš„å«ä¹‰ã€‚</li><li>å¦‚æœä½ è®²ä¸€äº›ä¸œè¥¿å¯¼å…¥ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œåˆ™æ¨¡å—çš„ä½¿ç”¨è€…ä¸ä¼šéšå¼è·å¾—è¿™äº›ä¸œè¥¿çš„è®¿é—®æƒï¼ˆä½†ä¹Ÿä¸ä¼šè¢«å®ƒä»¬æ‰€å›°æ‰°ï¼‰ï¼šimport æ— ä¼ é€’æ€§ã€‚</li></ul></li><li><p>å£°æ˜ä¸º <code>noexcept</code> çš„å‡½æ•°æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨è°ƒç”¨ <code>teminate()</code> å‡½æ•°æ¥ç»ˆæ­¢æ•´ä¸ªç¨‹åºã€‚</p></li><li><p>ç»“æ„åŒ–ç»‘å®šã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> key<span class="token punctuation">;</span>    string value<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Info <span class="token function">get_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> Info <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"k"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">auto</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">get_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> string<span class="token operator">&gt;</span> m <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"k"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token operator">:</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬4ç« -ç±»"><a href="#ç¬¬4ç« -ç±»" class="headerlink" title="ç¬¬4ç«  ç±»"></a>ç¬¬4ç«  ç±»</h2><h2 id="ç¬¬5ç« -åŸºæœ¬æ“ä½œ"><a href="#ç¬¬5ç« -åŸºæœ¬æ“ä½œ" class="headerlink" title="ç¬¬5ç«  åŸºæœ¬æ“ä½œ"></a>ç¬¬5ç«  åŸºæœ¬æ“ä½œ</h2><ol><li>å³å€¼å¼•ç”¨çš„å«ä¹‰æ˜¯ï¼Œå¼•ç”¨ä¸€ä¸ªåˆ«äººæ— æ³•èµ‹å€¼çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°â€œçªƒå–â€å®ƒçš„å€¼ã€‚</li></ol><h2 id="ç¬¬6ç« -æ¨¡æ¿"><a href="#ç¬¬6ç« -æ¨¡æ¿" class="headerlink" title="ç¬¬6ç«  æ¨¡æ¿"></a>ç¬¬6ç«  æ¨¡æ¿</h2><ol><li><p>C++17ä¸­å…è®¸ä»æ„é€ å‡½æ•°å‚æ•°ä¸­æ¨æ–­æ¨¡æ¿å‚æ•°ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">pair p <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5.2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// pair&lt;int, double&gt;</span>tuple t <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token string">"a"</span>s <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// tuple&lt;int, double, string&gt;</span>vector vi <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// vector&lt;int&gt;</span>vector vc <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// vector&lt;const char*&gt;</span>vector vs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"a"</span>s<span class="token punctuation">,</span> <span class="token string">"b"</span>s<span class="token punctuation">,</span> <span class="token string">"c"</span>s <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// vector&lt;string&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">class</span> <span class="token class-name">Vector</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">using</span> value_type <span class="token operator">=</span> T<span class="token punctuation">;</span>    <span class="token function">Vector</span><span class="token punctuation">(</span>initializer_list<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span>    <span class="token function">Vector</span><span class="token punctuation">(</span>Iter begin<span class="token punctuation">,</span> Iter end<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>    T<span class="token operator">*</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    T<span class="token operator">*</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Iter</span><span class="token operator">&gt;</span><span class="token function">Vector</span><span class="token punctuation">(</span>Iter<span class="token punctuation">,</span> Iter<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Vector<span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>Iter<span class="token operator">&gt;</span><span class="token operator">::</span>value_type<span class="token operator">&gt;</span><span class="token punctuation">;</span>Vector v1 <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Vector&lt;int&gt;</span>Vector <span class="token function">v2</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v1<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vector&lt;int&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><a href="https://en.cppreference.com/w/cpp/language/class_template_argument_deduction">Class template argument deduction (CTAD) (since C++17)</a></p></blockquote></li></ol><h2 id="ç¬¬7ç« -æ¦‚å¿µå’Œæ³›å‹ç¼–ç¨‹"><a href="#ç¬¬7ç« -æ¦‚å¿µå’Œæ³›å‹ç¼–ç¨‹" class="headerlink" title="ç¬¬7ç«  æ¦‚å¿µå’Œæ³›å‹ç¼–ç¨‹"></a>ç¬¬7ç«  æ¦‚å¿µå’Œæ³›å‹ç¼–ç¨‹</h2><ol><li><p>å¯å˜å‚æ•°æ¨¡æ¿</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">print0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Tail<span class="token operator">&gt;</span><span class="token keyword">void</span> <span class="token function">print0</span><span class="token punctuation">(</span>T head<span class="token punctuation">,</span> Tail<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> tail<span class="token punctuation">)</span><span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> head<span class="token punctuation">;</span>    <span class="token function">print0</span><span class="token punctuation">(</span>tail<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Tail<span class="token operator">&gt;</span><span class="token keyword">void</span> <span class="token function">print1</span><span class="token punctuation">(</span>T head<span class="token punctuation">,</span> Tail<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> tail<span class="token punctuation">)</span><span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> head<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">print1</span><span class="token punctuation">(</span>tail<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">print0</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"char"</span><span class="token punctuation">,</span> <span class="token string">"string"</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"char"</span><span class="token punctuation">,</span> <span class="token string">"string"</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¡¨è¾¾å¼æŠ˜å </p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>T<span class="token operator">&gt;</span><span class="token keyword">void</span> <span class="token function">print2</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">(</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">&lt;&lt;</span> args<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// (((cout &lt;&lt; 1) &lt;&lt; "char") &lt;&lt; "string"s) &lt;&lt; endl;</span><span class="token function">print2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"char"</span><span class="token punctuation">,</span> <span class="token string">"string"</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> T<span class="token operator">&gt;</span><span class="token keyword">auto</span> <span class="token function">sum0</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>v <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å³æŠ˜å ï¼š(1 + (2 + (3 + 0)))</span><span class="token function">sum0</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> T<span class="token operator">&gt;</span><span class="token keyword">auto</span> <span class="token function">sum1</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å·¦æŠ˜å ï¼š(((0 + 1) + 2) + 3)</span><span class="token function">sum1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬8ç« -æ ‡å‡†åº“æ¦‚è§ˆ"><a href="#ç¬¬8ç« -æ ‡å‡†åº“æ¦‚è§ˆ" class="headerlink" title="ç¬¬8ç«  æ ‡å‡†åº“æ¦‚è§ˆ"></a>ç¬¬8ç«  æ ‡å‡†åº“æ¦‚è§ˆ</h2><h2 id="ç¬¬9ç« -å­—ç¬¦ä¸²å’Œæ­£åˆ™è¡¨è¾¾å¼"><a href="#ç¬¬9ç« -å­—ç¬¦ä¸²å’Œæ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ç¬¬9ç«  å­—ç¬¦ä¸²å’Œæ­£åˆ™è¡¨è¾¾å¼"></a>ç¬¬9ç«  å­—ç¬¦ä¸²å’Œæ­£åˆ™è¡¨è¾¾å¼</h2><h2 id="ç¬¬10ç« -è¾“å…¥è¾“å‡º"><a href="#ç¬¬10ç« -è¾“å…¥è¾“å‡º" class="headerlink" title="ç¬¬10ç«  è¾“å…¥è¾“å‡º"></a>ç¬¬10ç«  è¾“å…¥è¾“å‡º</h2><h2 id="ç¬¬11ç« -å®¹å™¨"><a href="#ç¬¬11ç« -å®¹å™¨" class="headerlink" title="ç¬¬11ç«  å®¹å™¨"></a>ç¬¬11ç«  å®¹å™¨</h2><ol><li><p>ä¸º <code>vector</code> çš„ä¸‹æ ‡è¿ç®—ç¬¦å¢åŠ èŒƒå›´æ£€æŸ¥åŠŸèƒ½ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">class</span> <span class="token class-name">Vec</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> std<span class="token operator">::</span><span class="token class-name">vector</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">using</span> vector<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span>vector<span class="token punctuation">;</span> <span class="token comment">// ä½¿ç”¨ vector çš„æ„é€ å‡½æ•°ï¼ˆä½†åå­—æ˜¯ Vecï¼‰</span>    T<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> T<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬12ç« -ç®—æ³•"><a href="#ç¬¬12ç« -ç®—æ³•" class="headerlink" title="ç¬¬12ç«  ç®—æ³•"></a>ç¬¬12ç«  ç®—æ³•</h2><h2 id="ç¬¬13ç« -å®ç”¨åŠŸèƒ½"><a href="#ç¬¬13ç« -å®ç”¨åŠŸèƒ½" class="headerlink" title="ç¬¬13ç«  å®ç”¨åŠŸèƒ½"></a>ç¬¬13ç«  å®ç”¨åŠŸèƒ½</h2><ol><li><p><code>span</code> çš„ä½¿ç”¨</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">use</span><span class="token punctuation">(</span>span<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vi<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">:</span> vi<span class="token punctuation">)</span> <span class="token punctuation">{</span>        cout <span class="token operator">&lt;&lt;</span> v <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">use</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>vector vi <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{</span>vi<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vi<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¦‚æœä¸€ä¸ª <code>tuple</code> ä¸­çš„æŸä¸ªå…ƒç´ çš„ç±»å‹åœ¨ <code>tuple</code> ä¸­æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥é€šè¿‡å…¶ç±»å‹æ¥è·å–å®ƒã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">tuple<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> string<span class="token operator">&gt;</span> t <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"k"</span>s <span class="token punctuation">}</span><span class="token punctuation">;</span>get<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"m"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>ä¸ <code>pair</code> ç±»ä¼¼ï¼Œåªè¦ <code>tuple</code> çš„å…ƒç´ æ”¯æŒèµ‹å€¼æ“ä½œå’Œæ¯”è¾ƒæ“ä½œï¼Œæ•´ä¸ª <code>tuple</code> å°±èƒ½è¿›è¡Œèµ‹å€¼å’Œæ¯”è¾ƒã€‚</p></li><li><p>æ ‡å‡†åº“æä¾›äº†ä¸‰ç§ç±»å‹æ¥è¡¨è¾¾é€‰æ‹©ï¼š</p><ul><li><code>variant</code> ç”¨æ¥è¡¨è¾¾ä¸€ç»„æŒ‡å®šé€‰æ‹©ä¸­çš„ä¸€ä¸ªã€‚</li><li><code>optional</code> ç”¨æ¥è¡¨è¾¾ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å€¼æˆ–è€…æ²¡æœ‰å€¼ã€‚</li><li><code>any</code> ç”¨æ¥è¡¨è¾¾ä¸€ç»„ä¸é™æ•°é‡çš„å¯é€‰ç±»å‹ä¸­çš„ä¸€ä¸ªã€‚</li></ul></li><li><p>æœ‰çŠ¶æ€çš„å†…å­˜åˆ†é…ç³»åˆ—å·¥å…· pmr(polymorphic memory resources) ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">pmr<span class="token operator">::</span>synchronized_pool_resource pool<span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span>    pmr<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> data <span class="token operator">=</span> pmr<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token number">512</span><span class="token punctuation">,</span>  <span class="token operator">&amp;</span>pool <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>pmr<span class="token operator">::</span>list<span class="token operator">&lt;</span>shared_ptr<span class="token operator">&lt;</span>Event<span class="token operator">&gt;&gt;</span> q <span class="token punctuation">{</span> <span class="token operator">&amp;</span>pool <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">!=</span> INT_MAX<span class="token punctuation">;</span> <span class="token operator">++</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>        q<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>allocate_shared<span class="token operator">&lt;</span>Event<span class="token punctuation">,</span> pmr<span class="token operator">::</span>polymorphic_allocator<span class="token operator">&lt;</span>Event<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pool<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬14ç« -æ•°å€¼"><a href="#ç¬¬14ç« -æ•°å€¼" class="headerlink" title="ç¬¬14ç«  æ•°å€¼"></a>ç¬¬14ç«  æ•°å€¼</h2><ol><li><p>æ ‡å‡†åº“ä¸­æ•°å­¦å‡½æ•°æŠ¥å‘Šé”™è¯¯çš„æ–¹å¼ç”±å¤´æ–‡ä»¶ <code>#include &lt;cmath&gt;</code> ä¸­å® <code>math_errhandling</code> çš„å€¼å†³å®šï¼Œå…¶å€¼ç­‰äº <code>MATH_ERRNO</code> ï¼Œæˆ– <code>MATH_ERREXCEPT</code> ï¼Œ æˆ– <code>MATH_ERRNO | MATH_ERREXCEPT</code> ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"MATH_ERRNO is "</span>          <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>math_errhandling <span class="token operator">&amp;</span> MATH_ERRNO <span class="token operator">?</span> <span class="token string">"set"</span> <span class="token operator">:</span> <span class="token string">"not set"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span>          <span class="token operator">&lt;&lt;</span> <span class="token string">"MATH_ERREXCEPT is "</span>          <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>math_errhandling <span class="token operator">&amp;</span> MATH_ERREXCEPT <span class="token operator">?</span> <span class="token string">"set"</span> <span class="token operator">:</span> <span class="token string">"not set"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>std<span class="token operator">::</span><span class="token function">feclearexcept</span><span class="token punctuation">(</span>FE_ALL_EXCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>errno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span>  <span class="token string">"log(0) = "</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>errno <span class="token operator">==</span> ERANGE<span class="token punctuation">)</span>        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"errno = ERANGE ("</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">")\n"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">fetestexcept</span><span class="token punctuation">(</span>FE_DIVBYZERO<span class="token punctuation">)</span><span class="token punctuation">)</span>    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"FE_DIVBYZERO (pole error) reported\n"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><a href="https://en.cppreference.com/w/cpp/numeric/math/math_errhandling">https://en.cppreference.com/w/cpp/numeric/math/math_errhandling</a></p></blockquote></li></ol><h2 id="ç¬¬15ç« -å¹¶å‘"><a href="#ç¬¬15ç« -å¹¶å‘" class="headerlink" title="ç¬¬15ç«  å¹¶å‘"></a>ç¬¬15ç«  å¹¶å‘</h2><ol><li><p><code>scoped_lock</code> å…è®¸åŒæ—¶è·å–å¤šä¸ªé”ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">scoped_lock lck <span class="token punctuation">{</span> mutex1<span class="token punctuation">,</span> mutex2<span class="token punctuation">,</span> mutex3 <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>shared_mutex</code> æ”¯æŒè¯»å†™é”æœºåˆ¶ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">shared_mutex mx<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    shared_lock lck <span class="token punctuation">{</span> mx <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    unique_lock lck <span class="token punctuation">{</span> mx <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬16ç« -å†å²å’Œå…¼å®¹æ€§"><a href="#ç¬¬16ç« -å†å²å’Œå…¼å®¹æ€§" class="headerlink" title="ç¬¬16ç«  å†å²å’Œå…¼å®¹æ€§"></a>ç¬¬16ç«  å†å²å’Œå…¼å®¹æ€§</h2>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§æ’åºç®—æ³•C++å®ç°</title>
      <link href="chang-jian-pai-xu-suan-fa-c-shi-xian/"/>
      <url>chang-jian-pai-xu-suan-fa-c-shi-xian/</url>
      
        <content type="html"><![CDATA[<h2 id="C-å®ç°"><a href="#C-å®ç°" class="headerlink" title="C++ å®ç°"></a>C++ å®ç°</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span><span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        a <span class="token operator">^=</span> b<span class="token punctuation">;</span>        b <span class="token operator">^=</span> a<span class="token punctuation">;</span>        a <span class="token operator">^=</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">get_minmax</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> mi<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> ma<span class="token punctuation">)</span><span class="token punctuation">{</span>    mi <span class="token operator">=</span> ma <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> mi<span class="token punctuation">)</span> <span class="token punctuation">{</span>            mi <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> ma<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ma <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// https://www.bigocheatsheet.com/</span><span class="token comment">// unstable, time: O(n^2) &lt;= O(n^2) &lt;= O(n^2), space: O(1)</span><span class="token keyword">void</span> <span class="token function">selection_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> p <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                p <span class="token operator">=</span> j<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// stable, time: O(n) &lt;= O(n^2) &lt;= O(n^2), space: O(1)</span><span class="token keyword">void</span> <span class="token function">bubble_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> n <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">--</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">bool</span> swapped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                swapped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>swapped<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// stable, time: O(n) &lt;= O(n^2) &lt;= O(n^2), space: O(1)</span><span class="token keyword">void</span> <span class="token function">insertion_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> j <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> tmp<span class="token punctuation">;</span> <span class="token operator">--</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>            arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// unstable, time: O(nlogn) &lt;= O((nlogn)^2) &lt;= O((nlogn)^2), space: O(1)</span><span class="token keyword">void</span> <span class="token function">shell_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> k <span class="token operator">=</span> j<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> i <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> tmp<span class="token punctuation">;</span> j <span class="token operator">-=</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// unstable, time: O(nlogn) &lt;= O(nlogn) &lt;= O(n^2), space: O(logn)</span><span class="token keyword">void</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">struct</span> <span class="token class-name">helper</span> <span class="token punctuation">{</span>        <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> low<span class="token punctuation">,</span> <span class="token keyword">int</span> high<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">int</span> pivot <span class="token operator">=</span> arr<span class="token punctuation">[</span>high<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> i <span class="token operator">=</span> low <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> low<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> high<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>high<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> i<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> low<span class="token punctuation">,</span> <span class="token keyword">int</span> high<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> pi <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> low<span class="token punctuation">,</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">quick_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> low<span class="token punctuation">,</span> pi <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">quick_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> pi <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    helper<span class="token operator">::</span><span class="token function">quick_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// stable, time: O(nlogn) &lt;= O(nlogn) &lt;= O(nlogn), space: O(n)</span><span class="token keyword">void</span> <span class="token function">merge_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">struct</span> <span class="token class-name">helper</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span><span class="token operator">*</span> buf<span class="token punctuation">;</span>        <span class="token function">helper</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token operator">~</span><span class="token function">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token keyword">void</span> <span class="token function">merge_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> low<span class="token punctuation">,</span> <span class="token keyword">int</span> high<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> mid <span class="token operator">=</span> low <span class="token operator">+</span> <span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token function">merge_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> low<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">merge_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">merge</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> low<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> low<span class="token punctuation">,</span> <span class="token keyword">int</span> mid<span class="token punctuation">,</span> <span class="token keyword">int</span> high<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> low<span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> high<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>                buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">int</span> left <span class="token operator">=</span> mid <span class="token operator">-</span> low <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right <span class="token operator">=</span> high <span class="token operator">-</span> low <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> left<span class="token punctuation">,</span> k <span class="token operator">=</span> low<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> left <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> <span class="token operator">++</span>k<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> left<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>k<span class="token punctuation">)</span> <span class="token punctuation">{</span>                arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> right<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">,</span> <span class="token operator">++</span>k<span class="token punctuation">)</span> <span class="token punctuation">{</span>                arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    helper <span class="token function">h</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    h<span class="token punctuation">.</span><span class="token function">merge_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// unstable, time: O(nlogn) &lt;= O(nlogn) &lt;= O(nlogn), space: O(1)</span><span class="token keyword">void</span> <span class="token function">heap_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">struct</span> <span class="token class-name">helper</span> <span class="token punctuation">{</span>        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">heapify</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> root<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">int</span> largest <span class="token operator">=</span> root<span class="token punctuation">,</span> l <span class="token operator">=</span> root <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">=</span> root <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">&gt;</span> arr<span class="token punctuation">[</span>largest<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                largest <span class="token operator">=</span> l<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">&gt;</span> arr<span class="token punctuation">[</span>largest<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                largest <span class="token operator">=</span> r<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>largest <span class="token operator">!=</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>largest<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> largest<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        helper<span class="token operator">::</span><span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        helper<span class="token operator">::</span><span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// stable, time: O(n+1) &lt;= O(n+k) &lt;= O(n+k), space: O(n+k)</span><span class="token keyword">void</span> <span class="token function">counting_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> mi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ma <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token function">get_minmax</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> mi<span class="token punctuation">,</span> ma<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> range <span class="token operator">=</span> ma <span class="token operator">-</span> mi <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token operator">*</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>range<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token operator">++</span>count<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> mi<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> range<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        count<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> count<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span><span class="token operator">*</span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        tmp<span class="token punctuation">[</span><span class="token operator">--</span>count<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> mi<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> count<span class="token punctuation">;</span>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tmp<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// stable, time: O(nk) &lt;= O(nk) &lt;= O(nk), space: O(n+k)</span><span class="token keyword">void</span> <span class="token function">radix_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">struct</span> <span class="token class-name">helper</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span><span class="token operator">*</span> buf<span class="token punctuation">;</span>        <span class="token function">helper</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token operator">~</span><span class="token function">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token keyword">void</span> <span class="token function">counting_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> mi<span class="token punctuation">,</span> <span class="token keyword">int</span> exp<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> count<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token operator">++</span>count<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> mi<span class="token punctuation">)</span> <span class="token operator">/</span> exp<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                count<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> count<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                buf<span class="token punctuation">[</span><span class="token operator">--</span>count<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> mi<span class="token punctuation">)</span> <span class="token operator">/</span> exp<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> mi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ma <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token function">get_minmax</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> mi<span class="token punctuation">,</span> ma<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> range <span class="token operator">=</span> ma <span class="token operator">-</span> mi <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    helper <span class="token function">h</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> exp <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> range <span class="token operator">/</span> exp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> exp <span class="token operator">*=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        h<span class="token punctuation">.</span><span class="token function">counting_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> mi<span class="token punctuation">,</span> exp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// stable, time: O(n+k) &lt;= O(n+k) &lt;= O(n^2), space: O(n)</span><span class="token keyword">void</span> <span class="token function">bucket_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> n_bucket <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span> buckets <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">[</span>n_bucket<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token operator">*</span> nums <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>n_bucket<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n_bucket<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> mi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ma <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token function">get_minmax</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> mi<span class="token punctuation">,</span> ma<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> range <span class="token operator">=</span> ma <span class="token operator">-</span> mi <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">float</span> v <span class="token operator">=</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> mi<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0f</span> <span class="token operator">/</span> range<span class="token punctuation">;</span>        <span class="token keyword">int</span> index <span class="token operator">=</span> v <span class="token operator">*</span> n_bucket<span class="token punctuation">;</span>        buckets<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span>nums<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n_bucket<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">quick_sort</span><span class="token punctuation">(</span>buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n_bucket<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>            arr<span class="token punctuation">[</span>p<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n_bucket<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buckets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">;</span>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buckets<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"sort.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cassert&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iterator&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;numeric&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span>f<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">v</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">iota</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span>n<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">shuffle</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mt19937<span class="token punctuation">{</span> random_device<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">copy</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ostream_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>cout<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">copy</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ostream_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>cout<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">is_sorted</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> selection_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> insertion_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> bubble_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> shell_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> quick_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> merge_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> heap_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> counting_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> radix_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test_sort</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> bucket_sort<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç®—æ³•å¤æ‚åº¦"><a href="#ç®—æ³•å¤æ‚åº¦" class="headerlink" title="ç®—æ³•å¤æ‚åº¦"></a>ç®—æ³•å¤æ‚åº¦</h2><p><a href="https://www.bigocheatsheet.com/">https://www.bigocheatsheet.com/</a></p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AVLæ ‘C++å®ç°</title>
      <link href="avl-shu-c-shi-xian/"/>
      <url>avl-shu-c-shi-xian/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€AVL-æ ‘"><a href="#ä¸€ã€AVL-æ ‘" class="headerlink" title="ä¸€ã€AVL æ ‘"></a>ä¸€ã€AVL æ ‘</h2><p>AVL æ ‘æ˜¯ä¸€ç§å¹³è¡¡äºŒå‰æ ‘ï¼Œå¾—åäºå…¶å‘æ˜è€…çš„åå­—ï¼ˆAdelson-Velskii å’Œ Landisï¼‰ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¹³è¡¡äºŒå‰æœç´¢æ ‘</li><li>æ¯ä¸ªç»“ç‚¹å­˜ balance factor = {-1, 0, 1}ï¼Œå³å·¦å³å­æ ‘çš„é«˜åº¦å·®</li><li>å››ç§æ—‹è½¬æ“ä½œ</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>ç»“ç‚¹éœ€è¦å­˜å‚¨é¢å¤–çš„ä¿¡æ¯ï¼Œè€Œä¸”è°ƒæ•´çš„æ¬¡æ•°é¢‘ç¹ï¼ˆå› ä¸ºå·¦å³å­æ ‘é«˜åº¦å·®ä¸èƒ½è¶…è¿‡1ï¼‰ã€‚</li></ol><h2 id="äºŒã€çº¢é»‘æ ‘"><a href="#äºŒã€çº¢é»‘æ ‘" class="headerlink" title="äºŒã€çº¢é»‘æ ‘"></a>äºŒã€çº¢é»‘æ ‘</h2><p>çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰æ˜¯ä¸€ç§ <strong>è¿‘ä¼¼å¹³è¡¡</strong> çš„äºŒå‰æœç´¢æ ‘ï¼Œå®ƒèƒ½ç¡®ä¿ä»»ä½•ä¸€ä¸ªç»“ç‚¹çš„å·¦å³å­æ ‘çš„ <strong>é«˜åº¦å·®å°äºä¸¤å€</strong>ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²ï¼›</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼›</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆ NULL ç»“ç‚¹ï¼Œç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²ï¼›</li><li>ä¸èƒ½æœ‰ç›¸é‚»çš„ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ï¼›</li><li>ä»ä»»ä¸€ç»“ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚</li></ol><p>çº¢é»‘æ ‘çš„å¯¹å­æ ‘é«˜åº¦å·®çš„è¦æ±‚æ¯” AVL æ ‘ä½ï¼Œä½†æ˜¯ä¾ç„¶ç»´æŒäº†ä¸é”™å¹³è¡¡ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„ç»´æŠ¤é¢‘ç‡æ¯” AVL æ ‘ä½ï¼Œä½†æ˜¯æ•ˆç‡å·®ä¸å¤šçš„é«˜ã€‚</p><h2 id="ä¸‰ã€AVL-æ ‘-C-å®ç°"><a href="#ä¸‰ã€AVL-æ ‘-C-å®ç°" class="headerlink" title="ä¸‰ã€AVL æ ‘ C++ å®ç°"></a>ä¸‰ã€AVL æ ‘ C++ å®ç°</h2><h3 id="C-å®ç°"><a href="#C-å®ç°" class="headerlink" title="C++ å®ç°"></a>C++ å®ç°</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">TreeNode</span> <span class="token punctuation">{</span>    T <span class="token operator">*</span>left_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token operator">*</span>right_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>    <span class="token comment">/* left left case: left rotate     *     A          (B)     *    / \        /   \     *  (B)  C      D     A     *  / \     =&gt;       / \     * D   E            E   C     **/</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">r_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        T<span class="token operator">*</span> root <span class="token operator">=</span> node<span class="token operator">-&gt;</span>left_<span class="token punctuation">;</span>        node<span class="token operator">-&gt;</span>left_ <span class="token operator">=</span> root<span class="token operator">-&gt;</span>right_<span class="token punctuation">;</span>        root<span class="token operator">-&gt;</span>right_ <span class="token operator">=</span> node<span class="token punctuation">;</span>        <span class="token keyword">return</span> root<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/* right right case: left rotate     *   A              (C)     *  / \            /   \     * B  (C)         A     E     *    / \   =&gt;   / \     *   D   E      B   D     **/</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">l_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        T<span class="token operator">*</span> root <span class="token operator">=</span> node<span class="token operator">-&gt;</span>right_<span class="token punctuation">;</span>        node<span class="token operator">-&gt;</span>right_ <span class="token operator">=</span> root<span class="token operator">-&gt;</span>left_<span class="token punctuation">;</span>        root<span class="token operator">-&gt;</span>left_ <span class="token operator">=</span> node<span class="token punctuation">;</span>        <span class="token keyword">return</span> root<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/* left right case: left rotate, right rotate     *     A              A     *    / \            / \         (E)     *   B   C         (E)  C       /   \     *  / \     =&gt;     / \     =&gt;  B     A     * D  (E)         B   G       / \   / \     *    / \        / \         D   F G   C     *   F   G      D   F     **/</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">lr_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        node<span class="token operator">-&gt;</span>left_ <span class="token operator">=</span> <span class="token function">l_rotate</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">r_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/* right left case: right rotate, left rotate     *     A            A     *    / \          / \               (D)     *   B   C        B  (D)            /   \     *      / \   =&gt;     / \     =&gt;    A     C     *    (D)  E        F   C         / \   / \     *    / \              / \       B   F G   E     *   F   G            G   E     **/</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">rl_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        node<span class="token operator">-&gt;</span>right_ <span class="token operator">=</span> <span class="token function">r_rotate</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">l_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">HeightNode</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">TreeNode</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> height_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">height</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> node <span class="token operator">?</span> node<span class="token operator">-&gt;</span>height_ <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">update_height</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">const</span> <span class="token keyword">auto</span> left <span class="token operator">=</span> <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span><span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">;</span>        node<span class="token operator">-&gt;</span>height_ <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>left <span class="token operator">&gt;</span> right <span class="token operator">?</span> left <span class="token operator">:</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">r_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        node <span class="token operator">=</span> <span class="token class-name">TreeNode</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">r_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">update_height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">update_height</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">l_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        node <span class="token operator">=</span> <span class="token class-name">TreeNode</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">l_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">update_height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">update_height</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">lr_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        node<span class="token operator">-&gt;</span>left_ <span class="token operator">=</span> <span class="token function">l_rotate</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">r_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> T<span class="token operator">*</span> <span class="token function">rl_rotate</span><span class="token punctuation">(</span>T<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        node<span class="token operator">-&gt;</span>right_ <span class="token operator">=</span> <span class="token function">r_rotate</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">l_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">class</span> <span class="token class-name">AVLTree</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">struct</span> <span class="token class-name">Node</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">HeightNode</span><span class="token operator">&lt;</span><span class="token class-name">Node</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>        T data_<span class="token punctuation">;</span>        <span class="token function">Node</span><span class="token punctuation">(</span>T data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">data_</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>V<span class="token operator">&amp;</span> visitor<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        visitor<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>root_<span class="token punctuation">)</span><span class="token punctuation">;</span>        visitor<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>T data<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">exist</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> root_ <span class="token operator">=</span> <span class="token function">insert_</span><span class="token punctuation">(</span>root_<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>T data<span class="token punctuation">)</span> <span class="token punctuation">{</span> root_ <span class="token operator">=</span> <span class="token function">remove_</span><span class="token punctuation">(</span>root_<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">exist</span><span class="token punctuation">(</span>T data<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">find_</span><span class="token punctuation">(</span>root_<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    Node<span class="token operator">*</span> <span class="token function">balance_</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">const</span> <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span><span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> right <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                node <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">lr_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// left right case</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                node <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">r_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// left left case</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">==</span> left <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                node <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">l_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// right left case</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                node <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">rl_rotate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// right left case</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Node<span class="token operator">*</span> <span class="token function">insert_</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">,</span> T data<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&lt;</span> node<span class="token operator">-&gt;</span>data_<span class="token punctuation">)</span> <span class="token punctuation">{</span>            node<span class="token operator">-&gt;</span>left_ <span class="token operator">=</span> <span class="token function">insert_</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            node<span class="token operator">-&gt;</span>right_ <span class="token operator">=</span> <span class="token function">insert_</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        node <span class="token operator">=</span> <span class="token function">balance_</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">update_height</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Node<span class="token operator">*</span> <span class="token function">remove_</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">,</span> T data<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> node<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> node<span class="token operator">-&gt;</span>data_<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_ <span class="token operator">&amp;&amp;</span> node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token class-name">Node</span><span class="token operator">::</span><span class="token function">height</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    Node<span class="token operator">*</span> minimum <span class="token operator">=</span> node<span class="token operator">-&gt;</span>right_<span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>minimum<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        minimum <span class="token operator">=</span> minimum<span class="token operator">-&gt;</span>left_<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    node<span class="token operator">-&gt;</span>data_ <span class="token operator">=</span> minimum<span class="token operator">-&gt;</span>data_<span class="token punctuation">;</span>                    node<span class="token operator">-&gt;</span>right_ <span class="token operator">=</span> <span class="token function">remove_</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">,</span> minimum<span class="token operator">-&gt;</span>data_<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    Node<span class="token operator">*</span> maximum <span class="token operator">=</span> node<span class="token operator">-&gt;</span>left_<span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>maximum<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        maximum <span class="token operator">=</span> maximum<span class="token operator">-&gt;</span>right_<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    node<span class="token operator">-&gt;</span>data_ <span class="token operator">=</span> maximum<span class="token operator">-&gt;</span>data_<span class="token punctuation">;</span>                    node<span class="token operator">-&gt;</span>left_ <span class="token operator">=</span> <span class="token function">remove_</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">,</span> maximum<span class="token operator">-&gt;</span>data_<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                Node<span class="token operator">*</span> tmp <span class="token operator">=</span> node<span class="token punctuation">;</span>                node <span class="token operator">=</span> node<span class="token operator">-&gt;</span>left_ <span class="token operator">?</span> node<span class="token operator">-&gt;</span>left_ <span class="token operator">:</span> node<span class="token operator">-&gt;</span>right_<span class="token punctuation">;</span>                <span class="token keyword">delete</span> tmp<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&lt;</span> node<span class="token operator">-&gt;</span>data_<span class="token punctuation">)</span> <span class="token punctuation">{</span>            node<span class="token operator">-&gt;</span>left_ <span class="token operator">=</span> <span class="token function">remove_</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>            node <span class="token operator">=</span> <span class="token function">balance_</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            node<span class="token operator">-&gt;</span>right_ <span class="token operator">=</span> <span class="token function">remove_</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>            node <span class="token operator">=</span> <span class="token function">balance_</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Node<span class="token operator">*</span> <span class="token function">find_</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">,</span> T data<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>node <span class="token operator">&amp;&amp;</span> data <span class="token operator">!=</span> node<span class="token operator">-&gt;</span>data_<span class="token punctuation">)</span> <span class="token punctuation">{</span>            node <span class="token operator">=</span> data <span class="token operator">&lt;</span> node<span class="token operator">-&gt;</span>data_ <span class="token operator">?</span> node<span class="token operator">-&gt;</span>left_ <span class="token operator">:</span> node<span class="token operator">-&gt;</span>right_<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    Node<span class="token operator">*</span> root_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"avl.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">InOrderVisitor</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"in-order: "</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">int</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> data <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">::</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">visit</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>left_<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">visit</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>data_<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">visit</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>right_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">void</span> <span class="token function">test_tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    T tree<span class="token punctuation">;</span>    InOrderVisitor<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> visitor<span class="token punctuation">;</span>    <span class="token keyword">constexpr</span> <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>        tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> v <span class="token operator">&lt;&lt;</span> <span class="token string">": "</span> <span class="token operator">&lt;&lt;</span> tree<span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        tree<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>        tree<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> v <span class="token operator">&lt;&lt;</span> <span class="token string">": "</span> <span class="token operator">&lt;&lt;</span> tree<span class="token punctuation">.</span><span class="token function">exist</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        tree<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    test_tree<span class="token operator">&lt;</span>AVLTree<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AStarç®—æ³•C++å®ç°</title>
      <link href="astar-suan-fa-c-shi-xian/"/>
      <url>astar-suan-fa-c-shi-xian/</url>
      
        <content type="html"><![CDATA[<h2 id="C-å®ç°"><a href="#C-å®ç°" class="headerlink" title="C++ å®ç°"></a>C++ å®ç°</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;functional&gt;</span> <span class="token comment">// function</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;queue&gt;</span> <span class="token comment">// priority_queue</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;tuple&gt;</span> <span class="token comment">// tuple</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map&gt;</span> <span class="token comment">// unordered_map</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span> <span class="token comment">// vector</span></span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">grid_t</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">cost_t</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">pos_t</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">hash_t</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">equal_t</span><span class="token operator">&gt;</span><span class="token keyword">class</span> <span class="token class-name">AStar</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">using</span> pos_cost_t <span class="token operator">=</span> std<span class="token operator">::</span>tuple<span class="token operator">&lt;</span>pos_t<span class="token punctuation">,</span> cost_t<span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token keyword">using</span> heuristic_f <span class="token operator">=</span> std<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token function">cost_t</span><span class="token punctuation">(</span><span class="token keyword">const</span> pos_t<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> pos_t<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token keyword">using</span> neighbor_f <span class="token operator">=</span> std<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">const</span> pos_t<span class="token operator">&amp;</span><span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>pos_cost_t<span class="token operator">&gt;</span><span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token function">AStar</span><span class="token punctuation">(</span><span class="token keyword">const</span> grid_t<span class="token operator">&amp;</span> grid<span class="token punctuation">,</span> <span class="token keyword">const</span> heuristic_f heuristic<span class="token punctuation">,</span> <span class="token keyword">const</span> neighbor_f neighbor<span class="token punctuation">)</span>        <span class="token operator">:</span> <span class="token function">grid_</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">heuristic_</span><span class="token punctuation">(</span>heuristic<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">neighbor_</span><span class="token punctuation">(</span>neighbor<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">find_path</span><span class="token punctuation">(</span><span class="token keyword">const</span> pos_t<span class="token operator">&amp;</span> from<span class="token punctuation">,</span> <span class="token keyword">const</span> pos_t<span class="token operator">&amp;</span> to<span class="token punctuation">,</span> cost_t<span class="token operator">*</span> cost<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>pos_t<span class="token operator">&gt;</span><span class="token operator">*</span> path<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">const</span> <span class="token keyword">auto</span> comp_f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> pos_cost_t<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> pos_cost_t<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> std<span class="token operator">::</span>get<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&gt;</span> std<span class="token operator">::</span>get<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        std<span class="token operator">::</span>priority_queue<span class="token operator">&lt;</span>pos_cost_t<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>pos_cost_t<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">decltype</span><span class="token punctuation">(</span>comp_f<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token function">q</span><span class="token punctuation">(</span>comp_f<span class="token punctuation">)</span><span class="token punctuation">;</span>        std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>pos_cost_t<span class="token operator">&gt;</span> neighbors<span class="token punctuation">;</span>        std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>pos_t<span class="token punctuation">,</span> cost_t<span class="token punctuation">,</span> hash_t<span class="token punctuation">,</span> equal_t<span class="token operator">&gt;</span> g<span class="token punctuation">;</span>        std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>pos_t<span class="token punctuation">,</span> pos_t<span class="token punctuation">,</span> hash_t<span class="token punctuation">,</span> equal_t<span class="token operator">&gt;</span> came_from<span class="token punctuation">;</span>        g<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cost_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        q<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token function">cost_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>q<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">auto</span> cur <span class="token operator">=</span> std<span class="token operator">::</span>get<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            q<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">equal_t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>cost<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token operator">*</span>cost <span class="token operator">=</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>came_from<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        path<span class="token operator">-&gt;</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>                        cur <span class="token operator">=</span> came_from<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    path<span class="token operator">-&gt;</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>                    std<span class="token operator">::</span><span class="token function">reverse</span><span class="token punctuation">(</span>path<span class="token operator">-&gt;</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token operator">-&gt;</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">const</span> <span class="token keyword">auto</span> g_cur <span class="token operator">=</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">neighbor_</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> neighbors<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>next<span class="token punctuation">,</span> cost<span class="token punctuation">]</span> <span class="token operator">:</span> neighbors<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">const</span> <span class="token keyword">auto</span> new_cost <span class="token operator">=</span> g_cur <span class="token operator">+</span> cost<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>g<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token operator">||</span> new_cost <span class="token operator">&lt;</span> g<span class="token punctuation">[</span>next<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    came_from<span class="token punctuation">[</span>next<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">;</span>                    g<span class="token punctuation">[</span>next<span class="token punctuation">]</span> <span class="token operator">=</span> new_cost<span class="token punctuation">;</span>                    q<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> new_cost <span class="token operator">+</span> <span class="token function">heuristic_</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            neighbors<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">const</span> grid_t<span class="token operator">&amp;</span> grid_<span class="token punctuation">;</span>    <span class="token keyword">const</span> heuristic_f heuristic_<span class="token punctuation">;</span>    <span class="token keyword">const</span> neighbor_f neighbor_<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"astar.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iomanip&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">namespace</span> std <span class="token punctuation">{</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T1</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">T2</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">hash</span><span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>    size_t <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token operator">&gt;</span><span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">noexcept</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> hash<span class="token operator">&lt;</span>T1<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token operator">^</span> hash<span class="token operator">&lt;</span>T2<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">// namespace std</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">void</span> <span class="token function">dump2d</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> grid<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> row <span class="token operator">:</span> grid<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> row<span class="token punctuation">)</span> <span class="token punctuation">{</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token function">setw</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> left <span class="token operator">&lt;&lt;</span> v <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// https://leetcode-cn.com/problems/shortest-path-in-binary-matrix/</span><span class="token keyword">int</span> <span class="token function">shortestPathBinaryMatrix</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> grid<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">using</span> pos <span class="token operator">=</span> pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">auto</span> heuristic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> pos<span class="token operator">&amp;</span> from<span class="token punctuation">,</span> <span class="token keyword">const</span> pos<span class="token operator">&amp;</span> to<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>first <span class="token operator">-</span> from<span class="token punctuation">.</span>first<span class="token punctuation">,</span> to<span class="token punctuation">.</span>second <span class="token operator">-</span> from<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">auto</span> neighbor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span>grid<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> pos<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>tuple<span class="token operator">&lt;</span>pos<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">constexpr</span> pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> dirs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>grid<span class="token punctuation">[</span>p<span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> dir <span class="token operator">:</span> dirs<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">const</span> <span class="token keyword">auto</span> x <span class="token operator">=</span> dir<span class="token punctuation">.</span>first <span class="token operator">+</span> p<span class="token punctuation">.</span>first<span class="token punctuation">,</span> y <span class="token operator">=</span> dir<span class="token punctuation">.</span>second <span class="token operator">+</span> p<span class="token punctuation">.</span>second<span class="token punctuation">;</span>                <span class="token keyword">const</span> <span class="token keyword">auto</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>grid<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> y <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>grid<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    v<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    AStar<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> pos<span class="token punctuation">,</span> hash<span class="token operator">&lt;</span>pos<span class="token operator">&gt;</span><span class="token punctuation">,</span> equal_to<span class="token operator">&lt;</span>pos<span class="token operator">&gt;&gt;</span> <span class="token function">astar</span><span class="token punctuation">(</span>grid<span class="token punctuation">,</span> heuristic<span class="token punctuation">,</span> neighbor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>grid<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> pos from<span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> to<span class="token punctuation">{</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> cost<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>pos<span class="token operator">&gt;</span> path<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>astar<span class="token punctuation">.</span><span class="token function">find_path</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cost<span class="token punctuation">,</span> <span class="token operator">&amp;</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token operator">++</span>cost<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"cost: "</span> <span class="token operator">&lt;&lt;</span> cost <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"path: \n"</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        grid<span class="token punctuation">[</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">dump2d</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> cost<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> grid <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">shortestPathBinaryMatrix</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seq2Seqä¸Attention</title>
      <link href="seq2seq-yu-attention/"/>
      <url>seq2seq-yu-attention/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#ä¸€ã€å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="ä¸€ã€å¾ªç¯ç¥ç»ç½‘ç»œ"></a>ä¸€ã€å¾ªç¯ç¥ç»ç½‘ç»œ</h2><p><a href="https://zh.wikipedia.org/wiki/%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C">å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent neural networkï¼ŒRNNï¼‰</a> å’Œå‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFeedforward Neural Networkï¼‰çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p><div class="table-container"><table><thead><tr><th>ç½‘ç»œ</th><th>è¾“å…¥</th><th>è¾“å‡º</th></tr></thead><tbody><tr><td>å‰é¦ˆç¥ç»ç½‘ç»œ</td><td>è®­ç»ƒæ•°æ®</td><td>è®­ç»ƒåçš„æ•°æ®</td></tr><tr><td>å¾ªç¯ç¥ç»ç½‘ç»œ</td><td>è®­ç»ƒæ•°æ® + ä¸Šä¸€å±‚è¾“å‡ºçš„éšçŠ¶æ€</td><td>è®­ç»ƒåçš„æ•°æ® + æ–°çš„éšçŠ¶æ€</td></tr></tbody></table></div><p><img src="/images/Seq2Seqä¸Attention/fnn_vs_rnn.jpg" alt="å‰é¦ˆç¥ç»ç½‘ç»œå¯¹æ¯”å¾ªç¯ç¥ç»ç½‘ç»œ"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://wiki.tum.de/display/lfdv/Recurrent+Neural+Networks+-+Combination+of+RNN+and+CNN">Recurrent Neural Networks - Combination of RNN and CNN</a></p></blockquote><p>å°†ä¸Šå›¾çš„å¾ªç¯ç¥ç»ç½‘ç»œå±•å¼€å¯ä»¥å¾—åˆ°ï¼š</p><p><img src="/images/Seq2Seqä¸Attention/rnn.jpg" alt="RNNç½‘ç»œå±•å¼€å›¾"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.wildml.com/2015/09/recurrent-neural-networks-tutorial-part-1-introduction-to-rnns/">Recurrent Neural Networks Tutorial, Part 1 â€“ Introduction to RNNs</a></p></blockquote><p>å…¶ä¸­ï¼š</p><ul><li>$x_t$ æ˜¯ $t$ æ—¶åˆ»çš„è¾“å…¥ã€‚æ¯”å¦‚ $x_1$ å¯ä»¥æ˜¯ä¸€æ®µè¯ä¸­ä¸ç¬¬ 2 ä¸ªå•è¯å¯¹åº”çš„ one-hot å‘é‡ï¼›</li><li>$s_t$ æ˜¯ $t$ æ—¶åˆ»è¾“å‡ºçš„éšçŠ¶æ€ï¼Œå®ƒæ˜¯ç½‘ç»œçš„â€œè®°å¿†â€ã€‚ $s_t$ æ ¹æ®å‰ä¸€ä¸ªéšçŠ¶æ€å’Œå½“å‰æ—¶åˆ»çš„è¾“å…¥è®¡ç®—å¾—å‡ºï¼š$s_t = f(U x_t + W s_{t-1})$ï¼Œå…¶ä¸­å‡½æ•° $f$ é€šå¸¸æ˜¯éçº¿æ€§çš„ï¼Œæ¯”å¦‚ï¼š$tanh$ æˆ– $ReLU$ ã€‚å½“è®¡ç®—ç¬¬ä¸€ä¸ªéšçŠ¶æ€æ—¶ï¼Œ $s_{-1}$ é€šå¸¸åˆå§‹åŒ–ä¸ºå…¨é›¶ï¼›</li><li>$o_t$ æ˜¯ $t$ æ—¶åˆ»çš„è¾“å‡ºã€‚æ¯”å¦‚ï¼Œå¦‚æœæ˜¯é¢„æµ‹ä¸€ä¸ªå¥å­çš„ä¸‹ä¸€ä¸ªå•è¯ï¼Œå®ƒå°±æ˜¯è¯æ±‡è¡¨ä¸­å„ä¸ªå•è¯çš„æ¦‚ç‡å‘é‡ï¼š $o_t = softmax(V s_t)$ ã€‚</li></ul><p>æ³¨æ„ï¼š</p><ul><li>éšçŠ¶æ€ $s_t$ å¯ä»¥çœ‹åšæ˜¯ç½‘ç»œçš„è®°å¿†ï¼Œå®ƒæ”¶é›†äº† $t$ æ—¶åˆ»åŠä¹‹å‰æ‰€æœ‰è¾“å…¥çš„ä¿¡æ¯ã€‚</li><li>æ¯ä¸€æ­¥ä¸­çš„ç¥ç»ç½‘ç»œå‚æ•° $U$ ã€ $V$ å’Œ $W$ éƒ½æ˜¯ç›¸åŒçš„ã€‚</li><li>æ¯ä¸€æ­¥çš„è¾“å‡º $o_t$ ä¸æ˜¯å¿…é¡»éœ€è¦ä½¿ç”¨çš„ã€‚æ¯”å¦‚ï¼Œåœ¨é¢„æµ‹ä¸€æ®µè¯æ˜¯ç§¯æçš„è¿˜æ˜¯æ¶ˆæçš„æ—¶ï¼Œåªéœ€è¦æœ€åä¸€æ­¥çš„è¾“å‡ºå³å¯ã€‚</li><li>æ¯ä¸€æ­¥çš„è¾“å…¥ $x_t$ ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œä¸€ä¸ªç½‘ç»œå¯ä»¥åªéœ€è¦å¦ä¸€ä¸ªç½‘ç»œæœ€åè¾“å‡ºçš„éšçŠ¶æ€ä½œä¸ºè¯¥ç½‘ç»œçš„åˆå§‹éšçŠ¶æ€å³å¯äº§ç”Ÿä¸€ç³»åˆ—çš„è¾“å‡ºã€‚</li></ul><p>ç†è®ºä¸Šï¼Œä¸ç®¡è¾“å…¥çš„åºåˆ— $\{x_0, x_1, x_2, \cdots, x_t \}$ å¤šé•¿ï¼Œæœ€åç½‘ç»œè¾“å‡ºçš„éšçŠ¶æ€ $s_t$ åº”è¯¥éƒ½æ˜¯åŒ…å«äº†æ‰€æœ‰è¾“å…¥ä¿¡æ¯çš„ã€‚ä½†æ˜¯å®é™…åœ¨ä½¿ç”¨æ—¶å‘ç°ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œå¯¹äºæ¯”è¾ƒé•¿çš„è¾“å…¥åºåˆ—æ¥è¯´ï¼Œæ•ˆæœæ›´å·®ï¼Œè¿™ç§°ä¹‹ä¸ºé•¿æœŸä¾èµ–ï¼ˆLong-Term Dependenciesï¼‰é—®é¢˜ã€‚</p><p>æ¯”å¦‚åœ¨ä¸€ä¸ªæ ¹æ®ä¹‹å‰çš„è¯é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„ä»»åŠ¡ä¸­ï¼Œå¦‚æœæ–‡æœ¬æ˜¯ â€œI grew up in Franceâ€¦ I speak fluent Frenchâ€ï¼Œå¦‚æœç¬¬ä¸€å¥è¯ä¸æœ€åä¸€å¥è¯éš”å¾—è¶Šè¿œï¼Œå¾ªç¯ç¥ç»ç½‘ç»œå°±è¶Šéš¾é¢„æµ‹å‡ºæœ€åçš„ â€œFrenchâ€ã€‚</p><h2 id="äºŒã€åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#äºŒã€åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="äºŒã€åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ"></a>äºŒã€åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ</h2><p>æ ‡å‡†çš„å¾ªç¯ç¥ç»ç½‘ç»œåªè€ƒè™‘çš„è¿‡å»è¾“å…¥ï¼Œæ²¡æœ‰è€ƒè™‘æœªæ¥çš„è¾“å…¥ï¼Œè€ŒåŒå‘å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆBi-directional Recurrent Neural Networkï¼ŒBRNNï¼‰åˆ™æ˜¯éƒ½è€ƒè™‘äº†ï¼Œå…¶ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/Seq2Seqä¸Attention/brnn.jpg" alt="åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://blog.csdn.net/jojozhangju/article/details/51982254">åŒå‘é•¿çŸ­æ—¶è®°å¿†å¾ªç¯ç¥ç»ç½‘ç»œè¯¦è§£ï¼ˆBi-directional LSTM RNNï¼‰</a></p></blockquote><p>å…¶ä¸­è¾“å‡ºçš„å€¼ $o_t$ ç”±ä¸‹é¢çš„å…¬å¼å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">h_t = f(w_1 x_t + w_2 h_{t-1})</script><script type="math/tex; mode=display">{h_t}\prime = f(w_3 x_t + w_5 {h_{t+1}}\prime)</script><script type="math/tex; mode=display">o_t = g(w_4 h_t + w_6 {h_t}\prime)</script><h2 id="ä¸‰ã€é•¿çŸ­æ—¶è®°å¿†ç½‘ç»œ"><a href="#ä¸‰ã€é•¿çŸ­æ—¶è®°å¿†ç½‘ç»œ" class="headerlink" title="ä¸‰ã€é•¿çŸ­æ—¶è®°å¿†ç½‘ç»œ"></a>ä¸‰ã€é•¿çŸ­æ—¶è®°å¿†ç½‘ç»œ</h2><p><a href="https://zh.wikipedia.org/wiki/%E9%95%B7%E7%9F%AD%E6%9C%9F%E8%A8%98%E6%86%B6">é•¿çŸ­æ—¶è®°å¿†ï¼ˆLong Short Term Memoryï¼ŒLSTMï¼‰</a> ç½‘ç»œä¹Ÿå±äºå¾ªç¯ç¥ç»ç½‘ç»œï¼Œå®ƒè¾ƒå¥½çš„è§£å†³äº†å¾ªç¯ç¥ç»ç½‘ç»œæœ‰çš„é•¿æœŸä¾èµ–é—®é¢˜ã€‚å…¶ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/Seq2Seqä¸Attention/lstm.png" alt="LSTM"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://stackoverflow.com/questions/44273249/in-keras-what-exactly-am-i-configuring-when-i-create-a-stateful-lstm-layer-wi">In Keras, what exactly am I configuring when I create a stateful LSTM layer with N units?</a></p></blockquote><p>é•¿çŸ­æ—¶è®°å¿†ç½‘ç»œçš„ä¸€ä¸ªæµè¡Œçš„å˜ä½“æ˜¯ <a href="https://en.wikipedia.org/wiki/Gated_recurrent_unit">GRUï¼ˆGated Recurrent Unitï¼‰</a> ï¼Œå…¶ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/Seq2Seqä¸Attention/gru.png" alt="GRU"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/">Understanding LSTM Networks</a></p></blockquote><h2 id="å››ã€Seq2Seq"><a href="#å››ã€Seq2Seq" class="headerlink" title="å››ã€Seq2Seq"></a>å››ã€Seq2Seq</h2><p>Seq2Seq å…¶å®æ˜¯æŒ‡ä»ä¸€ä¸ªåºåˆ—ç”Ÿæˆå¦å¤–ä¸€ä¸ªåºåˆ—çš„ç»“æ„ï¼Œè¿™ç§ç»“æ„ç”± Encoder å’Œ Decoder ç»„æˆã€‚å…¶ä¸­åœ¨ Encoder å’Œ Decoder ä¹‹é—´ä¼ é€’çš„åªæœ‰è¾“å…¥åºåˆ—æœ€åä¸€æ­¥å¾—åˆ°çš„éšçŠ¶æ€ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/Seq2Seqä¸Attention/seq2seq.png" alt="Seq2Seq"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://www.guru99.com/seq2seq-model.html">Seq2seq (Sequence to Sequence) Model with PyTorch</a></p></blockquote><h2 id="äº”ã€Attention"><a href="#äº”ã€Attention" class="headerlink" title="äº”ã€Attention"></a>äº”ã€Attention</h2><p>Attention æœºåˆ¶å°±æ˜¯å¯¹è¾“å…¥çš„æ¯ä¸ªå…ƒç´ è€ƒè™‘ä¸åŒçš„æƒé‡å‚æ•°ï¼Œä»è€Œæ›´åŠ å…³æ³¨ä¸è¾“å…¥çš„å…ƒç´ ç›¸ä¼¼çš„éƒ¨åˆ†ï¼Œè€ŒæŠ‘åˆ¶å…¶å®ƒæ— ç”¨çš„ä¿¡æ¯ã€‚</p><p><img src="/images/Seq2Seqä¸Attention/attention_1.png" alt="Attentionçš„æ•´ä½“æµç¨‹"><br><img src="/images/Seq2Seqä¸Attention/attention_2.png" alt="Attentionçš„è®¡ç®—è¿‡ç¨‹"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://lena-voita.github.io/nlp_course.html">Sequence to Sequence (seq2seq) and Attention</a></p></blockquote><h2 id="å…­ã€å‚è€ƒèµ„æ–™"><a href="#å…­ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å…­ã€å‚è€ƒèµ„æ–™"></a>å…­ã€å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://lena-voita.github.io/nlp_course/seq2seq_and_attention.html">Sequence to Sequence (seq2seq) and Attention</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rnn </tag>
            
            <tag> brnn </tag>
            
            <tag> lstm </tag>
            
            <tag> gru </tag>
            
            <tag> seq2seq </tag>
            
            <tag> attention </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLPä¸­çš„Embeddingå’ŒPadding</title>
      <link href="nlp-zhong-de-embedding-he-padding/"/>
      <url>nlp-zhong-de-embedding-he-padding/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Embedding"><a href="#1-Embedding" class="headerlink" title="1. Embedding"></a>1. Embedding</h2><p>åœ¨ <a href="https://zh.wikipedia.org/wiki/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86">è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNatural Language Processingï¼ŒNLPï¼‰</a> è¿‡ç¨‹ä¸­ï¼Œç¥ç»ç½‘ç»œçš„è¾“å…¥ä¸€èˆ¬æ˜¯ä¸€æ®µå¥å­ï¼Œå¥å­æœ‰ä¸€ä¸ªä¸€ä¸ªçš„å­—ç»„æˆã€‚</p><p>åœ¨è¾“å…¥ç¥ç»ç½‘ç»œä¹‹å‰ï¼Œéœ€è¦å°†è¿™äº›å­—è¿›è¡Œç¼–ç ï¼Œå¸¸è§„çš„ç¼–ç æ–¹å¼æ¯”å¦‚ <a href="https://zh.wikipedia.org/wiki/One-hot">One-hot</a> æ˜¯æœ‰å¤šå°‘ç§å­—ï¼Œç¼–ç å‡ºæ¥çš„å‘é‡å°±æœ‰å¤šé•¿ï¼Œè¿™ä¼šå¯¼è‡´ç¼–ç åçš„æ•°æ®ç‰¹åˆ«çš„å¤§ï¼Œä»è€Œå¯¼è‡´å¯¹åº”çš„ç¥ç»ç½‘ç»œæ¥æ”¶çš„è¾“å…¥ä¹Ÿç‰¹åˆ«å¤šçš„å¤§ï¼Œä¸ä¾¿äºè®­ç»ƒã€‚é™¤äº†ç¼–ç åçš„æ•°æ®å¤§è¿™ä¸ªç¼ºç‚¹å¤–ï¼Œone-hot ç¼–ç è¿˜æœ‰ä¸€ä¸ªæ›´é‡è¦çš„ç¼ºç‚¹å°±æ˜¯æ²¡æ³•è¡¨è¾¾è¯ä¸è¯å…³ç³»ï¼Œæ¯”å¦‚çŒ«å’Œç‹—ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¾ç„¶è¦æ¯”çŒ«å’Œç”µè„‘ä¹‹é—´çš„å…³ç³»è¿‘ï¼Œè¿™ç‚¹ one-hot æ— æ³•è¡¨è¾¾å‡ºæ¥ã€‚</p><p>æ‰€ä»¥åœ¨ NLP ä¸­å¸¸ç”¨çš„ç¼–ç æ–¹å¼æ˜¯ <a href="https://zh.wikipedia.org/wiki/%E8%AF%8D%E5%B5%8C%E5%85%A5">Embedding</a>ï¼Œå…¶æœ¬è´¨æ˜¯æŠŠä¸€ä¸ªæ•°ç”¨å‡ ä¸ªä¸åŒçš„æ•°å­—æ¥è¡¨ç¤ºï¼Œè€Œä¸æ˜¯åƒ One-hot é‚£æ ·ï¼Œåªç”¨ä¸€ä¸ª 1 æ¥è¡¨ç¤ºã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ <code>50000</code> ä¸ªæ•°å­—èŒƒå›´åœ¨ <code>[0-1000)</code> ä¹‹é—´çš„æ•°å­—ï¼Œéœ€è¦ç¼–ç ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> npnums <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span>nums<span class="token punctuation">.</span>shape  <span class="token comment"># (50000, )</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ One-hot ç¼–ç åçš„å¤§å°ä¸ºï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">one_hot <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">[</span>nums<span class="token punctuation">]</span>one_hot<span class="token punctuation">.</span>shape  <span class="token comment"># (50000, 1000)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è€Œä½¿ç”¨ Embedding ç¼–ç åçš„å¤§å°ä¸ºï¼ˆå‡è®¾ embedding çš„é•¿åº¦ä¸º 10ï¼‰åçš„ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>embedding <span class="token operator">=</span> data<span class="token punctuation">[</span>nums<span class="token punctuation">]</span>embedding<span class="token punctuation">.</span>shape  <span class="token comment"># (50000, 10)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="2-Padding"><a href="#2-Padding" class="headerlink" title="2. Padding"></a>2. Padding</h2><p>åœ¨ NLP ä¸­ï¼ŒEmbedding åªæ˜¯è§£å†³äº†ç¼–ç åå‘é‡ç‰¹åˆ«å¤§çš„é—®é¢˜ï¼Œä¾ç„¶æ²¡æœ‰è§£å†³å¥å­é•¿åº¦ä¸åŒçš„é—®é¢˜ã€‚è¿™æ˜¯å°±éœ€è¦ Paddingã€‚</p><p>Padding çš„æœ¬è´¨å°±æ˜¯å®šä¸€ä¸ªå¥å­é•¿åº¦ <code>N</code> ï¼Œç„¶åæŠŠå¾…è®­ç»ƒçš„æ•°æ®ä¸­å¥å­é•¿äº N çš„å¥å­æˆªæ–­åˆ° N é•¿åº¦ï¼ŒæŠŠçŸ­äº N çš„å¥å­ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å­—å¡«å……åˆ°é•¿åº¦ N ã€‚</p><h2 id="3-Embedding-å’Œ-Padding-ç®€å•çš„å®ç°"><a href="#3-Embedding-å’Œ-Padding-ç®€å•çš„å®ç°" class="headerlink" title="3. Embedding å’Œ Padding ç®€å•çš„å®ç°"></a>3. Embedding å’Œ Padding ç®€å•çš„å®ç°</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> torch<span class="token keyword">from</span> tensorflow <span class="token keyword">import</span> convert_to_tensor<span class="token punctuation">,</span> keras<span class="token comment"># å¾…å¤„ç†çš„æ–‡æœ¬</span>text <span class="token operator">=</span> <span class="token punctuation">(</span>    <span class="token triple-quoted-string string">"""The clock is running.Make the most of today.Time waits for no man.Yesterday is history.Tomorrow is a mystery.Today is a gift.That's why it is called the present."""</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"\n "</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"'s"</span><span class="token punctuation">,</span> <span class="token string">" is"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">make_word_index</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""æŠŠä¸€æ®µæ–‡æœ¬ä¸­çš„å•è¯ä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦åˆ†å¼€ï¼Œç”Ÿæˆä¸€ä¸ª{å•è¯,ID}çš„å­—æ®µå¯¹åº”è¡¨    Args:        text (str): å¾…å¤„ç†çš„æ–‡æœ¬        base (int): èµ·å§‹ID    Returns:        dict: {å•è¯,ID}å¯¹åº”è¡¨    """</span>    words <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    words<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>    word2id <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token builtin">id</span><span class="token punctuation">,</span> word <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">:</span>        word2id<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">id</span>    <span class="token keyword">return</span> word2id<span class="token keyword">def</span> <span class="token function">pad_or_truncate</span><span class="token punctuation">(</span>some_list<span class="token punctuation">,</span> target_len<span class="token punctuation">,</span> pad_value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""æŠŠåˆ—è¡¨æˆªæ–­æˆ–è¡¥é½åˆ°æŒ‡å®šçš„é•¿åº¦ï¼Œå¦‚æœé•¿åº¦ä¸è¶³ï¼Œåˆ™ä»¥æŒ‡å®šçš„è¡¥é½    Args:        some_list (list[int])): å¾…å¤„ç†çš„åˆ—è¡¨        target_len (int): æŒ‡å®šçš„é•¿åº¦        pad_value (int): è¡¥é½æ—¶ç”¨åˆ°çš„å€¼    Returns:        list[int]: å¤„ç†åçš„åˆ—è¡¨    """</span>    <span class="token keyword">return</span> some_list<span class="token punctuation">[</span><span class="token punctuation">:</span>target_len<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span>pad_value<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>target_len <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>some_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">process_text</span><span class="token punctuation">(</span>word2id<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> pad_value<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""é¢„å¤„ç†æ–‡æœ¬ï¼Œå°†æ–‡æœ¬ä»¥è¡Œä¸ºå•ä½åˆ†æˆå¥å­ï¼Œæ¯ä¸ªå¥å­ä¸­çš„å•è¯æ ¹æ®å­—å…¸æ›¿æ¢æˆIDï¼Œå¹¶å°†å¥å­æˆªæ–­æˆ–è¡¥é½åˆ°æŒ‡å®šçš„é•¿åº¦    Args:        word2id (dict[str, int]): {å•è¯,ID}å­—å…¸        seq_len (int): å¥å­çš„é•¿åº¦        pad_value (int): è¡¥é½æ—¶ç”¨åˆ°çš„å€¼        text (str)): å¾…å¤„ç†çš„é—®é¢˜    Returns:        list[list[int]]: å¤„ç†åçš„åŒ…å«å¥å­çš„åˆ—è¡¨    """</span>    sentences <span class="token operator">=</span> <span class="token punctuation">[</span>sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span> <span class="token keyword">for</span> sentence <span class="token keyword">in</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    sentences_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>word2id<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> sentence<span class="token punctuation">]</span> <span class="token keyword">for</span> sentence <span class="token keyword">in</span> sentences<span class="token punctuation">]</span>    sentences_ids <span class="token operator">=</span> <span class="token punctuation">[</span>pad_or_truncate<span class="token punctuation">(</span>sentence_ids<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> pad_value<span class="token punctuation">)</span> <span class="token keyword">for</span> sentence_ids <span class="token keyword">in</span> sentences_ids<span class="token punctuation">]</span>    <span class="token keyword">return</span> sentences_ids<span class="token keyword">def</span> <span class="token function">embedding_sentences_ids</span><span class="token punctuation">(</span>word_num<span class="token punctuation">,</span> embedding_len<span class="token punctuation">,</span> sentences_ids<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""embeddingå¥å­    Args:        word_num (int): å•è¯ç±»å‹çš„æ€»æ•°        embedding_len (int): embeddingçš„é•¿åº¦        sentences_ids (list[list[int]]): åŒ…å«å¥å­çš„åˆ—è¡¨    Returns:        np.ndarray: embeddingçš„çŸ©é˜µ        np.ndarray: å¥å­embeddingåçš„å€¼    """</span>    embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>word_num<span class="token punctuation">,</span> embedding_len<span class="token punctuation">)</span>    <span class="token keyword">return</span> embeddings<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>embeddings<span class="token punctuation">[</span>sentence_ids<span class="token punctuation">]</span> <span class="token keyword">for</span> sentence_ids <span class="token keyword">in</span> sentences_ids<span class="token punctuation">]</span><span class="token punctuation">)</span>PAD_TEXT <span class="token operator">=</span> <span class="token string">"&lt;PAD&gt;"</span>  <span class="token comment"># è¡¥é½æ—¶ä½¿ç”¨çš„å•è¯</span>PAD_INDEX <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># è¡¥é½æ—¶ä½¿ç”¨çš„å€¼</span>SENTENCE_LEN <span class="token operator">=</span> <span class="token number">6</span>  <span class="token comment"># å¤„ç†åå¥å­çš„é•¿åº¦ï¼ˆæ›´é•¿çš„æˆªæ–­ï¼Œæ›´çŸ­çš„è¡¥é½ï¼‰</span><span class="token comment"># æ ¹æ®æ–‡æœ¬ç”Ÿæˆï¼Œå•è¯=&gt;IDçš„è¡¨ï¼Œå…¶ä¸­IDæœ‰ä¸€ä¸ªåç§»ï¼Œç”¨äºå­˜æ”¾è¡¥é½å•è¯</span>word2id <span class="token operator">=</span> make_word_index<span class="token punctuation">(</span>text<span class="token operator">=</span>text<span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># æ”¾å…¥æŠŠè¡¥é½çš„å•è¯</span>word2id<span class="token punctuation">[</span>PAD_TEXT<span class="token punctuation">]</span> <span class="token operator">=</span> PAD_INDEX<span class="token comment"># ç”Ÿæˆå¥å­</span>sentences_ids <span class="token operator">=</span> process_text<span class="token punctuation">(</span>word2id<span class="token punctuation">,</span> SENTENCE_LEN<span class="token punctuation">,</span> PAD_INDEX<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token comment"># æ€»çš„å•è¯ç§ç±»</span>word_num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word2id<span class="token punctuation">)</span><span class="token comment"># embeddingçš„é•¿åº¦</span>embedding_len <span class="token operator">=</span> <span class="token number">10</span><span class="token comment"># ä½¿ç”¨è‡ªå·±å®ç°çš„å‡½æ•°embeddingå¥å­</span>embeddings<span class="token punctuation">,</span> embedding_sentences <span class="token operator">=</span> embedding_sentences_ids<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>word2id<span class="token punctuation">)</span><span class="token punctuation">,</span> embedding_len<span class="token punctuation">,</span> sentences_ids<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>embedding_sentences<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (7, 6, 10)</span><span class="token comment"># ä½¿ç”¨pytorchå†…ç½®çš„Embeddingæ¥embeddingå¥å­</span>torch_embedding <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span><span class="token punctuation">)</span>torch_embedding_sentences <span class="token operator">=</span> torch_embedding<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>sentences_ids<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>torch_embedding_sentences<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># torch.Size([7, 6, 10])</span><span class="token comment"># ç¡®ä¿ä¸¤ç§æ–¹å¼ç”Ÿæˆçš„ç»“æœæ˜¯ç›¸åŒçš„</span><span class="token keyword">assert</span> np<span class="token punctuation">.</span>allclose<span class="token punctuation">(</span>embedding_sentences<span class="token punctuation">,</span> torch_embedding_sentences<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># ä½¿ç”¨keraså†…ç½®çš„Embeddingæ¥embeddingå¥å­</span>keras_embedding <span class="token operator">=</span> keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>    word_num<span class="token punctuation">,</span> embedding_len<span class="token punctuation">,</span> embeddings_initializer<span class="token operator">=</span>keras<span class="token punctuation">.</span>initializers<span class="token punctuation">.</span>Constant<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span><span class="token punctuation">)</span>keras_embedding_sentences <span class="token operator">=</span> keras_embedding<span class="token punctuation">(</span>convert_to_tensor<span class="token punctuation">(</span>sentences_ids<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>keras_embedding_sentences<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token comment"># ç¡®ä¿ä¸¤ç§æ–¹å¼ç”Ÿæˆçš„ç»“æœæ˜¯ç›¸åŒçš„</span><span class="token keyword">assert</span> np<span class="token punctuation">.</span>allclose<span class="token punctuation">(</span>embedding_sentences<span class="token punctuation">,</span> keras_embedding_sentences<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-ä½¿ç”¨-Keras-ä¸­çš„-Embedding-æ¥è®­ç»ƒ-IMDB-é¢„æµ‹æ¨¡å‹"><a href="#4-ä½¿ç”¨-Keras-ä¸­çš„-Embedding-æ¥è®­ç»ƒ-IMDB-é¢„æµ‹æ¨¡å‹" class="headerlink" title="4. ä½¿ç”¨ Keras ä¸­çš„ Embedding æ¥è®­ç»ƒ IMDB é¢„æµ‹æ¨¡å‹"></a>4. ä½¿ç”¨ Keras ä¸­çš„ Embedding æ¥è®­ç»ƒ IMDB é¢„æµ‹æ¨¡å‹</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers<span class="token punctuation">,</span> models<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> imdb<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> sequencenum_words <span class="token operator">=</span> <span class="token number">1000</span>embedding_dim <span class="token operator">=</span> <span class="token number">16</span>maxlen <span class="token operator">=</span> <span class="token number">80</span>batch_size <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span> <span class="token operator">=</span> imdb<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span>num_words<span class="token operator">=</span>num_words<span class="token punctuation">)</span>x_train <span class="token operator">=</span> sequence<span class="token punctuation">.</span>pad_sequences<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> maxlen<span class="token operator">=</span>maxlen<span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">"post"</span><span class="token punctuation">)</span>x_test <span class="token operator">=</span> sequence<span class="token punctuation">.</span>pad_sequences<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> maxlen<span class="token operator">=</span>maxlen<span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">"post"</span><span class="token punctuation">)</span>model <span class="token operator">=</span> models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    <span class="token punctuation">[</span>        layers<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>num_words<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">,</span> input_length<span class="token operator">=</span>maxlen<span class="token punctuation">)</span><span class="token punctuation">,</span>        layers<span class="token punctuation">.</span>GlobalAveragePooling1D<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">"relu"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">"sigmoid"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">"adam"</span><span class="token punctuation">,</span> loss<span class="token operator">=</span><span class="token string">"binary_crossentropy"</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"accuracy"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> validation_split<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>score<span class="token punctuation">,</span> acc <span class="token operator">=</span> model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test score:"</span><span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test accuracy:"</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pytorch </tag>
            
            <tag> keras </tag>
            
            <tag> embedding </tag>
            
            <tag> padding </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iptablesç®€ä»‹</title>
      <link href="iptables-jian-jie/"/>
      <url>iptables-jian-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€netfilter-é¡¹ç›®"><a href="#ä¸€ã€netfilter-é¡¹ç›®" class="headerlink" title="ä¸€ã€netfilter é¡¹ç›®"></a>ä¸€ã€netfilter é¡¹ç›®</h2><p><a href="https://www.netfilter.org/">netfilter é¡¹ç›®</a>æ˜¯ <a href="https://www.kernel.org/">Linux</a> å†…æ ¸ä¸­ç”¨äºæ•°æ®åŒ…è¿‡æ»¤çš„æ¡†æ¶ã€‚</p><p>netfilter é¡¹ç›®æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å­é¡¹ç›®ï¼šiptables å’Œ nftablesã€‚</p><p><a href="https://www.nftables.org/projects/iptables/index.html">iptables é¡¹ç›®</a>ä¸­åŒ…å«äº†ä¸€ç³»åˆ—ç”¨äºé…ç½® Linux å†…æ ¸ä¸­åŒ…è¿‡æ»¤è§„åˆ™é›†å‘½ä»¤è¡Œå·¥å…·ï¼šiptablesï¼Œip6tablesï¼Œarptablesï¼Œebtablesã€‚</p><p><a href="https://www.nftables.org/projects/nftables/index.html">nftables é¡¹ç›®</a>åˆ™æ˜¯ iptables é¡¹ç›®çš„ç»§æ‰¿è€…ï¼Œå®ƒå…è®¸æ›´çµæ´»ã€å¯æ‰©å±•å’Œæ€§èƒ½æ›´é«˜çš„æ•°æ®åŒ…åˆ†ç±»ã€‚</p><p><strong>æœ¬æ–‡åªä»‹ç»ä½¿ç”¨ iptables å‘½ä»¤è¡Œå·¥å…·ç®¡ç† ip åè®®æ—¶æ‰€éœ€çš„ç›¸å…³å†…å®¹ã€‚</strong></p><h2 id="äºŒã€iptables-ä¸­çš„åŸºæœ¬æ¦‚å¿µ"><a href="#äºŒã€iptables-ä¸­çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="äºŒã€iptables ä¸­çš„åŸºæœ¬æ¦‚å¿µ"></a>äºŒã€iptables ä¸­çš„åŸºæœ¬æ¦‚å¿µ</h2><p>netfilter æ¡†æ¶çš„æ ¸å¿ƒæ˜¯åœ¨ Linux å†…æ ¸å¤„ç†æ•°æ®åŒ…è¿‡ç¨‹ä¸­çš„å‡ ä¸ªå…³é”®åœ°æ–¹è°ƒç”¨ <code>NF_HOOK</code> å‡½æ•°ï¼Œæ‹¦æˆªæ•°æ®åŒ…æ¥è¿›è¡Œå¤„ç†ã€‚</p><p><img src="/images/iptablesç®€ä»‹/nf-hooks.png" alt="nf-hooks"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://wiki.nftables.org/wiki-nftables/index.php/Netfilter_hooks">Netfilter hooks</a></p></blockquote><p>åˆ©ç”¨ netfilter æ¡†æ¶å¯å®ç°çš„åŠŸèƒ½åŒ…æ‹¬æ£€æŸ¥ã€ä¿®æ”¹ã€è½¬å‘ã€é‡å®šå‘å’Œ/æˆ–ä¸¢å¼ƒæ•°æ®åŒ…ã€‚</p><ol><li>æ ¹æ®ç”¨é€”çš„ä¸åŒï¼Œå°†å†…æ ¸ä¸­å¤„ç†æ•°æ®åŒ…çš„ä»£ç ç»„ç»‡æˆäº†å‡ ä¸ªä¸åŒçš„è¡¨ï¼ˆtableï¼‰ã€‚</li><li>è¡¨ç”±ä¸€ç»„çš„é“¾ï¼ˆchainï¼‰ç»„æˆã€‚</li><li>é“¾ä¸­åŒ…å«ä¸€ç³»åˆ—è§„åˆ™ï¼ˆruleï¼‰ã€‚</li><li>è§„åˆ™ç”±åŒ¹é…æ¡ä»¶å’Œç›¸åº”çš„æ‰§è¡ŒåŠ¨ä½œç»„æˆï¼ˆå¦‚æœæ¡ä»¶åŒ¹é…æˆåŠŸï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼‰ã€‚</li><li>é“¾ä¸­çš„è§„åˆ™ä¼šæŒ‰é¡ºåºçš„é€ä¸€æ‰§è¡Œï¼Œç›´åˆ°æŸä¸ªåŒ¹é…çš„åŠ¨ä½œå¤„ç†çš„ç»“æœæ˜¯ç»ˆæ­¢å¤„ç†æˆ–<a href="#é¢„å®šä¹‰çš„é“¾">é¢„å®šä¹‰çš„é“¾</a>å†…çš„è§„åˆ™éƒ½æ‰§è¡Œå®Œã€‚</li></ol><h3 id="2-1-è¡¨"><a href="#2-1-è¡¨" class="headerlink" title="2.1 è¡¨"></a>2.1 è¡¨</h3><p>netfilter ä¸­æ€»å…±åŒ…å«äº”ä¸ªè¡¨ï¼š</p><ol><li><strong>raw</strong>ï¼šç”¨äºæ ‡è®°æ•°æ®åŒ…ï¼Œè®©å®ƒä¸è¢«è¿æ¥è·Ÿè¸ªç³»ç»Ÿè·Ÿè¸ªï¼›</li><li><strong>filter</strong>ï¼šç”¨äºè¿‡æ»¤æ•°æ®åŒ…ï¼›</li><li><strong>nat</strong>ï¼šç”¨æ¥å®Œæˆ<a href="https://en.wikipedia.org/wiki/Network_address_translation">ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰</a>åŠŸèƒ½ï¼›</li><li><strong>mangle</strong>ï¼šç”¨äºä¿®æ”¹æ•°æ®åŒ…ï¼›</li><li><strong>security</strong>ï¼šç”¨äº<a href="https://en.wikipedia.org/wiki/Mandatory_access_control">å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰</a>ç½‘ç»œè§„åˆ™ï¼ˆæ¯”å¦‚SELinuxï¼Œ<a href="https://lwn.net/Articles/267140/">æ›´å¤šç›¸å…³ä¿¡æ¯</a>ï¼‰ã€‚</li></ol><h3 id="2-2-é¢„å®šä¹‰çš„é“¾"><a href="#2-2-é¢„å®šä¹‰çš„é“¾" class="headerlink" title="2.2 é¢„å®šä¹‰çš„é“¾"></a>2.2 é¢„å®šä¹‰çš„é“¾</h3><p>é“¾çš„æœ¬è´¨å…¶å®æ˜¯ Linux å†…æ ¸å¤„ç†æ•°æ®åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œnetfilter æ¡†æ¶åµŒå…¥ HOOK å‡½æ•°çš„åœ°æ–¹ã€‚</p><p>netfilter æ¡†æ¶åœ¨ Linux å†…æ ¸å¤„ç†å¾ˆå¤šåè®®ï¼ˆæ¯”å¦‚ï¼šipï¼Œip6ï¼Œarpç­‰ï¼‰çš„è¿‡ç¨‹ä¸­éƒ½åµŒå…¥äº† HOOK å‡½æ•°ï¼Œæœ¬æ–‡åªå…³æ³¨ iptables å¤„ç† ip åè®®ç”¨åˆ°çš„ã€‚</p><p>iptables åœ¨æ¯ä¸€ä¸ªåµŒå…¥äº† HOOK å‡½æ•°çš„åœ°æ–¹éƒ½é¢„å®šä¹‰äº†ä¸€äº›é“¾ï¼š</p><ol><li><strong>PREROUTING</strong>ï¼šæ¥æ”¶åˆ°æ•°æ®åŒ…ä½†æ˜¯è¿˜æœªåˆ¤æ–­å…¶ç›®çš„åœ°æ˜¯å¦æ˜¯æœ¬æœºã€‚</li><li><strong>INPUT</strong>ï¼šæ•°æ®åŒ…çš„ç›®çš„åœ°æ˜¯æœ¬æœºä½†æ˜¯è¿˜æœªäº¤ç»™åè®®æ ˆçš„ä¸Šå±‚å¤„ç†ã€‚</li><li><strong>OUTPUT</strong>ï¼šæ•°æ®åŒ…æ˜¯ç”±æœ¬æœºå‘å‡ºçš„ã€‚</li><li><strong>FORWARD</strong>ï¼šæ•°æ®åŒ…çš„ç›®çš„åœ°ä¸æ˜¯æœ¬æœºçš„ã€‚</li><li><strong>POSTROUTING</strong>ï¼šæ•°æ®åŒ…åœ¨ç¦»å¼€æœ¬æœºä¹‹å‰ã€‚</li></ol><p><img src="/images/iptablesç®€ä»‹/iptablesé¢„å®šä¹‰çš„é“¾.jpg" alt="iptablesé¢„å®šä¹‰çš„é“¾"></p><p>é¢„å®šä¹‰çš„é“¾æ”¯æŒè®¾ç½®é»˜è®¤çš„æ•°æ®åŒ…å¤„ç†ç­–ç•¥ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°† INPUT é“¾çš„é»˜è®¤æ•°æ®åŒ…å¤„ç†ç­–ç•¥è®¾ç½®ä¸º ACCEPTï¼ˆå…è®¸åŒ…é€šè¿‡ï¼‰</span><span class="token function">sudo</span> iptables -P INPUT ACCEPT<span class="token comment"># å°† FORWARD é“¾çš„é»˜è®¤æ•°æ®åŒ…å¤„ç†ç­–ç•¥è®¾ç½®ä¸º DROPï¼ˆä¸¢å¼ƒæ‰€æœ‰çš„åŒ…ï¼‰</span><span class="token function">sudo</span> iptables -P FORWARD DROP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-è¡¨å’Œé¢„å®šä¹‰çš„é“¾"><a href="#2-3-è¡¨å’Œé¢„å®šä¹‰çš„é“¾" class="headerlink" title="2.3 è¡¨å’Œé¢„å®šä¹‰çš„é“¾"></a>2.3 è¡¨å’Œé¢„å®šä¹‰çš„é“¾</h3><p>æ ¹æ®è¡¨çš„åŠŸèƒ½å’Œé“¾æ‰€åœ¨çš„ä½ç½®ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªè¡¨éƒ½éœ€è¦æ‰€æœ‰çš„é“¾ã€‚</p><ol><li><p>raw è¡¨</p><p> raw è¡¨ç”¨äºå°±æ˜¯æ ‡è®°æ•°æ®åŒ…ï¼Œè®©å®ƒä¸è¢«è¿æ¥è·Ÿè¸ªç³»ç»Ÿè·Ÿè¸ªã€‚</p><ul><li><strong>PREROUTING</strong>ï¼šæ ‡è®°æ”¶åˆ°çš„æ‰€æœ‰æ•°æ®åŒ…ï¼›</li><li><strong>OUTPUT</strong>ï¼šæ ‡è®°æœ¬æœºå‘å‡ºçš„æ‰€æœ‰æ•°æ®åŒ…ã€‚</li></ul></li><li><p>filter è¡¨</p><p> filter è¡¨ç”¨äºè¿‡æ»¤æ•°æ®åŒ…ã€‚</p><ul><li><strong>INPUT</strong>ï¼šè¿‡æ»¤å‘ç»™æœ¬æœºçš„åŒ…ï¼›</li><li><strong>OUTPUT</strong>ï¼šè¿‡æ»¤æœ¬æœºå‘å‡ºçš„åŒ…ï¼›</li><li><strong>FORWARD</strong>ï¼šè¿‡æ»¤ä»æœ¬æœºç»è¿‡çš„ä½†ä¸æ˜¯å‘ç»™æœ¬æœºçš„åŒ…ã€‚</li></ul></li><li><p>nat è¡¨</p><p> nat è¡¨ç”¨äºå®Œæˆ NAT åŠŸèƒ½ã€‚</p><ul><li><strong>PREROUTING</strong>ï¼šä¿®æ”¹æ•°æ®åŒ…çš„ç›®çš„åœ°å€ï¼Œå®Œæˆ DNAT åŠŸèƒ½ï¼›</li><li><strong>INPUT</strong>ï¼šä¿®æ”¹å‘ç»™æœ¬æœºæ•°æ®åŒ…çš„æºåœ°å€ï¼Œå®Œæˆ SNAT åŠŸèƒ½ï¼›</li><li><strong>OUTPUT</strong>ï¼šä¿®æ”¹æœ¬æœºå‘å‡ºæ•°æ®åŒ…çš„ç›®çš„åœ°å€ï¼Œå®Œæˆ DNAT åŠŸèƒ½ï¼›</li><li><strong>POSTROUTING</strong>ï¼šä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€ï¼Œå®Œæˆ SNAT åŠŸèƒ½ã€‚</li></ul></li><li><p>mangle è¡¨</p><p> mangle è¡¨ç”¨äºä¿®æ”¹æ•°æ®åŒ…ã€‚</p><ul><li><strong>PREROUTING</strong>ï¼›</li><li><strong>INPUT</strong>ï¼›</li><li><strong>OUTPUT</strong>ï¼›</li><li><strong>FORWARD</strong>ï¼›</li><li><strong>POSTROUTING</strong>ã€‚</li></ul></li><li><p>security è¡¨</p><p> security è¡¨ç”¨äºå®Œæˆä¸å®‰å…¨ç›¸å…³çš„æ ‡è®°åŠŸèƒ½ã€‚</p><ul><li><strong>INPUT</strong>ï¼›</li><li><strong>OUTPUT</strong>ï¼›</li><li><strong>FORWARD</strong>ã€‚</li></ul></li></ol><p><img src="/images/iptablesç®€ä»‹/iptablesçš„è¡¨å’Œé¢„å®šä¹‰çš„é“¾.png" alt="iptablesçš„è¡¨å’Œé¢„å®šä¹‰çš„é“¾"></p><h3 id="2-4-è‡ªå®šä¹‰çš„é“¾"><a href="#2-4-è‡ªå®šä¹‰çš„é“¾" class="headerlink" title="2.4 è‡ªå®šä¹‰çš„é“¾"></a>2.4 è‡ªå®šä¹‰çš„é“¾</h3><p>é™¤äº†ä½¿ç”¨é¢„å®šçš„é“¾å¤–ï¼Œiptablesè¿˜æ”¯æŒè‡ªå®šä¹‰é“¾ã€‚æ•°æ®åŒ…åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­èƒ½å¤Ÿé€šè¿‡ jump åŠ¨ä½œè·³è½¬åˆ°åŒä¸€ä¸ªè¡¨çš„å¦ä¸€ä¸ªé“¾ï¼ˆè¿™ä¸ªé“¾å¿…é¡»æ˜¯è‡ªå®šä¹‰çš„ï¼Œä¸èƒ½æ˜¯é¢„å®šäºçš„ï¼‰ä¸Šç»§ç»­å¤„ç†ã€‚</p><p>åŒæ—¶ï¼Œè‡ªå®šä¹‰çš„é“¾ä¸æ”¯æŒè®¾ç½®é»˜è®¤æ•°æ®åŒ…å¤„ç†ç­–ç•¥ï¼Œå…¶é»˜è®¤çš„å¤„ç†ç­–ç•¥æ˜¯è¿”å›çˆ¶é“¾ä¸­ç»§ç»­è¿›è¡Œå¤„ç†ã€‚</p><p>åœ¨ä¸‹é¢çš„å›¾ä¸­ï¼Œåœ¨é“¾ 1 ä¸­çš„ è§„åˆ™ 3 æ—¶åŒ¹é…æˆåŠŸï¼Œè·³åˆ°é“¾ 2 ä»å¤´å¼€å§‹æ‰§è¡Œï¼Œæœ€åé€šè¿‡é“¾ 2 è¿”å›åˆ°é“¾ 1 çš„è§„åˆ™ 4 ç»§ç»­æ‰§è¡Œã€‚</p><p><img src="/images/iptablesç®€ä»‹/iptablesè‡ªå®šä¹‰çš„é“¾.jpg" alt="iptablesè‡ªå®šä¹‰çš„é“¾"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#USERTABLES">User specified chains</a></p></blockquote><h3 id="2-5-è¿æ¥çŠ¶æ€"><a href="#2-5-è¿æ¥çŠ¶æ€" class="headerlink" title="2.5 è¿æ¥çŠ¶æ€"></a>2.5 è¿æ¥çŠ¶æ€</h3><p>Linux å†…æ ¸ä¸­ä¸€ä¸ªåä¸º <code>conntrack</code> çš„æ¨¡å—æä¾›äº†è¿æ¥çŠ¶æ€çš„è·Ÿè¸ªåŠŸèƒ½ï¼Œå¯ä»¥è·Ÿè¸ªå„ç§åè®®çš„è¿æ¥å¹¶æ ‡è®°çŠ¶æ€ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿æ¥è·Ÿè¸ªä¸­çš„è¿æ¥ä¸ TCP/IP ä¸­ TCP çš„è¿æ¥ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚</strong></p><p>è¿æ¥ä¸»è¦æœ‰äº”ç§çŠ¶æ€ï¼š</p><ol><li><p><strong>NEW</strong></p><p> æ­¤çŠ¶æ€è¡¨ç¤ºæ•°æ®åŒ…æ˜¯ç³»ç»Ÿçœ‹åˆ°çš„æŸä¸ªè¿æ¥ä¸Šçš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ã€‚æ¯”å¦‚ï¼Œå¯¹äº TCP æ¥è¯´ï¼Œä¸‰æ¬¡æ¡æ‰‹æ”¶åˆ°çš„ä¸€ä¸ªåŒ…çš„çŠ¶æ€å°±æ˜¯è¿™ä¸ªçŠ¶æ€ã€‚</p><blockquote><p>ä¸ç®¡æ˜¯æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè¿˜æ˜¯å‘å‡ºçš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…éƒ½éƒ½ç®—æ˜¯ç¬¬ä¸€ä¸ªã€‚</p><p>ä¸ç®¡æ•°æ®åŒ…æ˜¯å¦æ˜¯æ­£å¸¸çš„ï¼Œåªè¦æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®åŒ…éƒ½ç®—ã€‚æ¯”å¦‚ï¼Œå¯¹äº TCP çš„ä¸‰æ¬¡æ¡æ‰‹æ¥è¯´ï¼Œæ­£å¸¸æ¡æ‰‹çš„ç¬¬ä¸€ä¸ªåŒ…ä¸­ä»…åŒ…æ‹¬ SYN æ ‡è®°ï¼Œä½†æ˜¯å¦‚æœç¬¬ä¸€ä¸ªåŒ…ä¸­åŒ…å«äº†é”™è¯¯çš„æ ‡è®°ï¼ˆå¦‚ï¼šSYNï¼ŒRSTï¼‰ï¼Œä¹Ÿä¼šç®—æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ã€‚</p></blockquote></li><li><p><strong>ESTABLISHED</strong></p><p> æ­¤çŠ¶æ€è¡¨ç¤ºç³»ç»Ÿåœ¨é€šä¿¡çš„åŒå‘éƒ½çœ‹åˆ°äº†æµé‡é€šä¿¡ï¼Œå¹¶ä¸”åç»­çš„æ•°æ®åŒ…éƒ½ä¼šæ˜¯è¿™ä¸ªçŠ¶æ€ã€‚åªéœ€è¦ä¸€ä¸ªæœºå™¨å‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå¹¶æ”¶åˆ°æƒ³è¦çš„åº”ç­”æ•°æ®åŒ…åï¼Œè¿æ¥å°±ä¼šè¿›å…¥æ­¤çŠ¶æ€ï¼ˆå³ä½¿æ”¶åˆ°çš„æ˜¯ä¸€ä¸ª ICMP çš„é”™è¯¯æŠ¥å‘Šï¼‰ã€‚</p></li><li><p><strong>RELATED</strong></p><p> æ­¤çŠ¶æ€è¡¨æ˜ä¸€ä¸ªè¿æ¥å’Œå¦ä¸€ä¸ªå·²ç»å¤„äº <strong>ESTABLISHED</strong> çŠ¶æ€çš„è¿æ¥æœ‰å…³æ—¶ï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯è¿™ä¸ªçŠ¶æ€ã€‚</p><p> è¿æ¥è¿›å…¥æ­¤çŠ¶æ€çš„å‰ææ˜¯å·²æœ‰ä¸€ä¸ªå¤„äº <strong>ESTABLISHED</strong> çŠ¶æ€ï¼Œ<strong>å¹¶ä¸” Linux å†…æ ¸èƒ½å¤Ÿç†è§£è¿™ä¸ªè¿æ¥</strong>ï¼ŒåŒæ—¶è¿™ä¸ªè¿æ¥å¦å¤–å†äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè¿™ä¸ªæ–°çš„è¿æ¥çš„çŠ¶æ€å°±æ˜¯ <strong>RELATED</strong> ã€‚æ¯”å¦‚ FTP çš„ Data è¿æ¥å°±æ˜¯æ ¹æ® FTP çš„ Control è¿æ¥äº§ç”Ÿçš„ï¼Œæ‰€ä»¥ FTP çš„ Control è¿æ¥æ˜¯ <strong>ESTABLISHED</strong> çŠ¶æ€ï¼ŒFTP çš„ Data è¿æ¥æ˜¯ <strong>RELATED</strong> çŠ¶æ€ã€‚</p></li><li><p><strong>INVALID</strong></p><p> æ­¤çŠ¶æ€è¡¨æ˜æ•°æ®åŒ…ä¸èƒ½è¢«è¯†åˆ«æˆ–è€…å®ƒæ²¡æœ‰ä»»ä½•çŠ¶æ€ã€‚å¯¼è‡´çš„åŸå› å¯èƒ½æ˜¯ç³»ç»Ÿå†…å­˜ä¸è¶³æˆ–æ˜¯ ICMP çš„é”™è¯¯æŠ¥å‘Šä¸èƒ½åŒ¹é…ä¸Šæœ¬åœ°çš„ä»»ä½•è¿æ¥ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ¨èä¸¢å¼ƒæ­¤çŠ¶æ€çš„æ•°æ®åŒ…ã€‚</p></li><li><p><strong>UNTRACKED</strong></p><p> æ­¤çŠ¶æ€è¡¨æ˜æ•°æ®åŒ…è¢«æ ‡è®°ä¸ºäº†ä¸è·Ÿè¸ªï¼ŒåŒæ—¶ä¸æ­¤è¿æ¥ç›¸å…³çš„åŸæœ¬æ˜¯ <strong>RELATED</strong> çŠ¶æ€çš„è¿æ¥ä¹Ÿä¼šæ˜¯æ­¤çŠ¶æ€ã€‚</p></li></ol><p>å†…æ ¸å¯¹äºæ¯ä¸€ç§ç½‘ç»œåŒ…ï¼Œéƒ½è®¾ç½®äº†ä¸¤ä¸ªè®°å½•ç‚¹ï¼š</p><ol><li>å¯¹äºå‘ç»™æœ¬æœºçš„åŒ…ï¼Œåœ¨ <strong>PREROUTING</strong> è°ƒç”¨ <code>ipv4_conntrack_in</code>ï¼Œåˆ›å»ºè¿æ¥è·Ÿè¸ªè®°å½•ï¼›åœ¨ <strong>INPUT</strong> è°ƒç”¨ <code>ipv4_confirm</code>ï¼Œå°†è¿™ä¸ªè¿æ¥è·Ÿè¸ªè®°å½•æŒ‚åœ¨å†…æ ¸çš„è¿æ¥è·Ÿè¸ªè¡¨é‡Œé¢ã€‚</li><li>å¯¹äºæœ¬åœ°å‘å‡ºçš„åŒ…ï¼Œåœ¨ <strong>OUTPUT</strong> è°ƒç”¨ <code>ipv4_conntrack_local</code>ï¼Œåˆ›å»ºè¿æ¥è·Ÿè¸ªè®°å½•ï¼›åœ¨ <strong>POSTROUTING</strong> è°ƒç”¨ <code>ipv4_confirm</code>ï¼Œå°†è¿™ä¸ªè¿æ¥è·Ÿè¸ªè®°å½•æŒ‚åœ¨å†…æ ¸çš„è¿æ¥è·Ÿè¸ªè¡¨é‡Œé¢ã€‚</li><li><p>å¯¹äºç»è¿‡æœ¬æœºçš„åŒ…ï¼Œåœ¨ <strong>PREROUTING</strong> è°ƒç”¨ <code>ipv4_conntrack_in</code>ï¼Œåˆ›å»ºè¿æ¥è·Ÿè¸ªè®°å½•ï¼›åœ¨ <strong>POSTROUTING</strong> è°ƒç”¨ <code>ipv4_confirm</code>ï¼Œå°†è¿™ä¸ªè¿æ¥è·Ÿè¸ªè®°å½•æŒ‚åœ¨å†…æ ¸çš„è¿æ¥è·Ÿè¸ªè¡¨é‡Œé¢ã€‚</p><blockquote><p>å¯¹äºç»è¿‡æœ¬æœºçš„ NAT åŒ…ï¼Œåœ¨ <strong>PREROUTING</strong> è°ƒç”¨ <code>ipv4_conntrack_in</code>ï¼Œåˆ›å»ºè¿æ¥è·Ÿè¸ªè®°å½•ï¼Œå¹¶è°ƒç”¨ <code>nf_nat_ipv4_in</code> è¿›è¡Œåœ°å€è½¬æ¢ï¼›åœ¨ <strong>POSTROUTING</strong> è°ƒç”¨ <code>nf_nat_ipv4_out</code> è¿›è¡Œåœ°å€è½¬æ¢ï¼Œå¹¶è°ƒç”¨ <code>ipv4_confirm</code>ï¼Œå°†è¿™ä¸ªè¿æ¥è·Ÿè¸ªè®°å½•æŒ‚åœ¨å†…æ ¸çš„è¿æ¥è·Ÿè¸ªè¡¨é‡Œé¢ã€‚</p></blockquote></li></ol><blockquote><p>å› ä¸ºæœ‰ <strong>filter</strong> è¡¨å¯èƒ½ä¼šæŠŠåŒ…è¿‡æ»¤æ‰ï¼Œä¹Ÿå°±æ˜¯ä¸¢å¼ƒäº†ï¼Œæ‰€ä»¥æ‰éœ€è¦ä¸¤ä¸ªè®°å½•ç‚¹ã€‚</p></blockquote><h2 id="ä¸‰ã€iptables-è§„åˆ™çš„åŒ¹é…æ¡ä»¶"><a href="#ä¸‰ã€iptables-è§„åˆ™çš„åŒ¹é…æ¡ä»¶" class="headerlink" title="ä¸‰ã€iptables è§„åˆ™çš„åŒ¹é…æ¡ä»¶"></a>ä¸‰ã€iptables è§„åˆ™çš„åŒ¹é…æ¡ä»¶</h2><p>å‚è€ƒï¼š<a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#MATCHES">Iptables matches</a>ã€‚</p><h2 id="å››ã€iptables-è§„åˆ™çš„æ‰§è¡ŒåŠ¨ä½œ"><a href="#å››ã€iptables-è§„åˆ™çš„æ‰§è¡ŒåŠ¨ä½œ" class="headerlink" title="å››ã€iptables è§„åˆ™çš„æ‰§è¡ŒåŠ¨ä½œ"></a>å››ã€iptables è§„åˆ™çš„æ‰§è¡ŒåŠ¨ä½œ</h2><p>å‚è€ƒï¼š<a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#TARGETS">Iptables targets and jumps</a>ã€‚</p><h2 id="äº”ã€å¸¸è§é—®é¢˜"><a href="#äº”ã€å¸¸è§é—®é¢˜" class="headerlink" title="äº”ã€å¸¸è§é—®é¢˜"></a>äº”ã€å¸¸è§é—®é¢˜</h2><h3 id="1-NAT-èƒ½å»ºç«‹å¤šå°‘è¿æ¥"><a href="#1-NAT-èƒ½å»ºç«‹å¤šå°‘è¿æ¥" class="headerlink" title="1. NAT èƒ½å»ºç«‹å¤šå°‘è¿æ¥"></a>1. NAT èƒ½å»ºç«‹å¤šå°‘è¿æ¥</h3><p>DNAT å³å¤–ç½‘è®¿é—®å†…ç½‘çš„æŸä¸ªæœåŠ¡ï¼Œæ˜¯æ²¡æœ‰ç«¯å£æ•°ç›®é™åˆ¶çš„ã€‚</p><p>SNAT å³å†…ç½‘è®¿é—®å¤–ç½‘çš„åœºæ™¯ï¼Œé‰´äº conntrack æ˜¯ç”± <strong>{æº IPï¼Œæºç«¯å£ï¼Œç›®æ ‡ IPï¼Œç›®æ ‡ç«¯å£}</strong>ï¼Œhash åç¡®å®šçš„ã€‚æ‰€ä»¥å¦‚æœå†…ç½‘æœºå™¨å¾ˆå¤šï¼Œä½†æ˜¯è®¿é—®çš„æ˜¯ä¸åŒçš„å¤–ç½‘ï¼Œä¹Ÿå³ç›®æ ‡ IP å’Œç›®æ ‡ç«¯å£å¾ˆå¤šï¼Œè¿™æ ·å†…ç½‘å¯æ‰¿è½½çš„æ•°é‡å°±éå¸¸å¤§ï¼Œå¯ä¸æ­¢ 65535 ä¸ªã€‚</p><p>ä½†æ˜¯å¦‚æœå†…ç½‘æ‰€æœ‰çš„æœºå™¨ï¼Œéƒ½ä¸€å®šè¦è®¿é—®åŒä¸€ä¸ªç›®æ ‡ IP å’Œç›®æ ‡ç«¯å£ï¼Œè¿™æ ·æº IP å¦‚æœåªæœ‰ä¸€ä¸ªï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæ‰å— 65535 çš„ç«¯å£æ•°ç›®é™åˆ¶ï¼Œæ ¹æ®åŸç†ï¼Œä¸€ç§æ–¹æ³•å°±æ˜¯å¤šä¸ªæº IPï¼Œå¦å¤–çš„æ–¹æ³•å°±æ˜¯å¤šä¸ª NAT ç½‘å…³ï¼Œæ¥åˆ†æ‘Šä¸åŒçš„å†…ç½‘æœºå™¨è®¿é—®ã€‚</p><h2 id="å…­ã€å‚è€ƒèµ„æ–™"><a href="#å…­ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å…­ã€å‚è€ƒèµ„æ–™"></a>å…­ã€å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://wiki.archlinux.org/title/Iptables">iptables</a></li><li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Configuring_chains">Configuring chains</a></li><li><a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html">Iptables Tutorial 1.2.2</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> netfilter </tag>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCPä¸­çš„keepaliveæœºåˆ¶</title>
      <link href="tcp-zhong-de-keepalive-ji-zhi/"/>
      <url>tcp-zhong-de-keepalive-ji-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€RFC1122"><a href="#ä¸€ã€RFC1122" class="headerlink" title="ä¸€ã€RFC1122"></a>ä¸€ã€RFC1122</h2><p>å…³äº TCP ä¸­ keepalive æœºåˆ¶çš„æè¿°åœ¨ <a href="https://datatracker.ietf.org/doc/html/rfc1122#page-101">RFC1122 ä¸­çš„ 4.2.3.6 å°ç»“</a> ï¼Œå†…å®¹ä¸å¤šï¼Œæ€»ç»“ä¸€ä¸‹æœ‰ä¸‹é¢å‡ ç‚¹ï¼š</p><ol><li>TCP å®ç°ä¸­ <strong>å¯ä»¥</strong> åŒ…å« keepalive è¿™ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«ã€‚</li><li>å¦‚æœå®ç°äº† keepalive è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆ <strong>å¿…é¡»</strong> èƒ½ä¸ºæ¯ä¸ª TCP è¿æ¥å¼€å¯æˆ–è€…å…³é—­ keepalive åŠŸèƒ½ã€‚åŒæ—¶ï¼Œæ­¤åŠŸèƒ½é»˜è®¤ <strong>å¿…é¡»</strong> æ˜¯å…³é—­çš„ã€‚</li><li><strong>å¿…é¡»</strong> åœ¨è§„å®šçš„æ—¶é—´é—´éš”å†…ï¼Œæ—¢æ²¡æœ‰æ”¶åˆ°åŒ…å«æ•°æ®åŒ…ï¼Œä¹Ÿæ²¡æœ‰æ”¶åˆ°åŒ…å« ACK æ ‡è®°çš„åŒ…æ—¶ï¼Œæ‰èƒ½å‘é€ keepalive çš„åŒ…ã€‚è¿™ä¸ªæ—¶é—´é—´éš” <strong>å¿…é¡»</strong> æ˜¯å¯é…ç½®çš„ï¼Œå¹¶ä¸”é»˜è®¤ <strong>å¿…é¡»</strong> ä¸èƒ½å°äºä¸¤ä¸ªå°æ—¶ã€‚</li><li>TCP ä¸èƒ½ä¿è¯æ²¡æœ‰æ•°æ®ä»…æœ‰ ACK æ ‡è®°çš„åŒ…ä¸€å®šä¼šè¢«å¯¹ç«¯æ¥æ”¶åˆ°ã€‚æ‰€ä»¥ï¼Œå¦‚æœå®ç°äº† keepalive æœºåˆ¶ï¼Œ<strong>å¿…é¡»</strong> ä¸èƒ½æŠŠä»»ä½•ç‰¹å®šæ¢æµ‹å¤±è´¥çš„è¿æ¥æ ‡è®°ä¸ºæ­»é“¾æ¥ã€‚</li><li>keepalive çš„å®ç° <strong>åº”è¯¥</strong> æ˜¯å‘é€ä¸€ä¸ªä¸åŒ…å«æ•°æ®çš„ keepalive åŒ…ã€‚ä½†æ˜¯ä¸ºäº†ä¸ä¸è§„èŒƒçš„ TCP å®ç°å…¼å®¹ï¼Œ<strong>å¯ä»¥</strong> é…ç½®åœ¨ keepalive åŒ…ä¸­åŒ…å«ä¸€ä¸ªåƒåœ¾çš„å­—èŠ‚ï¼Œæ¥é¿å…ç¬¬ 4 ç‚¹çš„æƒ…å†µã€‚</li><li>ä¸€äº› TCP å®ç° keepalive çš„æ–¹å¼æ˜¯ï¼šå‘é€ä¸€ä¸ª Seq ç¼–å·ä¸º Next-1 ï¼ˆå¦‚æœæ˜¯æ­£å¸¸çš„æ•°æ®å‘é€ Seq çš„å€¼åº”ä¸º Next ï¼‰ï¼Œå¹¶ä¸”å¯èƒ½åŒ…å«æˆ–è€…ä¸åŒ…å«ä¸€ä¸ªåƒåœ¾å­—èŠ‚çš„åŒ…ç»™å¯¹ç«¯ã€‚å› ä¸º keepalive åŒ…ä¸­çš„ Seq å€¼åœ¨å¯¹ç«¯ TCP çš„æ»‘åŠ¨çª—å£ä¹‹å¤–ï¼ˆå› ä¸ºå·²ç»ç¡®è®¤æ”¶åˆ°äº†ï¼‰ï¼Œæ‰€ä»¥å¯¹ç«¯ä¼šå›åº”ä¸€ä¸ªåŒ…å«æœ‰ ACK æ ‡è®°çš„åŒ…ï¼Œå¹¶æ®æ­¤æ¥åˆ¤æ–­å¯¹ç«¯æ˜¯å¦å­˜æ´»ã€‚å¦‚æœå¯¹ç«¯ç½‘ç»œæ•…éšœæˆ–è€…å´©æºƒï¼Œåˆ™ä¼šå›åº”ä¸€ä¸ªå¸¦æœ‰ RST æ ‡è®°çš„åŒ…æ¥é‡ç½®è¿æ¥ã€‚</li><li>ä¸€äº›ä¸å¤Ÿå®Œå–„çš„ TCP å®ç°å¯èƒ½ä¸èƒ½æ­£ç¡®çš„å“åº” Seq ç¼–å·ä¸º Next-1 ä¸”ä¸å¸¦æ•°æ®çš„ keepalive åŒ…ï¼Œä½†æ˜¯å´å¯ä»¥å“åº”å¸¦æœ‰ä¸€ä¸ªå­—èŠ‚åƒåœ¾ä¿¡æ¯çš„åŒ…ã€‚æ‰€ä»¥åœ¨å®ç° keepalive æœºåˆ¶æ—¶ï¼Œéœ€è¦åˆ¤æ–­è¿™ç§æƒ…å†µï¼Œå¹¶æ®æ­¤å†³å®šåœ¨å‘é€ keepalive åŒ…æ—¶ï¼Œæ˜¯å¦è¦å¸¦ä¸Šä¸€å­—èŠ‚çš„åƒåœ¾æ•°æ®ã€‚</li><li>TCP çš„ keepalive æœºåˆ¶åº”è¯¥ä»…ç”¨åœ¨æœåŠ¡å™¨çš„ç¨‹åºä¸­ï¼Œå› ä¸ºå¦‚æœå®¢æˆ·ç«¯å´©æºƒï¼ŒæœåŠ¡å™¨å°±èƒ½åŠæ—¶çš„é‡Šæ”¾èµ„æºã€‚</li></ol><h2 id="äºŒã€ç›¸å…³è®¾ç½®"><a href="#äºŒã€ç›¸å…³è®¾ç½®" class="headerlink" title="äºŒã€ç›¸å…³è®¾ç½®"></a>äºŒã€ç›¸å…³è®¾ç½®</h2><h3 id="1-SO-KEEPALIVE"><a href="#1-SO-KEEPALIVE" class="headerlink" title="1. SO_KEEPALIVE"></a>1. SO_KEEPALIVE</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°åˆ›å»ºå‡ºæ¥çš„å¥—æ¥å­—çš„ keepalive åŠŸèƒ½éƒ½æ˜¯å…³é—­çš„ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> keepalive <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_KEEPALIVE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>keepalive<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>keepalive<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-TCP-KEEPIDLE"><a href="#2-TCP-KEEPIDLE" class="headerlink" title="2. TCP_KEEPIDLE"></a>2. TCP_KEEPIDLE</h3><p>è¿™ä¸ªé€‰é¡¹ç”¨äºæ§åˆ¶ç»è¿‡å¤šä¹…åï¼Œæ—¢æ²¡æœ‰æ”¶åˆ°åŒ…å«æ•°æ®åŒ…ï¼Œä¹Ÿæ²¡æœ‰æ”¶åˆ°åŒ…å« ACK æ ‡è®°çš„åŒ…æ—¶ï¼Œå°±å‘é€ keepalive çš„åŒ…ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> keepidle <span class="token operator">=</span> <span class="token number">7200</span><span class="token punctuation">;</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPIDLE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>keepidle<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>keepidle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>Windowsä¸‹ï¼Œä»£ç ä¸­çš„ <code>SOL_TCP</code> è¦æ›¿æ¢æˆ <code>IPPROTO_TCP</code>ï¼Œä¸‹åŒã€‚</p></blockquote><h3 id="3-TCP-KEEPINTVL"><a href="#3-TCP-KEEPINTVL" class="headerlink" title="3. TCP_KEEPINTVL"></a>3. TCP_KEEPINTVL</h3><p>è¿™ä¸ªé€‰é¡¹ç”¨äºæ§åˆ¶ä¸€æ—¦å¼€å§‹å‘é€äº† keepalive åï¼Œç»è¿‡å¤šä¹…æ—¶é—´åå†å‘é€ä¸‹ä¸€ä¸ªåŒ…ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> keepintvl <span class="token operator">=</span> <span class="token number">75</span><span class="token punctuation">;</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPINTVL<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>keepintvl<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>keepintvl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4-TCP-KEEPCNT"><a href="#4-TCP-KEEPCNT" class="headerlink" title="4. TCP_KEEPCNT"></a>4. TCP_KEEPCNT</h3><p>è¿™ä¸ªé€‰é¡¹ç”¨äºæ§åˆ¶åœ¨ç»è¿‡å‘é€äº†å¤šå°‘ä¸ª keepalive åŒ…ä½†æ˜¯éƒ½æ²¡æœ‰æ”¶åˆ°å›å¤åï¼Œå¯ä»¥è®¤ä¸ºè¿æ¥å·²ç»æ–­å¼€äº†ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> keepcnt <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPCNT<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>keepcnt<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>keepcnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="5-é»˜è®¤å€¼"><a href="#5-é»˜è®¤å€¼" class="headerlink" title="5. é»˜è®¤å€¼"></a>5. é»˜è®¤å€¼</h3><p>Linuxä¸‹ï¼Œç³»ç»Ÿçš„é»˜è®¤å€¼å¯ä»¥é€šè¿‡å‘½ä»¤æ¥æŸ¥çœ‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /proc/sys/net/ipv4/tcp_keepalive_time <span class="token comment">#7200</span><span class="token function">cat</span> /proc/sys/net/ipv4/tcp_keepalive_intvl <span class="token comment">#75</span><span class="token function">cat</span> /proc/sys/net/ipv4/tcp_keepalive_probes <span class="token comment">#9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¸Šé¢å‚æ•°çš„æ„ä¹‰æ˜¯ï¼šåœ¨æœªæ”¶åˆ°åŒ…å«æ•°æ®æˆ– ACK æ ‡å¿—çš„åŒ… 7200 ç§’åï¼Œå¼€å§‹å‘é€ keepalive åŒ…ï¼Œå¹¶æ¯éš” 75 ç§’é‡å‘ä¸€æ¬¡ï¼Œå¦‚æœè¿å‘ 9 æ¬¡éƒ½æ²¡æœ‰å“åº”ï¼Œå°±è®¤ä¸ºç½‘ç»œå·²æ–­å¼€ã€‚ä½†æ˜¯å¦‚æœ 9 æ¬¡å†…çš„æŸæ¬¡æ”¶åˆ°äº† keepalive åŒ…å¯¹åº”çš„ ACK åŒ…ï¼Œåˆ™åˆä¼šåœ¨æœªæ”¶åˆ°åŒ…å«æ•°æ®æˆ–ACK æ ‡å¿—çš„åŒ… 7200 ç§’åé‡æ–°å¼€å§‹å‘ keepalive åŒ…ã€‚</p></blockquote><p>Windowsä¸‹ï¼Œä¸åŒç³»ç»Ÿç‰ˆæœ¬é»˜è®¤å€¼ä¸åŒï¼Œä¸€èˆ¬æ˜¯7200ç§’ï¼Œ1ç§’ï¼Œ10æ¬¡ã€‚å…·ä½“çš„å¯ä»¥å‚è€ƒï¼š<a href="https://docs.microsoft.com/en-us/windows/win32/winsock/sio-keepalive-vals#remarks">https://docs.microsoft.com/en-us/windows/win32/winsock/sio-keepalive-vals#remarks</a>ã€‚</p><h2 id="ä¸‰ã€å¹³å°å®ç°"><a href="#ä¸‰ã€å¹³å°å®ç°" class="headerlink" title="ä¸‰ã€å¹³å°å®ç°"></a>ä¸‰ã€å¹³å°å®ç°</h2><h3 id="1-æµ‹è¯•ä»£ç "><a href="#1-æµ‹è¯•ä»£ç " class="headerlink" title="1. æµ‹è¯•ä»£ç "></a>1. æµ‹è¯•ä»£ç </h3><p>å†™ä¸€æ®µä»£ç ç®€å•çš„æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: keepalive.c</span><span class="token comment">// gcc -o keepalive keepalive.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_WIN32</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;WinSock2.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Ws2tcpip.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span> </span><span class="token string">"ws2_32.lib"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">socklen_t <span class="token keyword">int</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">SOL_TCP IPPROTO_TCP</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/tcp.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">SOCKET <span class="token keyword">int</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">IP </span><span class="token string">"192.168.104.106"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">PORT <span class="token number">9876</span></span></span><span class="token keyword">void</span> <span class="token function">print_sock_opt</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">,</span> SOCKET sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">,</span> <span class="token keyword">int</span> optname<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> optval <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    socklen_t optlen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>optval<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getsockopt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> level<span class="token punctuation">,</span> optname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>optval<span class="token punctuation">,</span> <span class="token operator">&amp;</span>optlen<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"getsockopt failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s: %d\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> optval<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_sock_keepalive</span><span class="token punctuation">(</span>SOCKET sockfd<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">print_sock_opt</span><span class="token punctuation">(</span><span class="token string">"keepalive"</span><span class="token punctuation">,</span> sockfd<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_KEEPALIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_sock_opt</span><span class="token punctuation">(</span><span class="token string">"keepidle"</span><span class="token punctuation">,</span> sockfd<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPIDLE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_sock_opt</span><span class="token punctuation">(</span><span class="token string">"keepintvl"</span><span class="token punctuation">,</span> sockfd<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPINTVL<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_sock_opt</span><span class="token punctuation">(</span><span class="token string">"keepcnt"</span><span class="token punctuation">,</span> sockfd<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPCNT<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">set_sock_opt</span><span class="token punctuation">(</span>SOCKET sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">,</span> <span class="token keyword">int</span> optname<span class="token punctuation">,</span> <span class="token keyword">int</span> optval<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> level<span class="token punctuation">,</span> optname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>optval<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>optval<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"setsockopt failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">set_sock_keepalive</span><span class="token punctuation">(</span>SOCKET sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> keepalive<span class="token punctuation">,</span> <span class="token keyword">int</span> idle<span class="token punctuation">,</span> <span class="token keyword">int</span> intvl<span class="token punctuation">,</span> <span class="token keyword">int</span> cnt<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">set_sock_opt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_KEEPALIVE<span class="token punctuation">,</span> keepalive<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">set_sock_opt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPIDLE<span class="token punctuation">,</span> idle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">set_sock_opt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPINTVL<span class="token punctuation">,</span> intvl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">set_sock_opt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> SOL_TCP<span class="token punctuation">,</span> TCP_KEEPCNT<span class="token punctuation">,</span> cnt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_WIN32</span></span>    WSADATA wsaData<span class="token punctuation">;</span>    <span class="token function">WSAStartup</span><span class="token punctuation">(</span><span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>wsaData<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>    SOCKET sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> addr<span class="token punctuation">;</span>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>    addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>    addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span>IP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"connect failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">print_sock_keepalive</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">set_sock_keepalive</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_sock_keepalive</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        buf<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"receive: %s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-æœåŠ¡å™¨"><a href="#2-æœåŠ¡å™¨" class="headerlink" title="2. æœåŠ¡å™¨"></a>2. æœåŠ¡å™¨</h3><p>åœ¨ Linux ä¸Šå®‰è£…è½¯ä»¶ <code>socat</code>ï¼Œå¹¶è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ç›‘å¬ç«¯å£9876ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">socat tcp-listen:9876,reuseaddr -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æœåŠ¡å™¨çš„ IP åœ°å€ä¸ºï¼š192.168.104.106ã€‚</p></blockquote><h3 id="3-Linux-ä¸‹-keepalive-çš„å®ç°"><a href="#3-Linux-ä¸‹-keepalive-çš„å®ç°" class="headerlink" title="3. Linux ä¸‹ keepalive çš„å®ç°"></a>3. Linux ä¸‹ keepalive çš„å®ç°</h3><blockquote><p>Linux çš„ IP åœ°å€ä¸ºï¼š192.168.102.63<br>Linux çš„å†…æ ¸ä¸ºï¼š4.15.0-147-generic</p></blockquote><p>é¦–å…ˆå®‰è£… tcpdump å¹¶è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŠ“åŒ…ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> tcpdump -pni enp0s31f6 -vvv -S <span class="token string">"tcp port 9876"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å…¶ä¸­ <code>enp0s31f6</code> æ˜¯ç½‘å¡çš„åå­—ï¼Œ<code>9876</code> ä¸ºç«¯å£å·ã€‚</p></blockquote><p>ç„¶åè¿è¡Œæµ‹è¯•ä»£ç ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºï¼Œtcpdump è¾“å‡ºï¼ˆåˆ é™¤äº†ä¸€äº›ä¸å¿…è¦çš„ä¿¡æ¯ï¼‰ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">14:21:17.008786 192.168.102.63.34882 &gt; 192.168.104.106.9876: Flags [S],  seq 3365757301, length 014:21:17.009112 192.168.104.106.9876 &gt; 192.168.102.63.34882: Flags [S.], seq 3674364464, ack 3365757302, length 014:21:17.009152 192.168.102.63.34882 &gt; 192.168.104.106.9876: Flags [.],  seq 3365757302, ack 3674364465, length 014:21:27.142639 192.168.102.63.34882 &gt; 192.168.104.106.9876: Flags [.],  seq 3365757301, ack 3674364465, length 014:21:27.142904 192.168.104.106.9876 &gt; 192.168.102.63.34882: Flags [.],  seq 3674364465, ack 3365757302, length 014:21:37.382671 192.168.102.63.34882 &gt; 192.168.104.106.9876: Flags [.],  seq 3365757301, ack 3674364465, length 014:21:37.383214 192.168.104.106.9876 &gt; 192.168.102.63.34882: Flags [.],  seq 3674364465, ack 3365757302, length 014:21:47.622639 192.168.102.63.34882 &gt; 192.168.104.106.9876: Flags [.],  seq 3365757301, ack 3674364465, length 014:21:47.623224 192.168.104.106.9876 &gt; 192.168.102.63.34882: Flags [.],  seq 3674364465, ack 3365757302, length 014:21:50.787206 192.168.102.63.34882 &gt; 192.168.104.106.9876: Flags [F.], seq 3365757302, ack 3674364465, length 014:21:50.791349 192.168.104.106.9876 &gt; 192.168.102.63.34882: Flags [.],  seq 3674364465, ack 3365757303, length 014:21:51.288252 192.168.104.106.9876 &gt; 192.168.102.63.34882: Flags [F.], seq 3674364465, ack 3365757303, length 014:21:51.288293 192.168.102.63.34882 &gt; 192.168.104.106.9876: Flags [.],  seq 3365757303, ack 3674364466, length 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»è¾“å‡ºä¸­å¯ä»¥çœ‹å‡ºï¼š</p><ol><li>åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹æˆåŠŸåçš„ 10 ç§’åï¼Œå¼€å§‹å‘é€ keepalive åŒ…ã€‚</li><li>Linux å‘å‡ºçš„ keepalive åŒ…ä¸­ï¼ŒSeq çš„å€¼ç¡®å®æ˜¯ Next-1 ï¼Œä¸” keepalive åŒ…ä¸­å¹¶æœªåŒ…å«æœ‰ä¸€ä¸ªå­—èŠ‚çš„åƒåœ¾æ•°æ®ã€‚</li></ol><h3 id="4-Windows"><a href="#4-Windows" class="headerlink" title="4. Windows"></a>4. Windows</h3><blockquote><p>Windows çš„ IP åœ°å€ä¸ºï¼š192.168.104.134<br>Windows çš„ç‰ˆæœ¬ä¸ºï¼šVersion 21H2(OS Build 22000.51)</p></blockquote><p>é¦–å…ˆå®‰è£… <a href="https://www.wireshark.org/">wireshark</a> å¹¶ä½¿ç”¨ä¸‹é¢çš„æ¡ä»¶æ¥å—…æ¢ç½‘ç»œåŒ…ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp.port == 9876<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åä½¿ç”¨ VS2017 ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•ä»£ç ï¼Œ wireshark æ•è·åˆ°ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">10.902771 192.168.104.134 192.168.104.106 2389 â†’ 9876 [SYN]      Seq=0 Len=010.903375 192.168.104.106 192.168.104.134 9876 â†’ 2389 [SYN, ACK] Seq=0 Ack=1 Len=010.903458 192.168.104.134 192.168.104.106 2389 â†’ 9876 [ACK]      Seq=1 Ack=1 Len=020.906729 192.168.104.134 192.168.104.106 2389 â†’ 9876 [ACK]      Seq=0 Ack=1 Len=120.907444 192.168.104.106 192.168.104.134 9876 â†’ 2389 [ACK]      Seq=1 Ack=1 Len=030.907197 192.168.104.134 192.168.104.106 2389 â†’ 9876 [ACK]      Seq=0 Ack=1 Len=130.907740 192.168.104.106 192.168.104.134 9876 â†’ 2389 [ACK]      Seq=1 Ack=1 Len=040.914386 192.168.104.134 192.168.104.106 2389 â†’ 9876 [ACK]      Seq=0 Ack=1 Len=140.915088 192.168.104.106 192.168.104.134 9876 â†’ 2389 [ACK]      Seq=1 Ack=1 Len=042.105023 192.168.104.134 192.168.104.106 2389 â†’ 9876 [RST, ACK] Seq=1 Ack=1 Len=0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»è¾“å‡ºä¸­å¯ä»¥çœ‹å‡ºï¼š</p><ol><li>åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹æˆåŠŸåçš„ 10 ç§’åï¼Œå¼€å§‹å‘é€ keepalive åŒ…ã€‚</li><li>Windows å‘å‡ºçš„ keepalive åŒ…ä¸­ï¼ŒSeq çš„å€¼ç¡®å®æ˜¯ Next-1 ï¼Œä½† keepalive åŒ…ä¸­åŒ…å«æœ‰ä¸€ä¸ªå­—èŠ‚çš„åƒåœ¾æ•°æ®ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP </tag>
            
            <tag> keepalive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»“åˆLinuxå†…æ ¸æºç åˆ†æTCPåè®®çŠ¶æ€æœº</title>
      <link href="jie-he-linux-nei-he-yuan-ma-fen-xi-tcp-xie-yi-zhuang-tai-ji/"/>
      <url>jie-he-linux-nei-he-yuan-ma-fen-xi-tcp-xie-yi-zhuang-tai-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å‡†å¤‡ç¯å¢ƒ"><a href="#ä¸€ã€å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="ä¸€ã€å‡†å¤‡ç¯å¢ƒ"></a>ä¸€ã€å‡†å¤‡ç¯å¢ƒ</h2><blockquote><p>ç¯å¢ƒï¼šUbuntu18.04</p><p>ç¼–è¾‘å™¨ï¼šVSCode</p><p>å†…æ ¸ç‰ˆæœ¬ï¼š<a href="https://mirrors.edge.kernel.org/pub/linux/kernel/v4.x/linux-4.19.194.tar.xz">linux-4.19.194</a></p></blockquote><h3 id="1-ä¸‹è½½ç¼–è¯‘å†…æ ¸æºç "><a href="#1-ä¸‹è½½ç¼–è¯‘å†…æ ¸æºç " class="headerlink" title="1. ä¸‹è½½ç¼–è¯‘å†…æ ¸æºç "></a>1. ä¸‹è½½ç¼–è¯‘å†…æ ¸æºç </h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://mirrors.edge.kernel.org/pub/linux/kernel/v4.x/linux-4.19.194.tar.xz<span class="token function">tar</span> xf linux-4.19.194.tar.xz<span class="token builtin class-name">cd</span> linux-4.19.194<span class="token comment"># æƒ³è¦ç¼–è¯‘ä»€ä¹ˆæ¶æ„å°±æŒ‡å®šä»€ä¹ˆå€¼ï¼Œæ‰€æœ‰åˆæ³•çš„å€¼åœ¨æºç çš„archæ–‡ä»¶å¤¹ä¸‹å¿…é¡»å­˜åœ¨åŒåçš„æ–‡ä»¶å¤¹</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>x86 <span class="token comment">#x86æ¶æ„</span><span class="token comment"># makeå‘½ä»¤çš„å‚æ•°å¯ä»¥é€šè¿‡ make help è·å–</span><span class="token function">make</span> x86_64_defconfig <span class="token comment"># ç”Ÿæˆ64ä½å¹³å°çš„é»˜è®¤é…ç½®</span><span class="token function">make</span> <span class="token comment"># ç¼–è¯‘å†…æ ¸</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-åˆ†æç¼–è¯‘æ—¶çš„å®å®šä¹‰"><a href="#2-åˆ†æç¼–è¯‘æ—¶çš„å®å®šä¹‰" class="headerlink" title="2. åˆ†æç¼–è¯‘æ—¶çš„å®å®šä¹‰"></a>2. åˆ†æç¼–è¯‘æ—¶çš„å®å®šä¹‰</h3><p>åœ¨ç¬¬ä¸€æ­¥ <a href="#1-ä¸‹è½½ç¼–è¯‘å†…æ ¸æºç ">ä¸‹è½½ç¼–è¯‘å†…æ ¸æºç </a> æˆåŠŸåï¼Œæºä»£ç ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>.config</code> çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æŒ‡æ˜äº†ç¼–è¯‘å†…æ ¸æ—¶æ‰€ç”¨åˆ°çš„è®¾ç½®ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç”Ÿæˆç¼–è¯‘å†…æ ¸ä»£ç æ—¶ä½¿ç”¨çš„å®å®šä¹‰åˆ—è¡¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token string">"^CONFIG_.*"</span> .config <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">"s/=y//g"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">"s/=m/_MODULE/g"</span> <span class="token operator">|</span> <span class="token function">cat</span> - <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token builtin class-name">echo</span> __KERNEL__<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æœ€åæ·»åŠ çš„å® <code>__KERNEL__</code> æ¥è‡ªæºä»£ç æ ¹ç›®å½•ä¸‹ <code>Makefile</code> æ–‡ä»¶çš„443è¡Œã€‚</p></blockquote><p>å°†ä¸Šé¢å‘½ä»¤ç”Ÿæˆçš„ç»“æœé…ç½®åˆ°vscodeä¸­ï¼Œå¯ä»¥æ›´åŠ æ–¹é¢æœ‰æ•ˆçš„æŸ¥çœ‹å†…æ ¸ä»£ç ã€‚</p><h2 id="äºŒã€ç¡®å®šå¥—æ¥å­—è°ƒç”¨å¯¹åº”çš„å†…æ ¸å®ç°å‡½æ•°"><a href="#äºŒã€ç¡®å®šå¥—æ¥å­—è°ƒç”¨å¯¹åº”çš„å†…æ ¸å®ç°å‡½æ•°" class="headerlink" title="äºŒã€ç¡®å®šå¥—æ¥å­—è°ƒç”¨å¯¹åº”çš„å†…æ ¸å®ç°å‡½æ•°"></a>äºŒã€ç¡®å®šå¥—æ¥å­—è°ƒç”¨å¯¹åº”çš„å†…æ ¸å®ç°å‡½æ•°</h2><blockquote><p>ä¸‹é¢ä»¥åˆ›å»ºå¥—æ¥å­—çš„å‡½æ•° <code>socket</code> ä¸ºä¾‹ã€‚</p></blockquote><h3 id="1-ç¡®å®šsocketè°ƒç”¨çš„syscallå·"><a href="#1-ç¡®å®šsocketè°ƒç”¨çš„syscallå·" class="headerlink" title="1. ç¡®å®šsocketè°ƒç”¨çš„syscallå·"></a>1. ç¡®å®šsocketè°ƒç”¨çš„syscallå·</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: main.c</span><span class="token comment">// compile: gcc -ggdb main.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> s<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GDBåæ±‡ç¼–è°ƒè¯•socketè°ƒç”¨</p><pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">0x7ffff7b04d50 &lt;socket&gt;         mov    $0x29,%eax0x7ffff7b04d55 &lt;socket+5&gt;       syscall<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯ä»¥å‘ç°socketè°ƒç”¨çš„syscallå·ä¸º0x29ï¼ˆå³41ï¼‰ã€‚</p><blockquote><p>å‘½ä»¤ <code>man syscall</code> å¯ä»¥è·å–æ›´å¤šå…³äº syscall è°ƒç”¨çš„ä¿¡æ¯ã€‚</p></blockquote><h3 id="2-ç¡®å®šsocketå¯¹åº”çš„å†…æ ¸å®ç°"><a href="#2-ç¡®å®šsocketå¯¹åº”çš„å†…æ ¸å®ç°" class="headerlink" title="2. ç¡®å®šsocketå¯¹åº”çš„å†…æ ¸å®ç°"></a>2. ç¡®å®šsocketå¯¹åº”çš„å†…æ ¸å®ç°</h3><p>ç³»ç»Ÿè°ƒç”¨è¡¨å®šä¹‰åœ¨ <code>arch/x86/entry/syscall_64.c</code> æ–‡ä»¶ä¸­ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: arch/x86/entry/syscall_64.c</span>asmlinkage <span class="token keyword">const</span> sys_call_ptr_t sys_call_table<span class="token punctuation">[</span>__NR_syscall_max<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">/*     * Smells like a compiler bug -- it doesn't work     * when the &amp; below is removed.     */</span>    <span class="token punctuation">[</span><span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __NR_syscall_max<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>sys_ni_syscall<span class="token punctuation">,</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;asm/syscalls_64.h&gt;</span></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç ä¸­ <code>#include &lt;asm/syscalls_64.h&gt;</code> å¯¹åº”çš„æ–‡ä»¶æ˜¯ <code>arch/x86/include/generated/asm/syscalls_64.h</code> ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: arch/x86/include/generated/asm/syscalls_64.h</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_X86</span></span><span class="token function">__SYSCALL_64</span><span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">,</span> __x64_sys_socket<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span> <span class="token comment">/* CONFIG_UML */</span></span><span class="token function">__SYSCALL_64</span><span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">,</span> sys_socket<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>arch/x86/include/generated/asm/syscalls_64.h</code> æ–‡ä»¶ç”± <code>arch/x86/entry/syscalls/syscall_64.tbl</code> æ–‡ä»¶ç”Ÿæˆè€Œæ¥ã€‚</p></blockquote><p>æ ¹æ® <a href="#2-åˆ†æç¼–è¯‘æ—¶çš„å®å®šä¹‰">åˆ†æç¼–è¯‘æ—¶çš„å®å®šä¹‰</a> çš„ç»“æœï¼Œå¯ä»¥ç¡®å®šå® <code>CONFIG_X86</code> æ˜¯å®šä¹‰äº†çš„ï¼Œæ‰€ä»¥è°ƒç”¨å·41å¯¹åº”çš„å®ç°ä¸º <code>__x64_sys_socket</code> ã€‚</p><p>åœ¨æºç ä¸­å´æ‰¾ä¸åˆ° <code>__x64_sys_socket</code> çš„å®šä¹‰ï¼Œä½†èƒ½åœ¨æ–‡ä»¶ <code>net/socket.c</code> ä¸­æ‰¾åˆ° <code>__sys_socket</code> å‡½æ•°çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: net/socket.c</span><span class="token function">SYSCALL_DEFINE3</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> family<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> protocol<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">__sys_socket</span><span class="token punctuation">(</span>family<span class="token punctuation">,</span> type<span class="token punctuation">,</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ†æå® <code>SYSCALL_DEFINE3</code> çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: include/linux/syscalls.h</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">SYSCALL_DEFINE3</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">SYSCALL_DEFINEx</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> _</span><span class="token punctuation">##</span><span class="token expression">name<span class="token punctuation">,</span> __VA_ARGS__<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">SYSCALL_DEFINEx</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>              </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">SYSCALL_METADATA</span><span class="token punctuation">(</span>sname<span class="token punctuation">,</span> x<span class="token punctuation">,</span> __VA_ARGS__<span class="token punctuation">)</span>         </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">__SYSCALL_DEFINEx</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> __VA_ARGS__<span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ç€åˆ†æå® <code>__SYSCALL_DEFINEx</code> çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: arch/x86/include/asm/syscall_wrapper.h</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">__SYSCALL_DEFINEx</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>                 </span><span class="token punctuation">\</span>    <span class="token expression">asmlinkage <span class="token keyword">long</span> __x64_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">pt_regs</span> <span class="token operator">*</span>regs<span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">ALLOW_ERROR_INJECTION</span><span class="token punctuation">(</span>__x64_sys</span><span class="token punctuation">##</span><span class="token expression">name<span class="token punctuation">,</span> ERRNO<span class="token punctuation">)</span><span class="token punctuation">;</span>          </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">static</span> <span class="token keyword">long</span> __se_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">__MAP</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__SC_LONG<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">long</span> __do_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">__MAP</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__SC_DECL<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">\</span>    <span class="token expression">asmlinkage <span class="token keyword">long</span> __x64_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">pt_regs</span> <span class="token operator">*</span>regs<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token punctuation">{</span>                               </span><span class="token punctuation">\</span>        <span class="token expression"><span class="token keyword">return</span> __se_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">SC_X86_64_REGS_TO_ARGS</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">\</span>    <span class="token expression"><span class="token punctuation">}</span>                               </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">__IA32_SYS_STUBx</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> name<span class="token punctuation">,</span> __VA_ARGS__<span class="token punctuation">)</span>              </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">static</span> <span class="token keyword">long</span> __se_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">__MAP</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__SC_LONG<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token punctuation">{</span>                               </span><span class="token punctuation">\</span>        <span class="token expression"><span class="token keyword">long</span> ret <span class="token operator">=</span> __do_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">__MAP</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__SC_CAST<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">\</span>        <span class="token expression"><span class="token function">__MAP</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__SC_TEST<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">;</span>             </span><span class="token punctuation">\</span>        <span class="token expression"><span class="token function">__PROTECT</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> ret<span class="token punctuation">,</span><span class="token function">__MAP</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__SC_ARGS<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   </span><span class="token punctuation">\</span>        <span class="token expression"><span class="token keyword">return</span> ret<span class="token punctuation">;</span>                     </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token punctuation">}</span>                               </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">long</span> __do_sys</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">name</span><span class="token punctuation">(</span><span class="token function">__MAP</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>__SC_DECL<span class="token punctuation">,</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ç¡®å®šï¼Œå® <code>SYSCALL_DEFINE3(socket, int, family, int, type, int, protocol)</code> å±•å¼€åï¼Œå®šä¹‰äº† <code>__x64_sys_socket</code>ã€‚</p><p>å³ <code>__x64_sys_socket</code> å‡½æ•°çš„æœ¬ä½“å°±æ˜¯ <code>net/socket.c</code> æ–‡ä»¶ä¸­çš„ <code>__sys_socket</code> å‡½æ•°ã€‚</p><h2 id="ä¸‰ã€åˆ†æTCPåè®®çŠ¶æ€æœº"><a href="#ä¸‰ã€åˆ†æTCPåè®®çŠ¶æ€æœº" class="headerlink" title="ä¸‰ã€åˆ†æTCPåè®®çŠ¶æ€æœº"></a>ä¸‰ã€åˆ†æTCPåè®®çŠ¶æ€æœº</h2><h3 id="1-socket"><a href="#1-socket" class="headerlink" title="1. socket"></a>1. socket</h3><p>è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">__sys_socket                // net/socket.c:1355    |- sock_create          // net/socket.c:1346        |- __sock_create    // net/socket.c:1316<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>socket</code> å‡½æ•°æœ€åä¼šè°ƒç”¨å‡½æ•° <code>__sock_create</code> ï¼Œå…¶ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">__sock_create</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">net</span> <span class="token operator">*</span>net<span class="token punctuation">,</span> <span class="token keyword">int</span> family<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">,</span>            <span class="token keyword">struct</span> <span class="token class-name">socket</span> <span class="token operator">*</span><span class="token operator">*</span>res<span class="token punctuation">,</span> <span class="token keyword">int</span> kern<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">struct</span> <span class="token class-name">socket</span> <span class="token operator">*</span>sock<span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">net_proto_family</span> <span class="token operator">*</span>pf<span class="token punctuation">;</span>    sock <span class="token operator">=</span> <span class="token function">sock_alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    pf <span class="token operator">=</span> <span class="token function">rcu_dereference</span><span class="token punctuation">(</span>net_families<span class="token punctuation">[</span>family<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    pf<span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> sock<span class="token punctuation">,</span> protocol<span class="token punctuation">,</span> kern<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>sock_alloc()</code> å‡½æ•°åˆ†é…å¥—æ¥å­—çš„ä¸€äº›èµ„æºåï¼Œå†ä» <code>net_families</code> å–å‡ºç½‘ç»œåè®®ç°‡å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œæœ€ååˆ›å»ºå¯¹åº”ç½‘ç»œåè®®ç°‡çš„å¥—æ¥å­—ã€‚</p><p><code>net_families</code> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾äº†ä¸åŒçš„åè®®ç°‡å¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚é€šè¿‡å‡½æ•° <code>sock_register</code> å¯ä»¥æ³¨å†Œåˆ°æ­¤æ•°ç»„ä¸­ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// file: net/ipv4/af_inet.c</span><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">net_proto_family</span> inet_family_ops <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token punctuation">.</span>family <span class="token operator">=</span> PF_INET<span class="token punctuation">,</span>    <span class="token punctuation">.</span>create <span class="token operator">=</span> inet_create<span class="token punctuation">,</span>    <span class="token punctuation">.</span>owner <span class="token operator">=</span> THIS_MODULE<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">int</span> __init <span class="token function">inet_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">sock_register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>inet_family_ops<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œä¸Šé¢ä»£ç ä¸­çš„ <code>err = pf-&gt;create(net, sock, protocol, kern)</code> è°ƒç”¨çš„å…¶å®æ˜¯ <code>inet_create(net, sock, protocol, kern)</code> ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">inet_create                             // net/ipv4/af_inet.c:1075    |- sock_init_data                   // net/core/sock.c:347        |- sk-&gt;sk_state = TCP_CLOSE     // net/core/sock.c:2790<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç»¼ä¸Šï¼Œè°ƒç”¨ <code>socket()</code> å‡½æ•°åï¼Œå¥—æ¥å­—çš„é»˜è®¤çŠ¶æ€ä¸º <code>TCP_CLOSE</code> ã€‚</p><h3 id="2-listen"><a href="#2-listen" class="headerlink" title="2. listen"></a>2. listen</h3><p>è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">__sys_listen                    // net/socket.c:1525    |- sock-&gt;ops-&gt;listen()      // net/socket.c:1516<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œä¸Šé¢ä»£ç ä¸­çš„ <code>sock-&gt;ops-&gt;listen()</code> è°ƒç”¨çš„å…¶å®æ˜¯ <code>net/ipv4/af_inet.c</code> æ–‡ä»¶ä¸­çš„ <code>inet_listen</code> å‡½æ•°ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">inet_listen                                     // net/ipv4/af_inet.c:991    |- inet_csk_listen_start                    // net/ipv4/af_inet.c:229        |- inet_sk_state_store(sk, TCP_LISTEN)  // net/ipv4/inet_connection_sock.c:923<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç»¼ä¸Šï¼Œè°ƒç”¨ <code>listen()</code> å‡½æ•°åï¼Œå¥—æ¥å­—çš„çŠ¶æ€ç”± <code>TCP_CLOSE</code> å˜ä¸º <code>TCP_LISTEN</code> ã€‚</p><h3 id="3-connect"><a href="#3-connect" class="headerlink" title="3. connect"></a>3. connect</h3><p>è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">__sys_connect                // net/socket.c:1674    |- sock-&gt;ops-&gt;connect()  // net/socket.c:1663<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åŒç†ï¼Œå¯¹äº TCP/IPv4 æ¥è¯´ï¼Œä¸Šé¢ä»£ç ä¸­çš„ <code>sock-&gt;ops-&gt;connect()</code> è°ƒç”¨çš„å…¶å®æ˜¯ <code>net/ipv4/af_inet.c</code> æ–‡ä»¶ä¸­çš„ <code>inet_stream_connect</code> å‡½æ•°ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">inet_stream_connect                 // net/ipv4/af_inet.c:985    |- __inet_stream_connect        // net/ipv4/af_inet.c:719        |- sk-&gt;sk_prot-&gt;connect()   // net/ipv4/af_inet.c:655<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ä»£ç ä¸­çš„ <code>sk-&gt;sk_prot-&gt;connect()</code> è°ƒç”¨çš„å…¶å®æ˜¯ <code>net/ipv4/tcp_ipv4.c</code> æ–‡ä»¶ä¸­çš„ <code>tcp_v4_connect</code> å‡½æ•°ã€‚</p><h4 id="1-å‘é€SYN"><a href="#1-å‘é€SYN" class="headerlink" title="1. å‘é€SYN"></a>1. å‘é€SYN</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_connect                                      // net/ipv4/tcp_ipv4.c:2460    |- tcp_set_state(sk, TCP_SYN_SENT)              // net/ipv4/tcp_ipv4.c:280    |- tcp_connect                                  // net/ipv4/tcp_ipv4.c:318        |- tcp_transmit_skb                         // net/ipv4/tcp_output.c:3529            |- __tcp_transmit_skb                   // net/ipv4/tcp_output.c:1164                |- icsk-&gt;icsk_af_ops-&gt;queue_xmit()  // net/ipv4/tcp_output.c:1148<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>tcp_v4_connect</code> å‡½æ•°å…ˆå°†å¥—æ¥å­—çš„çŠ¶æ€è®¾ç½®ä¸º <code>TCP_SYN_SENT</code> ï¼Œç„¶åå†è°ƒç”¨ <code>tcp_connect</code> å‘é€å®é™…çš„SYNåŒ…ã€‚</p><p>åœ¨å‡½æ•° <code>__tcp_transmit_skb</code> ä¸­æ„å»ºç½‘ç»œåŒ…çš„TCPå¤´ã€‚æ„å»ºå¥½åï¼Œè°ƒç”¨ <code>icsk-&gt;icsk_af_ops-&gt;queue_xmit()</code> å‘é€TCPåŒ…ï¼Œè€Œå‡½æ•° <code>icsk-&gt;icsk_af_ops-&gt;queue_xmit()</code> å®é™…å°±æ˜¯ <code>include/net/ip.h</code> æ–‡ä»¶ä¸­çš„ <code>ip_queue_xmit</code> å‡½æ•°ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ip_queue_xmit                                   // net/ipv4/tcp_ipv4.c:1931    |- __ip_queue_xmit                          // include/net/ip.h:197        |- skb_dst_set_noref(skb, &amp;rt-&gt;dst)     // net/ipv4/ip_output.c:473        |- ip_local_out                         // net/ipv4/ip_output.c:506<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆåœ¨å‡½æ•° <code>__ip_queue_xmit</code> ä¸­è°ƒç”¨ <code>skb_dst_set_noref(skb, &amp;rt-&gt;dst)</code> è®¾ç½®å‘é€çš„ç›®æ ‡ï¼Œç„¶åæ„å»º IP å¤´å¹¶è°ƒç”¨å‡½æ•° <code>ip_local_out</code> å°†åŒ…å«æœ‰ SYN æ ‡å¿—çš„ TCP åŒ…å‘é€å‡ºå»ã€‚</p><h4 id="2-æ¥æ”¶åˆ°SYNå’ŒACKï¼Œå¹¶å›å¤ACK"><a href="#2-æ¥æ”¶åˆ°SYNå’ŒACKï¼Œå¹¶å›å¤ACK" class="headerlink" title="2. æ¥æ”¶åˆ°SYNå’ŒACKï¼Œå¹¶å›å¤ACK"></a>2. æ¥æ”¶åˆ°SYNå’ŒACKï¼Œå¹¶å›å¤ACK</h4><p>å½“ IP å±‚æ¥æ”¶åˆ° TCPv4 çš„åŒ…æ—¶ï¼Œä¼šè°ƒç”¨å‡½æ•° <code>tcp_v4_rcv</code> æ¥å¤„ç†ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_rcv                                                  // net/ipv4/af_inet.c:1684    |- tcp_v4_do_rcv                                        // net/ipv4/tcp_ipv4.c:1832        |- tcp_rcv_state_process                            // net/ipv4/tcp_ipv4.c:1569            |- tcp_rcv_synsent_state_process                // net/ipv4/tcp_input.c:6065                |- tcp_finish_connect                       // net/ipv4/tcp_input.c:5898                    |- tcp_set_state(sk, TCP_ESTABLISHED)   // net/ipv4/tcp_input.c:5695                |- tcp_send_ack                             // net/ipv4/tcp_input.c:5928<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ <code>tcp_rcv_synsent_state_process</code> ä¸­ï¼Œå…ˆå°†å¥—æ¥å­—çš„çŠ¶æ€è®¾ç½®ä¸º <code>TCP_ESTABLISHED</code> ï¼Œç„¶åå†è°ƒç”¨ <code>tcp_send_ack</code> å‘é€ ACK å®Œæˆ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p>ç»¼ä¸Šï¼Œè°ƒç”¨ <code>connect()</code> å‡½æ•°åï¼Œå¥—æ¥å­—çš„çŠ¶æ€ç”± <code>TCP_CLOSE</code> å˜ä¸º <code>TCP_SYN_SENT</code> ï¼Œåœ¨æˆåŠŸæ”¶åˆ° ACK åï¼ŒçŠ¶æ€å†å˜ä¸º <code>TCP_ESTABLISHED</code> ã€‚</p><h3 id="4-accept"><a href="#4-accept" class="headerlink" title="4. accept"></a>4. accept</h3><p>è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">__sys_accept4                               // net/socket.c:1630    |- sock-&gt;ops-&gt;accept(sock, newsock)     // net/socket.c:1589<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œ <code>sock-&gt;ops-&gt;accept()</code> å®é™…è°ƒç”¨çš„æ˜¯ <code>net/ipv4/af_inet.c</code> æ–‡ä»¶ä¸­çš„ <code>inet_accept</code> ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">inet_accept                     // net/ipv4/af_inet.c:987    |- sk1-&gt;sk_prot-&gt;accept()   // net/ipv4/af_inet.c:734<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œ <code>sk1-&gt;sk_prot-&gt;accept()</code> å®é™…è°ƒç”¨çš„æ˜¯ <code>net/ipv4/inet_connection_sock.c</code> æ–‡ä»¶ä¸­çš„ <code>inet_csk_accept</code> ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">sock</span> <span class="token operator">*</span><span class="token function">inet_csk_accept</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sock</span> <span class="token operator">*</span>sk<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>err<span class="token punctuation">,</span> bool kern<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">reqsk_queue_empty</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">long</span> timeo <span class="token operator">=</span> <span class="token function">sock_rcvtimeo</span><span class="token punctuation">(</span>sk<span class="token punctuation">,</span> flags <span class="token operator">&amp;</span> O_NONBLOCK<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* If this is a non blocking socket don't sleep */</span>        error <span class="token operator">=</span> <span class="token operator">-</span>EAGAIN<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeo<span class="token punctuation">)</span>            <span class="token keyword">goto</span> out_err<span class="token punctuation">;</span>        <span class="token function">inet_csk_wait_for_connect</span><span class="token punctuation">(</span>sk<span class="token punctuation">,</span> timeo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    req <span class="token operator">=</span> <span class="token function">reqsk_queue_remove</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> sk<span class="token punctuation">)</span><span class="token punctuation">;</span>    newsk <span class="token operator">=</span> req<span class="token operator">-&gt;</span>sk<span class="token punctuation">;</span>    <span class="token keyword">return</span> newsk<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>inet_csk_accept</code> é¦–å…ˆæ£€æŸ¥ç›‘å¬å¥—æ¥å­—ä¸Šçš„è¿æ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºä¸”è®¾ç½®äº† <code>O_NONBLOCK</code> æ ‡å¿—çš„è¯å°±è¿”å›é”™è¯¯ <code>EAGAIN</code> ï¼Œå¦åˆ™å°±ç­‰å¾…ç›´åˆ°æœ‰è¿æ¥åˆ°æ¥ã€‚</p><h4 id="1-æ¥æ”¶åˆ°SYNï¼Œå‘é€SYNå’ŒACK"><a href="#1-æ¥æ”¶åˆ°SYNï¼Œå‘é€SYNå’ŒACK" class="headerlink" title="1. æ¥æ”¶åˆ°SYNï¼Œå‘é€SYNå’ŒACK"></a>1. æ¥æ”¶åˆ°SYNï¼Œå‘é€SYNå’ŒACK</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_rcv                                          // net/ipv4/af_inet.c:1684    |- tcp_v4_do_rcv                                // net/ipv4/tcp_ipv4.c:1822        |- tcp_rcv_state_process                    // net/ipv4/tcp_ipv4.c:1569            |- icsk-&gt;icsk_af_ops-&gt;conn_request()    // net/ipv4/tcp_input.c:6051<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œè°ƒç”¨ <code>icsk-&gt;icsk_af_ops-&gt;conn_request()</code> å…¶å®æ˜¯è°ƒç”¨ <code>net/ipv4/tcp_ipv4.c</code> æ–‡ä»¶ä¸­çš„ <code>tcp_v4_conn_request</code>ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_conn_request                                 // net/ipv4/tcp_ipv4.c:1935    |- tcp_conn_request                             // net/ipv4/tcp_ipv4.c:1397        |- inet_reqsk_alloc                         // net/ipv4/tcp_input.c:6461            |- ireq-&gt;ireq_state = TCP_NEW_SYN_RECV  // net/ipv4/tcp_input.c:6374        |- af_ops-&gt;send_synack()                    // net/ipv4/tcp_input.c:6556<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿æ¥è¯·æ±‚å¤„ç†å‡½æ•° <code>tcp_conn_request</code> ä¸­ï¼Œé¦–å…ˆæŠŠæ–°åˆ†é…çš„å¥—æ¥å­—çš„ <code>request_sock</code> è®¾ç½®ä¸º <code>TCP_NEW_SYN_RECV</code> çŠ¶æ€ã€‚ç„¶åè°ƒç”¨ <code>af_ops-&gt;send_synack()</code> æ¥å‘é€ SYN å’Œ ACK ã€‚å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œè°ƒç”¨ <code>af_ops-&gt;send_synack()</code> å…¶å®æ˜¯è°ƒç”¨ <code>net/ipv4/tcp_ipv4.c</code> æ–‡ä»¶ä¸­çš„ <code>tcp_v4_send_synack</code> ã€‚è€Œå‡½æ•° <code>tcp_v4_send_synack</code> åšçš„ä¹Ÿç¡®å®æ˜¯å‘é€ä¸€ä¸ªå¸¦æœ‰ SYN å’Œ ACK æ ‡å¿—çš„åŒ…ã€‚</p><h4 id="2-æ¥æ”¶åˆ°ACK"><a href="#2-æ¥æ”¶åˆ°ACK" class="headerlink" title="2. æ¥æ”¶åˆ°ACK"></a>2. æ¥æ”¶åˆ°ACK</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_rcv                                              // net/ipv4/af_inet.c:1684    |- tcp_check_req                                    // net/ipv4/tcp_ipv4.c:1773        |- inet_csk(sk)-&gt;icsk_af_ops-&gt;syn_recv_sock()   // net/ipv4/tcp_minisocks.c:789        |- inet_csk_complete_hashdance                  // net/ipv4/tcp_minisocks.c:797    |- tcp_child_process                                // net/ipv4/tcp_ipv4.c:1792<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p>å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œè°ƒç”¨ <code>inet_csk(sk)-&gt;icsk_af_ops-&gt;syn_recv_sock()</code> å…¶å®æ˜¯è°ƒç”¨ <code>net/ipv4/tcp_ipv4.c</code> æ–‡ä»¶ä¸­çš„ <code>tcp_v4_syn_recv_sock</code>ï¼š</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_syn_recv_sock                                    // net/ipv4/tcp_ipv4.c:1936    |- tcp_create_openreq_child                         // net/ipv4/tcp_ipv4.c:1429        |- inet_csk_clone_lock                          // net/ipv4/tcp_minisocks.c:452            |- inet_sk_set_state(newsk, TCP_SYN_RECV)   // net/ipv4/inet_connection_sock.c:829<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–°åˆ›å»ºçš„å¥—æ¥å­—çš„çŠ¶æ€ä¸º <code>TCP_SYN_RECV</code> ã€‚</p></li><li><p>å‡½æ•° <code>inet_csk_complete_hashdance</code> ä¸»è¦åšçš„æ˜¯å°†è¯·æ±‚æ§åˆ¶å—ä»æœªå®Œæˆè¿æ¥é˜Ÿåˆ—ä¸­åˆ é™¤ï¼ŒåŠ å…¥åˆ°å·²å®Œæˆè¿æ¥é˜Ÿåˆ—ä¸­ï¼š</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">inet_csk_complete_hashdance                 // net/ipv4/tcp_minisocks.c:797    |- inet_csk_reqsk_queue_drop            // net/ipv4/inet_connection_sock.c:992        |- reqsk_queue_unlink               // net/ipv4/inet_connection_sock.c:703    |- inet_csk_reqsk_queue_add             // net/ipv4/inet_connection_sock.c:994<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å‡½æ•° <code>tcp_child_process</code> è¿›ä¸€æ­¥å¯¹æ–°åˆ›å»ºçš„å¥—æ¥å­—è¿›è¡Œå¤„ç†å¹¶æŠŠçŠ¶æ€æ›´æ–°ä¸º <code>TCP_ESTABLISHED</code> ï¼š</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_child_process                               // net/ipv4/tcp_ipv4.c:1792    |- tcp_rcv_state_process                    // net/ipv4/tcp_minisocks.c:851        |- tcp_set_state(sk, TCP_ESTABLISHED)   // net/ipv4/tcp_input.c:6132<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="5-close"><a href="#5-close" class="headerlink" title="5. close"></a>5. close</h3><h4 id="1-å‘é€FIN"><a href="#1-å‘é€FIN" class="headerlink" title="1. å‘é€FIN"></a>1. å‘é€FIN</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_close                                               // net/ipv4/tcp_ipv4.c:2458    |- tcp_close_state                                  // net/ipv4/tcp.c:2393        |- tcp_set_state(sk, ns)                        // net/ipv4/tcp.c:2294    |- tcp_send_fin                                     // net/ipv4/tcp.c:2423        |- TCP_SKB_CB(tskb)-&gt;tcp_flags |= TCPHDR_FIN    // net/ipv4/tcp_output.c:3087    |- sk_stream_wait_close                             // net/ipv4/tcp.c:2426<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äºçŠ¶æ€æ˜¯ <code>TCP_ESTABLISHED</code> çš„å¥—æ¥å­—ï¼Œå‡½æ•° <code>tcp_close_state</code> ä¼šæŠŠå¥—æ¥å­—çš„çŠ¶æ€æ›´æ–°ä¸º <code>TCP_FIN_WAIT1</code> ã€‚ <code>tcp_send_fin</code> å‡½æ•°åˆ™å‘é€å¸¦æœ‰ FIN æ ‡è®°çš„åŒ…ç»™å¯¹æ–¹ã€‚</p><h4 id="2-æ¥æ”¶ACK"><a href="#2-æ¥æ”¶ACK" class="headerlink" title="2. æ¥æ”¶ACK"></a>2. æ¥æ”¶ACK</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_rcv                                              // net/ipv4/af_inet.c:1684    |- tcp_v4_do_rcv                                    // net/ipv4/tcp_ipv4.c:1832        |- tcp_rcv_state_process                        // net/ipv4/tcp_ipv4.c:1569            |- tcp_set_state(sk, TCP_FIN_WAIT2)         // net/ipv4/tcp_input.c:6175<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-ç­‰å¾…FINå¹¶å‘é€ACK"><a href="#3-ç­‰å¾…FINå¹¶å‘é€ACK" class="headerlink" title="3. ç­‰å¾…FINå¹¶å‘é€ACK"></a>3. ç­‰å¾…FINå¹¶å‘é€ACK</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">tcp_v4_rcv                                                      // net/ipv4/af_inet.c:1684    |- tcp_v4_do_rcv                                            // net/ipv4/tcp_ipv4.c:1832        |- tcp_rcv_state_process                                // net/ipv4/tcp_ipv4.c:1569            |- tcp_data_queue                                   // net/ipv4/tcp_input.c:6262                |- tcp_fin                                      // net/ipv4/tcp_input.c:4756                    |- tcp_send_ack(sk)                         // net/ipv4/tcp_input.c:4139                    |- tcp_time_wait(TCP_TIME_WAIT)             // net/ipv4/tcp_input.c:4140                        |- inet_twsk_alloc                      // net/ipv4/tcp_minisocks.c:259                            |- tw-&gt;tw_state = TCP_TIME_WAIT     // net/ipv4/inet_timewait_sock.c:175                            |- timer_setup(tw_timer_handler)    // net/ipv4/inet_timewait_sock.c:188                        |- inet_twsk_schedule()                 // net/ipv4/tcp_minisocks.c:319<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å‡½æ•° <code>tcp_fin</code> ä¸­ï¼Œå‘é€äº† ACK åï¼Œå¹¶è¿›å…¥ <code>TCP_TIME_WAIT</code> çŠ¶æ€ã€‚åŒæ—¶æ³¨å†Œä¸€ä¸ªè¶…æ—¶çš„å®šæ—¶å™¨ã€‚</p><blockquote><p>æ³¨æ„ï¼Œè™½ç„¶åœ¨ <code>inet_twsk_alloc</code> å‡½æ•°ä¸­ï¼Œä¿®æ”¹çš„æ˜¯ <code>tw-&gt;tw_state</code> å­—æ®µä¸º <code>TCP_TIME_WAIT</code> çŠ¶æ€ã€‚ä½†æ˜¯æŸ¥çœ‹å® <code>tw_state</code> çš„å®šä¹‰å¯ä»¥çŸ¥é“ï¼Œ<code>tw_state</code> æŒ‡å‘çš„ä¾æ—§æ˜¯ç»“æ„ä½“ <code>sock_common</code> ä¸­çš„å­—æ®µ <code>skc_state</code> ã€‚</p></blockquote><h3 id="6-shutdown"><a href="#6-shutdown" class="headerlink" title="6. shutdown"></a>6. shutdown</h3><p>è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">__sys_shutdown                                  // net/socket.c:1973    |- sock-&gt;ops-&gt;shutdown()                    // net/socket.c:1965<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯¹äº TCP/IPv4 æ¥è¯´ï¼Œè°ƒç”¨ <code>sock-&gt;ops-&gt;shutdown()</code> å…¶å®æ˜¯è°ƒç”¨ <code>net/ipv4/tcp_ipv4.c</code> æ–‡ä»¶ä¸­çš„ <code>tcp_shutdown</code>ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">tcp_shutdown</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sock</span> <span class="token operator">*</span>sk<span class="token punctuation">,</span> <span class="token keyword">int</span> how<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>how <span class="token operator">&amp;</span> SEND_SHUTDOWN<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token comment">/* If we've already sent a FIN, or it's a closed state, skip this. */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> sk<span class="token operator">-&gt;</span>sk_state<span class="token punctuation">)</span> <span class="token operator">&amp;</span>        <span class="token punctuation">(</span>TCPF_ESTABLISHED <span class="token operator">|</span> TCPF_SYN_SENT <span class="token operator">|</span>            TCPF_SYN_RECV <span class="token operator">|</span> TCPF_CLOSE_WAIT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">/* Clear out any half completed packets.  FIN if needed. */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tcp_close_state</span><span class="token punctuation">(</span>sk<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token function">tcp_send_fin</span><span class="token punctuation">(</span>sk<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸è°ƒç”¨ <code>close</code> ç±»ä¼¼ï¼Œ</p><h2 id="å››ã€IPå±‚åŠä»¥ä¸‹å±‚çš„å·¥ä½œ"><a href="#å››ã€IPå±‚åŠä»¥ä¸‹å±‚çš„å·¥ä½œ" class="headerlink" title="å››ã€IPå±‚åŠä»¥ä¸‹å±‚çš„å·¥ä½œ"></a>å››ã€IPå±‚åŠä»¥ä¸‹å±‚çš„å·¥ä½œ</h2><h3 id="1-IPå±‚å‘é€åŒ…"><a href="#1-IPå±‚å‘é€åŒ…" class="headerlink" title="1. IPå±‚å‘é€åŒ…"></a>1. IPå±‚å‘é€åŒ…</h3><p>ä¸Šå±‚æƒ³è¦å‘é€ IP åŒ…ï¼Œéƒ½ä¼šè°ƒç”¨å‡½æ•° <code>ip_local_out</code> æ¥å‘é€ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ip_local_out                            // include/net/ip.h:165    |- dst_output                       // net/ipv4/ip_output.c:125        |- skb_dst(skb)-&gt;output()       // include/net/dst.h:455<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯¹ IP åè®®æ¥è¯´ï¼Œ <code>skb_dst(skb)-&gt;output()</code> å®é™…è°ƒç”¨çš„æ˜¯ <code>net/ipv4/ip_output.c</code> æ–‡ä»¶ä¸­çš„ <code>ip_output</code> å‡½æ•°ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ip_output                               // net/ipv4/route.c:1636    |- ip_finish_output                 // net/ipv4/ip_output.c:408        |- ip_finish_output2            // net/ipv4/ip_output.c:318            |- neigh_output             // net/ipv4/ip_output.c:230                |- neigh_hh_output      // include/net/neighbour.h:499                    |- dev_queue_xmit   // include/net/neighbour.h:491<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è°ƒç”¨ <code>dev_queue_xmit</code> æ˜¯å°† IP åŒ…äº¤ç»™ç½‘ç»œè®¾å¤‡å­ç³»ç»Ÿæ¥å‘é€ï¼Œè€Œ <code>dev_queue_xmit</code> ç›´æ¥è°ƒç”¨çš„å‡½æ•° <code>__dev_queue_xmit</code> ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">dev_queue_xmit</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sk_buff</span> <span class="token operator">*</span>skb<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">__dev_queue_xmit</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">__dev_queue_xmit</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sk_buff</span> <span class="token operator">*</span>skb<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">net_device</span> <span class="token operator">*</span>sb_dev<span class="token punctuation">)</span><span class="token punctuation">{</span>    txq <span class="token operator">=</span> <span class="token function">netdev_pick_tx</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> skb<span class="token punctuation">,</span> sb_dev<span class="token punctuation">)</span><span class="token punctuation">;</span>    q <span class="token operator">=</span> <span class="token function">rcu_dereference_bh</span><span class="token punctuation">(</span>txq<span class="token operator">-&gt;</span>qdisc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>q<span class="token operator">-&gt;</span>enqueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">__dev_xmit_skb</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> q<span class="token punctuation">,</span> dev<span class="token punctuation">,</span> txq<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">goto</span> out<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/* The device has no queue. Common case for software devices:     * loopback, all the sorts of tunnels...     */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dev<span class="token operator">-&gt;</span>flags <span class="token operator">&amp;</span> IFF_UP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">dev_hard_start_xmit</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> dev<span class="token punctuation">,</span> txq<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å‡½æ•° <code>__dev_queue_xmit</code> å†…éƒ¨ï¼š</p><ol><li><p>é’ˆå¯¹æœ‰å‘é€é˜Ÿåˆ—çš„è®¾å¤‡</p><p> é¦–å…ˆè°ƒç”¨ <code>netdev_pick_tx</code> é€‰æ‹©ä¸€ä¸ªå‘é€é˜Ÿåˆ—ï¼ˆç°åœ¨çš„ç½‘å¡ä¸€èˆ¬éƒ½æ”¯æŒå¤šä¸ªå‘é€é˜Ÿåˆ—ï¼‰ï¼Œç„¶åå†è°ƒç”¨ <code>__dev_xmit_skb</code> è¿›è¡Œå‘é€ã€‚åœ¨ç»è¿‡å±‚å±‚è°ƒç”¨åï¼Œæœ€åä¼šè°ƒç”¨çš„å‡½æ•° <code>dev_hard_start_xmit</code> å‘é€åŒ…ã€‚</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">|- __dev_xmit_skb                               // net/core/dev.c:3807    |- q-&gt;enqueue(skb, q, &amp;to_free)             // net/core/dev.c:3450    |- qdisc_run                                // net/core/dev.c:3451        |- __qdisc_run                          // include/net/pkt_sched.h:120            |- qdisc_restart                    // net/sched/sch_generic.c:403                |- sch_direct_xmit              // net/sched/sch_generic.c:395                    |- dev_hard_start_xmit      // net/sched/sch_generic.c:332<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> éœ€è¦æ³¨æ„å‡½æ•° <code>__qdisc_run</code> çš„å®ç°ï¼š</p> <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">__qdisc_run</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Qdisc</span> <span class="token operator">*</span>q<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> quota <span class="token operator">=</span> dev_tx_weight<span class="token punctuation">;</span>    <span class="token keyword">int</span> packets<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">qdisc_restart</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token operator">&amp;</span>packets<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">/*        * Ordered by possible occurrence: Postpone processing if        * 1. we've exceeded packet quota        * 2. another process needs the CPU;        */</span>        quota <span class="token operator">-=</span> packets<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>quota <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">need_resched</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">__netif_schedule</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> å¦‚æœç³»ç»Ÿæ€ CPU å‘é€ç½‘ç»œåŒ…ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å‡½æ•° <code>__netif_schedule</code> è¿›è€Œè°ƒç”¨å‡½æ•° <code>__netif_reschedule</code> è§¦å‘ä¸€ä¸ªè½¯ä¸­æ–­ <code>NET_TX_SOFTIRQ</code> ã€‚è€Œå¯¹åº”çš„ä¸­æ–­å¤„ç†å‡½æ•° <code>net_tx_action</code> ä¼šé‡æ–°è°ƒç”¨ <code>qdisc_run</code> ç»§ç»­å‘é€å‰©ä½™çš„ç½‘ç»œåŒ…ã€‚</p></li><li><p>é’ˆå¯¹æ²¡æœ‰å‘é€é˜Ÿåˆ—çš„è®¾å¤‡</p><p> å¦‚æ³¨é‡Šé‡Œè¯´çš„å›ç¯åœ°å€ï¼Œéš§é“ç½‘ç»œç­‰ï¼Œå°±ç›´æ¥è°ƒç”¨ <code>dev_hard_start_xmit</code> å‘é€åŒ…ã€‚</p></li></ol><p>æ‰€ä»¥ï¼Œä¸ç®¡è®¾å¤‡æœ‰æ— å‘é€é˜Ÿåˆ—ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨å‡½æ•° <code>dev_hard_start_xmit</code> ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">|- dev_hard_start_xmit                      // net/core/dev.c:3262    |- xmit_one                             // net/core/dev.c:3272        |- netdev_start_xmit                // net/core/dev.c:3256            |- __netdev_start_xmit          // include/linux/netdevice.h:4359                |- ops-&gt;ndo_start_xmit      // include/linux/netdevice.h:4345<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ç»è¿‡å±‚å±‚è°ƒç”¨åï¼Œæœ€åè°ƒç”¨çš„ <code>ops-&gt;ndo_start_xmit()</code> å…¶å®æ˜¯å„ä¸ªç½‘å¡é©±åŠ¨çš„å®ç°äº†ã€‚</p><h3 id="2-Intelçš„igbç½‘å¡é©±åŠ¨çš„å‘é€æµç¨‹"><a href="#2-Intelçš„igbç½‘å¡é©±åŠ¨çš„å‘é€æµç¨‹" class="headerlink" title="2. Intelçš„igbç½‘å¡é©±åŠ¨çš„å‘é€æµç¨‹"></a>2. Intelçš„igbç½‘å¡é©±åŠ¨çš„å‘é€æµç¨‹</h3><p>å¯¹ç½‘å¡é©±åŠ¨ <code>drivers/net/ethernet/intel/igb</code> æ¥è¯´ï¼Œ å‡½æ•° <code>ops-&gt;ndo_start_xmit</code> è°ƒç”¨çš„å…¶å®å°±æ˜¯ <code>igb_netdev_ops</code> ä¸­çš„ <code>ndo_start_xmit</code> çš„å€¼ï¼Œå³ <code>drivers/net/ethernet/intel/igb/igb_main.c</code> æ–‡ä»¶ä¸­çš„ <code>igb_xmit_frame</code> å‡½æ•°ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">igb_xmit_frame              // drivers/net/ethernet/intel/igb/igb_main.c:2865    |- igb_xmit_frame_ring  // drivers/net/ethernet/intel/igb/igb_main.c:6201        |- igb_tx_map       // drivers/net/ethernet/intel/igb/igb_main.c:6157<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å‡½æ•° <code>igb_tx_map</code> åšçš„ä¸»è¦çš„å·¥ä½œå°±æ˜¯æŠŠç½‘ç»œåŒ…æ•°æ®æ˜ å°„åˆ° RAM çš„ DMA åŒºåŸŸï¼Œç„¶åå”¤é†’è®¾å¤‡å‘é€æ•°æ®ã€‚</p><h3 id="3-Intelçš„igbç½‘å¡é©±åŠ¨çš„åˆå§‹åŒ–"><a href="#3-Intelçš„igbç½‘å¡é©±åŠ¨çš„åˆå§‹åŒ–" class="headerlink" title="3. Intelçš„igbç½‘å¡é©±åŠ¨çš„åˆå§‹åŒ–"></a>3. Intelçš„igbç½‘å¡é©±åŠ¨çš„åˆå§‹åŒ–</h3><ol><li><p>æ¨¡å—åŠ è½½</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">igb_init_module                                         // drivers/net/ethernet/intel/igb/igb_main.c:680    |- pci_register_driver(&amp;igb_driver)                 // drivers/net/ethernet/intel/igb/igb_main.c:676        |- __pci_register_driver                        // include/linux/pci.h:1289            |- driver_register                          // drivers/pci/pci-driver.c:1409                |- bus_add_driver                       // drivers/base/driver.c:170                    |- driver_attach                    // drivers/base/bus.c:672                        |- __driver_attach              // drivers/base/dd.c:922                            |- driver_probe_device      // drivers/base/dd.c:903                                |- really_probe         // drivers/base/dd.c:667                                    |- drv-&gt;probe(dev)  // drivers/base/dd.c:510<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> æœ€åè°ƒç”¨çš„ <code>drv-&gt;probe(dev)</code> å…¶å®å°±æ˜¯ <code>igb_driver</code> ä¸­çš„ <code>probe</code> çš„å€¼ï¼Œå³ <code>drivers/net/ethernet/intel/igb/igb_main.c</code> æ–‡ä»¶ä¸­çš„ <code>igb_probe</code> å‡½æ•°ã€‚</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">igb_probe                                       // drivers/net/ethernet/intel/igb/igb_main.c:230    |- netdev-&gt;netdev_ops = &amp;igb_netdev_ops     // drivers/net/ethernet/intel/igb/igb_main.c:3095    |- igb_sw_init                              // drivers/net/ethernet/intel/igb/igb_main.c:3121        |- igb_init_interrupt_scheme            // drivers/net/ethernet/intel/igb/igb_main.c:3888            |- igb_alloc_q_vectors              // drivers/net/ethernet/intel/igb/igb_main.c:1387                |- igb_alloc_q_vector           // drivers/net/ethernet/intel/igb/igb_main.c:1331                    |- netif_napi_add(igb_poll) // drivers/net/ethernet/intel/igb/igb_main.c:1216                        |- napi-&gt;poll = poll    // net/core/dev.c:6194<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> å¯¹ Intel çš„ igb ç½‘å¡æ¥è¯´ï¼Œæ¨¡å—åŠ è½½å‡½æ•° <code>igb_probe</code> åšäº†ï¼š</p><ul><li>åˆå§‹åŒ–äº†è®¾å¤‡ç›¸å…³çš„æ“ä½œå›è°ƒå‡½æ•°ä¿¡æ¯ <code>igb_netdev_ops</code> ã€‚</li><li>æ³¨å†Œäº† napi çš„è½®è¯¢å›è°ƒå‡½æ•° <code>igb_poll</code> ã€‚</li></ul></li><li><p>å¯åŠ¨è®¾å¤‡</p><p> åœ¨å‡½æ•° <code>igb_probe</code> ä¸­ï¼Œé€šè¿‡è¯­å¥ <code>netdev-&gt;netdev_ops = &amp;igb_netdev_ops</code> åˆå§‹åŒ–äº†ç½‘å¡ç›¸å…³çš„æ“ä½œå›è°ƒã€‚åœ¨ç½‘å¡å¯ç”¨æ—¶ï¼Œæ¯”å¦‚æ‰§è¡Œå‘½ä»¤ <code>ifconfig eth0 up</code> æ—¶ï¼Œç³»ç»Ÿä¼šä¾æ¬¡è°ƒç”¨ï¼š</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">dev_open                        // net/core/dev.c:1430    |- __dev_open               // net/core/dev.c:1437        |- ops-&gt;ndo_open(dev)   // net/core/dev.c:1402<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p> å¯¹äºç½‘å¡é©±åŠ¨ <code>drivers/net/ethernet/intel/igb</code> æ¥è¯´ï¼Œå‡½æ•° <code>ops-&gt;ndo_open(dev)</code> è°ƒç”¨çš„å°±æ˜¯å‡½æ•° <code>igb_open</code> ã€‚</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">igb_open                                        // drivers/net/ethernet/intel/igb/igb_main.c:2863    |- __igb_open                               // drivers/net/ethernet/intel/igb/igb_main.c:4017        |- igb_request_irq                      // drivers/net/ethernet/intel/igb/igb_main.c:3953            |- igb_request_msix                 // drivers/net/ethernet/intel/igb/igb_main.c:1416                |- request_irq(igb_msix_ring)   // drivers/net/ethernet/intel/igb/igb_main.c:968        |- igb_irq_enable(adapter)              // drivers/net/ethernet/intel/igb/igb_main.c:3978<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> åœ¨ <code>igb_open</code> å‡½æ•°è°ƒç”¨çš„æ·±å¤„ï¼Œå¯¹äºå¤šé˜Ÿåˆ—ç½‘å¡ï¼Œé€šè¿‡ <code>request_irq(igb_msix_ring)</code> ä¸ºæ¯ä¸ªé˜Ÿåˆ—éƒ½æ³¨å†Œäº†ä¸­æ–­å¤„ç†å‡½æ•° <code>igb_msix_ring</code> ã€‚è®¾ç½®å¥½ä¸­æ–­å¤„ç†ç¨‹åºåï¼Œå†è°ƒç”¨ <code>igb_irq_enable(adapter)</code> æ¥å¼€å¯ä¸­æ–­ã€‚</p></li></ol><h3 id="4-Intelçš„igbç½‘å¡é©±åŠ¨çš„æ¥æ”¶æµç¨‹"><a href="#4-Intelçš„igbç½‘å¡é©±åŠ¨çš„æ¥æ”¶æµç¨‹" class="headerlink" title="4. Intelçš„igbç½‘å¡é©±åŠ¨çš„æ¥æ”¶æµç¨‹"></a>4. Intelçš„igbç½‘å¡é©±åŠ¨çš„æ¥æ”¶æµç¨‹</h3><p>å½“ç½‘å¡çš„æŸä¸ªé˜Ÿåˆ—ä¸­æ”¶åˆ°ç½‘ç»œæ•°æ®åï¼Œä¼šè§¦å‘ä¸€ä¸ªä¸­æ–­ï¼Œè¿™ä¸ªä¸­æ–­çš„å¤„ç†å‡½æ•°å°±æ˜¯åœ¨å¯åŠ¨è®¾å¤‡æ—¶è®¾ç½®çš„ <code>igb_msix_ring</code> å‡½æ•°ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">igb_msix_ring                                   // drivers/net/ethernet/intel/igb/igb_main.c:6621    |- napi_schedule                            // drivers/net/ethernet/intel/igb/igb_main.c:6628        |- __napi_schedule                      // include/linux/netdevice.h:445            |- ____napi_schedule                // net/core/dev.c:5892<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç½‘å¡é˜Ÿåˆ—ä¸­æ–­å¤„ç†å‡½æ•°æœ€æ·±å¤„çš„è°ƒç”¨ <code>____napi_schedule</code> ä¸»è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li>ä¿å­˜å¾…å¤„ç†çš„æ•°æ®ã€‚</li><li>è§¦å‘ä¸­æ–­ <code>NET_RX_SOFTIRQ</code> ã€‚</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">____napi_schedule</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">softnet_data</span> <span class="token operator">*</span>sd<span class="token punctuation">,</span>                    <span class="token keyword">struct</span> <span class="token class-name">napi_struct</span> <span class="token operator">*</span>napi<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">list_add_tail</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>napi<span class="token operator">-&gt;</span>poll_list<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sd<span class="token operator">-&gt;</span>poll_list<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">__raise_softirq_irqoff</span><span class="token punctuation">(</span>NET_RX_SOFTIRQ<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œä¸­æ–­ <code>NET_RX_SOFTIRQ</code> çš„å¤„ç†å‡½æ•°æ˜¯ <code>net_rx_action</code> ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">net_rx_action           // net/core/dev.c:9874    |- napi_poll        // net/core/dev.c:6338        |- n-&gt;poll()    // net/core/dev.c:6272<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸­æ–­å¤„ç†å‡½æ•° <code>net_rx_action</code> ï¼Œæœ€ç»ˆçš„ä¼šè°ƒç”¨å‡½æ•° <code>n-&gt;poll()</code> ã€‚è¿™å‡½æ•°å°±æ˜¯ç½‘å¡é©±åŠ¨æ¨¡å—åŠ è½½æ—¶æ³¨å†Œçš„å¤„ç†å›è°ƒå‡½æ•° <code>igb_poll</code> ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">igb_poll                                                // drivers/net/ethernet/intel/igb/igb_main.c:1216    |- igb_clean_rx_irq                                 // drivers/net/ethernet/intel/igb/igb_main.c:7759        |- napi_gro_receive                             // drivers/net/ethernet/intel/igb/igb_main.c:8408            |- napi_skb_finish                          // net/core/dev.c:5631                |- netif_receive_skb_internal           // net/core/dev.c:5600                    |- __netif_receive_skb              // net/core/dev.c:5156                        |- __netif_receive_skb_one_core // net/core/dev.c:5066                            |- __netif_receive_skb_core // net/core/dev.c:4952<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å‡½æ•° <code>__netif_receive_skb_core</code> ä¸­ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">__netif_receive_skb_core</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sk_buff</span> <span class="token operator">*</span><span class="token operator">*</span>pskb<span class="token punctuation">,</span> bool pfmemalloc<span class="token punctuation">,</span>                    <span class="token keyword">struct</span> <span class="token class-name">packet_type</span> <span class="token operator">*</span><span class="token operator">*</span>ppt_prev<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">list_for_each_entry_rcu</span><span class="token punctuation">(</span>ptype<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ptype_all<span class="token punctuation">,</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pt_prev<span class="token punctuation">)</span>            ret <span class="token operator">=</span> <span class="token function">deliver_skb</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> pt_prev<span class="token punctuation">,</span> orig_dev<span class="token punctuation">)</span><span class="token punctuation">;</span>        pt_prev <span class="token operator">=</span> ptype<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">list_for_each_entry_rcu</span><span class="token punctuation">(</span>ptype<span class="token punctuation">,</span> <span class="token operator">&amp;</span>skb<span class="token operator">-&gt;</span>dev<span class="token operator">-&gt;</span>ptype_all<span class="token punctuation">,</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pt_prev<span class="token punctuation">)</span>            ret <span class="token operator">=</span> <span class="token function">deliver_skb</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> pt_prev<span class="token punctuation">,</span> orig_dev<span class="token punctuation">)</span><span class="token punctuation">;</span>        pt_prev <span class="token operator">=</span> ptype<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">deliver_ptype_list_skb</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pt_prev<span class="token punctuation">,</span> orig_dev<span class="token punctuation">,</span> type<span class="token punctuation">,</span>                    <span class="token operator">&amp;</span>ptype_base<span class="token punctuation">[</span><span class="token function">ntohs</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">&amp;</span>                        PTYPE_HASH_MASK<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸€ä¸ªå¾ªç¯ <code>list_for_each_entry_rcu(ptype, &amp;ptype_all, list)</code> ä¸­çš„ <code>ptype_all</code> æ˜¯ä¸€ä¸ªè®¾å¤‡æ— å…³çš„ä¿å­˜æœ‰æ‰€æœ‰åè®®å¤„ç†å›è°ƒçš„åœ°æ–¹ï¼Œè€Œç¬¬äºŒä¸ªå¾ªç¯ <code>list_for_each_entry_rcu(ptype, &amp;skb-&gt;dev-&gt;ptype_all, list)</code> ä¸­çš„ <code>skb-&gt;dev-&gt;ptype_all</code> æ˜¯ä¸€ä¸ªè®¾å¤‡æœ‰å…³çš„ä¿å­˜æœ‰æ‰€æœ‰åè®®å¤„ç†å›è°ƒçš„åœ°æ–¹ã€‚è¿™ä¸¤ä¸ªå¾ªç¯å°±èƒ½è®©åƒ tcpdump è¿™æ ·çš„ç¨‹åºç›‘å¬å¤„ç†åˆ°æ”¶åˆ°çš„æ‰€æœ‰çš„ç½‘ç»œåŒ…ã€‚</p><p>åé¢ä»£ç  <code>deliver_ptype_list_skb</code> ä¸­çš„ <code>ptype_base</code> æ˜¯ä¿å­˜æ‰€æœ‰æ”¯æŒçš„3å±‚åè®®å¤„ç†å‡½æ•°çš„åœ°æ–¹ã€‚æ‰æ˜¯å°†åŒ…è½¬å‘ç»™å¯¹åº”L3å¤„ç†å‡½æ•°ã€‚å‡½æ•° <code>deliver_ptype_list_skb</code> çš„è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">deliver_ptype_list_skb      // net/core/dev.c:4905    |- deliver_skb          // net/core/dev.c:1971        |- pt_prev-&gt;func()  // net/core/dev.c:1956<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯¹äº IP åè®®æ¥è¯´ï¼Œå…¶æ³¨å†Œåˆ° <code>ptype_base</code> çš„æµç¨‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">inet_init                               // net/ipv4/af_inet.c:1890    |- dev_add_pack(&amp;ip_packet_type)    // net/core/dev.c:408<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>dev_add_pack(&amp;ip_packet_type)</code> å‡½æ•°å†…éƒ¨å°±æ˜¯æŠŠ <code>ip_packet_type</code> æ·»åŠ åˆ°å¤„ç† <code>ETH_P_IP</code> çš„åè®®é“¾ä¸­ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">packet_type</span> ip_packet_type __read_mostly <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token function">cpu_to_be16</span><span class="token punctuation">(</span>ETH_P_IP<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">.</span>func <span class="token operator">=</span> ip_rcv<span class="token punctuation">,</span>    <span class="token punctuation">.</span>list_func <span class="token operator">=</span> ip_list_rcv<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-æ¥æ”¶IPåŒ…"><a href="#5-æ¥æ”¶IPåŒ…" class="headerlink" title="5. æ¥æ”¶IPåŒ…"></a>5. æ¥æ”¶IPåŒ…</h3><p>æ‰€ä»¥å¯¹ IP æ¥è¯´ <code>pt_prev-&gt;func()</code> å®é™…è°ƒç”¨çš„æ˜¯ <code>ip_rcv</code> å‡½æ•°ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ip_rcv                                  // ip_packet_type:1886    |- ip_rcv_finish                    // net/ipv4/ip_input.c:526        |- dst_input                    // net/ipv4/ip_input.c:414            |- skb_dst(skb)-&gt;input(skb) // include/net/dst.h:461<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹ TCP/IPv4 æ¥è¯´ <code>skb_dst(skb)-&gt;input(skb)</code> è°ƒç”¨çš„å…¶å®æ˜¯ <code>net/ipv4/ip_input.c</code> æ–‡ä»¶ä¸­çš„ <code>ip_local_deliver</code> ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ip_local_deliver                // net/ipv4/route.c:1638    |- ip_local_deliver_finish  // net/ipv4/ip_input.c:258        |- ipprot-&gt;handler(skb) // net/ipv4/ip_input.c:215<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè°ƒç”¨çš„ <code>ipprot-&gt;handler(skb)</code> å°±æ˜¯ä¼ è¾“å±‚çš„å¤„ç†å›è°ƒäº†ã€‚ åœ¨æ–‡ä»¶ <code>net/ipv4/af_inet.c</code> ä¸­çš„å‡½æ•° <code>inet_init</code> å†…åˆå§‹åŒ–ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> __init <span class="token function">inet_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">inet_add_protocol</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>icmp_protocol<span class="token punctuation">,</span> IPPROTO_ICMP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">inet_add_protocol</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>udp_protocol<span class="token punctuation">,</span> IPPROTO_UDP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">inet_add_protocol</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tcp_protocol<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">inet_add_protocol</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>igmp_protocol<span class="token punctuation">,</span> IPPROTO_IGMP<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote><p><a href="https://cloud.tencent.com/developer/article/1492374">Linux syscallè¿‡ç¨‹åˆ†æï¼ˆä¸‡å­—é•¿æ–‡ï¼‰</a><br><a href="https://xinqiu.gitbooks.io/linux-insides-cn/content/SysCall/linux-syscall-2.html">Linux å†…æ ¸å¦‚ä½•å¤„ç†ç³»ç»Ÿè°ƒç”¨</a><br><a href="https://blog.packagecloud.io/eng/2017/02/06/monitoring-tuning-linux-networking-stack-sending-data/">Monitoring and Tuning the Linux Networking Stack: Sending Data</a><br><a href="https://blog.packagecloud.io/eng/2016/06/22/monitoring-tuning-linux-networking-stack-receiving-data/">Monitoring and Tuning the Linux Networking Stack: Receiving Data</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> å†…æ ¸åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹å­¦ä¹ ç¬”è®°</title>
      <link href="she-ji-mo-shi-zhi-mei-xue-xi-bi-ji/"/>
      <url>she-ji-mo-shi-zhi-mei-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹å­¦ä¹ ç¬”è®°/ç¼–å†™é«˜è´¨é‡ä»£ç .png" alt="ç¼–å†™é«˜è´¨é‡ä»£ç "></p><h2 id="è®¾è®¡åŸåˆ™ä¸æ€æƒ³"><a href="#è®¾è®¡åŸåˆ™ä¸æ€æƒ³" class="headerlink" title="è®¾è®¡åŸåˆ™ä¸æ€æƒ³"></a>è®¾è®¡åŸåˆ™ä¸æ€æƒ³</h2><h3 id="ä¸€ã€ä»£ç è´¨é‡è¯„åˆ¤æ ‡å‡†"><a href="#ä¸€ã€ä»£ç è´¨é‡è¯„åˆ¤æ ‡å‡†" class="headerlink" title="ä¸€ã€ä»£ç è´¨é‡è¯„åˆ¤æ ‡å‡†"></a>ä¸€ã€ä»£ç è´¨é‡è¯„åˆ¤æ ‡å‡†</h3><h4 id="å¦‚ä½•è¯„ä»·ä»£ç è´¨é‡çš„é«˜ä½ï¼Ÿ"><a href="#å¦‚ä½•è¯„ä»·ä»£ç è´¨é‡çš„é«˜ä½ï¼Ÿ" class="headerlink" title="å¦‚ä½•è¯„ä»·ä»£ç è´¨é‡çš„é«˜ä½ï¼Ÿ"></a>å¦‚ä½•è¯„ä»·ä»£ç è´¨é‡çš„é«˜ä½ï¼Ÿ</h4><p>ä»£ç è´¨é‡çš„è¯„ä»·æœ‰å¾ˆå¼ºçš„ä¸»è§‚æ€§ï¼Œæè¿°ä»£ç è´¨é‡çš„è¯æ±‡ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€çµæ´»ã€ä¼˜é›…ã€ç®€æ´ã€‚è¿™äº›è¯æ±‡æ˜¯ä»ä¸åŒçš„ç»´åº¦å»è¯„ä»·ä»£ç è´¨é‡çš„ã€‚å®ƒä»¬ä¹‹é—´æœ‰äº’ç›¸ä½œç”¨ï¼Œå¹¶ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯”å¦‚ï¼Œä»£ç çš„å¯è¯»æ€§å¥½ã€å¯æ‰©å±•æ€§å¥½å°±æ„å‘³ç€ä»£ç çš„å¯ç»´æŠ¤æ€§å¥½ã€‚ä»£ç è´¨é‡é«˜ä½æ˜¯ä¸€ä¸ªç»¼åˆå„ç§å› ç´ å¾—åˆ°çš„ç»“è®ºã€‚æˆ‘ä»¬å¹¶ä¸èƒ½é€šè¿‡å•ä¸€ç»´åº¦å»è¯„ä»·ä¸€æ®µä»£ç çš„å¥½åã€‚</p><h4 id="æœ€å¸¸ç”¨çš„è¯„ä»·æ ‡å‡†æœ‰å“ªå‡ ä¸ªï¼Ÿ"><a href="#æœ€å¸¸ç”¨çš„è¯„ä»·æ ‡å‡†æœ‰å“ªå‡ ä¸ªï¼Ÿ" class="headerlink" title="æœ€å¸¸ç”¨çš„è¯„ä»·æ ‡å‡†æœ‰å“ªå‡ ä¸ªï¼Ÿ"></a>æœ€å¸¸ç”¨çš„è¯„ä»·æ ‡å‡†æœ‰å“ªå‡ ä¸ªï¼Ÿ</h4><p>æœ€å¸¸ç”¨åˆ°å‡ ä¸ªè¯„åˆ¤ä»£ç è´¨é‡çš„æ ‡å‡†æœ‰ï¼šå¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§ã€å¯æ‰©å±•æ€§ã€çµæ´»æ€§ã€ç®€æ´æ€§ã€å¯å¤ç”¨æ€§ã€å¯æµ‹è¯•æ€§ã€‚å…¶ä¸­ï¼Œå¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§ã€å¯æ‰©å±•æ€§åˆæ˜¯æåˆ°æœ€å¤šçš„ã€æœ€é‡è¦çš„ä¸‰ä¸ªè¯„ä»·æ ‡å‡†ã€‚</p><h4 id="å¦‚ä½•æ‰èƒ½å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼Ÿ"><a href="#å¦‚ä½•æ‰èƒ½å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‰èƒ½å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼Ÿ"></a>å¦‚ä½•æ‰èƒ½å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼Ÿ</h4><p>è¦å†™å‡ºé«˜è´¨é‡ä»£ç ï¼Œæˆ‘ä»¬å°±éœ€è¦æŒæ¡ä¸€äº›æ›´åŠ ç»†åŒ–ã€æ›´åŠ èƒ½è½åœ°çš„ç¼–ç¨‹æ–¹æ³•è®ºï¼Œè¿™å°±åŒ…å«é¢å‘å¯¹è±¡è®¾è®¡æ€æƒ³ã€è®¾è®¡åŸåˆ™ã€è®¾è®¡æ¨¡å¼ã€ç¼–ç è§„èŒƒã€é‡æ„æŠ€å·§ç­‰ã€‚</p><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹å­¦ä¹ ç¬”è®°/ä»£ç è´¨é‡è¯„åˆ¤æ ‡å‡†.jpg" alt="ä»£ç è´¨é‡è¯„åˆ¤æ ‡å‡†"></p><h3 id="äºŒã€é¢å‘å¯¹è±¡"><a href="#äºŒã€é¢å‘å¯¹è±¡" class="headerlink" title="äºŒã€é¢å‘å¯¹è±¡"></a>äºŒã€é¢å‘å¯¹è±¡</h3><h4 id="1-é¢å‘å¯¹è±¡æ¦‚è¿°"><a href="#1-é¢å‘å¯¹è±¡æ¦‚è¿°" class="headerlink" title="1. é¢å‘å¯¹è±¡æ¦‚è¿°"></a>1. é¢å‘å¯¹è±¡æ¦‚è¿°</h4><p>ç°åœ¨ï¼Œä¸»æµçš„ç¼–ç¨‹èŒƒå¼æˆ–è€…ç¼–ç¨‹é£æ ¼æœ‰ä¸‰ç§ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯é¢å‘è¿‡ç¨‹ã€é¢å‘å¯¹è±¡å’Œå‡½æ•°å¼ç¼–ç¨‹ã€‚é¢å‘å¯¹è±¡è¿™ç§ç¼–ç¨‹é£æ ¼åˆæ˜¯è¿™å…¶ä¸­æœ€ä¸»æµçš„ã€‚ç°åœ¨æ¯”è¾ƒæµè¡Œçš„ç¼–ç¨‹è¯­è¨€å¤§éƒ¨åˆ†éƒ½æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ã€‚å¤§éƒ¨åˆ†é¡¹ç›®ä¹Ÿéƒ½æ˜¯åŸºäºé¢å‘å¯¹è±¡ç¼–ç¨‹é£æ ¼å¼€å‘çš„ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹å› ä¸ºå…¶å…·æœ‰ä¸°å¯Œçš„ç‰¹æ€§ï¼ˆå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€ï¼‰ï¼Œå¯ä»¥å®ç°å¾ˆå¤šå¤æ‚çš„è®¾è®¡æ€è·¯ï¼Œæ˜¯å¾ˆå¤šè®¾è®¡åŸåˆ™ã€è®¾è®¡æ¨¡å¼ç¼–ç å®ç°çš„åŸºç¡€ã€‚</p><h4 id="2-é¢å‘å¯¹è±¡å››å¤§ç‰¹æ€§"><a href="#2-é¢å‘å¯¹è±¡å››å¤§ç‰¹æ€§" class="headerlink" title="2. é¢å‘å¯¹è±¡å››å¤§ç‰¹æ€§"></a>2. é¢å‘å¯¹è±¡å››å¤§ç‰¹æ€§</h4><p>å°è£…ä¹Ÿå«ä½œä¿¡æ¯éšè—æˆ–è€…æ•°æ®è®¿é—®ä¿æŠ¤ã€‚ç±»é€šè¿‡æš´éœ²æœ‰é™çš„è®¿é—®æ¥å£ï¼Œæˆæƒå¤–éƒ¨ä»…èƒ½é€šè¿‡ç±»æä¾›çš„æ–¹æ³•æ¥è®¿é—®å†…éƒ¨ä¿¡æ¯æˆ–è€…æ•°æ®ã€‚å®ƒéœ€è¦ç¼–ç¨‹è¯­è¨€æä¾›æƒé™è®¿é—®æ§åˆ¶è¯­æ³•æ¥æ”¯æŒï¼Œä¾‹å¦‚ Java ä¸­çš„ privateã€protectedã€public å…³é”®å­—ã€‚å°è£…ç‰¹æ€§å­˜åœ¨çš„æ„ä¹‰ï¼Œä¸€æ–¹é¢æ˜¯ä¿æŠ¤æ•°æ®ä¸è¢«éšæ„ä¿®æ”¹ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼›å¦ä¸€æ–¹é¢æ˜¯ä»…æš´éœ²æœ‰é™çš„å¿…è¦æ¥å£ï¼Œæé«˜ç±»çš„æ˜“ç”¨æ€§ã€‚</p><p>å¦‚æœè¯´å°è£…ä¸»è¦è®²å¦‚ä½•éšè—ä¿¡æ¯ã€ä¿æŠ¤æ•°æ®ï¼Œé‚£æŠ½è±¡å°±æ˜¯è®²å¦‚ä½•éšè—æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè®©ä½¿ç”¨è€…åªéœ€è¦å…³å¿ƒæ–¹æ³•æä¾›äº†å“ªäº›åŠŸèƒ½ï¼Œä¸éœ€è¦çŸ¥é“è¿™äº›åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ã€‚æŠ½è±¡å¯ä»¥é€šè¿‡æ¥å£ç±»æˆ–è€…æŠ½è±¡ç±»æ¥å®ç°ã€‚æŠ½è±¡å­˜åœ¨çš„æ„ä¹‰ï¼Œä¸€æ–¹é¢æ˜¯ä¿®æ”¹å®ç°ä¸éœ€è¦æ”¹å˜å®šä¹‰ï¼›å¦ä¸€æ–¹é¢ï¼Œå®ƒä¹Ÿæ˜¯å¤„ç†å¤æ‚ç³»ç»Ÿçš„æœ‰æ•ˆæ‰‹æ®µï¼Œèƒ½æœ‰æ•ˆåœ°è¿‡æ»¤æ‰ä¸å¿…è¦å…³æ³¨çš„ä¿¡æ¯ã€‚</p><p>ç»§æ‰¿ç”¨æ¥è¡¨ç¤ºç±»ä¹‹é—´çš„ is-a å…³ç³»ï¼Œåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼šå•ç»§æ‰¿å’Œå¤šç»§æ‰¿ã€‚å•ç»§æ‰¿è¡¨ç¤ºä¸€ä¸ªå­ç±»åªç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå¤šç»§æ‰¿è¡¨ç¤ºä¸€ä¸ªå­ç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ã€‚ä¸ºäº†å®ç°ç»§æ‰¿è¿™ä¸ªç‰¹æ€§ï¼Œç¼–ç¨‹è¯­è¨€éœ€è¦æä¾›ç‰¹æ®Šçš„è¯­æ³•æœºåˆ¶æ¥æ”¯æŒã€‚ç»§æ‰¿ä¸»è¦æ˜¯ç”¨æ¥è§£å†³ä»£ç å¤ç”¨çš„é—®é¢˜ã€‚</p><p>å¤šæ€æ˜¯æŒ‡å­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»ï¼Œåœ¨å®é™…çš„ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨å­ç±»çš„æ–¹æ³•å®ç°ã€‚å¤šæ€è¿™ç§ç‰¹æ€§ä¹Ÿéœ€è¦ç¼–ç¨‹è¯­è¨€æä¾›ç‰¹æ®Šçš„è¯­æ³•æœºåˆ¶æ¥å®ç°ï¼Œæ¯”å¦‚ç»§æ‰¿ã€æ¥å£ç±»ã€duck-typingã€‚å¤šæ€å¯ä»¥æé«˜ä»£ç çš„æ‰©å±•æ€§å’Œå¤ç”¨æ€§ï¼Œæ˜¯å¾ˆå¤šè®¾è®¡æ¨¡å¼ã€è®¾è®¡åŸåˆ™ã€ç¼–ç¨‹æŠ€å·§çš„ä»£ç å®ç°åŸºç¡€ã€‚</p><h4 id="3-é¢å‘å¯¹è±¡-VS-é¢å‘è¿‡ç¨‹"><a href="#3-é¢å‘å¯¹è±¡-VS-é¢å‘è¿‡ç¨‹" class="headerlink" title="3. é¢å‘å¯¹è±¡ VS é¢å‘è¿‡ç¨‹"></a>3. é¢å‘å¯¹è±¡ VS é¢å‘è¿‡ç¨‹</h4><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ç›¸æ¯”é¢å‘è¿‡ç¨‹ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸»è¦æœ‰ä¸‰ä¸ªã€‚</p><ul><li>å¯¹äºå¤§è§„æ¨¡å¤æ‚ç¨‹åºçš„å¼€å‘ï¼Œç¨‹åºçš„å¤„ç†æµç¨‹å¹¶éå•ä¸€çš„ä¸€æ¡ä¸»çº¿ï¼Œè€Œæ˜¯é”™ç»¼å¤æ‚çš„ç½‘çŠ¶ç»“æ„ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹æ¯”èµ·é¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼Œæ›´èƒ½åº”å¯¹è¿™ç§å¤æ‚ç±»å‹çš„ç¨‹åºå¼€å‘ã€‚</li><li>é¢å‘å¯¹è±¡ç¼–ç¨‹ç›¸æ¯”é¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼Œå…·æœ‰æ›´åŠ ä¸°å¯Œçš„ç‰¹æ€§ï¼ˆå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€ï¼‰ã€‚åˆ©ç”¨è¿™äº›ç‰¹æ€§ç¼–å†™å‡ºæ¥çš„ä»£ç ï¼Œæ›´åŠ æ˜“æ‰©å±•ã€æ˜“å¤ç”¨ã€æ˜“ç»´æŠ¤ã€‚</li><li>ä»ç¼–ç¨‹è¯­è¨€è·Ÿæœºå™¨æ‰“äº¤é“æ–¹å¼çš„æ¼”è¿›è§„å¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€æ¯”èµ·é¢å‘è¿‡ç¨‹ç¼–ç¨‹è¯­è¨€ï¼Œæ›´åŠ äººæ€§åŒ–ã€æ›´åŠ é«˜çº§ã€æ›´åŠ æ™ºèƒ½ã€‚</li></ul><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸€èˆ¬ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€æ¥è¿›è¡Œï¼Œä½†æ˜¯ï¼Œä¸ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼Œæˆ‘ä»¬ç…§æ ·å¯ä»¥è¿›è¡Œé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚åè¿‡æ¥è®²ï¼Œå³ä¾¿æˆ‘ä»¬ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼Œå†™å‡ºæ¥çš„ä»£ç ä¹Ÿä¸ä¸€å®šæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹é£æ ¼çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯é¢å‘è¿‡ç¨‹ç¼–ç¨‹é£æ ¼çš„ã€‚</p><p>é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹ä¸¤ç§ç¼–ç¨‹é£æ ¼å¹¶ä¸æ˜¯éé»‘å³ç™½ã€å®Œå…¨å¯¹ç«‹çš„ã€‚åœ¨ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€å¼€å‘çš„è½¯ä»¶ä¸­ï¼Œé¢å‘è¿‡ç¨‹é£æ ¼çš„ä»£ç å¹¶ä¸å°‘è§ï¼Œç”šè‡³åœ¨ä¸€äº›æ ‡å‡†çš„å¼€å‘åº“ï¼ˆæ¯”å¦‚ JDKã€Apache Commonsã€Google Guavaï¼‰ä¸­ï¼Œä¹Ÿæœ‰å¾ˆå¤šé¢å‘è¿‡ç¨‹é£æ ¼çš„ä»£ç ã€‚</p><p>ä¸ç®¡ä½¿ç”¨é¢å‘è¿‡ç¨‹è¿˜æ˜¯é¢å‘å¯¹è±¡å“ªç§é£æ ¼æ¥å†™ä»£ç ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„è¿˜æ˜¯å†™å‡ºæ˜“ç»´æŠ¤ã€æ˜“è¯»ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•çš„é«˜è´¨é‡ä»£ç ã€‚åªè¦æˆ‘ä»¬èƒ½é¿å…é¢å‘è¿‡ç¨‹ç¼–ç¨‹é£æ ¼çš„ä¸€äº›å¼Šç«¯ï¼Œæ§åˆ¶å¥½å®ƒçš„å‰¯ä½œç”¨ï¼Œåœ¨æŒæ§èŒƒå›´å†…ä¸ºæˆ‘ä»¬æ‰€ç”¨ï¼Œæˆ‘ä»¬å°±å¤§å¯ä¸ç”¨é¿è®³åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­å†™é¢å‘è¿‡ç¨‹é£æ ¼çš„ä»£ç ã€‚</p><h4 id="4-é¢å‘å¯¹è±¡åˆ†æã€è®¾è®¡ä¸ç¼–ç¨‹"><a href="#4-é¢å‘å¯¹è±¡åˆ†æã€è®¾è®¡ä¸ç¼–ç¨‹" class="headerlink" title="4. é¢å‘å¯¹è±¡åˆ†æã€è®¾è®¡ä¸ç¼–ç¨‹"></a>4. é¢å‘å¯¹è±¡åˆ†æã€è®¾è®¡ä¸ç¼–ç¨‹</h4><p>é¢å‘å¯¹è±¡åˆ†æï¼ˆOOAï¼‰ã€é¢å‘å¯¹è±¡è®¾è®¡ï¼ˆOODï¼‰ã€é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ï¼Œæ˜¯é¢å‘å¯¹è±¡å¼€å‘çš„ä¸‰ä¸ªä¸»è¦ç¯èŠ‚ã€‚ç®€å•ç‚¹è®²ï¼Œé¢å‘å¯¹è±¡åˆ†æå°±æ˜¯è¦ææ¸…æ¥šåšä»€ä¹ˆï¼Œé¢å‘å¯¹è±¡è®¾è®¡å°±æ˜¯è¦ææ¸…æ¥šæ€ä¹ˆåšï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹å°±æ˜¯å°†åˆ†æå’Œè®¾è®¡çš„çš„ç»“æœç¿»è¯‘æˆä»£ç çš„è¿‡ç¨‹ã€‚</p><p>éœ€æ±‚åˆ†æçš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸æ–­è¿­ä»£ä¼˜åŒ–çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä¸è¦è¯•å›¾ä¸€ä¸‹å°±ç»™å‡ºä¸€ä¸ªå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å…ˆç»™å‡ºä¸€ä¸ªç²—ç³™çš„ã€åŸºç¡€çš„æ–¹æ¡ˆï¼Œæœ‰ä¸€ä¸ªè¿­ä»£çš„åŸºç¡€ï¼Œç„¶åå†æ…¢æ…¢ä¼˜åŒ–ã€‚è¿™æ ·ä¸€ä¸ªæ€è€ƒè¿‡ç¨‹èƒ½è®©æˆ‘ä»¬æ‘†è„±æ— ä»ä¸‹æ‰‹çš„çª˜å¢ƒã€‚</p><p>é¢å‘å¯¹è±¡è®¾è®¡å’Œå®ç°è¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠåˆé€‚çš„ä»£ç æ”¾åˆ°åˆé€‚çš„ç±»ä¸­ã€‚è‡³äºåˆ°åº•é€‰æ‹©å“ªç§åˆ’åˆ†æ–¹æ³•ï¼Œåˆ¤å®šçš„æ ‡å‡†æ˜¯è®©ä»£ç å°½é‡åœ°æ»¡è¶³â€œæ¾è€¦åˆã€é«˜å†…èšâ€ã€å•ä¸€èŒè´£ã€å¯¹æ‰©å±•å¼€æ”¾å¯¹ä¿®æ”¹å…³é—­ç­‰æˆ‘ä»¬ä¹‹å‰è®²åˆ°çš„å„ç§è®¾è®¡åŸåˆ™å’Œæ€æƒ³ï¼Œå°½é‡åœ°åšåˆ°ä»£ç å¯å¤ç”¨ã€æ˜“è¯»ã€æ˜“æ‰©å±•ã€æ˜“ç»´æŠ¤ã€‚</p><p>é¢å‘å¯¹è±¡åˆ†æçš„äº§å‡ºæ˜¯è¯¦ç»†çš„éœ€æ±‚æè¿°ã€‚é¢å‘å¯¹è±¡è®¾è®¡çš„äº§å‡ºæ˜¯ç±»ã€‚åœ¨é¢å‘å¯¹è±¡è®¾è®¡è¿™ä¸€ç¯èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†éœ€æ±‚æè¿°è½¬åŒ–ä¸ºå…·ä½“çš„ç±»çš„è®¾è®¡ã€‚è¿™ä¸ªç¯èŠ‚çš„å·¥ä½œå¯ä»¥æ‹†åˆ†ä¸ºä¸‹é¢å››ä¸ªéƒ¨åˆ†ã€‚</p><ul><li><p>åˆ’åˆ†èŒè´£è¿›è€Œè¯†åˆ«å‡ºæœ‰å“ªäº›ç±»</p><p>  æ ¹æ®éœ€æ±‚æè¿°ï¼Œæˆ‘ä»¬æŠŠå…¶ä¸­æ¶‰åŠçš„åŠŸèƒ½ç‚¹ï¼Œä¸€ä¸ªä¸€ä¸ªç½—åˆ—å‡ºæ¥ï¼Œç„¶åå†å»çœ‹å“ªäº›åŠŸèƒ½ç‚¹èŒè´£ç›¸è¿‘ï¼Œæ“ä½œåŒæ ·çš„å±æ€§ï¼Œå¯å¦å½’ä¸ºåŒä¸€ä¸ªç±»ã€‚</p></li><li><p>å®šä¹‰ç±»åŠå…¶å±æ€§å’Œæ–¹æ³•</p><p>  æˆ‘ä»¬è¯†åˆ«å‡ºéœ€æ±‚æè¿°ä¸­çš„åŠ¨è¯ï¼Œä½œä¸ºå€™é€‰çš„æ–¹æ³•ï¼Œå†è¿›ä¸€æ­¥è¿‡æ»¤ç­›é€‰å‡ºçœŸæ­£çš„æ–¹æ³•ï¼ŒæŠŠåŠŸèƒ½ç‚¹ä¸­æ¶‰åŠçš„åè¯ï¼Œä½œä¸ºå€™é€‰å±æ€§ï¼Œç„¶ååŒæ ·å†è¿›è¡Œè¿‡æ»¤ç­›é€‰ã€‚</p></li><li><p>å®šä¹‰ç±»ä¸ç±»ä¹‹é—´çš„äº¤äº’å…³ç³»</p><p>  UML ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ä¸­å®šä¹‰äº†å…­ç§ç±»ä¹‹é—´çš„å…³ç³»ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼šæ³›åŒ–ã€å®ç°ã€å…³è”ã€èšåˆã€ç»„åˆã€ä¾èµ–ã€‚æˆ‘ä»¬ä»æ›´åŠ è´´è¿‘ç¼–ç¨‹çš„è§’åº¦ï¼Œå¯¹ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»åšäº†è°ƒæ•´ï¼Œä¿ç•™äº†å››ä¸ªå…³ç³»ï¼šæ³›åŒ–ã€å®ç°ã€ç»„åˆã€ä¾èµ–ã€‚</p></li><li><p>å°†ç±»ç»„è£…èµ·æ¥å¹¶æä¾›æ‰§è¡Œå…¥å£</p><p>  æˆ‘ä»¬è¦å°†æ‰€æœ‰çš„ç±»ç»„è£…åœ¨ä¸€èµ·ï¼Œæä¾›ä¸€ä¸ªæ‰§è¡Œå…¥å£ã€‚è¿™ä¸ªå…¥å£å¯èƒ½æ˜¯ä¸€ä¸ª main() å‡½æ•°ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ç»„ç»™å¤–éƒ¨ç”¨çš„ API æ¥å£ã€‚é€šè¿‡è¿™ä¸ªå…¥å£ï¼Œæˆ‘ä»¬èƒ½è§¦å‘æ•´ä¸ªä»£ç è·‘èµ·æ¥ã€‚</p></li></ul><h4 id="5-æ¥å£-VS-æŠ½è±¡ç±»"><a href="#5-æ¥å£-VS-æŠ½è±¡ç±»" class="headerlink" title="5. æ¥å£ VS æŠ½è±¡ç±»"></a>5. æ¥å£ VS æŠ½è±¡ç±»</h4><p>æŠ½è±¡ç±»ä¸å…è®¸è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«ç»§æ‰¿ã€‚å®ƒå¯ä»¥åŒ…å«å±æ€§å’Œæ–¹æ³•ã€‚æ–¹æ³•æ—¢å¯ä»¥åŒ…å«ä»£ç å®ç°ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«ä»£ç å®ç°ã€‚ä¸åŒ…å«ä»£ç å®ç°çš„æ–¹æ³•å«ä½œæŠ½è±¡æ–¹æ³•ã€‚å­ç±»ç»§æ‰¿æŠ½è±¡ç±»ï¼Œå¿…é¡»å®ç°æŠ½è±¡ç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ã€‚æ¥å£ä¸èƒ½åŒ…å«å±æ€§ï¼ˆJava å¯ä»¥å®šä¹‰é™æ€å¸¸é‡ï¼‰ï¼Œåªèƒ½å£°æ˜æ–¹æ³•ï¼Œæ–¹æ³•ä¸èƒ½åŒ…å«ä»£ç å®ç°ï¼ˆJava8 ä»¥åå¯ä»¥æœ‰é»˜è®¤å®ç°ï¼‰ã€‚ç±»å®ç°æ¥å£çš„æ—¶å€™ï¼Œå¿…é¡»å®ç°æ¥å£ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ã€‚</p><p>æŠ½è±¡ç±»æ˜¯å¯¹æˆå‘˜å˜é‡å’Œæ–¹æ³•çš„æŠ½è±¡ï¼Œæ˜¯ä¸€ç§ is-a å…³ç³»ï¼Œæ˜¯ä¸ºäº†è§£å†³ä»£ç å¤ç”¨é—®é¢˜ã€‚æ¥å£ä»…ä»…æ˜¯å¯¹æ–¹æ³•çš„æŠ½è±¡ï¼Œæ˜¯ä¸€ç§ has-a å…³ç³»ï¼Œè¡¨ç¤ºå…·æœ‰æŸä¸€ç»„è¡Œä¸ºç‰¹æ€§ï¼Œæ˜¯ä¸ºäº†è§£å†³è§£è€¦é—®é¢˜ï¼Œéš”ç¦»æ¥å£å’Œå…·ä½“çš„å®ç°ï¼Œæé«˜ä»£ç çš„æ‰©å±•æ€§ã€‚</p><p>ä»€ä¹ˆæ—¶å€™è¯¥ç”¨æŠ½è±¡ç±»ï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥ç”¨æ¥å£ï¼Ÿå®é™…ä¸Šï¼Œåˆ¤æ–­çš„æ ‡å‡†å¾ˆç®€å•ã€‚å¦‚æœè¦è¡¨ç¤ºä¸€ç§ is-a çš„å…³ç³»ï¼Œå¹¶ä¸”æ˜¯ä¸ºäº†è§£å†³ä»£ç å¤ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬å°±ç”¨æŠ½è±¡ç±»ï¼›å¦‚æœè¦è¡¨ç¤ºä¸€ç§ has-a å…³ç³»ï¼Œå¹¶ä¸”æ˜¯ä¸ºäº†è§£å†³æŠ½è±¡è€Œéä»£ç å¤ç”¨é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å°±ç”¨æ¥å£ã€‚</p><h4 id="6-åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹"><a href="#6-åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹" class="headerlink" title="6. åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹"></a>6. åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹</h4><p>åº”ç”¨è¿™æ¡åŸåˆ™ï¼Œå¯ä»¥å°†æ¥å£å’Œå®ç°ç›¸åˆ†ç¦»ï¼Œå°è£…ä¸ç¨³å®šçš„å®ç°ï¼Œæš´éœ²ç¨³å®šçš„æ¥å£ã€‚ä¸Šæ¸¸ç³»ç»Ÿé¢å‘æ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä¸ä¾èµ–ä¸ç¨³å®šçš„å®ç°ç»†èŠ‚ï¼Œè¿™æ ·å½“å®ç°å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¸Šæ¸¸ç³»ç»Ÿçš„ä»£ç åŸºæœ¬ä¸Šä¸éœ€è¦åšæ”¹åŠ¨ï¼Œä»¥æ­¤æ¥é™ä½è€¦åˆæ€§ï¼Œæé«˜æ‰©å±•æ€§ã€‚</p><p>å®é™…ä¸Šï¼Œâ€œåŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹â€è¿™æ¡åŸåˆ™çš„å¦ä¸€ä¸ªè¡¨è¿°æ–¹å¼æ˜¯ï¼Œâ€œåŸºäºæŠ½è±¡è€Œéå®ç°ç¼–ç¨‹â€ã€‚åè€…çš„è¡¨è¿°æ–¹å¼å…¶å®æ›´èƒ½ä½“ç°è¿™æ¡åŸåˆ™çš„è®¾è®¡åˆè¡·ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæœ€å¤§çš„æŒ‘æˆ˜ä¹‹ä¸€å°±æ˜¯éœ€æ±‚çš„ä¸æ–­å˜åŒ–ï¼Œè¿™ä¹Ÿæ˜¯è€ƒéªŒä»£ç è®¾è®¡å¥½åçš„ä¸€ä¸ªæ ‡å‡†ã€‚</p><p>è¶ŠæŠ½è±¡ã€è¶Šé¡¶å±‚ã€è¶Šè„±ç¦»å…·ä½“æŸä¸€å®ç°çš„è®¾è®¡ï¼Œè¶Šèƒ½æé«˜ä»£ç çš„çµæ´»æ€§ï¼Œè¶Šèƒ½åº”å¯¹æœªæ¥çš„éœ€æ±‚å˜åŒ–ã€‚å¥½çš„ä»£ç è®¾è®¡ï¼Œä¸ä»…èƒ½åº”å¯¹å½“ä¸‹çš„éœ€æ±‚ï¼Œè€Œä¸”åœ¨å°†æ¥éœ€æ±‚å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿåœ¨ä¸ç ´ååŸæœ‰ä»£ç è®¾è®¡çš„æƒ…å†µä¸‹çµæ´»åº”å¯¹ã€‚è€ŒæŠ½è±¡å°±æ˜¯æé«˜ä»£ç æ‰©å±•æ€§ã€çµæ´»æ€§ã€å¯ç»´æŠ¤æ€§æœ€æœ‰æ•ˆçš„æ‰‹æ®µä¹‹ä¸€ã€‚</p><h4 id="7-å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿"><a href="#7-å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿" class="headerlink" title="7. å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿"></a>7. å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿</h4><ul><li><p>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ç»§æ‰¿ï¼Ÿ</p><p>  ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡çš„å››å¤§ç‰¹æ€§ä¹‹ä¸€ï¼Œç”¨æ¥è¡¨ç¤ºç±»ä¹‹é—´çš„ is-a å…³ç³»ï¼Œå¯ä»¥è§£å†³ä»£ç å¤ç”¨çš„é—®é¢˜ã€‚è™½ç„¶ç»§æ‰¿æœ‰è¯¸å¤šä½œç”¨ï¼Œä½†ç»§æ‰¿å±‚æ¬¡è¿‡æ·±ã€è¿‡å¤æ‚ï¼Œä¹Ÿä¼šå½±å“åˆ°ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å°‘ç”¨ï¼Œç”šè‡³ä¸ç”¨ç»§æ‰¿ã€‚</p></li><li><p>ç»„åˆç›¸æ¯”ç»§æ‰¿æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ</p><p>  ç»§æ‰¿ä¸»è¦æœ‰ä¸‰ä¸ªä½œç”¨ï¼šè¡¨ç¤º is-a å…³ç³»ã€æ”¯æŒå¤šæ€ç‰¹æ€§ã€ä»£ç å¤ç”¨ã€‚è€Œè¿™ä¸‰ä¸ªä½œç”¨éƒ½å¯ä»¥é€šè¿‡ç»„åˆã€æ¥å£ã€å§”æ‰˜ä¸‰ä¸ªæŠ€æœ¯æ‰‹æ®µæ¥è¾¾æˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåˆ©ç”¨ç»„åˆè¿˜èƒ½è§£å†³å±‚æ¬¡è¿‡æ·±ã€è¿‡å¤æ‚çš„ç»§æ‰¿å…³ç³»å½±å“ä»£ç å¯ç»´æŠ¤æ€§çš„é—®é¢˜ã€‚</p></li><li><p>å¦‚ä½•åˆ¤æ–­è¯¥ç”¨ç»„åˆè¿˜æ˜¯ç»§æ‰¿ï¼Ÿ</p><p>  å°½ç®¡æˆ‘ä»¬é¼“åŠ±å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ï¼Œä½†ç»„åˆä¹Ÿå¹¶ä¸æ˜¯å®Œç¾çš„ï¼Œç»§æ‰¿ä¹Ÿå¹¶éä¸€æ— æ˜¯å¤„ã€‚åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æ ¹æ®å…·ä½“çš„æƒ…å†µï¼Œæ¥é€‰æ‹©è¯¥ç”¨ç»§æ‰¿è¿˜æ˜¯ç»„åˆã€‚å¦‚æœç±»ä¹‹é—´çš„ç»§æ‰¿ç»“æ„ç¨³å®šï¼Œå±‚æ¬¡æ¯”è¾ƒæµ…ï¼Œå…³ç³»ä¸å¤æ‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤§èƒ†åœ°ä½¿ç”¨ç»§æ‰¿ã€‚åä¹‹ï¼Œæˆ‘ä»¬å°±å°½é‡ä½¿ç”¨ç»„åˆæ¥æ›¿ä»£ç»§æ‰¿ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›è®¾è®¡æ¨¡å¼ã€ç‰¹æ®Šçš„åº”ç”¨åœºæ™¯ï¼Œä¼šå›ºå®šä½¿ç”¨ç»§æ‰¿æˆ–è€…ç»„åˆã€‚</p></li></ul><h4 id="8-è´«è¡€æ¨¡å‹-VS-å……è¡€æ¨¡å‹"><a href="#8-è´«è¡€æ¨¡å‹-VS-å……è¡€æ¨¡å‹" class="headerlink" title="8. è´«è¡€æ¨¡å‹ VS å……è¡€æ¨¡å‹"></a>8. è´«è¡€æ¨¡å‹ VS å……è¡€æ¨¡å‹</h4><p>æˆ‘ä»¬å¹³æ—¶åš Web é¡¹ç›®çš„ä¸šåŠ¡å¼€å‘ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºè´«è¡€æ¨¡å‹çš„ MVC ä¸‰å±‚æ¶æ„ï¼Œåœ¨ä¸“æ ä¸­æˆ‘æŠŠå®ƒç§°ä¸ºä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ã€‚ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºâ€œä¼ ç»Ÿâ€ï¼Œæ˜¯ç›¸å¯¹äºæ–°å…´çš„åŸºäºå……è¡€æ¨¡å‹çš„ DDD å¼€å‘æ¨¡å¼æ¥è¯´çš„ã€‚åŸºäºè´«è¡€æ¨¡å‹çš„ä¼ ç»Ÿå¼€å‘æ¨¡å¼ï¼Œæ˜¯å…¸å‹çš„é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹é£æ ¼ã€‚ç›¸åï¼ŒåŸºäºå……è¡€æ¨¡å‹çš„ DDD å¼€å‘æ¨¡å¼ï¼Œæ˜¯å…¸å‹çš„é¢å‘å¯¹è±¡çš„ç¼–ç¨‹é£æ ¼ã€‚</p><p>ä¸è¿‡ï¼ŒDDD ä¹Ÿå¹¶éé“¶å¼¹ã€‚å¯¹äºä¸šåŠ¡ä¸å¤æ‚çš„ç³»ç»Ÿå¼€å‘æ¥è¯´ï¼ŒåŸºäºè´«è¡€æ¨¡å‹çš„ä¼ ç»Ÿå¼€å‘æ¨¡å¼ç®€å•å¤Ÿç”¨ï¼ŒåŸºäºå……è¡€æ¨¡å‹çš„ DDD å¼€å‘æ¨¡å¼æœ‰ç‚¹å¤§æå°ç”¨ï¼Œæ— æ³•å‘æŒ¥ä½œç”¨ã€‚ç›¸åï¼Œå¯¹äºä¸šåŠ¡å¤æ‚çš„ç³»ç»Ÿå¼€å‘æ¥è¯´ï¼ŒåŸºäºå……è¡€æ¨¡å‹çš„ DDD å¼€å‘æ¨¡å¼ï¼Œå› ä¸ºå‰æœŸéœ€è¦åœ¨è®¾è®¡ä¸ŠæŠ•å…¥æ›´å¤šæ—¶é—´å’Œç²¾åŠ›ï¼Œæ¥æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæ‰€ä»¥ç›¸æ¯”åŸºäºè´«è¡€æ¨¡å‹çš„å¼€å‘æ¨¡å¼ï¼Œæ›´åŠ æœ‰ä¼˜åŠ¿ã€‚</p><p>åŸºäºå……è¡€æ¨¡å‹çš„ DDD å¼€å‘æ¨¡å¼è·ŸåŸºäºè´«è¡€æ¨¡å‹çš„ä¼ ç»Ÿå¼€å‘æ¨¡å¼ç›¸æ¯”ï¼Œä¸»è¦åŒºåˆ«åœ¨ Service å±‚ã€‚åœ¨åŸºäºå……è¡€æ¨¡å‹çš„å¼€å‘æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å°†éƒ¨åˆ†åŸæ¥åœ¨ Service ç±»ä¸­çš„ä¸šåŠ¡é€»è¾‘ç§»åŠ¨åˆ°äº†ä¸€ä¸ªå……è¡€çš„ Domain é¢†åŸŸæ¨¡å‹ä¸­ï¼Œè®© Service ç±»çš„å®ç°ä¾èµ–è¿™ä¸ª Domain ç±»ã€‚ä¸è¿‡ï¼ŒService ç±»å¹¶ä¸ä¼šå®Œå…¨ç§»é™¤ï¼Œè€Œæ˜¯è´Ÿè´£ä¸€äº›ä¸é€‚åˆæ”¾åœ¨ Domain ç±»ä¸­çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œè´Ÿè´£ä¸ Repository å±‚æ‰“äº¤é“ã€è·¨é¢†åŸŸæ¨¡å‹çš„ä¸šåŠ¡èšåˆåŠŸèƒ½ã€å¹‚ç­‰äº‹åŠ¡ç­‰éåŠŸèƒ½æ€§çš„å·¥ä½œã€‚</p><p>åŸºäºå……è¡€æ¨¡å‹çš„ DDD å¼€å‘æ¨¡å¼è·ŸåŸºäºè´«è¡€æ¨¡å‹çš„ä¼ ç»Ÿå¼€å‘æ¨¡å¼ç›¸æ¯”ï¼ŒController å±‚å’Œ Repository å±‚çš„ä»£ç åŸºæœ¬ä¸Šç›¸åŒã€‚è¿™æ˜¯å› ä¸ºï¼ŒRepository å±‚çš„ Entity ç”Ÿå‘½å‘¨æœŸæœ‰é™ï¼ŒController å±‚çš„ VO åªæ˜¯å•çº¯ä½œä¸ºä¸€ç§ DTOã€‚ä¸¤éƒ¨åˆ†çš„ä¸šåŠ¡é€»è¾‘éƒ½ä¸ä¼šå¤ªå¤æ‚ã€‚ä¸šåŠ¡é€»è¾‘ä¸»è¦é›†ä¸­åœ¨ Service å±‚ã€‚æ‰€ä»¥ï¼ŒRepository å±‚å’Œ Controller å±‚ç»§ç»­æ²¿ç”¨è´«è¡€æ¨¡å‹çš„è®¾è®¡æ€è·¯æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹å­¦ä¹ ç¬”è®°/é¢å‘å¯¹è±¡.jpg" alt="é¢å‘å¯¹è±¡"></p><h3 id="ä¸‰ã€è®¾è®¡åŸåˆ™"><a href="#ä¸‰ã€è®¾è®¡åŸåˆ™" class="headerlink" title="ä¸‰ã€è®¾è®¡åŸåˆ™"></a>ä¸‰ã€è®¾è®¡åŸåˆ™</h3><h4 id="1-SOLID-åŸåˆ™ï¼šSRP-å•ä¸€èŒè´£åŸåˆ™"><a href="#1-SOLID-åŸåˆ™ï¼šSRP-å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="1. SOLID åŸåˆ™ï¼šSRP å•ä¸€èŒè´£åŸåˆ™"></a>1. SOLID åŸåˆ™ï¼šSRP å•ä¸€èŒè´£åŸåˆ™</h4><p>ä¸€ä¸ªç±»åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£æˆ–è€…åŠŸèƒ½ã€‚å•ä¸€èŒè´£åŸåˆ™é€šè¿‡é¿å…è®¾è®¡å¤§è€Œå…¨çš„ç±»ï¼Œé¿å…å°†ä¸ç›¸å…³çš„åŠŸèƒ½è€¦åˆåœ¨ä¸€èµ·ï¼Œæ¥æé«˜ç±»çš„å†…èšæ€§ã€‚åŒæ—¶ï¼Œç±»èŒè´£å•ä¸€ï¼Œç±»ä¾èµ–çš„å’Œè¢«ä¾èµ–çš„å…¶ä»–ç±»ä¹Ÿä¼šå˜å°‘ï¼Œå‡å°‘äº†ä»£ç çš„è€¦åˆæ€§ï¼Œä»¥æ­¤æ¥å®ç°ä»£ç çš„é«˜å†…èšã€æ¾è€¦åˆã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‹†åˆ†å¾—è¿‡ç»†ï¼Œå®é™…ä¸Šä¼šé€‚å¾—å…¶åï¼Œåå€’ä¼šé™ä½å†…èšæ€§ï¼Œä¹Ÿä¼šå½±å“ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p><p>ä¸åŒçš„åº”ç”¨åœºæ™¯ã€ä¸åŒé˜¶æ®µçš„éœ€æ±‚èƒŒæ™¯ã€ä¸åŒçš„ä¸šåŠ¡å±‚é¢ï¼Œå¯¹åŒä¸€ä¸ªç±»çš„èŒè´£æ˜¯å¦å•ä¸€ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„åˆ¤å®šç»“æœã€‚å®é™…ä¸Šï¼Œä¸€äº›ä¾§é¢çš„åˆ¤æ–­æŒ‡æ ‡æ›´å…·æœ‰æŒ‡å¯¼æ„ä¹‰å’Œå¯æ‰§è¡Œæ€§ï¼Œæ¯”å¦‚ï¼Œå‡ºç°ä¸‹é¢è¿™äº›æƒ…å†µå°±æœ‰å¯èƒ½è¯´æ˜è¿™ç±»çš„è®¾è®¡ä¸æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼š</p><ul><li>ç±»ä¸­çš„ä»£ç è¡Œæ•°ã€å‡½æ•°æˆ–è€…å±æ€§è¿‡å¤šï¼›</li><li>ç±»ä¾èµ–çš„å…¶ä»–ç±»è¿‡å¤šæˆ–è€…ä¾èµ–ç±»çš„å…¶ä»–ç±»è¿‡å¤šï¼›</li><li>ç§æœ‰æ–¹æ³•è¿‡å¤šï¼›</li><li>æ¯”è¾ƒéš¾ç»™ç±»èµ·ä¸€ä¸ªåˆé€‚çš„åå­—ï¼›</li><li>ç±»ä¸­å¤§é‡çš„æ–¹æ³•éƒ½æ˜¯é›†ä¸­æ“ä½œç±»ä¸­çš„æŸå‡ ä¸ªå±æ€§ã€‚</li></ul><h4 id="2-SOLID-åŸåˆ™ï¼šOCP-å¼€é—­åŸåˆ™"><a href="#2-SOLID-åŸåˆ™ï¼šOCP-å¼€é—­åŸåˆ™" class="headerlink" title="2. SOLID åŸåˆ™ï¼šOCP å¼€é—­åŸåˆ™"></a>2. SOLID åŸåˆ™ï¼šOCP å¼€é—­åŸåˆ™</h4><ul><li><p>å¦‚ä½•ç†è§£â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿ</p><p>  æ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œåº”è¯¥æ˜¯é€šè¿‡åœ¨å·²æœ‰ä»£ç åŸºç¡€ä¸Šæ‰©å±•ä»£ç ï¼ˆæ–°å¢æ¨¡å—ã€ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç ï¼ˆä¿®æ”¹æ¨¡å—ã€ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰çš„æ–¹å¼æ¥å®Œæˆã€‚å…³äºå®šä¹‰ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç‚¹è¦æ³¨æ„ã€‚ç¬¬ä¸€ç‚¹æ˜¯ï¼Œå¼€é—­åŸåˆ™å¹¶ä¸æ˜¯è¯´å®Œå…¨æœç»ä¿®æ”¹ï¼Œè€Œæ˜¯ä»¥æœ€å°çš„ä¿®æ”¹ä»£ç çš„ä»£ä»·æ¥å®Œæˆæ–°åŠŸèƒ½çš„å¼€å‘ã€‚ç¬¬äºŒç‚¹æ˜¯ï¼ŒåŒæ ·çš„ä»£ç æ”¹åŠ¨ï¼Œåœ¨ç²—ä»£ç ç²’åº¦ä¸‹ï¼Œå¯èƒ½è¢«è®¤å®šä¸ºâ€œä¿®æ”¹â€ï¼›åœ¨ç»†ä»£ç ç²’åº¦ä¸‹ï¼Œå¯èƒ½åˆè¢«è®¤å®šä¸ºâ€œæ‰©å±•â€ã€‚</p></li><li><p>å¦‚ä½•åšåˆ°â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿ</p><p>  æˆ‘ä»¬è¦æ—¶åˆ»å…·å¤‡æ‰©å±•æ„è¯†ã€æŠ½è±¡æ„è¯†ã€å°è£…æ„è¯†ã€‚åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å¤šèŠ±ç‚¹æ—¶é—´æ€è€ƒä¸€ä¸‹ï¼Œè¿™æ®µä»£ç æœªæ¥å¯èƒ½æœ‰å“ªäº›éœ€æ±‚å˜æ›´ï¼Œå¦‚ä½•è®¾è®¡ä»£ç ç»“æ„ï¼Œäº‹å…ˆç•™å¥½æ‰©å±•ç‚¹ï¼Œä»¥ä¾¿åœ¨æœªæ¥éœ€æ±‚å˜æ›´çš„æ—¶å€™ï¼Œåœ¨ä¸æ”¹åŠ¨ä»£ç æ•´ä½“ç»“æ„ã€åšåˆ°æœ€å°ä»£ç æ”¹åŠ¨çš„æƒ…å†µä¸‹ï¼Œå°†æ–°çš„ä»£ç çµæ´»åœ°æ’å…¥åˆ°æ‰©å±•ç‚¹ä¸Šã€‚</p><p>  å¾ˆå¤šè®¾è®¡åŸåˆ™ã€è®¾è®¡æ€æƒ³ã€è®¾è®¡æ¨¡å¼ï¼Œéƒ½æ˜¯ä»¥æé«˜ä»£ç çš„æ‰©å±•æ€§ä¸ºæœ€ç»ˆç›®çš„çš„ã€‚ç‰¹åˆ«æ˜¯ 23 ç§ç»å…¸è®¾è®¡æ¨¡å¼ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸ºäº†è§£å†³ä»£ç çš„æ‰©å±•æ€§é—®é¢˜è€Œæ€»ç»“å‡ºæ¥çš„ï¼Œéƒ½æ˜¯ä»¥å¼€é—­åŸåˆ™ä¸ºæŒ‡å¯¼åŸåˆ™çš„ã€‚æœ€å¸¸ç”¨æ¥æé«˜ä»£ç æ‰©å±•æ€§çš„æ–¹æ³•æœ‰ï¼šå¤šæ€ã€ä¾èµ–æ³¨å…¥ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä»¥åŠå¤§éƒ¨åˆ†çš„è®¾è®¡æ¨¡å¼ï¼ˆæ¯”å¦‚ï¼Œè£…é¥°ã€ç­–ç•¥ã€æ¨¡æ¿ã€èŒè´£é“¾ã€çŠ¶æ€ï¼‰ã€‚</p></li></ul><h4 id="3-SOLID-åŸåˆ™ï¼šLSP-é‡Œå¼æ›¿æ¢åŸåˆ™"><a href="#3-SOLID-åŸåˆ™ï¼šLSP-é‡Œå¼æ›¿æ¢åŸåˆ™" class="headerlink" title="3. SOLID åŸåˆ™ï¼šLSP é‡Œå¼æ›¿æ¢åŸåˆ™"></a>3. SOLID åŸåˆ™ï¼šLSP é‡Œå¼æ›¿æ¢åŸåˆ™</h4><p>å­ç±»å¯¹è±¡ï¼ˆobject of subtype/derived classï¼‰èƒ½å¤Ÿæ›¿æ¢ç¨‹åºï¼ˆprogramï¼‰ä¸­çˆ¶ç±»å¯¹è±¡ï¼ˆobject of base/parent classï¼‰å‡ºç°çš„ä»»ä½•åœ°æ–¹ï¼Œå¹¶ä¸”ä¿è¯åŸæ¥ç¨‹åºçš„é€»è¾‘è¡Œä¸ºï¼ˆbehaviorï¼‰ä¸å˜åŠæ­£ç¡®æ€§ä¸è¢«ç ´åã€‚</p><p>é‡Œå¼æ›¿æ¢åŸåˆ™æ˜¯ç”¨æ¥æŒ‡å¯¼ç»§æ‰¿å…³ç³»ä¸­å­ç±»è¯¥å¦‚ä½•è®¾è®¡çš„ä¸€ä¸ªåŸåˆ™ã€‚ç†è§£é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯ç†è§£â€œdesign by contractï¼ŒæŒ‰ç…§åè®®æ¥è®¾è®¡â€è¿™å‡ ä¸ªå­—ã€‚çˆ¶ç±»å®šä¹‰äº†å‡½æ•°çš„â€œçº¦å®šâ€ï¼ˆæˆ–è€…å«åè®®ï¼‰ï¼Œé‚£å­ç±»å¯ä»¥æ”¹å˜å‡½æ•°çš„å†…éƒ¨å®ç°é€»è¾‘ï¼Œä½†ä¸èƒ½æ”¹å˜å‡½æ•°çš„åŸæœ‰â€œçº¦å®šâ€ã€‚è¿™é‡Œçš„â€œçº¦å®šâ€åŒ…æ‹¬ï¼šå‡½æ•°å£°æ˜è¦å®ç°çš„åŠŸèƒ½ï¼›å¯¹è¾“å…¥ã€è¾“å‡ºã€å¼‚å¸¸çš„çº¦å®šï¼›ç”šè‡³åŒ…æ‹¬æ³¨é‡Šä¸­æ‰€ç½—åˆ—çš„ä»»ä½•ç‰¹æ®Šè¯´æ˜ã€‚</p><p>ç†è§£è¿™ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬è¿˜è¦å¼„æ˜ç™½ï¼Œé‡Œå¼æ›¿æ¢åŸåˆ™è·Ÿå¤šæ€çš„åŒºåˆ«ã€‚è™½ç„¶ä»å®šä¹‰æè¿°å’Œä»£ç å®ç°ä¸Šæ¥çœ‹ï¼Œå¤šæ€å’Œé‡Œå¼æ›¿æ¢æœ‰ç‚¹ç±»ä¼¼ï¼Œä½†å®ƒä»¬å…³æ³¨çš„è§’åº¦æ˜¯ä¸ä¸€æ ·çš„ã€‚å¤šæ€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€å¤§ç‰¹æ€§ï¼Œä¹Ÿæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„ä¸€ç§è¯­æ³•ã€‚å®ƒæ˜¯ä¸€ç§ä»£ç å®ç°çš„æ€è·¯ã€‚è€Œé‡Œå¼æ›¿æ¢æ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œç”¨æ¥æŒ‡å¯¼ç»§æ‰¿å…³ç³»ä¸­å­ç±»è¯¥å¦‚ä½•è®¾è®¡ï¼Œå­ç±»çš„è®¾è®¡è¦ä¿è¯åœ¨æ›¿æ¢çˆ¶ç±»çš„æ—¶å€™ï¼Œä¸æ”¹å˜åŸæœ‰ç¨‹åºçš„é€»è¾‘åŠä¸ç ´ååŸæœ‰ç¨‹åºçš„æ­£ç¡®æ€§ã€‚</p><h4 id="4-SOLID-åŸåˆ™ï¼šISP-æ¥å£éš”ç¦»åŸåˆ™"><a href="#4-SOLID-åŸåˆ™ï¼šISP-æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="4. SOLID åŸåˆ™ï¼šISP æ¥å£éš”ç¦»åŸåˆ™"></a>4. SOLID åŸåˆ™ï¼šISP æ¥å£éš”ç¦»åŸåˆ™</h4><p>æ¥å£éš”ç¦»åŸåˆ™çš„æè¿°æ˜¯ï¼šå®¢æˆ·ç«¯ä¸åº”è¯¥å¼ºè¿«ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚å…¶ä¸­çš„â€œå®¢æˆ·ç«¯â€ï¼Œå¯ä»¥ç†è§£ä¸ºæ¥å£çš„è°ƒç”¨è€…æˆ–è€…ä½¿ç”¨è€…ã€‚ç†è§£â€œæ¥å£éš”ç¦»åŸåˆ™â€çš„é‡ç‚¹æ˜¯ç†è§£å…¶ä¸­çš„â€œæ¥å£â€äºŒå­—ã€‚è¿™é‡Œæœ‰ä¸‰ç§ä¸åŒçš„ç†è§£ã€‚</p><p>å¦‚æœæŠŠâ€œæ¥å£â€ç†è§£ä¸ºä¸€ç»„æ¥å£é›†åˆï¼Œå¯ä»¥æ˜¯æŸä¸ªå¾®æœåŠ¡çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ªç±»åº“çš„æ¥å£ç­‰ã€‚å¦‚æœéƒ¨åˆ†æ¥å£åªè¢«éƒ¨åˆ†è°ƒç”¨è€…ä½¿ç”¨ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†è¿™éƒ¨åˆ†æ¥å£éš”ç¦»å‡ºæ¥ï¼Œå•ç‹¬ç»™è¿™éƒ¨åˆ†è°ƒç”¨è€…ä½¿ç”¨ï¼Œè€Œä¸å¼ºè¿«å…¶ä»–è°ƒç”¨è€…ä¹Ÿä¾èµ–è¿™éƒ¨åˆ†ä¸ä¼šè¢«ç”¨åˆ°çš„æ¥å£ã€‚</p><p>å¦‚æœæŠŠâ€œæ¥å£â€ç†è§£ä¸ºå•ä¸ª API æ¥å£æˆ–å‡½æ•°ï¼Œéƒ¨åˆ†è°ƒç”¨è€…åªéœ€è¦å‡½æ•°ä¸­çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æŠŠå‡½æ•°æ‹†åˆ†æˆç²’åº¦æ›´ç»†çš„å¤šä¸ªå‡½æ•°ï¼Œè®©è°ƒç”¨è€…åªä¾èµ–å®ƒéœ€è¦çš„é‚£ä¸ªç»†ç²’åº¦å‡½æ•°ã€‚</p><p>å¦‚æœæŠŠâ€œæ¥å£â€ç†è§£ä¸º OOP ä¸­çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­çš„æ¥å£è¯­æ³•ã€‚é‚£æ¥å£çš„è®¾è®¡è¦å°½é‡å•ä¸€ï¼Œä¸è¦è®©æ¥å£çš„å®ç°ç±»å’Œè°ƒç”¨è€…ï¼Œä¾èµ–ä¸éœ€è¦çš„æ¥å£å‡½æ•°ã€‚</p><p>å•ä¸€èŒè´£åŸåˆ™é’ˆå¯¹çš„æ˜¯æ¨¡å—ã€ç±»ã€æ¥å£çš„è®¾è®¡ã€‚æ¥å£éš”ç¦»åŸåˆ™ç›¸å¯¹äºå•ä¸€èŒè´£åŸåˆ™ï¼Œä¸€æ–¹é¢æ›´ä¾§é‡äºæ¥å£çš„è®¾è®¡ï¼Œå¦ä¸€æ–¹é¢å®ƒçš„æ€è€ƒçš„è§’åº¦ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æ¥å£éš”ç¦»åŸåˆ™æä¾›äº†ä¸€ç§åˆ¤æ–­æ¥å£çš„èŒè´£æ˜¯å¦å•ä¸€çš„æ ‡å‡†ï¼šé€šè¿‡è°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨æ¥å£æ¥é—´æ¥åœ°åˆ¤å®šã€‚å¦‚æœè°ƒç”¨è€…åªä½¿ç”¨éƒ¨åˆ†æ¥å£æˆ–æ¥å£çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œé‚£æ¥å£çš„è®¾è®¡å°±ä¸å¤ŸèŒè´£å•ä¸€ã€‚</p><h4 id="5-SOLID-åŸåˆ™ï¼šDIP-ä¾èµ–å€’ç½®åŸåˆ™"><a href="#5-SOLID-åŸåˆ™ï¼šDIP-ä¾èµ–å€’ç½®åŸåˆ™" class="headerlink" title="5. SOLID åŸåˆ™ï¼šDIP ä¾èµ–å€’ç½®åŸåˆ™"></a>5. SOLID åŸåˆ™ï¼šDIP ä¾èµ–å€’ç½®åŸåˆ™</h4><p><strong>æ§åˆ¶åè½¬ï¼š</strong>å®é™…ä¸Šï¼Œæ§åˆ¶åè½¬æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¬¼ç»Ÿçš„è®¾è®¡æ€æƒ³ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å…·ä½“çš„å®ç°æ–¹æ³•ï¼Œä¸€èˆ¬ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚è¿™é‡Œæ‰€è¯´çš„â€œæ§åˆ¶â€æŒ‡çš„æ˜¯å¯¹ç¨‹åºæ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œè€Œâ€œåè½¬â€æŒ‡çš„æ˜¯åœ¨æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¹‹å‰ï¼Œç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ä½¿ç”¨æ¡†æ¶ä¹‹åï¼Œæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæµç¨‹é€šè¿‡æ¡†æ¶æ¥æ§åˆ¶ã€‚æµç¨‹çš„æ§åˆ¶æƒä»ç¨‹åºå‘˜â€œåè½¬â€ç»™äº†æ¡†æ¶ã€‚</p><p><strong>ä¾èµ–æ³¨å…¥ï¼š</strong>ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ°æ°ç›¸åï¼Œå®ƒæ˜¯ä¸€ç§å…·ä½“çš„ç¼–ç æŠ€å·§ã€‚æˆ‘ä»¬ä¸é€šè¿‡ new çš„æ–¹å¼åœ¨ç±»å†…éƒ¨åˆ›å»ºä¾èµ–ç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’ï¼ˆæˆ–â€œæ³¨å…¥â€ï¼‰ç»™ç±»æ¥ä½¿ç”¨ã€‚</p><p><strong>ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼š</strong>æˆ‘ä»¬é€šè¿‡ä¾èµ–æ³¨å…¥æ¡†æ¶æä¾›çš„æ‰©å±•ç‚¹ï¼Œç®€å•é…ç½®ä¸€ä¸‹æ‰€æœ‰éœ€è¦çš„ç±»åŠå…¶ç±»ä¸ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°±å¯ä»¥å®ç°ç”±æ¡†æ¶æ¥è‡ªåŠ¨åˆ›å»ºå¯¹è±¡ã€ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€ä¾èµ–æ³¨å…¥ç­‰åŸæœ¬éœ€è¦ç¨‹åºå‘˜æ¥åšçš„äº‹æƒ…ã€‚</p><p><strong>ä¾èµ–åè½¬åŸåˆ™ï¼š</strong>ä¾èµ–åè½¬åŸåˆ™ä¹Ÿå«ä½œä¾èµ–å€’ç½®åŸåˆ™ã€‚è¿™æ¡åŸåˆ™è·Ÿæ§åˆ¶åè½¬æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸»è¦ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œå®ƒä»¬å…±åŒä¾èµ–åŒä¸€ä¸ªæŠ½è±¡ã€‚æŠ½è±¡ä¸éœ€è¦ä¾èµ–å…·ä½“å®ç°ç»†èŠ‚ï¼Œå…·ä½“å®ç°ç»†èŠ‚ä¾èµ–æŠ½è±¡ã€‚</p><h4 id="6-KISSã€YAGNI-åŸåˆ™"><a href="#6-KISSã€YAGNI-åŸåˆ™" class="headerlink" title="6. KISSã€YAGNI åŸåˆ™"></a>6. KISSã€YAGNI åŸåˆ™</h4><p>KISS åŸåˆ™çš„ä¸­æ–‡æè¿°æ˜¯ï¼šå°½é‡ä¿æŒç®€å•ã€‚KISS åŸåˆ™æ˜¯ä¿æŒä»£ç å¯è¯»å’Œå¯ç»´æŠ¤çš„é‡è¦æ‰‹æ®µã€‚KISS åŸåˆ™ä¸­çš„â€œç®€å•â€œâ€å¹¶ä¸æ˜¯ä»¥ä»£ç è¡Œæ•°æ¥è€ƒé‡çš„ã€‚ä»£ç è¡Œæ•°è¶Šå°‘å¹¶ä¸ä»£è¡¨ä»£ç è¶Šç®€å•ï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘é€»è¾‘å¤æ‚åº¦ã€å®ç°éš¾åº¦ã€ä»£ç çš„å¯è¯»æ€§ç­‰ã€‚è€Œä¸”ï¼Œæœ¬èº«å°±å¤æ‚çš„é—®é¢˜ï¼Œç”¨å¤æ‚çš„æ–¹æ³•è§£å†³ï¼Œä¹Ÿå¹¶ä¸è¿èƒŒ KISS åŸåˆ™ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŒæ ·çš„ä»£ç ï¼Œåœ¨æŸä¸ªä¸šåŠ¡åœºæ™¯ä¸‹æ»¡è¶³ KISS åŸåˆ™ï¼Œæ¢ä¸€ä¸ªåº”ç”¨åœºæ™¯å¯èƒ½å°±ä¸æ»¡è¶³äº†ã€‚</p><p>å¯¹äºå¦‚ä½•å†™å‡ºæ»¡è¶³ KISS åŸåˆ™çš„ä»£ç ï¼Œæˆ‘æ€»ç»“äº†ä¸‹é¢å‡ æ¡æŒ‡å¯¼åŸåˆ™ï¼š</p><ul><li>ä¸è¦ä½¿ç”¨åŒäº‹å¯èƒ½ä¸æ‡‚çš„æŠ€æœ¯æ¥å®ç°ä»£ç ï¼›</li><li>ä¸è¦é‡å¤é€ è½®å­ï¼Œå–„äºä½¿ç”¨å·²ç»æœ‰çš„å·¥å…·ç±»åº“ï¼›</li><li>ä¸è¦è¿‡åº¦ä¼˜åŒ–ã€‚</li></ul><p>YAGNI åŸåˆ™çš„è‹±æ–‡å…¨ç§°æ˜¯ï¼šYou Ainâ€™t Gonna Need Itã€‚ç›´è¯‘å°±æ˜¯ï¼šä½ ä¸ä¼šéœ€è¦å®ƒã€‚è¿™æ¡åŸåˆ™ä¹Ÿç®—æ˜¯ä¸‡é‡‘æ²¹äº†ã€‚å½“ç”¨åœ¨è½¯ä»¶å¼€å‘ä¸­çš„æ—¶å€™ï¼Œå®ƒçš„æ„æ€æ˜¯ï¼šä¸è¦å»è®¾è®¡å½“å‰ç”¨ä¸åˆ°çš„åŠŸèƒ½ï¼›ä¸è¦å»ç¼–å†™å½“å‰ç”¨ä¸åˆ°çš„ä»£ç ã€‚å®é™…ä¸Šï¼Œè¿™æ¡åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šä¸è¦åšè¿‡åº¦è®¾è®¡ã€‚</p><p>YAGNI åŸåˆ™è·Ÿ KISS åŸåˆ™å¹¶éä¸€å›äº‹å„¿ã€‚KISS åŸåˆ™è®²çš„æ˜¯â€œå¦‚ä½•åšâ€çš„é—®é¢˜ï¼ˆå°½é‡ä¿æŒç®€å•ï¼‰ï¼Œè€Œ YAGNI åŸåˆ™è¯´çš„æ˜¯â€œè¦ä¸è¦åšâ€çš„é—®é¢˜ï¼ˆå½“å‰ä¸éœ€è¦çš„å°±ä¸è¦åšï¼‰ã€‚</p><h4 id="7-DRY-åŸåˆ™"><a href="#7-DRY-åŸåˆ™" class="headerlink" title="7. DRY åŸåˆ™"></a>7. DRY åŸåˆ™</h4><p>DRY åŸåˆ™ä¸­æ–‡æè¿°æ˜¯ï¼šä¸è¦é‡å¤è‡ªå·±ï¼Œå°†å®ƒåº”ç”¨åœ¨ç¼–ç¨‹ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šä¸è¦å†™é‡å¤çš„ä»£ç ã€‚</p><p>ä¸“æ ä¸­è®²åˆ°äº†ä¸‰ç§ä»£ç é‡å¤çš„æƒ…å†µï¼šå®ç°é€»è¾‘é‡å¤ã€åŠŸèƒ½è¯­ä¹‰é‡å¤ã€ä»£ç æ‰§è¡Œé‡å¤ã€‚å®ç°é€»è¾‘é‡å¤ï¼Œä½†åŠŸèƒ½è¯­ä¹‰ä¸é‡å¤çš„ä»£ç ï¼Œå¹¶ä¸è¿å DRY åŸåˆ™ã€‚å®ç°é€»è¾‘ä¸é‡å¤ï¼Œä½†åŠŸèƒ½è¯­ä¹‰é‡å¤çš„ä»£ç ï¼Œä¹Ÿç®—æ˜¯è¿å DRY åŸåˆ™ã€‚è€Œä»£ç æ‰§è¡Œé‡å¤ä¹Ÿç®—æ˜¯è¿å DRY åŸåˆ™ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²åˆ°äº†æé«˜ä»£ç å¤ç”¨æ€§çš„ä¸€äº›æ‰‹æ®µï¼ŒåŒ…æ‹¬ï¼šå‡å°‘ä»£ç è€¦åˆã€æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ã€æ¨¡å—åŒ–ã€ä¸šåŠ¡ä¸éä¸šåŠ¡é€»è¾‘åˆ†ç¦»ã€é€šç”¨ä»£ç ä¸‹æ²‰ã€ç»§æ‰¿ã€å¤šæ€ã€æŠ½è±¡ã€å°è£…ã€åº”ç”¨æ¨¡æ¿ç­‰è®¾è®¡æ¨¡å¼ã€‚å¤ç”¨æ„è¯†ä¹Ÿéå¸¸é‡è¦ã€‚åœ¨è®¾è®¡æ¯ä¸ªæ¨¡å—ã€ç±»ã€å‡½æ•°çš„æ—¶å€™ï¼Œè¦åƒè®¾è®¡ä¸€ä¸ªå¤–éƒ¨ API ä¸€æ ·å»æ€è€ƒå®ƒçš„å¤ç”¨æ€§ã€‚</p><p>æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡å†™ä»£ç çš„æ—¶å€™ï¼Œå¦‚æœå½“ä¸‹æ²¡æœ‰å¤ç”¨çš„éœ€æ±‚ï¼Œè€Œæœªæ¥çš„å¤ç”¨éœ€æ±‚ä¹Ÿä¸æ˜¯ç‰¹åˆ«æ˜ç¡®ï¼Œå¹¶ä¸”å¼€å‘å¯å¤ç”¨ä»£ç çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œé‚£æˆ‘ä»¬å°±ä¸éœ€è¦è€ƒè™‘ä»£ç çš„å¤ç”¨æ€§ã€‚åœ¨ä¹‹åå¼€å‘æ–°çš„åŠŸèƒ½çš„æ—¶å€™ï¼Œå‘ç°å¯ä»¥å¤ç”¨ä¹‹å‰å†™çš„è¿™æ®µä»£ç ï¼Œé‚£æˆ‘ä»¬å°±é‡æ„è¿™æ®µä»£ç ï¼Œè®©å…¶å˜å¾—æ›´åŠ å¯å¤ç”¨ã€‚</p><p>ç›¸æ¯”äºä»£ç çš„å¯å¤ç”¨æ€§ï¼ŒDRY åŸåˆ™é€‚ç”¨æ€§æ›´å¼ºäº›ã€‚æˆ‘ä»¬å¯ä»¥ä¸å†™å¯å¤ç”¨çš„ä»£ç ï¼Œä½†ä¸€å®šä¸èƒ½å†™é‡å¤çš„ä»£ç ã€‚</p><h4 id="8-LOD-åŸåˆ™"><a href="#8-LOD-åŸåˆ™" class="headerlink" title="8. LOD åŸåˆ™"></a>8. LOD åŸåˆ™</h4><ul><li><p>å¦‚ä½•ç†è§£â€œé«˜å†…èšã€æ¾è€¦åˆâ€ï¼Ÿ</p><p>  â€œé«˜å†…èšã€æ¾è€¦åˆâ€æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è®¾è®¡æ€æƒ³ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œç¼©å°åŠŸèƒ½æ”¹åŠ¨å¯¼è‡´çš„ä»£ç æ”¹åŠ¨èŒƒå›´ã€‚â€œé«˜å†…èšâ€ç”¨æ¥æŒ‡å¯¼ç±»æœ¬èº«çš„è®¾è®¡ï¼Œâ€œæ¾è€¦åˆâ€ç”¨æ¥æŒ‡å¯¼ç±»ä¸ç±»ä¹‹é—´ä¾èµ–å…³ç³»çš„è®¾è®¡ã€‚æ‰€è°“é«˜å†…èšï¼Œå°±æ˜¯æŒ‡ç›¸è¿‘çš„åŠŸèƒ½åº”è¯¥æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸ç›¸è¿‘çš„åŠŸèƒ½ä¸è¦æ”¾åˆ°åŒä¸€ç±»ä¸­ã€‚ç›¸è¿‘çš„åŠŸèƒ½å¾€å¾€ä¼šè¢«åŒæ—¶ä¿®æ”¹ï¼Œæ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ï¼Œä¿®æ”¹ä¼šæ¯”è¾ƒé›†ä¸­ã€‚æ‰€è°“â€œæ¾è€¦åˆâ€æŒ‡çš„æ˜¯ï¼Œåœ¨ä»£ç ä¸­ï¼Œç±»ä¸ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»ç®€å•æ¸…æ™°ã€‚å³ä½¿ä¸¤ä¸ªç±»æœ‰ä¾èµ–å…³ç³»ï¼Œä¸€ä¸ªç±»çš„ä»£ç æ”¹åŠ¨ä¹Ÿä¸ä¼šæˆ–è€…å¾ˆå°‘å¯¼è‡´ä¾èµ–ç±»çš„ä»£ç æ”¹åŠ¨ã€‚</p></li><li><p>å¦‚ä½•ç†è§£â€œè¿ªç±³ç‰¹æ³•åˆ™â€ï¼Ÿ</p><p>  è¿ªç±³ç‰¹æ³•åˆ™çš„æè¿°ä¸ºï¼šä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–ï¼›æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£ã€‚è¿ªç±³ç‰¹æ³•åˆ™æ˜¯å¸Œæœ›å‡å°‘ç±»ä¹‹é—´çš„è€¦åˆï¼Œè®©ç±»è¶Šç‹¬ç«‹è¶Šå¥½ã€‚æ¯ä¸ªç±»éƒ½åº”è¯¥å°‘äº†è§£ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†ã€‚ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦äº†è§£è¿™ä¸€å˜åŒ–çš„ç±»å°±ä¼šæ¯”è¾ƒå°‘ã€‚</p></li></ul><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹å­¦ä¹ ç¬”è®°/è®¾è®¡åŸåˆ™.jpg" alt="è®¾è®¡åŸåˆ™"></p><h3 id="å››ã€è§„èŒƒä¸é‡æ„"><a href="#å››ã€è§„èŒƒä¸é‡æ„" class="headerlink" title="å››ã€è§„èŒƒä¸é‡æ„"></a>å››ã€è§„èŒƒä¸é‡æ„</h3><h4 id="1-é‡æ„æ¦‚è¿°"><a href="#1-é‡æ„æ¦‚è¿°" class="headerlink" title="1. é‡æ„æ¦‚è¿°"></a>1. é‡æ„æ¦‚è¿°</h4><ul><li><p>é‡æ„çš„ç›®çš„ï¼šä¸ºä»€ä¹ˆé‡æ„ï¼ˆwhyï¼‰ï¼Ÿ</p><p>  å¯¹äºé¡¹ç›®æ¥è¨€ï¼Œé‡æ„å¯ä»¥ä¿æŒä»£ç è´¨é‡æŒç»­å¤„äºä¸€ä¸ªå¯æ§çŠ¶æ€ï¼Œä¸è‡³äºè…åŒ–åˆ°æ— å¯æ•‘è¯çš„åœ°æ­¥ã€‚å¯¹äºä¸ªäººè€Œè¨€ï¼Œé‡æ„éå¸¸é”»ç‚¼ä¸€ä¸ªäººçš„ä»£ç èƒ½åŠ›ï¼Œå¹¶ä¸”æ˜¯ä¸€ä»¶éå¸¸æœ‰æˆå°±æ„Ÿçš„äº‹æƒ…ã€‚å®ƒæ˜¯æˆ‘ä»¬å­¦ä¹ çš„ç»å…¸è®¾è®¡æ€æƒ³ã€åŸåˆ™ã€æ¨¡å¼ã€ç¼–ç¨‹è§„èŒƒç­‰ç†è®ºçŸ¥è¯†çš„ç»ƒå…µåœºã€‚</p></li><li><p>é‡æ„çš„å¯¹è±¡ï¼šé‡æ„ä»€ä¹ˆï¼ˆwhatï¼‰ï¼Ÿ</p><p>  æŒ‰ç…§é‡æ„çš„è§„æ¨¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†é‡æ„å¤§è‡´åˆ†ä¸ºå¤§è§„æ¨¡é«˜å±‚æ¬¡çš„é‡æ„å’Œå°è§„æ¨¡ä½å±‚æ¬¡çš„é‡æ„ã€‚å¤§è§„æ¨¡é«˜å±‚æ¬¡é‡æ„åŒ…æ‹¬å¯¹ä»£ç åˆ†å±‚ã€æ¨¡å—åŒ–ã€è§£è€¦ã€æ¢³ç†ç±»ä¹‹é—´çš„äº¤äº’å…³ç³»ã€æŠ½è±¡å¤ç”¨ç»„ä»¶ç­‰ç­‰ã€‚è¿™éƒ¨åˆ†å·¥ä½œåˆ©ç”¨çš„æ›´å¤šçš„æ˜¯æ¯”è¾ƒæŠ½è±¡ã€æ¯”è¾ƒé¡¶å±‚çš„è®¾è®¡æ€æƒ³ã€åŸåˆ™ã€æ¨¡å¼ã€‚å°è§„æ¨¡ä½å±‚æ¬¡çš„é‡æ„åŒ…æ‹¬è§„èŒƒå‘½åã€æ³¨é‡Šã€ä¿®æ­£å‡½æ•°å‚æ•°è¿‡å¤šã€æ¶ˆé™¤è¶…å¤§ç±»ã€æå–é‡å¤ä»£ç ç­‰ç¼–ç¨‹ç»†èŠ‚é—®é¢˜ï¼Œä¸»è¦æ˜¯é’ˆå¯¹ç±»ã€å‡½æ•°çº§åˆ«çš„é‡æ„ã€‚å°è§„æ¨¡ä½å±‚æ¬¡çš„é‡æ„æ›´å¤šçš„æ˜¯åˆ©ç”¨ç¼–ç è§„èŒƒè¿™ä¸€ç†è®ºçŸ¥è¯†ã€‚</p></li><li><p>é‡æ„çš„æ—¶æœºï¼šä»€ä¹ˆæ—¶å€™é‡æ„ï¼ˆwhenï¼‰ï¼Ÿ</p><p>  æˆ‘åå¤å¼ºè°ƒï¼Œæˆ‘ä»¬ä¸€å®šè¦å»ºç«‹æŒç»­é‡æ„æ„è¯†ï¼ŒæŠŠé‡æ„ä½œä¸ºå¼€å‘å¿…ä¸å¯å°‘çš„éƒ¨åˆ†èå…¥åˆ°å¼€å‘ä¸­ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ä»£ç å‡ºç°å¾ˆå¤§é—®é¢˜çš„æ—¶å€™ï¼Œå†å¤§åˆ€é˜”æ–§åœ°é‡æ„ã€‚</p></li><li><p>é‡æ„çš„æ–¹æ³•ï¼šå¦‚ä½•é‡æ„ï¼ˆhowï¼‰ï¼Ÿ</p><p>  å¤§è§„æ¨¡é«˜å±‚æ¬¡çš„é‡æ„éš¾åº¦æ¯”è¾ƒå¤§ï¼Œéœ€è¦æœ‰ç»„ç»‡ã€æœ‰è®¡åˆ’åœ°è¿›è¡Œï¼Œåˆ†é˜¶æ®µåœ°å°æ­¥å¿«è·‘ï¼Œæ—¶åˆ»ä¿æŒä»£ç å¤„äºä¸€ä¸ªå¯è¿è¡Œçš„çŠ¶æ€ã€‚è€Œå°è§„æ¨¡ä½å±‚æ¬¡çš„é‡æ„ï¼Œå› ä¸ºå½±å“èŒƒå›´å°ï¼Œæ”¹åŠ¨è€—æ—¶çŸ­ï¼Œæ‰€ä»¥ï¼Œåªè¦ä½ æ„¿æ„å¹¶ä¸”æœ‰æ—¶é—´ï¼Œéšæ—¶éšåœ°éƒ½å¯ä»¥å»åšã€‚</p></li></ul><h4 id="2-å•å…ƒæµ‹è¯•"><a href="#2-å•å…ƒæµ‹è¯•" class="headerlink" title="2. å•å…ƒæµ‹è¯•"></a>2. å•å…ƒæµ‹è¯•</h4><ul><li><p>ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼Ÿ</p><p>  å•å…ƒæµ‹è¯•æ˜¯ä»£ç å±‚é¢çš„æµ‹è¯•ï¼Œç”¨äºæµ‹è¯•â€œè‡ªå·±â€ç¼–å†™çš„ä»£ç çš„é€»è¾‘æ­£ç¡®æ€§ã€‚å•å…ƒæµ‹è¯•é¡¾åæ€ä¹‰æ˜¯æµ‹è¯•ä¸€ä¸ªâ€œå•å…ƒâ€ï¼Œè¿™ä¸ªâ€œå•å…ƒâ€ä¸€èˆ¬æ˜¯ç±»æˆ–å‡½æ•°ï¼Œè€Œä¸æ˜¯æ¨¡å—æˆ–è€…ç³»ç»Ÿã€‚</p></li><li><p>ä¸ºä»€ä¹ˆè¦å†™å•å…ƒæµ‹è¯•ï¼Ÿ</p><p>  å•å…ƒæµ‹è¯•èƒ½æœ‰æ•ˆåœ°å‘ç°ä»£ç ä¸­çš„ Bugã€ä»£ç è®¾è®¡ä¸Šçš„é—®é¢˜ã€‚å†™å•å…ƒæµ‹è¯•çš„è¿‡ç¨‹æœ¬èº«å°±æ˜¯ä»£ç é‡æ„çš„è¿‡ç¨‹ã€‚å•å…ƒæµ‹è¯•æ˜¯å¯¹é›†æˆæµ‹è¯•çš„æœ‰åŠ›è¡¥å……ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç†Ÿæ‚‰ä»£ç ï¼Œæ˜¯ TDD å¯è½åœ°æ‰§è¡Œçš„æŠ˜ä¸­æ–¹æ¡ˆã€‚</p></li><li><p>å¦‚ä½•ç¼–å†™å•å…ƒæµ‹è¯•ï¼Ÿ</p><p>  å†™å•å…ƒæµ‹è¯•å°±æ˜¯é’ˆå¯¹ä»£ç è®¾è®¡è¦†ç›–å„ç§è¾“å…¥ã€å¼‚å¸¸ã€è¾¹ç•Œæ¡ä»¶çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶å°†å…¶ç¿»è¯‘æˆä»£ç çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€äº›æµ‹è¯•æ¡†æ¶æ¥ç®€åŒ–æµ‹è¯•ä»£ç çš„ç¼–å†™ã€‚å¯¹äºå•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä»¥ä¸‹æ­£ç¡®çš„è®¤çŸ¥ï¼š</p><ol><li>ç¼–å†™å•å…ƒæµ‹è¯•å°½ç®¡ç¹çï¼Œä½†å¹¶ä¸æ˜¯å¤ªè€—æ—¶ï¼›</li><li>æˆ‘ä»¬å¯ä»¥ç¨å¾®æ”¾ä½å•å…ƒæµ‹è¯•çš„è´¨é‡è¦æ±‚ï¼›</li><li>è¦†ç›–ç‡ä½œä¸ºè¡¡é‡å•å…ƒæµ‹è¯•å¥½åçš„å”¯ä¸€æ ‡å‡†æ˜¯ä¸åˆç†çš„ï¼›</li><li>å†™å•å…ƒæµ‹è¯•ä¸€èˆ¬ä¸éœ€è¦äº†è§£ä»£ç çš„å®ç°é€»è¾‘ï¼›</li><li>å•å…ƒæµ‹è¯•æ¡†æ¶æ— æ³•æµ‹è¯•å¤šåŠæ˜¯ä»£ç çš„å¯æµ‹è¯•æ€§ä¸å¥½ã€‚</li></ol></li><li><p>å•å…ƒæµ‹è¯•ä¸ºä½•éš¾è½åœ°æ‰§è¡Œï¼Ÿ</p><p>  ä¸€æ–¹é¢ï¼Œå†™å•å…ƒæµ‹è¯•æœ¬èº«æ¯”è¾ƒç¹çï¼ŒæŠ€æœ¯æŒ‘æˆ˜ä¸å¤§ï¼Œå¾ˆå¤šç¨‹åºå‘˜ä¸æ„¿æ„å»å†™ã€‚å¦ä¸€æ–¹é¢ï¼Œå›½å†…ç ”å‘æ¯”è¾ƒåå‘â€œå¿«ç³™çŒ›â€ï¼Œå®¹æ˜“å› ä¸ºå¼€å‘è¿›åº¦ç´§ï¼Œå¯¼è‡´å•å…ƒæµ‹è¯•çš„æ‰§è¡Œè™å¤´è›‡å°¾ï¼Œæœ€åï¼Œæ²¡æœ‰å»ºç«‹å¯¹å•å…ƒæµ‹è¯•çš„æ­£ç¡®è®¤è¯†ï¼Œè§‰å¾—å¯æœ‰å¯æ— ï¼Œå•é ç£ä¿ƒå¾ˆéš¾æ‰§è¡Œå¾—å¾ˆå¥½ã€‚</p></li></ul><h4 id="3-ä»£ç çš„å¯æµ‹è¯•æ€§"><a href="#3-ä»£ç çš„å¯æµ‹è¯•æ€§" class="headerlink" title="3. ä»£ç çš„å¯æµ‹è¯•æ€§"></a>3. ä»£ç çš„å¯æµ‹è¯•æ€§</h4><ul><li><p>ä»€ä¹ˆæ˜¯ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿ</p><p>  ç²—ç•¥åœ°è®²ï¼Œæ‰€è°“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå°±æ˜¯é’ˆå¯¹ä»£ç ç¼–å†™å•å…ƒæµ‹è¯•çš„éš¾æ˜“ç¨‹åº¦ã€‚å¯¹äºä¸€æ®µä»£ç ï¼Œå¦‚æœå¾ˆéš¾ä¸ºå…¶ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œæˆ–è€…å•å…ƒæµ‹è¯•å†™èµ·æ¥å¾ˆè´¹åŠ²ï¼Œéœ€è¦ä¾é å•å…ƒæµ‹è¯•æ¡†æ¶å¾ˆé«˜çº§çš„ç‰¹æ€§ï¼Œé‚£å¾€å¾€å°±æ„å‘³ç€ä»£ç è®¾è®¡å¾—ä¸å¤Ÿåˆç†ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§ä¸å¥½ã€‚</p></li><li><p>ç¼–å†™å¯æµ‹è¯•æ€§ä»£ç çš„æœ€æœ‰æ•ˆæ‰‹æ®µ</p><p>  ä¾èµ–æ³¨å…¥æ˜¯ç¼–å†™å¯æµ‹è¯•æ€§ä»£ç çš„æœ€æœ‰æ•ˆæ‰‹æ®µã€‚é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•ä»£ç çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ mock çš„æ–¹æ³•å°†ä¸å¯æ§çš„ä¾èµ–å˜å¾—å¯æ§ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„è¿‡ç¨‹ä¸­æœ€æœ‰æŠ€æœ¯æŒ‘æˆ˜çš„åœ°æ–¹ã€‚é™¤äº† mock æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨äºŒæ¬¡å°è£…æ¥è§£å†³æŸäº›ä»£ç è¡Œä¸ºä¸å¯æ§çš„æƒ…å†µã€‚</p></li><li><p>å¸¸è§çš„ Anti-Patternså…¸å‹çš„ã€å¸¸è§çš„æµ‹è¯•ä¸å‹å¥½çš„ä»£ç æœ‰ä¸‹é¢è¿™ 5 ç§ï¼š</p><ol><li>ä»£ç ä¸­åŒ…å«æœªå†³è¡Œä¸ºé€»è¾‘ï¼›</li><li>æ»¥ç”¨å¯å˜å…¨å±€å˜é‡ï¼›</li><li>æ»¥ç”¨é™æ€æ–¹æ³•ï¼›</li><li>ä½¿ç”¨å¤æ‚çš„ç»§æ‰¿å…³ç³»ï¼›</li><li>é«˜åº¦è€¦åˆçš„ä»£ç ã€‚</li></ol></li></ul><h4 id="4-å¤§å‹é‡æ„ï¼šè§£è€¦"><a href="#4-å¤§å‹é‡æ„ï¼šè§£è€¦" class="headerlink" title="4. å¤§å‹é‡æ„ï¼šè§£è€¦"></a>4. å¤§å‹é‡æ„ï¼šè§£è€¦</h4><ul><li><p>â€œè§£è€¦â€ä¸ºä½•å¦‚æ­¤é‡è¦ï¼Ÿ</p><p>  è¿‡äºå¤æ‚çš„ä»£ç å¾€å¾€åœ¨å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ä¸Šéƒ½ä¸å‹å¥½ã€‚è§£è€¦ï¼Œä¿è¯ä»£ç æ¾è€¦åˆã€é«˜å†…èšï¼Œæ˜¯æ§åˆ¶ä»£ç å¤æ‚åº¦çš„æœ‰æ•ˆæ‰‹æ®µã€‚å¦‚æœä»£ç é«˜å†…èšã€æ¾è€¦åˆï¼Œä¹Ÿå°±æ˜¯æ„å‘³ç€ï¼Œä»£ç ç»“æ„æ¸…æ™°ã€åˆ†å±‚ã€æ¨¡å—åŒ–åˆç†ã€ä¾èµ–å…³ç³»ç®€å•ã€æ¨¡å—æˆ–ç±»ä¹‹é—´çš„è€¦åˆå°ï¼Œé‚£ä»£ç æ•´ä½“çš„è´¨é‡å°±ä¸ä¼šå·®ã€‚</p></li><li><p>ä»£ç æ˜¯å¦éœ€è¦â€œè§£è€¦â€ï¼Ÿ</p><p>  é—´æ¥çš„è¡¡é‡æ ‡å‡†æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šæ”¹åŠ¨ä¸€ä¸ªæ¨¡å—æˆ–ç±»çš„ä»£ç å—å½±å“çš„æ¨¡å—æˆ–ç±»æ˜¯å¦æœ‰å¾ˆå¤šã€æ”¹åŠ¨ä¸€ä¸ªæ¨¡å—æˆ–è€…ç±»çš„ä»£ç ä¾èµ–çš„æ¨¡å—æˆ–è€…ç±»æ˜¯å¦éœ€è¦æ”¹åŠ¨ã€ä»£ç çš„å¯æµ‹è¯•æ€§æ˜¯å¦å¥½ç­‰ç­‰ã€‚ç›´æ¥çš„è¡¡é‡æ ‡å‡†æ˜¯æŠŠæ¨¡å—ä¸æ¨¡å—ä¹‹é—´åŠå…¶ç±»ä¸ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»ç”»å‡ºæ¥ï¼Œæ ¹æ®ä¾èµ–å…³ç³»å›¾çš„å¤æ‚æ€§æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è§£è€¦é‡æ„ã€‚</p></li><li><p>å¦‚ä½•ç»™ä»£ç â€œè§£è€¦â€ï¼Ÿ</p><p>  ç»™ä»£ç è§£è€¦çš„æ–¹æ³•æœ‰ï¼šå°è£…ä¸æŠ½è±¡ã€ä¸­é—´å±‚ã€æ¨¡å—åŒ–ï¼Œä»¥åŠä¸€äº›å…¶ä»–çš„è®¾è®¡æ€æƒ³ä¸åŸåˆ™ï¼Œæ¯”å¦‚ï¼šå•ä¸€èŒè´£åŸåˆ™ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ã€ä¾èµ–æ³¨å…¥ã€å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ã€è¿ªç±³ç‰¹æ³•åˆ™ã€‚å½“ç„¶ï¼Œè¿˜æœ‰ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p></li></ul><h4 id="5-å°å‹é‡æ„ï¼šç¼–ç è§„èŒƒ"><a href="#5-å°å‹é‡æ„ï¼šç¼–ç è§„èŒƒ" class="headerlink" title="5. å°å‹é‡æ„ï¼šç¼–ç è§„èŒƒ"></a>5. å°å‹é‡æ„ï¼šç¼–ç è§„èŒƒ</h4><p>å‰é¢æˆ‘ä»¬è®²äº†å¾ˆå¤šè®¾è®¡åŸåˆ™ï¼Œåé¢è¿˜ä¼šè®²åˆ°å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œåˆ©ç”¨å¥½å®ƒä»¬éƒ½å¯ä»¥æœ‰æ•ˆåœ°æ”¹å–„ä»£ç çš„è´¨é‡ã€‚ä½†æ˜¯ï¼Œè¿™äº›çŸ¥è¯†çš„åˆç†åº”ç”¨éå¸¸ä¾èµ–ä¸ªäººç»éªŒï¼Œæœ‰æ—¶å€™ç”¨ä¸å¥½ä¼šé€‚å¾—å…¶åã€‚ä½†æ˜¯ç¼–ç è§„èŒƒæ­£å¥½ç›¸åï¼Œå¤§éƒ¨åˆ†éƒ½ç®€å•æ˜äº†ï¼Œåœ¨ä»£ç çš„ç»†èŠ‚æ–¹é¢ï¼Œèƒ½ç«‹ç«¿è§å½±åœ°æ”¹å–„è´¨é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿè®²åˆ°ï¼ŒæŒç»­ä½å±‚æ¬¡å°è§„æ¨¡é‡æ„ä¾èµ–çš„åŸºæœ¬ä¸Šéƒ½æ˜¯è¿™äº›ç¼–ç è§„èŒƒï¼Œä¹Ÿæ˜¯æ”¹å–„ä»£ç å¯è¯»æ€§çš„æœ‰æ•ˆæ‰‹æ®µã€‚</p><p>æ ¹æ®æˆ‘è‡ªå·±çš„å¼€å‘ç»éªŒï¼Œæˆ‘æ€»ç»“ç½—åˆ—äº† 20 æ¡æˆ‘è®¤ä¸ºæœ€åº”è¯¥å…³æ³¨ã€æœ€å¥½ç”¨çš„ç¼–ç è§„èŒƒï¼Œåˆ†ä¸ºä¸‰ä¸ªå¤§çš„æ–¹é¢ï¼šå‘½åä¸æ³¨é‡Šï¼ˆNaming and Commentsï¼‰ã€ä»£ç é£æ ¼ï¼ˆCode Styleï¼‰ã€ç¼–ç¨‹æŠ€å·§ï¼ˆCoding Tipsï¼‰ã€‚</p><ul><li><p>å‘½åä¸æ³¨é‡Š</p><ol><li>å‘½åçš„å…³é”®æ˜¯èƒ½å‡†ç¡®çš„è¾¾æ„ã€‚å¯¹äºä¸åŒä½œç”¨åŸŸçš„å‘½åï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“çš„é€‰æ‹©ä¸åŒçš„é•¿åº¦ï¼Œä½œç”¨åŸŸå°çš„å‘½åï¼Œæ¯”å¦‚ä¸´æ—¶å˜é‡ç­‰ï¼Œå¯ä»¥é€‚å½“çš„é€‰æ‹©çŸ­ä¸€äº›çš„å‘½åæ–¹å¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå‘½åä¸­ä¸ªä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›è€³ç†Ÿèƒ½è¯¦çš„ç¼©å†™ã€‚</li><li>æˆ‘ä»¬å€ŸåŠ©ç±»çš„ä¿¡æ¯æ¥ç®€åŒ–å±æ€§ã€å‡½æ•°çš„å‘½åï¼Œåˆ©ç”¨å‡½æ•°çš„ä¿¡æ¯æ¥ç®€åŒ–å‡½æ•°å‚æ•°çš„å‘½åã€‚</li><li>å‘½åè¦å¯è¯»ã€å¯æœç´¢ã€‚ä¸è¦ä½¿ç”¨ç”Ÿåƒ»çš„ã€ä¸å¥½è¯»çš„è‹±æ–‡å•è¯æ¥å‘½åã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå‘½åè¦ç¬¦åˆé¡¹ç›®çš„ç»Ÿä¸€è§„èŒƒï¼Œä¹Ÿä¸è¦ç”¨äº›åç›´è§‰çš„å‘½åã€‚</li><li>æ¥å£æœ‰ä¸¤ç§å‘½åæ–¹å¼ã€‚ä¸€ç§æ˜¯åœ¨æ¥å£ä¸­å¸¦å‰ç¼€â€Iâ€ï¼Œå¦ä¸€ç§æ˜¯åœ¨æ¥å£çš„å®ç°ç±»ä¸­å¸¦åç¼€â€œImplâ€ã€‚ä¸¤ç§å‘½åæ–¹å¼éƒ½å¯ä»¥ï¼Œå…³é”®æ˜¯è¦åœ¨é¡¹ç›®ä¸­ç»Ÿä¸€ã€‚å¯¹äºæŠ½è±¡ç±»çš„å‘½åï¼Œæˆ‘ä»¬æ›´å€¾å‘äºå¸¦æœ‰å‰ç¼€â€œAbstractâ€ã€‚</li><li>æ³¨é‡Šçš„ç›®çš„å°±æ˜¯è®©ä»£ç æ›´å®¹æ˜“çœ‹æ‡‚ï¼Œåªè¦ç¬¦åˆè¿™ä¸ªè¦æ±‚ï¼Œä½ å°±å¯ä»¥å†™ã€‚æ€»ç»“ä¸€ä¸‹çš„è¯ï¼Œæ³¨é‡Šä¸»è¦åŒ…å«è¿™æ ·ä¸‰ä¸ªæ–¹é¢çš„å†…å®¹ï¼šåšä»€ä¹ˆã€ä¸ºä»€ä¹ˆã€æ€ä¹ˆåšã€‚å¯¹äºä¸€äº›å¤æ‚çš„ç±»å’Œæ¥å£ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å†™æ˜â€œå¦‚ä½•ç”¨â€ã€‚</li><li>æ³¨é‡Šæœ¬èº«æœ‰ä¸€å®šçš„ç»´æŠ¤æˆæœ¬ï¼Œæ‰€ä»¥å¹¶éè¶Šå¤šè¶Šå¥½ã€‚ç±»å’Œå‡½æ•°ä¸€å®šè¦å†™æ³¨é‡Šï¼Œè€Œä¸”è¦å†™çš„å°½å¯èƒ½å…¨é¢è¯¦ç»†äº›ï¼Œè€Œå‡½æ•°å†…éƒ¨çš„æ³¨é‡Šä¼šç›¸å¯¹å°‘ä¸€äº›ï¼Œä¸€èˆ¬éƒ½æ˜¯é å¥½çš„å‘½åå’Œæç‚¼å‡½æ•°ã€è§£é‡Šæ€§å˜é‡ã€æ€»ç»“æ€§æ³¨é‡Šæ¥åšåˆ°ä»£ç æ˜“è¯»ã€‚</li></ol></li><li><p>ä»£ç é£æ ¼</p><p>  ä»£ç é£æ ¼éƒ½æ²¡æœ‰å¯¹é”™å’Œä¼˜åŠ£ä¹‹åˆ†ï¼Œä¸åŒçš„ç¼–ç¨‹è¯­è¨€é£æ ¼éƒ½ä¸å¤ªä¸€æ ·ï¼Œåªè¦èƒ½åœ¨å›¢é˜Ÿã€é¡¹ç›®ä¸­ç»Ÿä¸€å³å¯ï¼Œä¸è¿‡ï¼Œæœ€å¥½èƒ½è·Ÿä¸šå†…æ¨èçš„é£æ ¼ã€å¼€æºé¡¹ç›®çš„ä»£ç é£æ ¼ç›¸ä¸€è‡´ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œå°±ä¸å±•å¼€ç½—åˆ—äº†ï¼Œä½ å¯ä»¥å¯¹ç…§ç€è‡ªå·±ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç é£æ ¼ï¼Œè‡ªå·±å¤ä¹ ä¸€ä¸‹ã€‚</p></li><li><p>ç¼–ç¨‹æŠ€å·§</p><ol><li>å°†å¤æ‚çš„é€»è¾‘æç‚¼æ‹†åˆ†æˆå‡½æ•°å’Œç±»ï¼›</li><li>é€šè¿‡æ‹†åˆ†æˆå¤šä¸ªå‡½æ•°çš„æ–¹å¼æ¥å¤„ç†å‚æ•°è¿‡å¤šçš„æƒ…å†µï¼›</li><li>é€šè¿‡å°†å‚æ•°å°è£…ä¸ºå¯¹è±¡æ¥å¤„ç†å‚æ•°è¿‡å¤šçš„æƒ…å†µï¼›</li><li>å‡½æ•°ä¸­ä¸è¦ä½¿ç”¨å‚æ•°æ¥åšä»£ç æ‰§è¡Œé€»è¾‘çš„æ§åˆ¶ï¼›</li><li>ç§»é™¤è¿‡æ·±çš„åµŒå¥—å±‚æ¬¡ï¼Œæ–¹æ³•åŒ…æ‹¬ï¼šå»æ‰å¤šä½™çš„ if æˆ– else è¯­å¥ï¼Œä½¿ç”¨ continueã€breakã€return å…³é”®å­—æå‰é€€å‡ºåµŒå¥—ï¼Œè°ƒæ•´æ‰§è¡Œé¡ºåºæ¥å‡å°‘åµŒå¥—ï¼Œå°†éƒ¨åˆ†åµŒå¥—é€»è¾‘æŠ½è±¡æˆå‡½æ•°ï¼›</li><li>ç”¨å­—é¢å¸¸é‡å–ä»£é­”æ³•æ•°ï¼›</li><li>åˆ©ç”¨è§£é‡Šæ€§å˜é‡æ¥è§£é‡Šå¤æ‚è¡¨è¾¾å¼ã€‚</li></ol></li><li><p>ç»Ÿä¸€ç¼–ç è§„èŒƒ</p><p>  é™¤äº†ç»†èŠ‚çš„çŸ¥è¯†ç‚¹ä¹‹å¤–ï¼Œæœ€åï¼Œè¿˜æœ‰ä¸€æ¡éå¸¸é‡è¦çš„ï¼Œé‚£å°±æ˜¯ï¼Œé¡¹ç›®ã€å›¢é˜Ÿï¼Œç”šè‡³å…¬å¸ï¼Œä¸€å®šè¦åˆ¶å®šç»Ÿä¸€çš„ç¼–ç è§„èŒƒï¼Œå¹¶ä¸”é€šè¿‡ Code Review ç£ä¿ƒæ‰§è¡Œï¼Œè¿™å¯¹æé«˜ä»£ç è´¨é‡æœ‰ç«‹ç«¿è§å½±çš„æ•ˆæœã€‚</p></li></ul><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹å­¦ä¹ ç¬”è®°/è§„èŒƒä¸é‡æ„.jpg" alt="è§„èŒƒä¸é‡æ„"></p><h2 id="è®¾è®¡æ¨¡å¼ä¸èŒƒå¼"><a href="#è®¾è®¡æ¨¡å¼ä¸èŒƒå¼" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¸èŒƒå¼"></a>è®¾è®¡æ¨¡å¼ä¸èŒƒå¼</h2><h3 id="ä¸€ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"><a href="#ä¸€ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="ä¸€ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"></a>ä¸€ã€åˆ›å»ºå‹è®¾è®¡æ¨¡å¼</h3><p>åˆ›å»ºå‹è®¾è®¡æ¨¡å¼åŒ…æ‹¬ï¼šå•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚å®ƒä¸»è¦è§£å†³å¯¹è±¡çš„åˆ›å»ºé—®é¢˜ï¼Œå°è£…å¤æ‚çš„åˆ›å»ºè¿‡ç¨‹ï¼Œè§£è€¦å¯¹è±¡çš„åˆ›å»ºä»£ç å’Œä½¿ç”¨ä»£ç ã€‚</p><h4 id="1-å•ä¾‹æ¨¡å¼"><a href="#1-å•ä¾‹æ¨¡å¼" class="headerlink" title="1. å•ä¾‹æ¨¡å¼"></a>1. å•ä¾‹æ¨¡å¼</h4><p>å•ä¾‹æ¨¡å¼ç”¨æ¥åˆ›å»ºå…¨å±€å”¯ä¸€çš„å¯¹è±¡ã€‚ä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…å«å®ä¾‹ï¼‰ï¼Œé‚£è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å°±å«ä½œå•ä¾‹æ¨¡å¼ã€‚å•ä¾‹æœ‰å‡ ç§ç»å…¸çš„å®ç°æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šé¥¿æ±‰å¼ã€æ‡’æ±‰å¼ã€åŒé‡æ£€æµ‹ã€é™æ€å†…éƒ¨ç±»ã€æšä¸¾ã€‚</p><p>å°½ç®¡å•ä¾‹æ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œåœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿç¡®å®ç»å¸¸ç”¨åˆ°å®ƒï¼Œä½†æ˜¯ï¼Œæœ‰äº›äººè®¤ä¸ºå•ä¾‹æ˜¯ä¸€ç§åæ¨¡å¼ï¼ˆanti-patternï¼‰ï¼Œå¹¶ä¸æ¨èä½¿ç”¨ï¼Œä¸»è¦çš„ç†ç”±æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å•ä¾‹å¯¹ OOP ç‰¹æ€§çš„æ”¯æŒä¸å‹å¥½</li><li>å•ä¾‹ä¼šéšè—ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»</li><li>å•ä¾‹å¯¹ä»£ç çš„æ‰©å±•æ€§ä¸å‹å¥½</li><li>å•ä¾‹å¯¹ä»£ç çš„å¯æµ‹è¯•æ€§ä¸å‹å¥½</li><li>å•ä¾‹ä¸æ”¯æŒæœ‰å‚æ•°çš„æ„é€ å‡½æ•°</li></ul><p>é‚£æœ‰ä»€ä¹ˆæ›¿ä»£å•ä¾‹çš„è§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿå¦‚æœè¦å®Œå…¨è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½è¦ä»æ ¹ä¸Šå¯»æ‰¾å…¶ä»–æ–¹å¼æ¥å®ç°å…¨å±€å”¯ä¸€ç±»ã€‚æ¯”å¦‚ï¼Œé€šè¿‡å·¥å‚æ¨¡å¼ã€IOC å®¹å™¨æ¥ä¿è¯å…¨å±€å”¯ä¸€æ€§ã€‚</p><p>æœ‰äººæŠŠå•ä¾‹å½“ä½œåæ¨¡å¼ï¼Œä¸»å¼ æœç»åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚æˆ‘ä¸ªäººè§‰å¾—è¿™æœ‰ç‚¹æç«¯ã€‚æ¨¡å¼æœ¬èº«æ²¡æœ‰å¯¹é”™ï¼Œå…³é”®çœ‹ä½ æ€ä¹ˆç”¨ã€‚å¦‚æœå•ä¾‹ç±»å¹¶æ²¡æœ‰åç»­æ‰©å±•çš„éœ€æ±‚ï¼Œå¹¶ä¸”ä¸ä¾èµ–å¤–éƒ¨ç³»ç»Ÿï¼Œé‚£è®¾è®¡æˆå•ä¾‹ç±»å°±æ²¡æœ‰å¤ªå¤§é—®é¢˜ã€‚å¯¹äºä¸€äº›å…¨å±€ç±»ï¼Œæˆ‘ä»¬åœ¨å…¶ä»–åœ°æ–¹ new çš„è¯ï¼Œè¿˜è¦åœ¨ç±»ä¹‹é—´ä¼ æ¥ä¼ å»ï¼Œä¸å¦‚ç›´æ¥åšæˆå•ä¾‹ç±»ï¼Œä½¿ç”¨èµ·æ¥ç®€æ´æ–¹ä¾¿ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²åˆ°äº†è¿›ç¨‹å”¯ä¸€å•ä¾‹ã€çº¿ç¨‹å”¯ä¸€å•ä¾‹ã€é›†ç¾¤å”¯ä¸€å•ä¾‹ã€å¤šä¾‹ç­‰æ‰©å±•çŸ¥è¯†ç‚¹ï¼Œè¿™ä¸€éƒ¨åˆ†åœ¨å®é™…çš„å¼€å‘ä¸­å¹¶ä¸ä¼šè¢«ç”¨åˆ°ï¼Œä½†æ˜¯å¯ä»¥æ‰©å±•ä½ çš„æ€è·¯ã€é”»ç‚¼ä½ çš„é€»è¾‘æ€ç»´ã€‚è¿™é‡Œæˆ‘å°±ä¸å¸¦ä½ å›é¡¾äº†ï¼Œä½ å¯ä»¥è‡ªå·±å›å¿†ä¸€ä¸‹ã€‚</p><h4 id="2-å·¥å‚æ¨¡å¼"><a href="#2-å·¥å‚æ¨¡å¼" class="headerlink" title="2. å·¥å‚æ¨¡å¼"></a>2. å·¥å‚æ¨¡å¼</h4><p>å·¥å‚æ¨¡å¼åŒ…æ‹¬ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚è¿™ 3 ç§ç»†åˆ†æ¨¡å¼ã€‚å…¶ä¸­ï¼Œç®€å•å·¥å‚å’Œå·¥å‚æ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ï¼ŒæŠ½è±¡å·¥å‚çš„åº”ç”¨åœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€ä»¥å¾ˆå°‘ç”¨åˆ°ï¼Œä¸æ˜¯æˆ‘ä»¬å­¦ä¹ çš„é‡ç‚¹ã€‚</p><p>å·¥å‚æ¨¡å¼ç”¨æ¥åˆ›å»ºä¸åŒä½†æ˜¯ç›¸å…³ç±»å‹çš„å¯¹è±¡ï¼ˆç»§æ‰¿åŒä¸€çˆ¶ç±»æˆ–è€…æ¥å£çš„ä¸€ç»„å­ç±»ï¼‰ï¼Œç”±ç»™å®šçš„å‚æ•°æ¥å†³å®šåˆ›å»ºå“ªç§ç±»å‹çš„å¯¹è±¡ã€‚å®é™…ä¸Šï¼Œå¦‚æœåˆ›å»ºå¯¹è±¡çš„é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œé‚£æˆ‘ä»¬ç›´æ¥é€šè¿‡ new æ¥åˆ›å»ºå¯¹è±¡å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦ä½¿ç”¨å·¥å‚æ¨¡å¼ã€‚å½“åˆ›å»ºé€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæ˜¯ä¸€ä¸ªâ€œå¤§å·¥ç¨‹â€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è€ƒè™‘ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œå°è£…å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ç›¸åˆ†ç¦»ã€‚</p><p>å½“æ¯ä¸ªå¯¹è±¡çš„åˆ›å»ºé€»è¾‘éƒ½æ¯”è¾ƒç®€å•çš„æ—¶å€™ï¼Œæˆ‘æ¨èä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ï¼Œå°†å¤šä¸ªå¯¹è±¡çš„åˆ›å»ºé€»è¾‘æ”¾åˆ°ä¸€ä¸ªå·¥å‚ç±»ä¸­ã€‚å½“æ¯ä¸ªå¯¹è±¡çš„åˆ›å»ºé€»è¾‘éƒ½æ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…è®¾è®¡ä¸€ä¸ªè¿‡äºåºå¤§çš„å·¥å‚ç±»ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå°†åˆ›å»ºé€»è¾‘æ‹†åˆ†å¾—æ›´ç»†ï¼Œæ¯ä¸ªå¯¹è±¡çš„åˆ›å»ºé€»è¾‘ç‹¬ç«‹åˆ°å„è‡ªçš„å·¥å‚ç±»ä¸­ã€‚</p><p>è¯¦ç»†ç‚¹è¯´ï¼Œå·¥å‚æ¨¡å¼çš„ä½œç”¨æœ‰ä¸‹é¢ 4 ä¸ªï¼Œè¿™ä¹Ÿæ˜¯åˆ¤æ–­è¦ä¸è¦ä½¿ç”¨å·¥å‚æ¨¡å¼æœ€æœ¬è´¨çš„å‚è€ƒæ ‡å‡†ã€‚</p><ul><li>å°è£…å˜åŒ–ï¼šåˆ›å»ºé€»è¾‘æœ‰å¯èƒ½å˜åŒ–ï¼Œå°è£…æˆå·¥å‚ç±»ä¹‹åï¼Œåˆ›å»ºé€»è¾‘çš„å˜æ›´å¯¹è°ƒç”¨è€…é€æ˜ã€‚</li><li>ä»£ç å¤ç”¨ï¼šåˆ›å»ºä»£ç æŠ½ç¦»åˆ°ç‹¬ç«‹çš„å·¥å‚ç±»ä¹‹åå¯ä»¥å¤ç”¨ã€‚</li><li>éš”ç¦»å¤æ‚æ€§ï¼šå°è£…å¤æ‚çš„åˆ›å»ºé€»è¾‘ï¼Œè°ƒç”¨è€…æ— éœ€äº†è§£å¦‚ä½•åˆ›å»ºå¯¹è±¡ã€‚</li><li>æ§åˆ¶å¤æ‚åº¦ï¼šå°†åˆ›å»ºä»£ç æŠ½ç¦»å‡ºæ¥ï¼Œè®©åŸæœ¬çš„å‡½æ•°æˆ–ç±»èŒè´£æ›´å•ä¸€ï¼Œä»£ç æ›´ç®€æ´ã€‚</li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†å·¥å‚æ¨¡å¼ä¸€ä¸ªéå¸¸ç»å…¸çš„åº”ç”¨åœºæ™¯ï¼šä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œæ¯”å¦‚ Spring IOCã€Google Guiceï¼Œå®ƒç”¨æ¥é›†ä¸­åˆ›å»ºã€ç»„è£…ã€ç®¡ç†å¯¹è±¡ï¼Œè·Ÿå…·ä½“ä¸šåŠ¡ä»£ç è§£è€¦ï¼Œè®©ç¨‹åºå‘˜èšç„¦åœ¨ä¸šåŠ¡ä»£ç çš„å¼€å‘ä¸Šã€‚DI æ¡†æ¶å·²ç»æˆä¸ºäº†æˆ‘ä»¬å¹³æ—¶å¼€å‘çš„å¿…å¤‡æ¡†æ¶ï¼Œåœ¨ä¸“æ ä¸­ï¼Œæˆ‘è¿˜å¸¦ä½ å®ç°äº†ä¸€ä¸ªç®€å•çš„ DI æ¡†æ¶ï¼Œä½ å¯ä»¥å†å›è¿‡å¤´å»çœ‹çœ‹ã€‚</p><h4 id="3-å»ºé€ è€…æ¨¡å¼"><a href="#3-å»ºé€ è€…æ¨¡å¼" class="headerlink" title="3. å»ºé€ è€…æ¨¡å¼"></a>3. å»ºé€ è€…æ¨¡å¼</h4><p>å»ºé€ è€…æ¨¡å¼ç”¨æ¥åˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„å¯é€‰å‚æ•°ï¼Œâ€œå®šåˆ¶åŒ–â€åœ°åˆ›å»ºä¸åŒçš„å¯¹è±¡ã€‚å»ºé€ è€…æ¨¡å¼çš„åŸç†å’Œå®ç°æ¯”è¾ƒç®€å•ï¼Œé‡ç‚¹æ˜¯æŒæ¡åº”ç”¨åœºæ™¯ï¼Œé¿å…è¿‡åº¦ä½¿ç”¨ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»ä¸­æœ‰å¾ˆå¤šå±æ€§ï¼Œä¸ºäº†é¿å…æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨è¿‡é•¿ï¼Œå½±å“ä»£ç çš„å¯è¯»æ€§å’Œæ˜“ç”¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°é…åˆ set() æ–¹æ³•æ¥è§£å†³ã€‚ä½†æ˜¯ï¼Œå¦‚æœå­˜åœ¨ä¸‹é¢æƒ…å†µä¸­çš„ä»»æ„ä¸€ç§ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘ä½¿ç”¨å»ºé€ è€…æ¨¡å¼äº†ã€‚</p><ul><li>æˆ‘ä»¬æŠŠç±»çš„å¿…å¡«å±æ€§æ”¾åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œå¼ºåˆ¶åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å°±è®¾ç½®ã€‚å¦‚æœå¿…å¡«çš„å±æ€§æœ‰å¾ˆå¤šï¼ŒæŠŠè¿™äº›å¿…å¡«å±æ€§éƒ½æ”¾åˆ°æ„é€ å‡½æ•°ä¸­è®¾ç½®ï¼Œé‚£æ„é€ å‡½æ•°å°±åˆä¼šå‡ºç°å‚æ•°åˆ—è¡¨å¾ˆé•¿çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æŠŠå¿…å¡«å±æ€§é€šè¿‡ set() æ–¹æ³•è®¾ç½®ï¼Œé‚£æ ¡éªŒè¿™äº›å¿…å¡«å±æ€§æ˜¯å¦å·²ç»å¡«å†™çš„é€»è¾‘å°±æ— å¤„å®‰æ”¾äº†ã€‚</li><li>å¦‚æœç±»çš„å±æ€§ä¹‹é—´æœ‰ä¸€å®šçš„ä¾èµ–å…³ç³»æˆ–è€…çº¦æŸæ¡ä»¶ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨æ„é€ å‡½æ•°é…åˆ set() æ–¹æ³•çš„è®¾è®¡æ€è·¯ï¼Œé‚£è¿™äº›ä¾èµ–å…³ç³»æˆ–çº¦æŸæ¡ä»¶çš„æ ¡éªŒé€»è¾‘å°±æ— å¤„å®‰æ”¾äº†ã€‚</li><li>å¦‚æœæˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸å¯å˜å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡åœ¨åˆ›å»ºå¥½ä¹‹åï¼Œå°±ä¸èƒ½å†ä¿®æ”¹å†…éƒ¨çš„å±æ€§å€¼ï¼Œè¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å°±ä¸èƒ½åœ¨ç±»ä¸­æš´éœ² set() æ–¹æ³•ã€‚æ„é€ å‡½æ•°é…åˆ set() æ–¹æ³•æ¥è®¾ç½®å±æ€§å€¼çš„æ–¹å¼å°±ä¸é€‚ç”¨äº†ã€‚</li></ul><h4 id="4-åŸå‹æ¨¡å¼"><a href="#4-åŸå‹æ¨¡å¼" class="headerlink" title="4. åŸå‹æ¨¡å¼"></a>4. åŸå‹æ¨¡å¼</h4><p>å¦‚æœå¯¹è±¡çš„åˆ›å»ºæˆæœ¬æ¯”è¾ƒå¤§ï¼Œè€ŒåŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´å·®åˆ«ä¸å¤§ï¼ˆå¤§éƒ¨åˆ†å­—æ®µéƒ½ç›¸åŒï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¯¹å·²æœ‰å¯¹è±¡ï¼ˆåŸå‹ï¼‰è¿›è¡Œå¤åˆ¶ï¼ˆæˆ–è€…å«æ‹·è´ï¼‰çš„æ–¹å¼ï¼Œæ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œä»¥è¾¾åˆ°èŠ‚çœåˆ›å»ºæ—¶é—´çš„ç›®çš„ã€‚è¿™ç§åŸºäºåŸå‹æ¥åˆ›å»ºå¯¹è±¡çš„æ–¹å¼å°±å«ä½œåŸå‹æ¨¡å¼ã€‚</p><p>åŸå‹æ¨¡å¼æœ‰ä¸¤ç§å®ç°æ–¹æ³•ï¼Œæ·±æ‹·è´å’Œæµ…æ‹·è´ã€‚æµ…æ‹·è´åªä¼šå¤åˆ¶å¯¹è±¡ä¸­åŸºæœ¬æ•°æ®ç±»å‹æ•°æ®å’Œå¼•ç”¨å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œä¸ä¼šé€’å½’åœ°å¤åˆ¶å¼•ç”¨å¯¹è±¡ï¼Œä»¥åŠå¼•ç”¨å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡â€¦â€¦è€Œæ·±æ‹·è´å¾—åˆ°çš„æ˜¯ä¸€ä»½å®Œå®Œå…¨å…¨ç‹¬ç«‹çš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæ·±æ‹·è´æ¯”èµ·æµ…æ‹·è´æ¥è¯´ï¼Œæ›´åŠ è€—æ—¶ï¼Œæ›´åŠ è€—å†…å­˜ç©ºé—´ã€‚</p><p>å¦‚æœè¦æ‹·è´çš„å¯¹è±¡æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæµ…æ‹·è´å…±äº«ä¸å¯å˜å¯¹è±¡æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å¯¹äºå¯å˜å¯¹è±¡æ¥è¯´ï¼Œæµ…æ‹·è´å¾—åˆ°çš„å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡ä¼šå…±äº«éƒ¨åˆ†æ•°æ®ï¼Œå°±æœ‰å¯èƒ½å‡ºç°æ•°æ®è¢«ä¿®æ”¹çš„é£é™©ï¼Œä¹Ÿå°±å˜å¾—å¤æ‚å¤šäº†ã€‚æ“ä½œéå¸¸è€—æ—¶çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¯”è¾ƒæ¨èä½¿ç”¨æµ…æ‹·è´ï¼Œå¦åˆ™ï¼Œæ²¡æœ‰å……åˆ†çš„ç†ç”±ï¼Œä¸è¦ä¸ºäº†ä¸€ç‚¹ç‚¹çš„æ€§èƒ½æå‡è€Œä½¿ç”¨æµ…æ‹·è´ã€‚</p><h3 id="äºŒã€ç»“æ„å‹è®¾è®¡æ¨¡å¼"><a href="#äºŒã€ç»“æ„å‹è®¾è®¡æ¨¡å¼" class="headerlink" title="äºŒã€ç»“æ„å‹è®¾è®¡æ¨¡å¼"></a>äºŒã€ç»“æ„å‹è®¾è®¡æ¨¡å¼</h3><p>ç»“æ„å‹æ¨¡å¼ä¸»è¦æ€»ç»“äº†ä¸€äº›ç±»æˆ–å¯¹è±¡ç»„åˆåœ¨ä¸€èµ·çš„ç»å…¸ç»“æ„ï¼Œè¿™äº›ç»å…¸çš„ç»“æ„å¯ä»¥è§£å†³ç‰¹å®šåº”ç”¨åœºæ™¯çš„é—®é¢˜ã€‚ç»“æ„å‹æ¨¡å¼åŒ…æ‹¬ï¼šä»£ç†æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€é—¨é¢æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚</p><h4 id="1-ä»£ç†æ¨¡å¼"><a href="#1-ä»£ç†æ¨¡å¼" class="headerlink" title="1. ä»£ç†æ¨¡å¼"></a>1. ä»£ç†æ¨¡å¼</h4><p>ä»£ç†æ¨¡å¼åœ¨ä¸æ”¹å˜åŸå§‹ç±»æ¥å£çš„æ¡ä»¶ä¸‹ï¼Œä¸ºåŸå§‹ç±»å®šä¹‰ä¸€ä¸ªä»£ç†ç±»ï¼Œä¸»è¦ç›®çš„æ˜¯æ§åˆ¶è®¿é—®ï¼Œè€ŒéåŠ å¼ºåŠŸèƒ½ï¼Œè¿™æ˜¯å®ƒè·Ÿè£…é¥°å™¨æ¨¡å¼æœ€å¤§çš„ä¸åŒã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®©ä»£ç†ç±»å’ŒåŸå§‹ç±»å®ç°åŒæ ·çš„æ¥å£ã€‚ä½†æ˜¯ï¼Œå¦‚æœåŸå§‹ç±»å¹¶æ²¡æœ‰å®šä¹‰æ¥å£ï¼Œå¹¶ä¸”åŸå§‹ç±»ä»£ç å¹¶ä¸æ˜¯æˆ‘ä»¬å¼€å‘ç»´æŠ¤çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®©ä»£ç†ç±»ç»§æ‰¿åŸå§‹ç±»çš„æ–¹æ³•æ¥å®ç°ä»£ç†æ¨¡å¼ã€‚</p><p>é™æ€ä»£ç†éœ€è¦é’ˆå¯¹æ¯ä¸ªç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»ä¸­çš„ä»£ç éƒ½æœ‰ç‚¹åƒæ¨¡æ¿å¼çš„â€œé‡å¤â€ä»£ç ï¼Œå¢åŠ äº†ç»´æŠ¤æˆæœ¬å’Œå¼€å‘æˆæœ¬ã€‚å¯¹äºé™æ€ä»£ç†å­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨æ€ä»£ç†æ¥è§£å†³ã€‚æˆ‘ä»¬ä¸äº‹å…ˆä¸ºæ¯ä¸ªåŸå§‹ç±»ç¼–å†™ä»£ç†ç±»ï¼Œè€Œæ˜¯åœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€åœ°åˆ›å»ºåŸå§‹ç±»å¯¹åº”çš„ä»£ç†ç±»ï¼Œç„¶ååœ¨ç³»ç»Ÿä¸­ç”¨ä»£ç†ç±»æ›¿æ¢æ‰åŸå§‹ç±»ã€‚</p><p>ä»£ç†æ¨¡å¼å¸¸ç”¨åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­å¼€å‘ä¸€äº›éåŠŸèƒ½æ€§éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šç›‘æ§ã€ç»Ÿè®¡ã€é‰´æƒã€é™æµã€äº‹åŠ¡ã€å¹‚ç­‰ã€æ—¥å¿—ã€‚æˆ‘ä»¬å°†è¿™äº›é™„åŠ åŠŸèƒ½ä¸ä¸šåŠ¡åŠŸèƒ½è§£è€¦ï¼Œæ”¾åˆ°ä»£ç†ç±»ç»Ÿä¸€å¤„ç†ï¼Œè®©ç¨‹åºå‘˜åªéœ€è¦å…³æ³¨ä¸šåŠ¡æ–¹é¢çš„å¼€å‘ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»£ç†æ¨¡å¼è¿˜å¯ä»¥ç”¨åœ¨ RPCã€ç¼“å­˜ç­‰åº”ç”¨åœºæ™¯ä¸­ã€‚</p><h4 id="2-æ¡¥æ¥æ¨¡å¼"><a href="#2-æ¡¥æ¥æ¨¡å¼" class="headerlink" title="2. æ¡¥æ¥æ¨¡å¼"></a>2. æ¡¥æ¥æ¨¡å¼</h4><p>æ¡¥æ¥æ¨¡å¼çš„ä»£ç å®ç°éå¸¸ç®€å•ï¼Œä½†æ˜¯ç†è§£èµ·æ¥ç¨å¾®æœ‰ç‚¹éš¾åº¦ï¼Œå¹¶ä¸”åº”ç”¨åœºæ™¯ä¹Ÿæ¯”è¾ƒå±€é™ï¼Œæ‰€ä»¥ï¼Œç›¸å¯¹æ¥è¯´ï¼Œæ¡¥æ¥æ¨¡å¼åœ¨å®é™…çš„é¡¹ç›®ä¸­å¹¶æ²¡æœ‰é‚£ä¹ˆå¸¸ç”¨ï¼Œä½ åªéœ€è¦ç®€å•äº†è§£ï¼Œè§åˆ°èƒ½è®¤è¯†å°±å¯ä»¥äº†ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬å­¦ä¹ çš„é‡ç‚¹ã€‚</p><p>æ¡¥æ¥æ¨¡å¼æœ‰ä¸¤ç§ç†è§£æ–¹å¼ã€‚ç¬¬ä¸€ç§ç†è§£æ–¹å¼æ˜¯â€œå°†æŠ½è±¡å’Œå®ç°è§£è€¦ï¼Œè®©å®ƒä»¬èƒ½ç‹¬ç«‹å¼€å‘â€ã€‚è¿™ç§ç†è§£æ–¹å¼æ¯”è¾ƒç‰¹åˆ«ï¼Œåº”ç”¨åœºæ™¯ä¹Ÿä¸å¤šã€‚å¦ä¸€ç§ç†è§£æ–¹å¼æ›´åŠ ç®€å•ï¼Œç­‰åŒäºâ€œç»„åˆä¼˜äºç»§æ‰¿â€è®¾è®¡åŸåˆ™ï¼Œè¿™ç§ç†è§£æ–¹å¼æ›´åŠ é€šç”¨ï¼Œåº”ç”¨åœºæ™¯æ¯”è¾ƒå¤šã€‚ä¸ç®¡æ˜¯å“ªç§ç†è§£æ–¹å¼ï¼Œå®ƒä»¬çš„ä»£ç ç»“æ„éƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ä¸€ç§ç±»ä¹‹é—´çš„ç»„åˆå…³ç³»ã€‚</p><p>å¯¹äºç¬¬ä¸€ç§ç†è§£æ–¹å¼ï¼Œå¼„æ‡‚å®šä¹‰ä¸­â€œæŠ½è±¡â€å’Œâ€œå®ç°â€ä¸¤ä¸ªæ¦‚å¿µï¼Œæ˜¯ç†è§£å®ƒçš„å…³é”®ã€‚å®šä¹‰ä¸­çš„â€œæŠ½è±¡â€ï¼ŒæŒ‡çš„å¹¶éâ€œæŠ½è±¡ç±»â€æˆ–â€œæ¥å£â€ï¼Œè€Œæ˜¯è¢«æŠ½è±¡å‡ºæ¥çš„ä¸€å¥—â€œç±»åº“â€ï¼Œå®ƒåªåŒ…å«éª¨æ¶ä»£ç ï¼ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘éœ€è¦å§”æ´¾ç»™å®šä¹‰ä¸­çš„â€œå®ç°â€æ¥å®Œæˆã€‚è€Œå®šä¹‰ä¸­çš„â€œå®ç°â€ï¼Œä¹Ÿå¹¶éâ€œæ¥å£çš„å®ç°ç±»â€ï¼Œè€Œæ˜¯çš„ä¸€å¥—ç‹¬ç«‹çš„â€œç±»åº“â€ã€‚â€œæŠ½è±¡â€å’Œâ€œå®ç°â€ç‹¬ç«‹å¼€å‘ï¼Œé€šè¿‡å¯¹è±¡ä¹‹é—´çš„ç»„åˆå…³ç³»ç»„è£…åœ¨ä¸€èµ·ã€‚</p><h4 id="3-è£…é¥°å™¨æ¨¡å¼"><a href="#3-è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="3. è£…é¥°å™¨æ¨¡å¼"></a>3. è£…é¥°å™¨æ¨¡å¼</h4><p>è£…é¥°å™¨æ¨¡å¼ä¸»è¦è§£å†³ç»§æ‰¿å…³ç³»è¿‡äºå¤æ‚çš„é—®é¢˜ï¼Œé€šè¿‡ç»„åˆæ¥æ›¿ä»£ç»§æ‰¿ï¼Œç»™åŸå§‹ç±»æ·»åŠ å¢å¼ºåŠŸèƒ½ã€‚è¿™ä¹Ÿæ˜¯åˆ¤æ–­æ˜¯å¦è¯¥ç”¨è£…é¥°å™¨æ¨¡å¼çš„ä¸€ä¸ªé‡è¦çš„ä¾æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè£…é¥°å™¨æ¨¡å¼è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å¯ä»¥å¯¹åŸå§‹ç±»åµŒå¥—ä½¿ç”¨å¤šä¸ªè£…é¥°å™¨ã€‚ä¸ºäº†æ»¡è¶³è¿™æ ·çš„éœ€æ±‚ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™ï¼Œè£…é¥°å™¨ç±»éœ€è¦è·ŸåŸå§‹ç±»ç»§æ‰¿ç›¸åŒçš„æŠ½è±¡ç±»æˆ–è€…æ¥å£ã€‚</p><h4 id="4-é€‚é…å™¨æ¨¡å¼"><a href="#4-é€‚é…å™¨æ¨¡å¼" class="headerlink" title="4. é€‚é…å™¨æ¨¡å¼"></a>4. é€‚é…å™¨æ¨¡å¼</h4><p>ä»£ç†æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼æä¾›çš„éƒ½æ˜¯è·ŸåŸå§‹ç±»ç›¸åŒçš„æ¥å£ï¼Œè€Œé€‚é…å™¨æä¾›è·ŸåŸå§‹ç±»ä¸åŒçš„æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼æ˜¯ç”¨æ¥åšé€‚é…çš„ï¼Œå®ƒå°†ä¸å…¼å®¹çš„æ¥å£è½¬æ¢ä¸ºå¯å…¼å®¹çš„æ¥å£ï¼Œè®©åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚é€‚é…å™¨æ¨¡å¼æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šç±»é€‚é…å™¨å’Œå¯¹è±¡é€‚é…å™¨ã€‚å…¶ä¸­ï¼Œç±»é€‚é…å™¨ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°ï¼Œå¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆå…³ç³»æ¥å®ç°ã€‚</p><p>é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§äº‹åçš„è¡¥æ•‘ç­–ç•¥ï¼Œç”¨æ¥è¡¥æ•‘è®¾è®¡ä¸Šçš„ç¼ºé™·ã€‚åº”ç”¨è¿™ç§æ¨¡å¼ç®—æ˜¯â€œæ— å¥ˆä¹‹ä¸¾â€ã€‚å¦‚æœåœ¨è®¾è®¡åˆæœŸï¼Œæˆ‘ä»¬å°±èƒ½è§„é¿æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ï¼Œé‚£è¿™ç§æ¨¡å¼å°±æ— ç”¨æ­¦ä¹‹åœ°äº†ã€‚åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šå‡ºç°æ¥å£ä¸å…¼å®¹å‘¢ï¼Ÿæˆ‘æ€»ç»“ä¸‹äº†ä¸‹é¢è¿™ 5 ç§åœºæ™¯ï¼š</p><ul><li>å°è£…æœ‰ç¼ºé™·çš„æ¥å£è®¾è®¡</li><li>ç»Ÿä¸€å¤šä¸ªç±»çš„æ¥å£è®¾è®¡</li><li>æ›¿æ¢ä¾èµ–çš„å¤–éƒ¨ç³»ç»Ÿ</li><li>å…¼å®¹è€ç‰ˆæœ¬æ¥å£</li><li>é€‚é…ä¸åŒæ ¼å¼çš„æ•°æ®</li></ul><h4 id="5-é—¨é¢æ¨¡å¼"><a href="#5-é—¨é¢æ¨¡å¼" class="headerlink" title="5. é—¨é¢æ¨¡å¼"></a>5. é—¨é¢æ¨¡å¼</h4><p>é—¨é¢æ¨¡å¼åŸç†ã€å®ç°éƒ½éå¸¸ç®€å•ï¼Œåº”ç”¨åœºæ™¯æ¯”è¾ƒæ˜ç¡®ã€‚å®ƒé€šè¿‡å°è£…ç»†ç²’åº¦çš„æ¥å£ï¼Œæä¾›ç»„åˆå„ä¸ªç»†ç²’åº¦æ¥å£çš„é«˜å±‚æ¬¡æ¥å£ï¼Œæ¥æé«˜æ¥å£çš„æ˜“ç”¨æ€§ï¼Œæˆ–è€…è§£å†³æ€§èƒ½ã€åˆ†å¸ƒå¼äº‹åŠ¡ç­‰é—®é¢˜ã€‚</p><h4 id="6-ç»„åˆæ¨¡å¼"><a href="#6-ç»„åˆæ¨¡å¼" class="headerlink" title="6. ç»„åˆæ¨¡å¼"></a>6. ç»„åˆæ¨¡å¼</h4><p>ç»„åˆæ¨¡å¼è·Ÿæˆ‘ä»¬ä¹‹å‰è®²çš„é¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„â€œç»„åˆå…³ç³»ï¼ˆé€šè¿‡ç»„åˆæ¥ç»„è£…ä¸¤ä¸ªç±»ï¼‰â€ï¼Œå®Œå…¨æ˜¯ä¸¤ç äº‹ã€‚è¿™é‡Œè®²çš„â€œç»„åˆæ¨¡å¼â€ï¼Œä¸»è¦æ˜¯ç”¨æ¥å¤„ç†æ ‘å½¢ç»“æ„æ•°æ®ã€‚æ­£å› ä¸ºå…¶åº”ç”¨åœºæ™¯çš„ç‰¹æ®Šæ€§ï¼Œæ•°æ®å¿…é¡»èƒ½è¡¨ç¤ºæˆæ ‘å½¢ç»“æ„ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†è¿™ç§æ¨¡å¼åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­å¹¶ä¸é‚£ä¹ˆå¸¸ç”¨ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æ•°æ®æ»¡è¶³æ ‘å½¢ç»“æ„ï¼Œåº”ç”¨è¿™ç§æ¨¡å¼å°±èƒ½å‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ï¼Œèƒ½è®©ä»£ç å˜å¾—éå¸¸ç®€æ´ã€‚</p><p>ç»„åˆæ¨¡å¼çš„è®¾è®¡æ€è·¯ï¼Œä¸å…¶è¯´æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå€’ä¸å¦‚è¯´æ˜¯å¯¹ä¸šåŠ¡åœºæ™¯çš„ä¸€ç§æ•°æ®ç»“æ„å’Œç®—æ³•çš„æŠ½è±¡ã€‚å…¶ä¸­ï¼Œæ•°æ®å¯ä»¥è¡¨ç¤ºæˆæ ‘è¿™ç§æ•°æ®ç»“æ„ï¼Œä¸šåŠ¡éœ€æ±‚å¯ä»¥é€šè¿‡åœ¨æ ‘ä¸Šçš„é€’å½’éå†ç®—æ³•æ¥å®ç°ã€‚ç»„åˆæ¨¡å¼ï¼Œå°†ä¸€ç»„å¯¹è±¡ç»„ç»‡æˆæ ‘å½¢ç»“æ„ï¼Œå°†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡éƒ½çœ‹ä½œæ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œä»¥ç»Ÿä¸€å¤„ç†é€»è¾‘ï¼Œå¹¶ä¸”å®ƒåˆ©ç”¨æ ‘å½¢ç»“æ„çš„ç‰¹ç‚¹ï¼Œé€’å½’åœ°å¤„ç†æ¯ä¸ªå­æ ‘ï¼Œä¾æ¬¡ç®€åŒ–ä»£ç å®ç°ã€‚</p><h4 id="7-äº«å…ƒæ¨¡å¼"><a href="#7-äº«å…ƒæ¨¡å¼" class="headerlink" title="7. äº«å…ƒæ¨¡å¼"></a>7. äº«å…ƒæ¨¡å¼</h4><p>æ‰€è°“â€œäº«å…ƒâ€ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è¢«å…±äº«çš„å•å…ƒã€‚äº«å…ƒæ¨¡å¼çš„æ„å›¾æ˜¯å¤ç”¨å¯¹è±¡ï¼ŒèŠ‚çœå†…å­˜ï¼Œå‰ææ˜¯äº«å…ƒå¯¹è±¡æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚</p><p>å…·ä½“æ¥è®²ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡é‡å¤å¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨äº«å…ƒæ¨¡å¼ï¼Œå°†å¯¹è±¡è®¾è®¡æˆäº«å…ƒï¼Œåœ¨å†…å­˜ä¸­åªä¿ç•™ä¸€ä»½å®ä¾‹ï¼Œä¾›å¤šå¤„ä»£ç å¼•ç”¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡ï¼Œä»¥èµ·åˆ°èŠ‚çœå†…å­˜çš„ç›®çš„ã€‚å®é™…ä¸Šï¼Œä¸ä»…ä»…ç›¸åŒå¯¹è±¡å¯ä»¥è®¾è®¡æˆäº«å…ƒï¼Œå¯¹äºç›¸ä¼¼å¯¹è±¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™äº›å¯¹è±¡ä¸­ç›¸åŒçš„éƒ¨åˆ†ï¼ˆå­—æ®µï¼‰ï¼Œæå–å‡ºæ¥è®¾è®¡æˆäº«å…ƒï¼Œè®©è¿™äº›å¤§é‡ç›¸ä¼¼å¯¹è±¡å¼•ç”¨è¿™äº›äº«å…ƒã€‚</p><h3 id="ä¸‰ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"><a href="#ä¸‰ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="ä¸‰ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"></a>ä¸‰ã€è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œåˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œå¯¹è±¡çš„åˆ›å»ºâ€é—®é¢˜ï¼Œç»“æ„å‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œç±»æˆ–å¯¹è±¡çš„ç»„åˆâ€é—®é¢˜ï¼Œé‚£è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³çš„å°±æ˜¯â€œç±»æˆ–å¯¹è±¡ä¹‹é—´çš„äº¤äº’â€é—®é¢˜ã€‚è¡Œä¸ºå‹æ¨¡å¼æ¯”è¾ƒå¤šï¼Œæœ‰ 11 ç§ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€ä¸­ä»‹æ¨¡å¼ã€‚</p><h4 id="1-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#1-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="1. è§‚å¯Ÿè€…æ¨¡å¼"></a>1. è§‚å¯Ÿè€…æ¨¡å¼</h4><p>è§‚å¯Ÿè€…æ¨¡å¼å°†è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä»£ç è§£è€¦ã€‚è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œå°åˆ°ä»£ç å±‚é¢çš„è§£è€¦ï¼Œå¤§åˆ°æ¶æ„å±‚é¢çš„ç³»ç»Ÿè§£è€¦ï¼Œå†æˆ–è€…ä¸€äº›äº§å“çš„è®¾è®¡æ€è·¯ï¼Œéƒ½æœ‰è¿™ç§æ¨¡å¼çš„å½±å­ï¼Œæ¯”å¦‚ï¼Œé‚®ä»¶è®¢é˜…ã€RSS Feedsï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><p>ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ä¸‹ï¼Œè¿™ä¸ªæ¨¡å¼ä¹Ÿæœ‰æˆªç„¶ä¸åŒçš„å®ç°æ–¹å¼ï¼šæœ‰åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰å¼‚æ­¥éé˜»å¡çš„å®ç°æ–¹å¼ï¼›æœ‰è¿›ç¨‹å†…çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰è·¨è¿›ç¨‹çš„å®ç°æ–¹å¼ã€‚åŒæ­¥é˜»å¡æ˜¯æœ€ç»å…¸çš„å®ç°æ–¹å¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä»£ç è§£è€¦ï¼›å¼‚æ­¥éé˜»å¡é™¤äº†èƒ½å®ç°ä»£ç è§£è€¦ä¹‹å¤–ï¼Œè¿˜èƒ½æé«˜ä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼›è¿›ç¨‹é—´çš„è§‚å¯Ÿè€…æ¨¡å¼è§£è€¦æ›´åŠ å½»åº•ï¼Œä¸€èˆ¬æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°ï¼Œç”¨æ¥å®ç°ä¸åŒè¿›ç¨‹é—´çš„è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´çš„äº¤äº’ã€‚</p><p>æ¡†æ¶çš„ä½œç”¨æœ‰éšè—å®ç°ç»†èŠ‚ï¼Œé™ä½å¼€å‘éš¾åº¦ï¼Œå®ç°ä»£ç å¤ç”¨ï¼Œè§£è€¦ä¸šåŠ¡ä¸éä¸šåŠ¡ä»£ç ï¼Œè®©ç¨‹åºå‘˜èšç„¦ä¸šåŠ¡å¼€å‘ã€‚é’ˆå¯¹å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒæŠ½è±¡æˆ EventBus æ¡†æ¶æ¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚EventBus ç¿»è¯‘ä¸ºâ€œäº‹ä»¶æ€»çº¿â€ï¼Œå®ƒæä¾›äº†å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„éª¨æ¶ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºæ­¤æ¡†æ¶éå¸¸å®¹æ˜“åœ°åœ¨è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ä¸­å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä¸éœ€è¦ä»é›¶å¼€å§‹å¼€å‘ã€‚</p><h4 id="2-æ¨¡æ¿æ¨¡å¼"><a href="#2-æ¨¡æ¿æ¨¡å¼" class="headerlink" title="2. æ¨¡æ¿æ¨¡å¼"></a>2. æ¨¡æ¿æ¨¡å¼</h4><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•éª¨æ¶ï¼Œå¹¶å°†æŸäº›æ­¥éª¤æ¨è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¯ä»¥è®©å­ç±»åœ¨ä¸æ”¹å˜ç®—æ³•æ•´ä½“ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚è¿™é‡Œçš„â€œç®—æ³•â€ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå¹¿ä¹‰ä¸Šçš„â€œä¸šåŠ¡é€»è¾‘â€ï¼Œå¹¶ä¸ç‰¹æŒ‡æ•°æ®ç»“æ„å’Œç®—æ³•ä¸­çš„â€œç®—æ³•â€ã€‚è¿™é‡Œçš„ç®—æ³•éª¨æ¶å°±æ˜¯â€œæ¨¡æ¿â€ï¼ŒåŒ…å«ç®—æ³•éª¨æ¶çš„æ–¹æ³•å°±æ˜¯â€œæ¨¡æ¿æ–¹æ³•â€ï¼Œè¿™ä¹Ÿæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼åå­—çš„ç”±æ¥ã€‚</p><p>æ¨¡æ¿æ¨¡å¼æœ‰ä¸¤å¤§ä½œç”¨ï¼šå¤ç”¨å’Œæ‰©å±•ã€‚å…¶ä¸­å¤ç”¨æŒ‡çš„æ˜¯ï¼Œæ‰€æœ‰çš„å­ç±»å¯ä»¥å¤ç”¨çˆ¶ç±»ä¸­æä¾›çš„æ¨¡æ¿æ–¹æ³•çš„ä»£ç ã€‚æ‰©å±•æŒ‡çš„æ˜¯ï¼Œæ¡†æ¶é€šè¿‡æ¨¡æ¿æ¨¡å¼æä¾›åŠŸèƒ½æ‰©å±•ç‚¹ï¼Œè®©æ¡†æ¶ç”¨æˆ·å¯ä»¥åœ¨ä¸ä¿®æ”¹æ¡†æ¶æºç çš„æƒ…å†µä¸‹ï¼ŒåŸºäºæ‰©å±•ç‚¹å®šåˆ¶åŒ–æ¡†æ¶çš„åŠŸèƒ½ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²åˆ°å›è°ƒã€‚å®ƒè·Ÿæ¨¡æ¿æ¨¡å¼å…·æœ‰ç›¸åŒçš„ä½œç”¨ï¼šä»£ç å¤ç”¨å’Œæ‰©å±•ã€‚åœ¨ä¸€äº›æ¡†æ¶ã€ç±»åº“ã€ç»„ä»¶ç­‰çš„è®¾è®¡ä¸­ç»å¸¸ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚ JdbcTemplate å°±æ˜¯ç”¨äº†å›è°ƒã€‚</p><p>ç›¸å¯¹äºæ™®é€šçš„å‡½æ•°è°ƒç”¨ï¼Œå›è°ƒæ˜¯ä¸€ç§åŒå‘è°ƒç”¨å…³ç³»ã€‚A ç±»äº‹å…ˆæ³¨å†ŒæŸä¸ªå‡½æ•° F åˆ° B ç±»ï¼ŒA ç±»åœ¨è°ƒç”¨ B ç±»çš„ P å‡½æ•°çš„æ—¶å€™ï¼ŒB ç±»åè¿‡æ¥è°ƒç”¨ A ç±»æ³¨å†Œç»™å®ƒçš„ F å‡½æ•°ã€‚è¿™é‡Œçš„ F å‡½æ•°å°±æ˜¯â€œå›è°ƒå‡½æ•°â€ã€‚A è°ƒç”¨ Bï¼ŒB åè¿‡æ¥åˆè°ƒç”¨ Aï¼Œè¿™ç§è°ƒç”¨æœºåˆ¶å°±å«ä½œâ€œå›è°ƒâ€ã€‚</p><p>å›è°ƒå¯ä»¥ç»†åˆ†ä¸ºåŒæ­¥å›è°ƒå’Œå¼‚æ­¥å›è°ƒã€‚ä»åº”ç”¨åœºæ™¯ä¸Šæ¥çœ‹ï¼ŒåŒæ­¥å›è°ƒçœ‹èµ·æ¥æ›´åƒæ¨¡æ¿æ¨¡å¼ï¼Œå¼‚æ­¥å›è°ƒçœ‹èµ·æ¥æ›´åƒè§‚å¯Ÿè€…æ¨¡å¼ã€‚å›è°ƒè·Ÿæ¨¡æ¿æ¨¡å¼çš„åŒºåˆ«ï¼Œæ›´å¤šçš„æ˜¯åœ¨ä»£ç å®ç°ä¸Šï¼Œè€Œéåº”ç”¨åœºæ™¯ä¸Šã€‚å›è°ƒåŸºäºç»„åˆå…³ç³»æ¥å®ç°ï¼Œæ¨¡æ¿æ¨¡å¼åŸºäºç»§æ‰¿å…³ç³»æ¥å®ç°ã€‚å›è°ƒæ¯”æ¨¡æ¿æ¨¡å¼æ›´åŠ çµæ´»ã€‚</p><h4 id="3-ç­–ç•¥æ¨¡å¼"><a href="#3-ç­–ç•¥æ¨¡å¼" class="headerlink" title="3. ç­–ç•¥æ¨¡å¼"></a>3. ç­–ç•¥æ¨¡å¼</h4><p>ç­–ç•¥æ¨¡å¼å®šä¹‰ä¸€ç»„ç®—æ³•ç±»ï¼Œå°†æ¯ä¸ªç®—æ³•åˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼å¯ä»¥ä½¿ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„å®¢æˆ·ç«¯ï¼ˆè¿™é‡Œçš„å®¢æˆ·ç«¯ä»£æŒ‡ä½¿ç”¨ç®—æ³•çš„ä»£ç ï¼‰ã€‚ç­–ç•¥æ¨¡å¼ç”¨æ¥è§£è€¦ç­–ç•¥çš„å®šä¹‰ã€åˆ›å»ºã€ä½¿ç”¨ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªå®Œæ•´çš„ç­–ç•¥æ¨¡å¼å°±æ˜¯ç”±è¿™ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„ã€‚</p><p>ç­–ç•¥ç±»çš„å®šä¹‰æ¯”è¾ƒç®€å•ï¼ŒåŒ…å«ä¸€ä¸ªç­–ç•¥æ¥å£å’Œä¸€ç»„å®ç°è¿™ä¸ªæ¥å£çš„ç­–ç•¥ç±»ã€‚ç­–ç•¥çš„åˆ›å»ºç”±å·¥å‚ç±»æ¥å®Œæˆï¼Œå°è£…ç­–ç•¥åˆ›å»ºçš„ç»†èŠ‚ã€‚ç­–ç•¥æ¨¡å¼åŒ…å«ä¸€ç»„ç­–ç•¥å¯é€‰ï¼Œå®¢æˆ·ç«¯ä»£ç é€‰æ‹©ä½¿ç”¨å“ªä¸ªç­–ç•¥ï¼Œæœ‰ä¸¤ç§ç¡®å®šæ–¹æ³•ï¼šç¼–è¯‘æ—¶é™æ€ç¡®å®šå’Œè¿è¡Œæ—¶åŠ¨æ€ç¡®å®šã€‚å…¶ä¸­ï¼Œâ€œè¿è¡Œæ—¶åŠ¨æ€ç¡®å®šâ€æ‰æ˜¯ç­–ç•¥æ¨¡å¼æœ€å…¸å‹çš„åº”ç”¨åœºæ™¯ã€‚</p><p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œç­–ç•¥æ¨¡å¼ä¹Ÿæ¯”è¾ƒå¸¸ç”¨ã€‚æœ€å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Œåˆ©ç”¨å®ƒæ¥é¿å…å†—é•¿çš„ if-else æˆ– switch åˆ†æ”¯åˆ¤æ–­ã€‚ä¸è¿‡ï¼Œå®ƒçš„ä½œç”¨è¿˜ä¸æ­¢å¦‚æ­¤ã€‚å®ƒä¹Ÿå¯ä»¥åƒæ¨¡æ¿æ¨¡å¼é‚£æ ·ï¼Œæä¾›æ¡†æ¶çš„æ‰©å±•ç‚¹ç­‰ç­‰ã€‚å®é™…ä¸Šï¼Œç­–ç•¥æ¨¡å¼ä¸»è¦çš„ä½œç”¨è¿˜æ˜¯è§£è€¦ç­–ç•¥çš„å®šä¹‰ã€åˆ›å»ºå’Œä½¿ç”¨ï¼Œæ§åˆ¶ä»£ç çš„å¤æ‚åº¦ï¼Œè®©æ¯ä¸ªéƒ¨åˆ†éƒ½ä¸è‡³äºè¿‡äºå¤æ‚ã€ä»£ç é‡è¿‡å¤šã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºå¤æ‚ä»£ç æ¥è¯´ï¼Œç­–ç•¥æ¨¡å¼è¿˜èƒ½è®©å…¶æ»¡è¶³å¼€é—­åŸåˆ™ï¼Œæ·»åŠ æ–°ç­–ç•¥çš„æ—¶å€™ï¼Œæœ€å°åŒ–ã€é›†ä¸­åŒ–ä»£ç æ”¹åŠ¨ï¼Œå‡å°‘å¼•å…¥ bug çš„é£é™©ã€‚</p><h4 id="4-èŒè´£é“¾æ¨¡å¼"><a href="#4-èŒè´£é“¾æ¨¡å¼" class="headerlink" title="4. èŒè´£é“¾æ¨¡å¼"></a>4. èŒè´£é“¾æ¨¡å¼</h4><p>åœ¨èŒè´£é“¾æ¨¡å¼ä¸­ï¼Œå¤šä¸ªå¤„ç†å™¨ä¾æ¬¡å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ã€‚ä¸€ä¸ªè¯·æ±‚å…ˆç»è¿‡ A å¤„ç†å™¨å¤„ç†ï¼Œç„¶åå†æŠŠè¯·æ±‚ä¼ é€’ç»™ B å¤„ç†å™¨ï¼ŒB å¤„ç†å™¨å¤„ç†å®Œåå†ä¼ é€’ç»™ C å¤„ç†å™¨ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå½¢æˆä¸€ä¸ªé“¾æ¡ã€‚é“¾æ¡ä¸Šçš„æ¯ä¸ªå¤„ç†å™¨å„è‡ªæ‰¿æ‹…å„è‡ªçš„å¤„ç†èŒè´£ï¼Œæ‰€ä»¥å«ä½œèŒè´£é“¾æ¨¡å¼ã€‚</p><p>åœ¨ GoF çš„å®šä¹‰ä¸­ï¼Œä¸€æ—¦æŸä¸ªå¤„ç†å™¨èƒ½å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå°±ä¸ä¼šç»§ç»­å°†è¯·æ±‚ä¼ é€’ç»™åç»­çš„å¤„ç†å™¨äº†ã€‚å½“ç„¶ï¼Œåœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œä¹Ÿå­˜åœ¨å¯¹è¿™ä¸ªæ¨¡å¼çš„å˜ä½“ï¼Œé‚£å°±æ˜¯è¯·æ±‚ä¸ä¼šä¸­é€”ç»ˆæ­¢ä¼ é€’ï¼Œè€Œæ˜¯ä¼šè¢«æ‰€æœ‰çš„å¤„ç†å™¨éƒ½å¤„ç†ä¸€éã€‚</p><p>èŒè´£é“¾æ¨¡å¼å¸¸ç”¨åœ¨æ¡†æ¶å¼€å‘ä¸­ï¼Œç”¨æ¥å®ç°è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨åŠŸèƒ½ï¼Œè®©æ¡†æ¶çš„ä½¿ç”¨è€…åœ¨ä¸éœ€è¦ä¿®æ”¹æ¡†æ¶æºç çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ æ–°çš„è¿‡æ»¤ã€æ‹¦æˆªåŠŸèƒ½ã€‚è¿™ä¹Ÿä½“ç°äº†ä¹‹å‰è®²åˆ°çš„å¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­çš„è®¾è®¡åŸåˆ™ã€‚</p><h4 id="5-è¿­ä»£å™¨æ¨¡å¼"><a href="#5-è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="5. è¿­ä»£å™¨æ¨¡å¼"></a>5. è¿­ä»£å™¨æ¨¡å¼</h4><p>è¿­ä»£å™¨æ¨¡å¼ä¹Ÿå«æ¸¸æ ‡æ¨¡å¼ï¼Œå®ƒç”¨æ¥éå†é›†åˆå¯¹è±¡ã€‚è¿™é‡Œè¯´çš„â€œé›†åˆå¯¹è±¡â€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å«â€œå®¹å™¨â€â€œèšåˆå¯¹è±¡â€ï¼Œå®é™…ä¸Šå°±æ˜¯åŒ…å«ä¸€ç»„å¯¹è±¡çš„å¯¹è±¡ï¼Œæ¯”å¦‚ï¼Œæ•°ç»„ã€é“¾è¡¨ã€æ ‘ã€å›¾ã€è·³è¡¨ã€‚è¿­ä»£å™¨æ¨¡å¼ä¸»è¦ä½œç”¨æ˜¯è§£è€¦å®¹å™¨ä»£ç å’Œéå†ä»£ç ã€‚å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½æä¾›äº†ç°æˆçš„è¿­ä»£å™¨å¯ä»¥ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»é›¶å¼€å§‹å¼€å‘ã€‚</p><p>éå†é›†åˆä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼ï¼šfor å¾ªç¯ã€foreach å¾ªç¯ã€è¿­ä»£å™¨éå†ã€‚åä¸¤ç§æœ¬è´¨ä¸Šå±äºä¸€ç§ï¼Œéƒ½å¯ä»¥çœ‹ä½œè¿­ä»£å™¨éå†ã€‚ç›¸å¯¹äº for å¾ªç¯éå†ï¼Œåˆ©ç”¨è¿­ä»£å™¨æ¥éå†æœ‰ 3 ä¸ªä¼˜åŠ¿ï¼š</p><ul><li>è¿­ä»£å™¨æ¨¡å¼å°è£…é›†åˆå†…éƒ¨çš„å¤æ‚æ•°æ®ç»“æ„ï¼Œå¼€å‘è€…ä¸éœ€è¦äº†è§£å¦‚ä½•éå†ï¼Œç›´æ¥ä½¿ç”¨å®¹å™¨æä¾›çš„è¿­ä»£å™¨å³å¯ï¼›</li><li>è¿­ä»£å™¨æ¨¡å¼å°†é›†åˆå¯¹è±¡çš„éå†æ“ä½œä»é›†åˆç±»ä¸­æ‹†åˆ†å‡ºæ¥ï¼Œæ”¾åˆ°è¿­ä»£å™¨ç±»ä¸­ï¼Œè®©ä¸¤è€…çš„èŒè´£æ›´åŠ å•ä¸€ï¼›</li><li>è¿­ä»£å™¨æ¨¡å¼è®©æ·»åŠ æ–°çš„éå†ç®—æ³•æ›´åŠ å®¹æ˜“ï¼Œæ›´ç¬¦åˆå¼€é—­åŸåˆ™ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºè¿­ä»£å™¨éƒ½å®ç°è‡ªç›¸åŒçš„æ¥å£ï¼Œåœ¨å¼€å‘ä¸­ï¼ŒåŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œæ›¿æ¢è¿­ä»£å™¨ä¹Ÿå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</li></ul><p>åœ¨é€šè¿‡è¿­ä»£å™¨æ¥éå†é›†åˆå…ƒç´ çš„åŒæ—¶ï¼Œå¢åŠ æˆ–è€…åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´æŸä¸ªå…ƒç´ è¢«é‡å¤éå†æˆ–éå†ä¸åˆ°ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§æ¯”è¾ƒå¹²è„†åˆ©ç´¢çš„è§£å†³æ–¹æ¡ˆï¼Œæ¥é¿å…å‡ºç°è¿™ç§ä¸å¯é¢„æœŸçš„è¿è¡Œç»“æœã€‚ä¸€ç§æ˜¯éå†çš„æ—¶å€™ä¸å…è®¸å¢åˆ å…ƒç´ ï¼Œå¦ä¸€ç§æ˜¯å¢åˆ å…ƒç´ ä¹‹åè®©éå†æŠ¥é”™ã€‚ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆæ¯”è¾ƒéš¾å®ç°ï¼Œå› ä¸ºå¾ˆéš¾ç¡®å®šè¿­ä»£å™¨ä½¿ç”¨ç»“æŸçš„æ—¶é—´ç‚¹ã€‚ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆæ›´åŠ åˆç†ï¼ŒJava è¯­è¨€å°±æ˜¯é‡‡ç”¨çš„è¿™ç§è§£å†³æ–¹æ¡ˆã€‚å¢åˆ å…ƒç´ ä¹‹åï¼Œæˆ‘ä»¬é€‰æ‹© fail-fast è§£å†³æ–¹å¼ï¼Œè®©éå†æ“ä½œç›´æ¥æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚</p><h4 id="6-çŠ¶æ€æ¨¡å¼"><a href="#6-çŠ¶æ€æ¨¡å¼" class="headerlink" title="6. çŠ¶æ€æ¨¡å¼"></a>6. çŠ¶æ€æ¨¡å¼</h4><p>çŠ¶æ€æ¨¡å¼ä¸€èˆ¬ç”¨æ¥å®ç°çŠ¶æ€æœºï¼Œè€ŒçŠ¶æ€æœºå¸¸ç”¨åœ¨æ¸¸æˆã€å·¥ä½œæµå¼•æ“ç­‰ç³»ç»Ÿå¼€å‘ä¸­ã€‚çŠ¶æ€æœºåˆå«æœ‰é™çŠ¶æ€æœºï¼Œå®ƒç”± 3 ä¸ªéƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€ã€äº‹ä»¶ã€åŠ¨ä½œã€‚å…¶ä¸­ï¼Œäº‹ä»¶ä¹Ÿç§°ä¸ºè½¬ç§»æ¡ä»¶ã€‚äº‹ä»¶è§¦å‘çŠ¶æ€çš„è½¬ç§»åŠåŠ¨ä½œçš„æ‰§è¡Œã€‚ä¸è¿‡ï¼ŒåŠ¨ä½œä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯èƒ½åªè½¬ç§»çŠ¶æ€ï¼Œä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œã€‚</p><p>é’ˆå¯¹çŠ¶æ€æœºï¼Œæˆ‘ä»¬æ€»ç»“äº†ä¸‰ç§å®ç°æ–¹å¼ã€‚</p><ul><li>ç¬¬ä¸€ç§å®ç°æ–¹å¼å«åˆ†æ”¯é€»è¾‘æ³•ã€‚åˆ©ç”¨ if-else æˆ–è€… switch-case åˆ†æ”¯é€»è¾‘ï¼Œå‚ç…§çŠ¶æ€è½¬ç§»å›¾ï¼Œå°†æ¯ä¸€ä¸ªçŠ¶æ€è½¬ç§»åŸæ¨¡åŸæ ·åœ°ç›´è¯‘æˆä»£ç ã€‚å¯¹äºç®€å•çš„çŠ¶æ€æœºæ¥è¯´ï¼Œè¿™ç§å®ç°æ–¹å¼æœ€ç®€å•ã€æœ€ç›´æ¥ï¼Œæ˜¯é¦–é€‰ã€‚</li><li>ç¬¬äºŒç§å®ç°æ–¹å¼å«æŸ¥è¡¨æ³•ã€‚å¯¹äºçŠ¶æ€å¾ˆå¤šã€çŠ¶æ€è½¬ç§»æ¯”è¾ƒå¤æ‚çš„çŠ¶æ€æœºæ¥è¯´ï¼ŒæŸ¥è¡¨æ³•æ¯”è¾ƒåˆé€‚ã€‚é€šè¿‡äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºçŠ¶æ€è½¬ç§»å›¾ï¼Œèƒ½æå¤§åœ°æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li>ç¬¬ä¸‰ç§å®ç°æ–¹å¼å°±æ˜¯åˆ©ç”¨çŠ¶æ€æ¨¡å¼ã€‚å¯¹äºçŠ¶æ€å¹¶ä¸å¤šã€çŠ¶æ€è½¬ç§»ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½†äº‹ä»¶è§¦å‘æ‰§è¡Œçš„åŠ¨ä½œåŒ…å«çš„ä¸šåŠ¡é€»è¾‘å¯èƒ½æ¯”è¾ƒå¤æ‚çš„çŠ¶æ€æœºæ¥è¯´ï¼Œæˆ‘ä»¬é¦–é€‰è¿™ç§å®ç°æ–¹å¼ã€‚</li></ul><h4 id="7-è®¿é—®è€…æ¨¡å¼"><a href="#7-è®¿é—®è€…æ¨¡å¼" class="headerlink" title="7. è®¿é—®è€…æ¨¡å¼"></a>7. è®¿é—®è€…æ¨¡å¼</h4><p>è®¿é—®è€…æ¨¡å¼å…è®¸ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œåº”ç”¨åˆ°ä¸€ç»„å¯¹è±¡ä¸Šï¼Œè®¾è®¡æ„å›¾æ˜¯è§£è€¦æ“ä½œå’Œå¯¹è±¡æœ¬èº«ï¼Œä¿æŒç±»èŒè´£å•ä¸€ã€æ»¡è¶³å¼€é—­åŸåˆ™ä»¥åŠåº”å¯¹ä»£ç çš„å¤æ‚æ€§ã€‚</p><p>å¯¹äºè®¿é—®è€…æ¨¡å¼ï¼Œå­¦ä¹ çš„ä¸»è¦éš¾ç‚¹åœ¨ä»£ç å®ç°ã€‚è€Œä»£ç å®ç°æ¯”è¾ƒå¤æ‚çš„ä¸»è¦åŸå› æ˜¯ï¼Œå‡½æ•°é‡è½½åœ¨å¤§éƒ¨åˆ†é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­æ˜¯é™æ€ç»‘å®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ç±»çš„å“ªä¸ªé‡è½½å‡½æ•°ï¼Œæ˜¯åœ¨ç¼–è¯‘æœŸé—´ï¼Œç”±å‚æ•°çš„å£°æ˜ç±»å‹å†³å®šçš„ï¼Œè€Œéè¿è¡Œæ—¶ï¼Œæ ¹æ®å‚æ•°çš„å®é™…ç±»å‹å†³å®šçš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²åˆ° Double Disptachã€‚å¦‚æœæŸç§è¯­è¨€æ”¯æŒ Double Dispatchï¼Œé‚£å°±ä¸éœ€è¦è®¿é—®è€…æ¨¡å¼äº†ã€‚</p><p>æ­£æ˜¯å› ä¸ºä»£ç å®ç°éš¾ç†è§£ï¼Œæ‰€ä»¥ï¼Œåœ¨é¡¹ç›®ä¸­åº”ç”¨è¿™ç§æ¨¡å¼ï¼Œä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§æ¯”è¾ƒå·®ã€‚å¦‚æœä½ çš„åŒäº‹ä¸äº†è§£è¿™ç§è®¾è®¡æ¨¡å¼ï¼Œå¯èƒ½å°±ä¼šè¯»ä¸æ‡‚ã€ç»´æŠ¤ä¸äº†ä½ å†™çš„ä»£ç ã€‚æ‰€ä»¥ï¼Œé™¤éä¸å¾—å·²ï¼Œä¸è¦ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚</p><h4 id="8-å¤‡å¿˜å½•æ¨¡å¼"><a href="#8-å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="8. å¤‡å¿˜å½•æ¨¡å¼"></a>8. å¤‡å¿˜å½•æ¨¡å¼</h4><p>å¤‡å¿˜å½•æ¨¡å¼ä¹Ÿå«å¿«ç…§æ¨¡å¼ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨ä¸è¿èƒŒå°è£…åŸåˆ™çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä¹‹åæ¢å¤å¯¹è±¡ä¸ºå…ˆå‰çš„çŠ¶æ€ã€‚è¿™ä¸ªæ¨¡å¼çš„å®šä¹‰è¡¨è¾¾äº†ä¸¤éƒ¨åˆ†å†…å®¹ï¼šä¸€éƒ¨åˆ†æ˜¯ï¼Œå­˜å‚¨å‰¯æœ¬ä»¥ä¾¿åæœŸæ¢å¤ï¼›å¦ä¸€éƒ¨åˆ†æ˜¯ï¼Œè¦åœ¨ä¸è¿èƒŒå°è£…åŸåˆ™çš„å‰æä¸‹ï¼Œè¿›è¡Œå¯¹è±¡çš„å¤‡ä»½å’Œæ¢å¤ã€‚</p><p>å¤‡å¿˜å½•æ¨¡å¼çš„åº”ç”¨åœºæ™¯ä¹Ÿæ¯”è¾ƒæ˜ç¡®å’Œæœ‰é™ï¼Œä¸»è¦ç”¨æ¥é˜²ä¸¢å¤±ã€æ’¤é”€ã€æ¢å¤ç­‰ã€‚å®ƒè·Ÿå¹³æ—¶æˆ‘ä»¬å¸¸è¯´çš„â€œå¤‡ä»½â€å¾ˆç›¸ä¼¼ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå¤‡å¿˜å½•æ¨¡å¼æ›´ä¾§é‡äºä»£ç çš„è®¾è®¡å’Œå®ç°ï¼Œå¤‡ä»½æ›´ä¾§é‡æ¶æ„è®¾è®¡æˆ–äº§å“è®¾è®¡ã€‚</p><p>å¯¹äºå¤§å¯¹è±¡çš„å¤‡ä»½æ¥è¯´ï¼Œå¤‡ä»½å ç”¨çš„å­˜å‚¨ç©ºé—´ä¼šæ¯”è¾ƒå¤§ï¼Œå¤‡ä»½å’Œæ¢å¤çš„è€—æ—¶ä¼šæ¯”è¾ƒé•¿ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œä¸åŒçš„ä¸šåŠ¡åœºæ™¯æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚æ¯”å¦‚ï¼Œåªå¤‡ä»½å¿…è¦çš„æ¢å¤ä¿¡æ¯ï¼Œç»“åˆæœ€æ–°çš„æ•°æ®æ¥æ¢å¤ï¼›å†æ¯”å¦‚ï¼Œå…¨é‡å¤‡ä»½å’Œå¢é‡å¤‡ä»½ç›¸ç»“åˆï¼Œä½é¢‘å…¨é‡å¤‡ä»½ï¼Œé«˜é¢‘å¢é‡å¤‡ä»½ï¼Œä¸¤è€…ç»“åˆæ¥åšæ¢å¤ã€‚</p><h4 id="9-å‘½ä»¤æ¨¡å¼"><a href="#9-å‘½ä»¤æ¨¡å¼" class="headerlink" title="9. å‘½ä»¤æ¨¡å¼"></a>9. å‘½ä»¤æ¨¡å¼</h4><p>å‘½ä»¤æ¨¡å¼åœ¨å¹³æ—¶å·¥ä½œä¸­å¹¶ä¸å¸¸ç”¨ï¼Œä½ ç¨å¾®äº†è§£ä¸€ä¸‹å°±å¯ä»¥ã€‚</p><p>è½å®åˆ°ç¼–ç å®ç°ï¼Œå‘½ä»¤æ¨¡å¼ç”¨åˆ°æœ€æ ¸å¿ƒçš„å®ç°æ‰‹æ®µï¼Œå°±æ˜¯å°†å‡½æ•°å°è£…æˆå¯¹è±¡ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå‡½æ•°æ˜¯æ²¡æ³•ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°çš„ï¼Œä¹Ÿæ²¡æ³•èµ‹å€¼ç»™å˜é‡ã€‚å€ŸåŠ©å‘½ä»¤æ¨¡å¼ï¼Œæˆ‘ä»¬å°†å‡½æ•°å°è£…æˆå¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æŠŠå‡½æ•°åƒå¯¹è±¡ä¸€æ ·ä½¿ç”¨ã€‚</p><p>å‘½ä»¤æ¨¡å¼çš„ä¸»è¦ä½œç”¨å’Œåº”ç”¨åœºæ™¯ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶å‘½ä»¤çš„æ‰§è¡Œï¼Œæ¯”å¦‚ï¼Œå¼‚æ­¥ã€å»¶è¿Ÿã€æ’é˜Ÿæ‰§è¡Œå‘½ä»¤ã€æ’¤é”€é‡åšå‘½ä»¤ã€å­˜å‚¨å‘½ä»¤ã€ç»™å‘½ä»¤è®°å½•æ—¥å¿—ç­‰ï¼Œè¿™æ‰æ˜¯å‘½ä»¤æ¨¡å¼èƒ½å‘æŒ¥ç‹¬ä¸€æ— äºŒä½œç”¨çš„åœ°æ–¹ã€‚</p><h4 id="10-è§£é‡Šå™¨æ¨¡å¼"><a href="#10-è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="10. è§£é‡Šå™¨æ¨¡å¼"></a>10. è§£é‡Šå™¨æ¨¡å¼</h4><p>è§£é‡Šå™¨æ¨¡å¼ä¸ºæŸä¸ªè¯­è¨€å®šä¹‰å®ƒçš„è¯­æ³•ï¼ˆæˆ–è€…å«æ–‡æ³•ï¼‰è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ç”¨æ¥å¤„ç†è¿™ä¸ªè¯­æ³•ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œçš„â€œè¯­è¨€â€ä¸ä»…ä»…æŒ‡æˆ‘ä»¬å¹³æ—¶è¯´çš„ä¸­ã€è‹±ã€æ—¥ã€æ³•ç­‰å„ç§è¯­è¨€ã€‚ä»å¹¿ä¹‰ä¸Šæ¥è®²ï¼Œåªè¦æ˜¯èƒ½æ‰¿è½½ä¿¡æ¯çš„è½½ä½“ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç§°ä¹‹ä¸ºâ€œè¯­è¨€â€ï¼Œæ¯”å¦‚ï¼Œå¤ä»£çš„ç»“ç»³è®°äº‹ã€ç›²æ–‡ã€å“‘è¯­ã€æ‘©æ–¯å¯†ç ç­‰ã€‚</p><p>è¦æƒ³äº†è§£â€œè¯­è¨€â€è¦è¡¨è¾¾çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¿…é¡»å®šä¹‰ç›¸åº”çš„è¯­æ³•è§„åˆ™ã€‚è¿™æ ·ï¼Œä¹¦å†™è€…å°±å¯ä»¥æ ¹æ®è¯­æ³•è§„åˆ™æ¥ä¹¦å†™â€œå¥å­â€ï¼ˆä¸“ä¸šç‚¹çš„å«æ³•åº”è¯¥æ˜¯â€œè¡¨è¾¾å¼â€ï¼‰ï¼Œé˜…è¯»è€…æ ¹æ®è¯­æ³•è§„åˆ™æ¥é˜…è¯»â€œå¥å­â€ï¼Œè¿™æ ·æ‰èƒ½åšåˆ°ä¿¡æ¯çš„æ­£ç¡®ä¼ é€’ã€‚è€Œæˆ‘ä»¬è¦è®²çš„è§£é‡Šå™¨æ¨¡å¼ï¼Œå…¶å®å°±æ˜¯ç”¨æ¥å®ç°æ ¹æ®è¯­æ³•è§„åˆ™è§£è¯»â€œå¥å­â€çš„è§£é‡Šå™¨ã€‚</p><p>è§£é‡Šå™¨æ¨¡å¼çš„ä»£ç å®ç°æ¯”è¾ƒçµæ´»ï¼Œæ²¡æœ‰å›ºå®šçš„æ¨¡æ¿ã€‚æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œåº”ç”¨è®¾è®¡æ¨¡å¼ä¸»è¦æ˜¯åº”å¯¹ä»£ç çš„å¤æ‚æ€§ï¼Œè§£é‡Šå™¨æ¨¡å¼ä¹Ÿä¸ä¾‹å¤–ã€‚å®ƒçš„ä»£ç å®ç°çš„æ ¸å¿ƒæ€æƒ³ï¼Œå°±æ˜¯å°†è¯­æ³•è§£æçš„å·¥ä½œæ‹†åˆ†åˆ°å„ä¸ªå°ç±»ä¸­ï¼Œä»¥æ­¤æ¥é¿å…å¤§è€Œå…¨çš„è§£æç±»ã€‚ä¸€èˆ¬çš„åšæ³•æ˜¯ï¼Œå°†è¯­æ³•è§„åˆ™æ‹†åˆ†ä¸€äº›å°çš„ç‹¬ç«‹çš„å•å…ƒï¼Œç„¶åå¯¹æ¯ä¸ªå•å…ƒè¿›è¡Œè§£æï¼Œæœ€ç»ˆåˆå¹¶ä¸ºå¯¹æ•´ä¸ªè¯­æ³•è§„åˆ™çš„è§£æã€‚</p><h4 id="11-ä¸­ä»‹æ¨¡å¼"><a href="#11-ä¸­ä»‹æ¨¡å¼" class="headerlink" title="11. ä¸­ä»‹æ¨¡å¼"></a>11. ä¸­ä»‹æ¨¡å¼</h4><p>ä¸­ä»‹æ¨¡å¼çš„è®¾è®¡æ€æƒ³è·Ÿä¸­é—´å±‚å¾ˆåƒï¼Œé€šè¿‡å¼•å…¥ä¸­ä»‹è¿™ä¸ªä¸­é—´å±‚ï¼Œå°†ä¸€ç»„å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼ˆæˆ–è€…è¯´ä¾èµ–å…³ç³»ï¼‰ä»å¤šå¯¹å¤šï¼ˆç½‘çŠ¶å…³ç³»ï¼‰è½¬æ¢ä¸ºä¸€å¯¹å¤šï¼ˆæ˜ŸçŠ¶å…³ç³»ï¼‰ã€‚åŸæ¥ä¸€ä¸ªå¯¹è±¡è¦è·Ÿ n ä¸ªå¯¹è±¡äº¤äº’ï¼Œç°åœ¨åªéœ€è¦è·Ÿä¸€ä¸ªä¸­ä»‹å¯¹è±¡äº¤äº’ï¼Œä»è€Œæœ€å°åŒ–å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œé™ä½äº†ä»£ç çš„å¤æ‚åº¦ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼å’Œä¸­ä»‹æ¨¡å¼éƒ½æ˜¯ä¸ºäº†å®ç°å‚ä¸è€…ä¹‹é—´çš„è§£è€¦ï¼Œç®€åŒ–äº¤äº’å…³ç³»ã€‚ä¸¤è€…çš„ä¸åŒåœ¨äºåº”ç”¨åœºæ™¯ä¸Šã€‚åœ¨è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå‚ä¸è€…ä¹‹é—´çš„äº¤äº’æ¯”è¾ƒæœ‰æ¡ç†ï¼Œä¸€èˆ¬éƒ½æ˜¯å•å‘çš„ï¼Œä¸€ä¸ªå‚ä¸è€…åªæœ‰ä¸€ä¸ªèº«ä»½ï¼Œè¦ä¹ˆæ˜¯è§‚å¯Ÿè€…ï¼Œè¦ä¹ˆæ˜¯è¢«è§‚å¯Ÿè€…ã€‚è€Œåœ¨ä¸­ä»‹æ¨¡å¼çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå‚ä¸è€…ä¹‹é—´çš„äº¤äº’å…³ç³»é”™ç»¼å¤æ‚ï¼Œæ—¢å¯ä»¥æ˜¯æ¶ˆæ¯çš„å‘é€è€…ã€ä¹Ÿå¯ä»¥åŒæ—¶æ˜¯æ¶ˆæ¯çš„æ¥æ”¶è€…ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
            <tag> æå®¢æ—¶é—´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°</title>
      <link href="yi-xian-shu-ju-ku-gong-cheng-shi-dai-ni-shen-ru-li-jie-mysql-xue-xi-bi-ji/"/>
      <url>yi-xian-shu-ju-ku-gong-cheng-shi-dai-ni-shen-ru-li-jie-mysql-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<hr><p>ç¬¬1ç«  SQLä¼˜åŒ–</p><h2 id="01-å¼€ç¯‡è¯"><a href="#01-å¼€ç¯‡è¯" class="headerlink" title="01 å¼€ç¯‡è¯"></a><strong>01 å¼€ç¯‡è¯</strong></h2><h3 id="3-æå‡-MySQL-æ°´å¹³çš„æ–¹å¼"><a href="#3-æå‡-MySQL-æ°´å¹³çš„æ–¹å¼" class="headerlink" title="3 æå‡ MySQL æ°´å¹³çš„æ–¹å¼"></a>3 æå‡ MySQL æ°´å¹³çš„æ–¹å¼</h3><p>å¦‚æœä½ æ²¡æœ‰ MySQL çš„åŸºç¡€ï¼Œå»ºè®®å¯ä»¥çœ‹ä¸‹é¢ä¸¤æœ¬ä¹¦ç±ï¼Œçœ‹å®Œä¹‹åï¼Œå¯ä»¥ç®€å•å¤„ç†ä¸€äº›ä¼˜åŒ–ï¼š</p><ul><li>ã€ŠMySQL å¿…çŸ¥å¿…ä¼šã€‹ï¼šä¸»è¦è®² SQL çš„å†™æ³•ï¼›</li><li>ã€Šæ·±å…¥æµ…å‡º MySQLã€‹ï¼šæ¯”è¾ƒå…¨é¢çš„è®²è§£äº† MySQL çš„åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿæ¶‰åŠäº†ä¸€äº›ä¼˜åŒ–ã€‚</li></ul><p>å¦‚æœå·²ç»å¯¹ MySQL æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„ä¹¦ç±ï¼Œä½ ä¼šå¯¹ç´¢å¼•å’Œé”ä»¥åŠäº‹åŠ¡ç­‰æœ‰å…¨æ–°çš„çœ‹æ³•ï¼š</p><ul><li>ã€Šé«˜æ€§èƒ½ MySQLã€‹ï¼šé‡Œé¢è®²äº†å¾ˆå¤š MySQL ä¼˜åŒ–æŠ€å·§ï¼›</li><li>ã€ŠMySQL æŠ€æœ¯å†…å¹•ã€‹ï¼šè®²è§£äº†å¾ˆå¤š MySQL åŸç†ï¼Œå¼ºåŠ›æ¨èç»™æƒ³æ·±å…¥å­¦ä¹  MySQL çš„åŒå­¦ï¼›</li><li>ã€ŠMySQL å†…æ ¸ï¼šInnoDB å­˜å‚¨å¼•æ“ã€‹ï¼šæƒ³æ·±å…¥ç ”ç©¶ MySQL å†…æ ¸åŠåŸç†çš„å¯ä»¥çœ‹çœ‹ï¼›</li><li>ã€ŠMySQL è¿ç»´å†…å‚ã€‹ï¼šå¯¹ MySQL æºç æ„Ÿå…´è¶£ï¼Œå¯ä»¥å…¥æ‰‹ï¼›</li><li>ã€ŠMySQL Internals Manualã€‹<a href="https://dev.mysql.com/doc/internals/en/">https://dev.mysql.com/doc/internals/en/</a> ï¼›</li><li>ã€ŠMySQL 5.7 Reference Manualã€‹<a href="https://dev.mysql.com/doc/refman/5.7/en/">https://dev.mysql.com/doc/refman/5.7/en/</a> ã€‚</li></ul><h3 id="4-å­¦ä¹ æœ¬ä¸“æ å‰çš„æé†’"><a href="#4-å­¦ä¹ æœ¬ä¸“æ å‰çš„æé†’" class="headerlink" title="4 å­¦ä¹ æœ¬ä¸“æ å‰çš„æé†’"></a>4 å­¦ä¹ æœ¬ä¸“æ å‰çš„æé†’</h3><p><strong>æœ¬ä¸“æ é»˜è®¤ä½¿ç”¨çš„ MySQL ç‰ˆæœ¬ä¸º 5.7.21ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º RRï¼Œè¡¨çš„å­˜å‚¨å¼•æ“ä¸º InnoDBã€‚</strong></p><h2 id="02-å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸Šï¼‰"><a href="#02-å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸Šï¼‰" class="headerlink" title="02 å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸Šï¼‰"></a><strong>02 å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸Šï¼‰</strong></h2><h3 id="1-å®šä½æ…¢-SQL"><a href="#1-å®šä½æ…¢-SQL" class="headerlink" title="1 å®šä½æ…¢ SQL"></a>1 å®šä½æ…¢ SQL</h3><h4 id="1-1-é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#1-1-é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="1.1 é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—"></a>1.1 é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—</h4><p>MySQL çš„æ…¢æŸ¥è¯¢æ—¥å¿—ç”¨æ¥è®°å½•åœ¨ MySQL ä¸­å“åº”æ—¶é—´è¶…è¿‡å‚æ•° long_query_timeï¼ˆå•ä½ç§’ï¼Œé»˜è®¤å€¼ 10ï¼‰è®¾ç½®çš„å€¼å¹¶ä¸”æ‰«æè®°å½•æ•°ä¸å°äº min_examined_row_limitï¼ˆé»˜è®¤å€¼0ï¼‰çš„è¯­å¥ã€‚</p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ä¸ä¼šè®°å½•ç®¡ç†è¯­å¥ï¼Œå¯é€šè¿‡è®¾ç½® log_slow_admin_statements = on è®©ç®¡ç†è¯­å¥ä¸­çš„æ…¢æŸ¥è¯¢ä¹Ÿä¼šè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¹Ÿä¸ä¼šè®°å½•æŸ¥è¯¢æ—¶é—´ä¸è¶…è¿‡ long_query_time ä½†æ˜¯ä¸ä½¿ç”¨ç´¢å¼•çš„è¯­å¥ï¼Œå¯é€šè¿‡é…ç½®log_queries_not_using_indexes = on è®©ä¸ä½¿ç”¨ç´¢å¼•çš„ SQL éƒ½è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼ˆå³ä½¿æŸ¥è¯¢æ—¶é—´æ²¡è¶…è¿‡ long_query_time é…ç½®çš„å€¼ï¼‰ã€‚</p></blockquote><p>ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li><p>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log <span class="token operator">=</span> <span class="token keyword">on</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è®¾ç½®æ…¢æŸ¥è¯¢é˜€å€¼</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> long_query_time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ç¡®å®šæ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">"datadir"</span><span class="token punctuation">;</span> <span class="token comment">/* æ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½• */</span><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">"slow_query_log_file"</span><span class="token punctuation">;</span>  <span class="token comment">/* æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ–‡ä»¶å */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h4 id="1-2-é€šè¿‡-show-processlist"><a href="#1-2-é€šè¿‡-show-processlist" class="headerlink" title="1.2 é€šè¿‡ show processlist"></a>1.2 é€šè¿‡ show processlist</h4><p>æœ‰æ—¶æ…¢æŸ¥è¯¢æ­£åœ¨æ‰§è¡Œï¼Œå·²ç»å¯¼è‡´æ•°æ®åº“è´Ÿè½½åé«˜äº†ï¼Œè€Œç”±äºæ…¢æŸ¥è¯¢è¿˜æ²¡æ‰§è¡Œå®Œï¼Œå› æ­¤æ…¢æŸ¥è¯¢æ—¥å¿—è¿˜çœ‹ä¸åˆ°ä»»ä½•è¯­å¥ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>show processlist</code> å‘½ä»¤åˆ¤æ–­æ­£åœ¨æ‰§è¡Œçš„æ…¢æŸ¥è¯¢ã€‚ <code>show processlist</code> æ˜¾ç¤ºå“ªäº›çº¿ç¨‹æ­£åœ¨è¿è¡Œã€‚å¦‚æœæœ‰ PROCESS æƒé™ï¼Œåˆ™å¯ä»¥çœ‹åˆ°æ‰€æœ‰çº¿ç¨‹ã€‚å¦åˆ™ï¼Œåªèƒ½çœ‹åˆ°å½“å‰ä¼šè¯çš„çº¿ç¨‹ã€‚</p><blockquote><p>å¦‚æœä¸ä½¿ç”¨ FULL å…³é”®å­—ï¼Œåœ¨ info å­—æ®µä¸­åªæ˜¾ç¤ºæ¯ä¸ªè¯­å¥çš„å‰ 100 ä¸ªå­—ç¬¦ï¼Œå¦‚æœæƒ³çœ‹è¯­å¥çš„å…¨éƒ¨å†…å®¹å¯ä»¥ä½¿ç”¨ full ä¿®é¥°ï¼ˆ<code>show full processlist</code>ï¼‰ã€‚</p></blockquote><h3 id="2-ä½¿ç”¨-explain-åˆ†ææ…¢æŸ¥è¯¢"><a href="#2-ä½¿ç”¨-explain-åˆ†ææ…¢æŸ¥è¯¢" class="headerlink" title="2 ä½¿ç”¨ explain åˆ†ææ…¢æŸ¥è¯¢"></a>2 ä½¿ç”¨ explain åˆ†ææ…¢æŸ¥è¯¢</h3><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œå…ˆåˆ›å»ºä¸¤å¼ æµ‹è¯•è¡¨</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> muke<span class="token punctuation">;</span>           <span class="token comment">/* åˆ›å»ºæµ‹è¯•ä½¿ç”¨çš„databaseï¼Œåä¸ºmuke */</span><span class="token keyword">use</span> muke<span class="token punctuation">;</span>                       <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t1<span class="token punctuation">;</span>        <span class="token comment">/* å¦‚æœè¡¨t1å­˜åœ¨åˆ™åˆ é™¤è¡¨t1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t1<span class="token punctuation">`</span> <span class="token punctuation">(</span>             <span class="token comment">/* åˆ›å»ºè¡¨t1 */</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•åˆ›å»ºæ—¶é—´'</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•æ›´æ–°æ—¶é—´'</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">begin</span>    <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>                    <span class="token comment">/* å£°æ˜å˜é‡i */</span>    <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                          <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token keyword">do</span>                  <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=1000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span>        <span class="token keyword">insert</span> <span class="token keyword">into</span> t1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t1ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span>        <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                      <span class="token comment">/* å°†iåŠ 1 */</span>    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span>                 <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥1000æ¡æ•°æ®åˆ°è¡¨t1çš„å­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">call</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t2<span class="token punctuation">;</span>    <span class="token comment">/* å¦‚æœè¡¨t2å­˜åœ¨åˆ™åˆ é™¤è¡¨t2 */</span><span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t1<span class="token punctuation">;</span>    <span class="token comment">/* åˆ›å»ºè¡¨t2ï¼Œè¡¨ç»“æ„ä¸t1ä¸€è‡´ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>   <span class="token comment">/* å°†è¡¨t1çš„æ•°æ®å¯¼å…¥åˆ°t2 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹é¢å°è¯•ä½¿ç”¨ explain åˆ†æä¸€æ¡ SQLï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> b<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ°</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+|  1 | SIMPLE      | t1    | NULL       | ref  | idx_b         | idx_b | 5       | const |    1 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Explain çš„ç»“æœå„å­—æ®µè§£é‡Šå¦‚ä¸‹ï¼ˆåŠ ç²—çš„åˆ—ä¸ºéœ€è¦é‡ç‚¹å…³æ³¨çš„é¡¹ï¼‰ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">åˆ—å</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">id</td><td style="text-align:left">æŸ¥è¯¢ç¼–å·</td></tr><tr><td style="text-align:left"><strong>select_type</strong></td><td style="text-align:left">æŸ¥è¯¢ç±»å‹ï¼šæ˜¾ç¤ºæœ¬è¡Œæ˜¯ç®€å•è¿˜æ˜¯å¤æ‚æŸ¥è¯¢</td></tr><tr><td style="text-align:left">table</td><td style="text-align:left">æ¶‰åŠåˆ°çš„è¡¨</td></tr><tr><td style="text-align:left">partitions</td><td style="text-align:left">åŒ¹é…çš„åˆ†åŒºï¼šæŸ¥è¯¢å°†åŒ¹é…è®°å½•æ‰€åœ¨çš„åˆ†åŒºã€‚ä»…å½“ä½¿ç”¨ partition å…³é”®å­—æ—¶æ‰æ˜¾ç¤ºè¯¥åˆ—ã€‚å¯¹äºéåˆ†åŒºè¡¨ï¼Œè¯¥å€¼ä¸º NULLã€‚</td></tr><tr><td style="text-align:left"><strong>type</strong></td><td style="text-align:left">æœ¬æ¬¡æŸ¥è¯¢çš„è¡¨è¿æ¥ç±»å‹</td></tr><tr><td style="text-align:left">possible_keys</td><td style="text-align:left">å¯èƒ½é€‰æ‹©çš„ç´¢å¼•</td></tr><tr><td style="text-align:left"><strong>key</strong></td><td style="text-align:left">å®é™…é€‰æ‹©çš„ç´¢å¼•</td></tr><tr><td style="text-align:left">key_len</td><td style="text-align:left">è¢«é€‰æ‹©çš„ç´¢å¼•é•¿åº¦ï¼šä¸€èˆ¬ç”¨äºåˆ¤æ–­è”åˆç´¢å¼•æœ‰å¤šå°‘åˆ—è¢«é€‰æ‹©äº†</td></tr><tr><td style="text-align:left">ref</td><td style="text-align:left">ä¸ç´¢å¼•æ¯”è¾ƒçš„åˆ—</td></tr><tr><td style="text-align:left"><strong>rows</strong></td><td style="text-align:left">é¢„è®¡éœ€è¦æ‰«æçš„è¡Œæ•°ï¼Œå¯¹ InnoDB æ¥è¯´ï¼Œè¿™ä¸ªå€¼æ˜¯ä¼°å€¼ï¼Œå¹¶ä¸ä¸€å®šå‡†ç¡®</td></tr><tr><td style="text-align:left">filtered</td><td style="text-align:left">æŒ‰æ¡ä»¶ç­›é€‰çš„è¡Œçš„ç™¾åˆ†æ¯”</td></tr><tr><td style="text-align:left"><strong>Extra</strong></td><td style="text-align:left">é™„åŠ ä¿¡æ¯</td></tr></tbody></table></div><p>è¿™é‡Œä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦åˆ—å¸¸åŒ…å«çš„å€¼ï¼š</p><h4 id="2-1-select-type"><a href="#2-1-select-type" class="headerlink" title="2.1 select_type"></a>2.1 select_type</h4><div class="table-container"><table><thead><tr><th style="text-align:left">select_type çš„å€¼</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">SIMPLE</td><td style="text-align:left">ç®€å•æŸ¥è¯¢(ä¸ä½¿ç”¨å…³è”æŸ¥è¯¢æˆ–å­æŸ¥è¯¢)</td></tr><tr><td style="text-align:left">PRIMARY</td><td style="text-align:left">å¦‚æœåŒ…å«å…³è”æŸ¥è¯¢æˆ–è€…å­æŸ¥è¯¢ï¼Œåˆ™æœ€å¤–å±‚çš„æŸ¥è¯¢éƒ¨åˆ†æ ‡è®°ä¸ºprimary</td></tr><tr><td style="text-align:left">UNION</td><td style="text-align:left">è”åˆæŸ¥è¯¢ä¸­ç¬¬äºŒä¸ªåŠåé¢çš„æŸ¥è¯¢</td></tr><tr><td style="text-align:left">DEPENDENT UNION</td><td style="text-align:left">æ»¡è¶³ä¾èµ–å¤–éƒ¨çš„å…³è”æŸ¥è¯¢ä¸­ç¬¬äºŒä¸ªåŠä»¥åçš„æŸ¥è¯¢</td></tr><tr><td style="text-align:left">UNION RESULT</td><td style="text-align:left">è”åˆæŸ¥è¯¢çš„ç»“æœ</td></tr><tr><td style="text-align:left">SUBQUERY</td><td style="text-align:left">å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªæŸ¥è¯¢</td></tr><tr><td style="text-align:left">DEPENDENT SUBQUERY</td><td style="text-align:left">å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼Œå¹¶ä¸”ä¾èµ–å¤–éƒ¨æŸ¥è¯¢</td></tr><tr><td style="text-align:left">DERIVED</td><td style="text-align:left">ç”¨åˆ°æ´¾ç”Ÿè¡¨çš„æŸ¥è¯¢</td></tr><tr><td style="text-align:left">MATERIALIZED</td><td style="text-align:left">è¢«ç‰©åŒ–çš„å­æŸ¥è¯¢</td></tr><tr><td style="text-align:left">UNCACHEABLE SUBQUERY</td><td style="text-align:left">ä¸€ä¸ªå­æŸ¥è¯¢çš„ç»“æœä¸èƒ½è¢«ç¼“å­˜ï¼Œå¿…é¡»é‡æ–°è¯„ä¼°å¤–å±‚æŸ¥è¯¢çš„æ¯ä¸€è¡Œ</td></tr><tr><td style="text-align:left">UNCACHEABLE UNION</td><td style="text-align:left">å…³è”æŸ¥è¯¢ç¬¬äºŒä¸ªæˆ–åé¢çš„è¯­å¥å±äºä¸å¯ç¼“å­˜çš„å­æŸ¥è¯¢</td></tr></tbody></table></div><h4 id="2-2-type"><a href="#2-2-type" class="headerlink" title="2.2 type"></a>2.2 type</h4><div class="table-container"><table><thead><tr><th style="text-align:left">typeçš„å€¼</th><th style="text-align:left">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">system</td><td style="text-align:left">æŸ¥è¯¢å¯¹è±¡è¡¨åªæœ‰ä¸€è¡Œæ•°æ®,ä¸”åªèƒ½ç”¨äº MyISAM å’Œ Memory å¼•æ“çš„è¡¨ï¼Œè¿™æ˜¯æœ€å¥½çš„æƒ…å†µ</td></tr><tr><td style="text-align:left">const</td><td style="text-align:left">åŸºäºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ï¼Œæœ€å¤šè¿”å›ä¸€æ¡ç»“æœ</td></tr><tr><td style="text-align:left">eq_ref</td><td style="text-align:left">è¡¨è¿æ¥æ—¶åŸºäºä¸»é”®æˆ–é NULL çš„å”¯ä¸€ç´¢å¼•å®Œæˆæ‰«æ</td></tr><tr><td style="text-align:left">ref</td><td style="text-align:left">åŸºäºæ™®é€šç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼Œæˆ–è€…è¡¨é—´ç­‰å€¼è¿æ¥</td></tr><tr><td style="text-align:left">fulltext</td><td style="text-align:left">å…¨æ–‡æ£€ç´¢</td></tr><tr><td style="text-align:left">ref_or_null</td><td style="text-align:left">è¡¨è¿æ¥ç±»å‹æ˜¯ refï¼Œä½†è¿›è¡Œæ‰«æçš„ç´¢å¼•åˆ—ä¸­å¯èƒ½åŒ…å« NULL å€¼</td></tr><tr><td style="text-align:left">index_merge</td><td style="text-align:left">åˆ©ç”¨å¤šä¸ªç´¢å¼•</td></tr><tr><td style="text-align:left">unique_subquery</td><td style="text-align:left">å­æŸ¥è¯¢ä¸­ä½¿ç”¨å”¯ä¸€ç´¢å¼•</td></tr><tr><td style="text-align:left">index_subquery</td><td style="text-align:left">å­æŸ¥è¯¢ä¸­ä½¿ç”¨æ™®é€šç´¢å¼•</td></tr><tr><td style="text-align:left">range</td><td style="text-align:left">åˆ©ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</td></tr><tr><td style="text-align:left">index</td><td style="text-align:left">å…¨ç´¢å¼•æ‰«æ</td></tr><tr><td style="text-align:left">ALL</td><td style="text-align:left">å…¨è¡¨æ‰«æ</td></tr></tbody></table></div><blockquote><p><strong>ä¸Šè¡¨çš„è¿™äº›æƒ…å†µï¼ŒæŸ¥è¯¢æ€§èƒ½ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯æœ€å¥½åˆ°æœ€å·®ã€‚</strong></p></blockquote><h4 id="2-3-Extra"><a href="#2-3-Extra" class="headerlink" title="2.3 Extra"></a>2.3 Extra</h4><div class="table-container"><table><thead><tr><th style="text-align:left">Extra å¸¸è§çš„å€¼</th><th style="text-align:left">è§£é‡Š</th><th style="text-align:left">ä¾‹å­</th></tr></thead><tbody><tr><td style="text-align:left">Using filesort</td><td style="text-align:left">å°†ç”¨å¤–éƒ¨æ’åºè€Œä¸æ˜¯ç´¢å¼•æ’åºï¼Œæ•°æ®è¾ƒå°æ—¶ä»å†…å­˜æ’åºï¼Œå¦åˆ™éœ€è¦åœ¨ç£ç›˜å®Œæˆæ’åº</td><td style="text-align:left">explain select * from t1 order by create_time;</td></tr><tr><td style="text-align:left">Using temporary</td><td style="text-align:left">éœ€è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨æ¥å­˜å‚¨ç»“æ„ï¼Œé€šå¸¸å‘ç”Ÿå¯¹æ²¡æœ‰ç´¢å¼•çš„åˆ—è¿›è¡Œ GROUP BY æ—¶</td><td style="text-align:left">explain select * from t1 group by create_time;</td></tr><tr><td style="text-align:left">Using index</td><td style="text-align:left">ä½¿ç”¨è¦†ç›–ç´¢å¼•</td><td style="text-align:left">explain select a from t1 where a=111;</td></tr><tr><td style="text-align:left">Using where</td><td style="text-align:left">ä½¿ç”¨ where è¯­å¥æ¥å¤„ç†ç»“æœ</td><td style="text-align:left">explain select * from t1 where create_time=â€™2019-06-18 14:38:24â€™;</td></tr><tr><td style="text-align:left">Impossible WHERE</td><td style="text-align:left">å¯¹ where å­å¥åˆ¤æ–­çš„ç»“æœæ€»æ˜¯ false è€Œä¸èƒ½é€‰æ‹©ä»»ä½•æ•°æ®</td><td style="text-align:left">explain select * from t1 where 1&lt;0;</td></tr><tr><td style="text-align:left">Using join buffer (Block Nested Loop)</td><td style="text-align:left">å…³è”æŸ¥è¯¢ä¸­ï¼Œè¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µæ²¡ç´¢å¼•</td><td style="text-align:left">explain select * from t1 straight_join t2 on (t1.create_time=t2.create_time);</td></tr><tr><td style="text-align:left">Using index condition</td><td style="text-align:left">å…ˆæ¡ä»¶è¿‡æ»¤ç´¢å¼•ï¼Œå†æŸ¥æ•°æ®</td><td style="text-align:left">explain select * from t1 where a &gt;900 and a like â€œ%9â€;</td></tr><tr><td style="text-align:left">Select tables optimized away</td><td style="text-align:left">ä½¿ç”¨æŸäº›èšåˆå‡½æ•°ï¼ˆæ¯”å¦‚ maxã€minï¼‰æ¥è®¿é—®å­˜åœ¨ç´¢å¼•çš„æŸä¸ªå­—æ®µæ˜¯</td><td style="text-align:left">explain select max(a) from t1;</td></tr></tbody></table></div><h2 id="03-å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸‹ï¼‰"><a href="#03-å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸‹ï¼‰" class="headerlink" title="03 å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸‹ï¼‰"></a><strong>03 å¿«é€Ÿå­¦ä¼šåˆ†æSQLæ‰§è¡Œæ•ˆç‡ï¼ˆä¸‹ï¼‰</strong></h2><h3 id="1-show-profile-åˆ†ææ…¢æŸ¥è¯¢"><a href="#1-show-profile-åˆ†ææ…¢æŸ¥è¯¢" class="headerlink" title="1 show profile åˆ†ææ…¢æŸ¥è¯¢"></a>1 show profile åˆ†ææ…¢æŸ¥è¯¢</h3><p>æœ‰æ—¶éœ€è¦ç¡®å®š SQL åˆ°åº•æ…¢åœ¨å“ªä¸ªç¯èŠ‚ï¼Œæ­¤æ—¶ explain å¯èƒ½ä¸å¥½ç¡®å®šã€‚åœ¨ MySQL æ•°æ®åº“ä¸­ï¼Œé€šè¿‡ profileï¼Œèƒ½å¤Ÿæ›´æ¸…æ¥šåœ°äº†è§£ SQL æ‰§è¡Œè¿‡ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œèƒ½è®©æˆ‘ä»¬çŸ¥é“åˆ°åº•æ…¢åœ¨å“ªä¸ªç¯èŠ‚ã€‚</p><blockquote><p>å¯ä»¥é€šè¿‡é…ç½®å‚æ•° profiling = 1 æ¥å¯ç”¨ SQL åˆ†æã€‚è¯¥å‚æ•°å¯ä»¥åœ¨å…¨å±€å’Œ session çº§åˆ«æ¥è®¾ç½®ã€‚</p></blockquote><p>ä½¿ç”¨ profile åˆ†ææ…¢æŸ¥è¯¢çš„å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p><h4 id="1-1-ç¡®å®šæ˜¯å¦æ”¯æŒ-profile"><a href="#1-1-ç¡®å®šæ˜¯å¦æ”¯æŒ-profile" class="headerlink" title="1.1 ç¡®å®šæ˜¯å¦æ”¯æŒ profile"></a>1.1 ç¡®å®šæ˜¯å¦æ”¯æŒ profile</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> @<span class="token variable">@have_profiling</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-2-æŸ¥çœ‹-profiling-æ˜¯å¦å…³é—­çš„"><a href="#1-2-æŸ¥çœ‹-profiling-æ˜¯å¦å…³é—­çš„" class="headerlink" title="1.2 æŸ¥çœ‹ profiling æ˜¯å¦å…³é—­çš„"></a>1.2 æŸ¥çœ‹ profiling æ˜¯å¦å…³é—­çš„</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> @<span class="token variable">@profiling</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-3-é€šè¿‡-set-å¼€å¯-profile"><a href="#1-3-é€šè¿‡-set-å¼€å¯-profile" class="headerlink" title="1.3 é€šè¿‡ set å¼€å¯ profile"></a>1.3 é€šè¿‡ set å¼€å¯ profile</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> profiling<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-4-æ‰§è¡Œ-SQL-è¯­å¥"><a href="#1-4-æ‰§è¡Œ-SQL-è¯­å¥" class="headerlink" title="1.4 æ‰§è¡Œ SQL è¯­å¥"></a>1.4 æ‰§è¡Œ SQL è¯­å¥</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> b<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-5-ç¡®å®š-SQL-çš„-query-id"><a href="#1-5-ç¡®å®š-SQL-çš„-query-id" class="headerlink" title="1.5 ç¡®å®š SQL çš„ query id"></a>1.5 ç¡®å®š SQL çš„ query id</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> profiles<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----------+------------+-------------------------------+| Query_ID | Duration   | Query                         |+----------+------------+-------------------------------+|        1 | 0.00982500 | select * from t1 where b=1000 |+----------+------------+-------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-6-æŸ¥è¯¢-SQL-æ‰§è¡Œè¯¦æƒ…"><a href="#1-6-æŸ¥è¯¢-SQL-æ‰§è¡Œè¯¦æƒ…" class="headerlink" title="1.6 æŸ¥è¯¢ SQL æ‰§è¡Œè¯¦æƒ…"></a>1.6 æŸ¥è¯¢ SQL æ‰§è¡Œè¯¦æƒ…</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+--------------------------------+----------+| Status                         | Duration |+--------------------------------+----------+| starting                       | 0.001746 || Executing hook on transaction  | 0.000089 || starting                       | 0.000107 || checking permissions           | 0.000120 || Opening tables                 | 0.001553 || init                           | 0.000254 || System lock                    | 0.000276 || optimizing                     | 0.000291 || statistics                     | 0.002640 || preparing                      | 0.000235 || executing                      | 0.001847 || end                            | 0.000133 || query end                      | 0.000031 || waiting for handler commit     | 0.000090 || closing tables                 | 0.000110 || freeing items                  | 0.000242 || cleaning up                    | 0.000062 |+--------------------------------+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-trace-åˆ†æ-SQL-ä¼˜åŒ–å™¨"><a href="#2-trace-åˆ†æ-SQL-ä¼˜åŒ–å™¨" class="headerlink" title="2 trace åˆ†æ SQL ä¼˜åŒ–å™¨"></a>2 trace åˆ†æ SQL ä¼˜åŒ–å™¨</h3><p>ä»å‰é¢å­¦åˆ°äº† explain å¯ä»¥æŸ¥çœ‹ SQL æ‰§è¡Œè®¡åˆ’ï¼Œä½†æ˜¯æ— æ³•çŸ¥é“å®ƒä¸ºä»€ä¹ˆåšè¿™ä¸ªå†³ç­–ï¼Œå¦‚æœæƒ³ç¡®å®šå¤šç§ç´¢å¼•æ–¹æ¡ˆä¹‹é—´æ˜¯å¦‚ä½•é€‰æ‹©çš„æˆ–è€…æ’åºæ—¶é€‰æ‹©çš„æ˜¯å“ªç§æ’åºæ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨ trace æŸ¥çœ‹ä¼˜åŒ–å™¨å¦‚ä½•é€‰æ‹©æ‰§è¡Œè®¡åˆ’ã€‚</p><p>å¦‚æœéœ€è¦ä½¿ç”¨ï¼Œå…ˆå¼€å¯ traceï¼Œè®¾ç½®æ ¼å¼ä¸º JSONï¼Œå†æ‰§è¡Œéœ€è¦åˆ†æçš„ SQLï¼Œæœ€åæŸ¥çœ‹ trace åˆ†æç»“æœï¼ˆåœ¨ information_schema.OPTIMIZER_TRACE ä¸­ï¼‰ã€‚</p><p>å¼€å¯è¯¥åŠŸèƒ½ï¼Œä¼šå¯¹ MySQL æ€§èƒ½æœ‰æ‰€å½±å“ï¼Œå› æ­¤åªå»ºè®®åˆ†æé—®é¢˜æ—¶ä¸´æ—¶å¼€å¯ã€‚</p><p>ä¸‹é¢ä¸€èµ·æ¥çœ‹ä¸‹ trace çš„ä½¿ç”¨æ–¹æ³•ã€‚ä½¿ç”¨è®²è§£ explain æ—¶åˆ›å»ºçš„è¡¨t1åšå®éªŒã€‚</p><p>é¦–å…ˆæ„é€ å¦‚ä¸‹ SQL (è¡¨ç¤ºå–å‡ºè¡¨ t1 ä¸­ a çš„å€¼å¤§äº 900 å¹¶ä¸” b çš„å€¼å¤§äº 910 çš„æ•°æ®ï¼Œç„¶åæŒ‰ç…§ a å­—æ®µæ’åº)ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a <span class="token operator">&gt;</span><span class="token number">900</span> <span class="token operator">and</span> b <span class="token operator">&gt;</span> <span class="token number">910</span> <span class="token keyword">order</span>  <span class="token keyword">by</span> a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬é¦–å…ˆç”¨ explain åˆ†æä¸‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a <span class="token operator">&gt;</span><span class="token number">900</span> <span class="token operator">and</span> b <span class="token operator">&gt;</span> <span class="token number">910</span> <span class="token keyword">order</span>  <span class="token keyword">by</span> a<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+----------------------------------------------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>   <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                                              <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+----------------------------------------------------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t1    <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> idx_a<span class="token punctuation">,</span>idx_b   <span class="token operator">|</span> idx_b <span class="token operator">|</span> <span class="token number">5</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>   <span class="token number">90</span> <span class="token operator">|</span>    <span class="token number">10.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition<span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> filesort <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+----------------------------------------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä¸Šé¢æ‰§è¡Œè®¡åˆ’ä¸­ key è¿™ä¸ªå­—æ®µå¯ä»¥çœ‹å‡ºï¼Œè¯¥è¯­å¥ä½¿ç”¨çš„æ˜¯ b å­—æ®µçš„ç´¢å¼• idx_bã€‚å®é™…è¡¨ t1 ä¸­ï¼Œaã€b ä¸¤ä¸ªå­—æ®µéƒ½æœ‰ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæ¡ä»¶ä¸­æœ‰è¿™ä¸¤ä¸ªç´¢å¼•å­—æ®µå´ååé€‰äº† b å­—æ®µçš„ç´¢å¼•å‘¢ï¼Ÿè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ trace è¿›è¡Œåˆ†æã€‚å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>å¼€å¯ trace</p>  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">/* optimizer_trace="enabled=on" è¡¨ç¤ºå¼€å¯ traceï¼›end_markers_in_json=on è¡¨ç¤º JSON è¾“å‡ºå¼€å¯ç»“æŸæ ‡è®° */</span><span class="token keyword">set</span> <span class="token keyword">session</span> optimizer_trace<span class="token operator">=</span><span class="token string">"enabled=on"</span><span class="token punctuation">,</span>end_markers_in_json<span class="token operator">=</span><span class="token keyword">on</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>æ‰§è¡Œéœ€è¦åˆ†æçš„ SQL</p>  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a <span class="token operator">&gt;</span><span class="token number">900</span> <span class="token operator">and</span> b <span class="token operator">&gt;</span> <span class="token number">910</span> <span class="token keyword">order</span>  <span class="token keyword">by</span> a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹ trace åˆ†æç»“æœ</p>  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>OPTIMIZER_TRACE\G<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>  ç»“æœå¦‚ä¸‹ï¼š</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">*************************** 1. row ***************************QUERY: select * from t1 where a &gt;900 and b &gt; 910 order  by a    --SQLè¯­å¥TRACE: {    "steps": [        {           "join_preparation": {--SQLå‡†å¤‡é˜¶æ®µ               "select#": 1,               "steps": [                   {                       "expanded_query": "/* select#1 */ select `t1`.`id` AS `id`,`t1`.`a` AS `a`,`t1`.`b` AS `b`,`t1`.`create_time` AS `create_time`,`t1`.`update_time` AS `update_time` from `t1` where ((`t1`.`a` &gt; 900) and (`t1`.`b` &gt; 910)) order by `t1`.`a`"                   }               ] /* steps */           } /* join_preparation */       },        {            "join_optimization": {--SQLä¼˜åŒ–é˜¶æ®µ                "select#": 1,                "steps": [                    {                        "condition_processing": {    --æ¡ä»¶å¤„ç†                            "condition": "WHERE",                            "original_condition": "((`t1`.`a` &gt; 900) and (`t1`.`b` &gt; 910))",        --åŸå§‹æ¡ä»¶                            "steps": [                                {                                    "transformation": "equality_propagation",                                    "resulting_condition": "((`t1`.`a` &gt; 900) and (`t1`.`b` &gt; 910))" --ç­‰å€¼ä¼ é€’è½¬æ¢                                },                                {                                    "transformation": "constant_propagation",                                    "resulting_condition": "((`t1`.`a` &gt; 900) and (`t1`.`b` &gt; 910))"       --å¸¸é‡ä¼ é€’è½¬æ¢                                },                                {                                    "transformation": "trivial_condition_removal",                                    "resulting_condition": "((`t1`.`a` &gt; 900) and (`t1`.`b` &gt; 910))"        --å»é™¤æ²¡æœ‰çš„æ¡ä»¶åçš„ç»“æ„                                }                            ] /* steps */                        } /* condition_processing */                    },                    {                        "substitute_generated_columns": {                        } /* substitute_generated_columns */   --æ›¿æ¢è™šæ‹Ÿç”Ÿæˆåˆ—                    },                    {                        "table_dependencies": [--è¡¨ä¾èµ–è¯¦æƒ…                            {                                "table": "`t1`",                                "row_may_be_null": false,                                "map_bit": 0,                                "depends_on_map_bits": [                                ] /* depends_on_map_bits */                            }                        ] /* table_dependencies */                    },                    {                        "ref_optimizer_key_uses": [                        ] /* ref_optimizer_key_uses */                    },                    {                        "rows_estimation": [--é¢„ä¼°è¡¨çš„è®¿é—®æˆæœ¬                            {                                "table": "`t1`",                                "range_analysis": {                                    "table_scan": {                                        "rows": 1000,       --æ‰«æè¡Œæ•°                                        "cost": 207.1       --æˆæœ¬                                    } /* table_scan */,                                    "potential_range_indexes": [    --åˆ†æå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•                                        {                                            "index": "PRIMARY",                                            "usable": false,       --ä¸ºfalseï¼Œè¯´æ˜ä¸»é”®ç´¢å¼•ä¸å¯ç”¨                                            "cause": "not_applicable"                                        },                                        {                                            "index": "idx_a",      --å¯èƒ½ä½¿ç”¨ç´¢å¼•idx_a                                            "usable": true,                                            "key_parts": [                                                "a",                                                "id"                                            ] /* key_parts */                                        },                                        {                                            "index": "idx_b",      --å¯èƒ½ä½¿ç”¨ç´¢å¼•idx_b                                            "usable": true,                                            "key_parts": [                                                "b",                                                "id"                                            ] /* key_parts */                                        }                                    ] /* potential_range_indexes */,                                    "setup_range_conditions": [                                    ] /* setup_range_conditions */,                                    "group_index_range": {                                        "chosen": false,                                        "cause": "not_group_by_or_distinct"                                    } /* group_index_range */,                                    "analyzing_range_alternatives": { --åˆ†æå„ç´¢å¼•çš„æˆæœ¬                                        "range_scan_alternatives": [                                            {                                                "index": "idx_a",--ä½¿ç”¨ç´¢å¼•idx_açš„æˆæœ¬                                                "ranges": [                                                    "900 &lt; a"--ä½¿ç”¨ç´¢å¼•idx_açš„èŒƒå›´                                                ] /* ranges */,                                                "index_dives_for_eq_ranges": true, --æ˜¯å¦ä½¿ç”¨index diveï¼ˆè¯¦ç»†æè¿°è¯·çœ‹ä¸‹æ–¹çš„çŸ¥è¯†æ‰©å±•ï¼‰                                                "rowid_ordered": false, --ä½¿ç”¨è¯¥ç´¢å¼•è·å–çš„è®°å½•æ˜¯å¦æŒ‰ç…§ä¸»é”®æ’åº                                                "using_mrr": false,  --æ˜¯å¦ä½¿ç”¨mrr                                                "index_only": false,    --æ˜¯å¦ä½¿ç”¨è¦†ç›–ç´¢å¼•                                                "rows": 100,            --ä½¿ç”¨è¯¥ç´¢å¼•è·å–çš„è®°å½•æ•°                                                "cost": 121.01,         --ä½¿ç”¨è¯¥ç´¢å¼•çš„æˆæœ¬                                                "chosen": true          --å¯èƒ½é€‰æ‹©è¯¥ç´¢å¼•                                            },                                            {                                                "index": "idx_b",       --ä½¿ç”¨ç´¢å¼•idx_bçš„æˆæœ¬                                                "ranges": [                                                    "910 &lt; b"                                                ] /* ranges */,                                                "index_dives_for_eq_ranges": true,                                                "rowid_ordered": false,                                                "using_mrr": false,                                                "index_only": false,                                                "rows": 90,                                                "cost": 109.01,                                                "chosen": true             --ä¹Ÿå¯èƒ½é€‰æ‹©è¯¥ç´¢å¼•                                            }                                        ] /* range_scan_alternatives */,                                        "analyzing_roworder_intersect": { --åˆ†æä½¿ç”¨ç´¢å¼•åˆå¹¶çš„æˆæœ¬                                            "usable": false,                                            "cause": "too_few_roworder_scans"                                        } /* analyzing_roworder_intersect */                                    } /* analyzing_range_alternatives */,                                    "chosen_range_access_summary": {  --ç¡®è®¤æœ€ä¼˜æ–¹æ³•                                        "range_access_plan": {                                            "type": "range_scan",                                            "index": "idx_b",                                            "rows": 90,                                            "ranges": [                                                "910 &lt; b"                                            ] /* ranges */                                        } /* range_access_plan */,                                        "rows_for_plan": 90,                                        "cost_for_plan": 109.01,                                        "chosen": true                                    } /* chosen_range_access_summary */                                } /* range_analysis */                            }                        ] /* rows_estimation */                    },                    {                        "considered_execution_plans": [  --è€ƒè™‘çš„æ‰§è¡Œè®¡åˆ’                            {                                "plan_prefix": [                                ] /* plan_prefix */,                                "table": "`t1`",                                "best_access_path": {          --æœ€ä¼˜çš„è®¿é—®è·¯å¾„                                    "considered_access_paths": [ --å†³å®šçš„è®¿é—®è·¯å¾„                                        {                                            "rows_to_scan": 90,      --æ‰«æçš„è¡Œæ•°                                            "access_type": "range",  --è®¿é—®ç±»å‹ï¼šä¸ºrange                                            "range_details": {                                                "used_index": "idx_b"  --ä½¿ç”¨çš„ç´¢å¼•ä¸ºï¼šidx_b                                            } /* range_details */,                                            "resulting_rows": 90,    --ç»“æœè¡Œæ•°                                            "cost": 127.01,          --æˆæœ¬                                            "chosen": true,   --ç¡®å®šé€‰æ‹©                                            "use_tmp_table": true                                        }                                    ] /* considered_access_paths */                                } /* best_access_path */,                                "condition_filtering_pct": 100,                                "rows_for_plan": 90,                                "cost_for_plan": 127.01,                                "sort_cost": 90,                                "new_cost_for_plan": 217.01,                                "chosen": true                            }                        ] /* considered_execution_plans */                    },                    {                        "attaching_conditions_to_tables": {  --å°è¯•æ·»åŠ ä¸€äº›å…¶ä»–çš„æŸ¥è¯¢æ¡ä»¶                            "original_condition": "((`t1`.`a` &gt; 900) and (`t1`.`b` &gt; 910))",                            "attached_conditions_computation": [                            ] /* attached_conditions_computation */,                            "attached_conditions_summary": [                                {                                    "table": "`t1`",                                    "attached": "((`t1`.`a` &gt; 900) and (`t1`.`b` &gt; 910))"                                }                            ] /* attached_conditions_summary */                        } /* attaching_conditions_to_tables */                    },                    {                        "clause_processing": {                            "clause": "ORDER BY",                            "original_clause": "`t1`.`a`",                            "items": [                                {                                    "item": "`t1`.`a`"                                }                            ] /* items */,                            "resulting_clause_is_simple": true,                            "resulting_clause": "`t1`.`a`"                        } /* clause_processing */                    },                    {                        "reconsidering_access_paths_for_index_ordering": {                            "clause": "ORDER BY",                            "index_order_summary": {                                "table": "`t1`",                                "index_provides_order": false,                                "order_direction": "undefined",                                "index": "idx_b",                                "plan_changed": false                            } /* index_order_summary */                        } /* reconsidering_access_paths_for_index_ordering */                    },                    {                        "refine_plan": [          --æ”¹è¿›çš„æ‰§è¡Œè®¡åˆ’                            {                                "table": "`t1`",                                "pushed_index_condition": "(`t1`.`b` &gt; 910)",                                "table_condition_attached": "(`t1`.`a` &gt; 900)"                            }                        ] /* refine_plan */                    }                ] /* steps */            } /* join_optimization */        },        {            "join_execution": {             --SQLæ‰§è¡Œé˜¶æ®µ                "select#": 1,                "steps": [                    {                        "filesort_information": [                            {                                "direction": "asc",                                "table": "`t1`",                                "field": "a"                            }                        ] /* filesort_information */,                        "filesort_priority_queue_optimization": {                            "usable": false,             --æœªä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–æ’åº                            "cause": "not applicable (no LIMIT)"     --æœªä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ’åºçš„åŸå› æ˜¯æ²¡æœ‰limit                        } /* filesort_priority_queue_optimization */,                        "filesort_execution": [                        ] /* filesort_execution */,                        "filesort_summary": {           --æ’åºè¯¦æƒ…                            "rows": 90,                   --é¢„è®¡æ‰«æçš„è¡Œæ•°                            "examined_rows": 90,          --å‚ä¸æ’åºçš„è¡Œæ•°                            "number_of_tmp_files": 0,     --æ’åºè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶æ•°                            "sort_buffer_size": 115056,   --sort_buffer çš„å¤§å°                            "sort_mode": "&lt;sort_key, additional_fields&gt;"   --æ’åºæ¨¡å¼ï¼ˆè¯¦è§£è¯·çœ‹ä¸‹æ–¹çŸ¥è¯†æ‰©å±•ï¼‰                        } /* filesort_summary */                    }                ] /* steps */            } /* join_execution */        }    ] /* steps */}MISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0--è¯¥å­—æ®µè¡¨ç¤ºåˆ†æè¿‡ç¨‹ä¸¢å¼ƒçš„æ–‡æœ¬å­—èŠ‚å¤§å°ï¼Œæœ¬ä¾‹ä¸º0ï¼Œè¯´æ˜æ²¡ä¸¢å¼ƒä»»ä½•æ–‡æœ¬                    INSUFFICIENT_PRIVILEGES: 0    --æŸ¥çœ‹traceçš„æƒé™æ˜¯å¦ä¸è¶³ï¼Œ0è¡¨ç¤ºæœ‰æƒé™æŸ¥çœ‹traceè¯¦æƒ…1 row in set (0.00 sec)------------------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å…³é—­trace</p>  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">session</span> optimizer_trace<span class="token operator">=</span><span class="token string">"enabled=off"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>TRACE å­—æ®µä¸­æ•´ä¸ªæ–‡æœ¬å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ã€‚</p></li></ol><ul><li>å‡†å¤‡é˜¶æ®µï¼šå¯¹åº”æ–‡æœ¬ä¸­çš„ join_preparation</li><li>ä¼˜åŒ–é˜¶æ®µï¼šå¯¹åº”æ–‡æœ¬ä¸­çš„ join_optimization</li><li>æ‰§è¡Œé˜¶æ®µï¼šå¯¹åº”æ–‡æœ¬ä¸­çš„ join_execution</li></ul><p>ä½¿ç”¨æ—¶ï¼Œé‡ç‚¹å…³æ³¨ä¼˜åŒ–é˜¶æ®µå’Œæ‰§è¡Œé˜¶æ®µã€‚</p><p>ç”±æ­¤ä¾‹å¯ä»¥çœ‹å‡ºï¼š</p><ul><li>åœ¨ trace ç»“æœçš„ analyzing_range_alternatives è¿™ä¸€é¡¹å¯ä»¥çœ‹åˆ°ï¼šä½¿ç”¨ç´¢å¼• idx_a çš„æˆæœ¬ä¸º 121.01ï¼Œä½¿ç”¨ç´¢å¼• idx_b çš„æˆæœ¬ä¸º 109.01ï¼Œæ˜¾ç„¶ä½¿ç”¨ç´¢å¼• idx_b çš„æˆæœ¬è¦ä½äº›ï¼Œå› æ­¤ä¼˜åŒ–å™¨é€‰æ‹©äº† idx_b ç´¢å¼•ï¼›</li><li>åœ¨ trace ç»“æœçš„ filesort_summary è¿™ä¸€é¡¹å¯ä»¥çœ‹åˆ°ï¼šæ’åºæ¨¡å¼ä¸º <code>&lt;sort_key, additional_fields&gt;</code> ï¼Œè¡¨ç¤ºä½¿ç”¨çš„æ˜¯å•è·¯æ’åºï¼Œå³ä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶è¡Œçš„æ‰€æœ‰å­—æ®µï¼Œç„¶ååœ¨ sort buffer ä¸­è¿›è¡Œæ’åºã€‚</li></ul><blockquote><p>çŸ¥è¯†æ‰©å±•ï¼š</p><p><strong>çŸ¥è¯†ç‚¹ä¸€ï¼šMySQL å¸¸è§æ’åºæ¨¡å¼ï¼š</strong></p><ul><li>&lt; sort_key, rowid &gt;åŒè·¯æ’åºï¼ˆåˆå«å›è¡¨æ’åºæ¨¡å¼ï¼‰ï¼šæ˜¯é¦–å…ˆæ ¹æ®ç›¸åº”çš„æ¡ä»¶å–å‡ºç›¸åº”çš„æ’åºå­—æ®µå’Œå¯ä»¥ç›´æ¥å®šä½è¡Œæ•°æ®çš„è¡Œ IDï¼Œç„¶ååœ¨ sort buffer ä¸­è¿›è¡Œæ’åºï¼Œæ’åºå®Œåéœ€è¦å†æ¬¡å–å›å…¶å®ƒéœ€è¦çš„å­—æ®µï¼›</li><li>&lt; sort_key, additional_fields &gt;å•è·¯æ’åºï¼šæ˜¯ä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶è¡Œçš„æ‰€æœ‰å­—æ®µï¼Œç„¶ååœ¨sort bufferä¸­è¿›è¡Œæ’åºï¼›</li><li>&lt; sort_key, packed_additional_fields &gt;æ‰“åŒ…æ•°æ®æ’åºæ¨¡å¼ï¼šå°† char å’Œ varchar å­—æ®µå­˜åˆ° sort buffer ä¸­æ—¶ï¼Œæ›´åŠ ç´§ç¼©ã€‚</li></ul><p>ä¸‰ç§æ’åºæ¨¡å¼æ¯”è¾ƒï¼š</p><p>ç¬¬äºŒç§æ¨¡å¼ç›¸å¯¹ç¬¬ä¸€ç§æ¨¡å¼ï¼Œé¿å…äº†äºŒæ¬¡å›è¡¨ï¼Œå¯ä»¥ç†è§£ä¸ºç”¨ç©ºé—´æ¢æ—¶é—´ã€‚ç”±äº sort buffer æœ‰é™ï¼Œå¦‚æœéœ€è¦æŸ¥è¯¢çš„æ•°æ®æ¯”è¾ƒå¤§çš„è¯ï¼Œä¼šå¢åŠ ç£ç›˜æ’åºæ—¶é—´ï¼Œæ•ˆç‡å¯èƒ½æ¯”ç¬¬ä¸€ç§æ–¹å¼æ›´ä½ã€‚</p><p>MySQL æä¾›äº†ä¸€ä¸ªå‚æ•°ï¼šmax_length_for_sort_dataï¼Œå½“â€œæ’åºçš„é”®å€¼å¯¹å¤§å°â€ &gt; max_length_for_sort_data æ—¶ï¼ŒMySQL è®¤ä¸ºç£ç›˜å¤–éƒ¨æ’åºçš„ IO æ•ˆç‡ä¸å¦‚å›è¡¨çš„æ•ˆç‡ï¼Œä¼šé€‰æ‹©ç¬¬ä¸€ç§æ’åºæ¨¡å¼ï¼›å¦åˆ™ï¼Œä¼šé€‰æ‹©ç¬¬äºŒç§æ¨¡å¼ã€‚</p><p>ç¬¬ä¸‰ç§æ¨¡å¼ä¸»è¦è§£å†³å˜é•¿å­—ç¬¦æ•°æ®å­˜å‚¨ç©ºé—´æµªè´¹çš„é—®é¢˜ã€‚</p><p><strong>çŸ¥è¯†ç‚¹äºŒï¼šä¼˜åŒ–å™¨åœ¨ä¼°è®¡ç¬¦åˆæ¡ä»¶çš„è¡Œæ•°æ—¶æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š</strong></p><ul><li>index diverï¼šdive åˆ° index ä¸­åˆ©ç”¨ç´¢å¼•å®Œæˆå…ƒç»„æ•°çš„ä¼°ç®—ï¼›ç‰¹ç‚¹æ˜¯é€Ÿåº¦æ…¢ï¼Œä½†å¯ä»¥å¾—åˆ°ç²¾ç¡®çš„å€¼ï¼›</li><li>index statisticsï¼šä½¿ç”¨ç´¢å¼•çš„ç»Ÿè®¡æ•°å€¼ï¼Œè¿›è¡Œä¼°ç®—ï¼›ç‰¹ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å€¼ä¸ä¸€å®šå‡†ç¡®ã€‚</li></ul></blockquote><h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3 æ€»ç»“"></a>3 æ€»ç»“</h3><p>å¯¹æ¯”ä¸€ä¸‹ä¸‰ç§åˆ†æ SQL æ–¹æ³•çš„ç‰¹ç‚¹ï¼š</p><ul><li>explainï¼šè·å– MySQL ä¸­ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ¯”å¦‚è¯­å¥æ˜¯å¦ä½¿ç”¨äº†å…³è”æŸ¥è¯¢ã€æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€æ‰«æè¡Œæ•°ç­‰ï¼›</li><li>profileï¼šå¯ä»¥æ¸…æ¥šäº†è§£åˆ°SQLåˆ°åº•æ…¢åœ¨å“ªä¸ªç¯èŠ‚ï¼›</li><li>traceï¼šæŸ¥çœ‹ä¼˜åŒ–å™¨å¦‚ä½•é€‰æ‹©æ‰§è¡Œè®¡åˆ’ï¼Œè·å–æ¯ä¸ªå¯èƒ½çš„ç´¢å¼•é€‰æ‹©çš„ä»£ä»·ã€‚</li></ul><h2 id="04-æ¡ä»¶å­—æ®µæœ‰ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæŸ¥è¯¢ä¹Ÿè¿™ä¹ˆæ…¢"><a href="#04-æ¡ä»¶å­—æ®µæœ‰ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæŸ¥è¯¢ä¹Ÿè¿™ä¹ˆæ…¢" class="headerlink" title="04 æ¡ä»¶å­—æ®µæœ‰ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæŸ¥è¯¢ä¹Ÿè¿™ä¹ˆæ…¢?"></a><strong>04 æ¡ä»¶å­—æ®µæœ‰ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæŸ¥è¯¢ä¹Ÿè¿™ä¹ˆæ…¢?</strong></h2><p>ä¸‹é¢ä¼šè®²è§£å‡ ç§æœ‰ç´¢å¼•ä½†æ˜¯æŸ¥è¯¢ä¸èµ°ç´¢å¼•å¯¼è‡´æŸ¥è¯¢æ…¢çš„åœºæ™¯ã€‚</p><h3 id="1-å‡½æ•°æ“ä½œ"><a href="#1-å‡½æ•°æ“ä½œ" class="headerlink" title="1 å‡½æ•°æ“ä½œ"></a>1 å‡½æ•°æ“ä½œ</h3><h4 id="1-1-éªŒè¯å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œæ˜¯å¦èƒ½èµ°ç´¢å¼•"><a href="#1-1-éªŒè¯å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œæ˜¯å¦èƒ½èµ°ç´¢å¼•" class="headerlink" title="1.1 éªŒè¯å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œæ˜¯å¦èƒ½èµ°ç´¢å¼•"></a>1.1 éªŒè¯å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œæ˜¯å¦èƒ½èµ°ç´¢å¼•</h4><p>é¦–å…ˆåˆ›å»ºæµ‹è¯•è¡¨ï¼Œå»ºè¡¨åŠæ•°æ®å†™å…¥è¯­å¥å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span>                       <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t1<span class="token punctuation">;</span>        <span class="token comment">/* å¦‚æœè¡¨t1å­˜åœ¨åˆ™åˆ é™¤è¡¨t1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t1<span class="token punctuation">`</span> <span class="token punctuation">(</span>             <span class="token comment">/* åˆ›å»ºè¡¨t1 */</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">begin</span>    <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>                    <span class="token comment">/* å£°æ˜å˜é‡i */</span>    <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                          <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span>                 <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=10000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span>        <span class="token keyword">insert</span> <span class="token keyword">into</span> t1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* å†™å…¥è¡¨t1ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span>        <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                        <span class="token comment">/* å°†iåŠ 1 */</span>    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token keyword">call</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">update</span> t1 <span class="token keyword">set</span> c <span class="token operator">=</span> <span class="token string">'2019-05-22 00:00:00'</span><span class="token punctuation">;</span>  <span class="token comment">/* æ›´æ–°è¡¨t1çš„cå­—æ®µï¼Œå€¼éƒ½ä¸º'2019-05-22 00:00:00' */</span><span class="token keyword">update</span> t1 <span class="token keyword">set</span> c <span class="token operator">=</span> <span class="token string">'2019-05-21 00:00:00'</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">;</span> <span class="token comment">/* å°†idä¸º10000çš„è¡Œçš„cå­—æ®µæ”¹ä¸ºä¸å…¶å®ƒè¡Œéƒ½ä¸ä¸€æ ·çš„æ•°æ®ï¼Œä»¥ä¾¿åé¢å®éªŒä½¿ç”¨ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äºä¸Šé¢åˆ›å»ºçš„æµ‹è¯•è¡¨ï¼Œæ¯”å¦‚è¦æŸ¥è¯¢æµ‹è¯•è¡¨ t1 å•ç‹¬æŸä¸€å¤©çš„æ‰€æœ‰æ•°æ®ï¼ŒSQLå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> <span class="token keyword">date</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token string">'2019-05-21'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨ç¬¬ 2 èŠ‚å­¦ä¹ çš„ explain æ¥åˆ†æè¿™æ¡SQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œåˆ†æç»“æœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10302 |   100.00 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å›¾ä¸­çš„æ‰§è¡Œè®¡åˆ’ï¼Œtype ä¸º ALLï¼Œkey å­—æ®µç»“æœä¸º NULLï¼Œå› æ­¤çŸ¥é“è¯¥ SQL æ˜¯æ²¡èµ°ç´¢å¼•çš„å…¨è¡¨æ‰«æã€‚</p><p>åŸå› ï¼šå¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œèµ°ä¸äº†ç´¢å¼•ã€‚</p><h4 id="1-2-å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œä¸èµ°ç´¢å¼•çš„åŸå› "><a href="#1-2-å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œä¸èµ°ç´¢å¼•çš„åŸå› " class="headerlink" title="1.2 å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œä¸èµ°ç´¢å¼•çš„åŸå› "></a>1.2 å¯¹æ¡ä»¶å­—æ®µåšå‡½æ•°æ“ä½œä¸èµ°ç´¢å¼•çš„åŸå› </h4><p>è¯¥ä¾‹ä¸­ c å­—æ®µæ™®é€šç´¢å¼•çš„ B+ ç´¢å¼•æ ‘å¦‚ä¸‹ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/cå­—æ®µæ™®é€šç´¢å¼•çš„B+ç´¢å¼•æ ‘.png" alt="cå­—æ®µæ™®é€šç´¢å¼•çš„B+ç´¢å¼•æ ‘"></p><p>æ ¹æ®ä¸Šé¢ç»“æ„å¯ä»¥çœ‹åˆ°ï¼Œç´¢å¼•æ ‘ä¸­å­˜å‚¨çš„æ˜¯åˆ—çš„å®é™…å€¼å’Œä¸»é”®å€¼ã€‚å¦‚æœæ‹¿ â€˜2019-05-21â€™ å»åŒ¹é…ï¼Œå°†æ— æ³•å®šä½åˆ°ç´¢å¼•æ ‘ä¸­çš„å€¼ã€‚å› æ­¤æ”¾å¼ƒèµ°ç´¢å¼•ï¼Œè€Œé€‰æ‹©å…¨è¡¨æ‰«æã€‚</p><h4 id="1-3-å‡½æ•°æ“ä½œçš„-SQL-ä¼˜åŒ–"><a href="#1-3-å‡½æ•°æ“ä½œçš„-SQL-ä¼˜åŒ–" class="headerlink" title="1.3 å‡½æ•°æ“ä½œçš„ SQL ä¼˜åŒ–"></a>1.3 å‡½æ•°æ“ä½œçš„ SQL ä¼˜åŒ–</h4><p>å› æ­¤å¦‚æœéœ€è¦ä¼˜åŒ–çš„è¯ï¼Œæ”¹æˆ c å­—æ®µå®é™…å€¼ç›¸åŒ¹é…çš„å½¢å¼ã€‚å› ä¸º SQL çš„ç›®çš„æ˜¯æŸ¥è¯¢ 2019-05-21 å½“å¤©æ‰€æœ‰çš„è®°å½•ï¼Œå› æ­¤å¯ä»¥æ”¹æˆèŒƒå›´æŸ¥è¯¢ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> c<span class="token operator">&gt;=</span><span class="token string">'2019-05-21 00:00:00'</span> <span class="token operator">and</span> c<span class="token operator">&lt;=</span><span class="token string">'2019-05-21 23:59:59'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å†ç”¨ explain åˆ†æä¸‹æ‰§è¡Œè®¡åˆ’çš„ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                 |+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+|  1 | SIMPLE      | t1    | NULL       | range | idx_c         | idx_c | 5       | NULL |    1 |   100.00 | Using index condition |+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-éšå¼è½¬æ¢"><a href="#2-éšå¼è½¬æ¢" class="headerlink" title="2 éšå¼è½¬æ¢"></a><strong>2 éšå¼è½¬æ¢</strong></h3><blockquote><p>ä»€ä¹ˆæ—¶éšå¼è½¬æ¢ï¼Ÿ</p><p>å½“æ“ä½œç¬¦ä¸ä¸åŒç±»å‹çš„æ“ä½œå¯¹è±¡ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå°±ä¼šå‘ç”Ÿç±»å‹è½¬æ¢ä»¥ä½¿æ“ä½œå…¼å®¹ã€‚æŸäº›è½¬æ¢æ˜¯éšå¼çš„ã€‚</p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/type-conversion.html">å…³äºéšå¼è½¬æ¢è¯¦æƒ…è¯·å‚è€ƒMySQLå®˜æ–¹æ‰‹å†Œ</a></p></blockquote><p>éšå¼è½¬æ¢ä¼°è®¡æ˜¯å¾ˆå¤š MySQL ä½¿ç”¨è€…è¸©è¿‡çš„å‘ï¼Œæ¯”å¦‚è”ç³»æ–¹å¼å­—æ®µã€‚ç”±äºæœ‰æ—¶ç”µè¯å·ç å¸¦åŠ ã€å‡ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œæœ‰æ—¶éœ€è¦ä»¥ 0 å¼€å¤´ï¼Œå› æ­¤ä¸€èˆ¬è®¾è®¡è¡¨æ—¶ä¼šä½¿ç”¨ varchar ç±»å‹å­˜å‚¨ï¼Œå¹¶ä¸”ä¼šç»å¸¸åšä¸ºæ¡ä»¶æ¥æŸ¥è¯¢æ•°æ®ï¼Œæ‰€ä»¥ä¼šæ·»åŠ ç´¢å¼•ã€‚</p><p>è€Œæœ‰æ—¶é‡åˆ°éœ€è¦æŒ‰ç…§æ‰‹æœºå·ç æ¡ä»¶ï¼ˆæ¯”å¦‚ 11111111111ï¼‰å»æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå› ä¸ºæŸ¥è¯¢è€…çœ‹åˆ°æ¡ä»¶æ˜¯ä¸€ä¸²æ•°å­—ï¼Œè€Œå¿½è§†è¡¨ä¸­å¯¹åº”æ‰‹æœºå·å­—æ®µæ˜¯ varchar ç±»å‹ï¼Œå› æ­¤å†™å‡ºäº†å¦‚ä¸‹ä¸åˆç†çš„SQLï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> user_name<span class="token punctuation">,</span>tele_phone <span class="token keyword">from</span> user_info <span class="token keyword">where</span> tele_phone <span class="token operator">=</span><span class="token number">11111111111</span><span class="token punctuation">;</span> <span class="token comment">/* SQL 1 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-2-éªŒè¯éšå¼è½¬æ¢æ˜¯å¦èƒ½èµ°ç´¢å¼•"><a href="#2-2-éªŒè¯éšå¼è½¬æ¢æ˜¯å¦èƒ½èµ°ç´¢å¼•" class="headerlink" title="2.2 éªŒè¯éšå¼è½¬æ¢æ˜¯å¦èƒ½èµ°ç´¢å¼•"></a>2.2 éªŒè¯éšå¼è½¬æ¢æ˜¯å¦èƒ½èµ°ç´¢å¼•</h4><p>å®éªŒè¿‡ç¨‹åˆ†ä¸ºï¼šå…ˆåˆ›å»ºæµ‹è¯•è¡¨å¹¶å†™å…¥æ•°æ®ï¼›æµ‹è¯•éšå¼è½¬æ¢çš„æŸ¥è¯¢å¹¶æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼›æµ‹è¯•æ­£å¸¸æŸ¥è¯¢ï¼Œå†æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬è¦æŸ¥è¯¢ a å­—æ®µç­‰äº 1000 çš„å€¼ï¼ŒSQLå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹ä¸‹ explain ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | idx_a         | NULL | NULL    | NULL | 10302 |    10.00 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ type è¿™åˆ—å¯ä»¥çœ‹åˆ°æ˜¯æœ€å·®çš„æƒ…å†µ ALLï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼Œ é€šè¿‡ key è¿™åˆ—å¯ä»¥çœ‹åˆ°æ²¡èµ° a å­—æ®µçš„ç´¢å¼•ï¼Œé€šè¿‡ rows è¿™åˆ—å¯ä»¥çœ‹åˆ°è¿›è¡Œäº†å…¨è¡¨æ‰«æã€‚</p><h4 id="2-3-ä¸èµ°ç´¢å¼•çš„åŸå› "><a href="#2-3-ä¸èµ°ç´¢å¼•çš„åŸå› " class="headerlink" title="2.3 ä¸èµ°ç´¢å¼•çš„åŸå› "></a>2.3 ä¸èµ°ç´¢å¼•çš„åŸå› </h4><p>a å­—æ®µç±»å‹æ˜¯ varchar(20)ï¼Œè€Œè¯­å¥ä¸­ a å­—æ®µæ¡ä»¶å€¼æ²¡åŠ å•å¼•å·ï¼Œå¯¼è‡´ MySQL å†…éƒ¨ä¼šå…ˆæŠŠaè½¬æ¢æˆintå‹ï¼Œå†å»åšåˆ¤æ–­ï¼Œç›¸å½“äºå®é™…æ‰§è¡Œçš„ SQL è¯­å¥å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> cast<span class="token punctuation">(</span>a <span class="token keyword">as</span> signed <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å› æ­¤åˆå›åˆ°ä¸Šé¢è¯´çš„ï¼š<strong>å¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œæ—¶ï¼Œä¼˜åŒ–å™¨ä¼šæ”¾å¼ƒä½¿ç”¨ç´¢å¼•</strong>ã€‚</p><h4 id="2-4-éšå¼è½¬æ¢çš„-SQL-ä¼˜åŒ–"><a href="#2-4-éšå¼è½¬æ¢çš„-SQL-ä¼˜åŒ–" class="headerlink" title="2.4 éšå¼è½¬æ¢çš„ SQL ä¼˜åŒ–"></a>2.4 éšå¼è½¬æ¢çš„ SQL ä¼˜åŒ–</h4><p>ç´¢å¼•å­—ç¬¦ä¸²åˆ—æ¡ä»¶æ·»åŠ å•å¼•å·ï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token string">'1000'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+|  1 | SIMPLE      | t1    | NULL       | ref  | idx_a         | idx_a | 83      | const |    1 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ type è¿™åˆ—ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ refï¼ˆåŸºäºæ™®é€šç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼Œæ¯” ALL æ€§èƒ½å¥½å¾ˆå¤šï¼‰ï¼Œé€šè¿‡keyè¿™åˆ—ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»èµ°äº† a å­—æ®µçš„ç´¢å¼•ï¼Œé€šè¿‡rowsè¿™åˆ—å¯ä»¥çœ‹åˆ°é€šè¿‡ç´¢å¼•æŸ¥è¯¢åå°±æ‰«æäº†ä¸€è¡Œã€‚</p><h3 id="3-æ¨¡ç³ŠæŸ¥è¯¢"><a href="#3-æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="3 æ¨¡ç³ŠæŸ¥è¯¢"></a><strong>3 æ¨¡ç³ŠæŸ¥è¯¢</strong></h3><h4 id="3-1-åˆ†ææ¨¡ç³ŠæŸ¥è¯¢"><a href="#3-1-åˆ†ææ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="3.1 åˆ†ææ¨¡ç³ŠæŸ¥è¯¢"></a>3.1 åˆ†ææ¨¡ç³ŠæŸ¥è¯¢</h4><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æƒ³æ ¹æ®æŸä¸ªå­—æ®µçš„æŸå‡ ä¸ªå…³é”®å­—æŸ¥è¯¢æ•°æ®ï¼Œæ¯”å¦‚ä¼šæœ‰å¦‚ä¸‹ SQLï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a <span class="token operator">like</span> <span class="token string">'%1111%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®é™…è¿™ç§æƒ…å†µæ— æ³•èµ°ç´¢å¼•ï¼Œçœ‹ä¸‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10302 |    11.11 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡ç‚¹ç•™æ„typeã€keyã€rowsã€Extraï¼Œå‘ç°æ˜¯å…¨è¡¨æ‰«æã€‚</p><h4 id="3-2-æ¨¡ç³ŠæŸ¥è¯¢ä¼˜åŒ–å»ºè®®"><a href="#3-2-æ¨¡ç³ŠæŸ¥è¯¢ä¼˜åŒ–å»ºè®®" class="headerlink" title="3.2 æ¨¡ç³ŠæŸ¥è¯¢ä¼˜åŒ–å»ºè®®"></a>3.2 æ¨¡ç³ŠæŸ¥è¯¢ä¼˜åŒ–å»ºè®®</h4><p>ä¿®æ”¹ä¸šåŠ¡ï¼Œè®©æ¨¡ç³ŠæŸ¥è¯¢å¿…é¡»åŒ…å«æ¡ä»¶å­—æ®µå‰é¢çš„å€¼ï¼Œç„¶åè½åˆ°æ•°æ®åº“çš„æŸ¥è¯¢ä¸ºï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a <span class="token operator">like</span> <span class="token string">'1111%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ç§å†™æ³•æ˜¯å¯ä»¥ç”¨åˆ°ç´¢å¼•çš„ï¼Œexplainåˆ†æå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                 |+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+|  1 | SIMPLE      | t1    | NULL       | range | idx_a         | idx_a | 83      | NULL |    1 |   100.00 | Using index condition |+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¦‚æœæ¡ä»¶åªçŸ¥é“ä¸­é—´çš„å€¼ï¼Œéœ€è¦æ¨¡ç³ŠæŸ¥è¯¢å»æŸ¥ï¼Œé‚£å°±å»ºè®®ä½¿ç”¨ElasticSearchæˆ–å…¶å®ƒæœç´¢æœåŠ¡å™¨ã€‚</p></blockquote><h3 id="4-èŒƒå›´æŸ¥è¯¢"><a href="#4-èŒƒå›´æŸ¥è¯¢" class="headerlink" title="4 èŒƒå›´æŸ¥è¯¢"></a><strong>4 èŒƒå›´æŸ¥è¯¢</strong></h3><h4 id="4-1-æ„é€ ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢"><a href="#4-1-æ„é€ ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢" class="headerlink" title="4.1 æ„é€ ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢"></a>4.1 æ„é€ ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> b<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">and</span> b <span class="token operator">&lt;=</span><span class="token number">100000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹ä¸‹è¿™æ¡ SQL çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | idx_b         | NULL | NULL    | NULL | 10302 |    97.07 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°å¹¶ä¸èƒ½èµ°bå­—æ®µçš„ç´¢å¼•ã€‚</p><p>åŸå› ï¼šä¼˜åŒ–å™¨ä¼šæ ¹æ®æ£€ç´¢æ¯”ä¾‹ã€è¡¨å¤§å°ã€I/Oå—å¤§å°ç­‰è¿›è¡Œè¯„ä¼°æ˜¯å¦ä½¿ç”¨ç´¢å¼•ã€‚æ¯”å¦‚å•æ¬¡æŸ¥è¯¢çš„æ•°æ®é‡è¿‡å¤§ï¼Œä¼˜åŒ–å™¨å°†ä¸èµ°ç´¢å¼•ã€‚</p><h4 id="4-2-ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢"><a href="#4-2-ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢" class="headerlink" title="4.2 ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢"></a>4.2 ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢</h4><p>é™ä½å•æ¬¡æŸ¥è¯¢èŒƒå›´ï¼Œåˆ†å¤šæ¬¡æŸ¥è¯¢ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> b<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">and</span> b <span class="token operator">&lt;=</span><span class="token number">1000</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> b<span class="token operator">&gt;=</span><span class="token number">1001</span> <span class="token operator">and</span> b <span class="token operator">&lt;=</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼ˆå°±åªçœ‹ç¬¬ä¸€æ¡çš„ï¼Œç¬¬äºŒæ¡åŒç†ï¼‰ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                 |+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+|  1 | SIMPLE      | t1    | NULL       | range | idx_b         | idx_b | 5       | NULL | 1000 |   100.00 | Using index condition |+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤ï¼Œé™ä½æŸ¥è¯¢èŒƒå›´åï¼Œèƒ½æ­£å¸¸ä½¿ç”¨ç´¢å¼•ã€‚</p><blockquote><p>ç»éªŒåˆ†äº«ï¼š</p><p>å®é™…è¿™ç§èŒƒå›´æŸ¥è¯¢è€Œå¯¼è‡´ä½¿ç”¨ä¸äº†ç´¢å¼•çš„åœºæ™¯ç»å¸¸å‡ºç°ï¼Œæ¯”å¦‚æŒ‰ç…§æ—¶é—´æ®µæŠ½å–å…¨é‡æ•°æ®ï¼Œæ¯æ¡SQLæŠ½å–ä¸€ä¸ªæœˆçš„ï¼›æˆ–è€…æŸå¼ ä¸šåŠ¡è¡¨å†å²æ•°æ®çš„åˆ é™¤ã€‚é‡åˆ°æ­¤ç±»æ“ä½œæ—¶ï¼Œ<strong>åº”è¯¥åœ¨æ‰§è¡Œä¹‹å‰å¯¹SQLåšexplainåˆ†æï¼Œç¡®å®šèƒ½èµ°ç´¢å¼•ï¼Œå†è¿›è¡Œæ“ä½œ</strong>ï¼Œå¦åˆ™ä¸ä½†å¯èƒ½å¯¼è‡´æ“ä½œç¼“æ…¢ï¼Œåœ¨åšæ›´æ–°æˆ–è€…åˆ é™¤æ—¶ï¼Œç”šè‡³ä¼šå¯¼è‡´è¡¨æ‰€æœ‰è®°å½•é”ä½ï¼Œååˆ†å±é™©ã€‚</p></blockquote><h3 id="5-è®¡ç®—æ“ä½œ"><a href="#5-è®¡ç®—æ“ä½œ" class="headerlink" title="5 è®¡ç®—æ“ä½œ"></a>5 è®¡ç®—æ“ä½œ</h3><h4 id="5-1-æŸ¥è¯¢æ¡ä»¶è¿›è¡Œè®¡ç®—æ“ä½œçš„-SQL-æ‰§è¡Œæ•ˆç‡"><a href="#5-1-æŸ¥è¯¢æ¡ä»¶è¿›è¡Œè®¡ç®—æ“ä½œçš„-SQL-æ‰§è¡Œæ•ˆç‡" class="headerlink" title="5.1 æŸ¥è¯¢æ¡ä»¶è¿›è¡Œè®¡ç®—æ“ä½œçš„ SQL æ‰§è¡Œæ•ˆç‡"></a>5.1 æŸ¥è¯¢æ¡ä»¶è¿›è¡Œè®¡ç®—æ“ä½œçš„ SQL æ‰§è¡Œæ•ˆç‡</h4><p>æœ‰æ—¶æˆ‘ä»¬ä¸æœ‰å¯¹æ¡ä»¶å­—æ®µåšè®¡ç®—æ“ä½œçš„éœ€æ±‚ï¼Œåœ¨ä½¿ç”¨ SQL æŸ¥è¯¢æ—¶ï¼Œå°±åº”è¯¥å°å¿ƒäº†ã€‚å…ˆçœ‹ä¸‹ä¾‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> b<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10302 |   100.00 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åŸå› ï¼šå¯¹ç´¢å¼•å­—æ®µåšè¿ç®—å°†ä½¿ç”¨ä¸äº†ç´¢å¼•ã€‚</p></blockquote><h4 id="5-2-è®¡ç®—æ“ä½œçš„-SQL-ä¼˜åŒ–"><a href="#5-2-è®¡ç®—æ“ä½œçš„-SQL-ä¼˜åŒ–" class="headerlink" title="5.2 è®¡ç®—æ“ä½œçš„ SQL ä¼˜åŒ–"></a>5.2 è®¡ç®—æ“ä½œçš„ SQL ä¼˜åŒ–</h4><p>å°†è®¡ç®—æ“ä½œæ”¾åœ¨ç­‰å·åé¢ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> b <span class="token operator">=</span><span class="token number">1000</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+|  1 | SIMPLE      | t1    | NULL       | ref  | idx_b         | idx_b | 5       | const |    1 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°å°†è®¡ç®—æ“ä½œæ”¾åœ¨ç­‰å·åï¼Œèƒ½æ­£å¸¸ä½¿ç”¨ç´¢å¼•ã€‚</p><blockquote><p>ç»éªŒåˆ†äº«ï¼š</p><p><strong>ä¸€èˆ¬éœ€è¦å¯¹æ¡ä»¶å­—æ®µåšè®¡ç®—æ—¶ï¼Œå»ºè®®é€šè¿‡ç¨‹åºä»£ç å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡MySQLå®ç°ã€‚å¦‚æœåœ¨MySQLä¸­è®¡ç®—çš„æƒ…å†µé¿å…ä¸äº†ï¼Œé‚£å¿…é¡»æŠŠè®¡ç®—æ”¾åœ¨ç­‰å·åé¢ã€‚</strong></p></blockquote><h3 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6 æ€»ç»“"></a>6 æ€»ç»“</h3><p>åœ¨å†™ SQL æ—¶åº”è¯¥æ³¨æ„è¿™äº›ç‚¹ï¼š</p><ul><li>åº”è¯¥é¿å…éšå¼è½¬æ¢</li><li>likeæŸ¥è¯¢ä¸èƒ½ä»¥%å¼€å¤´</li><li>èŒƒå›´æŸ¥è¯¢æ—¶ï¼ŒåŒ…å«çš„æ•°æ®æ¯”ä¾‹ä¸èƒ½å¤ªå¤§</li><li>ä¸å»ºè®®å¯¹æ¡ä»¶å­—æ®µåšè¿ç®—åŠå‡½æ•°æ“ä½œ</li></ul><p>æœ¬èŠ‚æ¶‰åŠåˆ°çš„ä¸€äº›SQLä¼˜åŒ–å¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/MySQLæ¡ä»¶å­—æ®µæœ‰ç´¢å¼•ä½†æ˜¯ä¸èµ°ç´¢å¼•çš„åœºæ™¯.png" alt="MySQLæ¡ä»¶å­—æ®µæœ‰ç´¢å¼•ä½†æ˜¯ä¸èµ°ç´¢å¼•çš„åœºæ™¯"></p><h2 id="05-å¦‚ä½•ä¼˜åŒ–æ•°æ®å¯¼å…¥ï¼Ÿ"><a href="#05-å¦‚ä½•ä¼˜åŒ–æ•°æ®å¯¼å…¥ï¼Ÿ" class="headerlink" title="05 å¦‚ä½•ä¼˜åŒ–æ•°æ®å¯¼å…¥ï¼Ÿ"></a><strong>05 å¦‚ä½•ä¼˜åŒ–æ•°æ®å¯¼å…¥ï¼Ÿ</strong></h2><h3 id="1-ä¸€æ¬¡æ’å…¥å¤šè¡Œçš„å€¼"><a href="#1-ä¸€æ¬¡æ’å…¥å¤šè¡Œçš„å€¼" class="headerlink" title="1 ä¸€æ¬¡æ’å…¥å¤šè¡Œçš„å€¼"></a>1 ä¸€æ¬¡æ’å…¥å¤šè¡Œçš„å€¼</h3><p>æ’å…¥è¡Œæ‰€éœ€çš„æ—¶é—´ç”±ä»¥ä¸‹å› ç´ å†³å®šï¼ˆå‚è€ƒMySQL 5.7å‚è€ƒæ‰‹å†Œï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/insert-optimization.html">8.2.4.1ä¼˜åŒ–INSERTè¯­å¥</a>ï¼‰</p><ul><li>è¿æ¥ï¼š30%</li><li>å‘æœåŠ¡å™¨å‘é€æŸ¥è¯¢ï¼š20%</li><li>è§£ææŸ¥è¯¢ï¼š20%</li><li>æ’å…¥è¡Œï¼š10% * è¡Œçš„å¤§å°</li><li>æ’å…¥ç´¢å¼•ï¼š10% * ç´¢å¼•æ•°</li><li>ç»“æŸï¼š10%</li></ul><p>å¯å‘ç°å¤§éƒ¨åˆ†æ—¶é—´è€—è´¹åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„æ—¶é—´ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ insert åŒ…å«å¤šä¸ªå€¼æ¥å‡å°‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚</p><h3 id="2-å…³é—­è‡ªåŠ¨æäº¤"><a href="#2-å…³é—­è‡ªåŠ¨æäº¤" class="headerlink" title="2 å…³é—­è‡ªåŠ¨æäº¤"></a>2 å…³é—­è‡ªåŠ¨æäº¤</h3><p>Autocommit å¼€å¯æ—¶ä¼šä¸ºæ¯ä¸ªæ’å…¥æ‰§è¡Œæäº¤ã€‚å¯ä»¥åœ¨InnoDBå¯¼å…¥æ•°æ®æ—¶ï¼Œå…³é—­è‡ªåŠ¨æäº¤ã€‚</p><h3 id="3-å‚æ•°è°ƒæ•´"><a href="#3-å‚æ•°è°ƒæ•´" class="headerlink" title="3 å‚æ•°è°ƒæ•´"></a>3 å‚æ•°è°ƒæ•´</h3><p>å½±å“MySQLå†™å…¥é€Ÿåº¦çš„ä¸»è¦ä¸¤ä¸ªå‚æ•°ï¼šinnodb_flush_log_at_trx_commitã€sync_binlogã€‚</p><h4 id="3-1-å‚æ•°è§£é‡Š"><a href="#3-1-å‚æ•°è§£é‡Š" class="headerlink" title="3.1 å‚æ•°è§£é‡Š"></a>3.1 å‚æ•°è§£é‡Š</h4><p>innodb_flush_log_at_trx_commitï¼šæ§åˆ¶é‡åšæ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜çš„ç­–ç•¥ï¼Œæœ‰0 ã€1å’Œ2ä¸‰ç§å€¼ã€‚</p><ul><li>0ï¼šmasterçº¿ç¨‹æ¯ç§’æŠŠredo log bufferå†™åˆ°æ“ä½œç³»ç»Ÿç¼“å­˜ï¼Œå†åˆ·åˆ°ç£ç›˜ï¼›</li><li>1ï¼šæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½å°†redo log bufferå†™åˆ°æ“ä½œç³»ç»Ÿç¼“å­˜ï¼Œå†åˆ·åˆ°ç£ç›˜ï¼›</li><li>2ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½å°†redo log bufferå†™åˆ°æ“ä½œç³»ç»Ÿç¼“å­˜ï¼Œç”±æ“ä½œç³»ç»Ÿæ¥ç®¡ç†åˆ·ç›˜ã€‚</li></ul><p>sync_binlogï¼šæ§åˆ¶binlogçš„åˆ·ç›˜æ—¶æœºï¼Œå¯é…ç½®0ã€1æˆ–è€…å¤§äº1çš„æ•°å­—ã€‚</p><ul><li>0ï¼šäºŒè¿›åˆ¶æ—¥å¿—ä»ä¸åŒæ­¥åˆ°ç£ç›˜ï¼Œä¾èµ–OSåˆ·ç›˜æœºåˆ¶ï¼›</li><li>1ï¼šäºŒè¿›åˆ¶æ—¥å¿—æ¯æ¬¡æäº¤éƒ½ä¼šåˆ·ç›˜ï¼›</li><li>n(n&gt;1) : æ¯næ¬¡æäº¤è½ç›˜ä¸€æ¬¡ã€‚</li></ul><h2 id="06-è®©order-byã€group-byæŸ¥è¯¢æ›´å¿«"><a href="#06-è®©order-byã€group-byæŸ¥è¯¢æ›´å¿«" class="headerlink" title="06 è®©order byã€group byæŸ¥è¯¢æ›´å¿«"></a><strong>06 è®©order byã€group byæŸ¥è¯¢æ›´å¿«</strong></h2><h3 id="1-order-by-åŸç†"><a href="#1-order-by-åŸç†" class="headerlink" title="1 order by åŸç†"></a>1 order by åŸç†</h3><p>åœ¨ä¼˜åŒ– order by è¯­å¥ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ MySQL ä¸­æ’åºçš„ç›¸å…³çŸ¥è¯†ç‚¹å’ŒåŸç†ï¼Œä¸ºäº†æ–¹ä¾¿è®²è§£è¿‡ç¨‹ä¸¾ä¾‹è¯´æ˜ï¼Œé¦–å…ˆåˆ›å»ºä¸€å¼ æµ‹è¯•è¡¨ï¼Œå»ºè¡¨åŠæ•°æ®å†™å…¥è¯­å¥å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span>                 <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t1<span class="token punctuation">;</span>  <span class="token comment">/* å¦‚æœè¡¨t1å­˜åœ¨åˆ™åˆ é™¤è¡¨t1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t1<span class="token punctuation">`</span> <span class="token punctuation">(</span>      <span class="token comment">/* åˆ›å»ºè¡¨t1 */</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>d<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a_b<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">begin</span>    <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>                  <span class="token comment">/* å£°æ˜å˜é‡i */</span>    <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                        <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span>      <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=10000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span>        <span class="token keyword">insert</span> <span class="token keyword">into</span> t1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t1ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span>        <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                       <span class="token comment">/* å°†iåŠ 1 */</span>    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token keyword">call</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">update</span> t1 <span class="token keyword">set</span> a<span class="token operator">=</span><span class="token number">1000</span> <span class="token keyword">where</span> id <span class="token operator">&gt;</span><span class="token number">9000</span><span class="token punctuation">;</span>    <span class="token comment">/* å°†idå¤§äº9000çš„è¡Œçš„aå­—æ®µæ›´æ–°ä¸º1000 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-1-MySQL-çš„æ’åºæ–¹å¼"><a href="#1-1-MySQL-çš„æ’åºæ–¹å¼" class="headerlink" title="1.1 MySQL çš„æ’åºæ–¹å¼"></a>1.1 MySQL çš„æ’åºæ–¹å¼</h4><p>æŒ‰ç…§æ’åºåŸç†åˆ†ï¼ŒMySQL æ’åºæ–¹å¼åˆ†ä¸¤ç§ï¼š</p><ul><li>é€šè¿‡æœ‰åºç´¢å¼•ç›´æ¥è¿”å›æœ‰åºæ•°æ®</li><li>é€šè¿‡ Filesort è¿›è¡Œçš„æ’åº</li></ul><blockquote><p><strong>æ€ä¹ˆç¡®å®šæŸæ¡æ’åºçš„ SQL æ‰€ä½¿ç”¨çš„æ’åºæ–¹å¼ï¼Ÿ</strong></p><p>ä½¿ç”¨ explain æ¥æŸ¥çœ‹è¯¥æ’åº SQL çš„æ‰§è¡Œè®¡åˆ’ï¼Œé‡ç‚¹å…³æ³¨ Extra å­—æ®µï¼š</p><p>å¦‚æœè¯¥å­—æ®µé‡Œæ˜¾ç¤ºæ˜¯ Using indexï¼Œåˆ™è¡¨ç¤ºæ˜¯é€šè¿‡æœ‰åºç´¢å¼•ç›´æ¥è¿”å›æœ‰åºæ•°æ®ã€‚</p><p>å¦‚æœè¯¥å­—æ®µé‡Œæ˜¾ç¤ºæ˜¯ Using filesortï¼Œåˆ™è¡¨ç¤ºè¯¥ SQL æ˜¯é€šè¿‡ Filesort è¿›è¡Œçš„æ’åºã€‚</p></blockquote><h4 id="1-2-Filesort-æ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸­å®Œæˆæ’åºçš„ï¼Ÿ"><a href="#1-2-Filesort-æ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸­å®Œæˆæ’åºçš„ï¼Ÿ" class="headerlink" title="1.2 Filesort æ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸­å®Œæˆæ’åºçš„ï¼Ÿ"></a>1.2 Filesort æ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸­å®Œæˆæ’åºçš„ï¼Ÿ</h4><p>MySQL ä¸­çš„ Filesort å¹¶ä¸ä¸€å®šæ˜¯åœ¨ç£ç›˜æ–‡ä»¶ä¸­è¿›è¡Œæ’åºçš„ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨å†…å­˜ä¸­æ’åºï¼Œå†…å­˜æ’åºè¿˜æ˜¯ç£ç›˜æ’åºå–å†³äºæ’åºçš„æ•°æ®å¤§å°å’Œ sort_buffer_size é…ç½®çš„å¤§å°ã€‚</p><ul><li>å¦‚æœ â€œæ’åºçš„æ•°æ®å¤§å°â€ &lt; sort_buffer_size: å†…å­˜æ’åº</li><li>å¦‚æœ â€œæ’åºçš„æ•°æ®å¤§å°â€ &gt; sort_buffer_size: ç£ç›˜æ’åº</li></ul><blockquote><p><strong>æ€ä¹ˆç¡®å®šä½¿ç”¨ Filesort æ’åºçš„ SQL æ˜¯åœ¨å†…å­˜è¿˜æ˜¯åœ¨ç£ç›˜ä¸­è¿›è¡Œçš„æ’åºæ“ä½œï¼Ÿ</strong></p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ trace è¿›è¡Œåˆ†æï¼Œé‡ç‚¹å…³æ³¨ number_of_tmp_filesï¼Œå¦‚æœç­‰äº 0ï¼Œåˆ™è¡¨ç¤ºæ’åºè¿‡ç¨‹æ²¡ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼Œåœ¨å†…å­˜ä¸­å°±èƒ½å®Œæˆæ’åºï¼›å¦‚æœå¤§äº0ï¼Œåˆ™è¡¨ç¤ºæ’åºè¿‡ç¨‹ä¸­ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p></blockquote><h4 id="1-3-Filesort-ä¸‹çš„æ’åºæ¨¡å¼"><a href="#1-3-Filesort-ä¸‹çš„æ’åºæ¨¡å¼" class="headerlink" title="1.3 Filesort ä¸‹çš„æ’åºæ¨¡å¼"></a>1.3 Filesort ä¸‹çš„æ’åºæ¨¡å¼</h4><p>Filesort ä¸‹çš„æ’åºæ¨¡å¼æœ‰ä¸‰ç§ï¼Œå…·ä½“ä»‹ç»å¦‚ä¸‹ï¼šï¼ˆå‚è€ƒ<a href="https://dev.mysql.com/doc/refman/5.7/en/order-by-optimization.html">ã€ŠMySQL 5.7 Reference Manualã€‹8.2.1.14 ORDER BY Optimization</a>ï¼‰</p><ul><li>&lt; sort_key, rowid &gt;åŒè·¯æ’åºï¼ˆåˆå«å›è¡¨æ’åºæ¨¡å¼ï¼‰ï¼šæ˜¯é¦–å…ˆæ ¹æ®ç›¸åº”çš„æ¡ä»¶å–å‡ºç›¸åº”çš„æ’åºå­—æ®µå’Œå¯ä»¥ç›´æ¥å®šä½è¡Œæ•°æ®çš„è¡Œ IDï¼Œç„¶ååœ¨ sort buffer ä¸­è¿›è¡Œæ’åºï¼Œæ’åºå®Œåéœ€è¦å†æ¬¡å–å›å…¶å®ƒéœ€è¦çš„å­—æ®µï¼›</li><li>&lt; sort_key, additional_fields &gt;å•è·¯æ’åºï¼šæ˜¯ä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶è¡Œçš„æ‰€æœ‰å­—æ®µï¼Œç„¶ååœ¨sort bufferä¸­è¿›è¡Œæ’åºï¼›</li><li>&lt; sort_key, packed_additional_fields &gt;æ‰“åŒ…æ•°æ®æ’åºæ¨¡å¼ï¼šä¸å•è·¯æ’åºç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯å°† char å’Œ varchar å­—æ®µå­˜åˆ° sort buffer ä¸­æ—¶ï¼Œæ›´åŠ ç´§ç¼©ã€‚</li></ul><p>å› ä¸ºæ‰“åŒ…æ•°æ®æ’åºæ¨¡å¼æ˜¯å•è·¯æ’åºçš„ä¸€ç§å‡çº§æ¨¡å¼ï¼Œå› æ­¤é‡ç‚¹æ¢è®¨åŒè·¯æ’åºå’Œå•è·¯æ’åºçš„åŒºåˆ«ã€‚MySQL é€šè¿‡æ¯”è¾ƒç³»ç»Ÿå˜é‡ max_length_for_sort_data çš„å¤§å°å’Œéœ€è¦æŸ¥è¯¢çš„å­—æ®µæ€»å¤§å°æ¥åˆ¤æ–­ä½¿ç”¨å“ªç§æ’åºæ¨¡å¼ã€‚</p><ul><li>å¦‚æœ max_length_for_sort_data æ¯”æŸ¥è¯¢å­—æ®µçš„æ€»é•¿åº¦å¤§ï¼Œé‚£ä¹ˆä½¿ç”¨ &lt; sort_key, additional_fields &gt;æ’åºæ¨¡å¼ï¼›</li><li>å¦‚æœ max_length_for_sort_data æ¯”æŸ¥è¯¢å­—æ®µçš„æ€»é•¿åº¦å°ï¼Œé‚£ä¹ˆä½¿ç”¨ <sort_key, rowid=""> æ’åºæ¨¡å¼ã€‚</sort_key,></li></ul><p>ä¸ºä»€ä¹ˆè¦æ·»åŠ  max_length_for_sort_data è¿™ä¸ªå‚æ•°è®©æ’åºä½¿ç”¨ä¸åŒçš„æ’åºæ¨¡å¼å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·åˆ†æä¸‹ max_length_for_sort_data çš„é‡è¦æ€§ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ¡ SQLï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> a<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1000</span> <span class="token keyword">order</span> <span class="token keyword">by</span> d<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬å…ˆçœ‹<strong>å•è·¯æ’åº</strong>çš„è¯¦ç»†è¿‡ç¨‹ï¼š</p><ol><li>ä»ç´¢å¼• a æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ a = 1000 æ¡ä»¶çš„ä¸»é”® id</li><li>æ ¹æ®ä¸»é”® id å–å‡ºæ•´è¡Œï¼Œ<strong>å–å‡º aã€cã€d ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå­˜å…¥ sort_buffer ä¸­</strong></li><li>ä»ç´¢å¼• a æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ»¡è¶³ a = 1000 æ¡ä»¶çš„ä¸»é”® id</li><li>é‡å¤æ­¥éª¤ 2ã€3 ç›´åˆ°ä¸æ»¡è¶³ a = 1000</li><li>å¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ d è¿›è¡Œæ’åº</li><li>è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</li></ol><p>æˆ‘ä»¬å†çœ‹ä¸‹<strong>åŒè·¯æ’åº</strong>çš„è¯¦ç»†è¿‡ç¨‹ï¼š</p><ol><li>ä»ç´¢å¼• a æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ a = 1000 çš„ä¸»é”® id</li><li>æ ¹æ®ä¸»é”® id å–å‡ºæ•´è¡Œï¼Œ<strong>æŠŠæ’åºå­—æ®µ d å’Œä¸»é”® id è¿™ä¸¤ä¸ªå­—æ®µæ”¾åˆ° sort buffer ä¸­</strong></li><li>ä»ç´¢å¼• a å–ä¸‹ä¸€ä¸ªæ»¡è¶³ a = 1000 è®°å½•çš„ä¸»é”® id</li><li>é‡å¤ 3ã€4 ç›´åˆ°ä¸æ»¡è¶³ a = 1000</li><li>å¯¹ sort_buffer ä¸­çš„å­—æ®µ d å’Œä¸»é”® id æŒ‰ç…§å­—æ®µ d è¿›è¡Œæ’åº</li><li>éå†æ’åºå¥½çš„ id å’Œå­—æ®µ dï¼ŒæŒ‰ç…§ id çš„å€¼å›åˆ°åŸè¡¨ä¸­å–å‡º aã€cã€d ä¸‰ä¸ªå­—æ®µçš„å€¼è¿”å›ç»™å®¢æˆ·ç«¯</li></ol><p>å…¶å®å¯¹æ¯”ä¸¤ä¸ªæ’åºæ¨¡å¼ï¼Œå•è·¯æ’åºä¼šæŠŠæ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µéƒ½æ”¾åˆ° sort buffer ä¸­ï¼Œè€ŒåŒè·¯æ’åºåªä¼šæŠŠä¸»é”®å’Œéœ€è¦æ’åºçš„å­—æ®µæ”¾åˆ° sort buffer ä¸­è¿›è¡Œæ’åºï¼Œç„¶åå†é€šè¿‡ä¸»é”®å›åˆ°åŸè¡¨æŸ¥è¯¢éœ€è¦çš„å­—æ®µã€‚</p><h3 id="2-order-by-ä¼˜åŒ–"><a href="#2-order-by-ä¼˜åŒ–" class="headerlink" title="2 order by ä¼˜åŒ–"></a>2 order by ä¼˜åŒ–</h3><h4 id="2-1-æ·»åŠ åˆé€‚ç´¢å¼•"><a href="#2-1-æ·»åŠ åˆé€‚ç´¢å¼•" class="headerlink" title="2.1 æ·»åŠ åˆé€‚ç´¢å¼•"></a>2.1 æ·»åŠ åˆé€‚ç´¢å¼•</h4><h5 id="2-1-1-æ’åºå­—æ®µæ·»åŠ ç´¢å¼•"><a href="#2-1-1-æ’åºå­—æ®µæ·»åŠ ç´¢å¼•" class="headerlink" title="2.1.1 æ’åºå­—æ®µæ·»åŠ ç´¢å¼•"></a>2.1.1 æ’åºå­—æ®µæ·»åŠ ç´¢å¼•</h5><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹å¯¹ d å­—æ®µï¼ˆæ²¡æœ‰ç´¢å¼•ï¼‰è¿›è¡Œæ’åºçš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> d<span class="token punctuation">,</span>id <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> d<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra          |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10236 |   100.00 | Using filesort |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°ä½¿ç”¨çš„æ˜¯ filesortï¼ˆå…³æ³¨ Extra å­—æ®µï¼‰ã€‚</p><p>å†çœ‹äº›å¯¹ c å­—æ®µï¼ˆæœ‰ç´¢å¼•ï¼‰è¿›è¡Œæ’åºçš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> c<span class="token punctuation">,</span>id <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> c<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx_c | 5       | NULL | 10236 |   100.00 | Using index |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®æœ‰ç´¢å¼•çš„å­—æ®µæ’åºï¼Œåœ¨ Extra ä¸­æ˜¾ç¤ºçš„å°±ä¸º Using indexï¼Œè¡¨ç¤ºä½¿ç”¨çš„æ˜¯ç´¢å¼•æ’åºã€‚</p><p><strong>å› æ­¤å¯ä»¥åœ¨æ’åºå­—æ®µä¸Šæ·»åŠ ç´¢å¼•æ¥ä¼˜åŒ–æ’åºè¯­å¥ã€‚</strong></p><h5 id="2-1-2-å¤šä¸ªå­—æ®µæ’åºä¼˜åŒ–"><a href="#2-1-2-å¤šä¸ªå­—æ®µæ’åºä¼˜åŒ–" class="headerlink" title="2.1.2 å¤šä¸ªå­—æ®µæ’åºä¼˜åŒ–"></a>2.1.2 å¤šä¸ªå­—æ®µæ’åºä¼˜åŒ–</h5><p>æœ‰æ—¶é¢å¯¹çš„éœ€æ±‚æ˜¯è¦å¯¹å¤šä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œè€Œè¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆä¼˜åŒ–æˆ–è€…è®¾è®¡ç´¢å¼•å‘¢ï¼Ÿé¦–å…ˆçœ‹ä¸‹é¢ä¾‹å­ï¼š</p><p>å¯¹ aã€c ä¸¤ä¸ªå­—æ®µè¿›è¡Œæ’åºçš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>c <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> a<span class="token punctuation">,</span>c<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra          |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10236 |   100.00 | Using filesort |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§‚å¯Ÿ Extra å­—æ®µï¼Œå‘ç°ä½¿ç”¨çš„æ˜¯ filesortã€‚</p><p>å†çœ‹å¯¹ aã€bï¼ˆaã€b ä¸¤ä¸ªå­—æ®µæœ‰è”åˆç´¢å¼•ï¼‰ä¸¤ä¸ªå­—æ®µè¿›è¡Œæ’åºï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> a<span class="token punctuation">,</span>b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx_a_b | 10      | NULL | 10236 |   100.00 | Using index |+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°ä½¿ç”¨çš„æ˜¯ç´¢å¼•æ’åºã€‚</p><p>å¤šä¸ªå­—æ®µæ’åºçš„æƒ…å†µï¼Œå¦‚æœè¦é€šè¿‡æ·»åŠ ç´¢å¼•ä¼˜åŒ–ï¼Œå¾—æ³¨æ„æ’åºå­—æ®µçš„é¡ºåºä¸è”åˆç´¢å¼•ä¸­åˆ—çš„é¡ºåºè¦ä¸€è‡´ã€‚</p><p>å› æ­¤ï¼Œ<strong>å¦‚æœå¤šä¸ªå­—æ®µæ’åºï¼Œå¯ä»¥åœ¨å¤šä¸ªæ’åºå­—æ®µä¸Šæ·»åŠ è”åˆç´¢å¼•æ¥ä¼˜åŒ–æ’åºè¯­å¥ã€‚</strong></p><h5 id="2-1-3-å…ˆç­‰å€¼æŸ¥è¯¢å†æ’åºçš„ä¼˜åŒ–"><a href="#2-1-3-å…ˆç­‰å€¼æŸ¥è¯¢å†æ’åºçš„ä¼˜åŒ–" class="headerlink" title="2.1.3 å…ˆç­‰å€¼æŸ¥è¯¢å†æ’åºçš„ä¼˜åŒ–"></a>2.1.3 å…ˆç­‰å€¼æŸ¥è¯¢å†æ’åºçš„ä¼˜åŒ–</h5><p>æˆ‘ä»¬æ›´å¤šçš„æƒ…å†µæ˜¯ä¼šå…ˆæ ¹æ®æŸä¸ªå­—æ®µæ¡ä»¶æŸ¥å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼Œç„¶åå†æ’åºï¼Œè€Œè¿™ç±» SQL åº”è¯¥å¦‚æœä¼˜åŒ–å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„å®éªŒï¼š</p><p>è¡¨ t1ä¸­ï¼Œæ ¹æ® a=1000 è¿‡æ»¤æ•°æ®å†æ ¹æ® d å­—æ®µæ’åºçš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>d <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1000</span> <span class="token keyword">order</span> <span class="token keyword">by</span> d<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key     | key_len | ref   | rows | filtered | Extra          |+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+----------------+|  1 | SIMPLE      | t1    | NULL       | ref  | idx_a_b       | idx_a_b | 5       | const | 1001 |   100.00 | Using filesort |+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥åœ¨ Extra å­—æ®µä¸­çœ‹åˆ° â€œUsing filesortâ€ï¼Œè¯´æ˜ä½¿ç”¨çš„æ˜¯ filesort æ’åºã€‚</p><p>å†çœ‹ä¸‹æ ¹æ® a=1000 è¿‡æ»¤æ•°æ®åœ¨æ ¹æ® b å­—æ®µæ’åºçš„æ‰§è¡Œè®¡åˆ’ï¼ˆaã€b ä¸¤ä¸ªå­—æ®µæœ‰è”åˆç´¢å¼•ï¼‰ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1000</span> <span class="token keyword">order</span> <span class="token keyword">by</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key     | key_len | ref   | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | ref  | idx_a_b       | idx_a_b | 5       | const | 1001 |   100.00 | Using index |+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥åœ¨ Extra å­—æ®µä¸­çœ‹åˆ°â€œUsing indexâ€ï¼Œè¯´æ˜ä½¿ç”¨çš„æ˜¯ç´¢å¼•æ’åºã€‚</p><p>å› æ­¤ï¼Œå¯¹äºå…ˆç­‰å€¼æŸ¥è¯¢å†æ’åºçš„è¯­å¥ï¼Œå¯ä»¥é€šè¿‡åœ¨æ¡ä»¶å­—æ®µå’Œæ’åºå­—æ®µæ·»åŠ è”åˆç´¢å¼•æ¥ä¼˜åŒ–æ­¤ç±»æ’åºè¯­å¥ã€‚</p><h4 id="2-2-å»æ‰ä¸å¿…è¦çš„è¿”å›å­—æ®µ"><a href="#2-2-å»æ‰ä¸å¿…è¦çš„è¿”å›å­—æ®µ" class="headerlink" title="2.2 å»æ‰ä¸å¿…è¦çš„è¿”å›å­—æ®µ"></a>2.2 å»æ‰ä¸å¿…è¦çš„è¿”å›å­—æ®µ</h4><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦æŸ¥è¯¢å‡ºæ‰€æœ‰å­—æ®µï¼Œä½†æ˜¯å¯èƒ½å› ä¸ºä¹ æƒ¯é—®é¢˜ï¼Œå°±å†™æˆæŸ¥æ‰€æœ‰å­—æ®µçš„æ•°æ®äº†ã€‚æˆ‘ä»¬çœ‹ä¸‹ä¸‹é¢ä¸¤æ¡ SQL çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> a<span class="token punctuation">,</span>b<span class="token punctuation">;</span>           <span class="token comment">/* æ ¹æ®aå’Œbå­—æ®µæ’åºæŸ¥å‡ºæ‰€æœ‰å­—æ®µçš„å€¼ */</span><span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> a<span class="token punctuation">,</span>b<span class="token punctuation">;</span>      <span class="token comment">/* æ ¹æ®aå’Œbå­—æ®µæ’åºæŸ¥å‡ºid,a,bå­—æ®µçš„å€¼ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; explain select * from t1 order by a,b;+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra          |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10236 |   100.00 | Using filesort |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+----------------+1 row in set, 1 warning (0.00 sec)mysql&gt; explain select id,a,b from t1 order by a,b;+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx_a_b | 10      | NULL | 10236 |   100.00 | Using index |+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-------------+1 row in set, 1 warning (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢æ‰€æœ‰å­—æ®µä¸èµ°ç´¢å¼•çš„åŸå› æ˜¯ï¼šæ‰«ææ•´ä¸ªç´¢å¼•å¹¶æŸ¥æ‰¾åˆ°æ²¡ç´¢å¼•çš„è¡Œçš„æˆæœ¬æ¯”æ‰«æå…¨è¡¨çš„æˆæœ¬æ›´é«˜ï¼Œæ‰€ä»¥ä¼˜åŒ–å™¨æ”¾å¼ƒä½¿ç”¨ç´¢å¼•ã€‚</p><h4 id="2-3-ä¿®æ”¹å‚æ•°"><a href="#2-3-ä¿®æ”¹å‚æ•°" class="headerlink" title="2.3 ä¿®æ”¹å‚æ•°"></a>2.3 ä¿®æ”¹å‚æ•°</h4><p>åœ¨æœ¬èŠ‚ä¸€å¼€å§‹è®² order by åŸç†çš„æ—¶å€™ï¼Œæ¥è§¦åˆ°ä¸¤ä¸ªè·Ÿæ’åºæœ‰å…³çš„å‚æ•°ï¼šmax_length_for_sort_dataã€sort_buffer_sizeã€‚</p><ul><li>max_length_for_sort_dataï¼šå¦‚æœè§‰å¾—æ’åºæ•ˆç‡æ¯”è¾ƒä½ï¼Œå¯ä»¥é€‚å½“åŠ å¤§ max_length_for_sort_data çš„å€¼ï¼Œè®©ä¼˜åŒ–å™¨ä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºã€‚å½“ç„¶ä¸èƒ½è®¾ç½®è¿‡å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´ CPU åˆ©ç”¨ç‡è¿‡ä½æˆ–è€…ç£ç›˜ I/O è¿‡é«˜ï¼›</li><li>sort_buffer_sizeï¼šé€‚å½“åŠ å¤§ sort_buffer_size çš„å€¼ï¼Œå°½å¯èƒ½è®©æ’åºåœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†ä¸èƒ½è®¾ç½®è¿‡å¤§ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åº“æœåŠ¡å™¨ SWAPã€‚</li></ul><h4 id="2-4-å‡ ç§æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºçš„æƒ…å†µ"><a href="#2-4-å‡ ç§æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºçš„æƒ…å†µ" class="headerlink" title="2.4 å‡ ç§æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºçš„æƒ…å†µ"></a>2.4 å‡ ç§æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºçš„æƒ…å†µ</h4><h5 id="2-4-1-ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº"><a href="#2-4-1-ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº" class="headerlink" title="2.4.1 ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº"></a>2.4.1 ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº</h5><p>åœ¨æœ¬èŠ‚ 2.1.3 ä¸­ä»‹ç»è¿‡ï¼Œå¯¹äºå…ˆç­‰å€¼è¿‡æ»¤å†æ’åºçš„è¯­å¥ï¼Œå¯ä»¥é€šè¿‡åœ¨æ¡ä»¶å­—æ®µå’Œæ’åºå­—æ®µæ·»åŠ è”åˆç´¢å¼•æ¥ä¼˜åŒ–ï¼›ä½†æ˜¯å¦‚æœè”åˆç´¢å¼•ä¸­å‰é¢çš„å­—æ®µä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼Œå¯¹åé¢çš„å­—æ®µæ’åºæ˜¯å¦èƒ½ç”¨åˆ°ç´¢å¼•æ’åºå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬é€šè¿‡å®éªŒéªŒè¯ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> t1 <span class="token keyword">where</span> a<span class="token operator">&gt;</span><span class="token number">9000</span> <span class="token keyword">order</span> <span class="token keyword">by</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+------------------------------------------+| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra                                    |+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+------------------------------------------+|  1 | SIMPLE      | t1    | NULL       | range | idx_a_b       | idx_a_b | 5       | NULL |    1 |   100.00 | Using where; Using index; Using filesort |+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œå¯¹ä¸Šé¢æ‰§è¡Œè®¡åˆ’åšä¸‹è§£é‡Šï¼šé¦–å…ˆæ¡ä»¶ a&gt;9000 ä½¿ç”¨äº†ç´¢å¼•ï¼ˆå…³æ³¨ key å­—æ®µå¯¹åº”çš„å€¼ä¸º idx_a_bï¼‰ï¼›åœ¨ Extra ä¸­ï¼Œçœ‹åˆ°äº†â€œUsing filesortâ€ï¼Œè¡¨ç¤ºä½¿ç”¨äº† filesort æ’åºï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•æ’åºã€‚æ‰€ä»¥è”åˆç´¢å¼•ä¸­å‰é¢çš„å­—æ®µä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼Œå¯¹åé¢çš„å­—æ®µæ’åºä½¿ç”¨ä¸äº†ç´¢å¼•æ’åºã€‚</p><p>åŸå› æ˜¯ï¼šaã€b ä¸¤ä¸ªå­—æ®µçš„è”åˆç´¢å¼•ï¼Œå¯¹äºå•ä¸ª a çš„å€¼ï¼Œb æ˜¯æœ‰åºçš„ã€‚è€Œå¯¹äº a å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ a å­—æ®µä¼šæœ‰å¤šä¸ªå€¼ï¼Œå–åˆ° aï¼Œb çš„å€¼ b å°±ä¸ä¸€å®šæœ‰åºäº†ï¼Œå› æ­¤è¦é¢å¤–è¿›è¡Œæ’åºã€‚è”åˆç´¢å¼•ç»“æœå¦‚ä¸‹å›¾ï¼ˆä¸ºäº†ä¾¿äºç†è§£ï¼Œè¯¥å›¾çš„å€¼ä¸ä¸Šé¢æ‰€åˆ›å»ºçš„è¡¨ t1 æ•°æ®ä¸ä¸€æ ·ï¼‰ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº.png" alt="ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯¹äºæœ‰ aã€b ä¸¤ä¸ªå­—æ®µè”åˆç´¢å¼•çš„è¡¨ï¼Œå¦‚æœå¯¹ a å­—æ®µèŒƒå›´æŸ¥è¯¢ï¼Œb å­—æ®µæ•´ä½“æ¥çœ‹æ˜¯æ— åºçš„ï¼ˆå¦‚ä¸Šå›¾ b çš„å€¼ä¸ºï¼š1ï¼Œ2ï¼Œ3ï¼Œ1ï¼Œ2ï¼Œ3Â·Â·Â·Â·Â·Â·ï¼‰ã€‚</p><h5 id="2-4-2-ASC-å’Œ-DESC-æ··åˆä½¿ç”¨å°†æ— æ³•ä½¿ç”¨ç´¢å¼•"><a href="#2-4-2-ASC-å’Œ-DESC-æ··åˆä½¿ç”¨å°†æ— æ³•ä½¿ç”¨ç´¢å¼•" class="headerlink" title="2.4.2 ASC å’Œ DESC æ··åˆä½¿ç”¨å°†æ— æ³•ä½¿ç”¨ç´¢å¼•"></a>2.4.2 ASC å’Œ DESC æ··åˆä½¿ç”¨å°†æ— æ³•ä½¿ç”¨ç´¢å¼•</h5><p>å¯¹è”åˆç´¢å¼•å¤šä¸ªå­—æ®µåŒæ—¶æ’åºæ—¶ï¼Œå¦‚æœä¸€ä¸ªæ˜¯é¡ºåºï¼Œä¸€ä¸ªæ˜¯å€’åºï¼Œåˆ™ä½¿ç”¨ä¸äº†ç´¢å¼•ï¼Œå¦‚ä¸‹ä¾‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> a <span class="token keyword">asc</span><span class="token punctuation">,</span>b <span class="token keyword">desc</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-----------------------------+| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows  | filtered | Extra                       |+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-----------------------------+|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx_a_b | 10      | NULL | 10236 |   100.00 | Using index; Using filesort |+----+-------------+-------+------------+-------+---------------+---------+---------+------+-------+----------+-----------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-group-by-ä¼˜åŒ–"><a href="#3-group-by-ä¼˜åŒ–" class="headerlink" title="3 group by ä¼˜åŒ–"></a>3 group by ä¼˜åŒ–</h3><p>é»˜è®¤æƒ…å†µï¼Œä¼šå¯¹ group by å­—æ®µæ’åºï¼Œå› æ­¤ä¼˜åŒ–æ–¹å¼ä¸ order by åŸºæœ¬ä¸€è‡´ï¼Œå¦‚æœç›®çš„åªæ˜¯åˆ†ç»„è€Œä¸ç”¨æ’åºï¼Œå¯ä»¥æŒ‡å®š order by null ç¦æ­¢æ’åºã€‚</p><h3 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4 æ€»ç»“"></a>4 æ€»ç»“</h3><p>é¦–å…ˆè¯´åˆ° MySQL çš„ä¸¤ç§æ’åºæ–¹å¼ï¼š</p><ul><li>é€šè¿‡æœ‰åºç´¢å¼•ç›´æ¥è¿”å›æœ‰åºæ•°æ®</li><li>é€šè¿‡ Filesort è¿›è¡Œæ’åº</li></ul><p>å»ºè®®ä¼˜å…ˆè€ƒè™‘ç´¢å¼•æ’åºã€‚</p><p>è€ŒFilesortåˆåˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>å†…å­˜æ’åº</li><li>ç£ç›˜æ–‡ä»¶æ’åº</li></ul><p>ä¼˜å…ˆè€ƒè™‘å†…å­˜æ’åºã€‚</p><p>Filesort æœ‰ä¸‰ç§æ’åºæ¨¡å¼ï¼š</p><ul><li>&lt; sort_key, rowid &gt;</li><li>&lt; sort_key, additional_fields &gt;</li><li>&lt; sort_key, packed_additional_fields &gt;</li></ul><p><strong>order by è¯­å¥çš„ä¼˜åŒ–ï¼Œè¿™ä¸ªæ˜¯æœ¬èŠ‚çš„é‡ç‚¹ï¼š</strong></p><ul><li>é€šè¿‡æ·»åŠ åˆé€‚ç´¢å¼•</li><li>å»æ‰ä¸å¿…è¦çš„è¿”å›å­—æ®µ</li><li>è°ƒæ•´å‚æ•°ï¼šä¸»è¦æ˜¯ max_length_for_sort_data å’Œ sort_buffer_size</li><li>é¿å…å‡ ç§æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åºçš„æƒ…å†µ</li></ul><p>æœ€åè¯´åˆ° group by è¯­å¥çš„ä¼˜åŒ–ï¼Œå¦‚æœåªè¦åˆ†ç»„ï¼Œæ²¡æœ‰æ’åºéœ€æ±‚çš„è¯ï¼Œå¯ä»¥åŠ  order by null ç¦æ­¢æ’åºã€‚</p><h2 id="07-æ¢ç§æ€è·¯å†™åˆ†é¡µæŸ¥è¯¢"><a href="#07-æ¢ç§æ€è·¯å†™åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="07 æ¢ç§æ€è·¯å†™åˆ†é¡µæŸ¥è¯¢"></a><strong>07 æ¢ç§æ€è·¯å†™åˆ†é¡µæŸ¥è¯¢</strong></h2><p>å¾ˆå¤šæ—¶å€™ï¼Œä¸šåŠ¡ä¸Šä¼šæœ‰åˆ†é¡µæ“ä½œçš„éœ€æ±‚ï¼Œå¯¹åº”çš„ SQL ç±»ä¼¼ä¸‹é¢è¿™æ¡ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c <span class="token keyword">from</span> t1 <span class="token keyword">limit</span> <span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¡¨ç¤ºä»è¡¨ t1 ä¸­å–å‡ºä» 10001 è¡Œå¼€å§‹çš„ 10 è¡Œè®°å½•ã€‚çœ‹ä¼¼åªæŸ¥è¯¢äº† 10 æ¡è®°å½•ï¼Œå®é™…è¿™æ¡ SQL æ˜¯å…ˆè¯»å– 10010 æ¡è®°å½•ï¼Œç„¶åæŠ›å¼ƒå‰ 10000 æ¡è®°å½•ï¼Œç„¶åè¯»åˆ°åé¢ 10 æ¡æƒ³è¦çš„æ•°æ®ã€‚å› æ­¤è¦æŸ¥è¯¢ä¸€å¼ å¤§è¡¨æ¯”è¾ƒé åçš„æ•°æ®ï¼Œæ‰§è¡Œæ•ˆç‡æ˜¯éå¸¸ä½çš„ã€‚æœ¬èŠ‚å†…å®¹å°±ä¸€èµ·ç ”ç©¶ä¸‹ï¼Œæ˜¯å¦æœ‰åŠæ³•å»ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿éªŒè¯ï¼Œé¦–å…ˆåˆ›å»ºæµ‹è¯•è¡¨å¹¶å†™å…¥æ•°æ®ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span>                       <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t1<span class="token punctuation">;</span>        <span class="token comment">/* å¦‚æœè¡¨t1å­˜åœ¨åˆ™åˆ é™¤è¡¨t1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t1<span class="token punctuation">`</span> <span class="token punctuation">(</span>             <span class="token comment">/* åˆ›å»ºè¡¨t1 */</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•åˆ›å»ºæ—¶é—´'</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•æ›´æ–°æ—¶é—´'</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">begin</span>    <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span>                    <span class="token comment">/* å£°æ˜å˜é‡i */</span>    <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                          <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span>                  <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=100000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span>        <span class="token keyword">insert</span> <span class="token keyword">into</span> t1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t1ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span>        <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                      <span class="token comment">/* å°†iåŠ 1 */</span>    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span>                 <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥10000æ¡æ•°æ®åˆ°è¡¨t1çš„å­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">call</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-æ ¹æ®è‡ªå¢ä¸”è¿ç»­ä¸»é”®æ’åºçš„åˆ†é¡µæŸ¥è¯¢"><a href="#1-æ ¹æ®è‡ªå¢ä¸”è¿ç»­ä¸»é”®æ’åºçš„åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="1 æ ¹æ®è‡ªå¢ä¸”è¿ç»­ä¸»é”®æ’åºçš„åˆ†é¡µæŸ¥è¯¢"></a>1 æ ¹æ®è‡ªå¢ä¸”è¿ç»­ä¸»é”®æ’åºçš„åˆ†é¡µæŸ¥è¯¢</h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸ªæ ¹æ®è‡ªå¢ä¸”è¿ç»­ä¸»é”®æ’åºçš„åˆ†é¡µæŸ¥è¯¢çš„ä¾‹å­ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">limit</span> <span class="token number">9000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯¥ SQL è¡¨ç¤ºæŸ¥è¯¢ä»ç¬¬ 9001 å¼€å§‹çš„ä¸¤è¡Œæ•°æ®ï¼Œæ²¡æ·»åŠ å•ç‹¬ order byï¼Œè¡¨ç¤ºé€šè¿‡ä¸»é”®æ’åºã€‚æˆ‘ä»¬å†çœ‹è¡¨ t1ï¼Œå› ä¸ºä¸»é”®æ˜¯è‡ªå¢å¹¶ä¸”è¿ç»­çš„ï¼Œæ‰€ä»¥å¯ä»¥æ”¹å†™æˆæŒ‰ç…§ä¸»é”®å»æŸ¥è¯¢ä»ç¬¬ 9001å¼€å§‹çš„ä¸¤è¡Œæ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">where</span> id <span class="token operator">&gt;</span><span class="token number">9000</span> <span class="token keyword">limit</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚æˆ‘ä»¬å†å¯¹æ¯”ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; explain select * from t1 limit 9000,2;+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 9963 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+1 row in set, 1 warning (0.00 sec)mysql&gt; explain select * from t1 where id &gt;9000 limit 2;+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL | 1000 |   100.00 | Using where |+----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+1 row in set, 1 warning (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸ SQL ä¸­ key å­—æ®µä¸º NULLï¼Œè¡¨ç¤ºæœªèµ°ç´¢å¼•ï¼Œrows æ˜¾ç¤º 9963ï¼Œè¡¨ç¤ºæ‰«æçš„è¡Œæ•° 9963è¡Œï¼›</p><p>æ”¹å†™åçš„ SQL key å­—æ®µä¸º PRIMARYï¼Œè¡¨ç¤ºèµ°äº†ä¸»é”®ç´¢å¼•ï¼Œæ‰«æäº†1000è¡Œã€‚</p><p>æ˜¾ç„¶æ”¹å†™åçš„ SQL æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚</p><p>å¦å¤–å¦‚æœåŸ SQL æ˜¯ order by éä¸»é”®çš„å­—æ®µï¼ŒæŒ‰ç…§ä¸Šé¢è¯´çš„æ–¹æ³•æ”¹å†™ä¼šå¯¼è‡´ä¸¤æ¡ SQL çš„ç»“æœä¸ä¸€è‡´ã€‚æ‰€ä»¥è¿™ç§æ”¹å†™å¾—æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>ä¸»é”®è‡ªå¢ä¸”è¿ç»­</li><li>ç»“æœæ˜¯æŒ‰ç…§ä¸»é”®æ’åºçš„</li></ul><h3 id="2-æŸ¥è¯¢æ ¹æ®éä¸»é”®å­—æ®µæ’åºçš„åˆ†é¡µæŸ¥è¯¢"><a href="#2-æŸ¥è¯¢æ ¹æ®éä¸»é”®å­—æ®µæ’åºçš„åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2 æŸ¥è¯¢æ ¹æ®éä¸»é”®å­—æ®µæ’åºçš„åˆ†é¡µæŸ¥è¯¢"></a>2 æŸ¥è¯¢æ ¹æ®éä¸»é”®å­—æ®µæ’åºçš„åˆ†é¡µæŸ¥è¯¢</h3><p>å†çœ‹ä¸€ä¸ªæ ¹æ®éä¸»é”®å­—æ®µæ’åºçš„åˆ†é¡µæŸ¥è¯¢ï¼ŒSQL å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> a <span class="token keyword">limit</span> <span class="token number">9000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹ä¸‹è¿™æ¡ SQL çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+|  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 9963 |   100.00 | Using filesort |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°å¹¶æ²¡æœ‰ä½¿ç”¨ a å­—æ®µçš„ç´¢å¼•ï¼ˆkey å­—æ®µå¯¹åº”çš„å€¼ä¸º nullï¼‰ï¼Œå…·ä½“åŸå› ï¼š<strong>æ‰«ææ•´ä¸ªç´¢å¼•å¹¶æŸ¥æ‰¾åˆ°æ²¡ç´¢å¼•çš„è¡Œçš„æˆæœ¬æ¯”æ‰«æå…¨è¡¨çš„æˆæœ¬æ›´é«˜ï¼Œæ‰€ä»¥ä¼˜åŒ–å™¨æ”¾å¼ƒä½¿ç”¨ç´¢å¼•</strong>ã€‚</p><p>çŸ¥é“ä¸èµ°ç´¢å¼•çš„åŸå› ï¼Œé‚£ä¹ˆæ€ä¹ˆä¼˜åŒ–å‘¢ï¼Ÿ</p><p>å…¶å®å…³é”®æ˜¯<strong>è®©æ’åºæ—¶è¿”å›çš„å­—æ®µå°½å¯èƒ½å°‘</strong>ï¼Œæ‰€ä»¥å¯ä»¥è®©æ’åºå’Œåˆ†é¡µæ“ä½œå…ˆæŸ¥å‡ºä¸»é”®ï¼Œç„¶åæ ¹æ®ä¸»é”®æŸ¥åˆ°å¯¹åº”çš„è®°å½•ï¼ŒSQL æ”¹å†™å¦‚ä¸‹ï¼ˆè¿™é‡Œå‚è€ƒäº†ã€Šæ·±å…¥æµ…å‡º MySQLã€‹18.4.7 ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢ï¼‰ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 f <span class="token keyword">inner</span> <span class="token keyword">join</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> a <span class="token keyword">limit</span> <span class="token number">9000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>g <span class="token keyword">on</span> f<span class="token punctuation">.</span>id <span class="token operator">=</span> g<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹ä¸‹è¿™æ¡ SQL çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+------------+------------+--------+---------------+---------+---------+------+------+----------+-------------+| id | select_type | table      | partitions | type   | possible_keys | key     | key_len | ref  | rows | filtered | Extra       |+----+-------------+------------+------------+--------+---------------+---------+---------+------+------+----------+-------------+|  1 | PRIMARY     | &lt;derived2&gt; | NULL       | ALL    | NULL          | NULL    | NULL    | NULL | 9002 |   100.00 | NULL        ||  1 | PRIMARY     | f          | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | g.id |    1 |   100.00 | NULL        ||  2 | DERIVED     | t1         | NULL       | index  | NULL          | idx_a   | 5       | NULL | 9002 |   100.00 | Using index |+----+-------------+------------+------------+--------+---------------+---------+---------+------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸ SQL ä½¿ç”¨çš„æ˜¯ filesort æ’åºï¼Œè€Œä¼˜åŒ–åçš„ SQL ä½¿ç”¨çš„æ˜¯ç´¢å¼•æ’åºã€‚</p><h2 id="08-Joinè¯­å¥å¯ä»¥è¿™æ ·ä¼˜åŒ–"><a href="#08-Joinè¯­å¥å¯ä»¥è¿™æ ·ä¼˜åŒ–" class="headerlink" title="08 Joinè¯­å¥å¯ä»¥è¿™æ ·ä¼˜åŒ–"></a><strong>08 Joinè¯­å¥å¯ä»¥è¿™æ ·ä¼˜åŒ–</strong></h2><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œé¦–å…ˆåˆ›å»ºæµ‹è¯•è¡¨å¹¶å†™å…¥æµ‹è¯•æ•°æ®ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> muke<span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºæµ‹è¯•ä½¿ç”¨çš„databaseï¼Œåä¸ºmuke */</span><span class="token keyword">use</span> muke<span class="token punctuation">;</span> <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t1å­˜åœ¨åˆ™åˆ é™¤è¡¨t1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t1<span class="token punctuation">`</span> <span class="token punctuation">(</span> <span class="token comment">/* åˆ›å»ºè¡¨t1 */</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•åˆ›å»ºæ—¶é—´'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•æ›´æ–°æ—¶é—´'</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">begin</span><span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">/* å£°æ˜å˜é‡i */</span><span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span><span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span> <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=10000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t1ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span><span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* å°†iåŠ 1 */</span><span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥10000æ¡æ•°æ®åˆ°è¡¨t1çš„å­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">call</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t2<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t2å­˜åœ¨åˆ™åˆ é™¤è¡¨t2 */</span><span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t1<span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºè¡¨t2ï¼Œè¡¨ç»“æ„ä¸t1ä¸€è‡´ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">limit</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">/* å°†è¡¨t1çš„å‰100è¡Œæ•°æ®å¯¼å…¥åˆ°t2 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-å…³è”æŸ¥è¯¢çš„ç®—æ³•"><a href="#1-å…³è”æŸ¥è¯¢çš„ç®—æ³•" class="headerlink" title="1 å…³è”æŸ¥è¯¢çš„ç®—æ³•"></a>1 å…³è”æŸ¥è¯¢çš„ç®—æ³•</h3><p>MySQL ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§åµŒå¥—å¾ªç¯ç®—æ³•æˆ–å®ƒä»¬çš„å˜ä½“åœ¨è¡¨ä¹‹é—´æ‰§è¡Œè¿æ¥ï¼ˆå‚è€ƒ ã€Š<a href="https://dev.mysql.com/doc/refman/5.7/en/nested-loop-joins.html">MySQL 5.7 Reference Manualã€‹8.2.1.6 Nested-Loop Join Algorithms</a>ï¼‰ï¼š</p><ul><li>Nested-Loop Join ç®—æ³•</li><li>Block Nested-Loop Join ç®—æ³•</li></ul><p>å¦å¤–è¿˜æœ‰ä¸€ç§ç®—æ³• Batched Key Accessï¼Œå…¶å®ç®—å¯¹ Nested-Loop Join ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ã€‚</p><h4 id="1-1-Nested-Loop-Join-ç®—æ³•"><a href="#1-1-Nested-Loop-Join-ç®—æ³•" class="headerlink" title="1.1 Nested-Loop Join ç®—æ³•"></a>1.1 Nested-Loop Join ç®—æ³•</h4><p>ä¸€ä¸ªç®€å•çš„ Nested-Loop Join(NLJ) ç®—æ³•ä¸€æ¬¡ä¸€è¡Œå¾ªç¯åœ°ä»ç¬¬ä¸€å¼ è¡¨ï¼ˆç§°ä¸ºé©±åŠ¨è¡¨ï¼‰ä¸­è¯»å–è¡Œï¼Œåœ¨è¿™è¡Œæ•°æ®ä¸­å–åˆ°å…³è”å­—æ®µï¼Œæ ¹æ®å…³è”å­—æ®µåœ¨å¦ä¸€å¼ è¡¨ï¼ˆè¢«é©±åŠ¨è¡¨ï¼‰é‡Œå–å‡ºæ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œç„¶åå–å‡ºä¸¤å¼ è¡¨çš„ç»“æœåˆé›†ã€‚</p><p>æˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåœ¨è¢«é©±åŠ¨è¡¨ä¸­è¿™ä¸ªå…³è”å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¯æ¬¡å–å‡ºé©±åŠ¨è¡¨çš„å…³è”å­—æ®µåœ¨è¢«é©±åŠ¨è¡¨æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®æ—¶ï¼Œéƒ½ä¼šå¯¹è¢«é©±åŠ¨è¡¨åšä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œæˆæœ¬æ˜¯éå¸¸é«˜çš„ï¼ˆæ¯”å¦‚é©±åŠ¨è¡¨æ•°æ®é‡æ˜¯ mï¼Œè¢«é©±åŠ¨è¡¨æ•°æ®é‡æ˜¯ nï¼Œåˆ™æ‰«æè¡Œæ•°ä¸º m * n ï¼‰ã€‚</p><p>å¥½åœ¨ MySQL åœ¨å…³è”å­—æ®µæœ‰ç´¢å¼•æ—¶ï¼Œæ‰ä¼šä½¿ç”¨ NLJï¼Œå¦‚æœæ²¡ç´¢å¼•ï¼Œå°±ä¼šä½¿ç”¨ Block Nested-Loop Joinï¼Œç­‰ä¸‹ä¼šç»†è¯´è¿™ä¸ªç®—æ³•ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹åœ¨æœ‰ç´¢å¼•æƒ…å†µçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Nested-Loop Join çš„åœºæ™¯ï¼ˆç§°ä¸ºï¼šIndex Nested-Loop Joinï¼‰ã€‚</p><p>å› ä¸º MySQL åœ¨å…³è”å­—æ®µæœ‰ç´¢å¼•æ—¶ï¼Œæ‰ä¼šä½¿ç”¨ NLJï¼Œå› æ­¤æœ¬èŠ‚åé¢çš„å†…å®¹æ‰€ç”¨åˆ°çš„ NLJ éƒ½è¡¨ç¤º Index Nested-Loop Joinã€‚</p><p>å¦‚ä¸‹ä¾‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">inner</span> <span class="token keyword">join</span> t2 <span class="token keyword">on</span> t1<span class="token punctuation">.</span>a <span class="token operator">=</span> t2<span class="token punctuation">.</span>a<span class="token punctuation">;</span>       <span class="token comment">/* sql1 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>è¡¨ t1 å’Œè¡¨ t2 ä¸­çš„ a å­—æ®µéƒ½æœ‰ç´¢å¼•ã€‚</p></blockquote><p>æ€ä¹ˆç¡®å®šè¿™æ¡ SQL ä½¿ç”¨çš„æ˜¯ NLJ ç®—æ³•ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ sql1 çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-------+---------+-----------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref       | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+-------+---------+-----------+------+----------+-------------+|  1 | SIMPLE      | t2    | NULL       | ALL  | idx_a         | NULL  | NULL    | NULL      |  100 |   100.00 | Using where ||  1 | SIMPLE      | t1    | NULL       | ref  | idx_a         | idx_a | 5       | muke.t2.a |    1 |   100.00 | NULL        |+----+-------------+-------+------------+------+---------------+-------+---------+-----------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»æ‰§è¡Œè®¡åˆ’ä¸­å¯ä»¥çœ‹åˆ°è¿™äº›ä¿¡æ¯ï¼š</p><ul><li>é©±åŠ¨è¡¨æ˜¯ t2ï¼Œè¢«é©±åŠ¨è¡¨æ˜¯ t1ã€‚åŸå› æ˜¯ï¼šexplain åˆ†æ join è¯­å¥æ—¶ï¼Œåœ¨ç¬¬ä¸€è¡Œçš„å°±æ˜¯é©±åŠ¨è¡¨ï¼›é€‰æ‹© t2 åšé©±åŠ¨è¡¨çš„åŸå› ï¼šå¦‚æœæ²¡å›ºå®šè¿æ¥æ–¹å¼ï¼ˆæ¯”å¦‚æ²¡åŠ  straight_joinï¼‰ä¼˜åŒ–å™¨ä¼šä¼˜å…ˆé€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨ã€‚<strong>æ‰€ä»¥ä½¿ç”¨ inner join æ—¶ï¼Œå‰é¢çš„è¡¨å¹¶ä¸ä¸€å®šå°±æ˜¯é©±åŠ¨è¡¨ã€‚</strong></li><li>ä½¿ç”¨äº† NLJã€‚åŸå› æ˜¯ï¼šä¸€èˆ¬ join è¯­å¥ä¸­ï¼Œå¦‚æœæ‰§è¡Œè®¡åˆ’ Extra ä¸­æœªå‡ºç° Using join buffer ï¼ˆ<em>*</em>ï¼‰ï¼›åˆ™è¡¨ç¤ºä½¿ç”¨çš„ join ç®—æ³•æ˜¯ NLJã€‚</li></ul><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè¯»å– t2 è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œå› æ­¤è¿™é‡Œæ‰«æäº† 100 è¡Œï¼Œç„¶åéå†è¿™ 100 è¡Œæ•°æ®ä¸­å­—æ®µ a çš„å€¼ï¼Œæ ¹æ® t2 è¡¨ä¸­ a çš„å€¼ç´¢å¼•æ‰«æ t1 è¡¨ä¸­çš„å¯¹åº”è¡Œï¼Œè¿™é‡Œä¹Ÿæ‰«æäº† 100 è¡Œã€‚å› æ­¤æ•´ä¸ªè¿‡ç¨‹æ‰«æäº† 200 è¡Œã€‚</p><p>åœ¨å‰é¢ï¼Œæˆ‘ä»¬æœ‰è¯´åˆ°ï¼šå¦‚æœè¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µæ²¡ç´¢å¼•ï¼Œå°±ä¼šä½¿ç”¨ Block Nested-Loop Join(ç®€ç§°ï¼šBNL)ï¼Œä¸ºä»€ä¹ˆä¼šé€‰æ‹©ä½¿ç”¨ BNL ç®—æ³•è€Œä¸ç»§ç»­ä½¿ç”¨ Nested-Loop Joinå‘¢ï¼Ÿä¸‹é¢å°±ä¸€èµ·åˆ†æä¸‹ï¼š</p><h4 id="1-2-Block-Nested-Loop-Join-ç®—æ³•"><a href="#1-2-Block-Nested-Loop-Join-ç®—æ³•" class="headerlink" title="1.2 Block Nested-Loop Join ç®—æ³•"></a>1.2 Block Nested-Loop Join ç®—æ³•</h4><p>Block Nested-Loop Join(BNL) ç®—æ³•çš„æ€æƒ³æ˜¯ï¼šæŠŠé©±åŠ¨è¡¨çš„æ•°æ®è¯»å…¥åˆ° join_buffer ä¸­ï¼Œç„¶åæ‰«æè¢«é©±åŠ¨è¡¨ï¼ŒæŠŠè¢«é©±åŠ¨è¡¨æ¯ä¸€è¡Œå–å‡ºæ¥è·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”ï¼Œå¦‚æœæ»¡è¶³ join æ¡ä»¶ï¼Œåˆ™è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚</p><p>æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä¸‹é¢è¿™æ¡ SQL è¯­å¥ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">inner</span> <span class="token keyword">join</span> t2 <span class="token keyword">on</span> t1<span class="token punctuation">.</span>b <span class="token operator">=</span> t2<span class="token punctuation">.</span>b<span class="token punctuation">;</span>       <span class="token comment">/* sql2 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>è¡¨ t1 å’Œè¡¨ t2 ä¸­çš„ b å­—æ®µéƒ½æ²¡æœ‰ç´¢å¼•</p></blockquote><p>çœ‹ä¸‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+--------------------------------------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra                                      |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+--------------------------------------------+|  1 | SIMPLE      | t2    | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   100 |   100.00 | NULL                                       ||  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10225 |    10.00 | Using where; Using join buffer (hash join) |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+--------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ Extra å‘ç° Using join buffer (Block Nested Loop)ï¼Œè¿™ä¸ªå°±è¯´æ˜è¯¥å…³è”æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯ BNL ç®—æ³•ã€‚</p><p>æˆ‘ä»¬å†çœ‹ä¸‹ sql2 çš„æ‰§è¡Œæµç¨‹ï¼š</p><ol><li>æŠŠ t2 çš„æ‰€æœ‰æ•°æ®æ”¾å…¥åˆ° join_buffer ä¸­</li><li>æŠŠè¡¨ t1 ä¸­æ¯ä¸€è¡Œå–å‡ºæ¥ï¼Œè·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”</li><li>è¿”å›æ»¡è¶³ join æ¡ä»¶çš„æ•°æ®</li></ol><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯¹è¡¨ t1 å’Œ t2 éƒ½åšäº†ä¸€æ¬¡å…¨è¡¨æ‰«æï¼Œå› æ­¤æ‰«æçš„æ€»è¡Œæ•°ä¸º10000(è¡¨ t1 çš„æ•°æ®æ€»é‡) + 100(è¡¨ t2 çš„æ•°æ®æ€»é‡) = 10100ã€‚å¹¶ä¸” join_buffer é‡Œçš„æ•°æ®æ˜¯æ— åºçš„ï¼Œå› æ­¤å¯¹è¡¨ t1 ä¸­çš„æ¯ä¸€è¡Œï¼Œéƒ½è¦åš 100 æ¬¡åˆ¤æ–­ï¼Œæ‰€ä»¥å†…å­˜ä¸­çš„åˆ¤æ–­æ¬¡æ•°æ˜¯ 100 * 10000= 100 ä¸‡æ¬¡ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥å›ç­”ä¸Šé¢æå‡ºçš„ä¸€ä¸ªé—®é¢˜ï¼š</p><p>å¦‚æœè¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µæ²¡ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆä¼šé€‰æ‹©ä½¿ç”¨ BNL ç®—æ³•è€Œä¸ç»§ç»­ä½¿ç”¨ Nested-Loop Join å‘¢ï¼Ÿ</p><p>åœ¨è¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µæ²¡ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ sql2ï¼š</p><p>å¦‚æœä½¿ç”¨ Nested-Loop Joinï¼Œé‚£ä¹ˆæ‰«æè¡Œæ•°ä¸º 100 * 10000 = 100ä¸‡æ¬¡ï¼Œè¿™ä¸ªæ˜¯ç£ç›˜æ‰«æã€‚</p><p>å¦‚æœä½¿ç”¨ BNLï¼Œé‚£ä¹ˆç£ç›˜æ‰«ææ˜¯ 100 + 10000=10100 æ¬¡ï¼Œåœ¨å†…å­˜ä¸­åˆ¤æ–­ 100 * 10000 = 100ä¸‡æ¬¡ã€‚</p><p>æ˜¾ç„¶åè€…ç£ç›˜æ‰«æçš„æ¬¡æ•°å°‘å¾ˆå¤šï¼Œå› æ­¤æ˜¯æ›´ä¼˜çš„é€‰æ‹©ã€‚å› æ­¤å¯¹äº MySQL çš„å…³è”æŸ¥è¯¢ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µæ²¡ç´¢å¼•ï¼Œä¼šä½¿ç”¨ BNL ç®—æ³•ã€‚</p><h4 id="1-3-Batched-Key-Access-ç®—æ³•"><a href="#1-3-Batched-Key-Access-ç®—æ³•" class="headerlink" title="1.3 Batched Key Access ç®—æ³•"></a>1.3 Batched Key Access ç®—æ³•</h4><p>NLJ çš„å…³é”®æ€æƒ³æ˜¯ï¼šè¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µæœ‰ç´¢å¼•ã€‚</p><p>BNL çš„å…³é”®æ€æƒ³æ˜¯ï¼šæŠŠé©±åŠ¨è¡¨çš„æ•°æ®æ‰¹é‡æäº¤ä¸€éƒ¨åˆ†æ”¾åˆ° join_buffer ä¸­ã€‚</p><p>ä» MySQL 5.6 å¼€å§‹ï¼Œç¡®å®å‡ºç°äº†è¿™ç§é›† NLJ å’Œ BNL ä¸¤ç§ç®—æ³•ä¼˜ç‚¹äºä¸€ä½“çš„æ–°ç®—æ³•ï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/bnl-bka-optimization.html">Batched Key Access(BKA)</a>ã€‚</p><p>å…¶åŸç†æ˜¯ï¼š</p><ol><li>å°†é©±åŠ¨è¡¨ä¸­ç›¸å…³åˆ—æ”¾å…¥ join_buffer ä¸­</li><li>æ‰¹é‡å°†å…³è”å­—æ®µçš„å€¼å‘é€åˆ° Multi-Range Read(MRR) æ¥å£</li><li>MRR é€šè¿‡æ¥æ”¶åˆ°çš„å€¼ï¼Œæ ¹æ®å…¶å¯¹åº”çš„ä¸»é”® ID è¿›è¡Œæ’åºï¼Œç„¶åå†è¿›è¡Œæ•°æ®çš„è¯»å–å’Œæ“ä½œ</li><li>è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</li></ol><blockquote><p><strong>è¿™é‡Œè¡¥å……ä¸‹ MRR ç›¸å…³çŸ¥è¯†ï¼š</strong></p><p>å½“è¡¨å¾ˆå¤§å¹¶ä¸”æ²¡æœ‰å­˜å‚¨åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œä½¿ç”¨è¾…åŠ©ç´¢å¼•ä¸Šçš„èŒƒå›´æ‰«æè¯»å–è¡Œå¯èƒ½å¯¼è‡´å¯¹è¡¨æœ‰å¾ˆå¤šéšæœºè®¿é—®ã€‚</p><p>è€Œ Multi-Range Read ä¼˜åŒ–çš„è®¾è®¡æ€è·¯æ˜¯ï¼šæŸ¥è¯¢è¾…åŠ©ç´¢å¼•æ—¶ï¼Œå¯¹æŸ¥è¯¢ç»“æœå…ˆæŒ‰ç…§ä¸»é”®è¿›è¡Œæ’åºï¼Œå¹¶æŒ‰ç…§ä¸»é”®æ’åºåçš„é¡ºåºï¼Œè¿›è¡Œé¡ºåºæŸ¥æ‰¾ï¼Œä»è€Œå‡å°‘éšæœºè®¿é—®ç£ç›˜çš„æ¬¡æ•°ã€‚</p><p>ä½¿ç”¨ MRR æ—¶ï¼Œexplain è¾“å‡ºçš„ Extra åˆ—æ˜¾ç¤ºçš„æ˜¯ Using MRRã€‚</p><p>optimizer_switch ä¸­ mrr_cost_based å‚æ•°çš„å€¼ä¼šå½±å“ MRRã€‚</p><p>å¦‚æœ mrr_cost_based=onï¼Œè¡¨ç¤ºä¼˜åŒ–å™¨å°è¯•åœ¨ä½¿ç”¨å’Œä¸ä½¿ç”¨ MRR ä¹‹é—´è¿›è¡ŒåŸºäºæˆæœ¬çš„é€‰æ‹©ã€‚</p><p>å¦‚æœ mrr_cost_based=offï¼Œè¡¨ç¤ºä¸€ç›´ä½¿ç”¨ MRRã€‚</p><p>æ›´å¤š MRR ä¿¡æ¯è¯·å‚è€ƒå®˜æ–¹æ‰‹å†Œï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/mrr-optimization.htmlã€‚">https://dev.mysql.com/doc/refman/5.7/en/mrr-optimization.htmlã€‚</a></p></blockquote><p>ä¸‹é¢å°è¯•å¼€å¯ BKA ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> optimizer_switch<span class="token operator">=</span><span class="token string">'mrr=on,mrr_cost_based=off,batched_key_access=on'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œå¯¹ä¸Šé¢å‡ ä¸ªå‚æ•°åšä¸‹è§£é‡Šï¼š</p><ul><li>mrr=on å¼€å¯ mrr</li><li>mrr_cost_based=off ä¸éœ€è¦ä¼˜åŒ–å™¨åŸºäºæˆæœ¬è€ƒè™‘ä½¿ç”¨è¿˜æ˜¯ä¸ä½¿ç”¨ MRRï¼Œä¹Ÿå°±æ˜¯ä¸€ç›´ä½¿ç”¨ MRR</li><li>batched_key_access=on å¼€å¯ BKA</li></ul><p>ç„¶åå†çœ‹ sql1 çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">inner</span> <span class="token keyword">join</span> t2 <span class="token keyword">on</span> t1<span class="token punctuation">.</span>a <span class="token operator">=</span> t2<span class="token punctuation">.</span>a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-------+---------+-----------+------+----------+----------------------------------------+| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref       | rows | filtered | Extra                                  |+----+-------------+-------+------------+------+---------------+-------+---------+-----------+------+----------+----------------------------------------+|  1 | SIMPLE      | t2    | NULL       | ALL  | idx_a         | NULL  | NULL    | NULL      |  100 |   100.00 | Using where                            ||  1 | SIMPLE      | t1    | NULL       | ref  | idx_a         | idx_a | 5       | muke.t2.a |    1 |   100.00 | Using join buffer (Batched Key Access) |+----+-------------+-------+------------+------+---------------+-------+---------+-----------+------+----------+----------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ Extra å­—æ®µä¸­å‘ç°æœ‰ Using join buffer (Batched Key Access)ï¼Œè¡¨ç¤ºç¡®å®å˜æˆäº† BKA ç®—æ³•ã€‚</p><h3 id="2-ä¼˜åŒ–å…³è”æŸ¥è¯¢"><a href="#2-ä¼˜åŒ–å…³è”æŸ¥è¯¢" class="headerlink" title="2 ä¼˜åŒ–å…³è”æŸ¥è¯¢"></a>2 ä¼˜åŒ–å…³è”æŸ¥è¯¢</h3><p>é€šè¿‡ä¸Šé¢çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬çŸ¥é“äº†å…³è”æŸ¥è¯¢çš„ä¸€äº›ç®—æ³•ï¼Œä¸‹é¢ä¸€èµ·æ¥è®¨è®ºä¸‹å…³è”æŸ¥è¯¢çš„ä¼˜åŒ–ï¼š</p><h4 id="2-1-å…³è”å­—æ®µæ·»åŠ ç´¢å¼•"><a href="#2-1-å…³è”å­—æ®µæ·»åŠ ç´¢å¼•" class="headerlink" title="2.1 å…³è”å­—æ®µæ·»åŠ ç´¢å¼•"></a>2.1 å…³è”å­—æ®µæ·»åŠ ç´¢å¼•</h4><p>é€šè¿‡ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“äº† BNLã€NLJ å’Œ BKA çš„åŸç†ï¼Œ<strong>å› æ­¤å»ºè®®åœ¨è¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µä¸Šæ·»åŠ ç´¢å¼•ï¼Œè®© BNLå˜æˆ NLJ æˆ–è€… BKA ï¼Œå¯æ˜æ˜¾ä¼˜åŒ–å…³è”æŸ¥è¯¢ã€‚</strong></p><h4 id="2-2-å°è¡¨åšé©±åŠ¨è¡¨"><a href="#2-2-å°è¡¨åšé©±åŠ¨è¡¨" class="headerlink" title="2.2 å°è¡¨åšé©±åŠ¨è¡¨"></a>2.2 å°è¡¨åšé©±åŠ¨è¡¨</h4><p>å‰é¢è¯´åˆ°ï¼ŒIndex Nested-Loop Join ç®—æ³•ä¼šè¯»å–é©±åŠ¨è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œé¦–å…ˆæ‰«æçš„è¡Œæ•°æ˜¯é©±åŠ¨è¡¨çš„æ€»è¡Œæ•°ï¼ˆå‡è®¾ä¸º nï¼‰ï¼Œç„¶åéå†è¿™ n è¡Œæ•°æ®ä¸­å…³è”å­—æ®µçš„å€¼ï¼Œæ ¹æ®é©±åŠ¨è¡¨ä¸­å…³è”å­—æ®µçš„å€¼ç´¢å¼•æ‰«æè¢«é©±åŠ¨è¡¨ä¸­çš„å¯¹åº”è¡Œï¼Œè¿™é‡Œåˆä¼šæ‰«æ n è¡Œï¼Œå› æ­¤æ•´ä¸ªè¿‡ç¨‹æ‰«æäº† 2n è¡Œã€‚å½“ä½¿ç”¨ Index Nested-Loop Join ç®—æ³•æ—¶ï¼Œæ‰«æè¡Œæ•°è·Ÿé©±åŠ¨è¡¨çš„æ•°æ®é‡æˆæ­£æ¯”ã€‚æ‰€ä»¥<strong>åœ¨å†™ SQL æ—¶ï¼Œå¦‚æœç¡®å®šè¢«å…³è”å­—æ®µæœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ç”¨å°è¡¨åšé©±åŠ¨è¡¨ã€‚</strong></p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ä»¥ t2 ä¸ºé©±åŠ¨è¡¨çš„ SQLï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t2 straight_join t1 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>a <span class="token operator">=</span> t1<span class="token punctuation">.</span>a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œä½¿ç”¨ straight_join å¯ä»¥å›ºå®šè¿æ¥æ–¹å¼ï¼Œè®©å‰é¢çš„è¡¨ä¸ºé©±åŠ¨è¡¨ã€‚</p><h4 id="2-3-ä¸´æ—¶è¡¨"><a href="#2-3-ä¸´æ—¶è¡¨" class="headerlink" title="2.3 ä¸´æ—¶è¡¨"></a>2.3 ä¸´æ—¶è¡¨</h4><p>å¤šæ•°æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è¢«é©±åŠ¨è¡¨çš„å…³è”å­—æ®µä¸ŠåŠ ç´¢å¼•æ¥è®© join ä½¿ç”¨ NLJ æˆ–è€… BKAï¼Œä½†æœ‰æ—¶å› ä¸ºæŸæ¡å…³è”æŸ¥è¯¢åªæ˜¯ä¸´æ—¶æŸ¥ä¸€æ¬¡ï¼Œå¦‚æœå†å»æ·»åŠ ç´¢å¼•å¯èƒ½ä¼šæµªè´¹èµ„æºï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•ä¼˜åŒ–å‘¢ï¼Ÿ</p><p>è¿™é‡Œæä¾›ä¸€ç§åˆ›å»ºä¸´æ—¶è¡¨çš„æ–¹æ³•ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ¡å…³è”æŸ¥è¯¢ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1 <span class="token keyword">join</span> t2 <span class="token keyword">on</span> t1<span class="token punctuation">.</span>b<span class="token operator">=</span> t2<span class="token punctuation">.</span>b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹ä¸‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+--------------------------------------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra                                      |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+--------------------------------------------+|  1 | SIMPLE      | t2    | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   100 |   100.00 | NULL                                       ||  1 | SIMPLE      | t1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 10225 |    10.00 | Using where; Using join buffer (hash join) |+----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+--------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºè¡¨ t1 å’Œè¡¨ t2 çš„å­—æ®µ béƒ½æ²¡ç´¢å¼•ï¼Œå› æ­¤ä½¿ç”¨çš„æ˜¯æ•ˆç‡æ¯”è¾ƒä½çš„ BNL ç®—æ³•ã€‚</p><p>ç°åœ¨ç”¨ä¸´æ—¶è¡¨çš„æ–¹æ³•å¯¹è¿™æ¡ SQL è¿›è¡Œä¼˜åŒ–ï¼š</p><p>é¦–å…ˆåˆ›å»ºä¸´æ—¶è¡¨ t1_tmpï¼Œè¡¨ç»“æ„ä¸è¡¨ t1 ä¸€è‡´ï¼Œåªæ˜¯åœ¨å…³è”å­—æ®µ b ä¸Šæ·»åŠ äº†ç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t1_tmp<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•åˆ›å»ºæ—¶é—´'</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®°å½•æ›´æ–°æ—¶é—´'</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b<span class="token punctuation">`</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŠŠ t1 è¡¨ä¸­çš„æ•°æ®å†™å…¥ä¸´æ—¶è¡¨ t1_tmp ä¸­ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> t1_tmp <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œ join è¯­å¥ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1_tmp <span class="token keyword">join</span> t2 <span class="token keyword">on</span> t1_tmp<span class="token punctuation">.</span>b<span class="token operator">=</span> t2<span class="token punctuation">.</span>b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬å†çœ‹ä¸‹æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+--------+------------+------+---------------+-------+---------+-----------+------+----------+-------------+| id | select_type | table  | partitions | type | possible_keys | key   | key_len | ref       | rows | filtered | Extra       |+----+-------------+--------+------------+------+---------------+-------+---------+-----------+------+----------+-------------+|  1 | SIMPLE      | t2     | NULL       | ALL  | NULL          | NULL  | NULL    | NULL      |  100 |   100.00 | Using where ||  1 | SIMPLE      | t1_tmp | NULL       | ref  | idx_b         | idx_b | 5       | muke.t2.b |    1 |   100.00 | NULL        |+----+-------------+--------+------------+------+---------------+-------+---------+-----------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Extra æ²¡å‡ºç° â€œBlock Nested Loopâ€ï¼Œè¯´æ˜ä½¿ç”¨çš„æ˜¯ Index Nested-Loop Joinï¼Œå¹¶ä¸”æ‰«æè¡Œæ•°ä¹Ÿå¤§å¤§é™ä½äº†ã€‚</p><p><strong>æ‰€ä»¥å½“é‡åˆ° BNL çš„ join è¯­å¥ï¼Œå¦‚æœä¸æ–¹ä¾¿åœ¨å…³è”å­—æ®µä¸Šæ·»åŠ ç´¢å¼•ï¼Œä¸å¦¨å°è¯•åˆ›å»ºä¸´æ—¶è¡¨ï¼Œç„¶ååœ¨ä¸´æ—¶è¡¨ä¸­çš„å…³è”å­—æ®µä¸Šæ·»åŠ ç´¢å¼•ï¼Œç„¶åé€šè¿‡ä¸´æ—¶è¡¨æ¥åšå…³è”æŸ¥è¯¢ã€‚</strong></p><h2 id="09-ä¸ºä½•count-è¿™ä¹ˆæ…¢"><a href="#09-ä¸ºä½•count-è¿™ä¹ˆæ…¢" class="headerlink" title="09 ä¸ºä½•count(*)è¿™ä¹ˆæ…¢?"></a><strong>09 ä¸ºä½•count(*)è¿™ä¹ˆæ…¢?</strong></h2><p>è€è§„çŸ©ï¼Œå…ˆåˆ›å»ºæµ‹è¯•è¡¨å¹¶å†™å…¥æ•°æ®ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span> <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t1å­˜åœ¨åˆ™åˆ é™¤è¡¨t1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t1<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>d<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">begin</span><span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">/* å£°æ˜å˜é‡i */</span><span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span><span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span> <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=10000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t1ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span><span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* å°†iåŠ 1 */</span><span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥10000æ¡æ•°æ®åˆ°è¡¨t1çš„å­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">call</span> insert_t1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t1 */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10002</span><span class="token punctuation">,</span><span class="token number">10002</span><span class="token punctuation">,</span><span class="token number">10002</span><span class="token punctuation">,</span><span class="token number">10002</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t2<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t2å­˜åœ¨åˆ™åˆ é™¤è¡¨t2 */</span><span class="token keyword">create</span> <span class="token keyword">table</span> t2 <span class="token operator">like</span> t1<span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºè¡¨t2ï¼Œè¡¨ç»“æ„ä¸t1ä¸€è‡´ */</span><span class="token keyword">alter</span> <span class="token keyword">table</span> t2 <span class="token keyword">engine</span> <span class="token operator">=</span>myisam<span class="token punctuation">;</span> <span class="token comment">/* æŠŠt2è¡¨æ”¹ä¸ºMyISAMå­˜å‚¨å¼•æ“ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t2 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>  <span class="token comment">/* æŠŠt1è¡¨çš„æ•°æ®è½¬åˆ°t2è¡¨ */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t3<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>d<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t3 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t1<span class="token punctuation">;</span>  <span class="token comment">/* æŠŠt1è¡¨çš„æ•°æ®è½¬åˆ°t3è¡¨ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-é‡æ–°è®¤è¯†-count"><a href="#1-é‡æ–°è®¤è¯†-count" class="headerlink" title="1 é‡æ–°è®¤è¯† count()"></a>1 é‡æ–°è®¤è¯† count()</h3><h4 id="1-1-count-a-å’Œ-count-çš„åŒºåˆ«"><a href="#1-1-count-a-å’Œ-count-çš„åŒºåˆ«" class="headerlink" title="1.1 count(a) å’Œ count(*) çš„åŒºåˆ«"></a>1.1 count(a) å’Œ count(*) çš„åŒºåˆ«</h4><p>å½“ count() ç»Ÿè®¡æŸä¸€åˆ—æ—¶ï¼Œæ¯”å¦‚ count(a)ï¼Œa è¡¨ç¤ºåˆ—åï¼Œæ˜¯ä¸ç»Ÿè®¡ null çš„ã€‚</p><p>è€Œ <code>count(*)</code> æ— è®ºæ˜¯å¦åŒ…å«ç©ºå€¼ï¼Œéƒ½ä¼šç»Ÿè®¡ã€‚</p><h4 id="1-2-MyISAM-å¼•æ“å’Œ-InnoDB-å¼•æ“-count-çš„åŒºåˆ«"><a href="#1-2-MyISAM-å¼•æ“å’Œ-InnoDB-å¼•æ“-count-çš„åŒºåˆ«" class="headerlink" title="1.2 MyISAM å¼•æ“å’Œ InnoDB å¼•æ“ count(*) çš„åŒºåˆ«"></a>1.2 MyISAM å¼•æ“å’Œ InnoDB å¼•æ“ count(*) çš„åŒºåˆ«</h4><p>å¯¹äº MyISAM å¼•æ“ï¼Œå¦‚æœæ²¡æœ‰ where å­å¥ï¼Œä¹Ÿæ²¡æ£€ç´¢å…¶å®ƒåˆ—ï¼Œé‚£ä¹ˆ <code>count(*)</code> å°†ä¼šéå¸¸å¿«ã€‚å› ä¸º MyISAM å¼•æ“ä¼šæŠŠè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨ç£ç›˜ä¸Šã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹å¯¹ t2 è¡¨ï¼ˆå­˜å‚¨å¼•æ“ä¸º MyISAMï¼‰ä¸å¸¦ where å­å¥åš <code>count(*)</code> çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                        |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------------------+|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | Select tables optimized away |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ Extra å­—æ®µå‘ç° â€œSelect tables optimized awayâ€ å…³é”®å­—ï¼Œè¡¨ç¤ºæ˜¯ä» MyISAM å¼•æ“ç»´æŠ¤çš„å‡†ç¡®è¡Œæ•°ä¸Šè·å–åˆ°çš„ç»Ÿè®¡å€¼ã€‚</p><p>è€Œ InnoDB å¹¶ä¸ä¼šä¿ç•™è¡¨ä¸­çš„è¡Œæ•°ï¼Œ<strong>å› ä¸ºå¹¶å‘äº‹åŠ¡å¯èƒ½åŒæ—¶è¯»å–åˆ°ä¸åŒçš„è¡Œæ•°</strong>ã€‚æ‰€ä»¥æ‰§è¡Œ <code>count(*)</code> æ—¶éƒ½æ˜¯ä¸´æ—¶å»è®¡ç®—çš„ï¼Œä¼šæ¯” MyISAM å¼•æ“æ…¢å¾ˆå¤šã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹å¯¹ t1 è¡¨ï¼ˆå­˜å‚¨å¼•æ“ä¸º InnoDBï¼‰æ‰§è¡Œ <code>count(*)</code> çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; explain select count(*) from t1;+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx_b | 4       | NULL | 10147 |   100.00 | Using index |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°ä½¿ç”¨çš„æ˜¯ b å­—æ®µçš„ç´¢å¼• idx_bï¼Œå¹¶ä¸”æ‰«æè¡Œæ•°æ˜¯10109ï¼Œè¡¨ç¤ºä¼šéå† b å­—æ®µçš„ç´¢å¼•æ ‘å»è®¡ç®—è¡¨çš„æ€»é‡ã€‚</p><p>å¯¹æ¯” MyISAM å¼•æ“å’Œ InnoDB å¼•æ“ <code>count(*)</code> çš„åŒºåˆ«ï¼Œå¯ä»¥çŸ¥é“ï¼š</p><ul><li>MyISAM ä¼šç»´æŠ¤è¡¨çš„æ€»è¡Œæ•°ï¼Œæ”¾åœ¨ç£ç›˜ä¸­ï¼Œå¦‚æœæœ‰ <code>count(*)</code> çš„éœ€æ±‚ï¼Œç›´æ¥è¿”å›è¿™ä¸ªæ•°æ®</li><li>ä½†æ˜¯ InnoDB å°±ä¼šå»éå†æ™®é€šç´¢å¼•æ ‘ï¼Œè®¡ç®—è¡¨æ•°æ®æ€»é‡</li></ul><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼ŒInnoDB è¡¨ t1 åœ¨æ‰§è¡Œ <code>count(*)</code> æ—¶ï¼Œä¸ºä»€ä¹ˆä¼šèµ° b å­—æ®µçš„ç´¢å¼•è€Œä¸æ˜¯èµ°ä¸»é”®ç´¢å¼•å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬åˆ†æä¸‹ï¼š</p><h4 id="1-3-MySQL-5-7-18-å‰å-count-çš„åŒºåˆ«"><a href="#1-3-MySQL-5-7-18-å‰å-count-çš„åŒºåˆ«" class="headerlink" title="1.3 MySQL 5.7.18 å‰å count(*) çš„åŒºåˆ«"></a>1.3 MySQL 5.7.18 å‰å count(*) çš„åŒºåˆ«</h4><p>åœ¨ MySQL 5.7.18 ä¹‹å‰ï¼ŒInnoDB é€šè¿‡æ‰«æèšç°‡ç´¢å¼•æ¥å¤„ç† <code>count(*)</code> è¯­å¥ã€‚</p><p>ä» MySQL 5.7.18 å¼€å§‹ï¼Œé€šè¿‡éå†æœ€å°çš„å¯ç”¨äºŒçº§ç´¢å¼•æ¥å¤„ç† <code>count(*)</code> è¯­å¥ã€‚å¦‚æœä¸å­˜åœ¨äºŒçº§ç´¢å¼•ï¼Œåˆ™æ‰«æèšç°‡ç´¢å¼•ã€‚ä½†æ˜¯ï¼Œå¦‚æœç´¢å¼•è®°å½•ä¸å®Œå…¨åœ¨ç¼“å­˜æ± ä¸­çš„è¯ï¼Œå¤„ç† <code>count(*)</code> ä¹Ÿæ˜¯æ¯”è¾ƒä¹…çš„ã€‚</p><p>æ–°ç‰ˆæœ¬ä¸ºä»€ä¹ˆä¼šä½¿ç”¨äºŒçº§ç´¢å¼•æ¥å¤„ç† <code>count(*)</code> è¯­å¥å‘¢ï¼Ÿ</p><p>åŸå› æ˜¯ InnoDB äºŒçº§ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šå­˜æ”¾çš„æ˜¯ä¸»é”®ï¼Œè€Œä¸»é”®ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šå­˜æ”¾çš„æ˜¯æ•´è¡Œæ•°æ®ï¼Œæ‰€ä»¥äºŒçº§ç´¢å¼•æ ‘æ¯”ä¸»é”®ç´¢å¼•æ ‘å°ã€‚å› æ­¤ä¼˜åŒ–å™¨åŸºäºæˆæœ¬çš„è€ƒè™‘ï¼Œä¼˜å…ˆé€‰æ‹©çš„æ˜¯äºŒçº§ç´¢å¼•ã€‚æ‰€ä»¥ count(ä¸»é”®) å…¶å®æ²¡ <code>count (*)</code> å¿«ã€‚</p><h4 id="1-4-count-1-æ¯”-count-å¿«å—ï¼Ÿ"><a href="#1-4-count-1-æ¯”-count-å¿«å—ï¼Ÿ" class="headerlink" title="1.4 count(1) æ¯” count(*) å¿«å—ï¼Ÿ"></a>1.4 count(1) æ¯” count(*) å¿«å—ï¼Ÿ</h4><p>åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“ <code>count(*)</code> æ— è®ºæ˜¯å¦åŒ…å«ç©ºå€¼ï¼Œæ‰€æœ‰ç»“æœéƒ½ä¼šç»Ÿè®¡ã€‚</p><p>è€Œ count(1)ä¸­çš„ 1 æ˜¯æ’çœŸè¡¨è¾¾å¼ï¼Œå› æ­¤ä¹Ÿä¼šç»Ÿè®¡æ‰€æœ‰ç»“æœã€‚</p><p>æ‰€ä»¥ count(1) å’Œ <code>count(*)</code> ç»Ÿè®¡ç»“æœæ²¡å·®åˆ«ã€‚</p><p>æˆ‘ä»¬æ¥å¯¹æ¯” count(1) å’Œ count(* ) çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; explain select count(1) from t1;+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx_b | 4       | NULL | 10147 |   100.00 | Using index |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+mysql&gt; explain select count(*) from t1;+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows  | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx_b | 4       | NULL | 10147 |   100.00 | Using index |+----+-------------+-------+------------+-------+---------------+-------+---------+------+-------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œè®¡åˆ’ä¸€æ ·ï¼Œæ‰€ä»¥ count(1) å¹¶ä¸æ¯” count(*) å¿«ã€‚</p><h3 id="2-å“ªäº›æ–¹æ³•å¯ä»¥åŠ å¿«-count"><a href="#2-å“ªäº›æ–¹æ³•å¯ä»¥åŠ å¿«-count" class="headerlink" title="2 å“ªäº›æ–¹æ³•å¯ä»¥åŠ å¿« count()"></a>2 å“ªäº›æ–¹æ³•å¯ä»¥åŠ å¿« count()</h3><h4 id="2-1-show-table-status"><a href="#2-1-show-table-status" class="headerlink" title="2.1 show table status"></a>2.1 show table status</h4><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æŸå¼ è¡¨çš„å¤§æ¦‚æ•°æ®é‡ï¼Œè¿™ç§æƒ…å†µå°±å¯ä»¥ä½¿ç”¨ show table statusï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'t1'</span>\G<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">...Rows: 10147...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Rows è¿™åˆ—å°±è¡¨ç¤ºè¿™å¼ è¡¨çš„è¡Œæ•°ã€‚è¿™ç§æ–¹å¼è·å– InnoDB è¡¨çš„è¡Œæ•°éå¸¸å¿«ã€‚</p><p><strong>ä½†æ˜¯ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸ªä¼°ç®—å€¼ï¼Œå¯èƒ½ä¸å®é™…å€¼ç›¸å·® 40% åˆ° 50%</strong>ã€‚ï¼ˆå¯¹äº Rows è¿™ä¸ªå­—æ®µæ›´è¯¦ç»†çš„è§£é‡Šï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ‰‹å†Œï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/show-table-status.htmlï¼‰">https://dev.mysql.com/doc/refman/5.7/en/show-table-status.htmlï¼‰</a></p><h4 id="2-2-ç”¨-Redis-åšè®¡æ•°å™¨"><a href="#2-2-ç”¨-Redis-åšè®¡æ•°å™¨" class="headerlink" title="2.2 ç”¨ Redis åšè®¡æ•°å™¨"></a>2.2 ç”¨ Redis åšè®¡æ•°å™¨</h4><h4 id="2-3-å¢åŠ è®¡æ•°è¡¨"><a href="#2-3-å¢åŠ è®¡æ•°è¡¨" class="headerlink" title="2.3 å¢åŠ è®¡æ•°è¡¨"></a>2.3 å¢åŠ è®¡æ•°è¡¨</h4><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/å¢åŠ è®¡æ•°è¡¨.png" alt="å¢åŠ è®¡æ•°è¡¨"></p><hr><p>ç¬¬2ç«  MySQLç´¢å¼•</p><h2 id="10-ä¸ºä»€ä¹ˆæ·»åŠ ç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦"><a href="#10-ä¸ºä»€ä¹ˆæ·»åŠ ç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦" class="headerlink" title="10 ä¸ºä»€ä¹ˆæ·»åŠ ç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦?"></a><strong>10 ä¸ºä»€ä¹ˆæ·»åŠ ç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦?</strong></h2><p>ä¸ºäº†ä¾¿äºç†è§£ MySQL çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€äº›ä¸ç´¢å¼•ç›¸å…³çš„ç®—æ³•ã€‚</p><h3 id="1-è·Ÿç´¢å¼•ç›¸å…³çš„ä¸€äº›ç®—æ³•"><a href="#1-è·Ÿç´¢å¼•ç›¸å…³çš„ä¸€äº›ç®—æ³•" class="headerlink" title="1 è·Ÿç´¢å¼•ç›¸å…³çš„ä¸€äº›ç®—æ³•"></a>1 è·Ÿç´¢å¼•ç›¸å…³çš„ä¸€äº›ç®—æ³•</h3><p>å¯¹äº MySQL è€Œè¨€ï¼Œä½¿ç”¨æœ€é¢‘ç¹çš„å°±æ˜¯ B+ æ ‘ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦çŸ¥é“ B+ æ ‘çš„ç»“æ„ï¼Œè€Œ B+ æ ‘æ˜¯å€Ÿé‰´äº†äºŒåˆ†æŸ¥æ‰¾æ³•ã€äºŒå‰æŸ¥æ‰¾æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€B æ ‘çš„ä¸€äº›æ€æƒ³æ„å»ºçš„ã€‚å› æ­¤æˆ‘ä»¬é¦–å…ˆé€šè¿‡äº†è§£è¿™äº›ç®—æ³•ï¼Œæ¥ä¸€å±‚ä¸€å±‚æ‹¨å¼€ B+ æ ‘çš„ç¥ç§˜é¢çº±ã€‚</p><h4 id="1-1-äºŒåˆ†æŸ¥æ‰¾æ³•"><a href="#1-1-äºŒåˆ†æŸ¥æ‰¾æ³•" class="headerlink" title="1.1 äºŒåˆ†æŸ¥æ‰¾æ³•"></a>1.1 äºŒåˆ†æŸ¥æ‰¾æ³•</h4><p>äºŒåˆ†æŸ¥æ‰¾æ³•çš„æŸ¥æ‰¾è¿‡ç¨‹æ˜¯ï¼šå°†è®°å½•æŒ‰é¡ºåºæ’åˆ—ï¼ŒæŸ¥æ‰¾æ—¶å…ˆä»¥æœ‰åºåˆ—çš„ä¸­ç‚¹ä½ç½®ä¸ºæ¯”è¾ƒå¯¹è±¡ï¼Œå¦‚æœè¦æ‰¾çš„å…ƒç´ å€¼å°äºè¯¥ä¸­ç‚¹å…ƒç´ ï¼Œåˆ™å°†æŸ¥è¯¢èŒƒå›´ç¼©å°ä¸ºå·¦åŠéƒ¨åˆ†ï¼›å¦‚æœè¦æ‰¾çš„å…ƒç´ å€¼å¤§äºè¯¥ä¸­ç‚¹å…ƒç´ ï¼Œåˆ™å°†æŸ¥è¯¢èŒƒå›´ç¼©å°ä¸ºå³åŠéƒ¨åˆ†ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æŸ¥åˆ°éœ€è¦çš„å€¼ã€‚<br><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/äºŒåˆ†æŸ¥æ‰¾æ³•.png" alt="äºŒåˆ†æŸ¥æ‰¾æ³•"></p><h4 id="1-2-äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#1-2-äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="1.2 äºŒå‰æŸ¥æ‰¾æ ‘"></a>1.2 äºŒå‰æŸ¥æ‰¾æ ‘</h4><p>äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œå·¦å­æ ‘çš„é”®å€¼æ€»æ˜¯å°äºæ ¹çš„é”®å€¼ï¼Œå³å­æ ‘çš„é”®å€¼æ€»æ˜¯å¤§äºæ ¹çš„é”®å€¼ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸¤é¢—å­æ ‘ã€‚<br><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/äºŒå‰æŸ¥æ‰¾æ ‘.png" alt="äºŒå‰æŸ¥æ‰¾æ ‘"></p><h4 id="1-3-å¹³è¡¡äºŒå‰æ ‘"><a href="#1-3-å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="1.3 å¹³è¡¡äºŒå‰æ ‘"></a>1.3 å¹³è¡¡äºŒå‰æ ‘</h4><p>å¹³è¡¡äºŒå‰æ ‘çš„å®šä¹‰ï¼šæ»¡è¶³äºŒå‰æŸ¥æ‰¾æ ‘çš„å®šä¹‰ï¼Œå¦å¤–å¿…é¡»æ»¡è¶³ä»»ä½•èŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®æœ€å¤§ä¸º 1ã€‚<br><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/å¹³è¡¡äºŒå‰æ ‘.png" alt="å¹³è¡¡äºŒå‰æ ‘"></p><h4 id="1-4-B-æ ‘"><a href="#1-4-B-æ ‘" class="headerlink" title="1.4 B æ ‘"></a>1.4 B æ ‘</h4><p>B æ ‘å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å¤šäº 2 ä¸ªå­èŠ‚ç‚¹çš„å¹³è¡¡å¤šå‰æŸ¥æ‰¾æ ‘ã€‚</p><p>B æ ‘ä¸­åŒä¸€é”®å€¼ä¸ä¼šå‡ºç°å¤šæ¬¡ï¼Œè¦ä¹ˆåœ¨å¶å­èŠ‚ç‚¹ï¼Œè¦ä¹ˆåœ¨å†…èŠ‚ç‚¹ä¸Šã€‚</p><p>æ¯”å¦‚ç”¨ 1ã€2ã€3ã€5ã€6ã€7ã€9 è¿™äº›æ•°å­—æ„å»ºä¸€ä¸ª B æ ‘ç»“æ„ï¼Œå…¶å›¾å½¢å¦‚ä¸‹ï¼š<br><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/Bæ ‘.png" alt="Bæ ‘"></p><p>ä¸å¹³è¡¡äºŒå‰æ ‘ç›¸æ¯”ï¼ŒB æ ‘åˆ©ç”¨å¤šä¸ªåˆ†æ”¯ï¼ˆå¹³è¡¡äºŒå‰æ ‘åªæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼‰èŠ‚ç‚¹ï¼Œå‡å°‘è·å–è®°å½•æ—¶æ‰€ç»å†çš„èŠ‚ç‚¹æ•°ã€‚</p><p>B æ ‘ä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å« key å€¼å’Œ data å€¼ï¼Œå› æ­¤å¦‚æœ data æ¯”è¾ƒå¤§æ—¶ï¼Œæ¯ä¸€é¡µå­˜å‚¨çš„ key ä¼šæ¯”è¾ƒå°‘ï¼›å½“æ•°æ®æ¯”è¾ƒå¤šæ—¶ï¼ŒåŒæ ·ä¼šæœ‰ï¼šâ€œè¦ç»å†å¤šå±‚èŠ‚ç‚¹æ‰èƒ½æŸ¥è¯¢åœ¨å¶å­èŠ‚ç‚¹çš„æ•°æ®â€çš„é—®é¢˜ã€‚è¿™æ—¶ï¼ŒB+ æ ‘ç«™äº†å‡ºæ¥ã€‚</p><h4 id="1-5-B-æ ‘"><a href="#1-5-B-æ ‘" class="headerlink" title="1.5 B+ æ ‘"></a>1.5 B+ æ ‘</h4><p>B+ æ ‘æ˜¯ B æ ‘çš„å˜ä½“ï¼Œå®šä¹‰åŸºæœ¬ä¸ B æ ‘ä¸€è‡´ï¼Œä¸ B æ ‘çš„ä¸åŒç‚¹ï¼š</p><ul><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹ä¸­åŒ…å«äº†å…¨éƒ¨å…³é”®å­—çš„ä¿¡æ¯</li><li>å„å¶å­èŠ‚ç‚¹ç”¨æŒ‡é’ˆè¿›è¡Œè¿æ¥</li><li>éå¶å­èŠ‚ç‚¹ä¸Šåªå­˜å‚¨ key çš„ä¿¡æ¯ï¼Œè¿™æ ·ç›¸å¯¹ B æ ‘ï¼Œå¯ä»¥å¢åŠ æ¯ä¸€é¡µä¸­å­˜å‚¨ key çš„æ•°é‡ã€‚</li><li>B æ ‘æ˜¯çºµå‘æ‰©å±•ï¼Œæœ€ç»ˆå˜æˆä¸€ä¸ªâ€œç˜¦é«˜ä¸ªâ€ï¼Œè€Œ B+ æ ‘æ˜¯æ¨ªå‘æ‰©å±•çš„ï¼Œæœ€ç»ˆä¼šå˜æˆä¸€ä¸ªâ€œçŸ®èƒ–å­â€ï¼ˆè¿™é‡Œå‚è€ƒäº†ã€ŠMySQL è¿ç»´å†…å‚ã€‹ç¬¬ 8 èŠ‚ B+ æ ‘åŠ B æ ‘çš„åŒºåˆ«ä¸­çš„æ¯”å–»ï¼‰ã€‚</li></ul><p>åœ¨ B+ æ ‘ä¸­ï¼Œæ‰€æœ‰è®°å½•èŠ‚ç‚¹éƒ½æ˜¯æŒ‰é”®å€¼çš„å¤§å°é¡ºåºå­˜æ”¾åœ¨åŒä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸Šã€‚B+ æ ‘ä¸­çš„ B ä¸æ˜¯ä»£è¡¨äºŒå‰(binary) è€Œæ˜¯ä»£è¡¨ï¼ˆbalanceï¼‰ï¼ŒB+ æ ‘å¹¶ä¸æ˜¯ä¸€ä¸ªäºŒå‰æ ‘ã€‚</p><p>è¿˜æ˜¯æ ¹æ®å‰é¢æåˆ°çš„è¿™ç»„æ•°å­—ï¼ˆ1ã€2ã€3ã€5ã€6ã€7ã€9ï¼‰ä¸¾ä¾‹ï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/Bplusæ ‘.png" alt="Bplusæ ‘"></p><p>ä¸ 1.4 ä¸­ B æ ‘çš„ç»“æ„æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼š</p><p>å®ƒçš„é”®ä¸€å®šä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼ŒåŒæ—¶ä¹Ÿæœ‰å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ä¸­é‡å¤å‡ºç°ã€‚è€Œ B æ ‘ä¸­åŒä¸€é”®å€¼ä¸ä¼šå‡ºç°å¤šæ¬¡ã€‚</p><h3 id="2-B-æ ‘ç´¢å¼•"><a href="#2-B-æ ‘ç´¢å¼•" class="headerlink" title="2 B+ æ ‘ç´¢å¼•"></a>2 B+ æ ‘ç´¢å¼•</h3><p>B+ æ ‘ç´¢å¼•å°±æ˜¯åŸºäºæœ¬èŠ‚å‰é¢ä»‹ç»çš„ B+ æ ‘å‘å±•è€Œæ¥çš„ã€‚åœ¨æ•°æ®åº“ä¸­ï¼ŒB+ æ ‘çš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨ 2 ~ 4 å±‚ï¼Œæ‰€ä»¥<strong>æŸ¥æ‰¾æŸä¸€è¡Œæ•°æ®æœ€å¤šåªéœ€è¦ 2 åˆ° 4 æ¬¡ IOã€‚è€Œæ²¡ç´¢å¼•çš„æƒ…å†µï¼Œéœ€è¦é€è¡Œæ‰«æï¼Œæ˜æ˜¾æ•ˆç‡ä½å¾ˆå¤šï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæ·»åŠ ç´¢å¼•èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</strong></p><p>B+ æ ‘ç´¢å¼•å¹¶ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªç»™å®šé”®å€¼çš„å…·ä½“è¡Œï¼ŒB+ æ ‘ç´¢å¼•èƒ½æ‰¾åˆ°çš„åªæ˜¯è¢«æŸ¥æ‰¾æ•°æ®è¡Œæ‰€åœ¨çš„é¡µã€‚ç„¶åæ•°æ®åº“é€šè¿‡æŠŠé¡µè¯»å…¥åˆ°ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ä¸­ï¼Œåœ¨å†…å­˜ä¸­é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¾—åˆ°éœ€è¦çš„æ•°æ®ã€‚</p><p>InnoDB ä¸­ B+ æ ‘ç´¢å¼•åˆ†ä¸ºèšé›†ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼Œæˆ‘ä»¬å†ç»§ç»­äº†è§£è¿™ä¸¤ç§ç´¢å¼•çš„ç‰¹ç‚¹ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€å¼ æµ‹è¯•è¡¨å¹¶å†™å…¥æ•°æ®ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span> <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t8<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t1å­˜åœ¨åˆ™åˆ é™¤è¡¨t1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t8<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t8<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-èšé›†ç´¢å¼•"><a href="#2-1-èšé›†ç´¢å¼•" class="headerlink" title="2.1 èšé›†ç´¢å¼•"></a>2.1 èšé›†ç´¢å¼•</h4><p>InnoDB çš„æ•°æ®æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºå­˜æ”¾çš„ï¼Œè€Œèšé›†ç´¢å¼•å°±æ˜¯æŒ‰ç…§æ¯å¼ è¡¨çš„ä¸»é”®æ„é€ ä¸€é¢— B+ æ ‘ï¼Œå®ƒçš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚</p><p>InnoDB çš„ä¸»é”®ä¸€å®šæ˜¯èšé›†ç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œèšé›†ç´¢å¼•å¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªä¸å…è®¸ä¸º null çš„å”¯ä¸€ç´¢å¼•ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ row idã€‚</p><p>ç”±äºå®é™…çš„æ•°æ®é¡µåªèƒ½æŒ‰ç…§ä¸€é¢— B+ æ ‘è¿›è¡Œæ’åºï¼Œå› æ­¤æ¯å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼ˆTokuDB å¼•æ“é™¤å¤–ï¼‰ã€‚æŸ¥è¯¢ä¼˜åŒ–å™¨å€¾å‘äºé‡‡ç”¨èšé›†ç´¢å¼•ï¼Œå› ä¸ºèšé›†ç´¢å¼•èƒ½å¤Ÿåœ¨ B+ æ ‘ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šç›´æ¥æ‰¾åˆ°æ•°æ®ã€‚</p><p>èšé›†ç´¢å¼•å¯¹äºä¸»é”®çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ã€‚</p><p>å¯¹äºåˆšåˆšåˆ›å»ºå¥½çš„æµ‹è¯•è¡¨ t8çš„èšé›†ç´¢å¼•çš„å¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/è¡¨t8çš„èšé›†ç´¢å¼•çš„å¤§è‡´ç»“æ„.png" alt="è¡¨t8çš„èšé›†ç´¢å¼•çš„å¤§è‡´ç»“æ„"></p><p>ä¸¤ç‚¹å…³é”®ä¿¡æ¯ï¼š</p><ul><li>æ ¹æ®ä¸»é”®å€¼åˆ›å»ºäº† B+ æ ‘ç»“æ„</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹åŒ…å«äº†æ•´è¡Œæ•°æ®</li></ul><h4 id="2-2-è¾…åŠ©ç´¢å¼•"><a href="#2-2-è¾…åŠ©ç´¢å¼•" class="headerlink" title="2.2 è¾…åŠ©ç´¢å¼•"></a>2.2 è¾…åŠ©ç´¢å¼•</h4><p>æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾äº†æ•´è¡Œæ•°æ®ï¼Œè€Œ InnoDB å­˜å‚¨å¼•æ“è¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¹¶ä¸ä¼šæ”¾æ•´è¡Œæ•°æ®ï¼Œè€Œå­˜æ”¾çš„æ˜¯é”®å€¼å’Œä¸»é”® IDã€‚</p><p>å½“é€šè¿‡è¾…åŠ©ç´¢å¼•æ¥å¯»æ‰¾æ•°æ®æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šéå†è¾…åŠ©ç´¢å¼•æ ‘æŸ¥æ‰¾åˆ°å¯¹åº”è®°å½•çš„ä¸»é”®ï¼Œç„¶åé€šè¿‡ä¸»é”®ç´¢å¼•æ¥æ‰¾åˆ°å¯¹åº”çš„è¡Œæ•°æ®ã€‚</p><p>æ¯”å¦‚ä¸€é¢—é«˜åº¦ä¸º 3 çš„è¾…åŠ©ç´¢å¼•æ ‘ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œé‚£éœ€è¦å¯¹è¿™é¢—è¾…åŠ©ç´¢å¼•æ ‘éå† 3 æ¬¡æ‰¾åˆ°æŒ‡å®šä¸»é”®ï¼Œå¦‚æœèšé›†ç´¢å¼•æ ‘çš„é«˜åº¦ä¹Ÿä¸º 3ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å¯¹èšé›†ç´¢å¼•æ ‘è¿›è¡Œ 3 æ¬¡æŸ¥æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œæ•°æ®æ‰€åœ¨çš„é¡µï¼Œå› æ­¤è·å–æ•°æ®ä¸€å…±éœ€è¦6æ¬¡é€»è¾‘ IO è®¿é—®ã€‚</p><p>æˆ‘ä»¬ç»§ç»­æ‹¿è¡¨ t8 åˆ†æï¼Œå®ƒçš„è¾…åŠ©ç´¢å¼• idx_a ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/è¡¨t8çš„è¾…åŠ©ç´¢å¼•idx_açš„å¤§è‡´ç»“æ„.png" alt="è¡¨t8çš„è¾…åŠ©ç´¢å¼•idx_açš„å¤§è‡´ç»“æ„"></p><p>ä¸Šå›¾ä¸­ä¸¤ç‚¹å…³é”®ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li>æ ¹æ® a å­—æ®µçš„å€¼åˆ›å»ºäº† B+ æ ‘ç»“æ„</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯ a å­—æ®µè‡ªå·±çš„é”®å€¼å’Œä¸»é”® ID</li></ul><p>å¯¹äºè¡¨ t8ï¼Œæ¯”å¦‚æœ‰ä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t8 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®ƒå…ˆé€šè¿‡ a å­—æ®µä¸Šçš„ç´¢å¼•æ ‘ï¼Œå¾—åˆ°ä¸»é”® id ä¸º 3ï¼Œå†åˆ° id çš„èšé›†ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ°å¯¹åº”çš„è¡Œæ•°æ®ã€‚</p><p>è€Œä¸‹é¢è¿™æ¡ SQL:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t8 <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥è¯¢åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œæ‰§è¡Œè¿‡ç¨‹åˆ™åªéœ€è¦æœç´¢ id çš„èšé›†ç´¢å¼•æ ‘ã€‚æˆ‘ä»¬èƒ½çœ‹å‡ºè¾…åŠ©ç´¢å¼•çš„æŸ¥è¯¢æ¯”ä¸»é”®æŸ¥è¯¢å¤šæ‰«æä¸€é¢—ç´¢å¼•æ ‘ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥<strong>å°½é‡ä½¿ç”¨ä¸»é”®åšä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢</strong>ã€‚</p><h2 id="11-å“ªäº›æƒ…å†µéœ€è¦æ·»åŠ ç´¢å¼•ï¼Ÿ"><a href="#11-å“ªäº›æƒ…å†µéœ€è¦æ·»åŠ ç´¢å¼•ï¼Ÿ" class="headerlink" title="11 å“ªäº›æƒ…å†µéœ€è¦æ·»åŠ ç´¢å¼•ï¼Ÿ"></a><strong>11 å“ªäº›æƒ…å†µéœ€è¦æ·»åŠ ç´¢å¼•ï¼Ÿ</strong></h2><p>é¦–å…ˆåˆ›å»ºæµ‹è¯•è¡¨å¹¶å†™å…¥æ•°æ®ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span> <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t9_1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t9_1å­˜åœ¨åˆ™åˆ é™¤è¡¨t9_1 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t9_1<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>d<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t9_1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t9_1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t9_1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t9_1 */</span><span class="token keyword">begin</span><span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">/* å£°æ˜å˜é‡i */</span><span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span><span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token keyword">do</span> <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=100000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t9_1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t9_1ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span><span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* å°†iåŠ 1 */</span><span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥100000æ¡æ•°æ®åˆ°è¡¨t9_1çš„å­˜å‚¨è¿‡ç¨‹insert_t9_1 */</span><span class="token keyword">call</span> insert_t9_1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t9_1 */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t9_1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t9_1<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t9_1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t9_1<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t9_1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t9_1<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t9_1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t9_1<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t9_1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token keyword">from</span> t9_1<span class="token punctuation">;</span><span class="token comment">/*  æŠŠt9_1çš„æ•°æ®é‡æ‰©å¤§åˆ°160ä¸‡ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›®å‰æ¯”è¾ƒå¸¸è§éœ€è¦åˆ›å»ºç´¢å¼•çš„åœºæ™¯æœ‰ï¼šæ•°æ®æ£€ç´¢æ—¶åœ¨æ¡ä»¶å­—æ®µæ·»åŠ ç´¢å¼•ã€èšåˆå‡½æ•°å¯¹èšåˆå­—æ®µæ·»åŠ ç´¢å¼•ã€å¯¹æ’åºå­—æ®µæ·»åŠ ç´¢å¼•ã€ä¸ºäº†é˜²æ­¢å›è¡¨æ·»åŠ ç´¢å¼•ã€å…³è”æŸ¥è¯¢åœ¨å…³è”å­—æ®µæ·»åŠ ç´¢å¼•ç­‰ã€‚æˆ‘ä»¬å°±ä¸€ä¸€åˆ†æè¿™äº›éœ€è¦åˆ›å»ºç´¢å¼•çš„åœºæ™¯ï¼š</p><h3 id="1-æ•°æ®æ£€ç´¢"><a href="#1-æ•°æ®æ£€ç´¢" class="headerlink" title="1 æ•°æ®æ£€ç´¢"></a>1 æ•°æ®æ£€ç´¢</h3><p>ç”¨ä¸Šé¢çš„è¡¨ t9_1 åšæµ‹è¯•ï¼Œé¦–å…ˆæŠŠæ²¡æœ‰ç´¢å¼•çš„å­—æ®µ d ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t9_1 <span class="token keyword">where</span> d <span class="token operator">=</span> <span class="token number">90000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ç°æŸ¥è¯¢æ—¶é—´éœ€è¦0.44 ç§’</p><p>å†æŠŠæœ‰ç´¢å¼•çš„å­—æ®µ a ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t9_1 <span class="token keyword">where</span> a <span class="token operator">=</span> <span class="token number">90000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ç°æŸ¥è¯¢æ—¶é—´ä¸º 0.00 secï¼Œè¡¨ç¤ºæ‰§è¡Œæ—¶é—´ä¸è¶…è¿‡ 10 æ¯«ç§’ï¼Œéå¸¸å¿«ã€‚</p><p>æˆ‘ä»¬å†å¯¹æ¯”ä¸¤æ¡ SQL çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; explain select * from t9_1 where d = 90000;+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+|  1 | SIMPLE      | t9_1  | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 3192096 |    10.00 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+mysql&gt; explain select * from t9_1 where a = 90000;+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+|  1 | SIMPLE      | t9_1  | NULL       | ref  | idx_a         | idx_a | 5       | const |   32 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-------+---------+-------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‰è€… type å­—æ®µä¸º ALLï¼Œåè€… type å­—æ®µä¸º refï¼Œæ˜¾ç„¶åè€…æ€§èƒ½æ›´å¥½</p><p>rows è¿™ä¸ªå­—æ®µå‰è€…æ˜¯ 3192096ï¼Œè€Œåè€…æ˜¯ 32ï¼Œæœ‰ç´¢å¼•çš„æƒ…å†µæ‰«æè¡Œæ•°å¤§å¤§é™ä½ã€‚</p><p>å› æ­¤å»ºè®®æ•°æ®æ£€ç´¢æ—¶ï¼Œåœ¨æ¡ä»¶å­—æ®µæ·»åŠ ç´¢å¼•ã€‚</p><h3 id="2-èšåˆå‡½æ•°"><a href="#2-èšåˆå‡½æ•°" class="headerlink" title="2 èšåˆå‡½æ•°"></a>2 èšåˆå‡½æ•°</h3><p>åœ¨æµ‹è¯•è¡¨ t9_1 ä¸­ï¼Œå¦‚æœè¦æ±‚å‡ºæ— ç´¢å¼•å­—æ®µ d çš„æœ€å¤§å€¼ï¼ŒSQL å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token keyword">from</span> t9_1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œæ—¶é—´ä¸º 0.33 ç§’ã€‚</p><p>å†çœ‹ä¸‹æ±‚æœ‰ç´¢å¼•çš„å­—æ®µ a çš„æœ€å¤§å€¼ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">from</span> t9_1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œæ—¶é—´ä¸º 0.00 ç§’ï¼Œè¡¨ç¤ºæ‰§è¡Œæ—¶é—´ä¸è¶…è¿‡ 10 æ¯«ç§’ã€‚</p><p>ç›¸æ¯”å¯¹æ²¡æœ‰ç´¢å¼•çš„å­—æ®µ d æ±‚æœ€å¤§å€¼ï¼ˆèŠ±è´¹330æ¯«ç§’ï¼‰ï¼Œ<strong>æ˜¾ç„¶ç´¢å¼•èƒ½æå‡ max() å‡½æ•°çš„æ•ˆç‡ï¼ŒåŒç†ä¹Ÿèƒ½æå‡ min() å‡½æ•°çš„æ•ˆç‡</strong>ã€‚</p><p>åœ¨ç¬¬ 7 èŠ‚ä¸­çš„ 1.3 å°èŠ‚ä¸­æœ‰ä»‹ç» MySQL 5.7.18 ä¹‹åç‰ˆæœ¬çš„ <code>count(*)</code> ç‰¹ç‚¹ï¼šä» MySQL 5.7.18 å¼€å§‹ï¼Œé€šè¿‡éå†æœ€å°çš„å¯ç”¨äºŒçº§ç´¢å¼•æ¥å¤„ç† <code>count(*)</code> è¯­å¥ï¼Œå¦‚æœä¸å­˜åœ¨äºŒçº§ç´¢å¼•ï¼Œåˆ™æ‰«æèšç°‡ç´¢å¼•ã€‚åŸå› æ˜¯ï¼šInnoDB äºŒçº§ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šå­˜æ”¾çš„æ˜¯ä¸»é”®ï¼Œè€Œä¸»é”®ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šå­˜æ”¾çš„æ˜¯æ•´è¡Œæ•°æ®ï¼Œæ‰€ä»¥äºŒçº§ç´¢å¼•æ ‘æ¯”ä¸»é”®ç´¢å¼•æ ‘å°ã€‚å› æ­¤ä¼˜åŒ–å™¨åŸºäºæˆæœ¬çš„è€ƒè™‘ï¼Œä¼˜å…ˆé€‰æ‹©çš„æ˜¯äºŒçº§ç´¢å¼•ã€‚</p><p><strong>å› æ­¤ç´¢å¼•å¯¹èšåˆå‡½æ•° count(*) ä¹Ÿæœ‰ä¼˜åŒ–ä½œç”¨ã€‚</strong></p><h3 id="3-æ’åº"><a href="#3-æ’åº" class="headerlink" title="3 æ’åº"></a>3 æ’åº</h3><p>åœ¨ç¬¬ 4 èŠ‚ 2.1 å°èŠ‚ï¼Œæˆ‘ä»¬åˆ—å‡ºäº†å‡ ç§é€šè¿‡æ·»åŠ åˆé€‚ç´¢å¼•ä¼˜åŒ– order by çš„æ–¹æ³•ï¼Œè¿™é‡Œå†åšä¸€æ¬¡æ€»ç»“ï¼ˆå¦‚æœå¯¹ä¸‹é¢çš„æ€»ç»“ä¸æ˜¯å¾ˆç†è§£ï¼Œå¯ä»¥å¤ä¹ ç¬¬ 4 èŠ‚çš„å†…å®¹ï¼Œæœ‰å¯¹æ¯ç§æƒ…å†µä¸¾ä¾‹è¯´æ˜ï¼‰ï¼š</p><ul><li>å¦‚æœå¯¹å•ä¸ªå­—æ®µæ’åºï¼Œåˆ™å¯ä»¥åœ¨è¿™ä¸ªæ’åºå­—æ®µä¸Šæ·»åŠ ç´¢å¼•æ¥ä¼˜åŒ–æ’åºè¯­å¥ï¼›</li><li>å¦‚æœæ˜¯å¤šä¸ªå­—æ®µæ’åºï¼Œå¯ä»¥åœ¨å¤šä¸ªæ’åºå­—æ®µä¸Šæ·»åŠ è”åˆç´¢å¼•æ¥ä¼˜åŒ–æ’åºè¯­å¥ï¼›</li><li>å¦‚æœæ˜¯å…ˆç­‰å€¼æŸ¥è¯¢å†æ’åºï¼Œå¯ä»¥é€šè¿‡åœ¨æ¡ä»¶å­—æ®µå’Œæ’åºå­—æ®µæ·»åŠ è”åˆç´¢å¼•æ¥ä¼˜åŒ–æ’åºè¯­å¥ã€‚</li></ul><h3 id="4-é¿å…å›è¡¨"><a href="#4-é¿å…å›è¡¨" class="headerlink" title="4 é¿å…å›è¡¨"></a>4 é¿å…å›è¡¨</h3><p>æ¯”å¦‚ä¸‹é¢è¿™æ¡ SQLï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> a<span class="token punctuation">,</span>d <span class="token keyword">from</span> t9_1 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">90000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥èµ° a å­—æ®µçš„ç´¢å¼•ï¼Œä½†æ˜¯åœ¨å­¦äº†ç¬¬ 8 èŠ‚åï¼Œæˆ‘ä»¬çŸ¥é“äº†è¾…åŠ©ç´¢å¼•çš„ç»“æ„ï¼Œå¦‚æœé€šè¿‡è¾…åŠ©ç´¢å¼•æ¥å¯»æ‰¾æ•°æ®ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šéå†è¾…åŠ©ç´¢å¼•æ ‘æŸ¥æ‰¾åˆ°å¯¹åº”è®°å½•çš„ä¸»é”®ï¼Œç„¶åé€šè¿‡ä¸»é”®ç´¢å¼•å›è¡¨å»æ‰¾å¯¹åº”çš„è¡Œæ•°æ®ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæ¡ä»¶å­—æ®µå’Œéœ€è¦æŸ¥è¯¢çš„å­—æ®µæœ‰è”åˆç´¢å¼•çš„è¯ï¼Œå…¶å®å›è¡¨è¿™ä¸€æ­¥å°±çœäº†ï¼Œå› ä¸ºè”åˆç´¢å¼•ä¸­åŒ…å«äº†è¿™ä¸¤ä¸ªå­—æ®µçš„å€¼ã€‚åƒè¿™ç§ç´¢å¼•å°±å·²ç»è¦†ç›–äº†æˆ‘ä»¬çš„æŸ¥è¯¢éœ€æ±‚çš„åœºæ™¯ï¼Œæˆ‘ä»¬ç§°ä¸ºï¼šè¦†ç›–ç´¢å¼•ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ¡ SQLï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> b<span class="token punctuation">,</span>c <span class="token keyword">from</span> t9_1 <span class="token keyword">where</span> b<span class="token operator">=</span><span class="token number">90000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ç›´æ¥é€šè¿‡è”åˆç´¢å¼• idx_b_c æ‰¾åˆ° bã€c çš„å€¼ï¼ˆè”åˆç´¢å¼•è¯¦ç»†è®²è§£å°†æ”¾åœ¨ç¬¬ 11 èŠ‚ï¼‰ã€‚</p><p><strong>æ‰€ä»¥å¯ä»¥é€šè¿‡æ·»åŠ è¦†ç›–ç´¢å¼•è®© SQL ä¸éœ€è¦å›è¡¨ï¼Œä»è€Œå‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œè®©æŸ¥è¯¢æ›´å¿«åœ°è¿”å›ç»“æœã€‚</strong></p><h3 id="5-å…³è”æŸ¥è¯¢"><a href="#5-å…³è”æŸ¥è¯¢" class="headerlink" title="5 å…³è”æŸ¥è¯¢"></a>5 å…³è”æŸ¥è¯¢</h3><p>åœ¨ç¬¬ 6 èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†å…³è”æŸ¥è¯¢çš„ä¸€äº›ä¼˜åŒ–æŠ€å·§ï¼Œå…¶ä¸­ä¸€ä¸ªä¼˜åŒ–æ–¹å¼å°±æ˜¯ï¼šé€šè¿‡åœ¨å…³è”å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œè®© BNLå˜æˆ NLJ æˆ–è€… BKAã€‚</p><h3 id="6-æ€»ç»“-1"><a href="#6-æ€»ç»“-1" class="headerlink" title="6 æ€»ç»“"></a>6 æ€»ç»“</h3><p>æœ¬èŠ‚è®²è§£äº†å¸¸è§éœ€è¦æ·»åŠ ç´¢å¼•çš„åœºæ™¯ï¼š</p><ul><li>æ•°æ®æ£€ç´¢æ—¶åœ¨æ¡ä»¶å­—æ®µæ·»åŠ ç´¢å¼•</li><li>èšåˆå‡½æ•°å¯¹èšåˆå­—æ®µæ·»åŠ ç´¢å¼•</li><li>å¯¹æ’åºå­—æ®µæ·»åŠ ç´¢å¼•</li><li>ä¸ºäº†é˜²æ­¢å›è¡¨æ·»åŠ ç´¢å¼•</li><li>å…³è”æŸ¥è¯¢åœ¨å…³è”å­—æ®µæ·»åŠ ç´¢å¼•</li></ul><h2 id="12-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#12-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="12 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a><strong>12 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</strong></h2><p>å¯¹äºæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«ï¼Œä¹Ÿè®¸ä½ å·²ç»çŸ¥é“ï¼šæœ‰æ™®é€šç´¢å¼•çš„å­—æ®µå¯ä»¥å†™å…¥é‡å¤çš„å€¼ï¼Œè€Œæœ‰å”¯ä¸€ç´¢å¼•çš„å­—æ®µä¸å¯ä»¥å†™å…¥é‡å¤çš„å€¼ã€‚å…¶å®å¯¹äº MySQL æ¥è¯´ï¼Œä¸æ­¢è¿™ä¸€ç§åŒºåˆ«ã€‚ä»Šå¤©æˆ‘ä»¬å°±å†æ·±å…¥æ¢ç©¶ä¸€ä¸‹æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«ã€‚</p><p>åœ¨è®¨è®ºä¸¤è€…çš„åŒºåˆ«å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå­¦ä¹ ä¸€ä¸‹ Insert Buffer å’Œ Change Bufferã€‚</p><h3 id="1-Insert-Buffer"><a href="#1-Insert-Buffer" class="headerlink" title="1 Insert Buffer"></a>1 Insert Buffer</h3><p>å¯¹äºéèšé›†ç´¢å¼•çš„æ’å…¥æ—¶ï¼Œå…ˆåˆ¤æ–­æ’å…¥çš„éèšé›†ç´¢å¼•é¡µæ˜¯å¦åœ¨ç¼“å†²æ± ä¸­ã€‚å¦‚æœåœ¨ï¼Œåˆ™ç›´æ¥æ’å…¥ï¼›å¦‚æœä¸åœ¨ï¼Œåˆ™å…ˆæ”¾å…¥ Insert Buffer ä¸­ï¼Œç„¶åå†ä»¥ä¸€å®šé¢‘ç‡å’Œæƒ…å†µè¿›è¡Œ Insert Buffer å’Œè¾…åŠ©ç´¢å¼•é¡µå­èŠ‚ç‚¹çš„ merge æ“ä½œã€‚è¿™æ—¶é€šå¸¸èƒ½å°†å¤šä¸ªæ’å…¥åˆå¹¶åˆ°ä¸€ä¸ªæ“ä½œä¸­ï¼ˆå› ä¸ºåœ¨ä¸€ä¸ªç´¢å¼•é¡µä¸­ï¼‰ï¼Œå°±å¤§å¤§æé«˜äº†éèšé›†ç´¢å¼•çš„æ’å…¥æ€§èƒ½ã€‚</p><blockquote><p>å¢åŠ  Insert Buffer æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li>å‡å°‘ç£ç›˜çš„ç¦»æ•£è¯»å–</li><li>å°†å¤šæ¬¡æ’å…¥åˆå¹¶ä¸ºä¸€æ¬¡æ“ä½œ</li></ul></blockquote><p>ä½†æ˜¯å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Insert Buffer å¾—æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>ç´¢å¼•æ˜¯è¾…åŠ©ç´¢å¼•</li><li>ç´¢å¼•ä¸æ˜¯å”¯ä¸€</li></ul><h3 id="2-Change-Buffer"><a href="#2-Change-Buffer" class="headerlink" title="2 Change Buffer"></a>2 Change Buffer</h3><p>InnoDB ä» 1.0.x ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº† Change Bufferï¼Œå¯ä»¥ç®—æ˜¯å¯¹ Insert Buffer çš„å‡çº§ã€‚ä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“å¯ä»¥å¯¹ insertã€deleteã€update éƒ½è¿›è¡Œç¼“å­˜ã€‚</p><p>å½±å“å‚æ•°æœ‰ä¸¤ä¸ªï¼š</p><ul><li>innodb_change_bufferingï¼šç¡®å®šå“ªäº›åœºæ™¯ä½¿ç”¨ Change Bufferï¼Œå®ƒçš„å€¼åŒ…å«ï¼šnoneã€insertsã€deletesã€changesã€purgesã€allã€‚é»˜è®¤ä¸º allï¼Œè¡¨ç¤ºå¯ç”¨æ‰€æœ‰ã€‚</li><li>innodb_change_buffer_max_sizeï¼šæ§åˆ¶ Change Buffer æœ€å¤§ä½¿ç”¨å†…å­˜å æ€» buffer pool çš„ç™¾åˆ†æ¯”ã€‚é»˜è®¤25ï¼Œè¡¨ç¤ºæœ€å¤šå¯ä»¥ä½¿ç”¨ buffer pool çš„ 25%ï¼Œæœ€å¤§å€¼50ã€‚</li></ul><p>è·Ÿ Insert Buffer ä¸€æ ·ï¼ŒChange Buffer ä¹Ÿå¾—æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>ç´¢å¼•æ˜¯è¾…åŠ©ç´¢å¼•</li><li>ç´¢å¼•ä¸æ˜¯å”¯ä¸€</li></ul><p>ä¸ºä»€ä¹ˆå”¯ä¸€ç´¢å¼•çš„æ›´æ–°ä¸ä½¿ç”¨ Change Buffer ?</p><p>åŸå› ï¼šå”¯ä¸€ç´¢å¼•<strong>å¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­æ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸ</strong>ã€‚å¦‚æœéƒ½å·²ç»è¯»å…¥åˆ°å†…å­˜äº†ï¼Œé‚£ç›´æ¥æ›´æ–°å†…å­˜ä¼šæ›´å¿«ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨ Change Buffer äº†ã€‚</p><h3 id="3-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«"><a href="#3-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«" class="headerlink" title="3 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«"></a>3 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«</h3><p>é€šè¿‡ä¸Šé¢å¯¹ Insert Buffer å’Œ Change Buffer çš„äº†è§£ï¼Œä¹Ÿè®¸ä½ å·²ç»çŸ¥é“äº†æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„å¦å¤–ä¸€ç§åŒºåˆ«ï¼š<strong>å¦‚æœå¯¹æ•°æ®æœ‰ä¿®æ”¹æ“ä½œï¼Œåˆ™æ™®é€šç´¢å¼•å¯ä»¥ç”¨ Change Bufferï¼Œè€Œå”¯ä¸€ç´¢å¼•ä¸è¡Œã€‚</strong></p><p>åœ¨ä¸Šé¢è®²è§£ Change Buffer æ—¶ï¼Œä¹Ÿæåˆ°äº†ä¿®æ”¹å”¯ä¸€ç´¢å¼•å¿…é¡»åˆ¤æ–­æ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸï¼Œå…¶å®åœ¨ RR éš”ç¦»çº§åˆ«ï¼ˆäº‹åŠ¡éš”ç¦»çº§åˆ«å°†åœ¨ç¬¬ 4 ç« é‡ç‚¹è®²è§£ï¼‰ä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼šæ­»é”ã€‚</p><p>é‚£ä¹ˆæŸ¥è¯¢è¿‡ç¨‹ä¸¤è€…çš„åŒºåˆ«å‘¢ï¼Ÿ</p><p>å¯¹äºæ™®é€šç´¢å¼•ï¼ŒæŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½•ï¼Œè¿˜éœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼Œç›´åˆ°ä¸æ»¡è¶³æ¡ä»¶ã€‚</p><p>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªè®°å½•è¿”å›ç»“æœå°±ç»“æŸäº†ã€‚</p><p>ä½†æ˜¯ InnoDB æ˜¯æŒ‰é¡µä»ç£ç›˜è¯»å–çš„ï¼Œæ‰€ä»¥å¾ˆå¤§å¯èƒ½æ ¹æ®è¯¥æ™®é€šç´¢å¼•æŸ¥è¯¢çš„æ•°æ®éƒ½åœ¨ä¸€ä¸ªæ•°æ®é¡µé‡Œï¼Œå› æ­¤å¦‚æœé€šè¿‡æ™®é€šç´¢å¼•æŸ¥æ‰¾åˆ°ç¬¬ä¸€æ¡æ»¡è¶³æ¡ä»¶æ‰€åœ¨çš„æ•°æ®é¡µï¼Œå†æŸ¥æ‰¾åé¢çš„è®°å½•å¾ˆå¤§æ¦‚ç‡éƒ½åœ¨ä¹‹å‰çš„æ•°æ®é¡µé‡Œï¼Œä¹Ÿå°±æ˜¯å¤šäº†å‡ æ¬¡å†…å­˜æ‰«æï¼Œå®é™…è¿™ç§æ¶ˆè€—å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><p>è¿™é‡Œæ€»ç»“ä¸€ä¸‹æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„éšè—åŒºåˆ«ï¼š</p><ul><li>æ•°æ®ä¿®æ”¹æ—¶ï¼Œæ™®é€šç´¢å¼•å¯ä»¥ç”¨ Change Bufferï¼Œè€Œå”¯ä¸€ç´¢å¼•ä¸è¡Œã€‚</li><li>æ•°æ®ä¿®æ”¹æ—¶ï¼Œå”¯ä¸€ç´¢å¼•åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ›´å®¹æ˜“å‡ºç°æ­»é”ã€‚</li><li>æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ™®é€šç´¢å¼•æŸ¥åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•è¿˜éœ€è¦ç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼Œè€Œå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªè®°å½•å°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœäº†ï¼Œä½†æ˜¯æ™®é€šç´¢å¼•å¤šå‡ºçš„æŸ¥æ‰¾æ¬¡æ•°æ‰€æ¶ˆè€—çš„èµ„æºå¤šæ•°æƒ…å†µå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li></ul><h3 id="4-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¦‚ä½•é€‰æ‹©"><a href="#4-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¦‚ä½•é€‰æ‹©" class="headerlink" title="4 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¦‚ä½•é€‰æ‹©"></a>4 æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¦‚ä½•é€‰æ‹©</h3><p>ä¸Šé¢è¯´äº†æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«ï¼Œé‚£ä¹ˆä¸¤è€…åº”è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p><p>å¦‚æœä¸šåŠ¡è¦æ±‚æŸä¸ªå­—æ®µå”¯ä¸€ï¼Œä½†æ˜¯ä»£ç ä¸èƒ½å®Œå…¨ä¿è¯å†™å…¥å”¯ä¸€å€¼ï¼Œåˆ™æ·»åŠ å”¯ä¸€ç´¢å¼•ï¼Œè®©è¿™ä¸ªå­—æ®µå”¯ä¸€ï¼Œè¯¥å­—æ®µæ–°å¢é‡å¤æ•°æ®æ—¶ï¼Œå°†æŠ¥ç±»ä¼¼å¦‚ä¸‹çš„é”™ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">ERROR 1062 (23000): Duplicate entry '1' for key 'f1'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœä»£ç ç¡®å®šæŸä¸ªå­—æ®µä¸ä¼šæœ‰é‡å¤çš„æ•°æ®å†™å…¥ï¼Œåˆ™å¯ä»¥é€‰æ‹©æ·»åŠ æ™®é€šç´¢å¼•ã€‚ å› ä¸ºæ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ Change Bufferï¼Œå¹¶ä¸”å‡ºç°æ­»é”çš„æ¦‚ç‡æ¯”å”¯ä¸€ç´¢å¼•ä½ã€‚</p><h3 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5 æ€»ç»“"></a>5 æ€»ç»“</h3><p>æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«ï¼š</p><ul><li>æœ‰æ™®é€šç´¢å¼•çš„å­—æ®µå¯ä»¥å†™å…¥é‡å¤çš„å€¼ï¼Œè€Œæœ‰å”¯ä¸€ç´¢å¼•çš„å­—æ®µä¸å¯ä»¥å†™å…¥é‡å¤çš„å€¼ã€‚</li><li>æ•°æ®ä¿®æ”¹æ—¶ï¼Œæ™®é€šç´¢å¼•ä¼˜äºå”¯ä¸€ç´¢å¼•ï¼Œå› ä¸ºæ™®é€šç´¢å¼•å¯ä»¥ç”¨ Change Bufferï¼Œå¹¶ä¸” RR éš”ç¦»çº§åˆ«ä¸‹ï¼Œå‡ºç°æ­»é”çš„æ¦‚ç‡æ¯”å”¯ä¸€ç´¢å¼•ä½ã€‚</li><li>æŸ¥è¯¢æ•°æ®æ—¶ï¼Œä¸¤è€…æ€§èƒ½å·®åˆ«ä¸å¤§ã€‚</li></ul><h2 id="13-è”åˆç´¢å¼•æœ‰å“ªäº›è®²ç©¶"><a href="#13-è”åˆç´¢å¼•æœ‰å“ªäº›è®²ç©¶" class="headerlink" title="13 è”åˆç´¢å¼•æœ‰å“ªäº›è®²ç©¶?"></a><strong>13 è”åˆç´¢å¼•æœ‰å“ªäº›è®²ç©¶?</strong></h2><h3 id="1-è®¤è¯†è”åˆç´¢å¼•"><a href="#1-è®¤è¯†è”åˆç´¢å¼•" class="headerlink" title="1 è®¤è¯†è”åˆç´¢å¼•"></a>1 è®¤è¯†è”åˆç´¢å¼•</h3><p>è”åˆç´¢å¼•ï¼šæ˜¯æŒ‡å¯¹è¡¨ä¸Šçš„å¤šä¸ªåˆ—è¿›è¡Œç´¢å¼•ã€‚é€‚åˆ where æ¡ä»¶ä¸­çš„å¤šåˆ—ç»„åˆï¼Œåœ¨æŸäº›åœºæ™¯å¯ä»¥é¿å…å›è¡¨ã€‚</p><p>æˆ‘ä»¬æ‹¿è®²è§£ order by æ—¶ä½¿ç”¨çš„è”åˆç´¢å¼• B+ æ ‘å›¾è¿›è¡Œç†è§£ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº.png" alt="ä½¿ç”¨èŒƒå›´æŸ¥è¯¢å†æ’åº"></p><p>è”åˆç´¢å¼•çš„é”®å€¼æ•°é‡å¤§äº 1ï¼ˆæ¯”å¦‚ä¸Šå›¾ä¸­æœ‰ a å’Œ b ä¸¤ä¸ªé”®å€¼ï¼‰ï¼Œä¸å•ä¸ªé”®å€¼çš„ B+ æ ‘ä¸€æ ·ï¼Œä¹Ÿæ˜¯æŒ‰ç…§é”®å€¼æ’åºçš„ã€‚<strong>å¯¹äº aã€b ä¸¤ä¸ªå­—æ®µéƒ½åšä¸ºæ¡ä»¶æ—¶ï¼ŒæŸ¥è¯¢æ˜¯å¯ä»¥èµ°ç´¢å¼•çš„ï¼›å¯¹äºå•ç‹¬ a å­—æ®µæŸ¥è¯¢ä¹Ÿæ˜¯å¯ä»¥èµ°ç´¢å¼•çš„ã€‚ä½†æ˜¯å¯¹äº b å­—æ®µå•ç‹¬æŸ¥è¯¢å°±èµ°ä¸äº†ç´¢å¼•äº†ã€‚</strong></p><p>è”åˆç´¢å¼•çš„å»ºè®®ï¼š</p><ul><li>where æ¡ä»¶ä¸­ï¼Œç»å¸¸åŒæ—¶å‡ºç°çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•ä¸­ã€‚</li><li>æŠŠé€‰æ‹©æ€§æœ€å¤§çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦è¾¹ã€‚</li></ul><p>è€è§„çŸ©ï¼Œåˆ›å»ºæµ‹è¯•è¡¨å¹¶å†™å…¥æ•°æ®ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span> <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t11<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t11å­˜åœ¨åˆ™åˆ é™¤è¡¨t11 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t11<span class="token punctuation">`</span> <span class="token punctuation">(</span> <span class="token comment">/* åˆ›å»ºè¡¨t11 */</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>d<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a_b_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t11<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥ä¸€äº›æ•°æ® */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-è”åˆç´¢å¼•ä½¿ç”¨åˆ†æ"><a href="#2-è”åˆç´¢å¼•ä½¿ç”¨åˆ†æ" class="headerlink" title="2 è”åˆç´¢å¼•ä½¿ç”¨åˆ†æ"></a>2 è”åˆç´¢å¼•ä½¿ç”¨åˆ†æ</h3><h4 id="2-1-å¯ä»¥å®Œæ•´ç”¨åˆ°è”åˆç´¢å¼•çš„æƒ…å†µ"><a href="#2-1-å¯ä»¥å®Œæ•´ç”¨åˆ°è”åˆç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="2 .1 å¯ä»¥å®Œæ•´ç”¨åˆ°è”åˆç´¢å¼•çš„æƒ…å†µ"></a>2 .1 å¯ä»¥å®Œæ•´ç”¨åˆ°è”åˆç´¢å¼•çš„æƒ…å†µ</h4><p>ä¸‹é¢æˆ‘ä»¬åˆ—å‡ºå‡ ç§å¯ä»¥å®Œæ•´ç”¨åˆ°è”åˆç´¢å¼•çš„æƒ…å†µï¼Œå¹¶æŸ¥çœ‹å…¶æ‰§è¡Œè®¡åˆ’ï¼Œç„¶åè¿›è¡Œç®€çŸ­çš„åˆ†æï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* sql1 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»“æœï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref               | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 15      | const,const,const |    1 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>explain ä¸­çš„ key_len åˆ—ç”¨äºè¡¨ç¤ºè¿™æ¬¡æŸ¥è¯¢ä¸­ï¼Œæ‰€é€‰æ‹©çš„ç´¢å¼•é•¿åº¦æœ‰å¤šå°‘å­—èŠ‚ï¼Œå¸¸ç”¨äºåˆ¤æ–­è”åˆç´¢å¼•æœ‰å¤šå°‘åˆ—è¢«é€‰æ‹©äº†ã€‚ä¸‹è¡¨æ€»ç»“äº†å¸¸ç”¨å­—æ®µç±»å‹çš„ key_lenï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">åˆ—ç±»å‹</th><th style="text-align:left">KEY_LEN</th><th style="text-align:left">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left">int</td><td style="text-align:left">key_len = 4+1</td><td style="text-align:left">int ä¸º 4 bytesï¼Œå…è®¸ä¸º NULLï¼ŒåŠ  1 byte</td></tr><tr><td style="text-align:left">int not null</td><td style="text-align:left">key_len = 4</td><td style="text-align:left">ä¸å…è®¸ä¸º NULL</td></tr><tr><td style="text-align:left">bigint</td><td style="text-align:left">key_len=8+1</td><td style="text-align:left">bigint ä¸º 8 bytesï¼Œå…è®¸ä¸º NULL åŠ  1 byte</td></tr><tr><td style="text-align:left">bigint not null</td><td style="text-align:left">key_len=8</td><td style="text-align:left">bigint ä¸º 8 bytes</td></tr><tr><td style="text-align:left">char(30) utf8</td><td style="text-align:left">key_len=30*3+1</td><td style="text-align:left">char(n)ä¸ºï¼šn * 3 ï¼Œå…è®¸ä¸º NULL åŠ  1 byte</td></tr><tr><td style="text-align:left">char(30) not null utf8</td><td style="text-align:left">key_len=30*3</td><td style="text-align:left">ä¸å…è®¸ä¸º NULL</td></tr><tr><td style="text-align:left">varchar(30) not null utf8</td><td style="text-align:left">key_len=30*3+2</td><td style="text-align:left">utf8 æ¯ä¸ªå­—ç¬¦ä¸º 3 bytesï¼Œå˜é•¿æ•°æ®ç±»å‹,åŠ  2 bytes</td></tr><tr><td style="text-align:left">varchar(30) utf8</td><td style="text-align:left">key_len=30*3+2+1</td><td style="text-align:left">utf8 æ¯ä¸ªå­—ç¬¦ä¸º 3 bytesï¼Œå…è®¸ä¸º NULL,åŠ  1 byte,å˜é•¿æ•°æ®ç±»å‹ï¼ŒåŠ  2 bytes</td></tr><tr><td style="text-align:left">datetime</td><td style="text-align:left">key_len=8+1 (MySQL 5.6.4ä¹‹å‰çš„ç‰ˆæœ¬)ï¼›key_len=5+1(MySQL 5.6.4åŠä¹‹åçš„ç‰ˆæœ¬)</td><td style="text-align:left">å…è®¸ä¸º NULLï¼ŒåŠ  1 byte</td></tr></tbody></table></div><p>å› ä¸º aã€bã€c ä¸‰ä¸ªå­—æ®µéƒ½æ˜¯å¯ä»¥ä¸º NULL çš„ int å‹ã€‚å¯ä»¥çŸ¥é“ä¸‰ä¸ªå­—æ®µçš„ key_len éƒ½æ˜¯ 5ï¼Œæ‰€ä»¥å¦‚æœå®Œæ•´ä½¿ç”¨ç´¢å¼• idx_a_b_cï¼Œåˆ™ key_len å¯¹åº”çš„å€¼ä¸º 15ã€‚å†å›åˆ°ä¸Šé¢ sql1 çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼škey_len æ˜¾ç¤ºæ˜¯ 15ï¼Œè€Œ key åˆ—å¯¹åº”çš„æ˜¯ idx_a_b_cï¼Œæ‰€ä»¥ sql1 å®Œæ•´ç”¨åˆ°äº†è”åˆç´¢å¼• idx_a_b_cã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> c<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">/* sql2 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref               | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 15      | const,const,const |    1 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·Ÿ sql1 çš„æ‰§è¡Œè®¡åˆ’ä¸€æ ·ï¼Œå› æ­¤è”åˆç´¢å¼•å„å­—æ®µéƒ½åšä¸ºæ¡ä»¶æ—¶ï¼Œå„å­—æ®µçš„ä½ç½®ä¸ä¼šå½±å“è”åˆç´¢å¼•çš„ä½¿ç”¨ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">and</span> b <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">/* sql3 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-----------------------+| id | select_type | table | partitions | type  | possible_keys | key       | key_len | ref  | rows | filtered | Extra                 |+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-----------------------+|  1 | SIMPLE      | t11   | NULL       | range | idx_a_b_c     | idx_a_b_c | 15      | NULL |    2 |   100.00 | Using index condition |+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-----------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“è”åˆç´¢å¼•å‰é¢çš„å­—æ®µä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼Œåé¢çš„å­—æ®µåšä¸ºæ¡ä»¶æ—¶ä»ç„¶å¯ä»¥ä½¿ç”¨å®Œæ•´çš„è”åˆç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">order</span> <span class="token keyword">by</span> c<span class="token punctuation">;</span>  <span class="token comment">/* sql4 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref         | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 10      | const,const |    4 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è”åˆç´¢å¼•å‰é¢çš„å­—æ®µåšä¸ºæ¡ä»¶æ—¶ï¼Œå¯¹åé¢çš„å­—æ®µåšæ’åºå¯ä»¥ä½¿ç”¨å®Œæ•´çš„è”åˆç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">order</span> <span class="token keyword">by</span> b<span class="token punctuation">,</span>c<span class="token punctuation">;</span>  <span class="token comment">/* sql5 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref   | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 5       | const |    5 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ sql4 ç›¸ä¼¼ï¼Œå¯¹è”åˆç´¢å¼•ç¬¬ä¸€ä¸ªå­—æ®µåšæ¡ä»¶ç­›é€‰æ—¶ï¼Œå¯¹åé¢ä¸¤ä¸ªå­—æ®µåšæ’åºå¯ä»¥ä½¿ç”¨å®Œæ•´çš„è”åˆç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c <span class="token keyword">from</span> t11 <span class="token keyword">order</span> <span class="token keyword">by</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">;</span>  <span class="token comment">/* sql6 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type  | possible_keys | key       | key_len | ref  | rows | filtered | Extra       |+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+|  1 | SIMPLE      | t11   | NULL       | index | NULL          | idx_a_b_c | 15      | NULL |   15 |   100.00 | Using index |+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹è”åˆç´¢å¼•çš„å­—æ®µåŒæ—¶åšæ’åºæ—¶ï¼ˆä½†æ˜¯æ’åºçš„ä¸‰ä¸ªå­—æ®µé¡ºåºè¦è·Ÿè”åˆç´¢å¼•ä¸­ä¸‰ä¸ªå­—æ®µçš„é¡ºåºä¸€è‡´ï¼‰ï¼Œå¯ä»¥å®Œæ•´ç”¨åˆ°è”åˆç´¢å¼•ã€‚</p><h4 id="2-2-åªèƒ½ä½¿ç”¨éƒ¨åˆ†è”åˆç´¢å¼•çš„æƒ…å†µ"><a href="#2-2-åªèƒ½ä½¿ç”¨éƒ¨åˆ†è”åˆç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="2.2 åªèƒ½ä½¿ç”¨éƒ¨åˆ†è”åˆç´¢å¼•çš„æƒ…å†µ"></a>2.2 åªèƒ½ä½¿ç”¨éƒ¨åˆ†è”åˆç´¢å¼•çš„æƒ…å†µ</h4><p>æœ‰äº›åœºæ™¯åªèƒ½ç”¨åˆ°éƒ¨åˆ†è”åˆç´¢å¼•ï¼Œè¿™é‡Œå°±åˆ—å‡ºå‡ ç§æƒ…å†µã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* sql11 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref         | rows | filtered | Extra |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 10      | const,const |    1 |   100.00 | NULL  |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æ¡ä»¶åªåŒ…å«è”åˆç´¢å¼•çš„å‰é¢éƒ¨åˆ†å­—æ®µæ—¶ï¼Œå¯ä»¥ç”¨åˆ°éƒ¨åˆ†è”åˆç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* sql12 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-----------------------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref   | rows | filtered | Extra                 |+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-----------------------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 5       | const |    5 |    10.00 | Using index condition |+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-----------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äºè”åˆç´¢å¼• idx_a_b_cï¼ˆa,b,cï¼‰ ï¼Œå¦‚æœæ¡ä»¶ä¸­åªåŒ…å« a å’Œ cï¼Œåˆ™åªèƒ½ç”¨åˆ°è”åˆç´¢å¼•ä¸­ a çš„ç´¢å¼•ã€‚c è¿™é‡Œæ˜¯ç”¨ä¸äº†ç´¢å¼•çš„ã€‚<strong>è”åˆç´¢å¼• idx_a_b_c(a,b,c) ç›¸å½“äº (a) ã€(a,b) ã€(a,b,c) ä¸‰ç§ç´¢å¼•ï¼Œç§°ä¸ºè”åˆç´¢å¼•çš„æœ€å·¦åŸåˆ™ã€‚</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">2</span>  <span class="token operator">and</span> b <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> c<span class="token punctuation">;</span> <span class="token comment">/* sql13 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+---------------------------------------+| id | select_type | table | partitions | type  | possible_keys | key       | key_len | ref  | rows | filtered | Extra                                 |+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+---------------------------------------+|  1 | SIMPLE      | t11   | NULL       | range | idx_a_b_c     | idx_a_b_c | 10      | NULL |    2 |   100.00 | Using index condition; Using filesort |+----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+---------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œå¯ä»¥å¤ä¹ ç¬¬ 4 èŠ‚ 2.4ï¼Œ<strong>å½“è”åˆç´¢å¼•å‰é¢çš„å­—æ®µä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼Œå¯¹åé¢çš„å­—æ®µæ’åºä½¿ç”¨ä¸äº†ç´¢å¼•æ’åº</strong>ï¼Œä¹Ÿå°±æ˜¯åªèƒ½ç”¨åˆ°è”åˆç´¢å¼•å‰é¢ä¸¤ä¸ªå­—æ®µ a å’Œ b çš„ç´¢å¼•ã€‚</p><h4 id="2-3-å¯ä»¥ç”¨åˆ°è¦†ç›–ç´¢å¼•çš„æƒ…å†µ"><a href="#2-3-å¯ä»¥ç”¨åˆ°è¦†ç›–ç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="2.3 å¯ä»¥ç”¨åˆ°è¦†ç›–ç´¢å¼•çš„æƒ…å†µ"></a>2.3 å¯ä»¥ç”¨åˆ°è¦†ç›–ç´¢å¼•çš„æƒ…å†µ</h4><p>ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ</p><p>ä»è¾…åŠ©ç´¢å¼•ä¸­å°±å¯ä»¥æŸ¥è¯¢åˆ°ç»“æœï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢èšé›†ç´¢å¼•ä¸­çš„è®°å½•ã€‚</p><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„ä¼˜åŠ¿ï¼šå› ä¸ºä¸éœ€è¦æ‰«æèšé›†ç´¢å¼•ï¼Œå› æ­¤å¯ä»¥å‡å°‘ SQL æ‰§è¡Œè¿‡ç¨‹çš„ IO æ¬¡æ•°ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> b<span class="token punctuation">,</span>c <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">/* sql21 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref   | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 5       | const |    1 |   100.00 | Using index |+----+-------------+-------+------------+------+---------------+-----------+---------+-------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ a å­—æ®µä¸Šçš„æ¡ä»¶ï¼Œå»è”åˆç´¢å¼• idx_a_b_c çš„ç´¢å¼•æ ‘ä¸Šå¯ä»¥ç›´æ¥æŸ¥æ‰¾åˆ° b å­—æ®µå’Œ c å­—æ®µçš„å€¼ï¼Œä¸éœ€è¦å›è¡¨ï¼Œå› æ­¤ sql21 ä½¿ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> c <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment">/* sql22 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref         | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 10      | const,const |    1 |   100.00 | Using index |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·Ÿ sql21 ç±»ä¼¼ï¼Œåœ¨è”åˆç´¢å¼• idx_a_b_c çš„ç´¢å¼•æ ‘ä¸Šï¼Œé€šè¿‡ a å’Œ b çš„å€¼å¯ä»¥ç›´æ¥æ‰¾åˆ° c çš„å€¼ï¼Œå› æ­¤ sql22 ä½¿ç”¨çš„ä¹Ÿæ˜¯è¦†ç›–ç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id <span class="token keyword">from</span> t11 <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* sql23 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key       | key_len | ref               | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------------+|  1 | SIMPLE      | t11   | NULL       | ref  | idx_a_b_c     | idx_a_b_c | 15      | const,const,const |    1 |   100.00 | Using index |+----+-------------+-------+------------+------+---------------+-----------+---------+-------------------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ aã€bã€c ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå»è”åˆç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ‰¾åˆ°ä¸»é”® idï¼Œä¸éœ€è¦å›è¡¨ï¼Œå› æ­¤ sql23 ä¹Ÿä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ã€‚</p><h4 id="2-4-ä¸èƒ½ä½¿ç”¨è”åˆç´¢å¼•çš„æƒ…å†µ"><a href="#2-4-ä¸èƒ½ä½¿ç”¨è”åˆç´¢å¼•çš„æƒ…å†µ" class="headerlink" title="2.4 ä¸èƒ½ä½¿ç”¨è”åˆç´¢å¼•çš„æƒ…å†µ"></a>2.4 ä¸èƒ½ä½¿ç”¨è”åˆç´¢å¼•çš„æƒ…å†µ</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* sql31 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+|  1 | SIMPLE      | t11   | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   15 |    10.00 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœåªä½¿ç”¨è”åˆç´¢å¼•åé¢çš„å­—æ®µåšä¸ºæ¡ä»¶æŸ¥è¯¢ï¼Œåˆ™ä½¿ç”¨ä¸äº†è”åˆç´¢å¼•ï¼ˆè”åˆç´¢å¼•æœ€å·¦åŒ¹é…ï¼‰ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">order</span> <span class="token keyword">by</span> b<span class="token punctuation">;</span> <span class="token comment">/* sql32 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+|  1 | SIMPLE      | t11   | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   15 |   100.00 | Using filesort |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ sql31 ç›¸ä¼¼ï¼Œå¯¹è”åˆç´¢å¼•åé¢çš„å­—æ®µåšæ’åºæ“ä½œï¼Œä¹Ÿä½¿ç”¨ä¸äº†è”åˆç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> c<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* sql33 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+|  1 | SIMPLE      | t11   | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   15 |    10.00 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ sql31 ç±»ä¼¼ã€‚c å­—æ®µå•ç‹¬åšæ¡ä»¶ä½¿ç”¨ä¸äº†ç´¢å¼•ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t11 <span class="token keyword">where</span> b<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> c<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* sql34 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+|  1 | SIMPLE      | t11   | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   15 |     6.67 | Using where |+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è”åˆç´¢å¼•ä¸­ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—æ®µåœ¨æ¡ä»¶ä¸­æ²¡æœ‰å‡ºç°ï¼Œé‚£ä¹ˆè”åˆç´¢å¼•çš„åé¢æ‰€æœ‰å­—æ®µä½œä¸ºæ¡ä»¶éƒ½æ— æ³•ä½¿ç”¨è¿™ä¸ªè”åˆç´¢å¼•ã€‚</p><h2 id="14-ä¸ºä»€ä¹ˆMySQLä¼šé€‰é”™ç´¢å¼•ï¼Ÿ"><a href="#14-ä¸ºä»€ä¹ˆMySQLä¼šé€‰é”™ç´¢å¼•ï¼Ÿ" class="headerlink" title="14 ä¸ºä»€ä¹ˆMySQLä¼šé€‰é”™ç´¢å¼•ï¼Ÿ"></a><strong>14 ä¸ºä»€ä¹ˆMySQLä¼šé€‰é”™ç´¢å¼•ï¼Ÿ</strong></h2><p>åœ¨å·¥ä½œä¸­ï¼Œä¹Ÿè®¸æˆ‘ä»¬æœ‰æ—¶ä¼šé‡åˆ°è¿™ç§åœºæ™¯ï¼šæŸæ¡ SQL æ˜æ˜å¯ä»¥èµ° a ç´¢å¼•ï¼Œå´èµ°äº†æ›´æ…¢çš„ b ç´¢å¼•ã€‚ ä»Šå¤©æˆ‘ä»¬å°±æ¥è®¨è®ºè¿™ç§ç°è±¡ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿å®éªŒï¼Œé¦–å…ˆåˆ›å»ºæµ‹è¯•è¡¨å¹¶å†™å…¥æµ‹è¯•æ•°æ®ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t13<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t13<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t13<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t13ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t13<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t13 */</span><span class="token keyword">begin</span>    <span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">/* å£°æ˜å˜é‡i */</span>    <span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span> <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=10000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span>        <span class="token keyword">insert</span> <span class="token keyword">into</span> t13<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t13ä¸­aå­—æ®µï¼Œå€¼ä¸ºiå½“å‰çš„å€¼ */</span>        <span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* å°†iåŠ 1 */</span>    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥10000æ¡æ•°æ®åˆ°è¡¨t13çš„å­˜å‚¨è¿‡ç¨‹insert_t13 */</span><span class="token keyword">call</span> insert_t13<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* è¿è¡Œå­˜å‚¨è¿‡ç¨‹insert_t13 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨åˆ†æ MySQL é€‰é”™ç´¢å¼•çš„æƒ…å†µä¹‹å‰ï¼Œå…ˆè®² show index çš„ä½¿ç”¨ï¼Œå› ä¸ºåé¢ä¼šç”¨åˆ°ã€‚</p><h3 id="1ã€show-index-çš„ä½¿ç”¨"><a href="#1ã€show-index-çš„ä½¿ç”¨" class="headerlink" title="1ã€show index çš„ä½¿ç”¨"></a>1ã€show index çš„ä½¿ç”¨</h3><p>å½“ä½ éœ€è¦æŸ¥çœ‹æŸå¼ è¡¨çš„ç´¢å¼•è¯¦æƒ…æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> t13<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-text" data-language="text"><code class="language-text">+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+| Table | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+| t13   |          0 | PRIMARY  |            1 | id          | A         |        9192 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       || t13   |          1 | idx_a    |            1 | a           | A         |        9212 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       || t13   |          1 | idx_b    |            1 | b           | A         |        9212 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |+-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹ä¸Šé¢å‡ ä¸ªé‡è¦çš„å­—æ®µåšä¸€ä¸‹è§£é‡Šï¼š</p><ul><li>Non_uniqueï¼šå¦‚æœæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œåˆ™å€¼ä¸º 0ï¼Œå¦‚æœå¯ä»¥æœ‰é‡å¤å€¼ï¼Œåˆ™å€¼ä¸º 1</li><li>Key_nameï¼šç´¢å¼•åå­—</li><li>Seq_in_indexï¼šç´¢å¼•ä¸­çš„åˆ—åºå·ï¼Œæ¯”å¦‚è”åˆç´¢å¼• idx_a_b_c(a,b,c) ï¼Œé‚£ä¹ˆä¸‰ä¸ªå­—æ®µåˆ†åˆ«å¯¹åº” 1,2,3</li><li>Column_nameï¼šå­—æ®µå</li><li>Collationï¼šå­—æ®µåœ¨ç´¢å¼•ä¸­çš„æ’åºæ–¹å¼ï¼ŒA è¡¨ç¤ºå‡åºï¼ŒNULL è¡¨ç¤ºæœªæ’åº</li><li>Cardinalityï¼šç´¢å¼•ä¸­ä¸é‡å¤è®°å½•æ•°é‡çš„é¢„ä¼°å€¼ï¼Œè¯¥å€¼ç­‰ä¼šå„¿ä¼šè¯¦ç»†è®²è§£</li><li>Sub_partï¼šå¦‚æœæ˜¯å‰ç¼€ç´¢å¼•ï¼Œåˆ™ä¼šæ˜¾ç¤ºç´¢å¼•å­—ç¬¦çš„æ•°é‡ï¼›å¦‚æœæ˜¯å¯¹æ•´åˆ—è¿›è¡Œç´¢å¼•ï¼Œåˆ™è¯¥å­—æ®µå€¼ä¸º NULL</li><li>Nullï¼šå¦‚æœåˆ—å¯èƒ½åŒ…å«ç©ºå€¼ï¼Œåˆ™è¯¥å­—æ®µä¸º YESï¼›å¦‚æœä¸åŒ…å«ç©ºå€¼ï¼Œåˆ™è¯¥å­—æ®µå€¼ä¸º â€˜ â€˜</li><li>Index_typeï¼šç´¢å¼•ç±»å‹ï¼ŒåŒ…æ‹¬ BTREEã€FULLTEXTã€HASHã€RTREE ç­‰</li></ul><p>show index å„å­—æ®µçš„è¯¦ç»†æè¿°å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/show-index.htmlã€‚">https://dev.mysql.com/doc/refman/5.7/en/show-index.htmlã€‚</a></p><h3 id="2ã€Cardinality-å–å€¼"><a href="#2ã€Cardinality-å–å€¼" class="headerlink" title="2ã€Cardinality å–å€¼"></a>2ã€Cardinality å–å€¼</h3><p>Cardinality è¡¨ç¤ºè¯¥ç´¢å¼•ä¸é‡å¤è®°å½•æ•°é‡çš„é¢„ä¼°å€¼ã€‚å¦‚æœè¯¥å€¼æ¯”è¾ƒå°ï¼Œé‚£å°±åº”è¯¥è€ƒè™‘æ˜¯å¦è¿˜æœ‰å¿…è¦åˆ›å»ºè¿™ä¸ªç´¢å¼•ã€‚æ¯”å¦‚æ€§åˆ«è¿™ç§ç±»å‹çš„å­—æ®µï¼Œå³ä½¿åŠ äº†ç´¢å¼•ï¼ŒCardinality å€¼æ¯”è¾ƒå°ï¼Œä½¿ç”¨æ€§åˆ«åšæ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¯èƒ½æ ¹æœ¬ç”¨ä¸åˆ°å·²ç»æ·»åŠ çš„ç´¢å¼•ï¼ˆå¯ä»¥å‚è€ƒç¬¬ 3 èŠ‚çš„ç¬¬ 4 éƒ¨åˆ†ï¼šèŒƒå›´æŸ¥è¯¢ï¼‰ã€‚</p><p>Cardinality ç»Ÿè®¡ä¿¡æ¯çš„æ›´æ–°å‘ç”Ÿåœ¨ä¸¤ä¸ªæ“ä½œä¸­ï¼šINSERT å’Œ UPDATEã€‚å½“ç„¶ä¹Ÿä¸æ˜¯æ¯æ¬¡ INSERT æˆ– UPDATE å°±æ›´æ–°çš„ï¼Œå…¶æ›´æ–°æ—¶æœºä¸ºï¼š</p><ul><li>è¡¨ä¸­ 1/16 çš„æ•°æ®å·²ç»å‘ç”Ÿè¿‡å˜åŒ–</li><li>è¡¨ä¸­æ•°æ®å‘ç”Ÿå˜åŒ–æ¬¡æ•°è¶…è¿‡ 2000000000</li></ul><p>Cardinality å€¼æ˜¯æ€æ ·ç»Ÿè®¡å’Œæ›´æ–°çš„å‘¢ï¼Ÿ</p><p>InnoDB è¡¨å–å‡º B+ æ ‘ç´¢å¼•ä¸­å¶å­èŠ‚ç‚¹çš„æ•°é‡ï¼Œè®°ä¸º aï¼›éšæœºå–å‡º B+ æ ‘ç´¢å¼•ä¸­çš„ 8 ä¸ªï¼ˆè¿™ä¸ªæ•°é‡æœ‰å‚æ•° innodb_stats_transient_sample_pages æ§åˆ¶ï¼Œé»˜è®¤ä¸º 8ï¼‰å¶å­èŠ‚ç‚¹ï¼Œç»Ÿè®¡æ¯ä¸ªé¡µä¸­ä¸åŒè®°å½•çš„ä¸ªæ•°ï¼ˆå‡è®¾ä¸º b1ï¼Œb2ï¼Œb3ï¼Œâ€¦ï¼Œb8ï¼‰ã€‚åˆ™ Cardinality çš„é¢„ä¼°å€¼ä¸ºï¼š</p><p>ï¼ˆb1 + b2 + b3 + â€¦ b8ï¼‰* a/8</p><p>æ‰€ä»¥ Cardinality çš„å€¼æ˜¯å¯¹ 8 ä¸ªå¶å­èŠ‚ç‚¹è¿›è¡Œé‡‡æ ·è·å–çš„ï¼Œæ˜¾ç„¶è¿™ä¸ªå€¼å¹¶ä¸å‡†ç¡®ï¼Œåªä¾›å‚è€ƒã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹ç»Ÿè®¡ Cardinality æ¶‰åŠåˆ°çš„å‡ ä¸ªå‚æ•°ï¼š</p><ul><li>innodb_stats_transient_sample_pagesï¼šè®¾ç½®ç»Ÿè®¡ Cardinality å€¼æ—¶æ¯æ¬¡é‡‡æ ·é¡µçš„æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 8ã€‚</li><li>innodb_stats_methodï¼šç”¨æ¥åˆ¤æ–­å¦‚æœå¯¹å¾…ç´¢å¼•ä¸­å‡ºç°çš„ NULL å€¼è®°å½•ï¼Œé»˜è®¤ä¸º nulls_equalï¼Œè¡¨ç¤ºå°† NULL å€¼è®°å½•è§†ä¸ºç›¸ç­‰çš„è®°å½•ã€‚å¦å¤–è¿˜æœ‰ nulls_unequal å’Œ nulls_ignoredã€‚nulls_unequal è¡¨ç¤ºå°† NULL è§†ä¸ºä¸åŒçš„è®°å½•ï¼Œnulls_ignored è¡¨ç¤ºå¿½ç•¥ NULL å€¼è®°å½•ã€‚</li><li>innodb_stats_persistentï¼šæ˜¯å¦å°† Cardinality æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å¥½å¤„æ˜¯ï¼šæ¯”å¦‚æ•°æ®åº“é‡å¯ï¼Œä¸éœ€è¦å†è®¡ç®— Cardinality çš„å€¼ã€‚</li><li>innodb_stats_on_metadataï¼šå½“é€šè¿‡å‘½ä»¤ show table statusã€show index åŠè®¿é—® information_chema åº“ä¸‹çš„ tables è¡¨å’Œ statistics è¡¨æ—¶ï¼Œæ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—ç´¢å¼•çš„ Cardinalityã€‚ç›®çš„æ˜¯è€ƒè™‘æœ‰äº›è¡¨æ•°æ®é‡å¤§ï¼Œå¹¶ä¸”è¾…åŠ©ç´¢å¼•å¤šæ—¶ï¼Œæ‰§è¡Œè¿™äº›æ“ä½œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œè€Œä½¿ç”¨è€…å¯èƒ½å¹¶ä¸éœ€è¦æ›´æ–° Cardinalityã€‚</li></ul><h3 id="3ã€ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®å¯¼è‡´é€‰é”™ç´¢å¼•"><a href="#3ã€ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®å¯¼è‡´é€‰é”™ç´¢å¼•" class="headerlink" title="3ã€ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®å¯¼è‡´é€‰é”™ç´¢å¼•"></a>3ã€ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®å¯¼è‡´é€‰é”™ç´¢å¼•</h3><p>åœ¨ MySQL ä¸­ï¼Œ<strong>ä¼˜åŒ–å™¨æ§åˆ¶ç€ç´¢å¼•çš„é€‰æ‹©ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼˜åŒ–å™¨ä¼šè€ƒè™‘æ‰«æè¡Œæ•°ã€æ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ˜¯å¦æ’åºç­‰å› ç´ ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜æ–¹æ¡ˆå»æ‰§è¡Œ SQL è¯­å¥</strong>ã€‚</p><p>è€Œ MySQL ä¸­æ‰«æè¡Œæ•°å¹¶ä¸ä¼šæ¯æ¬¡æ‰§è¡Œè¯­å¥éƒ½å»è®¡ç®—ä¸€æ¬¡ï¼Œå› ä¸ºæ¯æ¬¡éƒ½å»è®¡ç®—ï¼Œæ•°æ®åº“å‹åŠ›å¤ªå¤§äº†ã€‚å®é™…æƒ…å†µæ˜¯é€šè¿‡ç»Ÿè®¡ä¿¡æ¯æ¥é¢„ä¼°æ‰«æè¡Œæ•°ã€‚è¿™ä¸ªç»Ÿè®¡ä¿¡æ¯å°±å¯ä»¥çœ‹æˆ show index ä¸­çš„ Cardinalityã€‚</p><p>è€Œä»ä¸Šé¢è¯´åˆ° Cardinality çš„æ›´æ–°åŸç†å¯ä»¥çœ‹å‡ºï¼Œå®ƒçš„å€¼ä¸ä¸€å®šå‡†ç¡®çš„ï¼Œå› æ­¤æœ‰æ—¶å¯èƒ½å°±æ˜¯å› ä¸ºå®ƒçš„å€¼ä¸ç²¾å‡†å¯¼è‡´é€‰é”™äº†ç´¢å¼•ã€‚è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤é‡æ–°ç»Ÿè®¡ä¿¡æ¯ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">analyze</span> <span class="token keyword">table</span> t13<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4ã€å•æ¬¡é€‰å–çš„æ•°æ®é‡è¿‡å¤§å¯¼è‡´é€‰é”™ç´¢å¼•"><a href="#4ã€å•æ¬¡é€‰å–çš„æ•°æ®é‡è¿‡å¤§å¯¼è‡´é€‰é”™ç´¢å¼•" class="headerlink" title="4ã€å•æ¬¡é€‰å–çš„æ•°æ®é‡è¿‡å¤§å¯¼è‡´é€‰é”™ç´¢å¼•"></a>4ã€å•æ¬¡é€‰å–çš„æ•°æ®é‡è¿‡å¤§å¯¼è‡´é€‰é”™ç´¢å¼•</h3><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼Œå¦‚æœå•æ¬¡é€‰å–çš„æ•°æ®é‡è¿‡å¤§ï¼Œå¯èƒ½ä¹Ÿä¼šå¯¼è‡´â€œé€‰é”™â€ç´¢å¼•ã€‚</p><hr><p>ç¬¬3ç«  MySQLé”</p><h2 id="15-å…¨å±€é”å’Œè¡¨é”ä»€ä¹ˆåœºæ™¯ä¼šç”¨åˆ°"><a href="#15-å…¨å±€é”å’Œè¡¨é”ä»€ä¹ˆåœºæ™¯ä¼šç”¨åˆ°" class="headerlink" title="15 å…¨å±€é”å’Œè¡¨é”ä»€ä¹ˆåœºæ™¯ä¼šç”¨åˆ°"></a><strong>15 å…¨å±€é”å’Œè¡¨é”ä»€ä¹ˆåœºæ™¯ä¼šç”¨åˆ°</strong></h2><p>æ ¹æ®åŠ é”çš„èŒƒå›´ï¼ŒMySQL ä¸­çš„é”å¯åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li>å…¨å±€é”</li><li>è¡¨çº§é”</li><li>è¡Œé”</li></ul><p>æœ¬èŠ‚æ¥é‡ç‚¹è®²è§£ä¸€ä¸‹å…¨å±€é”å’Œè¡¨é”ã€‚</p><h3 id="1-å…¨å±€é”"><a href="#1-å…¨å±€é”" class="headerlink" title="1 å…¨å±€é”"></a><strong>1 å…¨å±€é”</strong></h3><p>MySQL å…¨å±€é”ä¼šå…³é—­æ‰€æœ‰æ‰“å¼€çš„è¡¨ï¼Œå¹¶ä½¿ç”¨å…¨å±€è¯»é”é”å®šæ‰€æœ‰è¡¨ã€‚å…¶å‘½ä»¤ä¸ºï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">FLUSH <span class="token keyword">TABLES</span> <span class="token keyword">WITH</span> <span class="token keyword">READ</span> <span class="token keyword">LOCK</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç®€ç§°ï¼šFTWRLï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤è§£é”ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UNLOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬æ¥é€šè¿‡å®éªŒç†è§£ä¸€ä¸‹å…¨å±€é”ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t14<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t14<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t14<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›è¡Œ FTWRL å®éªŒï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th></tr></thead><tbody><tr><td style="text-align:left">FLUSH TABLES WITH READ LOCK;<br>Query OK, 0 rows affected (0.00 sec)</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">select <em> from t14 limit 1;<br>â€¦ <br>1 row in set (0.00 sec) <br> <em>*ï¼ˆèƒ½æ­£å¸¸è¿”å›ç»“æœï¼‰</em></em></td><td style="text-align:left">select <em> from t14 limit 1;<br>â€¦<br>1 row in set (0.00 sec) <br> <em>*ï¼ˆèƒ½æ­£å¸¸è¿”å›ç»“æœï¼‰</em></em></td></tr><tr><td style="text-align:left">insert into t14(a,b) values(2,2);<br>ERROR 1223 (HY000): Canâ€™t execute the query because you have a conflicting read lock <br> <strong>ï¼ˆæŠ¥é”™ï¼‰</strong></td><td style="text-align:left">insert into t14(a,b) values(2,2);/<em> sql1 </em>/ <br> <strong>ï¼ˆç­‰å¾…ï¼‰</strong></td></tr><tr><td style="text-align:left">UNLOCK TABLES;</td><td style="text-align:left">insert into t14(a,b) values(2,2);/<em> sql1 </em>/<br>Query OK, 1 row affected (5.73 sec) <br> <strong>ï¼ˆsession1 è§£é”åï¼Œåœ¨ç­‰å¾…çš„ sql1 é©¬ä¸Šæ‰§è¡ŒæˆåŠŸï¼‰</strong></td></tr></tbody></table></div><p>ä¸Šé¢çš„å®éªŒä¸­ï¼Œå½“ session1 æ‰§è¡Œ FTWRL åï¼Œæœ¬çº¿ç¨‹ session1 å’Œå…¶å®ƒçº¿ç¨‹ session2 éƒ½å¯ä»¥æŸ¥è¯¢ï¼Œæœ¬çº¿ç¨‹å’Œå…¶å®ƒçº¿ç¨‹éƒ½ä¸èƒ½æ›´æ–°ã€‚</p><p>åŸå› æ˜¯ï¼š<strong>å½“æ‰§è¡Œ FTWRL åï¼Œæ‰€æœ‰çš„è¡¨éƒ½å˜æˆåªè¯»çŠ¶æ€ï¼Œæ•°æ®æ›´æ–°æˆ–è€…å­—æ®µæ›´æ–°å°†ä¼šè¢«é˜»å¡ã€‚</strong></p><p>é‚£ä¹ˆå…¨å±€é”ä¸€èˆ¬ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°å‘¢ï¼Ÿ</p><p>å…¨å±€é”ä¸€èˆ¬ç”¨åœ¨æ•´ä¸ªåº“ï¼ˆåŒ…å«éäº‹åŠ¡å¼•æ“è¡¨ï¼‰åšå¤‡ä»½ï¼ˆmysqldump æˆ–è€… xtrabackupï¼‰æ—¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•´ä¸ªå¤‡ä»½è¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªåº“éƒ½æ˜¯åªè¯»çš„ï¼Œå…¶å®è¿™æ ·é£é™©æŒºå¤§çš„ã€‚å¦‚æœæ˜¯åœ¨ä¸»åº“å¤‡ä»½ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ä¸èƒ½ä¿®æ”¹æ•°æ®ï¼›è€Œå¦‚æœæ˜¯åœ¨ä»åº“å¤‡ä»½ï¼Œå°±ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚</p><p>å¥½åœ¨ mysqldump åŒ…å«ä¸€ä¸ªå‚æ•° â€”single-transactionï¼Œå¯ä»¥åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­åˆ›å»ºä¸€è‡´æ€§å¿«ç…§ï¼Œç„¶åè¿›è¡Œæ‰€æœ‰è¡¨çš„å¤‡ä»½ã€‚å› æ­¤å¢åŠ è¿™ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œå¤‡ä»½æœŸé—´å¯ä»¥è¿›è¡Œæ•°æ®ä¿®æ”¹ã€‚ä½†æ˜¯éœ€è¦æ‰€æœ‰è¡¨éƒ½æ˜¯äº‹åŠ¡å¼•æ“è¡¨ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯å»ºè®®ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“çš„åŸå› ä¹‹ä¸€ã€‚</p><p>è€Œå¯¹äº xtrabackupï¼Œå¯ä»¥åˆ†å¼€å¤‡ä»½ InnoDB å’Œ MyISAMï¼Œæˆ–è€…ä¸æ‰§è¡Œ â€”master-dataï¼Œå¯ä»¥é¿å…ä½¿ç”¨å…¨å±€é”ã€‚</p><h3 id="2-è¡¨çº§é”"><a href="#2-è¡¨çº§é”" class="headerlink" title="2 è¡¨çº§é”"></a>2 è¡¨çº§é”</h3><p>è¡¨çº§é”æœ‰ä¸¤ç§ï¼šè¡¨é”å’Œå…ƒæ•°æ®é”ã€‚</p><h4 id="2-1-è¡¨é”"><a href="#2-1-è¡¨é”" class="headerlink" title="2.1 è¡¨é”"></a>2.1 è¡¨é”</h4><p>è¡¨é”ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li>äº‹åŠ¡éœ€è¦æ›´æ–°æŸå¼ å¤§è¡¨çš„å¤§éƒ¨åˆ†æˆ–å…¨éƒ¨æ•°æ®ã€‚å¦‚æœä½¿ç”¨é»˜è®¤çš„è¡Œé”ï¼Œä¸ä»…äº‹åŠ¡æ‰§è¡Œæ•ˆç‡ä½ï¼Œè€Œä¸”å¯èƒ½é€ æˆå…¶å®ƒäº‹åŠ¡é•¿æ—¶é—´é”ç­‰å¾…å’Œé”å†²çªï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨è¡¨é”æ¥æé«˜äº‹åŠ¡æ‰§è¡Œé€Ÿåº¦ï¼›</li><li>äº‹åŠ¡æ¶‰åŠå¤šä¸ªè¡¨ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¼šå¼•èµ·æ­»é”ï¼Œå¯¼è‡´å¤§é‡äº‹åŠ¡å›æ»šï¼Œå¯ä»¥è€ƒè™‘è¡¨é”é¿å…æ­»é”ã€‚</li></ol><p>å…¶ä¸­è¡¨é”åˆåˆ†ä¸ºè¡¨è¯»é”å’Œè¡¨å†™é”ï¼Œå‘½ä»¤åˆ†åˆ«æ˜¯ï¼š</p><p>è¡¨è¯»é”ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">lock</span> <span class="token keyword">tables</span> t14 <span class="token keyword">read</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¡¨å†™é”ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">lock</span> <span class="token keyword">tables</span> t14  <span class="token keyword">write</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ç”¨å®éªŒéªŒè¯è¡¨è¯»é”å’Œè¡¨å†™é”ã€‚</p><p>è¡¨è¯»é”å®éªŒï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th></tr></thead><tbody><tr><td style="text-align:left">lock tables t14 read; <br>Query OK, 0 rows affected (0.00 sec)</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">select id,a,b from t14 limit 1; <br>â€¦ <br>1 row in set (0.00 sec) <br> <strong>ï¼ˆèƒ½æ­£å¸¸è¿”å›ç»“æœï¼‰</strong></td><td style="text-align:left">select id,a,b from t14 limit 1; <br>â€¦ <br>1 row in set (0.00 sec) <br> <strong>ï¼ˆèƒ½æ­£å¸¸è¿”å›ç»“æœï¼‰</strong></td></tr><tr><td style="text-align:left">insert into t14(a,b) values(3,3); <br>ERROR 1099 (HY000): Table â€˜t14â€™ was locked with a READ lock and canâ€™t be updated <br> <strong>ï¼ˆæŠ¥é”™ï¼‰</strong></td><td style="text-align:left">insert into t14(a,b) values(3,3);/<em> sql2 </em>/ <br> <strong>ï¼ˆç­‰å¾…ï¼‰</strong></td></tr><tr><td style="text-align:left">unlock tables; <br>Query OK, 0 rows affected (0.00 sec)</td><td style="text-align:left">insert into t14(a,b) values(3,3);/<em> sql2 </em>/ <br>Query OK, 1 row affected (10.97 sec) <br> <strong>ï¼ˆsession1 è§£é”åï¼Œsql2 ç«‹é©¬å†™å…¥æˆåŠŸï¼‰</strong></td></tr></tbody></table></div><p>ä»ä¸Šé¢çš„å®éªŒæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨ session1 ä¸­å¯¹è¡¨ t14 åŠ è¡¨è¯»é”ï¼Œsession1 å’Œ session2 éƒ½å¯ä»¥æŸ¥è¯¢è¡¨ t14 çš„æ•°æ®ï¼›è€Œ session1 æ‰§è¡Œæ›´æ–°ä¼šæŠ¥é”™ï¼Œsession2 æ‰§è¡Œæ›´æ–°ä¼šç­‰å¾…ï¼ˆç›´åˆ° session1 è§£é”åæ‰æ›´æ–°æˆåŠŸï¼‰ã€‚</p><p>æ€»ç»“ï¼š<strong>å¯¹è¡¨æ‰§è¡Œ lock tables xxx read ï¼ˆè¡¨è¯»é”ï¼‰æ—¶ï¼Œæœ¬çº¿ç¨‹å’Œå…¶å®ƒçº¿ç¨‹å¯ä»¥è¯»ï¼Œæœ¬çº¿ç¨‹å†™ä¼šæŠ¥é”™ï¼Œå…¶å®ƒçº¿ç¨‹å†™ä¼šç­‰å¾…ã€‚</strong></p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹è¡¨å†™é”å®éªŒï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th></tr></thead><tbody><tr><td style="text-align:left">lock tables t14 write; <br>Query OK, 0 rows affected (0.00 sec)</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">select id,a,b from t14 limit 1; <br>â€¦ <br>1 row in set (0.00 sec) <br> <strong>ï¼ˆèƒ½æ­£å¸¸è¿”å›ç»“æœï¼‰</strong></td><td style="text-align:left">select id,a,b from t14 limit 1;/<em> sql3 </em>/ <br> <strong>ï¼ˆç­‰å¾…ï¼‰</strong></td></tr><tr><td style="text-align:left">unlock tables; <br>Query OK, 0 rows affected (0.01 sec)</td><td style="text-align:left">select id,a,b from t14 limit 1;/<em> sql3 </em>/ <br>â€¦ <br>1 row in set (7.16 sec) <br> <strong>ï¼ˆsession1 è§£é”åï¼Œsql3 é©¬ä¸Šè¿”å›æŸ¥è¯¢ç»“æœï¼‰</strong></td></tr><tr><td style="text-align:left">lock tables t14 write; <br>Query OK, 0 rows affected (0.00 sec)</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">delete from t14 limit 1; <br>Query OK, 1 row affected, 1 warning (0.00 sec) <br> <strong>ï¼ˆèƒ½æ­£å¸¸æ‰§è¡Œåˆ é™¤è¯­å¥ï¼‰</strong></td><td style="text-align:left">delete from t14 limit 1;/<em> sql4 </em>/ <br> <strong>ï¼ˆç­‰å¾…ï¼‰</strong></td></tr><tr><td style="text-align:left">unlock tables; <br>Query OK, 0 rows affected (0.00 sec)</td><td style="text-align:left">delete from t14 limit 1;/<em> sql4 </em>/ <br>Query OK, 1 row affected, 1 warning (14.94 sec) <br> <strong>ï¼ˆsession1 è§£é”åï¼Œsql4 ç«‹é©¬æ‰§è¡ŒæˆåŠŸï¼‰</strong></td></tr></tbody></table></div><p>æ€»ç»“ï¼š<strong>å¯¹è¡¨æ‰§è¡Œ lock tables xxx write ï¼ˆè¡¨å†™é”ï¼‰æ—¶ï¼Œæœ¬çº¿ç¨‹å¯ä»¥è¯»å†™ï¼Œå…¶å®ƒçº¿ç¨‹è¯»å†™éƒ½ä¼šé˜»å¡ã€‚</strong></p><h4 id="2-2-å…ƒæ•°æ®é”"><a href="#2-2-å…ƒæ•°æ®é”" class="headerlink" title="2.2 å…ƒæ•°æ®é”"></a>2.2 å…ƒæ•°æ®é”</h4><p>åœ¨ MySQL ä¸­ï¼ŒDDL æ˜¯ä¸å±äºäº‹åŠ¡èŒƒç•´çš„ã€‚å¦‚æœäº‹åŠ¡å’Œ DDL å¹¶è¡Œæ‰§è¡ŒåŒä¸€å¼ è¡¨æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°äº‹åŠ¡ç‰¹æ€§è¢«ç ´åã€binlog é¡ºåºé”™ä¹±ç­‰ bugï¼ˆæ¯”å¦‚ <a href="https://bugs.mysql.com/bug.php?id=989">bug#989</a>ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜ï¼Œä» MySQL 5.5.3 å¼€å§‹ï¼Œå¼•å…¥äº†å…ƒæ•°æ®é”ï¼ˆMetadata Lockingï¼Œç®€ç§°ï¼šMDL é”ï¼‰ï¼ˆè¿™æ®µå†…å®¹å‚è€ƒã€Šæ·˜å®æ•°æ®åº“å†…æ ¸æœˆæŠ¥ã€‹<a href="http://mysql.taobao.org/monthly/2015/11/04/">MySQL Â· ç‰¹æ€§åˆ†æ Â· MDL å®ç°åˆ†æ</a>ï¼‰ã€‚</p><p>ä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“ï¼ŒMDL é”çš„å‡ºç°è§£å†³äº†åŒä¸€å¼ è¡¨ä¸Šäº‹åŠ¡å’Œ DDL å¹¶è¡Œæ‰§è¡Œæ—¶å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨å·¥ä½œä¸­ï¼Œå¾ˆå¤šæƒ…å†µéœ€è¦è€ƒè™‘ MDL çš„å­˜åœ¨ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´é•¿æ—¶é—´é”ç­‰å¾…ç”šè‡³è¿æ¥è¢«æ‰“æ»¡çš„æƒ…å†µã€‚å¦‚ä¸‹ä¾‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th><th style="text-align:left">session3</th></tr></thead><tbody><tr><td style="text-align:left">select id,a,b,sleep(100) from t14 limit 1;/<em> sql5 </em>/</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">alter table t14 add column c int;/<em> sql6 </em>/ <br> <strong>ï¼ˆç­‰å¾…ï¼‰</strong></td><td style="text-align:left">select id,a,b from t14 limit 1;/<em> sql7 </em>/ <br> <strong>ï¼ˆç­‰å¾…ï¼‰</strong></td></tr><tr><td style="text-align:left">select id,a,b,sleep(100) from t14 limit 1;/<em> sql5 </em>/ <br>â€¦ <br>1 row in set (1 min 40.00 sec) <br> <strong>ï¼ˆ100ç§’å sql5 è¿”å›ç»“æœï¼‰</strong></td><td style="text-align:left">alter table t14 add column c int;/<em> sql6 </em>/ <br>Query OK, 0 rows affected (1 min 33.98 sec) Records: 0 Duplicates: 0 Warnings: 0 <br> <strong>ï¼ˆsession1 çš„æŸ¥è¯¢è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œsql6 ç«‹é©¬æ‰§è¡Œå®Œæ¯•ï¼‰</strong></td><td style="text-align:left">select id,a,b from t14 limit 1;/<em> sql7 </em>/ <br>â€¦ <br>1 row in set (1 min 26.65 sec) <br> <strong>ï¼ˆsession1 çš„æŸ¥è¯¢è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œsql7 ç«‹é©¬æ‰§è¡Œå®Œæ¯•ï¼‰</strong></td></tr></tbody></table></div><p>ä¸Šé¢çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬åœ¨ session1 æŸ¥è¯¢äº†è¡¨ t14 çš„æ•°æ®ï¼Œå…¶ä¸­ä½¿ç”¨äº† sleep(100) ï¼Œè¡¨ç¤ºåœ¨ 100 ç§’åæ‰ä¼šè¿”å›ç»“æœï¼›ç„¶ååœ¨ session2 æ‰§è¡Œ DDL æ“ä½œæ—¶ä¼šç­‰å¾…ï¼ˆåŸå› æ˜¯ session1 æ‰§è¡ŒæœŸé—´ä¼šå¯¹è¡¨ t14 åŠ ä¸€ä¸ª MDLï¼Œè€Œ session2 åˆä¼šè·Ÿ session1 äº‰æŠ¢ MDLï¼‰ï¼›è€Œ session3 æ‰§è¡ŒæŸ¥è¯¢æ—¶ä¹Ÿä¼šç»§ç»­ç­‰å¾…ã€‚å› æ­¤å¦‚æœ session1 çš„è¯­å¥ä¸€ç›´æ²¡ç»“æŸï¼Œå…¶å®ƒæ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä¼šç­‰å¾…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè¿™å¼ è¡¨æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹ï¼Œå¾ˆå¯èƒ½çŸ­æ—¶é—´æŠŠæ•°æ®åº“çš„è¿æ¥æ•°æ‰“æ»¡ï¼Œå¯¼è‡´æ–°çš„è¿æ¥æ— æ³•å»ºç«‹è€ŒæŠ¥é”™ï¼Œå¦‚æœæ˜¯æ­£å¼ä¸šåŠ¡ï¼Œå½±å“æ˜¯éå¸¸ææ€–çš„ã€‚</p><p>å½“ç„¶å¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œå‡å¦‚ä½ è¿˜æœ‰ session è¿ç€æ•°æ®åº“ï¼Œå¯ä»¥ kill æ‰ session1 ä¸­çš„è¯­å¥æˆ–è€…ç»ˆæ­¢ session2 ä¸­çš„ DDL æ“ä½œï¼Œå¯ä»¥è®©ä¸šåŠ¡æ¢å¤ã€‚ä½†æ˜¯å‡ºç°è¿™ç§æƒ…å†µçš„æ ¹æºå…¶å®æ˜¯ï¼šsession1 ä¸­æœ‰é•¿æ—¶é—´æœªæäº¤çš„äº‹åŠ¡ã€‚<strong>å› æ­¤å¯¹äºå¼€å‘æ¥è¯´ï¼Œåœ¨å·¥ä½œä¸­åº”è¯¥å°½é‡é¿å…æ…¢æŸ¥è¯¢ã€å°½é‡ä¿è¯äº‹åŠ¡åŠæ—¶æäº¤ã€é¿å…å¤§äº‹åŠ¡ç­‰ï¼Œå½“ç„¶å¯¹äº DBA æ¥è¯´ï¼Œä¹Ÿåº”è¯¥å°½é‡é¿å…åœ¨ä¸šåŠ¡é«˜å³°æ‰§è¡Œ DDL æ“ä½œã€‚</strong></p><h2 id="16-è¡Œé”ï¼šInnoDBæ›¿ä»£MyISAMçš„é‡è¦åŸå› "><a href="#16-è¡Œé”ï¼šInnoDBæ›¿ä»£MyISAMçš„é‡è¦åŸå› " class="headerlink" title="16 è¡Œé”ï¼šInnoDBæ›¿ä»£MyISAMçš„é‡è¦åŸå› "></a><strong>16 è¡Œé”ï¼šInnoDBæ›¿ä»£MyISAMçš„é‡è¦åŸå› </strong></h2><p>MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“æ˜¯ MyISAMï¼Œ5.5 ä¹‹åæ”¹æˆäº† InnoDBã€‚InnoDB åæ¥å±…ä¸Šæœ€ä¸»è¦çš„åŸå› å°±æ˜¯ï¼š</p><ul><li>InnoDB æ”¯æŒäº‹åŠ¡ï¼šé€‚åˆåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®ä¸€è‡´çš„åœºæ™¯ã€‚</li><li>InnoDB æ”¯æŒè¡Œé”ï¼šæœ‰æ•ˆé™ä½ç”±äºåˆ é™¤æˆ–è€…æ›´æ–°å¯¼è‡´çš„é”å®šã€‚</li></ul><p>åœ¨è®²è§£è¡Œé”ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ä¸¤é˜¶æ®µé”åè®®ã€‚</p><h3 id="1-ä¸¤é˜¶æ®µé”"><a href="#1-ä¸¤é˜¶æ®µé”" class="headerlink" title="1 ä¸¤é˜¶æ®µé”"></a>1 ä¸¤é˜¶æ®µé”</h3><p>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“åŠ é”çš„ä¸€ä¸ªåŸåˆ™æ˜¯ï¼šä¸¤é˜¶æ®µé”åŸåˆ™ã€‚</p><p>ä¸¤é˜¶æ®µé”ï¼šé”æ“ä½œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼ŒåŠ é”é˜¶æ®µå’Œè§£é”é˜¶æ®µï¼Œå¹¶ä¸”ä¿è¯åŠ é”é˜¶æ®µå’Œè§£é”é˜¶æ®µä¸ç›¸äº¤ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ è¡¨ç†è§£ä¸¤é˜¶æ®µé”ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">åºå·</th><th style="text-align:left">MySQL æ“ä½œ</th><th style="text-align:left">è§£é‡Š</th><th style="text-align:left">é”é˜¶æ®µ</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">begin;</td><td style="text-align:left">äº‹åŠ¡å¼€å§‹</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">insert into â€¦;</td><td style="text-align:left">åŠ  insert å¯¹åº”çš„é”</td><td style="text-align:left">åŠ é”é˜¶æ®µ</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left">update table â€¦;</td><td style="text-align:left">åŠ  update å¯¹åº”çš„é”</td><td style="text-align:left">åŠ é”é˜¶æ®µ</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left">delete from â€¦;</td><td style="text-align:left">åŠ  delete å¯¹åº”çš„é”</td><td style="text-align:left">åŠ é”é˜¶æ®µ</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left">commit;</td><td style="text-align:left">äº‹åŠ¡ç»“æŸï¼ŒåŒæ—¶é‡Šæ”¾ 2ã€3ã€4 æ­¥éª¤ä¸­åŠ çš„é”</td><td style="text-align:left">è§£é”é˜¶æ®µ</td></tr></tbody></table></div><h3 id="2-InnoDB-è¡Œé”æ¨¡å¼"><a href="#2-InnoDB-è¡Œé”æ¨¡å¼" class="headerlink" title="2 InnoDB è¡Œé”æ¨¡å¼"></a>2 InnoDB è¡Œé”æ¨¡å¼</h3><p>InnoDB å®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ï¼š</p><ul><li>å…±äº«é”ï¼ˆSï¼‰ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œé˜»æ­¢å…¶å®ƒäº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’ä»–é”ï¼›</li><li>æ’ä»–é”ï¼ˆXï¼‰ï¼šå…è®¸è·å¾—æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶å®ƒäº‹åŠ¡å–å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«è¯»é”å’Œæ’ä»–å†™é”ã€‚</li></ul><p>å¯¹äºæ™®é€š select è¯­å¥ï¼ŒInnoDB ä¸ä¼šåŠ ä»»ä½•é”ï¼Œäº‹åŠ¡å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾å¼ç»™è®°å½•é›†åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼š</p><ul><li>å…±äº«é”ï¼ˆSï¼‰ï¼šselect * from table_name where â€¦ lock in share mode;</li><li>æ’ä»–é”ï¼ˆXï¼‰ï¼šselect * from table_name where â€¦ for updateã€‚</li></ul><h3 id="3-InnoDB-è¡Œé”ç®—æ³•"><a href="#3-InnoDB-è¡Œé”ç®—æ³•" class="headerlink" title="3 InnoDB è¡Œé”ç®—æ³•"></a>3 InnoDB è¡Œé”ç®—æ³•</h3><p>InnoDB è¡Œé”çš„ä¸‰ç§ç®—æ³•ï¼š</p><ul><li>Record Lockï¼šå•ä¸ªè®°å½•ä¸Šçš„ç´¢å¼•åŠ é”ã€‚</li><li>Gap Lockï¼šé—´éš™é”ï¼Œå¯¹ç´¢å¼•é¡¹ä¹‹é—´çš„é—´éš™åŠ é”ï¼Œä½†ä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚</li><li>Next-Key Lockï¼šGap Lock + Record Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</li></ul><p>InnoDB è¡Œé”å®ç°ç‰¹ç‚¹æ„å‘³ç€ï¼šå¦‚æœä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œé‚£ä¹ˆ InnoDB å°†å¯¹è¡¨ä¸­æ‰€æœ‰è®°å½•åŠ é”ï¼Œå®é™…æ•ˆæœè·Ÿè¡¨é”ä¸€æ ·ã€‚</p><h3 id="4-äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#4-äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="4 äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>4 äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p>ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹åº”çš„è¡Œé”ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤åœ¨è®²è§£è¡Œé”çš„é”å®šèŒƒå›´ä¹‹å‰ï¼Œå…ˆç®€å•èŠèŠäº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚äº‹åŠ¡éš”ç¦»çº§åˆ«çš„è¯¦ç»†ä»‹ç»æ”¾åœ¨ä¸‹ä¸€ç« ã€‚</p><p>MySQL çš„ 4 ç§éš”ç¦»çº§åˆ«ï¼š</p><ul><li>Read uncommittedï¼ˆè¯»æœªæäº¤ï¼‰: åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶å®ƒæœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚å¯èƒ½ä¼šå‡ºç°è„è¯»ã€‚</li><li>Read Committedï¼ˆè¯»å·²æäº¤ï¼Œç®€ç§°ï¼š RCï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚å› ä¸ºåŒä¸€äº‹åŠ¡çš„å…¶å®ƒå®ä¾‹åœ¨è¯¥å®ä¾‹å¤„ç†æœŸé—´å¯èƒ½ä¼šæœ‰æ–°çš„ commitï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°å¹»è¯»ã€‚</li><li>Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼Œç®€ç§°ï¼šRRï¼‰ï¼šè¿™æ˜¯ MySQL çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚æ¶ˆé™¤äº†è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œé»˜è®¤ä¹Ÿä¸ä¼šå‡ºç°å¹»è¯»ã€‚</li><li>Serializableï¼ˆä¸²è¡Œï¼‰ï¼šè¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ã€‚</li></ul><blockquote><ul><li>è„è¯»ï¼šè¯»å–æœªæäº¤çš„äº‹åŠ¡ã€‚</li><li>å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡æŒ‰ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶é‡æ–°è¯»å–ä»¥å‰æ£€ç´¢è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ»¡è¶³å…¶æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ã€‚</li></ul></blockquote><h3 id="5-RC-éš”ç¦»çº§åˆ«ä¸‹çš„è¡Œé”å®éªŒ"><a href="#5-RC-éš”ç¦»çº§åˆ«ä¸‹çš„è¡Œé”å®éªŒ" class="headerlink" title="5 RC éš”ç¦»çº§åˆ«ä¸‹çš„è¡Œé”å®éªŒ"></a>5 RC éš”ç¦»çº§åˆ«ä¸‹çš„è¡Œé”å®éªŒ</h3><p>æœ‰æ—¶æˆ‘ä»¬å¯èƒ½ä¼šæ€è€ƒï¼ŒæŸæ¡è¯­å¥ï¼ˆç±»ä¼¼ select * from table_name where a=â€¦ for update;ï¼‰æ˜¯æ€ä¹ˆåŠ é”çš„ï¼Ÿ</p><p>è¦æƒ³åˆ†ææŸæ¡ SQL æ˜¯æ€ä¹ˆåŠ é”çš„ï¼Œå¦‚æœå…¶ä»–ä¿¡æ¯éƒ½ä¸çŸ¥é“ï¼Œé‚£å°±å¾—åˆ†å‡ ç§æƒ…å†µäº†ï¼Œä¸åŒæƒ…å†µåŠ é”çš„æ–¹å¼ä¹Ÿå„ä¸ä¸€æ ·ï¼Œæ¯”è¾ƒå¸¸è§çš„ä¸€äº›æƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li>RC éš”ç¦»çº§åˆ«ï¼Œa å­—æ®µæ²¡ç´¢å¼•ã€‚</li><li>RC éš”ç¦»çº§åˆ«ï¼Œa å­—æ®µæœ‰å”¯ä¸€ç´¢å¼•ã€‚</li><li>RC éš”ç¦»çº§åˆ«ï¼Œa å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•ã€‚</li><li>RR éš”ç¦»çº§åˆ«ï¼Œa å­—æ®µæ²¡ç´¢å¼•ã€‚</li><li>RR éš”ç¦»çº§åˆ«ï¼Œa å­—æ®µæœ‰å”¯ä¸€ç´¢å¼•ã€‚</li><li>RR éš”ç¦»çº§åˆ«ï¼Œa å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•ã€‚</li></ul><blockquote><p>Read uncommitted å’Œ Serializable è¿™ä¸¤ç§éš”ç¦»çº§åˆ«åœ¨ç”Ÿäº§ç¯å¢ƒåŸºæœ¬ä¸ç”¨ï¼Œå°±ä¸åšåˆ†æäº†ã€‚</p></blockquote><p>æˆ‘ä»¬å…ˆéªŒè¯ RC éš”ç¦»çº§åˆ«ä¸‹çš„å‡ ç§æƒ…å†µï¼ŒRR éš”ç¦»çº§åˆ«çš„å®éªŒæ”¾åœ¨ä¸‹èŠ‚ï¼š</p><p>é¦–å…ˆåˆ›å»ºæµ‹è¯•è¡¨åŠå†™å…¥æ•°æ®:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t16<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t16<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uniq_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t16<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®©æˆ‘ä»¬å¼€å§‹å®éªŒå§ï¼</p><h4 id="5-1-é€šè¿‡éç´¢å¼•å­—æ®µæŸ¥è¯¢"><a href="#5-1-é€šè¿‡éç´¢å¼•å­—æ®µæŸ¥è¯¢" class="headerlink" title="5.1 é€šè¿‡éç´¢å¼•å­—æ®µæŸ¥è¯¢"></a>5.1 é€šè¿‡éç´¢å¼•å­—æ®µæŸ¥è¯¢</h4><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹æ¡ä»¶å­—æ®µä¸ä½¿ç”¨ç´¢å¼•çš„ä¾‹å­ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th></tr></thead><tbody><tr><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td></tr><tr><td style="text-align:left">begin;</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">use muke; <br>select * from t16 where b=1 for update; <br>â€¦ <br>1 row in set (0.00 sec)</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">use muke; <br>select <em> from t16 where b=2 for update; <br> <em>*ï¼ˆç­‰å¾…ï¼‰</em></em></td></tr><tr><td style="text-align:left">commit;</td><td style="text-align:left">select <em> from t16 where b=2 for update; <br>â€¦ <br>1 row in set (6.81 sec) <br> <em>*ï¼ˆsession1 æ‰§è¡Œ commit åç«‹é©¬è¿”å›ç»“æœï¼‰</em></em></td></tr></tbody></table></div><blockquote><p><strong>è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ for updateï¼Ÿ</strong></p><p>æˆ‘ä»¬å¸¸ä½¿ç”¨çš„æŸ¥è¯¢è¯­å¥ï¼Œæ¯”å¦‚ select * from t16 where b=1 å±äºå¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚</p><p>è€Œåœ¨æŸ¥è¯¢è¯­å¥åé¢åŠ äº† for update æ˜¾å¼ç»™è®°å½•é›†åŠ äº†æ’ä»–é”ï¼Œä¹Ÿå°±è®©æŸ¥è¯¢å˜æˆäº†å½“å‰è¯»ã€‚æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œéƒ½å±äºå½“å‰è¯»ã€‚å…¶å®ä¹Ÿå°±å¯ä»¥ç†è§£ select â€¦ for update æ˜¯ä¸ºäº†è®©æ™®é€šæŸ¥è¯¢è·å¾—æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œæ—¶æ‰€è·å¾—çš„é”ã€‚</p></blockquote><p>è¡¨é¢çœ‹èµ·æ¥ session1 åªç»™äº† b=1 è¿™ä¸€è¡ŒåŠ äº†æ’ä»–é”ï¼Œä½† session2 åœ¨è¯·æ±‚å…¶å®ƒè¡Œçš„æ’ä»–é”æ—¶ï¼Œå´å‡ºç°äº†é”ç­‰å¾…ã€‚çœ‹ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæ— ç´¢å¼•.png" alt="RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæ— ç´¢å¼•"></p><p>ç”±äº b å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œå› æ­¤åªèƒ½èµ°èšç°‡ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³æ¡ä»¶çš„è®°å½•æœ‰ä¸€æ¡ï¼Œä½†æ˜¯èšç°‡ç´¢å¼•ä¸Šçš„æ‰€æœ‰è®°å½•ï¼Œéƒ½è¢«åŠ ä¸Šäº† X é”ã€‚</p><p>ä¸ºä»€ä¹ˆä¸æ˜¯åªåœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•ä¸ŠåŠ é”å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºåœ¨ MySQL ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ¡ä»¶æ— æ³•é€šè¿‡ç´¢å¼•å¿«é€Ÿè¿‡æ»¤ï¼Œé‚£ä¹ˆå­˜å‚¨å¼•æ“å±‚é¢å°±ä¼šå°†æ‰€æœ‰è®°å½•åŠ é”åè¿”å›ï¼Œç„¶åç”± server å±‚è¿›è¡Œè¿‡æ»¤ã€‚å› æ­¤ä¹Ÿå°±æŠŠæ‰€æœ‰è®°å½•éƒ½é”ä¸Šäº†ã€‚</p><blockquote><p>å½“ç„¶ MySQL åœ¨è¿™é‡Œæœ‰ä¸€äº›æ”¹è¿›çš„ï¼Œåœ¨ server å±‚è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„æ•°æ®åï¼Œä¼šæŠŠä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•æ”¾é”ã€‚ä¿è¯äº†æœ€ååªä¼šæŒæœ‰æ»¡è¶³æ¡ä»¶çš„é”ï¼Œä½†æ˜¯æ¯æ¡è®°å½•çš„åŠ é”æ“ä½œè¿˜æ˜¯ä¸ä¼šçœç•¥ã€‚</p></blockquote><p>æ€»ç»“ï¼š<strong>æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼ŒInnoDB çš„å½“å‰è¯»ä¼šå¯¹æ‰€æœ‰è®°å½•éƒ½åŠ é”ã€‚æ‰€ä»¥åœ¨å·¥ä½œä¸­åº”è¯¥ç‰¹åˆ«æ³¨æ„ InnoDB è¿™ä¸€ç‰¹æ€§ï¼Œå¦åˆ™å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„é”å†²çªã€‚</strong></p><h4 id="5-2-é€šè¿‡å”¯ä¸€ç´¢å¼•æŸ¥è¯¢"><a href="#5-2-é€šè¿‡å”¯ä¸€ç´¢å¼•æŸ¥è¯¢" class="headerlink" title="5.2 é€šè¿‡å”¯ä¸€ç´¢å¼•æŸ¥è¯¢"></a>5.2 é€šè¿‡å”¯ä¸€ç´¢å¼•æŸ¥è¯¢</h4><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ¡ä»¶å­—æ®µæœ‰å”¯ä¸€ç´¢å¼•çš„ä¾‹å­ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th></tr></thead><tbody><tr><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC </em>/</td></tr><tr><td style="text-align:left">begin; <br>use muke; <br>select * from t16 where a=1 for update; <br>â€¦ <br>1 row in set (0.00 sec)</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">use muke; <br>select * from t16 where a=2 for update; <br>â€¦ <br>1 row in set (0.00 sec)</td></tr><tr><td style="text-align:left"></td><td style="text-align:left">select <em> from t16 where a=1 for update; <br> <em>*ï¼ˆç­‰å¾…ï¼‰</em></em></td></tr><tr><td style="text-align:left">commit;</td><td style="text-align:left">select <em> from t16 where a=1 for update; <br>â€¦ <br>1 row in set (4.70 sec) <br> <em>*ï¼ˆsession1 æäº¤åï¼Œé©¬ä¸Šè¿”å›ç»“æœï¼‰</em></em></td></tr></tbody></table></div><p>session1 ç»™äº† a=1 è¿™ä¸€è¡ŒåŠ äº†æ’ä»–é”ï¼Œåœ¨ session2 ä¸­è¯·æ±‚å…¶ä»–è¡Œçš„æ’ä»–é”æ—¶ï¼Œä¸ä¼šå‘ç”Ÿç­‰å¾…ï¼›ä½†æ˜¯åœ¨ session2 ä¸­è¯·æ±‚ a=1 è¿™ä¸€è¡Œçš„æ’ä»–é”æ—¶ï¼Œä¼šå‘ç”Ÿç­‰å¾…ã€‚çœ‹ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰å”¯ä¸€ç´¢å¼•.png" alt="RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰å”¯ä¸€ç´¢å¼•"></p><p>ç”±äº a æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå› æ­¤ select * from t16 where a=1 for updateï¼›(åé¢ç§°ä¸º SQL2) è¯­å¥ä¼šé€‰æ‹©èµ° a åˆ—çš„ç´¢å¼•è¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼Œåœ¨æ‰¾åˆ° a=1 çš„è®°å½•åï¼Œä¼šå°†å”¯ä¸€ç´¢å¼•ä¸Š a=1 ç´¢å¼•è®°å½•ä¸ŠåŠ  X é”ï¼ŒåŒæ—¶ï¼Œä¼šæ ¹æ®è¯»å–åˆ°çš„ id åˆ—ï¼Œå›åˆ°èšç°‡ç´¢å¼•ï¼Œç„¶åå°† id=1 å¯¹åº”çš„èšç°‡ç´¢å¼•é¡¹åŠ  X é”ã€‚</p><p>ä¸ºä»€ä¹ˆèšç°‡ç´¢å¼•ä¸Šçš„è®°å½•ä¹Ÿè¦åŠ é”å‘¢ï¼Ÿ</p><p>æ¯”å¦‚ï¼Œå¹¶å‘çš„ä¸€æ¡ SQLï¼Œæ˜¯é€šè¿‡ä¸»é”®ç´¢å¼•æ¥æ›´æ–°ï¼šupdate t16 set b=10 where id =1; å¦‚æœ SQL2 æ²¡æœ‰å°†ä¸»é”®ç´¢å¼•ä¸Šçš„è®°å½•åŠ é”ï¼Œé‚£ä¹ˆå¹¶å‘çš„ update å¹¶ä¸çŸ¥é“ SQL2 åœ¨æ‰§è¡Œï¼Œæ‰€ä»¥å¦‚æœ update æ‰§è¡Œäº†ï¼Œå°±è¿èƒŒäº†åŒä¸€è®°å½•ä¸Šçš„æ›´æ–°æˆ–è€…åˆ é™¤éœ€è¦ä¸²è¡Œæ‰§è¡Œçš„çº¦æŸã€‚</p><p>æ€»ç»“ï¼š<strong>å¦‚æœæŸ¥è¯¢çš„æ¡ä»¶æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆ SQL éœ€è¦åœ¨æ»¡è¶³æ¡ä»¶çš„å”¯ä¸€ç´¢å¼•ä¸ŠåŠ é”ï¼Œå¹¶ä¸”ä¼šåœ¨å¯¹åº”çš„èšç°‡ç´¢å¼•ä¸ŠåŠ é”ã€‚</strong></p><h4 id="5-3-é€šè¿‡éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢"><a href="#5-3-é€šè¿‡éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢" class="headerlink" title="5.3 é€šè¿‡éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢"></a>5.3 é€šè¿‡éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢</h4><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ¡ä»¶å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•çš„ä¾‹å­ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th><th style="text-align:left">session3</th></tr></thead><tbody><tr><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td></tr><tr><td style="text-align:left">begin;</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">use muke; <br>select * from t16 where c=3 for update; <br>â€¦ <br>2 rows in set (0.00 sec)</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">use muke; <br>select * from t16 where a=1 for update; <br>â€¦ <br>1 row in set (0.00 sec)</td><td style="text-align:left">use muke; select * from t16 where a=2 for update; <br>â€¦ <br>1 row in set (0.00 sec)</td></tr><tr><td style="text-align:left"></td><td style="text-align:left">select <em> from t16 where a=3 for update; <br> <em>*(ç­‰å¾…)</em></em></td><td style="text-align:left">select <em> from t16 where a=4 for update; <br> <em>*(ç­‰å¾…)</em></em></td></tr><tr><td style="text-align:left">commit;</td><td style="text-align:left">select <em> from t16 where a=3 for update; <br>â€¦ <br> <em>*(session1 æäº¤åï¼Œé©¬ä¸Šè¿”å›ç»“æœ)</em></em></td><td style="text-align:left">select <em> from t16 where a=4 for update; <br>â€¦ <br> <em>*(session1 æäº¤åï¼Œé©¬ä¸Šè¿”å›ç»“æœ)</em></em></td></tr></tbody></table></div><p>æˆ‘ä»¬åœ¨æ»¡è¶³æ¡ä»¶ c=3 çš„æ•°æ®ä¸ŠåŠ äº†æ’ä»–é”ï¼Œå¦‚ä¸Šé¢ç»“æœï¼Œå°±æ˜¯ç¬¬ 3ã€4 è¡Œã€‚å› æ­¤ç¬¬ 1ã€2 è¡Œçš„æ•°æ®æ²¡è¢«é”ï¼Œè€Œ 3ã€4 è¡Œçš„æ•°æ®è¢«é”äº†ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•.png" alt="RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•"></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ a å­—æ®µçš„éå”¯ä¸€ç´¢å¼•ä¸Šï¼Œæ»¡è¶³ c=3 çš„æ‰€æœ‰è®°å½•ï¼Œéƒ½è¢«åŠ äº†é”ã€‚åŒæ—¶ï¼Œå¯¹åº”çš„ä¸»é”®ç´¢å¼•ä¸Šçš„è®°å½•ä¹Ÿéƒ½åŠ ä¸Šäº†é”ã€‚ä¸é€šè¿‡å”¯ä¸€ç´¢å¼•æŸ¥è¯¢çš„æƒ…å†µç›¸æ¯”ï¼Œå”¯ä¸€ç´¢å¼•æŸ¥è¯¢æœ€å¤šæœ‰ä¸€è¡Œè®°å½•è¢«é”ï¼Œè€Œéå”¯ä¸€ç´¢å¼•å°†ä¼šæŠŠæ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è®°å½•éƒ½åŠ ä¸Šé”ã€‚</p><p>æ€»ç»“ï¼š<strong>å¦‚æœæŸ¥è¯¢çš„æ¡ä»¶æ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆ SQL éœ€è¦åœ¨æ»¡è¶³æ¡ä»¶çš„éå”¯ä¸€ç´¢å¼•ä¸Šéƒ½åŠ ä¸Šé”ï¼Œå¹¶ä¸”ä¼šåœ¨å®ƒä»¬å¯¹åº”çš„èšç°‡ç´¢å¼•ä¸ŠåŠ é”ã€‚</strong></p><h2 id="17-é—´éš™é”çš„æ„ä¹‰"><a href="#17-é—´éš™é”çš„æ„ä¹‰" class="headerlink" title="17 é—´éš™é”çš„æ„ä¹‰"></a><strong>17 é—´éš™é”çš„æ„ä¹‰</strong></h2><h3 id="1-æ­æ™“ä¸Šä¸€èŠ‚è¯¾åé—®é¢˜çš„ç­”æ¡ˆ"><a href="#1-æ­æ™“ä¸Šä¸€èŠ‚è¯¾åé—®é¢˜çš„ç­”æ¡ˆ" class="headerlink" title="1 æ­æ™“ä¸Šä¸€èŠ‚è¯¾åé—®é¢˜çš„ç­”æ¡ˆ"></a>1 æ­æ™“ä¸Šä¸€èŠ‚è¯¾åé—®é¢˜çš„ç­”æ¡ˆ</h3><p>æ‹¿ä¸ŠèŠ‚çš„æµ‹è¯•è¡¨ t16ï¼Œè¿›è¡Œå¦‚ä¸‹å®éªŒï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th></tr></thead><tbody><tr><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td><td style="text-align:left">set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td></tr><tr><td style="text-align:left">begin;</td><td style="text-align:left">begin;</td></tr><tr><td style="text-align:left"></td><td style="text-align:left">use muke; <br>select <em> from t16 where c=3 for update; <br> <em>*Result1</em></em></td></tr><tr><td style="text-align:left">use muke; insert into t16(a,b,c) values (5,5,3);</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">commit;</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">select <em> from t16 where c=3 for update; <br> <em>*Result2</em></em></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">commit;</td></tr></tbody></table></div><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢çš„å®éªŒç»“æœï¼šResult 1 å’Œ Result 2 ç»“æœæ˜¯ä¸åŒçš„ã€‚åœ¨ session2 ä¸­ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒæŒ‰ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶é‡æ–°è¯»å–ä»¥å‰æ£€ç´¢è¿‡çš„æ•°æ®ï¼Œå´å‘ç°äº† session1 æ’å…¥çš„æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸Šä¸€èŠ‚è®²åˆ°çš„å¹»è¯»æƒ…å†µã€‚</p><p>ä¸ºä»€ä¹ˆä¸Šé¢çš„å®éªŒä¸­ä¼šå‡ºç°å¹»è¯»å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•ï¼ˆå¹»è¯»ï¼‰.png" alt="RCéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•ï¼ˆå¹»è¯»ï¼‰"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒRC éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªé”ä½äº†æ»¡è¶³ c=3 çš„å½“å‰è¡Œï¼Œè€Œä¸ä¼šå¯¹åé¢çš„ä½ç½®ï¼ˆæˆ–è€…è¯´é—´éš™ï¼‰åŠ é”ï¼Œå› æ­¤å¯¼è‡´ session1 çš„å†™å…¥è¯­å¥èƒ½æ­£å¸¸æ‰§è¡Œå¹¶æäº¤ã€‚</p><p>é‚£ä¹ˆåº”è¯¥æ€æ ·é™ä½å¹»è¯»å‡ºç°çš„æ¦‚ç‡å‘¢ï¼Ÿ</p><p>ä»ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œäº§ç”Ÿå¹»è¯»çš„åŸå› æ˜¯ï¼šè¡Œé”åªèƒ½é”ä½å½“å‰è¡Œï¼Œä½†æ˜¯æ–°æ’å…¥çš„è®°å½•ï¼Œæ˜¯åœ¨è¢«é”ä½è®°å½•ä¹‹å‰çš„é—´éš™ã€‚å› æ­¤ï¼Œä¸ºäº†é™ä½å¹»è¯»å‡ºç°çš„æ¦‚ç‡ï¼ŒInnoDB åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹é…ç½®äº†é—´éš™é”ï¼ˆGap Lockï¼‰ã€‚</p><h3 id="2-RR-éš”ç¦»çº§åˆ«ä¸‹çš„éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢"><a href="#2-RR-éš”ç¦»çº§åˆ«ä¸‹çš„éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢" class="headerlink" title="2 RR éš”ç¦»çº§åˆ«ä¸‹çš„éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢"></a>2 RR éš”ç¦»çº§åˆ«ä¸‹çš„éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢</h3><p>æˆ‘ä»¬ç»§ç»­çœ‹ä¸Šé¢çš„å®éªŒï¼Œè¿™é‡Œä¸åŒç‚¹æ˜¯æˆ‘ä»¬æŠŠéš”ç¦»çº§åˆ«è®¾ç½®æˆ RRã€‚</p><p>æˆ‘ä»¬å†å•ç‹¬å»ºä¸€å¼ è¡¨ï¼Œè¡¨ç»“æ„ä¸ä¸ŠèŠ‚çš„è¡¨ç»“æ„ä¸€è‡´ï¼Œä¸ºäº†æ–¹ä¾¿åé¢åˆ†æï¼Œæ•°æ®ç¨å¾®æœ‰æ”¹åŠ¨ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t17<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t17<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uniq_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t17<span class="token punctuation">(</span>id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€å§‹RRéš”ç¦»çº§åˆ«ä¸‹çš„å®éªŒï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th></tr></thead><tbody><tr><td style="text-align:left">set session transaction_isolation=â€™REPEATABLE-READâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RR</em>/</td><td style="text-align:left">set session transaction_isolation=â€™REPEATABLE-READâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RR</em>/</td></tr><tr><td style="text-align:left">begin;</td><td style="text-align:left">begin;</td></tr><tr><td style="text-align:left"></td><td style="text-align:left">use muke; <br>select <em> from t17 where c=4 for update; <br> <em>*Result1</em></em></td></tr><tr><td style="text-align:left">use muke; <br>insert into t17(a,b,c) values (7,7,4); /<em> SQL 1 </em>/</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">select <em> from t17 where c=4 for update; <br> <em>*Result2</em></em></td></tr><tr><td style="text-align:left">insert intot17(a,b,c) values (7,7,4); /<em> SQL 1 </em>/<br>Query  OK, 1 row affected (20.73 sec)<br>ï¼ˆç­‰session2 æ‰§è¡Œcommit; åï¼ŒSQL1é©¬ä¸Šè¿”å›ç»“æœï¼‰</td><td style="text-align:left">commit;</td></tr><tr><td style="text-align:left">commit;</td></tr></tbody></table></div><p>æ ¹æ®å®éªŒæƒ…å†µï¼Œæˆ‘ä»¬åœ¨ session2 ä¸­ï¼Œå¯¹æ»¡è¶³æ¡ä»¶ c=4 çš„æ•°æ®åŠ ä¸Šäº†æ’ä»–é”ï¼Œç„¶ååœ¨ session1 å†™å…¥ä¸€æ¡ c=4 çš„è®°å½•ï¼Œæ­¤æ—¶ä¼šå‡ºç°ç­‰å¾…ï¼Œç›´åˆ° session2 å¯¹äº‹åŠ¡è¿›è¡Œæäº¤åï¼Œsession1 æ‰ä¼šæ‰§è¡ŒæˆåŠŸã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/RRéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•.png" alt="RRéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•"></p><p>ä¸ RC éš”ç¦»çº§åˆ«ä¸‹çš„å›¾ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸ªæ¯”è¾ƒå¤§çš„åŒºåˆ«æ˜¯ï¼šRR éš”ç¦»çº§åˆ«å¤šäº† GAP é”ã€‚</p><p>å¦‚ä¸Šå›¾ï¼Œé¦–å…ˆéœ€è¦è€ƒè™‘å“ªäº›ä½ç½®å¯ä»¥æ’å…¥æ–°çš„æ»¡è¶³æ¡ä»¶ c=4 çš„é¡¹ï¼š</p><ul><li>ç”±äº B+ æ ‘ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œå› æ­¤ [2,2]ï¼ˆä»£è¡¨ c å’Œ id çš„å€¼ï¼Œåé¢å°±ä¸ä¸€ä¸€è¯´æ˜äº†ï¼‰å‰é¢çš„è®°å½•ï¼Œä¸å¯èƒ½æ’å…¥ c=4 çš„è®°å½•äº†ï¼›</li><li>[2,2] ä¸ [4,4] ä¹‹é—´å¯ä»¥æ’å…¥ [4,3]ï¼›</li><li>[4,4] ä¸ [4,6] ä¹‹é—´å¯ä»¥æ’å…¥ [4,5]ï¼›</li><li>[4,6] ä¹‹åï¼Œå¯ä»¥æ’å…¥çš„å€¼å°±å¾ˆå¤šäº†ï¼š[4,n] (å…¶ä¸­ n&gt;6) ï¼›</li></ul><p>ä¸ºäº†ä¿è¯è¿™å‡ ä¸ªåŒºé—´ä¸ä¼šæ’å…¥æ–°çš„æ»¡è¶³æ¡ä»¶ c=4 çš„è®°å½•ï¼ŒMySQL RR éš”ç¦»çº§åˆ«é€‰æ‹©äº† GAP é”ï¼Œå°†è¿™å‡ ä¸ªåŒºé—´é”èµ·æ¥ã€‚</p><p>è€Œä¸Šé¢å®éªŒä¸­ï¼Œè¯­å¥ insert into t17 (a,b,c) values (7,7,4) å…¶å¯¹åº”æ’å…¥ c å’Œ id çš„å€¼ä¸º [4,7]ï¼Œæ˜¯åœ¨æœ€åè¿™ä¸ªè¢« GAP Lock é”ä½çš„åŒºé—´ï¼Œå› æ­¤å¦‚ä¸Šé¢å®éªŒï¼Œinsert æ“ä½œä¼šç­‰å¾…ã€‚</p><h3 id="3-RR-éš”ç¦»çº§åˆ«ä¸‹çš„éç´¢å¼•å­—æ®µæŸ¥è¯¢"><a href="#3-RR-éš”ç¦»çº§åˆ«ä¸‹çš„éç´¢å¼•å­—æ®µæŸ¥è¯¢" class="headerlink" title="3 RR éš”ç¦»çº§åˆ«ä¸‹çš„éç´¢å¼•å­—æ®µæŸ¥è¯¢"></a>3 RR éš”ç¦»çº§åˆ«ä¸‹çš„éç´¢å¼•å­—æ®µæŸ¥è¯¢</h3><p>ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æµ‹è¯•äº† RC éš”ç¦»çº§åˆ«ä¸‹ï¼Œéç´¢å¼•å­—æ®µåšæ¡ä»¶çš„å½“å‰è¯»ä¼šå¯¹æ‰€æœ‰è®°å½•éƒ½åŠ é”ã€‚</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ RR éš”ç¦»çº§åˆ«ä¸‹ï¼Œéç´¢å¼•å­—æ®µåšæ¡ä»¶çš„å½“å‰è¯»åŠ é”æƒ…å†µã€‚</p><p>é¦–å…ˆå¯¹ t17 è¡¨ä¸­çš„æ•°æ®åšåˆå§‹åŒ–ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t17<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t17<span class="token punctuation">`</span> <span class="token punctuation">(</span>    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uniq_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t17<span class="token punctuation">(</span>id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="table-container"><table><thead><tr><th style="text-align:left">session1</th><th style="text-align:left">session2</th><th style="text-align:left">session3</th></tr></thead><tbody><tr><td style="text-align:left">set session transaction_isolation=â€™REPEATABLE-READâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RR</em>/</td><td style="text-align:left">set session transaction_isolation=â€™REPEATABLE-READâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RR</em>/</td><td style="text-align:left">set session transaction_isolation=â€™REPEATABLE-READâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RR</em>/</td></tr><tr><td style="text-align:left">begin;</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left">use muke; <br>select * from t17 where b=1 for update; <br>â€¦ <br>1 rows in set (0.00 sec)</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"></td><td style="text-align:left">use muke; <br>select <em> from t17 where b=2 for update; <br> <em>*(ç­‰å¾…)</em></em></td><td style="text-align:left">insert into t17(a,b,c) values(10,10,10); <br> <strong>(ç­‰å¾…)</strong></td></tr><tr><td style="text-align:left">commit;</td><td style="text-align:left">select <em> from t17 where b=2 for update; <br>â€¦ <br> <em>*(session1 æäº¤åï¼Œé©¬ä¸Šè¿”å›ç»“æœ)</em></em></td><td style="text-align:left">insert into t17(a,b,c) values(10,10,10); <br>â€¦ <br> <strong>(session1 æäº¤åï¼Œé©¬ä¸Šå†™å…¥)</strong></td></tr></tbody></table></div><p>å¯èƒ½ä½ ä¼šé—®ï¼Ÿä¸ºä»€ä¹ˆ session3 çš„ insert ä¼šå‡ºç°ç­‰å¾…ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹çœ‹ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/RRéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæ— ç´¢å¼•.png" alt="RRéš”ç¦»çº§åˆ«å’Œæ¡ä»¶å­—æ®µæ— ç´¢å¼•"></p><p>å¦‚å›¾ï¼Œæ‰€æœ‰è®°å½•éƒ½æœ‰ X é”ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸ª GAP ä¹Ÿè¢«åŠ ä¸Šäº† GAP é”ã€‚å› æ­¤è¿™å¼ è¡¨åœ¨æ‰§è¡Œå®Œ select * from t17 where b=1 for update; åˆ° commit ä¹‹å‰ï¼Œé™¤äº†ä¸åŠ é”çš„å¿«ç…§è¯»ï¼Œå…¶å®ƒä»»ä½•åŠ é”çš„ SQLï¼Œéƒ½ä¼šç­‰å¾…ï¼Œå¦‚æœè¿™æ˜¯çº¿ä¸Šä¸šåŠ¡è¡¨ï¼Œé‚£å°±æ˜¯ä»¶éå¸¸ææ€–çš„äº‹æƒ…äº†ã€‚</p><p>æ€»ç»“ï¼šRR éš”ç¦»çº§åˆ«ä¸‹ï¼Œéç´¢å¼•å­—æ®µåšæ¡ä»¶çš„å½“å‰è¯»ä¸ä½†ä¼šæŠŠæ¯æ¡è®°å½•éƒ½åŠ ä¸Š X é”ï¼Œè¿˜ä¼šæŠŠæ¯ä¸ª GAP åŠ ä¸Š GAP é”ã€‚å†æ¬¡è¯´æ˜ï¼Œæ¡ä»¶å­—æ®µåŠ ç´¢å¼•çš„é‡è¦æ€§ã€‚</p><h3 id="4-RR-éš”ç¦»çº§åˆ«ä¸‹çš„å”¯ä¸€ç´¢å¼•å½“å‰è¯»æ˜¯å¦ä¼šç”¨åˆ°-GAP-é”"><a href="#4-RR-éš”ç¦»çº§åˆ«ä¸‹çš„å”¯ä¸€ç´¢å¼•å½“å‰è¯»æ˜¯å¦ä¼šç”¨åˆ°-GAP-é”" class="headerlink" title="4 RR éš”ç¦»çº§åˆ«ä¸‹çš„å”¯ä¸€ç´¢å¼•å½“å‰è¯»æ˜¯å¦ä¼šç”¨åˆ° GAP é”"></a>4 RR éš”ç¦»çº§åˆ«ä¸‹çš„å”¯ä¸€ç´¢å¼•å½“å‰è¯»æ˜¯å¦ä¼šç”¨åˆ° GAP é”</h3><p>GAP é”çš„ç›®çš„æ˜¯ï¼šä¸ºäº†é˜²æ­¢åŒä¸€äº‹åŠ¡ä¸¤æ¬¡å½“å‰è¯»ï¼Œå‡ºç°å¹»è¯»çš„æƒ…å†µã€‚å¦‚æœèƒ½ç¡®ä¿ç´¢å¼•å­—æ®µå”¯ä¸€ï¼Œé‚£å…¶å®ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œæœ€å¤šå°±è¿”å›ä¸€æ¡è®°å½•ï¼Œè€Œä¸”ç›¸åŒç´¢å¼•è®°å½•çš„å€¼ï¼Œä¸€å®šä¸ä¼šå†æ–°å¢ï¼Œå› æ­¤ä¸ä¼šå‡ºç° GAP é”ã€‚</p><p>å› æ­¤ä»¥å”¯ä¸€ç´¢å¼•ä¸ºæ¡ä»¶çš„å½“å‰è¯»ï¼Œä¸ä¼šæœ‰ GAP é”ã€‚æ‰€ä»¥ RR éš”ç¦»çº§åˆ«ä¸‹çš„å”¯ä¸€ç´¢å¼•å½“å‰è¯»åŠ é”æƒ…å†µä¸ RC éš”ç¦»çº§åˆ«ä¸‹çš„å”¯ä¸€ç´¢å¼•å½“å‰è¯»åŠ é”æƒ…å†µä¸€è‡´ã€‚è¿™é‡Œå°±ä¸å†å®éªŒäº†ã€‚</p><h2 id="18-ä¸ºä»€ä¹ˆä¼šå‡ºç°æ­»é”ï¼Ÿ"><a href="#18-ä¸ºä»€ä¹ˆä¼šå‡ºç°æ­»é”ï¼Ÿ" class="headerlink" title="18 ä¸ºä»€ä¹ˆä¼šå‡ºç°æ­»é”ï¼Ÿ"></a>18 ä¸ºä»€ä¹ˆä¼šå‡ºç°æ­»é”ï¼Ÿ</h2><h3 id="1-è®¤è¯†æ­»é”"><a href="#1-è®¤è¯†æ­»é”" class="headerlink" title="1 è®¤è¯†æ­»é”"></a>1 è®¤è¯†æ­»é”</h3><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–è€…å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€èµ„æºä¸Šç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹å ç”¨çš„èµ„æºï¼Œä»è€Œå¯¼è‡´æ¶æ€§å¾ªç¯çš„ç°è±¡ã€‚</p><p>InnoDB ä¸­è§£å†³æ­»é”é—®é¢˜æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>æ£€æµ‹åˆ°æ­»é”çš„å¾ªç¯ä¾èµ–ï¼Œç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯ï¼ˆè¿™ä¸ªæŠ¥é”™å†…å®¹è¯·çœ‹ä¸‹é¢çš„å®éªŒï¼‰ï¼Œå°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º on è¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼›</li><li>ç­‰æŸ¥è¯¢çš„æ—¶é—´è¾¾åˆ°é”ç­‰å¾…è¶…æ—¶çš„è®¾å®šåæ”¾å¼ƒé”è¯·æ±‚ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´ç”± innodb_lock_wait_timeout æ¥æ§åˆ¶ã€‚é»˜è®¤æ˜¯ 50 ç§’ã€‚</li></ol><blockquote><p>ä¸€èˆ¬çº¿ä¸Šä¸šåŠ¡éƒ½å»ºè®®ä½¿ç”¨çš„ç¬¬ 1 ç§ç­–ç•¥ï¼Œå› ä¸ºç¬¬ 2 ç§ç­–ç•¥é”ç­‰å¾…æ—¶é—´æ˜¯ 50 ç§’ï¼Œå¯¹äºé«˜å¹¶å‘çš„çº¿ä¸Šä¸šåŠ¡æ˜¯ä¸èƒ½æ¥å—çš„ã€‚<br>ä½†æ˜¯ç¬¬ 1 ç§ç­–ç•¥ï¼Œä¹Ÿä¼šæœ‰æ­»é”æ£€æµ‹æ—¶çš„é¢å¤– CPU å¼€é”€çš„ï¼Œæ¯”å¦‚ç”µå•†ä¸­çš„ç§’æ€åœºæ™¯ã€‚è¿™ç§æƒ…å†µå°±å¯ä»¥æ ¹æ®ä¸šåŠ¡å¼€å‘å•†é‡ä¼˜åŒ–ç¨‹åºï¼Œå¦‚æœå¯ä»¥ç¡®ä¿ä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æ‰ï¼Œä»¥æé«˜å¹¶å‘æ•ˆç‡ã€‚</p></blockquote><h3 id="2-ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”"><a href="#2-ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”" class="headerlink" title="2 ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”"></a>2 ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”</h3><h4 id="2-1-åŒä¸€å¼ è¡¨ä¸­"><a href="#2-1-åŒä¸€å¼ è¡¨ä¸­" class="headerlink" title="2.1 åŒä¸€å¼ è¡¨ä¸­"></a>2.1 åŒä¸€å¼ è¡¨ä¸­</h4><p>ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®åŒä¸€å¼ è¡¨çš„å¤šè¡Œæ•°æ®ï¼ŒæœªæŒ‰é¡ºåºè®¿é—®å¯¼è‡´æ­»é”ã€‚</p><h4 id="2-2-ä¸åŒè¡¨ä¹‹é—´"><a href="#2-2-ä¸åŒè¡¨ä¹‹é—´" class="headerlink" title="2.2 ä¸åŒè¡¨ä¹‹é—´"></a>2.2 ä¸åŒè¡¨ä¹‹é—´</h4><p>ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®å¤šä¸ªè¡¨æ—¶ï¼ŒæœªæŒ‰é¡ºåºè®¿é—®å¯¼è‡´æ­»é”ã€‚</p><h4 id="2-3-äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#2-3-äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="2.3 äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>2.3 äº‹åŠ¡éš”ç¦»çº§åˆ«</h4><p>RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œç”±äºé—´éš™é”å¯¼è‡´æ­»é”ã€‚</p><h3 id="3-å¦‚ä½•é™ä½æ­»é”æ¦‚ç‡"><a href="#3-å¦‚ä½•é™ä½æ­»é”æ¦‚ç‡" class="headerlink" title="3 å¦‚ä½•é™ä½æ­»é”æ¦‚ç‡"></a>3 å¦‚ä½•é™ä½æ­»é”æ¦‚ç‡</h3><p>é‚£ä¹ˆåº”è¯¥æ€æ ·é™ä½å‡ºç°æ­»é”çš„æ¦‚ç‡å‘¢ï¼Ÿè¿™é‡Œæ€»ç»“äº†å¦‚ä¸‹ä¸€äº›ç»éªŒï¼š</p><ol><li>æ›´æ–° SQL çš„ where æ¡ä»¶å°½é‡ç”¨ç´¢å¼•ï¼›</li><li>åŸºäº primary æˆ– unique key æ›´æ–°æ•°æ®ï¼›</li><li>å‡å°‘èŒƒå›´æ›´æ–°ï¼Œå°¤å…¶éä¸»é”®ã€éå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æ›´æ–°ï¼›</li><li>åŠ é”é¡ºåºä¸€è‡´ï¼Œå°½å¯èƒ½ä¸€æ¬¡æ€§é”å®šæ‰€æœ‰éœ€è¦è¡Œï¼›</li><li>å°† RR éš”ç¦»çº§åˆ«è°ƒæ•´ä¸º RC éš”ç¦»çº§åˆ«ã€‚</li></ol><h3 id="4-åˆ†ææ­»é”çš„æ–¹æ³•"><a href="#4-åˆ†ææ­»é”çš„æ–¹æ³•" class="headerlink" title="4 åˆ†ææ­»é”çš„æ–¹æ³•"></a>4 åˆ†ææ­»é”çš„æ–¹æ³•</h3><p>å°½ç®¡åœ¨ä¸Šé¢ä»‹ç»äº†é™ä½æ­»é”æ¦‚ç‡çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å®é™…å·¥ä½œä¸­ï¼Œæ­»é”å¾ˆéš¾å®Œå…¨é¿å…ã€‚å› æ­¤ï¼Œæ•è·å¹¶å¤„ç†æ­»é”ä¹Ÿæ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚</p><p>InnoDB ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ SHOW INNODB STATUS å‘½ä»¤æ¥æŸ¥çœ‹æœ€åä¸€ä¸ªæ­»é”çš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨ä¸‹è¿™ä¸ªå‘½ä»¤è·å–ä¸€äº›æ­»é”ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">engine</span> <span class="token keyword">innodb</span> <span class="token keyword">status</span>\G<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦å¤–è®¾ç½® innodb_print_all_deadlocks = on å¯ä»¥åœ¨ err log ä¸­è®°å½•å…¨éƒ¨æ­»é”ä¿¡æ¯ã€‚</p><hr><p>ç¬¬4ç«  äº‹åŠ¡</p><h2 id="19-æ•°æ®åº“å¿½ç„¶æ–­ç”µä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ"><a href="#19-æ•°æ®åº“å¿½ç„¶æ–­ç”µä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ" class="headerlink" title="19 æ•°æ®åº“å¿½ç„¶æ–­ç”µä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ"></a>19 æ•°æ®åº“å¿½ç„¶æ–­ç”µä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ</h2><h3 id="1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ"></a>1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</h3><p>æ ¹æ®ã€Šé«˜æ€§èƒ½ MySQLã€‹ç¬¬ 3 ç‰ˆ 1.3 äº‹åŠ¡ä¸€èŠ‚ä¸­å®šä¹‰ï¼š</p><blockquote><p>äº‹åŠ¡å°±æ˜¯ä¸€ç»„åŸå­æ€§çš„ SQL æŸ¥è¯¢ï¼Œæˆ–è€…è¯´ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒã€‚å¦‚æœæ•°æ®åº“å¼•æ“èƒ½å¤ŸæˆåŠŸåœ°å¯¹æ•°æ®åº“åº”ç”¨è¯¥ç»„æŸ¥è¯¢çš„å…¨éƒ¨è¯­å¥ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œè¯¥ç»„æŸ¥è¯¢ã€‚å¦‚æœå…¶ä¸­æœ‰ä»»ä½•ä¸€æ¡è¯­å¥å› ä¸ºå´©æºƒæˆ–å…¶ä»–åŸå› æ— æ³•æ‰§è¡Œï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯­å¥éƒ½ä¸ä¼šæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹åŠ¡å†…çš„è¯­å¥ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ã€‚</p></blockquote><p>ä¸€ä¸ªè‰¯å¥½çš„äº‹åŠ¡å¤„ç†ç³»ç»Ÿï¼Œå¿…é¡»å…·å¤‡ ACID ç‰¹æ€§ï¼š</p><ul><li>atomicityï¼ˆåŸå­æ€§ï¼‰ ï¼šè¦ä¹ˆå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œï¼›</li><li>consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹å’Œå®Œæˆæ—¶ï¼Œæ•°æ®éƒ½å¿…é¡»ä¿æŒä¸€è‡´çŠ¶æ€ï¼›</li><li>isolationï¼ˆéš”ç¦»æ€§ï¼‰ ï¼šäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸­é—´çŠ¶æ€å¯¹å¤–éƒ¨æ˜¯ä¸å¯è§çš„ï¼›</li><li>durabilityï¼ˆæŒä¹…æ€§ï¼‰ ï¼šäº‹åŠ¡å®Œæˆä¹‹åï¼Œå®ƒå¯¹äºæ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ã€‚</li></ul><p>InnoDB é‡‡ç”¨ redo log æœºåˆ¶æ¥ä¿è¯äº‹åŠ¡æ›´æ–°çš„ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ã€‚</p><h3 id="2-Redo-log"><a href="#2-Redo-log" class="headerlink" title="2 Redo log"></a>2 Redo log</h3><p>Redo log ç§°ä¸ºé‡åšæ—¥å¿—ï¼Œç”¨äºè®°å½•äº‹åŠ¡æ“ä½œå˜åŒ–ï¼Œè®°å½•çš„æ˜¯æ•°æ®è¢«ä¿®æ”¹ä¹‹åçš„å€¼ã€‚</p><p>Redo log ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>å†…å­˜ä¸­çš„é‡åšæ—¥å¿—ç¼“å†²ï¼ˆredo log bufferï¼‰</li><li>é‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo log fileï¼‰</li></ul><p>æ¯æ¬¡æ•°æ®æ›´æ–°ä¼šå…ˆæ›´æ–° redo log bufferï¼Œç„¶åæ ¹æ® innodb_flush_log_at_trx_commit æ¥æ§åˆ¶ redo log buffer æ›´æ–°åˆ° redo log file çš„æ—¶æœºã€‚innodb_flush_log_at_trx_commit æœ‰ä¸‰ä¸ªå€¼å¯é€‰ï¼š</p><p>0ï¼šäº‹åŠ¡æäº¤æ—¶ï¼Œæ¯ç§’è§¦å‘ä¸€æ¬¡ redo log buffer å†™ç£ç›˜æ“ä½œï¼Œå¹¶è°ƒç”¨æ“ä½œç³»ç»Ÿ fsync åˆ·æ–° IO ç¼“å­˜ã€‚</p><p>1ï¼šäº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDB ç«‹å³å°†ç¼“å­˜ä¸­çš„ redo æ—¥å¿—å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¹¶è°ƒç”¨æ“ä½œç³»ç»Ÿ fsync åˆ·æ–° IO ç¼“å­˜ï¼›</p><p>2ï¼šäº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDB ç«‹å³å°†ç¼“å­˜ä¸­çš„ redo æ—¥å¿—å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä½†ä¸æ˜¯é©¬ä¸Šè°ƒç”¨ fsync åˆ·æ–° IO ç¼“å­˜ï¼Œè€Œæ˜¯æ¯ç§’åªåšä¸€æ¬¡ç£ç›˜ IO ç¼“å­˜åˆ·æ–°æ“ä½œã€‚</p><p>innodb_flush_log_at_trx_commit å‚æ•°çš„é»˜è®¤å€¼æ˜¯ 1ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªäº‹åŠ¡æäº¤çš„æ—¶å€™éƒ½ä¼šä» log buffer å†™æ›´æ–°è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸”ä¼šåˆ·æ–°ç£ç›˜ç¼“å­˜ï¼Œè¿™å®Œå…¨æ»¡è¶³äº‹åŠ¡æŒä¹…åŒ–çš„è¦æ±‚ï¼Œæ˜¯æœ€å®‰å…¨çš„ï¼Œä½†æ˜¯è¿™æ ·ä¼šæœ‰æ¯”è¾ƒå¤§çš„æ€§èƒ½æŸå¤±ã€‚</p><p>å°†å‚æ•°è®¾ç½®ä¸º 0 æ—¶ï¼Œå¦‚æœæ•°æ®åº“å´©æºƒï¼Œæœ€å 1ç§’é’Ÿçš„ redo log å¯èƒ½ä¼šç”±äºæœªåŠæ—¶å†™å…¥ç£ç›˜æ–‡ä»¶è€Œä¸¢å¤±ï¼Œè¿™ç§æ–¹å¼å°½ç®¡æ•ˆç‡æœ€é«˜ï¼Œä½†æ˜¯æœ€ä¸å®‰å…¨ã€‚</p><p>å°†å‚æ•°è®¾ç½®ä¸º 2 æ—¶ï¼Œå¦‚æœæ•°æ®åº“å´©æºƒï¼Œç”±äºå·²ç»æ‰§è¡Œäº†é‡åšæ—¥å¿—å†™å…¥ç£ç›˜çš„æ“ä½œï¼Œåªæ˜¯æ²¡æœ‰åšç£ç›˜ IO åˆ·æ–°æ“ä½œï¼Œå› æ­¤ï¼Œåªè¦ä¸å‘ç”Ÿæ“ä½œç³»ç»Ÿå¥”æºƒï¼Œæ•°æ®å°±ä¸ä¼šä¸¢å¤±ï¼Œè¿™ç§æ–¹å¼æ˜¯å¯¹æ€§èƒ½å’Œå®‰å…¨çš„ä¸€ç§æŠ˜ä¸­å¤„ç†ã€‚</p><h3 id="3-Binlog"><a href="#3-Binlog" class="headerlink" title="3 Binlog"></a>3 Binlog</h3><p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰è®°å½•äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­å¥ï¼‰å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­å¥ï¼‰ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ select å’Œ show è¿™ç±»æ“ä½œã€‚Binlog æœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨ï¼š</p><ul><li>æ¢å¤ï¼šæ•°æ®æ¢å¤æ—¶å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ—¥å¿—</li><li>å¤åˆ¶ï¼šé€šè¿‡ä¼ è¾“äºŒè¿›åˆ¶æ—¥å¿—åˆ°ä»åº“ï¼Œç„¶åè¿›è¡Œæ¢å¤ï¼Œä»¥å®ç°ä¸»ä»åŒæ­¥</li><li>å®¡è®¡ï¼šå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œå®¡è®¡æ•°æ®çš„å˜æ›´æ“ä½œ</li></ul><p>å¯ä»¥é€šè¿‡å‚æ•° sync_binlog æ¥æ§åˆ¶ç´¯ç§¯å¤šå°‘ä¸ªäº‹åŠ¡åæ‰å°†äºŒè¿›åˆ¶æ—¥å¿— fsync åˆ°ç£ç›˜ã€‚</p><ul><li>sync_binlog=0ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åªwriteï¼Œä¸fsync</li><li>sync_binlog=1ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œfsync</li><li>sync_binlog=N(N&gt;1)ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsync</li></ul><p>æ¯”å¦‚è¦åŠ å¿«å†™å…¥æ•°æ®çš„é€Ÿåº¦æˆ–è€…æœºå™¨ç£ç›˜ IO ç“¶é¢ˆæ—¶ï¼Œå¯ä»¥å°† sync_binlog è®¾ç½®æˆå¤§äº 1 çš„å€¼ï¼Œä½†æ˜¯å¦‚æœè®¾ç½®ä¸º N(N&gt;1)æ—¶ï¼Œå¦‚æœæ•°æ®åº“å´©æºƒï¼Œå¯èƒ½ä¼šä¸¢å¤±æœ€è¿‘ N ä¸ªäº‹åŠ¡çš„ binlogã€‚</p><h3 id="4-æ€æ ·ç¡®ä¿æ•°æ®åº“çªç„¶æ–­ç”µä¸ä¸¢æ•°æ®ï¼Ÿ"><a href="#4-æ€æ ·ç¡®ä¿æ•°æ®åº“çªç„¶æ–­ç”µä¸ä¸¢æ•°æ®ï¼Ÿ" class="headerlink" title="4 æ€æ ·ç¡®ä¿æ•°æ®åº“çªç„¶æ–­ç”µä¸ä¸¢æ•°æ®ï¼Ÿ"></a>4 æ€æ ·ç¡®ä¿æ•°æ®åº“çªç„¶æ–­ç”µä¸ä¸¢æ•°æ®ï¼Ÿ</h3><p>é€šè¿‡ä¸Šé¢çš„è®²è§£ï¼Œåªè¦ innodb_flush_log_at_trx_commit å’Œ sync_binlog éƒ½ä¸º 1ï¼ˆé€šå¸¸ç§°ä¸ºï¼šåŒä¸€ï¼‰ï¼Œå°±èƒ½ç¡®ä¿ MySQL æœºå™¨æ–­ç”µé‡å¯åï¼Œæ•°æ®ä¸ä¸¢å¤±ã€‚</p><p>å› æ­¤å»ºè®®åœ¨æ¯”è¾ƒé‡è¦çš„åº“ï¼Œæ¯”å¦‚æ¶‰åŠåˆ°é’±çš„åº“ï¼Œè®¾ç½®ä¸ºåŒä¸€ï¼Œè€Œä½ çš„æµ‹è¯•ç¯å¢ƒæˆ–è€…æ­£å¼ä¸šåŠ¡ä¸é‚£ä¹ˆé‡è¦çš„åº“ï¼ˆæ¯”å¦‚æ—¥å¿—åº“ï¼‰å¯ä»¥å°† innodb_flush_log_at_trx_commit è®¾ç½®ä¸º0ï¼Œsync_binlog è®¾ç½®æˆå¤§äº100 çš„æ•°å€¼ï¼Œæé«˜æ›´æ–°æ•ˆç‡ã€‚</p><h2 id="20-MVCCæ€ä¹ˆå®ç°çš„"><a href="#20-MVCCæ€ä¹ˆå®ç°çš„" class="headerlink" title="20 MVCCæ€ä¹ˆå®ç°çš„?"></a>20 MVCCæ€ä¹ˆå®ç°çš„?</h2><p>æœ¬èŠ‚è·Ÿå¤§å®¶ä¸€èµ·èŠèŠ MVCCï¼ˆMulti-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œåœ¨è®²è§£ MVCC ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠéšè—åˆ—ã€Undo log å’Œ Read Viewã€‚</p><h3 id="1-éšè—åˆ—"><a href="#1-éšè—åˆ—" class="headerlink" title="1 éšè—åˆ—"></a>1 éšè—åˆ—</h3><p>å¯¹äº InnoDB ï¼Œæ¯è¡Œè®°å½•é™¤äº†æˆ‘ä»¬åˆ›å»ºçš„å­—æ®µå¤–ï¼Œå…¶å®è¿˜åŒ…å« 3 ä¸ªéšè—çš„åˆ—ï¼š</p><ul><li>ROW IDï¼šéšè—çš„è‡ªå¢ IDï¼Œå¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼ŒInnoDB ä¼šè‡ªåŠ¨ä»¥ ROW ID äº§ç”Ÿä¸€ä¸ªèšé›†ç´¢å¼•æ ‘ã€‚</li><li>äº‹åŠ¡ IDï¼šè®°å½•æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ IDã€‚</li><li>å›æ»šæŒ‡é’ˆï¼šæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚</li></ul><h3 id="2-Undo-log"><a href="#2-Undo-log" class="headerlink" title="2 Undo log"></a>2 Undo log</h3><p>ä¸ŠèŠ‚æˆ‘ä»¬è®²åˆ°äº† redo logï¼Œå®ƒè®°å½•äº†äº‹åŠ¡æ“ä½œå˜åŒ–ã€‚ä½†æ˜¯äº‹åŠ¡æœ‰æ—¶æ˜¯éœ€è¦å›æ»šçš„ï¼Œè¿™æ—¶ï¼ŒUndo log å°±å‘æŒ¥äº†ä½œç”¨ã€‚Undo log æ˜¯é€»è¾‘æ—¥å¿—ï¼Œå°†æ•°æ®åº“é€»è¾‘åœ°æ¢å¤åˆ°åŸæ¥çš„æ ·å­ï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½è¢«é€»è¾‘çš„å–æ¶ˆäº†ã€‚</p><ul><li>å¦‚æœæ˜¯ insert æ“ä½œï¼Œå…¶å¯¹åº”çš„å›æ»šæ“ä½œå°±æ˜¯ deleteï¼›</li><li>å¦‚æœæ˜¯ deleteï¼Œåˆ™å¯¹åº”çš„å›æ»šæ“ä½œæ˜¯ insertï¼›</li><li>å¦‚æœæ˜¯ updateï¼Œåˆ™å¯¹åº”çš„å›æ»šæ“ä½œæ˜¯ä¸€ä¸ªåå‘çš„ update æ“ä½œã€‚</li></ul><p>Undo log çš„ä½œç”¨é™¤äº†å›æ»šæ“ä½œï¼ŒUndo log çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯ MVCCï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¸­ MVCC çš„å®ç°æ˜¯é€šè¿‡ Undo log æ¥å®Œæˆçš„ã€‚å½“ç”¨æˆ·è¯»å–ä¸€è¡Œè®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•å·²ç»è¢«å…¶å®ƒäº‹åŠ¡å ç”¨ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥é€šè¿‡ Undo log è¯»å–ä¹‹å‰çš„è¡Œç‰ˆæœ¬ä¿¡æ¯ï¼Œå› ä¸ºæ²¡æœ‰äº‹åŠ¡éœ€è¦å¯¹å†å²çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦åŠ é”ï¼Œä»¥æ­¤æ¥å®ç°éé”å®šè¯»å–ã€‚</p><h3 id="3-Read-View"><a href="#3-Read-View" class="headerlink" title="3 Read View"></a>3 Read View</h3><p>Read View æ˜¯æŒ‡äº‹åŠ¡è¿›è¡Œå¿«ç…§è¯»æ“ä½œçš„é‚£ä¸€åˆ»ï¼Œäº§ç”Ÿæ•°æ®åº“ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡åˆ—è¡¨çš„ä¸€ä¸ªå¿«ç…§ã€‚</p><p>Read View ä¸­å¤§è‡´åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>trx_idsï¼šæ•°æ®åº“ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡ ID é›†åˆï¼›</li><li>low_limit_idï¼šæ´»è·ƒäº‹åŠ¡ä¸­æœ€å¤§çš„äº‹åŠ¡ ID +1ï¼›</li><li>up_limt_idï¼šæ´»è·ƒäº‹åŠ¡æ€»æœ€å°çš„äº‹åŠ¡ IDï¼›</li><li>creator_trx_idï¼šåˆ›å»ºè¿™ä¸ª Read View çš„äº‹åŠ¡ IDã€‚</li></ul><p>æ¯”å¦‚æŸä¸ªäº‹åŠ¡ï¼Œåˆ›å»ºäº† Read Viewï¼Œé‚£ä¹ˆå®ƒçš„ creator_trx_id å°±ä¸ºè¿™ä¸ªäº‹åŠ¡çš„ IDï¼Œå‡å¦‚éœ€è¦è®¿é—®æŸä¸€è¡Œï¼Œå‡è®¾è¿™ä¸€è¡Œè®°å½•çš„éšè—äº‹åŠ¡ ID ä¸º t_idï¼Œé‚£ä¹ˆå¯èƒ½å‡ºç°çš„æƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœ t_id &lt; up_limt_idï¼Œè¯´æ˜è¿™è¡Œè®°å½•åœ¨è¿™äº›æ´»è·ƒçš„äº‹åŠ¡åˆ›å»ºä¹‹å‰å°±å·²ç»æäº¤äº†ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œè®°å½•å¯¹è¯¥äº‹åŠ¡æ˜¯å¯è§çš„ã€‚</li><li>å¦‚æœ t_id &gt;= low_limt_idï¼Œè¯´æ˜è¿™è¡Œè®°å½•åœ¨è¿™äº›æ´»è·ƒçš„äº‹åŠ¡å¼€å§‹ä¹‹ååˆ›å»ºçš„ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œè®°å½•å¯¹è¯¥äº‹ç‰©æ˜¯ä¸å¯è§çš„ã€‚</li><li>å¦‚æœ up_limit_id &lt;= t_id &lt; low_limit_idï¼Œè¯´æ˜è¿™è¡Œè®°å½•å¯èƒ½æ˜¯åœ¨è¿™äº›æ´»è·ƒçš„äº‹åŠ¡ä¸­åˆ›å»ºçš„ï¼Œå¦‚æœ t_id ä¹ŸåŒæ—¶åœ¨ trx_ids ä¸­ï¼Œåˆ™è¯´æ˜ t_id è¿˜æœªæäº¤ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œè®°å½•å¯¹è¯¥äº‹ç‰©æ˜¯ä¸å¯è§çš„ï¼›å¦‚æœ t_id ä¸åœ¨ trx_ids ä¸­ï¼Œåˆ™è¯´æ˜äº‹åŠ¡ t_id å·²ç»æäº¤äº†ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œè®°å½•å¯¹è¯¥äº‹ç‰©æ˜¯å¯è§çš„ã€‚</li></ul><p>å¯¹äºä¸å¯è§çš„è®°å½•ï¼Œéƒ½æ˜¯é€šè¿‡æŸ¥è¯¢ Undo log æ¥æŸ¥è¯¢è€çš„è®°å½•ã€‚</p><p>äº†è§£äº†ä¸Šé¢çš„åŸç†ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼ŒRead View è§„åˆ™å¸®æˆ‘ä»¬åˆ¤æ–­å½“å‰ç‰ˆæœ¬çš„æ•°æ®æ˜¯å¦å¯è§ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ†æä¸‹å½“æŸ¥è¯¢ä¸€æ¡è®°å½•æ—¶ï¼Œå¤§è‡´çš„æ­¥éª¤ï¼š</p><ul><li>è·å–äº‹åŠ¡æœ¬èº«çš„äº‹åŠ¡ IDï¼›</li><li>è·å– Read Viewï¼›</li><li>æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®ï¼Œç„¶åä¸ Read View ä¸­çš„äº‹åŠ¡ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒï¼›</li><li>å¦‚æœèƒ½æŸ¥è¯¢ï¼Œåˆ™ç›´æ¥æŸ¥è¯¢å¯¹åº”çš„è®°å½•ï¼›å¦‚æœä¸èƒ½ç›´æ¥æŸ¥è¯¢ï¼Œåˆ™é€šè¿‡ Undo Log ä¸­è·å–å†å²å¿«ç…§ï¼›</li><li>æœ€ç»ˆè¿”å›ç»“æœã€‚</li></ul><p>å¦å¤–éœ€è¦è¡¥å……çš„ä¸€ç‚¹å°±æ˜¯ï¼Œåœ¨ RR å’Œ RC éš”ç¦»çº§åˆ«ä¸‹ï¼Œè·å– Read View çš„æ—¶æœºä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼š</p><ul><li>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼ˆRRï¼‰ä¸‹ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒæŸ¥è¯¢è¯­å¥åªæ˜¯åœ¨ç¬¬ä¸€ä¸ªè¯»è¯·æ±‚å‘èµ·æ—¶è·å– Read Viewï¼Œè€Œåé¢ç›¸åŒçš„æŸ¥è¯¢è¯­å¥éƒ½ä¼šä½¿ç”¨è¿™ä¸ª Read Viewã€‚</li><li>åœ¨è¯»å·²æäº¤éš”ç¦»çº§åˆ«ï¼ˆRCï¼‰ä¸‹ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŒæ ·çš„æŸ¥è¯¢è¯­å¥åœ¨æ¯æ¬¡è¯»è¯·æ±‚å‘èµ·æ—¶éƒ½ä¼šè·å¾— Read Viewã€‚</li></ul><h3 id="4-ä»€ä¹ˆæ˜¯-MVCCï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯-MVCCï¼Ÿ" class="headerlink" title="4 ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ"></a>4 ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ</h3><p>åœ¨è¯´ MVCC ä¹‹å‰ï¼Œå¤§å®¶å…ˆçœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><p>é¦–å…ˆåˆ›å»ºè¡¨å¹¶å†™å…¥æµ‹è¯•æ•°æ®ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t20<span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t20<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_c<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t20<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›è¡Œå®éªŒï¼š</p><div class="table-container"><table><thead><tr><th></th><th>session1</th><th>session2</th></tr></thead><tbody><tr><td>1</td><td>set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td><td>set session transaction_isolation=â€™READ-COMMITTEDâ€™;/<em> è®¾ç½®ä¼šè¯éš”ç¦»çº§åˆ«ä¸º RC</em>/</td></tr><tr><td>2</td><td>select <em> from t20;<br> <em>*Result1</em></em></td><td></td></tr><tr><td>3</td><td>begin;</td><td></td></tr><tr><td>4</td><td>update t20 set b=666 where a=1;</td><td></td></tr><tr><td>5</td><td></td><td>begin;</td></tr><tr><td>6</td><td></td><td>select <em> from t20;<br> <em>*Result2</em></em></td></tr><tr><td>7</td><td>commit;</td><td></td></tr><tr><td>8</td><td></td><td>select <em> from t20;<br> <em>*Result3</em></em></td></tr><tr><td>9</td><td></td><td>commit;</td></tr></tbody></table></div><p>å…¶ä¸­</p><p><strong>Result1</strong>ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----+---+---+| id | a | b |+----+---+---+|  1 | 1 | 1 ||  2 | 2 | 2 |+----+---+---+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Result2</strong>ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; select * from t20;+----+---+---+| id | a | b |+----+---+---+|  1 | 1 | 1 ||  2 | 2 | 2 |+----+---+---+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Result3</strong>ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; select * from t20;+----+---+-----+| id | a | b   |+----+---+-----+|  1 | 1 | 666 ||  2 | 2 |   2 |+----+---+-----+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ session1 æ›´æ–°äº† a=1 è¿™è¡Œè®°å½•ï¼Œä½†è¿˜æ²¡æäº¤çš„æƒ…å†µä¸‹ï¼Œåœ¨ session2 ä¸­ï¼Œæ»¡è¶³ a=1 è¿™æ¡è®°å½•ï¼Œb çš„å€¼è¿˜æ˜¯åŸå§‹å€¼ 1ï¼Œè€Œä¸æ˜¯ session 1 æ›´æ–°ä¹‹åçš„ 666ï¼Œé‚£ä¹ˆåœ¨æ•°æ®åº“å±‚é¢ï¼Œè¿™æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p><p>å…¶å® InnoDB å°±æ˜¯é€šè¿‡ MVCC å’Œ Undo log æ¥å®ç°çš„ã€‚</p><p>ä»€ä¹ˆæ˜¯ MVCC å‘¢ï¼Ÿ</p><p>MVCCï¼Œ å³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCC çš„å®ç°ï¼Œæ˜¯é€šè¿‡ä¿å­˜æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡éœ€è¦æ‰§è¡Œå¤šé•¿æ—¶é—´ï¼Œæ¯ä¸ªäº‹åŠ¡çœ‹åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚æ ¹æ®äº‹åŠ¡å¼€å§‹çš„æ—¶é—´ä¸åŒï¼Œæ¯ä¸ªäº‹åŠ¡å¯¹åŒä¸€å¼ è¡¨ï¼ŒåŒä¸€æ—¶åˆ»çœ‹åˆ°çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯ä¸Šé¢å®éªŒç¬¬ 6 æ­¥ä¸­ï¼Œä¸ºä»€ä¹ˆ session2 æŸ¥è¯¢çš„ç»“æœè¿˜æ˜¯ session1 ä¿®æ”¹ä¹‹å‰çš„è®°å½•ã€‚</p><h3 id="5-MVCC-çš„å®ç°åŸç†"><a href="#5-MVCC-çš„å®ç°åŸç†" class="headerlink" title="5 MVCC çš„å®ç°åŸç†"></a>5 MVCC çš„å®ç°åŸç†</h3><p>æˆ‘ä»¬æ‹¿ä¸Šé¢çš„ä¾‹å­ï¼Œå¯¹åº”è§£é‡Šä¸‹ MVCC çš„å®ç°åŸç†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/MVCCå®ç°åŸç†.png" alt="MVCCå®ç°åŸç†"></p><p>å¦‚å›¾ï¼Œé¦–å…ˆ insert è¯­å¥å‘è¡¨ t20 ä¸­æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œa å­—æ®µä¸º 1ï¼Œb å­—æ®µä¸º 1ï¼Œ ROW ID ä¹Ÿä¸º 1 ï¼Œäº‹åŠ¡ ID å‡è®¾ä¸º 1ï¼Œå›æ»šæŒ‡é’ˆå‡è®¾ä¸º nullã€‚å½“æ‰§è¡Œ update t20 set b=666 where a=1 æ—¶ï¼Œå¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>æ•°æ®åº“ä¼šå…ˆå¯¹æ»¡è¶³ a=1 çš„è¡ŒåŠ æ’ä»–é”ï¼›</li><li>ç„¶åå°†åŸè®°å½•å¤åˆ¶åˆ° undo è¡¨ç©ºé—´ä¸­ï¼›</li><li>ä¿®æ”¹ b å­—æ®µçš„å€¼ä¸º 666ï¼Œä¿®æ”¹äº‹åŠ¡ ID ä¸º 2ï¼›</li><li>å¹¶é€šè¿‡éšè—çš„å›æ»šæŒ‡é’ˆæŒ‡å‘ Undo log ä¸­çš„å†å²è®°å½•ï¼›</li><li>äº‹åŠ¡æäº¤ï¼Œé‡Šæ”¾å‰é¢å¯¹æ»¡è¶³ a=1 çš„è¡Œæ‰€åŠ çš„æ’ä»–é”ã€‚</li></ul><p>åœ¨å‰é¢å®éªŒçš„ç¬¬ 6 æ­¥ä¸­ï¼Œsession2 æŸ¥è¯¢çš„ç»“æœæ˜¯ session1 ä¿®æ”¹ä¹‹å‰çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªç‚¹çš„ Read Viewï¼Œæ ¹æ®ä¸Šé¢å°†çš„ Read View åŸç†ï¼Œè¢«æŸ¥è¯¢è¡Œçš„éšè—äº‹åŠ¡ ID å°±åœ¨å½“å‰æ´»è·ƒäº‹åŠ¡ ID é›†åˆä¸­ã€‚å› æ­¤ï¼Œè¿™ä¸€è¡Œè®°å½•å¯¹è¯¥äº‹ç‰©ï¼ˆsession2 ä¸­çš„äº‹åŠ¡ï¼‰æ˜¯ä¸å¯è§çš„ï¼Œå¯ä»¥çŸ¥é“ session2 æŸ¥è¯¢çš„ a=1 è¿™è¡Œè®°å½•å®é™…å°±æ˜¯æ¥è‡ª Undo log ä¸­ã€‚æˆ‘ä»¬çœ‹åˆ°çš„ç°è±¡å°±æ˜¯åŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å­˜åœ¨äº†å¤šä¸ªç‰ˆæœ¬ï¼Œè¿™å°±æ˜¯ MySQL çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMVCC åªåœ¨ RC å’Œ RR ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œã€‚å› æ­¤åœ¨ä¸Šé¢çš„å®éªŒä¸­ï¼Œæ”¹æˆ RR éš”ç¦»çº§åˆ«ï¼Œç¬¬ 6 æ­¥ä¸­ï¼Œå¾—åˆ°çš„ç»“æœè¿˜æ˜¯ session1 ä¿®æ”¹ä¹‹å‰çš„è®°å½•ï¼ˆä½†æ˜¯åœ¨ç¬¬ 8 æ­¥ï¼Œç»“æœä¸ä¸€æ ·å“¦ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŠŠä¸Šé¢æ“ä½œæ”¾åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹å®éªŒä¸€ä¸‹ï¼‰</p><h3 id="6-MVCC-çš„ä¼˜åŠ¿"><a href="#6-MVCC-çš„ä¼˜åŠ¿" class="headerlink" title="6 MVCC çš„ä¼˜åŠ¿"></a>6 MVCC çš„ä¼˜åŠ¿</h3><p>MVCC æœ€å¤§çš„å¥½å¤„æ˜¯è¯»ä¸åŠ é”ï¼Œè¯»å†™ä¸å†²çªï¼Œæå¤§åœ°å¢åŠ äº† MySQL çš„å¹¶å‘æ€§ã€‚</p><p>é€šè¿‡ MVCCï¼Œä¿è¯äº†äº‹åŠ¡ ACID ä¸­çš„ Iï¼ˆéš”ç¦»æ€§ï¼‰ç‰¹æ€§ã€‚</p><h3 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7 æ€»ç»“"></a>7 æ€»ç»“</h3><p>æˆ‘ä»¬çŸ¥é“äº†ï¼ŒMySQL æ˜¯é€šè¿‡ Read View åˆ¤æ–­æ˜¯å¦èƒ½ç›´æ¥æŸ¥è¯¢åˆ°å¯¹åº”çš„è®°å½•ï¼Œå¦‚æœéœ€è¦æŸ¥è¯¢ä¸€äº›è¢«å…¶å®ƒäº‹åŠ¡æ­£åœ¨æ›´æ–°çš„è¡Œï¼Œåˆ™è¦å–å‡º Undo log ä¸­å†å²ç‰ˆæœ¬çš„è®°å½•ã€‚</p><p>MVCC å®ç°çš„åŸç†å¤§è‡´æ˜¯ï¼š</p><p>InnoDB æ¯ä¸€è¡Œæ•°æ®éƒ½æœ‰ä¸€ä¸ªéšè—çš„å›æ»šæŒ‡é’ˆï¼Œç”¨äºæŒ‡å‘è¯¥è¡Œä¿®æ”¹å‰çš„æœ€åä¸€ä¸ªå†å²ç‰ˆæœ¬ï¼Œè¿™ä¸ªå†å²ç‰ˆæœ¬å­˜æ”¾åœ¨ Undo log ä¸­ã€‚å¦‚æœè¦æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œä¼šå°†åŸè®°å½•æ”¾å…¥ Undo log ä¸­ï¼Œå¹¶é€šè¿‡éšè—çš„å›æ»šæŒ‡é’ˆæŒ‡å‘ Undo log ä¸­çš„åŸè®°å½•ã€‚å…¶å®ƒäº‹åŠ¡æ­¤æ—¶éœ€è¦æŸ¥è¯¢æ—¶ï¼Œå°±æ˜¯æŸ¥è¯¢ Undo log ä¸­è¿™è¡Œæ•°æ®çš„æœ€åä¸€ä¸ªå†å²ç‰ˆæœ¬ã€‚</p><p>MVCC æœ€å¤§çš„å¥½å¤„æ˜¯è¯»ä¸åŠ é”ï¼Œè¯»å†™ä¸å†²çªï¼Œæå¤§çš„å¢åŠ äº† MySQL çš„å¹¶å‘æ€§ï¼Œé€šè¿‡ MVCCï¼Œä¹Ÿä¿è¯äº†äº‹åŠ¡ ACID ä¸­çš„ Iï¼ˆéš”ç¦»æ€§ï¼‰ç‰¹æ€§ã€‚</p><h3 id="8-é—®é¢˜"><a href="#8-é—®é¢˜" class="headerlink" title="8 é—®é¢˜"></a>8 é—®é¢˜</h3><p>MVCC ä¸ºä»€ä¹ˆåªåœ¨ RC å’Œ RR ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œï¼Ÿ</p><p>è§£ç­”ï¼š</p><p>ä»æŸ¥è¯¢æ–¹é¢çœ‹ï¼ŒMVCCæ˜¯è§£å†³åœ¨å¹¶å‘æ¡ä»¶ä¸‹ï¼ŒåŒæ—¶å¯èƒ½ä¼šäº§ç”Ÿå¤šä¸ªå€¼ï¼Œå¦‚ä½•ä»å¤šä¸ªå€¼ä¸­é€‰æ‹©ä¸€ä¸ªå€¼çš„æŠ€æœ¯ã€‚</p><p>ä½†åœ¨RUå’Œä¸²è¡Œçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªä¼šå­˜åœ¨ä¸€ä¸ªå€¼ã€‚</p><ul><li>RUï¼šæ¯æ¬¡åªå–æœ€æ–°çš„å€¼ï¼Œä¸å­˜åœ¨å¤šä¸ªå€¼çš„æƒ…å†µã€‚</li><li>ä¸²è¡Œï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šåŠ è¯»é”ï¼Œå½“æœ‰æ›´æ–°æ—¶ä¼šé˜»å¡ä½ï¼Œåªæœ‰ç­‰åˆ°æŸ¥è¯¢å®Œé”é‡Šæ”¾åï¼Œæ‰ä¼šåšæ›´æ–°æ“ä½œã€‚æ‰€ä»¥ä¹Ÿä¸å­˜åœ¨å¤šä¸ªå€¼çš„æƒ…å†µã€‚</li></ul><h2 id="21-ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"><a href="#21-ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ" class="headerlink" title="21 ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ"></a>21 ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</h2><h3 id="1-é€šè¿‡åŸºæœ¬å®šä¹‰è®¤è¯†äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#1-é€šè¿‡åŸºæœ¬å®šä¹‰è®¤è¯†äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="1 é€šè¿‡åŸºæœ¬å®šä¹‰è®¤è¯†äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>1 é€šè¿‡åŸºæœ¬å®šä¹‰è®¤è¯†äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p>MySQL æœ‰å››ç§éš”ç¦»çº§åˆ«ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™å››ç§éš”ç¦»çº§åˆ«çš„åŸºæœ¬å®šä¹‰ï¼š</p><ul><li>Read uncommittedï¼ˆè¯»æœªæäº¤ï¼Œç®€ç§°ï¼šRUï¼‰: åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶å®ƒæœªæäº¤çš„äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚å¯èƒ½ä¼šå‡ºç°è„è¯»ã€‚</li><li>Read Committedï¼ˆè¯»å·²æäº¤ï¼Œç®€ç§°ï¼š RCï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚å› ä¸ºåŒä¸€äº‹åŠ¡çš„å…¶å®ƒå®ä¾‹åœ¨è¯¥å®ä¾‹å¤„ç†æœŸé—´å¯èƒ½ä¼šæœ‰æ–°çš„ commitï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°å¹»è¯»ã€‚</li><li>Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼Œç®€ç§°ï¼šRRï¼‰ï¼šè¿™æ˜¯ MySQL çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚æ¶ˆé™¤äº†è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œé»˜è®¤ä¹Ÿä¸ä¼šå‡ºç°å¹»è¯»ã€‚</li><li>Serializableï¼ˆä¸²è¡Œï¼‰ï¼šè¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®<br>é¢˜ã€‚</li></ul><h3 id="4-å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#4-å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="4 å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>4 å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p>åœ¨ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬è®¤è¯†äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œé‚£ä¹ˆåº”è¯¥æ€æ ·é€‰æ‹©åˆé€‚çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å‘¢ï¼Ÿ</p><p>å¯¹äº RU éš”ç¦»çº§åˆ«ï¼Œä¼šå¯¼è‡´è„è¯»ï¼Œä»æ€§èƒ½ä¸Šçœ‹ï¼Œä¹Ÿä¸ä¼šæ¯”å…¶å®ƒéš”ç¦»çº§åˆ«å¥½å¤ªå¤šï¼Œå› æ­¤ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚</p><p>å¯¹äº RC éš”ç¦»çº§åˆ«ï¼Œç›¸æ¯” RU éš”ç¦»çº§åˆ«ï¼Œä¸ä¼šå‡ºç°è„è¯»ï¼›ä½†æ˜¯ä¼šå‡ºç°å¹»è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡æ‰§è¡ŒåŒæ ·çš„æŸ¥è¯¢ï¼Œå¯èƒ½å¾—åˆ°ä¸ä¸€æ ·çš„ç»“æœã€‚</p><p>å¯¹äº RR éš”ç¦»çº§åˆ«ï¼Œç›¸æ¯” RC éš”ç¦»çº§åˆ«ï¼Œè§£å†³äº†éƒ¨åˆ†å¹»è¯»ï¼ˆè¿™ä¸ªåœ¨ç¬¬ 17 èŠ‚è¯¦ç»†è®²äº†ï¼ŒRR éš”ç¦»çº§åˆ«é€šè¿‡é—´éš™é”è§£å†³äº†éƒ¨åˆ†å¹»è¯»ï¼‰ï¼Œä½†æ˜¯ç›¸å¯¹äº RCï¼Œé”çš„èŒƒå›´å¯èƒ½æ›´å¤§äº†ã€‚</p><p>å¯¹äº Serializable éš”ç¦»çº§åˆ«ï¼Œå› ä¸ºå®ƒå¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œä¼šåœ¨è¯»å–çš„æ¯ä¸€è¡Œæ•°æ®ä¸Šéƒ½åŠ é”ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„è¶…æ—¶å’Œé”äº‰ç”¨çš„é—®é¢˜ã€‚ç”Ÿæˆç¯å¢ƒå¾ˆå°‘ä½¿ç”¨ã€‚</p><p>å› æ­¤æ€»çš„æ¥è¯´ï¼Œå»ºè®®åœ¨ RC å’Œ RR ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸­é€‰ä¸€ç§ï¼Œå¦‚æœèƒ½æ¥å—å¹»è¯»ï¼Œéœ€è¦å¹¶å‘é«˜ç‚¹ï¼Œå°±å¯ä»¥é…ç½®æˆ RCï¼Œå¦‚æœä¸èƒ½æ¥å—å¹»è¯»çš„æƒ…å†µï¼Œå°±è®¾ç½®æˆ RR éš”ç¦»çº§åˆ«ã€‚</p><h3 id="22-å…»æˆå¥½çš„äº‹åŠ¡ä¹ æƒ¯"><a href="#22-å…»æˆå¥½çš„äº‹åŠ¡ä¹ æƒ¯" class="headerlink" title="22 å…»æˆå¥½çš„äº‹åŠ¡ä¹ æƒ¯"></a>22 å…»æˆå¥½çš„äº‹åŠ¡ä¹ æƒ¯</h3><h3 id="1-ä¸å¥½çš„äº‹åŠ¡ä¹ æƒ¯"><a href="#1-ä¸å¥½çš„äº‹åŠ¡ä¹ æƒ¯" class="headerlink" title="1 ä¸å¥½çš„äº‹åŠ¡ä¹ æƒ¯"></a>1 ä¸å¥½çš„äº‹åŠ¡ä¹ æƒ¯</h3><h4 id="1-1-åœ¨å¾ªç¯ä¸­æäº¤"><a href="#1-1-åœ¨å¾ªç¯ä¸­æäº¤" class="headerlink" title="1.1 åœ¨å¾ªç¯ä¸­æäº¤"></a>1.1 åœ¨å¾ªç¯ä¸­æäº¤</h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒMySQL éƒ½æ˜¯å¼€å¯è‡ªåŠ¨æäº¤çš„ï¼Œå¦‚æœé‡åˆ°å¾ªç¯æ‰§è¡Œ SQLï¼Œåˆ™ç›¸å½“äºæ¯ä¸ªå¾ªç¯ä¸­éƒ½ä¼šè¿›è¡Œä¸€æ¬¡æäº¤ï¼Œå®é™…è¿™ç®—ä¸€ä¸ªä¸å¥½çš„äº‹åŠ¡ä¹ æƒ¯äº†ã€‚ä¸‹é¢æˆ‘åˆ›å»ºä¸€å¼ æµ‹è¯•è¡¨ï¼Œå¹¶å®šä¹‰ä¸¤ä¸ªå¾ªç¯å†™å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹ï¼šä¸€ä¸ªæ˜¯è‡ªåŠ¨æäº¤ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨å¾ªç¯å‰å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨å¾ªç¯åä¸€æ¬¡æ€§æäº¤ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> muke<span class="token punctuation">;</span> <span class="token comment">/* ä½¿ç”¨mukeè¿™ä¸ªdatabase */</span><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> t22<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœè¡¨t22å­˜åœ¨åˆ™åˆ é™¤è¡¨t22 */</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t22<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>c<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">`</span>d<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_b<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>  <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t22_1<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t22_1ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t22_1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t22_1 */</span><span class="token keyword">begin</span><span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">/* å£°æ˜å˜é‡i */</span><span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span><span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span> <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=10000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t22<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t22ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span><span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* å°†iåŠ 1 */</span><span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥10000æ¡æ•°æ®åˆ°è¡¨t22çš„å­˜å‚¨è¿‡ç¨‹insert_t22_1 */</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> insert_t22_2<span class="token punctuation">;</span> <span class="token comment">/* å¦‚æœå­˜åœ¨å­˜å‚¨è¿‡ç¨‹insert_t22_2ï¼Œåˆ™åˆ é™¤ */</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> insert_t22_2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* åˆ›å»ºå­˜å‚¨è¿‡ç¨‹insert_t22_2 */</span><span class="token keyword">begin</span><span class="token keyword">declare</span> i <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">/* å£°æ˜å˜é‡i */</span><span class="token keyword">set</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* è®¾ç½®içš„åˆå§‹å€¼ä¸º1 */</span><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">do</span> <span class="token comment">/* å¯¹æ»¡è¶³i&lt;=10000çš„å€¼è¿›è¡Œwhileå¾ªç¯ */</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t22<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å†™å…¥è¡¨t22ä¸­aã€bä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºiå½“å‰çš„å€¼ */</span><span class="token keyword">set</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* å°†iåŠ 1 */</span><span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">commit</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºæ‰¹é‡å†™å…¥10000æ¡æ•°æ®åˆ°è¡¨t22çš„å­˜å‚¨è¿‡ç¨‹insert_t22_2 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬æ¥å¯¹æ¯”ä¸¤ä¸ªå­˜å‚¨è¿‡ç¨‹çš„é€Ÿåº¦ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">mysql&gt; call insert_t22_1(); /* insert_t22_1 */Query OK, 1 row affected (28.36 sec)mysql&gt; call insert_t22_2(); /* insert_t22_2 */Query OK, 0 rows affected (0.37 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜æ˜¾ç¬¬äºŒç§æ–¹å¼å¿«çš„å¤šã€‚å› ä¸º insert_t22_1 æ¯ä¸€æ¬¡æäº¤éƒ½è¦å†™ä¸€æ¬¡é‡åšæ—¥å¿—ï¼Œå®é™…å†™äº† 10000 æ¬¡é‡åšæ—¥å¿—ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ insert_t22_2 åªå†™äº† 1 æ¬¡é‡åšæ—¥å¿—ã€‚</p><p>å› æ­¤ï¼Œåœ¨ç±»ä¼¼è¿™ç§å¾ªç¯å†™å…¥çš„æƒ…å†µï¼Œå¦‚æœå¾ªç¯æ¬¡æ•°ä¸æ˜¯å¤ªå¤šï¼Œå»ºè®®åœ¨å¾ªç¯å‰å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¾ªç¯ç»“æŸåç»Ÿä¸€æäº¤ã€‚</p><h3 id="1-2-ä¸å…³æ³¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œè¯­å¥é¡ºåº"><a href="#1-2-ä¸å…³æ³¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œè¯­å¥é¡ºåº" class="headerlink" title="1.2 ä¸å…³æ³¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œè¯­å¥é¡ºåº"></a>1.2 ä¸å…³æ³¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œè¯­å¥é¡ºåº</h3><p>æ¯”å¦‚ A åœ¨è¶…å¸‚è´­ä¹° 100 å…ƒçš„å•†å“ï¼Œä»˜æ¬¾æ“ä½œå¯ä»¥ç®€åŒ–ä¸ºï¼š</p><div class="table-container"><table><thead><tr><th>åºå·</th><th>æ“ä½œ</th></tr></thead><tbody><tr><td>1</td><td>A çš„è´¦æˆ·ä¸­æ‰£é™¤ 100</td></tr><tr><td>2</td><td>è¶…å¸‚çš„è´¦æˆ·å¢åŠ  100</td></tr><tr><td>3</td><td>åœ¨è¶…å¸‚ç³»ç»Ÿä¸­è®°å½•ä¸€æ¡æ—¥å¿—</td></tr></tbody></table></div><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šæŒ‰ä¸Šé¢çš„ SQL æ­¥éª¤æ”¾å…¥ä¸€ä¸ªäº‹åŠ¡é‡Œæ‰§è¡Œï¼Œä¸å…³æ³¨é‡Œé¢è¯­å¥çš„é¡ºåºã€‚å®é™…å¯ä»¥ä¼˜åŒ–çš„ã€‚</p><p>æ ¹æ®ä¸¤é˜¶æ®µé”ï¼Œæ•´ä¸ªäº‹åŠ¡é‡Œé¢æ¶‰åŠçš„é”ï¼Œéœ€è¦ç­‰åˆ°äº‹åŠ¡æäº¤æ—¶æ‰ä¼šé‡Šæ”¾ã€‚å› æ­¤æˆ‘ä»¬åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¯ä»¥æŠŠæ²¡é”æˆ–è€…é”èŒƒå›´å°çš„è¯­å¥æ”¾åœ¨äº‹åŠ¡å‰é¢æ‰§è¡Œï¼Œè€Œé”å®šèŒƒå›´å¤§çš„è¯­å¥æ”¾åœ¨åé¢æ‰§è¡Œã€‚</p><blockquote><p>è¿™é‡Œæ¥å›é¡¾ä¸€ä¸‹ç¬¬ 16 èŠ‚ä¸­æåˆ°çš„ä¸¤é˜¶æ®µé”ï¼šé”æ“ä½œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼ŒåŠ é”é˜¶æ®µå’Œè§£é”é˜¶æ®µï¼Œå¹¶ä¸”ä¿è¯åŠ é”é˜¶æ®µå’Œè§£é”é˜¶æ®µä¸ç›¸äº¤ã€‚åœ¨æ‰§è¡Œè¯­å¥çš„æ—¶å€™åŠ ä¸Šé”ï¼Œä½†å¹¶ä¸æ˜¯è¯­å¥æ‰§è¡Œå®Œå°±ç«‹åˆ»é‡Šæ”¾é”ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚</p></blockquote><p>å› æ­¤ä¸Šé¢ A è´­ä¹°å•†å“çš„ä¾‹å­ä¸­ï¼Œå¯èƒ½å¾ˆå¤šäººåŒæ—¶åœ¨è¶…å¸‚ä»˜æ¬¾ï¼Œé‚£ä¹ˆå­˜åœ¨é”ç«äº‰çš„æœ€å¯èƒ½æ˜¯è¶…å¸‚è´¦æˆ·å¢åŠ  100 å…ƒçš„æ“ä½œã€‚</p><p>é‚£ä¹ˆä»˜æ¬¾æ“ä½œå¯ä»¥è¿™ä¹ˆä¼˜åŒ–ï¼š</p><div class="table-container"><table><thead><tr><th>åºå·</th><th>æ“ä½œ</th></tr></thead><tbody><tr><td>1</td><td>åœ¨è¶…å¸‚ç³»ç»Ÿä¸­è®°å½•ä¸€æ¡æ—¥å¿—</td></tr><tr><td>2</td><td>A çš„è´¦æˆ·ä¸­æ‰£é™¤ 100</td></tr><tr><td>3</td><td>è¶…å¸‚çš„è´¦æˆ·å¢åŠ  100</td></tr></tbody></table></div><p>æŠŠå¯èƒ½å­˜åœ¨é”ç«äº‰çš„æ“ä½œæ”¾åœ¨æœ€åæ‰§è¡Œï¼Œä»è€Œä¼˜åŒ–æ•´ä¸ªäº‹åŠ¡ã€‚</p><p>å› æ­¤åœ¨å†™ç¨‹åºæ—¶ï¼Œåº”è¯¥å»å…³æ³¨äº‹åŠ¡é‡Œçš„è¯­å¥é¡ºåºã€‚</p><h3 id="1-3-ä¸å…³æ³¨ä¸åŒäº‹åŠ¡è®¿é—®èµ„æºçš„é¡ºåº"><a href="#1-3-ä¸å…³æ³¨ä¸åŒäº‹åŠ¡è®¿é—®èµ„æºçš„é¡ºåº" class="headerlink" title="1.3 ä¸å…³æ³¨ä¸åŒäº‹åŠ¡è®¿é—®èµ„æºçš„é¡ºåº"></a>1.3 ä¸å…³æ³¨ä¸åŒäº‹åŠ¡è®¿é—®èµ„æºçš„é¡ºåº</h3><p>å„ä½æ˜¯å¦è¿˜è®°å¾—ï¼Œåœ¨ç¬¬ 18 èŠ‚ä¸­ï¼Œè®²åˆ°äº†å‡ ç§äº§ç”Ÿæ­»é”çš„åŸå› ï¼Œå…¶ä¸­æœ‰ä¸¤æ¡å°±è·Ÿä¸åŒäº‹åŠ¡è®¿é—®èµ„æºé¡ºåºæœ‰å…³ï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ï¼š</p><ul><li>ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®åŒä¸€å¼ è¡¨çš„å¤šè¡Œæ•°æ®ï¼ŒæœªæŒ‰é¡ºåºè®¿é—®å¯¼è‡´æ­»é”ã€‚</li><li>ä¸åŒçº¿ç¨‹å¹¶å‘è®¿é—®å¤šä¸ªè¡¨æ—¶ï¼ŒæœªæŒ‰é¡ºåºè®¿é—®å¯¼è‡´æ­»é”ã€‚</li></ul><p>å¦‚æœä¸å…³æ³¨å¹¶å‘è®¿é—®çš„ä¸åŒäº‹åŠ¡ä¸­è®¿é—®èµ„æºçš„é¡ºåºï¼Œå°±ä¼šå¢å¤§å‡ºç°æ­»é”çš„æ¦‚ç‡ã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†é™ä½æ­»é”ï¼Œæˆ‘ä»¬éœ€è¦å»å…³æ³¨ä¸åŒäº‹åŠ¡è®¿é—®èµ„æºçš„é¡ºåºã€‚</p><h4 id="1-4-ä¸å…³æ³¨äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#1-4-ä¸å…³æ³¨äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="1.4 ä¸å…³æ³¨äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>1.4 ä¸å…³æ³¨äº‹åŠ¡éš”ç¦»çº§åˆ«</h4><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†èŠåˆ°äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå› æ­¤ä¹ŸçŸ¥é“ï¼Œä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«åŠ é”çš„æƒ…å†µä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><p>å¦‚æœå®Œå…¨ä¸å…³æ³¨è‡ªå·±ä¸šåŠ¡ä½¿ç”¨çš„ MySQL æ˜¯ä»€ä¹ˆéš”ç¦»çº§åˆ«ï¼Œå¯èƒ½ä¼šé™ä½ç¨‹åºçš„å¹¶å‘èƒ½åŠ›æˆ–è€…å¯¼è‡´æ­»é”ã€‚</p><p>æ¯”å¦‚ä¸šåŠ¡åœºæ™¯å®Œå…¨èƒ½æ¥å—å¹»è¯»ï¼Œå¦‚æœè¦æ±‚æ›´é«˜çš„ QPSï¼Œä½¿ç”¨ RR éš”ç¦»çº§åˆ«æ˜¾ç„¶ä¸æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œå› æ­¤å¯ä»¥æ”¹ä¸º RC éš”ç¦»çº§åˆ«ã€‚</p><p>è€Œå¦‚æœä¸šåŠ¡ä½¿ç”¨çš„æ˜¯ RR éš”ç¦»çº§åˆ«ï¼Œå¯èƒ½ç”±äºé—´éš™é”å¯¼è‡´æ­»é”ï¼ˆå¯å‚è€ƒç¬¬ 18 èŠ‚ 2.3 ä¸­çš„ä¾‹å­ï¼‰ï¼Œå› æ­¤ä¹Ÿåº”è¯¥åœ¨ç¨‹åºç¼–å†™æ—¶å…³æ³¨ RR éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¦ä¼šæœ‰é—´éš™é”ã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†æ›´é«˜çš„å¹¶å‘å’Œé™ä½æ­»é”æ¦‚ç‡ï¼Œåœ¨åˆ›å»ºäº‹åŠ¡å‰ï¼Œä¹Ÿåº”è¯¥å»å…³æ³¨è‡ªå·±ä¸šåŠ¡çš„æ•°æ®åº“æ˜¯ä»€ä¹ˆäº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p><h4 id="1-5-åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“"><a href="#1-5-åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“" class="headerlink" title="1.5 åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“"></a>1.5 åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“</h4><p>åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨äº‹åŠ¡å‹ï¼ˆæ¯”å¦‚ InnoDBï¼‰å’Œéäº‹åŠ¡å‹ï¼ˆæ¯”å¦‚ MyISAMï¼‰è¡¨ï¼Œå¦‚æœæ˜¯æ­£å¸¸æäº¤ï¼Œåˆ°æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœè¯¥äº‹åŠ¡å›æ»šäº†ï¼Œäº‹åŠ¡å‹çš„è¡¨å¯ä»¥æ­£å¸¸å›æ»šï¼Œè€Œéäº‹åŠ¡å‹çš„è¡¨çš„å˜æ›´å°±æ— æ³•å›æ»šäº†ã€‚è¿™ç§æƒ…å†µå°±ä¼šå¯¼è‡´æ•°æ®ä¸æ­£å¸¸ï¼Œå¹¶ä¸”äº‹åŠ¡æœ€ç»ˆçš„ç»“æœä¹Ÿéš¾ä»¥ç¡®å®šã€‚</p><p>å› æ­¤ï¼Œåœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“ä¹Ÿæ˜¯ä¸€ä¸ªä¸å¥½çš„äº‹åŠ¡ä¹ æƒ¯ã€‚</p><blockquote><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼šå¦‚æœå¼€å¯ GTIDï¼Œé‚£ä¹ˆå½“åŒä¸€ä¸ªäº‹åŠ¡ä¸­ä½¿ç”¨ä¸åŒå­˜å‚¨å¼•æ“çš„è¡¨æ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š<br>ERROR 1785 (HY000): Statement violates GTID consistency: Updates to non-transactional tables can only be done in either autocommitted statements or single-statement transactions, and never in the same statement as updates to transactional tables.<br>å› æ­¤ï¼Œå¼€å¯ GTID çš„æƒ…å†µï¼Œå¯ä»¥é¿å…åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“çš„æƒ…å†µã€‚</p></blockquote><h3 id="2-æ€»ç»“ä¸€ä¸‹å¥½çš„äº‹åŠ¡ä¹ æƒ¯"><a href="#2-æ€»ç»“ä¸€ä¸‹å¥½çš„äº‹åŠ¡ä¹ æƒ¯" class="headerlink" title="2 æ€»ç»“ä¸€ä¸‹å¥½çš„äº‹åŠ¡ä¹ æƒ¯"></a>2 æ€»ç»“ä¸€ä¸‹å¥½çš„äº‹åŠ¡ä¹ æƒ¯</h3><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ—ä¸¾äº†å‡ ç§ä¸å¥½çš„äº‹åŠ¡ä¹ æƒ¯ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹å¥½çš„äº‹åŠ¡ä¹ æƒ¯ï¼š</p><ul><li>å¾ªç¯å†™å…¥çš„æƒ…å†µï¼Œå¦‚æœå¾ªç¯æ¬¡æ•°ä¸æ˜¯å¤ªå¤šï¼Œå»ºè®®åœ¨å¾ªç¯å‰å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¾ªç¯ç»“æŸåç»Ÿä¸€æäº¤ã€‚</li><li>ä¼˜åŒ–äº‹åŠ¡é‡Œçš„è¯­å¥é¡ºåºï¼Œå‡å°‘é”æ—¶é—´ã€‚</li><li>å…³æ³¨ä¸åŒäº‹åŠ¡è®¿é—®èµ„æºçš„é¡ºåºã€‚</li><li>åˆ›å»ºäº‹åŠ¡ä¹‹å‰ï¼Œå…³æ³¨äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</li><li>ä¸åœ¨äº‹åŠ¡ä¸­æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“ã€‚</li></ul><h2 id="23-ç»†èŠåˆ†å¸ƒå¼äº‹åŠ¡"><a href="#23-ç»†èŠåˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="23 ç»†èŠåˆ†å¸ƒå¼äº‹åŠ¡"></a>23 ç»†èŠåˆ†å¸ƒå¼äº‹åŠ¡</h2><p>æ¯”å¦‚ä½ åœ¨ç½‘ä¸Šä¹°äº†ä¸€æœ¬ä¹¦ï¼Œå¯ä»¥ç®€åŒ–ä¸ºåœ¨è®¢å•åº“å¢åŠ è®¢å•ï¼Œåœ¨åº“å­˜åº“å‡æ‰è¿™æœ¬ä¹¦çš„ 1 ä¸ªåº“å­˜ã€‚è¿™é‡Œè®¢å•åº“å’Œåº“å­˜åº“æ˜¯åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå¦‚æœè¿™ä¸¤æ­¥æ”¾åœ¨ä¸¤ä¸ªäº‹åŠ¡é‡Œï¼Œå¢åŠ è®¢å•è¿™ä¸€æ­¥æˆåŠŸäº†ï¼Œä½†æ˜¯å‡åº“å­˜è¿™é‡Œå¤±è´¥äº†ã€‚é‚£å²‚ä¸æ˜¯å°±ä¹±äº†ã€‚</p><p>è¿™é‡Œå°±è¦å¼•å‡ºåˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</p><h3 id="1-è®¤è¯†åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#1-è®¤è¯†åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="1 è®¤è¯†åˆ†å¸ƒå¼äº‹åŠ¡"></a>1 è®¤è¯†åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æŒ‡ä¸€ä¸ªå¤§çš„äº‹åŠ¡ç”±å¾ˆå¤šå°æ“ä½œç»„æˆï¼Œå°æ“ä½œåˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šæˆ–è€…ä¸åŒçš„åº”ç”¨ç¨‹åºä¸Šã€‚åˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦ä¿è¯è¿™äº›å°æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚MySQL ä» 5.0.3 å¼€å§‹æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>åˆ†å¸ƒå¼äº‹åŠ¡ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åè®®ï¼š</p><ul><li>ç¬¬ä¸€é˜¶æ®µï¼šæ‰€æœ‰åˆ†æ”¯äº‹åŠ¡éƒ½å¼€å§‹å‡†å¤‡ï¼Œå‘Šè¯‰äº‹åŠ¡ç®¡ç†å™¨è‡ªå·±å·²ç»å‡†å¤‡å¥½äº†ï¼›</li><li>ç¬¬äºŒé˜¶æ®µï¼šç¡®å®šæ˜¯ rollback è¿˜æ˜¯ commitï¼Œå¦‚æœæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸èƒ½æäº¤ï¼Œåˆ™æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦å›æ»šã€‚</li></ul><p>ä¸æœ¬åœ°äº‹åŠ¡ä¸åŒç‚¹åœ¨äºï¼šåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦å¤šä¸€æ¬¡ prepare æ“ä½œï¼Œç­‰æ”¶åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ç¡®å®šä¿¡æ¯åï¼Œå†è¿›è¡Œ commit æˆ–è€… rollbackã€‚</p><p>MySQL ä¸­åˆ†å¸ƒå¼äº‹åŠ¡æŒ‰å®ç°æ–¹å¼å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šMySQL è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡å’Œç»“åˆä¸­é—´ä»¶å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ä¸‹é¢æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><h3 id="2-MySQL-è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#2-MySQL-è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="2 MySQL è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡"></a>2 MySQL è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>MySQL æœ‰è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡å®ç°æ–¹æ³•ï¼Œå…·ä½“è¯­æ³•å¦‚ä¸‹ï¼š</p><p>å¯åŠ¨åˆ†æ”¯äº‹åŠ¡ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">xa <span class="token keyword">start</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a_1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>â€˜aâ€™,â€™a_1â€™ è¡¨ç¤º xidï¼Œ<br>a è¡¨ç¤º gtridï¼Œä¸ºåˆ†å¸ƒå¼äº‹åŠ¡æ ‡è¯†ç¬¦ï¼Œç›¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡ä½¿ç”¨ç›¸åŒçš„ gtridã€‚<br>a_1 è¡¨ç¤º bqualï¼Œä¸ºåˆ†æ”¯é™å®šç¬¦ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„æ¯ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡çš„ bqual å¿…é¡»ä¸åŒã€‚</p></blockquote><p>ç»“æŸåˆ†æ”¯äº‹åŠ¡ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">xa <span class="token keyword">end</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a_1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿›å…¥å‡†å¤‡çŠ¶æ€ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">xa <span class="token keyword">prepare</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a_1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æäº¤åˆ†æ”¯äº‹åŠ¡ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">xa <span class="token keyword">commit</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a_1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å›æ»šåˆ†æ”¯äº‹åŠ¡ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">xa <span class="token keyword">rollback</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a_1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿”å›å½“å‰æ•°æ®åº“ä¸­å¤„äºprepareçŠ¶æ€çš„åˆ†æ”¯äº‹åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">xa recover<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><div class="table-container"><table><thead><tr><th>session1</th><th>session2</th></tr></thead><tbody><tr><td>use muke1;</td><td>use muke2;</td></tr><tr><td>create table t23_1(id int);</td><td>create table t23_2(id int);</td></tr><tr><td>xa start â€˜testâ€™,â€™muke1â€™;</td><td>xa start â€˜testâ€™,â€™muke2â€™;</td></tr><tr><td>insert into t23_1 select 1;</td><td>insert into t23_2 select 1;</td></tr><tr><td>xa end â€˜testâ€™,â€™muke1â€™;</td><td>xa end â€˜testâ€™,â€™muke2â€™;</td></tr><tr><td>xa prepare â€˜testâ€™,â€™muke1â€™;</td><td>xa prepare â€˜testâ€™,â€™muke2â€™;</td></tr><tr><td>xa recover \G</td><td>xa recover \G</td></tr><tr><td>xa commit â€˜testâ€™,â€™muke1â€™;</td><td>xa commit â€˜testâ€™,â€™muke2â€™;</td></tr></tbody></table></div><p>ä¸Šé¢çš„ä¾‹å­å°±æ¼”ç¤ºäº†ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäº‹åŠ¡åœ¨ muke1 åº“ä¸­çš„ t23_1 è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼ŒåŒæ—¶åœ¨ muke2 åº“ä¸­çš„ t23_2 è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œä¸¤ä¸ªæ“ä½œä½œä¸ºåŒä¸€ä¸ªäº‹åŠ¡æäº¤ã€‚åœ¨è¿›å…¥å‡†å¤‡çŠ¶æ€ä¹‹å‰ï¼Œå¦‚æœ session2 ä¸­æŸä¸€æ­¥æ²¡æ‰§è¡ŒæˆåŠŸè€Œå›æ»šäº†ï¼Œåˆ™ session1 å’Œ session2 æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„æ“ä½œéƒ½ä¼šå›æ»šã€‚</p><p>ä½†æ˜¯ MySQL 5.7 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><p>æ¯”å¦‚æŸä¸ªåˆ†æ”¯äº‹åŠ¡åˆ°è¾¾ prepare çŠ¶æ€æ—¶ï¼Œæ­¤æ—¶æ•°æ®åº“æ–­ç”µï¼Œé‡å¯åï¼Œå¯ä»¥ç»§ç»­å¯¹åˆ†æ”¯äº‹åŠ¡è¿›è¡Œæäº¤æˆ–è€…å›æ»šï¼Œä½†æ˜¯æäº¤çš„äº‹åŠ¡ä¸ä¼šå†™ binlogï¼Œå¦‚æœæœ‰ä»åº“ï¼Œä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>å¦‚æœåˆ†æ”¯äº‹åŠ¡çš„å®¢æˆ·ç«¯è¿æ¥å¼‚å¸¸ä¸­æ­¢ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¼šè‡ªåŠ¨å›æ»šå½“å‰åˆ†æ”¯æœªå®Œæˆçš„äº‹åŠ¡ï¼Œå¦‚æœæ­¤æ—¶åˆ†æ”¯äº‹åŠ¡å·²ç»åˆ° prepare çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„å…¶ä»–åˆ†æ”¯å¯èƒ½å·²ç»æˆåŠŸæäº¤ï¼Œå¦‚æœè¿™ä¸ªåˆ†æ”¯å›æ»šï¼Œå¯èƒ½å¯¼è‡´åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸å®Œæ•´ï¼Œä¸¢å¤±éƒ¨åˆ†åˆ†æ”¯äº‹åŠ¡çš„å†…å®¹ã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¦‚æœåˆ†æ”¯äº‹åŠ¡åœ¨æ‰§è¡Œåˆ° prepare çŠ¶æ€æ—¶ï¼Œæ•°æ®åº“å‡ºç°æ•…éšœï¼Œå¹¶ä¸”æ— æ³•å¯åŠ¨ï¼Œéœ€è¦ä½¿ç”¨å…¨å¤‡å’Œ binlog æ¥æ¢å¤æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›åœ¨ prepare çŠ¶æ€çš„åˆ†æ”¯äº‹åŠ¡å› ä¸ºæ²¡æœ‰è®°å½•åˆ° binlogï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½é€šè¿‡binlog è¿›è¡Œæ¢å¤ï¼Œåœ¨æ•°æ®åº“æ¢å¤åï¼Œå°†ä¸¢å¤±è¿™éƒ¨åˆ†æ•°æ®ã€‚</p><p>æ‰€ä»¥ï¼ŒMySQL 5.7 ä¹‹å‰çš„ç‰ˆæœ¬è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿˜å­˜åœ¨æ¯”è¾ƒä¸¥é‡çš„ç¼ºé™·ï¼Œåœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚å¦‚æœä¸šåŠ¡å¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚ä¸æ”¹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ï¼Œå¦‚æœå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œéœ€è¦è€ƒè™‘å…ˆå‡çº§åˆ° 5.7 ç‰ˆæœ¬ã€‚</p><h3 id="3-ç»“åˆä¸­é—´ä»¶å®ç°åˆ†å¸ƒå¼"><a href="#3-ç»“åˆä¸­é—´ä»¶å®ç°åˆ†å¸ƒå¼" class="headerlink" title="3 ç»“åˆä¸­é—´ä»¶å®ç°åˆ†å¸ƒå¼"></a>3 ç»“åˆä¸­é—´ä»¶å®ç°åˆ†å¸ƒå¼</h3><p>ä¸Šé¢è¯´äº† MySQL è‡ªå¸¦çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ä¸‹å€ŸåŠ©ä¸­é—´ä»¶å®ç°åˆ†å¸ƒå¼çš„æƒ…å†µã€‚</p><p>å…·ä½“å®ç°æ–¹å¼å¯ä»¥æ‹¿ä¸Šé¢ç½‘ä¸Šè´­ä¹¦çš„ä¾‹å­æ¥è¯´ï¼š</p><p>è®¢å•ä¸šåŠ¡ç¨‹åºå¤„ç†å®Œå¢åŠ è®¢å•çš„æ“ä½œåï¼Œå°†å‡åº“å­˜æ“ä½œå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ä¸­ï¼ˆæ¯”å¦‚ï¼šRocketmqï¼‰ï¼Œè®¢å•ä¸šåŠ¡ç¨‹åºå®Œæˆæäº¤ã€‚ç„¶ååº“å­˜ä¸šåŠ¡ç¨‹åºæ£€æŸ¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—æœ‰å‡å¯¹åº”å•†å“åº“å­˜çš„ä¿¡æ¯ï¼Œå°±å¼€å§‹æ‰§è¡Œå‡åº“å­˜æ“ä½œã€‚åº“å­˜ä¸šåŠ¡æ‰§è¡Œå®Œå‡åº“å­˜æ“ä½œï¼Œå†å‘é€ä¸€æ¡æ¶ˆæ¯ç»™æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼šå†…å®¹æ˜¯å·²ç»å‡æ‰åº“å­˜ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/MQå®ç°å¢åŠ è®¢å•å’Œå‡åº“å­˜æ“ä½œ.png" alt="MQå®ç°å¢åŠ è®¢å•å’Œå‡åº“å­˜æ“ä½œ"></p><p>å½“ç„¶ï¼Œä¸ºäº†ç¡®å®šæœ€ç»ˆå·²ç»å®Œæˆå‡åº“å­˜æ“ä½œï¼Œè¿˜å¯ä»¥åŠ ä¸€æ­¥å¯¹æ•°æ®åº“ä¸­è¯¥å•†å“åº“å­˜çš„åˆ¤æ–­ã€‚</p><hr><p>ç¬¬5ç«  MySQLçš„ä¸€äº›å…¶ä»–ç»éªŒ</p><h2 id="27-ä½¿ç”¨è¯»å†™åˆ†ç¦»éœ€è¦æ³¨æ„å“ªäº›ï¼Ÿ"><a href="#27-ä½¿ç”¨è¯»å†™åˆ†ç¦»éœ€è¦æ³¨æ„å“ªäº›ï¼Ÿ" class="headerlink" title="27 ä½¿ç”¨è¯»å†™åˆ†ç¦»éœ€è¦æ³¨æ„å“ªäº›ï¼Ÿ"></a>27 ä½¿ç”¨è¯»å†™åˆ†ç¦»éœ€è¦æ³¨æ„å“ªäº›ï¼Ÿ</h2><p>å¯¹äºé«˜è®¿é—®é‡çš„ä¸šåŠ¡åœºæ™¯ï¼ŒMySQL è¯»å†™åˆ†ç¦»æ˜¾å¾—æ ¼å¤–é‡è¦ã€‚</p><p>é€šå¸¸æˆ‘ä»¬è¯´çš„ MySQL è¯»å†™åˆ†ç¦»æ˜¯æŒ‡ï¼šå¯¹äºä¿®æ”¹æ“ä½œåœ¨ä¸»åº“ä¸Šæ‰§è¡Œï¼Œè€Œå¯¹äºæŸ¥è¯¢æ“ä½œï¼Œåœ¨ä»åº“ä¸Šæ‰§è¡Œã€‚ä¸»è¦ç›®çš„æ˜¯åˆ†æ‹…ä¸»åº“çš„å‹åŠ›ã€‚</p><p>ä½†æ˜¯è¯»å†™åˆ†ç¦»æœ‰æ—¶ä¹Ÿä¼šå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚ï¼šä¸»ä»å»¶è¿Ÿæ—¶ï¼Œè¯»å–çš„ä»åº“æ•°æ®ä¸æ˜¯æœ€æ–°çš„ï¼Œå¯¹åº”çš„ä¸šåŠ¡åœºæ™¯æ¯”å¦‚ï¼š</p><p>ä½ ç½‘è´­çš„ä¸€ä¸ªå•†å“ï¼Œä»˜å®Œæ¬¾ä¹‹åï¼Œå› ä¸ºä¸»ä»å»¶è¿Ÿï¼Œç¬¬ä¸€æ—¶é—´è¿˜æŸ¥è¯¢ä¸åˆ°è®¢å•ï¼ˆæŸ¥è¯¢çš„ä»åº“ï¼‰ï¼Œå³ä½¿ç­‰ä¸€æ®µæ—¶é—´èƒ½çœ‹åˆ°è®¢å•ï¼Œä½†æ˜¯ç›¸ä¿¡è¿™ç§æƒ…å†µå¾ˆå¤šç”¨æˆ·æ˜¯ä¸èƒ½æ¥å—çš„ã€‚</p><p>æœ¬èŠ‚å°±ä¸€èµ·æ¥è®¨è®ºä¸€ä¸‹ï¼šè¯»å†™åˆ†ç¦»éœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¯»å†™åˆ†ç¦»éƒ½æ˜¯ä¾èµ–ä¸»ä»å¤åˆ¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸»ä»å¤åˆ¶çš„åŸç†ï¼Œä¹Ÿèƒ½æ–¹ä¾¿æˆ‘ä»¬ç†è§£ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿçš„ç°è±¡ã€‚</p><h3 id="1-ä¸»ä»å¤åˆ¶çš„åŸç†"><a href="#1-ä¸»ä»å¤åˆ¶çš„åŸç†" class="headerlink" title="1 ä¸»ä»å¤åˆ¶çš„åŸç†"></a>1 ä¸»ä»å¤åˆ¶çš„åŸç†</h3><h4 id="1-1-MySQL-å¼‚æ­¥å¤åˆ¶"><a href="#1-1-MySQL-å¼‚æ­¥å¤åˆ¶" class="headerlink" title="1.1 MySQL å¼‚æ­¥å¤åˆ¶"></a>1.1 MySQL å¼‚æ­¥å¤åˆ¶</h4><p>ä¼ ç»Ÿçš„ MySQL ä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºå¼‚æ­¥å¤åˆ¶ï¼ŒMySQL å¼‚æ­¥å¤åˆ¶çš„åŸç†å¦‚ä¸‹ï¼š</p><ul><li>åœ¨ä¸»åº“å¼€å¯ binlog çš„æƒ…å†µä¸‹</li><li>å¦‚æœä¸»åº“æœ‰å¢åˆ æ”¹çš„è¯­å¥ï¼Œä¼šè®°å½•åˆ° binlog ä¸­</li><li>ä¸»åº“é€šè¿‡ IO çº¿ç¨‹æŠŠ binlog é‡Œé¢çš„å†…å®¹ä¼ ç»™ä»åº“çš„ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰ä¸­</li><li>ä¸»åº“ç»™å®¢æˆ·ç«¯è¿”å› commit æˆåŠŸï¼ˆè¿™é‡Œä¸ä¼šç®¡ä»åº“æ˜¯å¦å·²ç»æ”¶åˆ°äº†äº‹åŠ¡çš„ binlogï¼‰</li><li>ä»åº“çš„ SQL çº¿ç¨‹è´Ÿè´£è¯»å–å®ƒçš„ relay log é‡Œçš„ä¿¡æ¯å¹¶åº”ç”¨åˆ°ä»åº“æ•°æ®åº“ä¸­</li></ul><p>å®ç°åŸç†å¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/MySQLå¼‚æ­¥å¤åˆ¶.png" alt="MySQLå¼‚æ­¥å¤åˆ¶"></p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹ä¸èƒ½å¿½è§†ï¼š</p><p>åœ¨ä¸»åº“ä¸Šå¹¶è¡Œè¿è¡Œçš„æ›´æ–° SQLï¼Œç”±äºä»åº“åªæœ‰å•ä¸ª SQL çº¿ç¨‹å»æ¶ˆåŒ– relay logï¼Œå› æ­¤æ›´æ–°çš„ SQL åœ¨ä»åº“åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿçš„åŸå› ã€‚</p><p>å½“ç„¶ï¼Œä» 5.6 å¼€å§‹ï¼ŒMySQL æ”¯æŒäº†æ¯ä¸ªåº“å¯ä»¥é…ç½®å•ç‹¬çš„ SQL çº¿ç¨‹æ¥æ¶ˆåŒ– relay logï¼Œåœ¨ 5.7 åˆå¢åŠ äº†åŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶ï¼Œå¤§å¤§æ”¹å–„äº†ä¸»ä»å»¶è¿Ÿçš„é—®é¢˜ã€‚</p><h4 id="1-2-MySQL-åŠåŒæ­¥å¤åˆ¶"><a href="#1-2-MySQL-åŠåŒæ­¥å¤åˆ¶" class="headerlink" title="1.2 MySQL åŠåŒæ­¥å¤åˆ¶"></a>1.2 MySQL åŠåŒæ­¥å¤åˆ¶</h4><p>åœ¨ MySQL å¼‚æ­¥å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œåˆå‡ºç°äº†ä¸€ç§æ”¹è¿›çš„å¤åˆ¶æ–¹å¼ï¼Œç§°ä¸ºï¼šåŠåŒæ­¥å¤åˆ¶ã€‚å…¶åŸç†å¦‚ä¸‹ï¼š</p><ul><li>åœ¨ä¸»åº“å¼€å¯ binlog çš„æƒ…å†µä¸‹</li><li>å¦‚æœä¸»åº“æœ‰å¢åˆ æ”¹çš„è¯­å¥ï¼Œä¼šè®°å½•åˆ° binlog ä¸­</li><li>ä¸»åº“é€šè¿‡ IO çº¿ç¨‹æŠŠ binlog é‡Œé¢çš„å†…å®¹ä¼ ç»™ä»åº“çš„ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰ä¸­</li><li>ä»åº“æ”¶åˆ° binlog åï¼Œå‘é€ç»™ä¸»åº“ä¸€ä¸ª ACKï¼Œè¡¨ç¤ºæ”¶åˆ°äº†</li><li>ä¸»åº“æ”¶åˆ°è¿™ä¸ª ACK ä»¥åï¼Œæ‰èƒ½ç»™å®¢æˆ·ç«¯è¿”å› commit æˆåŠŸ</li><li>ä»åº“çš„ SQL çº¿ç¨‹è´Ÿè´£è¯»å–å®ƒçš„ relay log é‡Œçš„ä¿¡æ¯å¹¶åº”ç”¨åˆ°ä»åº“æ•°æ®åº“ä¸­</li></ul><p>å®ç°åŸç†å¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/ã€Šä¸€çº¿æ•°æ®åº“å·¥ç¨‹å¸ˆå¸¦ä½ æ·±å…¥ç†è§£MySQLã€‹å­¦ä¹ ç¬”è®°/MySQLåŠåŒæ­¥å¤åˆ¶.png" alt="MySQLåŠåŒæ­¥å¤åˆ¶"></p><p>è·Ÿä¼ ç»Ÿçš„å¼‚æ­¥å¤åˆ¶ç›¸æ¯”ï¼ŒåŠåŒæ­¥å¤åˆ¶ä¿è¯äº†æ‰€æœ‰ç»™å®¢æˆ·ç«¯å‘é€è¿‡ç¡®è®¤æäº¤çš„äº‹åŠ¡ï¼Œä»åº“éƒ½å·²ç»æ”¶åˆ°è¿™ä¸ªæ—¥å¿—äº†ã€‚</p><h3 id="2-å¸¸è§çš„è¯»å†™åˆ†ç¦»æ–¹å¼"><a href="#2-å¸¸è§çš„è¯»å†™åˆ†ç¦»æ–¹å¼" class="headerlink" title="2 å¸¸è§çš„è¯»å†™åˆ†ç¦»æ–¹å¼"></a>2 å¸¸è§çš„è¯»å†™åˆ†ç¦»æ–¹å¼</h3><h4 id="2-1ã€é€šè¿‡ç¨‹åº"><a href="#2-1ã€é€šè¿‡ç¨‹åº" class="headerlink" title="2.1ã€é€šè¿‡ç¨‹åº"></a>2.1ã€é€šè¿‡ç¨‹åº</h4><p>å¼€å‘é€šè¿‡é…ç½®ç¨‹åºæ¥å†³å®šä¿®æ”¹æ“ä½œèµ°ä¸»åº“ï¼ŒæŸ¥è¯¢æ“ä½œèµ°ä»åº“ã€‚è¿™ç§æ–¹å¼ç›´è¿æ•°æ®åº“ï¼Œä¼˜ç‚¹æ˜¯æ€§èƒ½ä¼šå¥½ç‚¹ï¼Œç¼ºç‚¹æ˜¯é…ç½®éº»çƒ¦ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä»åº“éœ€è¦è®¾ç½®ä¸º read_onlyï¼Œé˜²æ­¢é…ç½®é”™è¯¯åœ¨ä»åº“å†™å…¥äº†æ•°æ®ã€‚</p><blockquote><p>è¿™é‡Œæé†’ä¸€ç‚¹ï¼š<br>ç¨‹åºè¿æ¥çš„ç”¨æˆ·å»ºè®®ä¸è¦ç»™ super æƒé™ï¼Œå› ä¸º super æƒé™çš„ç”¨æˆ·ï¼Œå³ä½¿æ•´ä¸ªåº“è®¾ç½®äº† read_only ï¼Œä¹Ÿèƒ½å†™å…¥æ•°æ®ã€‚</p></blockquote><h4 id="2-2ã€é€šè¿‡ä¸­é—´ä»¶"><a href="#2-2ã€é€šè¿‡ä¸­é—´ä»¶" class="headerlink" title="2.2ã€é€šè¿‡ä¸­é—´ä»¶"></a>2.2ã€é€šè¿‡ä¸­é—´ä»¶</h4><p>é€šè¿‡ä¸­é—´ä»¶å®ç°è¯»å†™åˆ†ç¦»ï¼Œç›®å‰ç®—æ˜¯ä¸€ç§ä¸»æµçš„æ–¹å¼ã€‚æ‹¿ MyCAT ä¸¾ä¾‹ï¼š</p><p>åœ¨ schema.xml æ–‡ä»¶ä¸­ï¼ŒdataHost æ ‡ç­¾ balance å±æ€§çš„å€¼ï¼Œå†³å®šäº†æ˜¯å¦å¯ç”¨è¯»å†™åˆ†ç¦»ã€‚</p><p>balance å„ä¸ªå€¼åŠå¯¹åº”çš„è¯»å†™æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li>0ï¼šä¸å¼€å¯è¯»å†™åˆ†ç¦»ï¼Œè¯»æ“ä½œå‘é€åˆ° writehost</li><li>1ï¼šå…¨éƒ¨çš„ readhost ä¸ stand by writehost å‚ä¸ select è¯­å¥çš„è´Ÿè½½å‡è¡¡</li><li>2ï¼šæ‰€æœ‰è¯»æ“ä½œéƒ½éšæœºåœ¨ writehostã€readhostä¸Šåˆ†å‘</li><li>3ï¼šæ‰€æœ‰è¯»è¯·æ±‚éšæœºåˆ†å‘åˆ° writerhost å¯¹åº”çš„ readhost æ‰§è¡Œï¼Œwritehost ä¸è´Ÿæ‹…è¯»å‹åŠ›</li></ul><p>å› æ­¤å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä¸Šé¢åˆé€‚çš„è¯»å†™åˆ†ç¦»ç­–ç•¥ã€‚</p><h3 id="3-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿ"><a href="#3-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿ" class="headerlink" title="3 ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿ"></a>3 ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿ</h3><p>åœ¨æœ¬èŠ‚çš„å¼€å§‹ï¼Œæˆ‘ä»¬è¯´åˆ°ï¼Œå¯¹äºè¯»å†™åˆ†ç¦»åœºæ™¯ï¼Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼šä¸»ä»å»¶è¿Ÿã€‚é‚£ä¹ˆåœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿå‘¢ï¼Ÿè¿™é‡Œå¤§è‡´æ€»ç»“ä¸€ä¸‹å¯èƒ½å¯¼è‡´ä¸»ä»å»¶è¿Ÿçš„åœºæ™¯ï¼š</p><ul><li>å¤§è¡¨ DDL</li><li>å¤§äº‹åŠ¡</li><li>ä¸»åº“ DML å¹¶å‘å¤§</li><li>ä»åº“é…ç½®å·®</li><li>è¡¨ä¸Šæ— ä¸»é”®</li><li>ç­‰ç­‰</li></ul><p>å› æ­¤ï¼Œå¦‚æœå­˜åœ¨è¯»å†™åˆ†ç¦»çš„æƒ…å†µï¼Œåº”å°½é‡é¿å…ä¸Šè¯‰æƒ…å†µåœ¨ä¸šåŠ¡é«˜å³°å‡ºç°ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½å®Œå…¨æœç»ä¸»ä»å»¶è¿Ÿã€‚å› æ­¤å†ä»‹ç»å‡ ç§è¯»å†™åˆ†ç¦»åœºæ™¯ä¸‹åº”å¯¹å»¶è¿Ÿçš„æ–¹æ³•ã€‚</p><h3 id="4-è¯»å†™åˆ†ç¦»æ€æ ·åº”å¯¹ä¸»ä»å»¶è¿Ÿ"><a href="#4-è¯»å†™åˆ†ç¦»æ€æ ·åº”å¯¹ä¸»ä»å»¶è¿Ÿ" class="headerlink" title="4 è¯»å†™åˆ†ç¦»æ€æ ·åº”å¯¹ä¸»ä»å»¶è¿Ÿ"></a>4 è¯»å†™åˆ†ç¦»æ€æ ·åº”å¯¹ä¸»ä»å»¶è¿Ÿ</h3><p>è¯»å†™åˆ†ç¦»åœºæ™¯åº”è¯¥æ€æ ·åº”å¯¹ä¸»ä»å»¶è¿Ÿå‘¢ï¼Ÿè¿™é‡Œæ¥è®¨è®ºä¸€ä¸‹å‡ ç§å¸¸è§çš„åº”å¯¹ä¸»ä»å»¶è¿Ÿçš„æ–¹æ³•ï¼š</p><h4 id="4-1-åˆ¤æ–­ä¸»ä»æ˜¯å¦å»¶è¿Ÿ"><a href="#4-1-åˆ¤æ–­ä¸»ä»æ˜¯å¦å»¶è¿Ÿ" class="headerlink" title="4.1 åˆ¤æ–­ä¸»ä»æ˜¯å¦å»¶è¿Ÿ"></a>4.1 åˆ¤æ–­ä¸»ä»æ˜¯å¦å»¶è¿Ÿ</h4><p>æœ‰äº›ä¸šåŠ¡åœºæ™¯ï¼Œå¦‚æœæ‰€æœ‰è¯·æ±‚éƒ½è½åœ¨ä¸»åº“ï¼Œä¸»åº“å‹åŠ›ä¼šå¾ˆå¤§ï¼Œä½†æ˜¯åœ¨è¯»å†™åˆ†ç¦»çš„æƒ…å†µï¼Œåˆä¸å¸Œæœ›ä¸»ä»å­˜åœ¨å»¶è¿Ÿçš„æ—¶å€™å»è¯»å–ä»åº“ã€‚è¿™ç§æƒ…å†µï¼Œå°±å¯ä»¥è€ƒè™‘æŸ¥è¯¢æ—¶ï¼Œå…ˆåˆ¤æ–­ä¸»ä»æ˜¯å¦å­˜åœ¨å»¶è¿Ÿï¼Œå¦‚æœå­˜åœ¨å»¶è¿Ÿï¼Œåˆ™æŸ¥è¯¢è½åœ¨ä¸»åº“ï¼Œå¦‚æœæ²¡å»¶è¿Ÿï¼Œåˆ™æŸ¥è¯¢è¯­å¥è½åœ¨ä»åº“ã€‚</p><p>è¿™é‡Œä»‹ç»å‡ ç§åˆ¤æ–­ä¸»ä»å»¶è¿Ÿçš„æ–¹æ³•ï¼š</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼šåˆ¤æ–­ Seconds_Behind_Master æ˜¯å¦ç­‰äº 0ã€‚</p><p>å¦‚æœ Seconds_Behind_Master =0ï¼Œåˆ™æŸ¥è¯¢ä»åº“ï¼Œå¦‚æœå¤§äº 0ï¼Œåˆ™æŸ¥è¯¢ä¸»åº“ã€‚</p><blockquote><p>è¿™é‡Œè¡¥å……ä¸€ä¸‹ Seconds_Behind_Masterã€‚<br>Seconds_Behind_Master æ˜¯åœ¨ä»åº“ä¸Šæ‰§è¡Œ show slave status æ—¶è¿”å›çš„å…¶ä¸­ä¸€é¡¹ï¼Œè¡¨ç¤ºä»åº“å»¶è¿Ÿçš„ç§’æ•°ã€‚<br>å…¶è®¡ç®—æ–¹æ³•æ˜¯ï¼š<br>ä»åº“æœåŠ¡å™¨å½“å‰çš„æ—¶é—´æˆ³ä¸äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„äº‹ä»¶çš„æ—¶é—´æˆ³ï¼ˆåœ¨ä¸»åº“ä¸Šçš„å†™å…¥æ—¶é—´ï¼‰ç›¸å¯¹æ¯”å¾—åˆ°çš„ã€‚</p></blockquote><p>ä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼ŒSeconds_Behind_Master å¹¶ä¸ä¸€å®šå‡†ç¡®ã€‚æ¯”å¦‚ç½‘ç»œä¸­æ–­æ—¶ï¼ŒSeconds_Behind_Master = 0 ï¼Œå¹¶ä¸èƒ½ä»£è¡¨ä¸»ä»æ— å»¶è¿Ÿã€‚å› æ­¤ï¼Œæœ‰æ¯”è¿™ä¸ªæ›´å‡†ç¡®çš„ä¸€ç§æ–¹æ³•ï¼šå¯¹æ¯”ä½ç‚¹æˆ– GTIDã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼šå¯¹æ¯”ä½ç‚¹æˆ– GTID</p><p>å¦‚æœ Master_Log_File è·Ÿ Relay_Master_Log_File ç›¸ç­‰ï¼Œ</p><p>å¹¶ä¸” Read_Master_Log_Pos è·Ÿ Exec_Master_Log_Pos ç›¸ç­‰ï¼Œ</p><p>åˆ™å¯ä»¥æŠŠè¯»è¯·æ±‚æ”¾åˆ°ä»åº“ï¼Œå¦åˆ™è¯»è¯·æ±‚æ”¾åˆ°ä¸»åº“ã€‚</p><blockquote><p>è¡¥å……ä¸€ä¸‹ä¸Šé¢å‡ ä¸ªå‚æ•°çš„æ„ä¹‰ï¼š<br>å‡ ä¸ªå‚æ•°å‡æ˜¯é€šè¿‡ show slave status è¿”å›çš„å‚æ•°ï¼Œç”¨æ¥æŸ¥è¯¢ä¸»ä»å¤åˆ¶çš„çŠ¶æ€ã€‚<br>Master_Log_Fileï¼šIO çº¿ç¨‹æ­£åœ¨è¯»å–çš„ä¸»åº“ binlog æ–‡ä»¶å<br>Relay_Master_Log_Fileï¼šSQL çº¿ç¨‹æœ€è¿‘æ‰§è¡Œçš„äº‹åŠ¡å¯¹åº”çš„ä¸»åº“ binlog æ–‡ä»¶å<br>Read_Master_Log_Pos ï¼šIO çº¿ç¨‹æ­£åœ¨è¯»å–çš„ä¸»åº“ binlog æ–‡ä»¶ä¸­çš„ä½ç‚¹<br>Exec_Master_Log_Pos ï¼šSQL çº¿ç¨‹æœ€è¿‘è¯»å–å’Œæ‰§è¡Œçš„äº‹åŠ¡å¯¹åº”çš„ä¸»åº“ binlog æ–‡ä»¶ä¸­çš„ä½ç‚¹</p></blockquote><p>å¦‚æœå¼€å¯äº† GTID å¤åˆ¶ï¼Œåˆ™å¯ä»¥å¯¹æ¯” Retrieved_Gtid_Set å’Œ Executed_Gtid_Set æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™æŠŠè¯»è¯·æ±‚æ”¾åˆ°ä»åº“ï¼Œæœ‰å·®å¼‚åˆ™è¯»è¯·æ±‚æ”¾åˆ°ä¸»åº“ã€‚</p><blockquote><p>åŒæ ·è¡¥å……ä¸‹ä¸¤ä¸ªå‚æ•°çš„æ„ä¹‰ï¼š<br>å‰ææ˜¯éœ€è¦å¼€å¯ GTID ä¸¤ä¸ªå‚æ•°æ‰ä¼šæœ‰å€¼ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š<br>Retrieved_Gtid_Setï¼šä»åº“æ”¶åˆ°çš„æ‰€æœ‰æ—¥å¿—çš„ GTID é›†åˆ<br>Executed_Gtid_Setï¼šä»åº“å·²ç»æ‰§è¡Œå®Œçš„ GTID é›†åˆ</p></blockquote><h4 id="4-2-é‡‡ç”¨åŠåŒæ­¥å¤åˆ¶"><a href="#4-2-é‡‡ç”¨åŠåŒæ­¥å¤åˆ¶" class="headerlink" title="4.2 é‡‡ç”¨åŠåŒæ­¥å¤åˆ¶"></a>4.2 é‡‡ç”¨åŠåŒæ­¥å¤åˆ¶</h4><p>åœ¨æœ¬èŠ‚çš„å‰é¢ï¼Œæˆ‘ä»¬è®²è§£äº†åŠåŒæ­¥å¤åˆ¶çš„åŸç†ï¼Œè·Ÿä¼ ç»Ÿçš„å¼‚æ­¥å¤åˆ¶ç›¸æ¯”ï¼ŒåŠåŒæ­¥å¤åˆ¶ä¿è¯äº†æ‰€æœ‰ç»™å®¢æˆ·ç«¯å‘é€è¿‡ç¡®è®¤æäº¤çš„äº‹åŠ¡ï¼Œä»åº“éƒ½å·²ç»æ”¶åˆ°è¿™ä¸ªæ—¥å¿—äº†ã€‚å› æ­¤å‡ºç°å»¶è¿Ÿçš„æ¦‚ç‡ä¼šå°å¾ˆå¤šï¼Œå½“ç„¶å®é™…ç”Ÿäº§åº”ç”¨æ—¶ï¼Œå»ºè®®ç»“åˆä¸Šé¢è®²çš„ä½ç‚¹æˆ– GTID åˆ¤æ–­ã€‚</p><h4 id="4-3-ç­‰å¾…åŒæ­¥å®Œæˆ"><a href="#4-3-ç­‰å¾…åŒæ­¥å®Œæˆ" class="headerlink" title="4.3 ç­‰å¾…åŒæ­¥å®Œæˆ"></a>4.3 ç­‰å¾…åŒæ­¥å®Œæˆ</h4><p>ä¾ç„¶é‡‡ç”¨ 4.1 ä¸­ä»‹ç»çš„å‡ ç§åˆ¤æ–­æ˜¯å¦æœ‰å»¶è¿Ÿçš„æ–¹æ³•ï¼Œåªæ˜¯åº”å¯¹æ–¹å¼ä¸ä¸€æ ·ï¼Œæ¯”å¦‚å­˜åœ¨å»¶è¿Ÿï¼Œåˆ™å°†æƒ…å†µåé¦ˆç»™ç¨‹åºï¼Œåœ¨å‰ç«¯é¡µé¢æé†’ç”¨æˆ·æ•°æ®æœªå®Œå…¨åŒæ­¥ï¼Œå¦‚æœæ²¡æœ‰å»¶è¿Ÿï¼Œåˆ™æŸ¥è¯¢ä»åº“ã€‚</p><p>æœ‰äººå¯èƒ½ä¼šè§‰å¾—ï¼šè¿™ç§æ–¹å¼è°ä¼šç”¨å•Šï¼Ÿå®é™…å¯ä»¥åº”ç”¨åœ¨å†…éƒ¨äººå‘˜çœ‹çš„æŠ¥è¡¨ä¸šåŠ¡ä¸Šã€‚å› ä¸ºæŠ¥è¡¨å¯èƒ½æ¶‰åŠçš„ SQL éƒ½æ¯”è¾ƒå¤æ‚ï¼Œå­˜åœ¨å»¶è¿Ÿå°±è€ƒè™‘å»æŸ¥è¯¢ä¸»åº“ï¼Œå¯èƒ½ä¼šå¯¹å…¶å®ƒçº¿ä¸Šä¸šåŠ¡æœ‰å½±å“ï¼Œå› æ­¤å¯ä»¥ç­‰å¾…ä»åº“åŒæ­¥å®Œæˆï¼Œå†æŸ¥è¯¢ä»åº“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èŒä¸šè§„åˆ’ </tag>
            
            <tag> æ…•è¯¾ä¸“æ  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠMySQLå¿…çŸ¥å¿…ä¼šã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="mysql-bi-zhi-bi-hui-du-shu-bi-ji/"/>
      <url>mysql-bi-zhi-bi-hui-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬1ç« -äº†è§£SQL"><a href="#ç¬¬1ç« -äº†è§£SQL" class="headerlink" title="ç¬¬1ç«  äº†è§£SQL"></a>ç¬¬1ç«  äº†è§£SQL</h2><ol><li><p><strong>æ•°æ®åº“ï¼ˆdatabaseï¼‰</strong> ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ç»„æ–‡ä»¶ï¼‰ã€‚</p></li><li><p><strong>è¡¨ï¼ˆtableï¼‰</strong> æŸç§ç‰¹å®šç±»å‹æ•°æ®çš„ç»“æ„åŒ–æ¸…å•ã€‚</p></li><li><p><strong>æ¨¡å¼ï¼ˆschemaï¼‰</strong> å…³äºæ•°æ®åº“å’Œè¡¨çš„å¸ƒå±€åŠç‰¹æ€§çš„ä¿¡æ¯ã€‚</p></li><li><p><strong>åˆ—ï¼ˆcolumnï¼‰</strong> è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚æ‰€æœ‰è¡¨éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ç»„æˆçš„ã€‚</p></li><li><p><strong>æ•°æ®ç±»å‹ï¼ˆdatatypeï¼‰</strong> æ‰€å®¹è®¸çš„æ•°æ®çš„ç±»å‹ã€‚æ¯ä¸ªè¡¨åˆ—éƒ½æœ‰ç›¸åº”çš„æ•°æ®ç±»å‹ï¼Œå®ƒé™åˆ¶ï¼ˆæˆ–å®¹è®¸ï¼‰è¯¥åˆ—ä¸­å­˜å‚¨çš„æ•°æ®ã€‚</p></li><li><p><strong>è¡Œï¼ˆrowï¼‰</strong> è¡¨ä¸­çš„ä¸€ä¸ªè®°å½•ã€‚</p></li><li><p><strong>ä¸»é”®ï¼ˆprimary keyï¼‰</strong> ä¸€åˆ—ï¼ˆæˆ–ä¸€ç»„åˆ—ï¼‰ï¼Œå…¶å€¼èƒ½å¤Ÿå”¯ä¸€åŒºåˆ†è¡¨ä¸­æ¯ä¸ªè¡Œã€‚</p><p> è¡¨ä¸­çš„ä»»ä½•åˆ—éƒ½å¯ä»¥ä½œä¸ºä¸»é”®ï¼Œåªè¦å®ƒæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><blockquote><ol><li>ä»»æ„ä¸¤è¡Œéƒ½ä¸å…·æœ‰ç›¸åŒçš„ä¸»é”®å€¼ï¼›</li><li>æ¯ä¸ªè¡Œéƒ½å¿…é¡»å…·æœ‰ä¸€ä¸ªä¸»é”®å€¼ï¼ˆä¸»é”®åˆ—ä¸å…è®¸NULLå€¼ï¼‰ã€‚</li></ol></blockquote><p> ä¸»é”®çš„æœ€å¥½ä¹ æƒ¯ï¼š</p><blockquote><ol><li>ä¸æ›´æ–°ä¸»é”®åˆ—ä¸­çš„å€¼ï¼›</li><li>ä¸é‡ç”¨ä¸»é”®åˆ—çš„å€¼ï¼›</li><li>ä¸åœ¨ä¸»é”®åˆ—ä¸­ä½¿ç”¨å¯èƒ½ä¼šæ›´æ”¹çš„å€¼ã€‚</li></ol></blockquote></li></ol><h2 id="ç¬¬2ç« -MySQLç®€ä»‹"><a href="#ç¬¬2ç« -MySQLç®€ä»‹" class="headerlink" title="ç¬¬2ç«  MySQLç®€ä»‹"></a>ç¬¬2ç«  MySQLç®€ä»‹</h2><ol><li>DBMSï¼ˆæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰åˆ†ä¸¤ç±»ï¼š<ol><li>åŸºäºå…±äº«æ–‡ä»¶ç³»ç»Ÿçš„DBMSï¼Œå¦‚Microsoft Accesså’ŒFileMakerï¼›</li><li>åŸºäºå®¢æˆ·æœºâ€”æœåŠ¡å™¨çš„DBMSï¼Œå¦‚MySQLã€Oracleä»¥åŠMicrosoft SQL Serverã€‚</li></ol></li></ol><h2 id="ç¬¬3ç« -ä½¿ç”¨MySQL"><a href="#ç¬¬3ç« -ä½¿ç”¨MySQL" class="headerlink" title="ç¬¬3ç«  ä½¿ç”¨MySQL"></a>ç¬¬3ç«  ä½¿ç”¨MySQL</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“ */</span><span class="token keyword">USE</span> mysql<span class="token punctuation">;</span> <span class="token comment">/* é€‰æ‹©æ•°æ®åº“mysql */</span><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºæ‰€æœ‰è¡¨ */</span><span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºuserè¡¨ä¸­çš„åˆ—ä¿¡æ¯ */</span><span class="token keyword">DESCRIBE</span> <span class="token keyword">user</span><span class="token punctuation">;</span> <span class="token comment">/* åŒä¸Š */</span><span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span><span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ */</span><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mysql<span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºåˆ›å»ºæ•°æ®åº“mysqlçš„SQLè¯­å¥ */</span><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">user</span><span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºåˆ›å»ºè¡¨userçš„SQLè¯­å¥ */</span><span class="token keyword">show</span> grants<span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºç”¨æˆ·çš„æˆæƒä¿¡æ¯ */</span><span class="token keyword">SHOW</span> <span class="token keyword">ERRORS</span><span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºæœåŠ¡å™¨ä¸­çš„é”™è¯¯ä¿¡æ¯ */</span><span class="token keyword">SHOW</span> <span class="token keyword">WARNINGS</span><span class="token punctuation">;</span> <span class="token comment">/* æ˜¾ç¤ºæœåŠ¡å™¨ä¸­çš„è­¦å‘Šä¿¡æ¯ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥ä½¿ç”¨<code>help show</code> æ¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ã€‚</p></blockquote><h2 id="ç¬¬4ç« -æ£€ç´¢æ•°æ®"><a href="#ç¬¬4ç« -æ£€ç´¢æ•°æ®" class="headerlink" title="ç¬¬4ç«  æ£€ç´¢æ•°æ®"></a>ç¬¬4ç«  æ£€ç´¢æ•°æ®</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">.</span><span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span> <span class="token comment">/* åŒä¸Š */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span> <span class="token comment">/* åŒä¸Š */</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span><span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span> <span class="token comment">/* å»é™¤é‡å¤ */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">LIMIT</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">/* åªæ˜¾ç¤ºæŸ¥è¯¢ç»“æœçš„å‰3æ¡è®°å½• */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">/* åªæ˜¾ç¤ºæŸ¥è¯¢ç»“æœçš„ç¬¬2æ¡å¼€å§‹ï¼ˆä¸‹æ ‡ä»0å¼€å§‹ï¼‰åé¢çš„3æ¡è®°å½• */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">LIMIT</span> <span class="token number">3</span> <span class="token keyword">OFFSET</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">/* åŒä¸Š */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>SQLä¸åŒºåˆ†å¤§å°å†™ï¼Œä¹Ÿå¿½ç•¥ç©ºæ ¼ã€‚</p><p>DISTINCTå…³é”®å­—åº”ç”¨äºæ‰€æœ‰åˆ—è€Œä¸ä»…æ˜¯å‰ç½®å®ƒçš„åˆ—ã€‚</p></blockquote><h2 id="ç¬¬5ç« -æ’åºæ£€ç´¢æ•°æ®"><a href="#ç¬¬5ç« -æ’åºæ£€ç´¢æ•°æ®" class="headerlink" title="ç¬¬5ç«  æ’åºæ£€ç´¢æ•°æ®"></a>ç¬¬5ç«  æ’åºæ£€ç´¢æ•°æ®</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">User</span><span class="token punctuation">;</span> <span class="token comment">/* å‡åºæ’åº */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">User</span> <span class="token keyword">ASC</span><span class="token punctuation">;</span> <span class="token comment">/* åŒä¸Š */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">User</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span> <span class="token comment">/* é™åºæ’åº */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">User</span><span class="token punctuation">,</span> Host<span class="token punctuation">;</span> <span class="token comment">/* å…ˆæŒ‰Userå‡åºæ’åºï¼Œå†æŒ‰Hostå‡åºæ’åº */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">User</span> <span class="token keyword">DESC</span><span class="token punctuation">,</span> Host<span class="token punctuation">;</span> <span class="token comment">/* å…ˆæŒ‰Useré™åºæ’åºï¼Œå†æŒ‰Hostå‡åºæ’åº */</span><span class="token keyword">SELECT</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">User</span> <span class="token keyword">DESC</span><span class="token punctuation">,</span> Host <span class="token keyword">ASC</span><span class="token punctuation">;</span> <span class="token comment">/* åŒä¸Š */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>DESCå…³é”®å­—åªåº”ç”¨åˆ°ç›´æ¥ä½äºå…¶å‰é¢çš„åˆ—åã€‚</p></blockquote><h2 id="ç¬¬6ç« -è¿‡æ»¤æ•°æ®"><a href="#ç¬¬6ç« -è¿‡æ»¤æ•°æ®" class="headerlink" title="ç¬¬6ç«  è¿‡æ»¤æ•°æ®"></a>ç¬¬6ç«  è¿‡æ»¤æ•°æ®</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">User</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">&lt;&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/* åŒä¸Š */</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> max_connections <span class="token operator">BETWEEN</span> <span class="token number">0</span> <span class="token operator">AND</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span><span class="token punctuation">,</span> max_connections <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> ssl_cipher <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span> <span class="token comment">/* ssl_cipherå­—æ®µä¸ºNULL */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬7ç« -æ•°æ®è¿‡æ»¤"><a href="#ç¬¬7ç« -æ•°æ®è¿‡æ»¤" class="headerlink" title="ç¬¬7ç«  æ•°æ®è¿‡æ»¤"></a>ç¬¬7ç«  æ•°æ®è¿‡æ»¤</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> Host<span class="token operator">=</span><span class="token string">'localhost'</span> <span class="token operator">AND</span> <span class="token keyword">User</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> Host<span class="token operator">=</span><span class="token string">'localhost'</span> <span class="token operator">OR</span> <span class="token keyword">User</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>Host<span class="token operator">=</span><span class="token string">'localhost'</span> <span class="token operator">OR</span> <span class="token keyword">User</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">)</span> <span class="token operator">AND</span> max_connections <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> Host <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> Host <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ANDçš„ä¼˜å…ˆçº§æ¯”ORé«˜ã€‚</p><p>INæ“ä½œç¬¦å®Œæˆä¸ORç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ›´å¿«ã€‚</p></blockquote><h2 id="ç¬¬8ç« -ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤"><a href="#ç¬¬8ç« -ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤" class="headerlink" title="ç¬¬8ç«  ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤"></a>ç¬¬8ç«  ç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> Host <span class="token operator">LIKE</span> <span class="token string">'local%'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">User</span> <span class="token operator">LIKE</span> <span class="token string">'r__t'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>ç™¾åˆ†å·ï¼ˆ%ï¼‰è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°ã€‚%ä¸èƒ½åŒ¹é…NULLå€¼ã€‚</p><p>ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰åªåŒ¹é…å•ä¸ªå­—ç¬¦ã€‚</p></blockquote><h2 id="ç¬¬9ç« -ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢"><a href="#ç¬¬9ç« -ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢" class="headerlink" title="ç¬¬9ç«  ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢"></a>ç¬¬9ç«  ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">User</span> <span class="token operator">REGEXP</span> <span class="token string">'r..t'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> Host <span class="token operator">REGEXP</span> <span class="token string">'%|localhost'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">User</span> <span class="token operator">REGEXP</span> <span class="token string">'r[a-z]{2}t'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> Host<span class="token punctuation">,</span> <span class="token keyword">User</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">User</span> <span class="token operator">REGEXP</span> <span class="token string">'mysql\\.sys'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥ä½¿ç”¨ç±»ä¼¼<code>SELECT 'hello' REGEXP '[0-9]'</code>è¿™æ ·çš„SQLæ¥æµ‹è¯•æ­£å¸¸è¡¨è¾¾å¼ï¼ŒåŒ¹é…æˆåŠŸè¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p></blockquote><h2 id="ç¬¬10ç« -åˆ›å»ºè®¡ç®—å­—æ®µ"><a href="#ç¬¬10ç« -åˆ›å»ºè®¡ç®—å­—æ®µ" class="headerlink" title="ç¬¬10ç«  åˆ›å»ºè®¡ç®—å­—æ®µ"></a>ç¬¬10ç«  åˆ›å»ºè®¡ç®—å­—æ®µ</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token keyword">User</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> Host<span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token keyword">User</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> Host<span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> UserHost <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬11ç« -ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°"><a href="#ç¬¬11ç« -ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°" class="headerlink" title="ç¬¬11ç«  ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°"></a>ç¬¬11ç«  ä½¿ç”¨æ•°æ®å¤„ç†å‡½æ•°</h2><div class="table-container"><table><thead><tr><th><strong>å‡½æ•°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>Left()</td><td>è¿”å›ä¸²å·¦è¾¹çš„å­—ç¬¦</td></tr><tr><td>Length()</td><td>è¿”å›ä¸²çš„é•¿åº¦</td></tr><tr><td>Locate()</td><td>æ‰¾å‡ºä¸²çš„ä¸€ä¸ªå­ä¸²</td></tr><tr><td>Lower()</td><td>å°†ä¸²è½¬æ¢ä¸ºå°å†™</td></tr><tr><td>LTrim()</td><td>å»æ‰ä¸²å·¦è¾¹çš„ç©ºæ ¼è¿”</td></tr><tr><td>Right()</td><td>è¿”å›ä¸²å³è¾¹çš„å­—ç¬¦</td></tr><tr><td>RTrim()</td><td>å»æ‰ä¸²å³è¾¹çš„ç©ºæ ¼</td></tr><tr><td>Soundex()</td><td>è¿”å›ä¸²çš„SOUNDEXå€¼</td></tr><tr><td>SubString()</td><td>è¿”å›å­ä¸²çš„å­—ç¬¦</td></tr><tr><td>Upper()</td><td>å°†ä¸²è½¬æ¢ä¸ºå¤§å†™</td></tr><tr><td>AddDate()</td><td>å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰</td></tr><tr><td>AddTime()</td><td>å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰</td></tr><tr><td>CurDate()</td><td>è¿”å›å½“å‰æ—¥æœŸ</td></tr><tr><td>CurTime()</td><td>è¿”å›å½“å‰æ—¶é—´</td></tr><tr><td>Date()</td><td>è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ†</td></tr><tr><td>DateDiff()</td><td>è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·®</td></tr><tr><td>Date_Add()</td><td>é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•°</td></tr><tr><td>Date_Format()</td><td>è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸²</td></tr><tr><td>Day()</td><td>è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ†</td></tr><tr><td>DayOfWeek()</td><td>å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡ </td></tr><tr><td>Hour()</td><td>è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ†</td></tr><tr><td>Minute()</td><td>è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ†</td></tr><tr><td>Month()</td><td>è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ†</td></tr><tr><td>Now()</td><td>è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>Second()</td><td>è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ†</td></tr><tr><td>Time()</td><td>è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ†</td></tr><tr><td>Year()</td><td>è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ†</td></tr><tr><td>Abs()</td><td>è¿”å›ä¸€ä¸ªæ•°çš„ç»å¯¹å€¼</td></tr><tr><td>Cos()</td><td>è¿”å›ä¸€ä¸ªè§’åº¦çš„ä½™å¼¦</td></tr><tr><td>Exp()</td><td>è¿”å›ä¸€ä¸ªæ•°çš„æŒ‡æ•°å€¼</td></tr><tr><td>Mod()</td><td>è¿”å›é™¤æ“ä½œçš„ä½™æ•°</td></tr><tr><td>Pi()</td><td>è¿”å›åœ†å‘¨ç‡</td></tr><tr><td>Rand()</td><td>è¿”å›ä¸€ä¸ªéšæœºæ•°</td></tr><tr><td>Sin()</td><td>è¿”å›ä¸€ä¸ªè§’åº¦çš„æ­£å¼¦</td></tr><tr><td>Sqrt()</td><td>è¿”å›ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹</td></tr><tr><td>Tan()</td><td>è¿”å›ä¸€ä¸ªè§’åº¦çš„æ­£åˆ‡</td></tr></tbody></table></div><blockquote><p>ä¸ç®¡æ˜¯æ’å…¥æˆ–æ›´æ–°è¡¨å€¼è¿˜æ˜¯ç”¨WHEREå­å¥è¿›è¡Œè¿‡æ»¤ï¼Œæ—¥æœŸå¿…é¡»ä¸ºæ ¼å¼yyyy-mm-ddã€‚å¹¶ä¸”æ€»æ˜¯åº”è¯¥ä½¿ç”¨4ä½æ•°å­—çš„å¹´ä»½ã€‚</p></blockquote><h2 id="ç¬¬12ç« -æ±‡æ€»æ•°æ®"><a href="#ç¬¬12ç« -æ±‡æ€»æ•°æ®" class="headerlink" title="ç¬¬12ç«  æ±‡æ€»æ•°æ®"></a>ç¬¬12ç«  æ±‡æ€»æ•°æ®</h2><ol><li><p><strong>èšé›†å‡½æ•°ï¼ˆaggregate functionï¼‰</strong> è¿è¡Œåœ¨è¡Œç»„ä¸Šï¼Œè®¡ç®—å’Œè¿”å›å•ä¸ªå€¼çš„å‡½æ•°ã€‚</p></li><li><p><strong>AVG()å‡½æ•°</strong> è®¡ç®—å•åˆ—çš„å¹³å‡å€¼ã€‚</p><blockquote><p>AVG()å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è¡Œã€‚</p></blockquote></li><li><p><strong>COUNT()å‡½æ•°</strong> è¿›è¡Œè®¡æ•°ã€‚</p><blockquote><p>ä½¿ç”¨COUNT(*)å¯¹è¡¨ä¸­è¡Œçš„æ•°ç›®è¿›è¡Œè®¡æ•°ï¼Œä¸ç®¡è¡¨åˆ—ä¸­åŒ…å«çš„æ˜¯ç©ºå€¼ï¼ˆNULLï¼‰è¿˜æ˜¯éç©ºå€¼ã€‚</p><p>ä½¿ç”¨COUNT(column)å¯¹ç‰¹å®šåˆ—ä¸­å…·æœ‰å€¼çš„è¡Œè¿›è¡Œè®¡æ•°ï¼Œå¿½ç•¥NULLå€¼ã€‚</p></blockquote></li><li><p><strong>MAX()å‡½æ•°</strong> è¿”å›æŒ‡å®šåˆ—ä¸­çš„æœ€å¤§å€¼ã€‚</p><blockquote><p>MAX()å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è¡Œã€‚</p></blockquote></li><li><p><strong>MAX()å‡½æ•°</strong> è¿”å›æŒ‡å®šåˆ—ä¸­çš„æœ€å°å€¼ã€‚</p><blockquote><p>MIN()å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è¡Œã€‚</p></blockquote></li><li><p><strong>SUM()å‡½æ•°</strong> ç”¨æ¥è¿”å›æŒ‡å®šåˆ—å€¼çš„å’Œï¼ˆæ€»è®¡ï¼‰ã€‚</p><blockquote><p>SUM()å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è¡Œã€‚</p></blockquote></li><li><p>ä»¥ä¸Š5ä¸ªèšé›†å‡½æ•°éƒ½å¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š</p><ol><li>å¯¹æ‰€æœ‰çš„è¡Œæ‰§è¡Œè®¡ç®—ï¼ŒæŒ‡å®šALLå‚æ•°æˆ–ä¸ç»™å‚æ•°ï¼ˆå› ä¸ºALLæ˜¯é»˜è®¤è¡Œä¸ºï¼‰ï¼›</li><li><p>åªåŒ…å«ä¸åŒçš„å€¼ï¼ŒæŒ‡å®šDISTINCTå‚æ•°ã€‚</p><blockquote><p>å¦‚æœæŒ‡å®šåˆ—åï¼Œåˆ™DISTINCTåªèƒ½ç”¨äºCOUNT()ã€‚DISTINCTä¸èƒ½ç”¨äºCOUNT(*)ï¼Œå› æ­¤ä¸å…è®¸ä½¿ç”¨COUNTï¼ˆDISTINCTï¼‰ï¼Œå¦åˆ™ä¼šäº§ç”Ÿé”™è¯¯ã€‚ç±»ä¼¼åœ°ï¼ŒDISTINCTå¿…é¡»ä½¿ç”¨åˆ—åï¼Œä¸èƒ½ç”¨äºè®¡ç®—æˆ–è¡¨è¾¾å¼ã€‚</p><p><strong>å°†DISTINCTç”¨äºMIN()å’ŒMAX()</strong> ã€‚è™½ç„¶DISTINCTä»æŠ€æœ¯ä¸Šå¯ç”¨äºMIN()å’ŒMAX()ï¼Œä½†è¿™æ ·åšå®é™…ä¸Šæ²¡æœ‰ä»·å€¼ã€‚ä¸€ä¸ªåˆ—ä¸­çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ä¸ç®¡æ˜¯å¦åŒ…å«ä¸åŒå€¼éƒ½æ˜¯ç›¸åŒçš„ã€‚</p></blockquote></li></ol></li></ol><h2 id="ç¬¬13ç« -åˆ†ç»„æ•°æ®"><a href="#ç¬¬13ç« -åˆ†ç»„æ•°æ®" class="headerlink" title="ç¬¬13ç«  åˆ†ç»„æ•°æ®"></a>ç¬¬13ç«  åˆ†ç»„æ•°æ®</h2><ol><li><p>ä½¿ç”¨GROUP BYåˆ›å»ºåˆ†ç»„æ—¶éœ€è¦æ³¨æ„ï¼š</p><ol><li>GROUP BYå­å¥å¯ä»¥åŒ…å«ä»»æ„æ•°ç›®çš„åˆ—ã€‚è¿™ä½¿å¾—èƒ½å¯¹åˆ†ç»„è¿›è¡ŒåµŒå¥—ï¼Œä¸ºæ•°æ®åˆ†ç»„æä¾›æ›´ç»†è‡´çš„æ§åˆ¶ã€‚</li><li>å¦‚æœåœ¨GROUP BYå­å¥ä¸­åµŒå¥—äº†åˆ†ç»„ï¼Œæ•°æ®å°†åœ¨æœ€åè§„å®šçš„åˆ†ç»„ä¸Šè¿›è¡Œæ±‡æ€»ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å»ºç«‹åˆ†ç»„æ—¶ï¼ŒæŒ‡å®šçš„æ‰€æœ‰åˆ—éƒ½ä¸€èµ·è®¡ç®—ï¼ˆæ‰€ä»¥ä¸èƒ½ä»ä¸ªåˆ«çš„åˆ—å–å›æ•°æ®ï¼‰ã€‚</li><li>GROUP BYå­å¥ä¸­åˆ—å‡ºçš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»æ˜¯æ£€ç´¢åˆ—æˆ–æœ‰æ•ˆçš„è¡¨è¾¾å¼ï¼ˆä½†ä¸èƒ½æ˜¯èšé›†å‡½æ•°ï¼‰ã€‚å¦‚æœåœ¨SELECTä¸­ä½¿ç”¨è¡¨è¾¾å¼ï¼Œåˆ™å¿…é¡»åœ¨GROUP BYå­å¥ä¸­æŒ‡å®šç›¸åŒçš„è¡¨è¾¾å¼ã€‚ä¸èƒ½ä½¿ç”¨åˆ«åã€‚</li><li>é™¤èšé›†è®¡ç®—è¯­å¥å¤–ï¼ŒSELECTè¯­å¥ä¸­çš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»åœ¨GROUP BYå­å¥ä¸­ç»™å‡ºã€‚</li><li>å¦‚æœåˆ†ç»„åˆ—ä¸­å…·æœ‰NULLå€¼ï¼Œåˆ™NULLå°†ä½œä¸ºä¸€ä¸ªåˆ†ç»„è¿”å›ã€‚å¦‚æœåˆ—ä¸­æœ‰å¤šè¡ŒNULLå€¼ï¼Œå®ƒä»¬å°†åˆ†ä¸ºä¸€ç»„ã€‚</li><li><p>GROUP BYå­å¥å¿…é¡»å‡ºç°åœ¨WHEREå­å¥ä¹‹åï¼ŒORDER BYå­å¥ä¹‹å‰ã€‚</p><blockquote><p>ä½¿ç”¨WITH ROLLUPå…³é”®å­—ï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªåˆ†ç»„ä»¥åŠæ¯ä¸ªåˆ†ç»„æ±‡æ€»çº§åˆ«ï¼ˆé’ˆå¯¹æ¯ä¸ªåˆ†ç»„ï¼‰çš„å€¼ã€‚</p></blockquote></li></ol></li><li><p>åˆ†ç»„è¿‡æ»¤æ“ä½œHAVINGæ”¯æŒæ‰€æœ‰WHEREæ“ä½œç¬¦ã€‚</p><blockquote><p>WHEREåœ¨æ•°æ®åˆ†ç»„å‰è¿›è¡Œè¿‡æ»¤ï¼ŒHAVINGåœ¨æ•°æ®åˆ†ç»„åè¿›è¡Œè¿‡æ»¤ã€‚</p></blockquote></li><li><p>ä¸€èˆ¬åœ¨ä½¿ç”¨GROUP BYå­å¥æ—¶ï¼Œåº”è¯¥ä¹Ÿç»™å‡ºORDER BYå­å¥ã€‚è¿™æ˜¯ä¿è¯æ•°æ®æ­£ç¡®æ’åºçš„å”¯ä¸€æ–¹æ³•ã€‚</p></li><li><p>SELECTå­å¥é¡ºåº</p></li></ol><div class="table-container"><table><thead><tr><th><strong>å­å¥</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>æ˜¯å¦å¿…é¡»ä½¿ç”¨</strong></th></tr></thead><tbody><tr><td>SELECT</td><td>è¦è¿”å›çš„åˆ—æˆ–è¡¨è¾¾å¼</td><td>æ˜¯</td></tr><tr><td>FROM</td><td>ä»ä¸­æ£€ç´¢æ•°æ®çš„è¡¨</td><td>ä»…åœ¨ä»è¡¨é€‰æ‹©æ•°æ®æ—¶ä½¿ç”¨</td></tr><tr><td>WHERE</td><td>è¡Œçº§è¿‡æ»¤</td><td>å¦</td></tr><tr><td>GROUP BY</td><td>åˆ†ç»„è¯´æ˜</td><td>ä»…åœ¨æŒ‰ç»„è®¡ç®—èšé›†æ—¶ä½¿ç”¨</td></tr><tr><td>HAVING</td><td>ç»„çº§è¿‡æ»¤</td><td>å¦</td></tr><tr><td>ORDER BY</td><td>è¾“å‡ºæ’åºé¡ºåº</td><td>å¦</td></tr><tr><td>LIMIT</td><td>è¦æ£€ç´¢çš„è¡Œæ•°</td><td>å¦</td></tr></tbody></table></div><h2 id="ç¬¬14ç« -ä½¿ç”¨å­æŸ¥è¯¢"><a href="#ç¬¬14ç« -ä½¿ç”¨å­æŸ¥è¯¢" class="headerlink" title="ç¬¬14ç«  ä½¿ç”¨å­æŸ¥è¯¢"></a>ç¬¬14ç«  ä½¿ç”¨å­æŸ¥è¯¢</h2><ol><li><p>å­æŸ¥è¯¢å°±æ˜¯å¯ä»¥æŠŠä¸€æ¡SELECTè¯­å¥è¿”å›çš„ç»“æœç”¨äºå¦ä¸€æ¡SELECTè¯­å¥çš„WHEREå­å¥ã€‚</p></li><li><p>åœ¨WHEREå­å¥ä¸­ä½¿ç”¨å­æŸ¥è¯¢ï¼Œåº”è¯¥ä¿è¯SELECTè¯­å¥å…·æœ‰ä¸WHEREå­å¥ä¸­ç›¸åŒæ•°ç›®çš„åˆ—ã€‚é€šå¸¸ï¼Œå­æŸ¥è¯¢å°†è¿”å›å•ä¸ªåˆ—å¹¶ä¸”ä¸å•ä¸ªåˆ—åŒ¹é…ï¼Œä½†å¦‚æœéœ€è¦ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªåˆ—ã€‚</p></li></ol><h2 id="ç¬¬15ç« -è¿ç»“è¡¨"><a href="#ç¬¬15ç« -è¿ç»“è¡¨" class="headerlink" title="ç¬¬15ç«  è¿ç»“è¡¨"></a>ç¬¬15ç«  è¿ç»“è¡¨</h2><ol><li><p><strong>å¤–é”®ï¼ˆforeign keyï¼‰</strong> ä¸ºæŸä¸ªè¡¨ä¸­çš„ä¸€åˆ—ï¼Œå®ƒåŒ…å«å¦ä¸€ä¸ªè¡¨çš„ä¸»é”®å€¼ï¼Œå®šä¹‰äº†ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»ã€‚</p></li><li><p>ç”±æ²¡æœ‰è”ç»“æ¡ä»¶çš„è¡¨å…³ç³»è¿”å›çš„ç»“æœä¸º <strong>ç¬›å¡å„¿ç§¯ï¼ˆcartesian productï¼‰</strong> ã€‚å¦‚ä¸‹ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price<span class="token keyword">FROM</span> vendors<span class="token punctuation">,</span> products<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>æœ‰æ—¶æˆ‘ä»¬ä¼šå¬åˆ°è¿”å›ç§°ä¸º <strong>å‰è”ç»“ï¼ˆcross joinï¼‰</strong> çš„ç¬›å¡å„¿ç§¯çš„è”ç»“ç±»å‹ã€‚</p></blockquote></li><li><p><strong>ç­‰å€¼è”ç»“ï¼ˆequijoinï¼‰</strong> åŸºäºä¸¤ä¸ªè¡¨ä¹‹é—´çš„ç›¸ç­‰æµ‹è¯•ã€‚è¿™ç§è”ç»“ä¹Ÿç§°ä¸º <strong>å†…éƒ¨è”ç»“</strong> ã€‚ä¸‹é¢çš„SQLéƒ½æ˜¯ç­‰å€¼è”ç»“ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price<span class="token keyword">FROM</span> vendors<span class="token punctuation">,</span> products<span class="token keyword">WHERE</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span><span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price<span class="token keyword">FROM</span> vendors<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> products<span class="token keyword">ON</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬16ç« -åˆ›å»ºé«˜çº§è”ç»“"><a href="#ç¬¬16ç« -åˆ›å»ºé«˜çº§è”ç»“" class="headerlink" title="ç¬¬16ç«  åˆ›å»ºé«˜çº§è”ç»“"></a>ç¬¬16ç«  åˆ›å»ºé«˜çº§è”ç»“</h2><ol><li><p>è¡¨åˆ«ååªåœ¨æŸ¥è¯¢æ‰§è¡Œä¸­ä½¿ç”¨ã€‚</p></li><li><p>è‡ªè”ç»“</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> p1<span class="token punctuation">.</span>prod_id<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>prod_name<span class="token keyword">FROM</span> products <span class="token keyword">AS</span> p1<span class="token punctuation">,</span> products <span class="token keyword">AS</span> p2<span class="token keyword">WHERE</span> p1<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> p2<span class="token punctuation">.</span>vend_id  <span class="token operator">AND</span> p2<span class="token punctuation">.</span>prod_id <span class="token operator">=</span> <span class="token string">'DTNTR'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è‡ªè”ç»“è¿œæ¯”å¤„ç†å­æŸ¥è¯¢å¿«å¾—å¤šã€‚</p></blockquote></li><li><p>æ— è®ºä½•æ—¶å¯¹è¡¨è¿›è¡Œè”ç»“ï¼Œåº”è¯¥è‡³å°‘æœ‰ä¸€ä¸ªåˆ—å‡ºç°åœ¨ä¸æ­¢ä¸€ä¸ªè¡¨ä¸­ï¼ˆè¢«è”ç»“çš„åˆ—ï¼‰ã€‚æ ‡å‡†çš„è”ç»“ï¼ˆå‰ä¸€ç« ä¸­ä»‹ç»çš„å†…éƒ¨è”ç»“ï¼‰è¿”å›æ‰€æœ‰æ•°æ®ï¼Œç”šè‡³ç›¸åŒçš„åˆ—å¤šæ¬¡å‡ºç°ã€‚ <strong>è‡ªç„¶è”ç»“</strong> æ’é™¤å¤šæ¬¡å‡ºç°ï¼Œä½¿æ¯ä¸ªåˆ—åªè¿”å›ä¸€æ¬¡ã€‚è¿™ä¸€èˆ¬æ˜¯é€šè¿‡å¯¹è¡¨ä½¿ç”¨é€šé…ç¬¦ï¼ˆSELECT*ï¼‰ï¼Œå¯¹æ‰€æœ‰å…¶ä»–è¡¨çš„åˆ—ä½¿ç”¨æ˜ç¡®çš„å­é›†æ¥å®Œæˆçš„ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> c<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_num<span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_data<span class="token punctuation">,</span> io<span class="token punctuation">.</span>prod_id<span class="token punctuation">,</span> io<span class="token punctuation">.</span>quantity<span class="token punctuation">,</span> io<span class="token punctuation">.</span>item_price<span class="token keyword">FROM</span> customers <span class="token keyword">AS</span> c<span class="token punctuation">,</span> orders <span class="token keyword">AS</span> o<span class="token punctuation">,</span> orderitems <span class="token keyword">AS</span> io<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> o<span class="token punctuation">.</span>cust_id  <span class="token operator">AND</span> io<span class="token punctuation">.</span>order_num <span class="token operator">=</span> o<span class="token punctuation">.</span>order_num  <span class="token operator">AND</span> prod_id <span class="token operator">=</span> <span class="token string">'FB'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¤–éƒ¨è”ç»“åœ¨ç»“æœä¸­åŒ…å«äº†é‚£äº›åœ¨å¦ä¸€ä¸ªè¡¨ä¸­æ²¡æœ‰å…³è”è¡Œçš„è¡Œã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> orders<span class="token punctuation">.</span>order_num<span class="token keyword">FROM</span> customers<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> orders<span class="token keyword">ON</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>åœ¨ä½¿ç”¨OUTER JOINè¯­æ³•æ—¶ï¼Œå¿…é¡»ä½¿ç”¨RIGHTæˆ–LEFTå…³é”®å­—æŒ‡å®šåŒ…æ‹¬å…¶æ‰€æœ‰è¡Œçš„è¡¨ï¼ˆRIGHTæŒ‡å‡ºçš„æ˜¯OUTER JOINå³è¾¹çš„è¡¨ï¼Œè€ŒLEFTæŒ‡å‡ºçš„æ˜¯OUTER JOINå·¦è¾¹çš„è¡¨ï¼‰ã€‚ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨LEFT OUTER JOINä»FROMå­å¥çš„å·¦è¾¹è¡¨ï¼ˆcustomersè¡¨ï¼‰ä¸­é€‰æ‹©æ‰€æœ‰è¡Œã€‚ä¸ºäº†ä»å³è¾¹çš„è¡¨ä¸­é€‰æ‹©æ‰€æœ‰è¡Œï¼Œåº”è¯¥ä½¿ç”¨RIGHT OUTER JOINã€‚</li></ol><h2 id="ç¬¬17ç« -ç»„åˆæŸ¥è¯¢"><a href="#ç¬¬17ç« -ç»„åˆæŸ¥è¯¢" class="headerlink" title="ç¬¬17ç«  ç»„åˆæŸ¥è¯¢"></a>ç¬¬17ç«  ç»„åˆæŸ¥è¯¢</h2><ol><li><p>MySQLå…è®¸æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢ï¼ˆå¤šæ¡SELECTè¯­å¥ï¼‰ï¼Œå¹¶å°†ç»“æœä½œä¸ºå•ä¸ªæŸ¥è¯¢ç»“æœé›†è¿”å›ã€‚è¿™äº›ç»„åˆæŸ¥è¯¢é€šå¸¸ç§°ä¸º <strong>å¹¶ï¼ˆunionï¼‰</strong> æˆ– <strong>å¤åˆæŸ¥è¯¢ï¼ˆcompound queryï¼‰</strong> ã€‚</p></li><li><p>ä½¿ç”¨UNIONè§„åˆ™æ—¶éœ€è¦éµå¾ªçš„è§„åˆ™ï¼š</p><ol><li>UNIONå¿…é¡»ç”±ä¸¤æ¡æˆ–ä¸¤æ¡ä»¥ä¸Šçš„SELECTè¯­å¥ç»„æˆï¼Œè¯­å¥ä¹‹é—´ç”¨å…³é”®å­—UNIONåˆ†éš”ï¼ˆå› æ­¤ï¼Œå¦‚æœç»„åˆ4æ¡SELECTè¯­å¥ï¼Œå°†è¦ä½¿ç”¨3ä¸ªUNIONå…³é”®å­—ï¼‰ã€‚</li><li>UNIONä¸­çš„æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ã€è¡¨è¾¾å¼æˆ–èšé›†å‡½æ•°ï¼ˆä¸è¿‡å„ä¸ªåˆ—ä¸éœ€è¦ä»¥ç›¸åŒçš„æ¬¡åºåˆ—å‡ºï¼‰ã€‚</li><li>åˆ—æ•°æ®ç±»å‹å¿…é¡»å…¼å®¹ï¼šç±»å‹ä¸å¿…å®Œå…¨ç›¸åŒï¼Œä½†å¿…é¡»æ˜¯DBMSå¯ä»¥éšå«åœ°è½¬æ¢çš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œä¸åŒçš„æ•°å€¼ç±»å‹æˆ–ä¸åŒçš„æ—¥æœŸç±»å‹ï¼‰ã€‚</li></ol></li><li><p>UNIONä»æŸ¥è¯¢ç»“æœé›†ä¸­è‡ªåŠ¨å»é™¤äº†é‡å¤çš„è¡Œï¼ˆæ¢å¥è¯è¯´ï¼Œå®ƒçš„è¡Œä¸ºä¸å•æ¡SELECTè¯­å¥ä¸­ä½¿ç”¨å¤šä¸ªWHEREå­å¥æ¡ä»¶ä¸€æ ·ï¼‰ã€‚è¿™æ˜¯UNIONçš„é»˜è®¤è¡Œä¸ºï¼Œå¦‚æœæƒ³è¿”å›æ‰€æœ‰åŒ¹é…è¡Œï¼Œå¯ä½¿ç”¨UNION ALLè€Œä¸æ˜¯UNIONã€‚</p></li><li><p>åœ¨ç”¨UNIONç»„åˆæŸ¥è¯¢æ—¶ï¼Œåªèƒ½ä½¿ç”¨ä¸€æ¡ORDER BYå­å¥ï¼Œå®ƒå¿…é¡»å‡ºç°åœ¨æœ€åä¸€æ¡SELECTè¯­å¥ä¹‹åã€‚</p></li></ol><h2 id="ç¬¬18ç« -å…¨æ–‡æœ¬æœç´¢"><a href="#ç¬¬18ç« -å…¨æ–‡æœ¬æœç´¢" class="headerlink" title="ç¬¬18ç«  å…¨æ–‡æœ¬æœç´¢"></a>ç¬¬18ç«  å…¨æ–‡æœ¬æœç´¢</h2><ol><li><p>MyISAMæ”¯æŒå…¨æ–‡æœ¬æœç´¢ï¼ŒInnoDBä¸æ”¯æŒã€‚</p></li><li><p>ä¸ºäº†è¿›è¡Œå…¨æ–‡æœ¬æœç´¢ï¼Œå¿…é¡»ç´¢å¼•è¢«æœç´¢çš„åˆ—ã€‚ä¸€èˆ¬åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨FULLTEXTå¯ç”¨å…¨æ–‡æœ¬æœç´¢ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> productnotes<span class="token punctuation">(</span>    note_id     <span class="token keyword">INT</span>         <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    prod_id     <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    note_date   <span class="token keyword">DATETIME</span>    <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    note_text   <span class="token keyword">TEXT</span>        <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>note_id<span class="token punctuation">)</span><span class="token punctuation">,</span>    FULLTEXT<span class="token punctuation">(</span>note_text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MyISAM<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¸è¦åœ¨å¯¼å…¥æ•°æ®æ—¶ä½¿ç”¨FULLTEXTã€‚åº”è¯¥é¦–å…ˆå¯¼å…¥æ‰€æœ‰æ•°æ®ï¼Œç„¶åå†ä¿®æ”¹è¡¨ï¼Œå®šä¹‰FULLTEXTã€‚</p></blockquote></li><li><p>ä½¿ç”¨ä¸¤ä¸ªå‡½æ•°Match()å’ŒAgainst()æ‰§è¡Œå…¨æ–‡æœ¬æœç´¢ï¼Œå…¶ä¸­Match()æŒ‡å®šè¢«æœç´¢çš„åˆ—ï¼ŒAgainst()æŒ‡å®šè¦ä½¿ç”¨çš„æœç´¢è¡¨è¾¾å¼ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'rabbit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¼ é€’ç»™Match()çš„å€¼å¿…é¡»ä¸FULLTEXT()å®šä¹‰ä¸­çš„ç›¸åŒã€‚å¦‚æœæŒ‡å®šå¤šä¸ªåˆ—ï¼Œåˆ™å¿…é¡»åˆ—å‡ºå®ƒä»¬ï¼ˆè€Œä¸”æ¬¡åºæ­£ç¡®ï¼‰ã€‚</p><p>æœç´¢ä¸åŒºåˆ†å¤§å°å†™ï¼Œé™¤éä½¿ç”¨BINARYæ–¹å¼ï¼Œå¦åˆ™å…¨æ–‡æœ¬æœç´¢ä¸åŒºåˆ†å¤§å°å†™ã€‚</p></blockquote></li><li><p>ä¹Ÿæ˜¯ä½¿ç”¨LIKEå­å¥è¿›è¡Œæœç´¢ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> note_text <span class="token operator">LIKE</span> <span class="token string">'%rabbit%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨LIKEå­å¥è¿›è¡Œæœç´¢æ—¶ï¼Œä¸ä¼šå¯¹ç»“æœè¿›è¡Œæ’åºã€‚è€Œä½¿ç”¨å‡½æ•°Match()å’ŒAgainst()æ‰§è¡Œå…¨æ–‡æœ¬æœç´¢æ—¶ï¼Œä¼šå¯¹ç»“æœè¿›è¡Œæ’åºï¼Œå…·æœ‰è¾ƒé«˜ç­‰çº§çš„è¡Œå…ˆè¿”å›ã€‚ç­‰çº§å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è·å–ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text<span class="token punctuation">,</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'rabbit'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'rank'</span><span class="token keyword">FROM</span> productnotes<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>åœ¨ä½¿ç”¨ <strong>æŸ¥è¯¢æ‰©å±•</strong> æ—¶ï¼ŒMySQLå¯¹æ•°æ®å’Œç´¢å¼•è¿›è¡Œä¸¤éæ‰«ææ¥å®Œæˆæœç´¢ï¼š</p><ol><li>è¿›è¡Œä¸€ä¸ªåŸºæœ¬çš„å…¨æ–‡æœ¬æœç´¢ï¼Œæ‰¾å‡ºä¸æœç´¢æ¡ä»¶åŒ¹é…çš„æ‰€æœ‰è¡Œï¼›</li><li>MySQLæ£€æŸ¥è¿™äº›åŒ¹é…è¡Œå¹¶é€‰æ‹©æ‰€æœ‰æœ‰ç”¨çš„è¯ï¼›</li><li><p>MySQLå†æ¬¡è¿›è¡Œå…¨æ–‡æœ¬æœç´¢ï¼Œè¿™æ¬¡ä¸ä»…ä½¿ç”¨åŸæ¥çš„æ¡ä»¶ï¼Œè€Œä¸”è¿˜ä½¿ç”¨æ‰€æœ‰æœ‰ç”¨çš„è¯ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'anvils'</span> <span class="token keyword">WITH</span> QUERY EXPANSION<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol></li><li><p>å³ä½¿æ²¡æœ‰FULLTEXTç´¢å¼•ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>å¸ƒå°”æ–‡æœ¬æœç´¢</strong> ï¼Œä½†è¿™æ˜¯ä¸€ç§éå¸¸ç¼“æ…¢çš„æ“ä½œã€‚</p><blockquote><p><strong>æ’åˆ—è€Œä¸æ’åº</strong> åœ¨å¸ƒå°”æ–¹å¼ä¸­ï¼Œä¸æŒ‰ç­‰çº§å€¼é™åºæ’åºè¿”å›çš„</p></blockquote></li><li><p>å…¨æ–‡æœ¬æœç´¢çš„ä½¿ç”¨è¯´æ˜</p><ol><li>åœ¨ç´¢å¼•å…¨æ–‡æœ¬æ•°æ®æ—¶ï¼ŒçŸ­è¯è¢«å¿½ç•¥ä¸”ä»ç´¢å¼•ä¸­æ’é™¤ã€‚çŸ­è¯å®šä¹‰ä¸ºé‚£äº›å…·æœ‰3ä¸ªæˆ–3ä¸ªä»¥ä¸‹å­—ç¬¦çš„è¯ï¼ˆå¦‚æœéœ€è¦ï¼Œè¿™ä¸ªæ•°ç›®å¯ä»¥æ›´æ”¹ï¼‰ã€‚</li><li>MySQLå¸¦æœ‰ä¸€ä¸ªå†…å»ºçš„éç”¨è¯ï¼ˆstopwordï¼‰åˆ—è¡¨ï¼Œè¿™äº›è¯åœ¨ç´¢å¼•å…¨æ–‡æœ¬æ•°æ®æ—¶æ€»æ˜¯è¢«å¿½ç•¥ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥è¦†ç›–è¿™ä¸ªåˆ—è¡¨ã€‚</li><li>è®¸å¤šè¯å‡ºç°çš„é¢‘ç‡å¾ˆé«˜ï¼Œæœç´¢å®ƒä»¬æ²¡æœ‰ç”¨å¤„ï¼ˆè¿”å›å¤ªå¤šçš„ç»“æœï¼‰ã€‚å› æ­¤ï¼ŒMySQLè§„å®šäº†ä¸€æ¡50%è§„åˆ™ï¼Œå¦‚æœä¸€ä¸ªè¯å‡ºç°åœ¨50%ä»¥ä¸Šçš„è¡Œä¸­ï¼Œåˆ™å°†å®ƒä½œä¸ºä¸€ä¸ªéç”¨è¯å¿½ç•¥ã€‚50%è§„åˆ™ä¸ç”¨äºIN BOOLEANMODEã€‚</li><li>å¦‚æœè¡¨ä¸­çš„è¡Œæ•°å°‘äº3è¡Œï¼Œåˆ™å…¨æ–‡æœ¬æœç´¢ä¸è¿”å›ç»“æœï¼ˆå› ä¸ºæ¯ä¸ªè¯æˆ–è€…ä¸å‡ºç°ï¼Œæˆ–è€…è‡³å°‘å‡ºç°åœ¨50%çš„è¡Œä¸­ï¼‰ã€‚</li><li>å¿½ç•¥è¯ä¸­çš„å•å¼•å·ã€‚ä¾‹å¦‚ï¼Œdonâ€™tç´¢å¼•ä¸ºdontã€‚</li><li>ä¸å…·æœ‰è¯åˆ†éš”ç¬¦ï¼ˆåŒ…æ‹¬æ—¥è¯­å’Œæ±‰è¯­ï¼‰çš„è¯­è¨€ä¸èƒ½æ°å½“åœ°è¿”å›å…¨æ–‡æœ¬æœç´¢ç»“æœã€‚</li><li><p>å¦‚å‰æ‰€è¿°ï¼Œä»…åœ¨MyISAMæ•°æ®åº“å¼•æ“ä¸­æ”¯æŒå…¨æ–‡æœ¬æœç´¢ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'ft%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol></li><li><p>ä¸€äº›ä¾‹å­</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'+rabbit +bait'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* åŒ¹é…è¯rabbitå’Œbait */</span><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'rabbit bait'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* åŒ¹é…è¯rabbitæˆ–bait */</span><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'"rabbit bait"'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* åŒ¹é…çŸ­è¯­"rabbit bait" */</span><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'&gt;rabbit &lt;bait'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* åŒ¹é…è¯rabbitå’Œbaitï¼Œå¢åŠ å‰è€…çš„ç­‰çº§ï¼Œé™ä½åè€…çš„ç­‰çº§ */</span><span class="token keyword">SELECT</span> note_text<span class="token keyword">FROM</span> productnotes<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'+rabbit +(&lt;bait)'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* åŒ¹é…è¯rabbitå’Œbaitï¼Œé™ä½åè€…çš„ç­‰çº§ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>å…¨æ–‡æœ¬å¸ƒå°”æ“ä½œç¬¦</li></ol><div class="table-container"><table><thead><tr><th><strong>å¸ƒå°”æ“ä½œç¬¦</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>+</td><td>åŒ…å«ï¼Œè¯å¿…é¡»å­˜åœ¨</td></tr><tr><td>-</td><td>æ’é™¤ï¼Œè¯å¿…é¡»ä¸å‡ºç°</td></tr><tr><td>&gt;</td><td>åŒ…å«ï¼Œè€Œä¸”å¢åŠ ç­‰çº§å€¼</td></tr><tr><td>&lt;</td><td>åŒ…å«ï¼Œä¸”å‡å°‘ç­‰çº§å€¼</td></tr><tr><td>()</td><td>æŠŠè¯ç»„æˆå­è¡¨è¾¾å¼ï¼ˆå…è®¸è¿™äº›å­è¡¨è¾¾å¼ä½œä¸ºä¸€ä¸ªç»„è¢«åŒ…å«ã€æ’é™¤ã€æ’åˆ—ç­‰ï¼‰</td></tr><tr><td>~</td><td>å–æ¶ˆä¸€ä¸ªè¯çš„æ’åºå€¼</td></tr><tr><td>*</td><td>è¯å°¾çš„é€šé…ç¬¦</td></tr><tr><td>â€œâ€</td><td>å®šä¹‰ä¸€ä¸ªçŸ­è¯­ï¼ˆä¸å•ä¸ªè¯çš„åˆ—è¡¨ä¸ä¸€æ ·ï¼Œå®ƒåŒ¹é…æ•´ä¸ªçŸ­è¯­ä»¥ä¾¿åŒ…å«æˆ–æ’é™¤è¿™ä¸ªçŸ­è¯­ï¼‰</td></tr></tbody></table></div><h2 id="ç¬¬19ç« -æ’å…¥æ•°æ®"><a href="#ç¬¬19ç« -æ’å…¥æ•°æ®" class="headerlink" title="ç¬¬19ç«  æ’å…¥æ•°æ®"></a>ç¬¬19ç«  æ’å…¥æ•°æ®</h2><ol><li><p>å¦‚æœè¡¨çš„å®šä¹‰å…è®¸ï¼Œåˆ™å¯ä»¥åœ¨INSERTæ“ä½œä¸­çœç•¥æŸäº›åˆ—ï¼š</p><ol><li>è¯¥åˆ—å®šä¹‰ä¸ºå…è®¸NULLå€¼ï¼ˆæ— å€¼æˆ–ç©ºå€¼ï¼‰ã€‚</li><li>åœ¨è¡¨å®šä¹‰ä¸­ç»™å‡ºé»˜è®¤å€¼ã€‚è¿™è¡¨ç¤ºå¦‚æœä¸ç»™å‡ºå€¼ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚</li></ol></li><li><p>å¯ä»¥é€šè¿‡åœ¨INSERTå’ŒINTOä¹‹é—´æ·»åŠ å…³é”®å­—LOW_PRIORITYï¼ŒæŒ‡ç¤ºMySQLé™ä½INSERTè¯­å¥çš„ä¼˜å…ˆçº§ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> LOW_PRIORITY <span class="token keyword">INTO</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>åŒæ ·é€‚ç”¨äºUPDATEå’ŒDELETEã€‚</p></blockquote></li><li><p>ä¸€äº›ä¾‹å­ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">/* ä¸€æ¬¡æ’å…¥ä¸€æ¡è®°å½• */</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* ä¸€æ¬¡æ’å…¥å¤šæ¡è®°å½• */</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* æ’å…¥æ£€ç´¢å‡ºçš„æ•°æ® */</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">)</span><span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_address<span class="token keyword">FROM</span> customers_new<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>INSERT SELECTä¸­ä¸è¦æ±‚åˆ—ååŒ¹é…ã€‚MySQLä½¿ç”¨çš„æ˜¯åˆ—çš„ä½ç½®ï¼Œå› æ­¤SELECTä¸­çš„ç¬¬ä¸€åˆ—ï¼ˆä¸ç®¡å…¶åˆ—åï¼‰å°†ç”¨æ¥å¡«å……è¡¨åˆ—ä¸­æŒ‡å®šçš„ç¬¬ä¸€ä¸ªåˆ—ï¼Œç¬¬äºŒåˆ—å°†ç”¨æ¥å¡«å……è¡¨åˆ—ä¸­æŒ‡å®šçš„ç¬¬äºŒä¸ªåˆ—ï¼Œå¦‚æ­¤ç­‰ç­‰ã€‚</p></blockquote></li></ol><h2 id="ç¬¬20ç« -æ›´æ–°å’Œåˆ é™¤æ•°æ®"><a href="#ç¬¬20ç« -æ›´æ–°å’Œåˆ é™¤æ•°æ®" class="headerlink" title="ç¬¬20ç«  æ›´æ–°å’Œåˆ é™¤æ•°æ®"></a>ç¬¬20ç«  æ›´æ–°å’Œåˆ é™¤æ•°æ®</h2><ol><li><p>å¦‚æœç”¨UPDATEè¯­å¥æ›´æ–°å¤šè¡Œï¼Œå¹¶ä¸”åœ¨æ›´æ–°è¿™äº›è¡Œä¸­çš„ä¸€è¡Œæˆ–å¤šè¡Œæ—¶å‡ºä¸€ä¸ªç°é”™è¯¯ï¼Œåˆ™æ•´ä¸ªUPDATEæ“ä½œè¢«å–æ¶ˆï¼ˆé”™è¯¯å‘ç”Ÿå‰æ›´æ–°çš„æ‰€æœ‰è¡Œè¢«æ¢å¤åˆ°å®ƒä»¬åŸæ¥çš„å€¼ï¼‰ã€‚ä¸ºå³ä½¿æ˜¯å‘ç”Ÿé”™è¯¯ï¼Œä¹Ÿç»§ç»­è¿›è¡Œæ›´æ–°ï¼Œå¯ä½¿ç”¨IGNOREå…³é”®å­—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> <span class="token keyword">IGNORE</span> customers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>å¦‚æœæƒ³ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰è¡Œï¼Œä¸è¦ä½¿ç”¨DELETEã€‚å¯ä½¿ç”¨TRUNCATE TABLEè¯­å¥ï¼Œå®ƒå®Œæˆç›¸åŒçš„å·¥ä½œï¼Œä½†é€Ÿåº¦æ›´å¿«ï¼ˆTRUNCATEå®é™…æ˜¯åˆ é™¤åŸæ¥çš„è¡¨å¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œè€Œä¸æ˜¯é€è¡Œåˆ é™¤è¡¨ä¸­çš„æ•°æ®ï¼‰ã€‚</li></ol><h2 id="ç¬¬21ç« -åˆ›å»ºå’Œæ“çºµè¡¨"><a href="#ç¬¬21ç« -åˆ›å»ºå’Œæ“çºµè¡¨" class="headerlink" title="ç¬¬21ç«  åˆ›å»ºå’Œæ“çºµè¡¨"></a>ç¬¬21ç«  åˆ›å»ºå’Œæ“çºµè¡¨</h2><ol><li><p>ä¸»é”®å€¼å¿…é¡»å”¯ä¸€ã€‚å³ï¼Œè¡¨ä¸­çš„æ¯ä¸ªè¡Œå¿…é¡»å…·æœ‰å”¯ä¸€çš„ä¸»é”®å€¼ã€‚å¦‚æœä¸»é”®ä½¿ç”¨å•ä¸ªåˆ—ï¼Œåˆ™å®ƒçš„å€¼å¿…é¡»å”¯ä¸€ã€‚å¦‚æœä½¿ç”¨å¤šä¸ªåˆ—ï¼Œåˆ™è¿™äº›åˆ—çš„ç»„åˆå€¼å¿…é¡»å”¯ä¸€ã€‚</p></li><li><p><strong>å‡½æ•°last_insert_id()</strong> è¿”å›æœ€åä¸€ä¸ªAUTO_INCREMENTå€¼ã€‚</p></li><li><p>å¤–é”®ä¸èƒ½è·¨å¼•æ“ã€‚</p></li><li><p>ä¸€äº›ä¾‹å­ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> productnotes<span class="token punctuation">(</span>    note_id     <span class="token keyword">INT</span>         <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    prod_id     <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    note_date   <span class="token keyword">DATETIME</span>    <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    note_text   <span class="token keyword">TEXT</span>        <span class="token boolean">NULL</span><span class="token punctuation">,</span>    update_cnt  <span class="token keyword">INT</span>         <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>note_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MyISAM<span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Vendors<span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> vend_phone<span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> orderitems<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_orderitems_orders<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>order_num<span class="token punctuation">)</span><span class="token keyword">REFERENCES</span> orders <span class="token punctuation">(</span>order_num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> customers2<span class="token punctuation">;</span><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> customers2 <span class="token keyword">TO</span> customers<span class="token punctuation">;</span><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> customers <span class="token keyword">TO</span> customers_backup<span class="token punctuation">,</span> vendors <span class="token keyword">TO</span> vendors_backup<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="ç¬¬22ç« -ä½¿ç”¨è§†å›¾"><a href="#ç¬¬22ç« -ä½¿ç”¨è§†å›¾" class="headerlink" title="ç¬¬22ç«  ä½¿ç”¨è§†å›¾"></a>ç¬¬22ç«  ä½¿ç”¨è§†å›¾</h2><ol><li><p>è§†å›¾ä»…ä»…æ˜¯ç”¨æ¥æŸ¥çœ‹å­˜å‚¨åœ¨åˆ«å¤„çš„æ•°æ®çš„ä¸€ç§è®¾æ–½ã€‚è§†å›¾æœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œå› æ­¤å®ƒä»¬è¿”å›çš„æ•°æ®æ˜¯ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢å‡ºæ¥çš„ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> customeremaillist <span class="token keyword">AS</span><span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> cust_name<span class="token punctuation">,</span> cust_email<span class="token keyword">FROM</span> customers<span class="token keyword">WHERE</span> cust_email <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è§†å›¾çš„è§„åˆ™å’Œé™åˆ¶</p><ol><li>ä¸è¡¨ä¸€æ ·ï¼Œè§†å›¾å¿…é¡»å”¯ä¸€å‘½åï¼ˆä¸èƒ½ç»™è§†å›¾å–ä¸åˆ«çš„è§†å›¾æˆ–è¡¨ç›¸åŒçš„åå­—ï¼‰ã€‚</li><li>å¯¹äºå¯ä»¥åˆ›å»ºçš„è§†å›¾æ•°ç›®æ²¡æœ‰é™åˆ¶ã€‚</li><li>ä¸ºäº†åˆ›å»ºè§†å›¾ï¼Œå¿…é¡»å…·æœ‰è¶³å¤Ÿçš„è®¿é—®æƒé™ã€‚</li><li>è§†å›¾å¯ä»¥åµŒå¥—ï¼Œå³å¯ä»¥åˆ©ç”¨ä»å…¶ä»–è§†å›¾ä¸­æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢æ¥æ„é€ ä¸€ä¸ªè§†å›¾ã€‚</li><li>ORDER BYå¯ä»¥ç”¨åœ¨è§†å›¾ä¸­ï¼Œä½†å¦‚æœä»è¯¥è§†å›¾æ£€ç´¢æ•°æ®SELECTä¸­ä¹Ÿå«æœ‰ORDER BYï¼Œé‚£ä¹ˆè¯¥è§†å›¾ä¸­çš„ORDER BYå°†è¢«è¦†ç›–ã€‚</li><li>è§†å›¾ä¸èƒ½ç´¢å¼•ï¼Œä¹Ÿä¸èƒ½æœ‰å…³è”çš„è§¦å‘å™¨æˆ–é»˜è®¤å€¼ã€‚</li><li>è§†å›¾å¯ä»¥å’Œè¡¨ä¸€èµ·ä½¿ç”¨ã€‚</li></ol></li><li><p>ä½¿ç”¨è§†å›¾</p><ol><li>è§†å›¾ç”¨CREATE VIEWè¯­å¥æ¥åˆ›å»ºã€‚</li><li>ä½¿ç”¨SHOW CREATE VIEW viewnameï¼›æ¥æŸ¥çœ‹åˆ›å»ºè§†å›¾çš„è¯­å¥ã€‚</li><li>ç”¨DROPåˆ é™¤è§†å›¾ï¼Œå…¶è¯­æ³•ä¸ºDROP VIEW viewnameã€‚</li><li>æ›´æ–°è§†å›¾æ—¶ï¼Œå¯ä»¥å…ˆç”¨DROPå†ç”¨CREATEï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨CREATE OR REPLACE VIEWã€‚å¦‚æœè¦æ›´æ–°çš„è§†å›¾ä¸å­˜åœ¨ï¼Œåˆ™ç¬¬2æ¡æ›´æ–°è¯­å¥ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼›å¦‚æœè¦æ›´æ–°çš„è§†å›¾å­˜åœ¨ï¼Œåˆ™ç¬¬2æ¡æ›´æ–°è¯­å¥ä¼šæ›¿æ¢åŸæœ‰è§†å›¾ã€‚</li></ol></li><li><p>è§†å›¾æ˜¯å¯æ›´æ–°çš„ï¼ˆå³ï¼Œå¯ä»¥å¯¹å®ƒä»¬ä½¿ç”¨INSERTã€UPDATEå’ŒDELETEï¼‰ã€‚æ›´æ–°ä¸€ä¸ªè§†å›¾å°†æ›´æ–°å…¶åŸºè¡¨ï¼ˆå¯ä»¥å›å¿†ä¸€ä¸‹ï¼Œè§†å›¾æœ¬èº«æ²¡æœ‰æ•°æ®ï¼‰ã€‚å¦‚æœä½ å¯¹è§†å›¾å¢åŠ æˆ–åˆ é™¤è¡Œï¼Œå®é™…ä¸Šæ˜¯å¯¹å…¶åŸºè¡¨å¢åŠ æˆ–åˆ é™¤è¡Œã€‚</p></li><li><p>å¹¶éæ‰€æœ‰è§†å›¾éƒ½æ˜¯å¯æ›´æ–°çš„ã€‚åŸºæœ¬ä¸Šå¯ä»¥è¯´ï¼Œå¦‚æœMySQLä¸èƒ½æ­£ç¡®åœ°ç¡®å®šè¢«æ›´æ–°çš„åŸºæ•°æ®ï¼Œåˆ™ä¸å…è®¸æ›´æ–°ï¼ˆåŒ…æ‹¬æ’å…¥å’Œåˆ é™¤ï¼‰ã€‚è¿™å®é™…ä¸Šæ„å‘³ç€ï¼Œå¦‚æœè§†å›¾å®šä¹‰ä¸­æœ‰ä»¥ä¸‹æ“ä½œï¼Œåˆ™ä¸èƒ½è¿›è¡Œè§†å›¾çš„æ›´æ–°ï¼š</p><ol><li>åˆ†ç»„ï¼ˆä½¿ç”¨GROUP BYå’ŒHAVINGï¼‰ï¼›</li><li>è”ç»“ï¼›</li><li>å­æŸ¥è¯¢ï¼›</li><li>å¹¶ï¼›</li><li>èšé›†å‡½æ•°ï¼ˆMin()ã€Count()ã€Sum()ç­‰ï¼‰ï¼›</li><li>DISTINCTï¼›</li><li>å¯¼å‡ºï¼ˆè®¡ç®—ï¼‰åˆ—ã€‚</li></ol></li></ol><h2 id="ç¬¬23ç« -ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#ç¬¬23ç« -ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="ç¬¬23ç«  ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹"></a>ç¬¬23ç«  ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹</h2><ol><li><p>æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CALL</span> productpricing<span class="token punctuation">(</span><span class="token variable">@pricelow</span><span class="token punctuation">,</span> <span class="token variable">@pricehigh</span><span class="token punctuation">,</span> <span class="token variable">@priceaverage</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- Name: ordertotal</span><span class="token comment">-- Parameters: onumber = order number</span><span class="token comment">--             taxable = 0 if not taxable, 1 if taxable</span><span class="token comment">--             ototal  = order total variable</span><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">(</span>    <span class="token operator">IN</span>  onumber <span class="token keyword">INT</span><span class="token punctuation">,</span>    <span class="token operator">IN</span>  taxable <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span>    <span class="token keyword">OUT</span> ototal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'Obtain order total, optionally adding tax'</span><span class="token keyword">BEGIN</span>    <span class="token comment">--Declare variable for total</span>    <span class="token keyword">DECLARE</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">--Declare tax percentage</span>    <span class="token keyword">DECLARE</span> taxrate <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token comment">--GET the order total</span>    <span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>quantity<span class="token punctuation">)</span>    <span class="token keyword">FROM</span> orderitems    <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> onumber    <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>    <span class="token comment">--Is this taxable</span>    <span class="token keyword">IF</span> taxable <span class="token keyword">THEN</span>        <span class="token keyword">SELECT</span> total<span class="token operator">+</span><span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token number">100</span><span class="token operator">*</span>taxrate<span class="token punctuation">)</span> <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>    <span class="token keyword">SELECT</span> total <span class="token keyword">INTO</span> ototal<span class="token punctuation">;</span><span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>COMMENTçš„å€¼ä¼šåœ¨<code>SHOW PROCEDURE STATUS</code>æ—¶æ˜¾ç¤ºå‡ºæ¥ã€‚</p></blockquote></li><li><p>åˆ é™¤å­˜å‚¨è¿‡ç¨‹</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>ä¸ºäº†è·å¾—åŒ…æ‹¬ä½•æ—¶ã€ç”±è°åˆ›å»ºç­‰è¯¦ç»†ä¿¡æ¯çš„å­˜å‚¨è¿‡ç¨‹åˆ—è¡¨ï¼Œä½¿ç”¨<code>SHOW PROCEDURE STATUS</code> æˆ–<code>SHOW PROCEDURE STATUS LIKE 'ordertotal'</code>ã€‚</p></blockquote></li><li><p>ä½¿ç”¨mysqlå‘½ä»¤è¡Œå®ç”¨ç¨‹åºæ—¶éœ€è¦æ³¨æ„ï¼š</p><p> é»˜è®¤çš„MySQLè¯­å¥åˆ†éš”ç¬¦ä¸º<code>;</code> mysqlå‘½ä»¤è¡Œå®ç”¨ç¨‹åºä¹Ÿä½¿ç”¨<code>;</code>ä½œä¸ºè¯­å¥åˆ†éš”ç¬¦ã€‚å¦‚æœå‘½ä»¤è¡Œå®ç”¨ç¨‹åºè¦è§£é‡Šå­˜å‚¨è¿‡ç¨‹è‡ªèº«å†…çš„;å­—ç¬¦ï¼Œåˆ™å®ƒä»¬æœ€ç»ˆä¸ä¼šæˆä¸ºå­˜å‚¨è¿‡ç¨‹çš„æˆåˆ†ï¼Œè¿™ä¼šä½¿å­˜å‚¨è¿‡ç¨‹ä¸­çš„SQLå‡ºç°å¥æ³•é”™è¯¯ã€‚<br> è§£å†³åŠæ³•æ˜¯ä¸´æ—¶æ›´æ”¹å‘½ä»¤è¡Œå®ç”¨ç¨‹åºçš„è¯­å¥åˆ†éš”ç¬¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment">//</span><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">BEGIN</span>    <span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> priceaverage    <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token comment">//</span><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>é™¤<code>\</code>ç¬¦å·å¤–ï¼Œä»»ä½•å­—ç¬¦éƒ½å¯ä»¥ç”¨ä½œè¯­å¥åˆ†éš”ç¬¦ã€‚</p></blockquote></li></ol><h2 id="ç¬¬24ç« -ä½¿ç”¨æ¸¸æ ‡"><a href="#ç¬¬24ç« -ä½¿ç”¨æ¸¸æ ‡" class="headerlink" title="ç¬¬24ç«  ä½¿ç”¨æ¸¸æ ‡"></a>ç¬¬24ç«  ä½¿ç”¨æ¸¸æ ‡</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">BEGIN</span>    <span class="token comment">-- Declare local variables</span>    <span class="token keyword">DECLARE</span> done <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">DECLARE</span> o <span class="token keyword">INT</span><span class="token punctuation">;</span>    <span class="token keyword">DECLARE</span> t <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">-- Declare the cursor</span>    <span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>    <span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>    <span class="token comment">-- Declare continue handler</span>    <span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'02000'</span> <span class="token keyword">SET</span> done<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">-- Create a table to store the results</span>    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> ordertotals<span class="token punctuation">(</span>        order_num <span class="token keyword">INT</span><span class="token punctuation">,</span>        total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">-- Open the cursor</span>    <span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>    <span class="token comment">-- Loop through all rows</span>    <span class="token keyword">REPEAT</span>        <span class="token comment">-- Get order number</span>        <span class="token keyword">FETCH</span> ordernumbers <span class="token keyword">INTO</span> o<span class="token punctuation">;</span>        <span class="token comment">-- Get the total for this order</span>        <span class="token keyword">CALL</span> ordertotalmye<span class="token punctuation">(</span>o<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">-- Insert order and total into ordertotals</span>        <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ordertotals<span class="token punctuation">(</span>order_num<span class="token punctuation">,</span>total<span class="token punctuation">)</span>        <span class="token keyword">VALUES</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">-- End of loop</span>    UNTIL done <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>    <span class="token comment">-- Close the cursor</span>    <span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span><span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬25ç« -ä½¿ç”¨è§¦å‘å™¨"><a href="#ç¬¬25ç« -ä½¿ç”¨è§¦å‘å™¨" class="headerlink" title="ç¬¬25ç«  ä½¿ç”¨è§¦å‘å™¨"></a>ç¬¬25ç«  ä½¿ç”¨è§¦å‘å™¨</h2><ol><li><p>è§¦å‘å™¨æ˜¯MySQLå“åº”ä»¥ä¸‹ä»»æ„è¯­å¥è€Œè‡ªåŠ¨æ‰§è¡Œçš„ä¸€æ¡MySQLè¯­å¥ï¼ˆæˆ–ä½äº BEGIN å’Œ END è¯­å¥ä¹‹é—´çš„ä¸€ç»„è¯­ å¥ï¼‰ï¼š</p><ol><li>DELETEï¼›</li><li>INSERTï¼›</li><li>UPDATEã€‚</li></ol></li><li><p>åœ¨åˆ›å»ºè§¦å‘å™¨æ—¶ï¼Œéœ€è¦ç»™å‡º4æ¡ä¿¡æ¯ï¼š</p><ol><li>å”¯ä¸€çš„è§¦å‘å™¨åï¼›</li><li>è§¦å‘å™¨å…³è”çš„è¡¨ï¼›</li><li>è§¦å‘å™¨åº”è¯¥å“åº”çš„æ´»åŠ¨ï¼ˆDELETEã€INSERTæˆ–UPDATEï¼‰ï¼›</li><li><p>è§¦å‘å™¨ä½•æ—¶æ‰§è¡Œï¼ˆå¤„ç†ä¹‹å‰æˆ–ä¹‹åï¼‰ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> newproduct<span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> products<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> <span class="token string">'Product added'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>åªæœ‰è¡¨æ‰æ”¯æŒè§¦å‘å™¨ï¼Œè§†å›¾ä¸æ”¯æŒï¼ˆä¸´æ—¶è¡¨ä¹Ÿä¸æ”¯æŒï¼‰ã€‚</p></blockquote></li></ol></li><li><p>è§¦å‘å™¨æŒ‰æ¯ä¸ªè¡¨æ¯ä¸ªäº‹ä»¶æ¯æ¬¡åœ°å®šä¹‰ï¼Œæ¯ä¸ªè¡¨æ¯ä¸ªäº‹ä»¶æ¯æ¬¡åªå…è®¸ä¸€ä¸ªè§¦å‘å™¨ã€‚å› æ­¤ï¼Œæ¯ä¸ªè¡¨æœ€å¤šæ”¯æŒ6ä¸ªè§¦å‘å™¨ï¼ˆæ¯æ¡INSERTã€UPDATE å’ŒDELETEçš„ä¹‹å‰å’Œä¹‹åï¼‰ã€‚</p><blockquote><p>å¦‚æœBEFOREè§¦å‘å™¨å¤±è´¥ï¼Œåˆ™MySQLå°†ä¸æ‰§è¡Œè¯·æ±‚çš„æ“ä½œã€‚æ­¤å¤–ï¼Œå¦‚æœBEFOREè§¦å‘å™¨æˆ–è¯­å¥æœ¬èº«å¤±è´¥ï¼ŒMySQL å°†ä¸æ‰§è¡ŒAFTERè§¦å‘å™¨ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p></blockquote></li><li><p>åˆ é™¤è§¦å‘å™¨</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> newproduct<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>è§¦å‘å™¨ä¸èƒ½æ›´æ–°æˆ–è¦†ç›–ã€‚ä¸ºäº†ä¿®æ”¹ä¸€ä¸ªè§¦å‘å™¨ï¼Œå¿…é¡»å…ˆåˆ é™¤å®ƒï¼Œ ç„¶åå†é‡æ–°åˆ›å»ºã€‚</p></blockquote></li><li><p>INSERTè§¦å‘å™¨åœ¨INSERTè¯­å¥æ‰§è¡Œä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚éœ€è¦çŸ¥é“ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>åœ¨INSERTè§¦å‘å™¨ä»£ç å†…ï¼Œå¯å¼•ç”¨ä¸€ä¸ªåä¸ºNEWçš„è™šæ‹Ÿè¡¨ï¼Œè®¿é—®è¢«æ’å…¥çš„è¡Œï¼›</li><li>åœ¨BEFORE INSERTè§¦å‘å™¨ä¸­ï¼ŒNEWä¸­çš„å€¼ä¹Ÿå¯ä»¥è¢«æ›´æ–°ï¼ˆå…è®¸æ›´æ”¹è¢«æ’å…¥çš„å€¼ï¼‰ï¼›</li><li><p>å¯¹äºAUTO_INCREMENTåˆ—ï¼ŒNEWåœ¨INSERTæ‰§è¡Œä¹‹å‰åŒ…å«0ï¼Œåœ¨INSERTæ‰§è¡Œä¹‹ååŒ…å«æ–°çš„è‡ªåŠ¨ç”Ÿæˆå€¼ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> neworder<span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> orders<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>order_new<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol></li><li><p>DELETEè§¦å‘å™¨åœ¨DELETEè¯­å¥æ‰§è¡Œä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚éœ€è¦çŸ¥é“ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ol><li>åœ¨DELETEè§¦å‘å™¨ä»£ç å†…ï¼Œä½ å¯ä»¥å¼•ç”¨ä¸€ä¸ªåä¸ºOLDçš„è™šæ‹Ÿè¡¨ï¼Œè®¿é—®è¢«åˆ é™¤çš„è¡Œï¼›</li><li><p>OLDä¸­çš„å€¼å…¨éƒ½æ˜¯åªè¯»çš„ï¼Œä¸èƒ½æ›´æ–°ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> deleteorderBEFORE <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> orders<span class="token keyword">FOR EACH ROW</span><span class="token keyword">BEGIN</span>    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> archive_orders<span class="token punctuation">(</span>order_num<span class="token punctuation">,</span> order_date<span class="token punctuation">,</span> cust_id<span class="token punctuation">)</span>    <span class="token keyword">VALUE</span><span class="token punctuation">(</span>OLD<span class="token punctuation">.</span>order_num<span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>order_date<span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li><li><p>UPDATEè§¦å‘å™¨åœ¨UPDATEè¯­å¥æ‰§è¡Œä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚éœ€è¦çŸ¥é“ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>åœ¨UPDATEè§¦å‘å™¨ä»£ç ä¸­ï¼Œä½ å¯ä»¥å¼•ç”¨ä¸€ä¸ªåä¸ºOLDçš„è™šæ‹Ÿè¡¨è®¿é—®ä»¥å‰ï¼ˆUPDATEè¯­å¥å‰ï¼‰çš„å€¼ï¼Œå¼•ç”¨ä¸€ä¸ªåä¸ºNEWçš„è™šæ‹Ÿè¡¨è®¿é—®æ–°æ›´æ–°çš„å€¼ï¼›</li><li>åœ¨BEFORE UPDATEè§¦å‘å™¨ä¸­ï¼ŒNEWä¸­çš„å€¼å¯èƒ½ä¹Ÿè¢«æ›´æ–°ï¼ˆå…è®¸æ›´æ”¹å°†è¦ç”¨äºUPDATEè¯­å¥ä¸­çš„å€¼ï¼‰ï¼›</li><li><p>OLDä¸­çš„å€¼å…¨éƒ½æ˜¯åªè¯»çš„ï¼Œä¸èƒ½æ›´æ–°ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> updatevendorBEFORE <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> vendors<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SET</span> NEW<span class="token punctuation">.</span>vend_state <span class="token operator">=</span> UPPER<span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>vend_state<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol></li><li>MySQLè§¦å‘å™¨ä¸­ä¸æ”¯æŒCALLè¯­å¥ã€‚è¿™è¡¨ç¤ºä¸èƒ½ä»è§¦å‘å™¨å†…è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚</li></ol><h2 id="ç¬¬26ç« -ç®¡ç†äº‹åŠ¡å¤„ç†"><a href="#ç¬¬26ç« -ç®¡ç†äº‹åŠ¡å¤„ç†" class="headerlink" title="ç¬¬26ç«  ç®¡ç†äº‹åŠ¡å¤„ç†"></a>ç¬¬26ç«  ç®¡ç†äº‹åŠ¡å¤„ç†</h2><ol><li><p>äº‹åŠ¡å¤„ç†ï¼ˆtransaction processingï¼‰å¯ä»¥ç”¨æ¥ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§ï¼Œå®ƒä¿è¯æˆæ‰¹çš„MySQLæ“ä½œè¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œã€‚</p><blockquote><p> MyISAMå’ŒInnoDBæ˜¯ä¸¤ç§æœ€å¸¸ä½¿ç”¨çš„å¼•æ“ã€‚å‰è€…ä¸æ”¯æŒæ˜ç¡®çš„äº‹åŠ¡å¤„ç†ç®¡ç†ï¼Œè€Œåè€…æ”¯æŒã€‚</p></blockquote></li><li><p>ç›¸å…³æœ¯è¯­ï¼š</p><ol><li><strong>äº‹åŠ¡ï¼ˆtransactionï¼‰</strong> æŒ‡ä¸€ç»„SQLè¯­å¥ï¼›</li><li><strong>å›é€€ï¼ˆrollbackï¼‰</strong> æŒ‡æ’¤é”€æŒ‡å®šSQLè¯­å¥çš„è¿‡ç¨‹ï¼›</li><li><strong>æäº¤ï¼ˆcommitï¼‰</strong> æŒ‡å°†æœªå­˜å‚¨çš„SQLè¯­å¥ç»“æœå†™å…¥æ•°æ®åº“è¡¨ï¼›</li><li><strong>ä¿ç•™ç‚¹ï¼ˆ savepoint ï¼‰</strong> æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œä½ å¯ä»¥å¯¹å®ƒå‘å¸ƒå›é€€ï¼ˆä¸å›é€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒï¼‰ã€‚</li></ol></li><li><p>å¼€å§‹äº‹åŠ¡</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å›é€€äº‹åŠ¡</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span><span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>äº‹åŠ¡å¤„ç†ç”¨æ¥ç®¡ç†INSERTã€UPDATEå’ŒDELETEè¯­å¥ã€‚ä½ ä¸èƒ½å›é€€SELECTè¯­å¥ï¼Œä¹Ÿ <strong>ä¸èƒ½å›é€€CREATEæˆ–DROPæ“ä½œ</strong> ã€‚äº‹åŠ¡å¤„ç†å—ä¸­å¯ä»¥ä½¿ç”¨è¿™ä¸¤æ¡è¯­å¥ï¼Œä½†å¦‚æœä½ æ‰§è¡Œå›é€€ï¼Œå®ƒä»¬ä¸ä¼šè¢«æ’¤é”€ã€‚</p></blockquote></li><li><p>æäº¤äº‹åŠ¡</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">;</span><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">;</span><span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å½“COMMITæˆ–ROLLBACKè¯­å¥æ‰§è¡Œåï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å…³é—­ï¼ˆå°†æ¥çš„æ›´æ”¹ä¼šéšå«æäº¤ï¼‰ã€‚</p></blockquote></li><li><p>ä¸ºäº†æ”¯æŒå›é€€éƒ¨åˆ†äº‹åŠ¡å¤„ç†ï¼Œå¿…é¡»èƒ½åœ¨äº‹åŠ¡å¤„ç†å—ä¸­åˆé€‚çš„ä½ç½®æ”¾ ç½®ä¿ç•™ç‚¹ã€‚è¿™æ ·ï¼Œå¦‚æœéœ€è¦å›é€€ï¼Œå¯ä»¥å›é€€åˆ°æŸä¸ªä¿ç•™ç‚¹ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SAVEPOINT</span> delete1<span class="token punctuation">;</span> <span class="token comment">/* åˆ›å»ºä¿ç•™ç‚¹ */</span><span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> delete1<span class="token punctuation">;</span> <span class="token comment">/* å›é€€åˆ°ä¿ç•™ç‚¹ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¿ç•™ç‚¹è¶Šå¤šï¼Œå°±è¶Šèƒ½æŒ‰è‡ªå·±çš„æ„æ„¿çµæ´»åœ°è¿›è¡Œå›é€€ï¼Œæ‰€ä»¥ä¿ç•™ç‚¹è¶Šå¤šè¶Šå¥½ã€‚</p><p>ä¿ç•™ç‚¹åœ¨äº‹åŠ¡å¤„ç†å®Œæˆï¼ˆæ‰§è¡Œä¸€æ¡ROLLBACKæˆ– COMMITï¼‰åè‡ªåŠ¨é‡Šæ”¾ã€‚ä¹Ÿå¯ä»¥ç”¨RELEASE SAVEPOINTæ˜ç¡®åœ°é‡Šæ”¾ä¿ç•™ç‚¹ã€‚</p></blockquote></li><li><p>é»˜è®¤çš„MySQLè¡Œä¸ºæ˜¯è‡ªåŠ¨æäº¤æ‰€æœ‰æ›´æ”¹ã€‚å¯ä»¥å…³é—­ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> AUTOCOMMIT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>autocommitæ ‡å¿—å†³å®šæ˜¯å¦è‡ªåŠ¨æäº¤æ›´æ”¹ï¼Œä¸ç®¡æœ‰æ²¡æœ‰COMMIT è¯­å¥ã€‚è®¾ç½®autocommitä¸º0ï¼ˆå‡ï¼‰æŒ‡ç¤ºMySQLä¸è‡ªåŠ¨æäº¤æ›´æ”¹ ï¼ˆç›´åˆ°autocommitè¢«è®¾ç½®ä¸ºçœŸä¸ºæ­¢ï¼‰ã€‚</p><p>autocommitæ ‡å¿—æ˜¯é’ˆå¯¹æ¯ä¸ªè¿æ¥è€Œä¸æ˜¯æœåŠ¡å™¨çš„ã€‚</p></blockquote></li></ol><h2 id="ç¬¬27ç« -å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–"><a href="#ç¬¬27ç« -å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–" class="headerlink" title="ç¬¬27ç«  å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–"></a>ç¬¬27ç«  å…¨çƒåŒ–å’Œæœ¬åœ°åŒ–</h2><ol><li><p>é‡è¦æœ¯è¯­ï¼š</p><ol><li><strong>å­—ç¬¦é›†</strong> ä¸ºå­—æ¯å’Œç¬¦å·çš„é›†åˆï¼›</li><li><strong>ç¼–ç </strong> ä¸ºæŸä¸ªå­—ç¬¦é›†æˆå‘˜çš„å†…éƒ¨è¡¨ç¤ºï¼›</li><li><strong>æ ¡å¯¹</strong> ä¸ºè§„å®šå­—ç¬¦å¦‚ä½•æ¯”è¾ƒçš„æŒ‡ä»¤ã€‚</li></ol></li><li><p>æŸ¥çœ‹æ‰€æ”¯æŒçš„å­—ç¬¦é›†å®Œæ•´åˆ—è¡¨</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹æ‰€æ”¯æŒæ ¡å¯¹çš„å®Œæ•´åˆ—è¡¨</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> COLLATION<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>è®¸å¤šæ ¡å¯¹å‡ºç°ä¸¤æ¬¡ï¼Œä¸€æ¬¡åŒºåˆ†å¤§å°å†™ï¼ˆç”±_csè¡¨ä¸€æ¬¡ä¸åŒºåˆ†å¤§å°å†™ï¼ˆç”±_ciè¡¨ç¤ºï¼‰ã€‚</p></blockquote></li><li><p>é€šå¸¸ç³»ç»Ÿç®¡ç†åœ¨å®‰è£…æ—¶å®šä¹‰ä¸€ä¸ªé»˜è®¤çš„å­—ç¬¦é›†å’Œæ ¡å¯¹ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'character%'</span><span class="token punctuation">;</span><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'collation%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å¯ä»¥åœ¨åˆ›å»ºæ•°æ®åº“æ—¶ï¼ŒæŒ‡å®šé»˜è®¤çš„å­—ç¬¦é›†å’Œæ ¡å¯¹ã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>    c1 <span class="token keyword">INT</span><span class="token punctuation">,</span>    c2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> hebrew  <span class="token keyword">COLLATE</span> hebrew_general_ci<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸€èˆ¬ï¼ŒMySQLå¦‚ä¸‹ç¡®å®šä½¿ç”¨ä»€ä¹ˆæ ·çš„å­—ç¬¦é›†å’Œæ ¡å¯¹ï¼š</p><ol><li>å¦‚æœæŒ‡å®šCHARACTER SETå’ŒCOLLATEä¸¤è€…ï¼Œåˆ™ä½¿ç”¨è¿™äº›å€¼ã€‚</li><li>å¦‚æœåªæŒ‡å®šCHARACTER SETï¼Œåˆ™ä½¿ç”¨æ­¤å­—ç¬¦é›†åŠå…¶é»˜è®¤çš„æ ¡å¯¹ï¼ˆå¦‚SHOW CHARACTER SETçš„ç»“æœä¸­æ‰€ç¤ºï¼‰ã€‚</li><li>å¦‚æœæ—¢ä¸æŒ‡å®šCHARACTER SETï¼Œä¹Ÿä¸æŒ‡å®šCOLLATEï¼Œåˆ™ä½¿ç”¨æ•°æ®åº“é»˜è®¤ã€‚</li></ol></li><li><p>MySQLè¿˜å…è®¸å¯¹æ¯ä¸ªåˆ—è®¾ç½®ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>    c1 <span class="token keyword">INT</span><span class="token punctuation">,</span>    c2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> latin1 <span class="token keyword">COLLATE</span> latin1_general_ci<span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> hebrew  <span class="token keyword">COLLATE</span> hebrew_general_ci<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ ¡å¯¹åœ¨å¯¹ç”¨ORDER BYå­å¥æ£€ç´¢å‡ºæ¥çš„æ•°æ®æ’åºæ—¶èµ·é‡è¦çš„ä½œç”¨ã€‚å¦‚æœä½ éœ€è¦ç”¨ä¸åˆ›å»ºè¡¨æ—¶ä¸åŒçš„æ ¡å¯¹é¡ºåºæ’åºç‰¹å®šçš„SELECTè¯­å¥ï¼Œå¯ä»¥åœ¨SELECTè¯­å¥è‡ªèº«ä¸­è¿›è¡Œï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> customers<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> lastname<span class="token punctuation">,</span> firstname <span class="token keyword">COLLATE</span> latin1_general_cs<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>é™¤äº†ORDER BYå­å¥ï¼ŒCOLLATEè¿˜å¯ä»¥ç”¨äºGROUP BYã€HAVINGã€èšé›†å‡½æ•°ã€åˆ«åç­‰ã€‚</p></blockquote></li><li><p>å¦‚æœç»å¯¹éœ€è¦ï¼Œä¸²å¯ä»¥åœ¨å­—ç¬¦é›†ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ä¸ºæ­¤ï¼Œä½¿ç”¨Cast()æˆ–Convert()å‡½æ•°ã€‚</p></li></ol><h2 id="ç¬¬28ç« -å®‰å…¨ç®¡ç†"><a href="#ç¬¬28ç« -å®‰å…¨ç®¡ç†" class="headerlink" title="ç¬¬28ç«  å®‰å…¨ç®¡ç†"></a>ç¬¬28ç«  å®‰å…¨ç®¡ç†</h2><ol><li><p>åˆ›å»ºç”¨æˆ·è´¦å·</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> ben IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>é‡å‘½åç”¨æˆ·è´¦å·</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">RENAME</span> <span class="token keyword">USER</span> ben <span class="token keyword">TO</span> kom<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åˆ é™¤ç”¨æˆ·è´¦å·</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">USER</span> kom<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨åˆ›å»ºç”¨æˆ·è´¦å·åï¼Œå¿…é¡»æ¥ç€åˆ†é…è®¿é—®æƒé™ã€‚æ–°åˆ›å»ºçš„ç”¨æˆ·è´¦å·æ²¡æœ‰è®¿é—®æƒé™ã€‚å®ƒä»¬èƒ½ç™»å½•MySQLï¼Œä½†ä¸èƒ½çœ‹åˆ°æ•°æ®ï¼Œä¸èƒ½æ‰§è¡Œä»»ä½•æ•°æ®åº“æ“ä½œã€‚æŸ¥çœ‹ç”¨æˆ·è´¦å·æƒé™ï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> kom<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>ç”¨æˆ·å®šä¹‰ä¸ºuser@hostã€‚</strong> MySQLçš„æƒé™ç”¨ç”¨æˆ·åå’Œä¸»æœºåç»“åˆå®šä¹‰ã€‚å¦‚æœä¸æŒ‡å®šä¸»æœºåï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ä¸»æœºå%ï¼ˆæˆäºˆç”¨æˆ·è®¿é—®æƒé™è€Œä¸ç®¡ä¸»æœºåï¼‰ã€‚</p></blockquote></li><li><p>ä¸ºè®¾ç½®æƒé™ï¼Œä½¿ç”¨GRANTè¯­å¥ã€‚GRANTè¦æ±‚ä½ è‡³å°‘ç»™å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p><ol><li>è¦æˆäºˆçš„æƒé™ï¼›</li><li>è¢«æˆäºˆè®¿é—®æƒé™çš„æ•°æ®åº“æˆ–è¡¨ï¼›</li><li><p>ç”¨æˆ·åã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> kom<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol></li><li><p>æ’¤é”€ç‰¹å®šçš„æƒé™ä½¿ç”¨REVOKEï¼š</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> kom<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>GRANTå’ŒREVOKEå¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸Šæ§åˆ¶è®¿é—®æƒé™ï¼š</p><ol><li>æ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨GRANT ALLå’ŒREVOKE ALLï¼›</li><li>æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨ON database.*ï¼›</li><li>ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨ON database.tableï¼›</li><li>ç‰¹å®šçš„åˆ—ï¼›</li><li>ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚</li></ol></li><li><p>æ›´æ”¹å¯†ç </p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> kom <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>ä¸æŒ‡å®šç”¨æˆ·åæ—¶ï¼ŒSET PASSWORDæ›´æ–°å½“å‰ç™»å½•ç”¨æˆ·çš„å£ä»¤ã€‚<code>SET PASSWORD = PASSWORD('789')</code></p></blockquote></li><li><p>åœ¨ä½¿ç”¨GRANTå’ŒREVOKEæ—¶ï¼Œç”¨æˆ·è´¦å·å¿…é¡»å­˜åœ¨ï¼Œä½†å¯¹æ‰€æ¶‰åŠçš„å¯¹è±¡æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚è¿™å…è®¸ç®¡ç†å‘˜åœ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨ä¹‹å‰è®¾è®¡å’Œå®ç°å®‰å…¨æªæ–½ã€‚è¿™æ ·åšçš„å‰¯ä½œç”¨æ˜¯ï¼Œå½“æŸä¸ªæ•°æ®åº“æˆ–è¡¨è¢«åˆ é™¤æ—¶ï¼ˆç”¨DROPè¯­å¥ï¼‰ï¼Œç›¸å…³çš„è®¿é—®æƒé™ä»ç„¶å­˜åœ¨ã€‚è€Œä¸”ï¼Œå¦‚æœå°†æ¥é‡æ–°åˆ›å»ºè¯¥æ•°æ®åº“æˆ–è¡¨ï¼Œè¿™äº›æƒé™ä»ç„¶èµ·ä½œç”¨ã€‚</p></li><li><p>å¯é€šè¿‡åˆ—å‡ºå„æƒé™å¹¶ç”¨é€—å·åˆ†éš”ï¼Œ å°†å¤šæ¡GRANTè¯­å¥ä¸²åœ¨ä¸€èµ·ã€‚</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">GRANT SELECT, INSERT ON crashcourse.* TO kom<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>æƒé™åˆ—è¡¨</li></ol><div class="table-container"><table><thead><tr><th><strong>æƒé™</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>ALL</td><td>é™¤GRANT OPTIONå¤–çš„æ‰€æœ‰æƒé™</td></tr><tr><td>ALTER</td><td>ä½¿ç”¨ALTER TABLE</td></tr><tr><td>ALTER ROUTINE</td><td>ä½¿ç”¨ALTER PROCEDUREå’ŒDROP PROCEDURE</td></tr><tr><td>CREATE</td><td>ä½¿ç”¨CREATE TABLE</td></tr><tr><td>CREATE ROUTINE</td><td>ä½¿ç”¨CREATE PROCEDURE</td></tr><tr><td>CREATE TEMPORARY TABLES</td><td>ä½¿ç”¨CREATE TEMPORARY TABLE</td></tr><tr><td>CREATE USER</td><td>ä½¿ç”¨CREATE USERã€DROP USERã€RENAME USERå’ŒREVOKE ALL PRIVILEGES</td></tr><tr><td>CREATE VIEW</td><td>ä½¿ç”¨CREATE VIEW</td></tr><tr><td>DELETE</td><td>ä½¿ç”¨DELETE</td></tr><tr><td>DROP</td><td>ä½¿ç”¨DROP TABLE</td></tr><tr><td>EXECUTE</td><td>ä½¿ç”¨CALLå’Œå­˜å‚¨è¿‡ç¨‹</td></tr><tr><td>FILE</td><td>ä½¿ç”¨SELECT INTO OUTFILEå’ŒLOAD DATA INFILE</td></tr><tr><td>GRANT OPTION</td><td>ä½¿ç”¨GRANTå’ŒREVOKE</td></tr><tr><td>INDEX</td><td>ä½¿ç”¨CREATE INDEXå’ŒDROP INDEX</td></tr><tr><td>INSERT</td><td>ä½¿ç”¨INSERT</td></tr><tr><td>LOCK TABLES</td><td>ä½¿ç”¨LOCK TABLES</td></tr><tr><td>PROCESS</td><td>ä½¿ç”¨SHOW FULL PROCESSLIST</td></tr><tr><td>RELOAD</td><td>ä½¿ç”¨FLUSH</td></tr><tr><td>REPLICATION CLIENT</td><td>æœåŠ¡å™¨ä½ç½®çš„è®¿é—®</td></tr><tr><td>REPLICATION SLAVE</td><td>ç”±å¤åˆ¶ä»å±ä½¿ç”¨</td></tr><tr><td>SELECT</td><td>ä½¿ç”¨SELECT</td></tr><tr><td>SHOW DATABASES</td><td>ä½¿ç”¨SHOW DATABASES</td></tr><tr><td>SHOW VIEW</td><td>ä½¿ç”¨SHOW CREATE VIEW</td></tr><tr><td>SHUTDOWN</td><td>ä½¿ç”¨mysqladmin shutdownï¼ˆç”¨æ¥å…³é—­MySQLï¼‰</td></tr><tr><td>SUPER</td><td>ä½¿ç”¨CHANGE MASTERã€KILLã€LOGSã€PURGEã€MASTER å’ŒSET GLOBALã€‚è¿˜å…è®¸mysqladminè°ƒè¯•ç™»å½•</td></tr><tr><td>UPDATE</td><td>ä½¿ç”¨UPDATE</td></tr><tr><td>USAGE</td><td>æ— è®¿é—®æƒé™</td></tr></tbody></table></div><h2 id="ç¬¬29ç« -æ•°æ®åº“ç»´æŠ¤"><a href="#ç¬¬29ç« -æ•°æ®åº“ç»´æŠ¤" class="headerlink" title="ç¬¬29ç«  æ•°æ®åº“ç»´æŠ¤"></a>ç¬¬29ç«  æ•°æ®åº“ç»´æŠ¤</h2><ol><li><p>å¤‡ä»½æ•°æ®</p><ol><li>ä½¿ç”¨å‘½ä»¤è¡Œå®ç”¨ç¨‹åºmysqldumpè½¬å‚¨æ‰€æœ‰æ•°æ®åº“å†…å®¹åˆ°æŸä¸ªå¤–éƒ¨æ–‡ä»¶ã€‚åœ¨è¿›è¡Œå¸¸è§„å¤‡ä»½å‰è¿™ä¸ªå®ç”¨ç¨‹åºåº”è¯¥æ­£å¸¸è¿è¡Œï¼Œä»¥ä¾¿èƒ½æ­£ç¡®åœ°å¤‡ä»½è½¬å‚¨æ–‡ä»¶ã€‚</li><li>å¯ç”¨å‘½ä»¤è¡Œå®ç”¨ç¨‹åº mysqlhotcopy ä»ä¸€ä¸ªæ•°æ®åº“å¤åˆ¶æ‰€æœ‰æ•°æ® ï¼ˆå¹¶éæ‰€æœ‰æ•°æ®åº“å¼•æ“éƒ½æ”¯æŒè¿™ä¸ªå®ç”¨ç¨‹åºï¼‰ã€‚</li><li><p>å¯ä»¥ä½¿ç”¨MySQLçš„BACKUP TABLEæˆ–SELECT INTO OUTFILEè½¬å‚¨æ‰€æœ‰æ•°æ®åˆ°æŸä¸ªå¤–éƒ¨æ–‡ä»¶ã€‚è¿™ä¸¤æ¡è¯­å¥éƒ½æ¥å—å°†è¦åˆ›å»ºçš„ç³»ç»Ÿæ–‡ä»¶åï¼Œæ­¤ç³»ç»Ÿæ–‡ä»¶å¿…é¡»ä¸å­˜åœ¨ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚æ•°æ®å¯ä»¥ç”¨RESTORE TABLEæ¥å¤åŸã€‚</p><blockquote><p>ä¸ºäº†ä¿è¯æ‰€æœ‰æ•°æ®è¢«å†™åˆ°ç£ç›˜ï¼ˆåŒ…æ‹¬ç´¢å¼•æ•°æ®ï¼‰å¯èƒ½éœ€è¦åœ¨è¿›è¡Œå¤‡ä»½å‰ä½¿ç”¨FLUSH TABLESè¯­å¥ã€‚</p></blockquote></li></ol></li><li><p>è¿›è¡Œæ•°æ®åº“ç»´æŠ¤</p><ol><li><p>æ£€æŸ¥è¡¨é”®æ˜¯å¦æ­£ç¡®</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ANALYZE</span> <span class="token keyword">TABLE</span> orders<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>CHECK TABLEç”¨æ¥é’ˆå¯¹è®¸å¤šé—®é¢˜å¯¹è¡¨è¿›è¡Œæ£€æŸ¥ã€‚åœ¨MyISAMè¡¨ä¸Šè¿˜å¯¹ç´¢å¼•è¿›è¡Œæ£€æŸ¥ã€‚CHECK TABLEæ”¯æŒä¸€ç³»åˆ—çš„ç”¨äºMyISAMè¡¨çš„æ–¹å¼ã€‚ CHANGEDæ£€æŸ¥è‡ªæœ€åä¸€æ¬¡æ£€æŸ¥ä»¥æ¥æ”¹åŠ¨è¿‡çš„è¡¨ã€‚EXTENDEDæ‰§è¡Œæœ€å½»åº•çš„æ£€æŸ¥ï¼ŒFASTåªæ£€æŸ¥æœªæ­£å¸¸å…³é—­çš„è¡¨ï¼ŒMEDIUMæ£€æŸ¥æ‰€æœ‰è¢«åˆ é™¤çš„é“¾æ¥å¹¶è¿›è¡Œé”®æ£€éªŒï¼ŒQUICKåªè¿›è¡Œå¿«é€Ÿæ‰«æã€‚</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CHECK</span> <span class="token keyword">TABLE</span> orders<span class="token punctuation">,</span> orderitems FAST <span class="token keyword">QUICK</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å¦‚æœ MyISAM è¡¨è®¿é—®äº§ç”Ÿä¸æ­£ç¡®å’Œä¸ä¸€è‡´çš„ç»“æœï¼Œå¯èƒ½éœ€è¦ç”¨REPAIR TABLEæ¥ä¿®å¤ç›¸åº”çš„è¡¨ã€‚è¿™æ¡è¯­å¥ä¸åº”è¯¥ç»å¸¸ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦ç»å¸¸ä½¿ç”¨ï¼Œå¯èƒ½ä¼šæœ‰æ›´å¤§çš„é—®é¢˜è¦è§£å†³ã€‚</p><p>å¦‚æœä»ä¸€ä¸ªè¡¨ä¸­åˆ é™¤å¤§é‡æ•°æ®ï¼Œåº”è¯¥ä½¿ç”¨OPTIMIZE TABLEæ¥æ”¶å›æ‰€ç”¨çš„ç©ºé—´ï¼Œä»è€Œä¼˜åŒ–è¡¨çš„æ€§èƒ½ã€‚</p></blockquote></li></ol></li></ol><h2 id="ç¬¬30ç« -æ”¹å–„æ€§èƒ½"><a href="#ç¬¬30ç« -æ”¹å–„æ€§èƒ½" class="headerlink" title="ç¬¬30ç«  æ”¹å–„æ€§èƒ½"></a>ç¬¬30ç«  æ”¹å–„æ€§èƒ½</h2><ol><li>å¯ä½¿ç”¨<code>SHOW PROCESSLIST</code> æ˜¾ç¤ºæ‰€æœ‰æ´»åŠ¨è¿›ç¨‹ï¼ˆä»¥åŠå®ƒä»¬çš„çº¿ç¨‹IDå’Œæ‰§è¡Œæ—¶é—´ï¼‰ã€‚å¯ä»¥ç”¨KILLå‘½ä»¤ç»ˆç»“æŸä¸ªç‰¹å®šçš„è¿›ç¨‹ï¼ˆä½¿ç”¨è¿™ä¸ªå‘½ä»¤éœ€è¦ä½œä¸ºç®¡ç†å‘˜ç™»å½•ï¼‰ã€‚</li><li>ä½¿ç”¨EXPLAINè¯­å¥è®©MySQLè§£é‡Šå®ƒå°†å¦‚ä½•æ‰§è¡Œä¸€æ¡SELECTè¯­å¥ã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œå­˜å‚¨è¿‡ç¨‹æ‰§è¡Œå¾—æ¯”ä¸€æ¡ä¸€æ¡åœ°æ‰§è¡Œå…¶ä¸­çš„å„æ¡MySQL è¯­å¥å¿«ã€‚</li><li>æœ‰çš„æ“ä½œï¼ˆåŒ…æ‹¬INSERTï¼‰æ”¯æŒä¸€ä¸ªå¯é€‰çš„DELAYEDå…³é”®å­—ï¼Œå¦‚æœä½¿ç”¨å®ƒï¼Œå°†æŠŠæ§åˆ¶ç«‹å³è¿”å›ç»™è°ƒç”¨ç¨‹åºï¼Œå¹¶ä¸”ä¸€æ—¦æœ‰å¯èƒ½å°±å®é™…æ‰§è¡Œè¯¥æ“ä½œã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MYSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºåŒ–å­¦ä¹ ä¸­çš„ç­–ç•¥æ¢¯åº¦ä¸baseline</title>
      <link href="qiang-hua-xue-xi-zhong-de-ce-lue-ti-du-yu-baseline/"/>
      <url>qiang-hua-xue-xi-zhong-de-ce-lue-ti-du-yu-baseline/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç­–ç•¥æ¢¯åº¦ä¸­çš„-baseline"><a href="#ä¸€ã€ç­–ç•¥æ¢¯åº¦ä¸­çš„-baseline" class="headerlink" title="ä¸€ã€ç­–ç•¥æ¢¯åº¦ä¸­çš„ baseline"></a>ä¸€ã€ç­–ç•¥æ¢¯åº¦ä¸­çš„ baseline</h2><blockquote><p>æœ¬å°ç»“çš„ä¸»è¦å†…å®¹æ˜¯åšæ•°å­¦æ¨å¯¼å¾—åˆ°å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦çš„å…¬å¼ã€‚</p></blockquote><p>ç­–ç•¥æ¢¯åº¦æ–¹æ³•å¸¸ç”¨ baseline æ¥é™ä½æ–¹å·®ï¼Œå¯ä»¥è®©æ”¶æ•›æ›´å¿«ã€‚</p><h3 id="1-1-baseline-çš„æ€§è´¨"><a href="#1-1-baseline-çš„æ€§è´¨" class="headerlink" title="1.1 baseline çš„æ€§è´¨"></a>1.1 baseline çš„æ€§è´¨</h3><p>baseline æŒ‡çš„æ˜¯ä¸€ä¸ªå‡½æ•° b ï¼Œå®ƒä¸ä¾èµ–äºåŠ¨ä½œ $A$ ï¼Œå¯ä»¥å¾—åˆ°å…¬å¼ï¼š</p><script type="math/tex; mode=display">\mathbb{E}_{A \sim \pi} \left[ b \cdot \frac{\partial \log \pi(A|s; \theta)}{\partial \theta} \right] = 0 \tag{1.1}</script><p>è¯æ˜è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathbb{E}_{A \sim \pi} \left[ b \cdot \frac{\partial \log \pi(A|s; \theta)}{\partial \theta} \right] \\& ï¼ˆb ä¸ä¾èµ–ä¸åŠ¨ä½œ Aï¼‰ \\& = b \cdot \mathbb{E}_{A \sim \pi} \left[ \frac{\partial \log \pi(A|s; \theta)}{\partial \theta} \right] \\& ï¼ˆå‡è®¾åŠ¨ä½œæ˜¯ç¦»æ•£çš„ï¼Œå±•å¼€æœŸæœ›ï¼‰ \\& = b \cdot \sum_{a \in A}\pi(a|s; \theta) \frac{\partial \log \pi(a|s; \theta)}{\partial \theta} \\& ï¼ˆæ±‚å¯¼çš„é“¾å¼æ³•åˆ™ï¼‰ \\& = b \cdot \sum_{a \in A}\pi(a|s; \theta) \left[ \frac{1}{\pi(a|s; \theta)} \cdot \frac{\partial \pi(a|s; \theta)}{\partial \theta} \right] \\& = b \cdot \sum_{a \in A} \frac{\partial \pi(a|s; \theta)}{\partial \theta} \\& ï¼ˆè¿åŠ ä¸æ±‚å¯¼çš„å¯¹è±¡ä¸åŒï¼‰ \\& = b \cdot \frac{\partial \sum_{a \in A} \pi(a|s; \theta)}{\partial \theta} \\& ï¼ˆæ‰€æœ‰åŠ¨ä½œçš„æ¦‚ç‡å’Œä¸º1ï¼‰ \\& = b \cdot \frac{\partial 1}{\partial \theta} \\& ï¼ˆå¸¸æ•°çš„å¯¼æ•°ä¸º0ï¼‰ \\& = 0 \\\end{aligned}</script><h3 id="1-2-å¸¦-baseline-çš„ç­–ç•¥æ¢¯åº¦å…¬å¼"><a href="#1-2-å¸¦-baseline-çš„ç­–ç•¥æ¢¯åº¦å…¬å¼" class="headerlink" title="1.2 å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦å…¬å¼"></a>1.2 å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦å…¬å¼</h3><p>åœ¨<a href="https://kibazen.cn/ji-yu-ce-lue-de-qiang-hua-xue-xi/">åŸºäºç­–ç•¥çš„å¼ºåŒ–å­¦ä¹ </a>ä¸­æ¨å¯¼äº†ç­–ç•¥æ¢¯åº¦çš„å…¬å¼ï¼š</p><script type="math/tex; mode=display">\frac{\partial V(s; \theta)}{\partial \theta} = \mathbb{E}_{A \sim \pi(\cdot | s; \theta)} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, A) \right]</script><p>ç»“åˆä¸Šé¢æ¨å¯¼å¾—åˆ°å…¬å¼1å’Œç­–ç•¥æ¢¯åº¦å…¬å¼ï¼Œå¯ä»¥å¾—åˆ° <strong>å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦å…¬å¼</strong> ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\frac{\partial V_{\pi}(s)}{\partial \theta}& = \mathbb{E}_{A \sim \pi} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, A) \right] \\& = \mathbb{E}_{A \sim \pi} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, A) \right] - 0 \\& = \mathbb{E}_{A \sim \pi} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, A) \right] - \mathbb{E}_{A \sim \pi} \left[ b \cdot \frac{\partial \log \pi(A|s; \theta)}{\partial \theta} \right] \\& = \mathbb{E}_{A \sim \pi} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot \left( Q_{\pi}(s, A) - b \right) \right]\end{aligned}</script><p>å³ï¼Œå¦‚æœ baseline å‡½æ•° b ä¸ä¾èµ–äºåŠ¨ä½œ $A_t$ï¼Œä¸‹é¢å…¬å¼æˆç«‹ï¼š</p><script type="math/tex; mode=display">\frac{\partial V_{\pi}(s_t)}{\partial \theta} = \mathbb{E}_{A_t \sim \pi} \left[ \frac{\partial \log \pi(A_t | s_t; \theta)}{\partial \theta} \cdot \left( Q_{\pi}(s_t, A_t) - b \right) \right] \tag{1.2}</script><p>ä»å…¬å¼ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šbaseline ä¸ä¼šå½±å“ç­–ç•¥æ¢¯åº¦çš„æ­£ç¡®æ€§ï¼Œä¸ç®¡å‡½æ•° b æ˜¯ä»€ä¹ˆï¼Œå¾—åˆ°çš„æœŸæœ›éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h3 id="1-3-è’™ç‰¹å¡æ´›è¿‘ä¼¼"><a href="#1-3-è’™ç‰¹å¡æ´›è¿‘ä¼¼" class="headerlink" title="1.3 è’™ç‰¹å¡æ´›è¿‘ä¼¼"></a>1.3 è’™ç‰¹å¡æ´›è¿‘ä¼¼</h3><p>å°† <strong>å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦å…¬å¼</strong> ä¸­æ±‚æœŸæœ›çš„éƒ¨åˆ†è®°ä½œ $g(A_t)$ï¼Œå³ï¼š</p><script type="math/tex; mode=display">g(A_t) = \frac{\partial \log \pi(A_t | s_t; \theta)}{\partial \theta} \cdot \left( Q_{\pi}(s_t, A_t) - b \right)</script><ol><li>ä»ç­–ç•¥ $\pi(\cdot | s; \theta)$ ä¸­æŠ½æ ·å‡ºåŠ¨ä½œ $a_t$ï¼Œç„¶åè®¡ç®— $g(a_t)$ ã€‚è®¡ç®—å¾—åˆ°çš„ $g(a_t)$ å°±æ˜¯ $\mathbb{E}_{A_t \sim \pi} \left[ g(A_t) \right]$ çš„è’™ç‰¹å¡æ´›è¿‘ä¼¼ã€‚</li><li>$g(a_t)$ æ˜¯ç­–ç•¥æ¢¯åº¦çš„ä¸€ä¸ªæ— åä¼°è®¡ï¼Œè¿™æ˜¯å› ä¸º $g(A_t)$ å…³äº $A_t$ çš„æœŸæœ›ç­‰äºç­–ç•¥æ¢¯åº¦ã€‚$g(a_t)$ å…¶å®æ˜¯ä¸€ä¸ªéšæœºæ¢¯åº¦ï¼Œå®ƒæ˜¯å¯¹ç­–ç•¥æ¢¯åº¦çš„è’™ç‰¹å¡æ´›è¿‘ä¼¼ã€‚å®é™…è®­ç»ƒç­–ç•¥ç½‘ç»œçš„æ—¶å€™ï¼Œç”¨çš„éƒ½æ˜¯éšæœºæ¢¯åº¦ $g(a_t)$ ï¼Œè€Œä¸æ˜¯ç”¨çœŸæ­£çš„ç­–ç•¥æ¢¯åº¦ã€‚<script type="math/tex; mode=display">\mathbb{E}_{A_t \sim \pi} \left[ g(A_t) \right] = \frac{\partial V_{\pi}(s_t)}{\partial \theta}</script></li><li>ä½¿ç”¨éšæœºæ¢¯åº¦ä¸Šå‡æ›´æ–°ç­–ç•¥ç½‘ç»œçš„å‚æ•° $\theta$<script type="math/tex; mode=display">\theta \leftarrow \theta + \beta \cdot g(a_t)</script></li></ol><p>ä» <strong>å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦å…¬å¼</strong> çœ‹åˆ°ï¼Œè™½ç„¶ä½¿ç”¨ä¸åŒçš„ baseline å‡½æ•° b ä¸ä¼šæ”¹å˜æœŸæœ› $\mathbb{E}_{A_t \sim \pi} \left[ g(A_t) \right]$ çš„å€¼ï¼Œä½†æ˜¯ä¼šå½±å“ $g(a_t)$ çš„å€¼ã€‚å¦‚æœé€‰æ‹©çš„baseline å‡½æ•° b å¾ˆå¥½ï¼Œæ¥è¿‘ $Q_{\pi}(s_t, A_t)$ï¼Œéšæœºç­–ç•¥æ¢¯åº¦ $g(a_t)$ çš„æ–¹å·®å°±ä¼šå˜å°ï¼Œå°±èƒ½è®©ç®—æ³•æ”¶æ•›æ›´å¿«ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ baseline å‡½æ•° b çš„åŸå› ã€‚</p><h3 id="1-4-baseline-çš„é€‰æ‹©"><a href="#1-4-baseline-çš„é€‰æ‹©" class="headerlink" title="1.4 baseline çš„é€‰æ‹©"></a>1.4 baseline çš„é€‰æ‹©</h3><ol><li><p>b=0</p><p> ç›¸å½“äºä¸é€‚ç”¨ baselineï¼Œå¾—åˆ°çš„æ˜¯æ ‡å‡†çš„ç­–ç•¥æ¢¯åº¦ã€‚</p><script type="math/tex; mode=display">\frac{\partial V_{\pi}(s_t)}{\partial \theta} = \mathbb{E}_{A_t \sim \pi} \left[ \frac{\partial \log \pi(A_t | s_t; \theta)}{\partial \theta} \cdot Q_{\pi}(s_t, A_t) \right]</script></li><li><p>$b=V_{\pi}(s_t)$<br> å› ä¸º $V_{\pi}(s_t)$ åªä¾èµ–äºå½“å‰çŠ¶æ€çš„ $s_t$ï¼ŒçŠ¶æ€ $s_t$ æ˜¯å…ˆäº $A_t$ è¢«è§‚æµ‹åˆ°çš„ï¼Œæ‰€ä»¥ $s_t$ ä¸ä¾èµ–äº $A_t$ï¼Œå¯ä»¥ä½œä¸º baseline ã€‚</p><p> è€Œé€‰æ‹©ä½¿ç”¨ $V_{\pi}(s_t)$ ä½œä¸º baseline çš„åŸå› åœ¨äºï¼Œ$V_{\pi}(s_t)$ çš„å€¼æ¥è¿‘ $Q_{\pi}(s_t, A_t)$ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é™ä½æ–¹å·®ã€‚</p><script type="math/tex; mode=display">V_{\pi}(s_t) = \mathbb{E}_{A_t}[Q_{\pi}(s_t, A_t)]</script></li></ol><h2 id="äºŒã€REINFORCE-with-Baseline"><a href="#äºŒã€REINFORCE-with-Baseline" class="headerlink" title="äºŒã€REINFORCE with Baseline"></a>äºŒã€REINFORCE with Baseline</h2><h3 id="2-1-è¿‘ä¼¼å¸¦-baseline-çš„ç­–ç•¥æ¢¯åº¦"><a href="#2-1-è¿‘ä¼¼å¸¦-baseline-çš„ç­–ç•¥æ¢¯åº¦" class="headerlink" title="2.1 è¿‘ä¼¼å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦"></a>2.1 è¿‘ä¼¼å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦</h3><p>åœ¨<a href="#14-baseline-çš„é€‰æ‹©">1.4 baseline çš„é€‰æ‹©</a>ä¸­ï¼Œè¯æ˜äº†å¯ä»¥ä½¿ç”¨ $V_{\pi}(s_t)$ æ¥ä½œä¸º Baselineï¼š</p><script type="math/tex; mode=display">\frac{\partial V_{\pi}(s_t)}{\partial \theta} = \mathbb{E}_{A_t \sim \pi} \left[ \frac{\partial \log \pi(A_t | s_t; \theta)}{\partial \theta} \cdot \left( Q_{\pi}(s_t, A_t) - V_{\pi}(s_t) \right) \right]</script><p>åœ¨ä½¿ç”¨è¿™ä¸ªå…¬å¼è®­ç»ƒæ—¶ï¼Œéœ€è¦åšæ€»å…±3æ­¥è¿‘ä¼¼ï¼š</p><ol><li><p>ä½¿ç”¨éšæœºç­–ç•¥æ¢¯åº¦æ¥è¿‘ä¼¼çœŸæ­£çš„ç­–ç•¥æ¢¯åº¦çš„æœŸæœ›ï¼ˆè’™ç‰¹å¡æ´›è¿‘ä¼¼ï¼‰<br> è®° $g(A_t)$ ä¸ºï¼š</p><script type="math/tex; mode=display">g(A_t) = \frac{\partial \log \pi(A_t | s_t; \theta)}{\partial \theta} \cdot \left( Q_{\pi}(s_t, A_t) - V_{\pi}(s_t) \right)</script><p> ä»ç­–ç•¥ $\pi(\cdot | s; \theta)$ ä¸­æŠ½æ ·å‡ºåŠ¨ä½œ $a_t$ï¼Œç„¶åä½¿ç”¨éšæœºç­–ç•¥æ¢¯åº¦ $g(a_t)$ çš„å€¼æ¥ä»£æ›¿çœŸæ­£çš„ç­–ç•¥æ¢¯åº¦çš„æœŸæœ› $\mathbb{E}_{A_t \sim \pi} \left[ g(A_t) \right]$ çš„å€¼ã€‚</p></li><li><p>ä½¿ç”¨æŠ˜æ‰£å›æŠ¥æ¥è¿‘ä¼¼ $Q_{\pi}(s_t, a_t)$ çš„å€¼ï¼ˆå†ä¸€æ¬¡è’™ç‰¹å¡æ´›è¿‘ä¼¼ï¼‰<br> ç»è¿‡äº†ä¸Šä¸€æ­¥çš„è¿‘ä¼¼åï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">g(a_t) = \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \cdot \left( Q_{\pi}(s_t, a_t) - V_{\pi}(s_t) \right)</script><p> å¾—åˆ°çš„ç­‰å¼ä¸­ï¼Œ$Q_{\pi}(s_t, a_t)$ å’Œ $V_{\pi}(s_t)$ ä¾ç„¶æ˜¯æœªçŸ¥çš„ã€‚</p><p> ä½¿ç”¨ç­–ç•¥ $\pi(\cdot | s; \theta)$ æ§åˆ¶æ™ºèƒ½ä½“ç©ä¸€å±€æ¸¸æˆåˆ°ç»“æŸï¼Œå¾—åˆ°è½¨è¿¹ï¼š</p><script type="math/tex; mode=display">s_t, a_t, r_t, s_{t+1}, a_{t+1}, r_{t+1}, \cdots, s_n, a_n, r_n</script><p> è®¡ç®—æŠ˜æ‰£å›æŠ¥ï¼š</p><script type="math/tex; mode=display">u_t = \sum_{i=t}^n \gamma^{i-t} r_i</script><p> æŠ˜æ‰£å›æŠ¥ $u_t$ å°±æ˜¯ $Q_{\pi}(s_t, a_t)$ çš„æ— åä¼°è®¡ã€‚REINFORCE ç®—æ³•å°±æ˜¯ä½¿ç”¨æŠ˜æ‰£å›æŠ¥ $u_t$ æ¥è¿‘ä¼¼ $Q_{\pi}(s_t, a_t)$ çš„å€¼ã€‚</p></li><li><p>ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è¿‘ä¼¼ $V_{\pi}(s_t)$ï¼ˆå‡½æ•°è¿‘ä¼¼ï¼‰</p><p> ä½¿ç”¨ç¥ç»ç½‘ç»œ $v(s; \mathbf{w})$ æ¥è¿‘ä¼¼ $V_{\pi}(s_t)$ çš„å€¼ã€‚</p></li></ol><p>ç»è¿‡3æ­¥è¿‘ä¼¼åï¼Œå¯ä»¥å¾—åˆ° <strong>è¿‘ä¼¼åçš„å¸¦ baseline çš„ç­–ç•¥æ¢¯åº¦</strong> ï¼š</p><script type="math/tex; mode=display">\frac{\partial V_{\pi}(s_t)}{\partial \theta} \approx g(a_t) \approx \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \cdot \left( u_t - v(s_t; \mathbf{w}) \right)</script><h3 id="2-2-ç®—æ³•è®­ç»ƒæµç¨‹"><a href="#2-2-ç®—æ³•è®­ç»ƒæµç¨‹" class="headerlink" title="2.2 ç®—æ³•è®­ç»ƒæµç¨‹"></a>2.2 ç®—æ³•è®­ç»ƒæµç¨‹</h3><ol><li><p>ä½¿ç”¨ç­–ç•¥ $\pi(\cdot | s; \theta)$ æ§åˆ¶æ™ºèƒ½ä½“ç©ä¸€å±€æ¸¸æˆåˆ°ç»“æŸï¼Œå¾—åˆ°è½¨è¿¹ï¼š</p><script type="math/tex; mode=display">s_t, a_t, r_t, s_{t+1}, a_{t+1}, r_{t+1}, \cdots, s_n, a_n, r_n</script></li><li><p>è®¡ç®—æŠ˜æ‰£å›æŠ¥ $u_t$ å’Œè¯¯å·® $\delta_t$</p><script type="math/tex; mode=display">u_t = \sum_{i=t}^n \gamma^{i-t} r_i</script><script type="math/tex; mode=display">\delta_t = v(s_t; \mathbf{w}) - u_tï¼ˆæ³¨æ„è¿™é‡Œæ˜¯v-qè€Œä¸æ˜¯q-vï¼‰</script></li><li><p>æ›´æ–°ç­–ç•¥ç½‘ç»œçš„å‚æ•° $\theta$</p><script type="math/tex; mode=display">\theta \leftarrow \theta - \beta \cdot \delta_t \cdot \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta}</script></li><li><p>æ›´æ–°ä»·å€¼ç½‘ç»œçš„å‚æ•° $\mathbf{w}$</p><script type="math/tex; mode=display">\mathbf{w} \leftarrow \mathbf{w} - \alpha \cdot \delta_t \cdot \frac{\partial v(s_t; \mathbf{w})}{\partial \mathbf{w}}</script><blockquote><p>å…¶ä¸­ $\delta_t \cdot \frac{\partial v(s_t; \mathbf{w})}{\partial \mathbf{w}}$ æ˜¯è¯¯å·® $\delta_t$ çš„å‡æ–¹å·®å…³äºå‚æ•° $\mathbf{w}$ çš„å¯¼æ•°</p><script type="math/tex; mode=display">\frac{\partial \delta_t ^2 / 2}{\partial \mathbf{w}} = \delta_t \cdot \frac{\partial v(s_t; \mathbf{w})}{\partial \mathbf{w}}</script></blockquote></li><li><p>å¯¹äºç¬¬1æ­¥ä¸­çš„æ¯ä¸ªæ—¶åˆ»ï¼Œé‡å¤ç¬¬2-4æ­¥ã€‚</p></li></ol><h2 id="ä¸‰ã€Advantage-Actor-Criticï¼ˆA2Cï¼‰ç®—æ³•"><a href="#ä¸‰ã€Advantage-Actor-Criticï¼ˆA2Cï¼‰ç®—æ³•" class="headerlink" title="ä¸‰ã€Advantage Actor-Criticï¼ˆA2Cï¼‰ç®—æ³•"></a>ä¸‰ã€Advantage Actor-Criticï¼ˆA2Cï¼‰ç®—æ³•</h2><blockquote><p>æŠŠ baseline ç”¨åˆ° Actor-Critic Method ä¸Šå¾—åˆ°çš„ç®—æ³•å°±æ˜¯A2Cç®—æ³•ã€‚</p></blockquote><h3 id="3-1-ç¥ç»ç½‘ç»œ"><a href="#3-1-ç¥ç»ç½‘ç»œ" class="headerlink" title="3.1 ç¥ç»ç½‘ç»œ"></a>3.1 ç¥ç»ç½‘ç»œ</h3><ol><li><p>ç­–ç•¥ç½‘ç»œï¼ˆActorï¼‰<br> ä¸åŸå§‹çš„ Actor-Critic Method ä¸­çš„ç­–ç•¥ç½‘ç»œï¼ˆActorï¼‰ç›¸åŒï¼Œä¾ç„¶æ˜¯ä½¿ç”¨ç¥ç»ç½‘ç»œ $\pi(a|s; \theta)$ æ¥è¿‘ä¼¼ç­–ç•¥å‡½æ•° $\pi({a|s})$ï¼Œå…¶ä¸­ $\theta$ æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ã€‚</p></li><li><p>ä»·å€¼ç½‘ç»œï¼ˆCriticï¼‰<br> <strong>ä»·å€¼ç½‘ç»œä½¿ç”¨çš„æ˜¯çŠ¶æ€ä»·å€¼ç½‘ç»œ $V_{\pi}(s)$ è€Œä¸æ˜¯åŠ¨ä½œä»·å€¼ç½‘ç»œ $Q_{\pi}(s, a)$</strong>ã€‚ä½¿ç”¨ç¥ç»ç½‘ç»œ $v(s; \mathbf{w})$ æ¥è¿‘ä¼¼ç­–ç•¥å‡½æ•° $V_{\pi}(s)$ï¼Œå…¶ä¸­ $\mathbf{w}$ æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ã€‚</p><blockquote><p>åŠ¨ä½œä»·å€¼ç½‘ç»œ $Q_{\pi}(s, a)$ ä¾èµ–äºçŠ¶æ€ $s$ å’Œ åŠ¨ä½œ $a$ ï¼Œè€ŒçŠ¶æ€ä»·å€¼ç½‘ç»œ $V_{\pi}(s)$ ä»…ä¾èµ–äºçŠ¶æ€ $s$ï¼Œä¸ä¾èµ–äºåŠ¨ä½œ $a$ï¼Œæ‰€ä»¥çŠ¶æ€ä»·å€¼ç½‘ç»œ $V_{\pi}(s)$ æ¯”åŠ¨ä½œä»·å€¼ç½‘ç»œ $Q_{\pi}(s, a)$ æ›´å¥½è®­ç»ƒã€‚</p></blockquote></li></ol><h3 id="3-2-è®­ç»ƒè¿‡ç¨‹"><a href="#3-2-è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="3.2 è®­ç»ƒè¿‡ç¨‹"></a>3.2 è®­ç»ƒè¿‡ç¨‹</h3><ol><li>è·å–åˆ°ä¸€ç»„ transition $(s_t, a_t, r_t, s_{t+1})$</li><li>è®¡ç®— <strong>TD target</strong><script type="math/tex; mode=display">y_t = r_t + \gamma \cdot v(s_{t+1}; \mathbf{w})</script></li><li>è®¡ç®— <strong>TD error</strong><script type="math/tex; mode=display">\delta_t = v(s_t; \mathbf{w}) - y_t</script></li><li>æ›´æ–°ç­–ç•¥ç½‘ç»œçš„å‚æ•° $\theta$<script type="math/tex; mode=display">\theta \leftarrow \theta - \beta \cdot \delta_t \cdot \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta}</script></li><li>æ›´æ–°ä»·å€¼ç½‘ç»œçš„å‚æ•° $\mathbf{w}$<script type="math/tex; mode=display">\mathbf{w} \leftarrow \mathbf{w} - \alpha \cdot \delta_t \cdot \frac{\partial v(s_t; \mathbf{w})}{\partial \mathbf{w}}</script></li></ol><h3 id="3-3-ç®—æ³•æ¨å¯¼"><a href="#3-3-ç®—æ³•æ¨å¯¼" class="headerlink" title="3.3 ç®—æ³•æ¨å¯¼"></a>3.3 ç®—æ³•æ¨å¯¼</h3><h4 id="3-3-1-ä»·å€¼å‡½æ•°æ€§è´¨çš„æ¨å¯¼"><a href="#3-3-1-ä»·å€¼å‡½æ•°æ€§è´¨çš„æ¨å¯¼" class="headerlink" title="3.3.1 ä»·å€¼å‡½æ•°æ€§è´¨çš„æ¨å¯¼"></a>3.3.1 ä»·å€¼å‡½æ•°æ€§è´¨çš„æ¨å¯¼</h4><p>åœ¨<a href="https://kibazen.cn/qiang-hua-xue-xi-zhong-shi-xu-chai-fen-xue-xi/">å¼ºåŒ–å­¦ä¹ ä¸­æ—¶åºå·®åˆ†å­¦ä¹ </a>æ¨å¯¼å‡ºäº†å…¬å¼ï¼š</p><script type="math/tex; mode=display">Q_{\pi}(s_t, a_t) = \mathbb{E}[R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})], \text{ for all }\pi</script><p>æ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">\begin{aligned}Q_{\pi}(s_t, a_t)& = \mathbb{E}[R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})] \\& = \mathbb{E}_{S_{t+1}, A_{t+1}}[R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})] \\& ï¼ˆR_t ä¸ A_{t+1} æ— å…³ï¼‰ \\& = \mathbb{E}_{S_{t+1}} \left[ R_t + \gamma \cdot \mathbb{E}_{A_{t+1}}[Q_{\pi}(S_{t+1}, A_{t+1})] \right] \\& ï¼ˆçŠ¶æ€ä»·å€¼å‡½æ•°çš„å®šä¹‰ï¼‰ \\& = \mathbb{E}_{S_{t+1}}[R_t + \gamma \cdot V_{\pi}(S_{t+1})] \\\end{aligned}</script><p>å³ï¼š</p><script type="math/tex; mode=display">Q_{\pi}(s_t, a_t) = \mathbb{E}_{S_{t+1}}[R_t + \gamma \cdot V_{\pi}(S_{t+1})] \tag{3.3.1a}</script><p>å¦ï¼Œæ ¹æ®çŠ¶æ€ä»·å€¼å‡½æ•°çš„å®šä¹‰ï¼š</p><script type="math/tex; mode=display">\begin{aligned}V_{\pi}(s_t)& = \mathbb{E}_{A_t}[Q_{\pi}(s_t, A_t)] \\& ï¼ˆä½¿ç”¨å…¬å¼3.3.1aï¼‰ \\& = \mathbb{E}_{A_t} \left[ \mathbb{E}_{S_{t+1}}[R_t + \gamma \cdot V_{\pi}(S_{t+1})] \right] \\& = \mathbb{E}_{A_t,S_{t+1}}[R_t + \gamma \cdot V_{\pi}(S_{t+1})] \\\end{aligned}</script><p>å³ï¼š</p><script type="math/tex; mode=display">V_{\pi}(s_t) = \mathbb{E}_{A_t,S_{t+1}}[R_t + \gamma \cdot V_{\pi}(S_{t+1})] \tag{3.3.1b}</script><h4 id="3-3-2-ä»·å€¼å‡½æ•°æ€§è´¨çš„è’™ç‰¹å¡æ´›è¿‘ä¼¼"><a href="#3-3-2-ä»·å€¼å‡½æ•°æ€§è´¨çš„è’™ç‰¹å¡æ´›è¿‘ä¼¼" class="headerlink" title="3.3.2 ä»·å€¼å‡½æ•°æ€§è´¨çš„è’™ç‰¹å¡æ´›è¿‘ä¼¼"></a>3.3.2 ä»·å€¼å‡½æ•°æ€§è´¨çš„è’™ç‰¹å¡æ´›è¿‘ä¼¼</h4><p>å‡è®¾æˆ‘ä»¬è·å–åˆ°ä¸€ç»„ transition $(s_t, a_t, r_t, s_{t+1})$</p><ol><li><p><strong>å…¬å¼3.3.1a</strong> å¯ä»¥è¿‘ä¼¼ä¸º</p><script type="math/tex; mode=display">Q_{\pi}(s_t, a_t) \approx r_t + \gamma \cdot V_{\pi}(s_{t+1}) \tag{3.3.2a}</script><p> åé¢ä¼šä½¿ç”¨è¿™ä¸ªå…¬å¼æ¥è¿‘ä¼¼ç­–ç•¥æ¢¯åº¦ï¼ŒA2Cç®—æ³•çš„å…³é”®ä¹Ÿåœ¨äºè¿™ä¸ªå…¬å¼ã€‚</p></li><li><p><strong>å…¬å¼3.3.1b</strong> å¯ä»¥è¿‘ä¼¼ä¸º</p><script type="math/tex; mode=display">V_{\pi}(s_t) \approx r_t + \gamma \cdot V_{\pi}(s_{t+1}) \tag{3.3.2b}</script><p> ä½¿ç”¨TDç®—æ³•è®­ç»ƒä»·å€¼ç½‘ç»œ $V_{\pi}(s_t)$ æ—¶ï¼Œ<strong>TD target</strong> å°±æ˜¯ç”±è¿™ä¸ªå…¬å¼æ¥çš„ã€‚</p></li></ol><h4 id="3-3-3-è®­ç»ƒç­–ç•¥ç½‘ç»œ"><a href="#3-3-3-è®­ç»ƒç­–ç•¥ç½‘ç»œ" class="headerlink" title="3.3.3 è®­ç»ƒç­–ç•¥ç½‘ç»œ"></a>3.3.3 è®­ç»ƒç­–ç•¥ç½‘ç»œ</h4><p>æœ¬æ–‡å‰é¢å®šä¹‰äº†éšæœºæ¢¯åº¦ $g(a_t)$</p><script type="math/tex; mode=display">g(a_t) = \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \cdot \left( Q_{\pi}(s_t, a_t) - V_{\pi}(s_t) \right)</script><blockquote><p>$g(a_t)$ ä¸­åŒ…å«äº† $Q_{\pi}(s_t, a_t) - V_{\pi}(s_t)$ï¼Œè€Œ $Q_{\pi}(s_t, a_t) - V_{\pi}(s_t)$ æ­£å¥½æ˜¯ä¼˜åŠ¿å‡½æ•°ï¼ˆAdvantage functionï¼‰çš„å®šä¹‰ï¼Œæ‰€ä»¥ç®—æ³•åä¸­åŒ…å«äº† Advantage ã€‚</p></blockquote><p>ç»“åˆ $g(a_t)$ çš„å®šä¹‰å’Œ <strong>å…¬å¼3.3.2a</strong>ï¼Œæœ‰ï¼š</p><script type="math/tex; mode=display">g(a_t) \approx \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \cdot \left( r_t + \gamma \cdot V_{\pi}(s_{t+1}) - V_{\pi}(s_t) \right)</script><p>ä½¿ç”¨ç¥ç»ç½‘ç»œ $v(s;\mathbf{w})$ è¿‘ä¼¼çŠ¶æ€ä»·å€¼å‡½æ•° $V_{\pi}(s)$ï¼Œå¾—åˆ°ï¼š</p><script type="math/tex; mode=display">g(a_t) \approx \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \cdot \left( r_t + \gamma \cdot v(s_{t+1};\mathbf{w}) - v(s_t;\mathbf{w}) \right)</script><p>å°†å…¬å¼ä¸­çš„ $r_t + \gamma \cdot v(s_{t+1};\mathbf{w})$ è®°ä½œ $y_t$ã€‚</p><blockquote><p>$y_t$ å…¶å®å°±æ˜¯ <strong>TD target</strong>ï¼Œåé¢æ›´æ–°ä»·å€¼ç½‘ç»œæ—¶ä¹Ÿä¼šç”¨åˆ°ã€‚</p></blockquote><p>æ—¢ç„¶è®¡ç®—å‡ºäº†è¿‘ä¼¼çš„ç­–ç•¥æ¢¯åº¦ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¢¯åº¦ä¸Šå‡æ¥è®­ç»ƒç­–ç•¥ç½‘ç»œäº†ï¼š</p><script type="math/tex; mode=display">\theta \leftarrow \theta + \beta \cdot \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \cdot (y_t - v(s_t; \mathbf{w}))</script><h4 id="3-3-4-è®­ç»ƒä»·å€¼ç½‘ç»œ"><a href="#3-3-4-è®­ç»ƒä»·å€¼ç½‘ç»œ" class="headerlink" title="3.3.4 è®­ç»ƒä»·å€¼ç½‘ç»œ"></a>3.3.4 è®­ç»ƒä»·å€¼ç½‘ç»œ</h4><p>å°† <strong>å…¬å¼3.3.2b</strong> ä¸­çš„ $V_{\pi}(S)$ ä½¿ç”¨ç¥ç»ç½‘ç»œ $v(S; \mathbf{w})$ è¿‘ä¼¼ï¼Œå¾—åˆ°ï¼š</p><script type="math/tex; mode=display">v(s_t; \mathbf{w}) \approx r_t + \gamma \cdot v(s_{t+1}; \mathbf{w})</script><p>å°† $r_t + \gamma \cdot v(s_{t+1}; \mathbf{w})$ è®°ä½œ $y_t$ã€‚ä½¿ç”¨TDç®—æ³•è®­ç»ƒæ—¶ï¼Œ $y_t$ å…¶å®å°±æ˜¯ <strong>TD target</strong> ã€‚</p><p>æ‰€ä»¥ <strong>TD error</strong> å°±æ˜¯ï¼š</p><script type="math/tex; mode=display">\delta_t = v(s_t; \mathbf{w}) - y_t</script><p>æ¢¯åº¦ï¼š</p><script type="math/tex; mode=display">\frac{\partial \delta_t ^2 / 2}{\partial \mathbf{w}} = \delta_t \cdot \frac{\partial v(s_t; \mathbf{w})}{\partial \mathbf{w}}</script><p>æœ€åä½¿ç”¨æ¢¯åº¦ä¸‹é™æ–¹æ³•æ¥æ›´æ–°ç½‘ç»œå‚æ•° $\mathbf{w}$ï¼š</p><script type="math/tex; mode=display">\mathbf{w} \leftarrow \mathbf{w} - \alpha \cdot \delta_t \cdot \frac{\partial v(s_t; \mathbf{w})}{\partial \mathbf{w}}</script><h4 id="3-3-5-å¯¹ç®—æ³•çš„ç›´è§‚ç†è§£"><a href="#3-3-5-å¯¹ç®—æ³•çš„ç›´è§‚ç†è§£" class="headerlink" title="3.3.5 å¯¹ç®—æ³•çš„ç›´è§‚ç†è§£"></a>3.3.5 å¯¹ç®—æ³•çš„ç›´è§‚ç†è§£</h4><p>å›é¡¾å¯¹ç­–ç•¥æ¢¯åº¦çš„è¿‘ä¼¼ï¼š</p><script type="math/tex; mode=display">g(a_t) \approx \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \cdot \left( r_t + \gamma \cdot v(s_{t+1};\mathbf{w}) - v(s_t;\mathbf{w}) \right)</script><p>è¿™ä¸ªå…¬å¼ç”¨æ¥æ›´æ–°ç­–ç•¥ç½‘ç»œ $\pi(a|s; \theta)$ã€‚</p><p>å…¬å¼ä¸­çš„ $r_t + \gamma \cdot v(s_{t+1};\mathbf{w}) - v(s_t;\mathbf{w})$ æ˜¯çŠ¶æ€ä»·å€¼ç½‘ç»œ $v(s;\mathbf{w})$ åšå‡ºçš„è¯„ä»·ã€‚å®ƒè¯„ä»·äº†åŠ¨ä½œ $a_t$ çš„å¥½åï¼Œå¯ä»¥æŒ‡å¯¼ç­–ç•¥ç½‘ç»œ $\pi(a|s; \theta)$ åšæ”¹è¿›ï¼Œæ‰€ä»¥çŠ¶æ€ä»·å€¼ç½‘ç»œ $v(s;\mathbf{w})$ è¢«ç§°ä¸º Critic ã€‚</p><p>ä½†æ˜¯ $r_t + \gamma \cdot v(s_{t+1};\mathbf{w}) - v(s_t;\mathbf{w})$ ä¸­å¹¶æœªåŒ…å«åŠ¨ä½œ $a_t$ï¼Œåˆæ˜¯å¦‚ä½•è¯„ä»·åŠ¨ä½œ $a_t$ çš„å¥½åå‘¢ï¼Ÿ</p><ol><li><p>$v(s_t;\mathbf{w})$ æ˜¯çŠ¶æ€ä»·å€¼ç½‘ç»œåœ¨ $t$ æ—¶åˆ»åŸºäºçŠ¶æ€ $s_t$ å¯¹çŠ¶æ€ $s_t$ çš„æŠ˜æ‰£å›æŠ¥ $\mathbb{E}[U_t | s_t]$ çš„ <strong>é¢„æµ‹å€¼</strong>ã€‚é¢„æµ‹å€¼å¯ä»¥è¯„ä»·çŠ¶æ€ $s_t$ çš„å¥½åï¼ŒçŠ¶æ€ $s_t$ è¶Šå¥½ï¼Œè¿™ä¸ªå€¼å°±è¶Šå¤§ã€‚</p></li><li><p>$r_t + \gamma \cdot v(s_{t+1};\mathbf{w})$ æ˜¯çŠ¶æ€ä»·å€¼ç½‘ç»œåœ¨ $t+1$ æ—¶åˆ»åŸºäºçŠ¶æ€ $s_t$ å’ŒçŠ¶æ€ $s_{t+1}$ å¯¹çŠ¶æ€ $s_t$ çš„æŠ˜æ‰£å›æŠ¥ $\mathbb{E}[U_t | s_t, s_{t+1}]$ çš„ <strong>é¢„æµ‹å€¼</strong>ã€‚</p></li><li><p>$v(s_t;\mathbf{w})$ å’Œ $r_t + \gamma \cdot v(s_{t+1};\mathbf{w})$ çš„ <strong>ç›¸åŒç‚¹</strong>ï¼š</p><ul><li>éƒ½æ˜¯çŠ¶æ€ä»·å€¼ç½‘ç»œå¯¹çŠ¶æ€ $s_t$ çš„æŠ˜æ‰£å›æŠ¥çš„é¢„ä¼°å€¼ã€‚</li><li>éƒ½èƒ½å¤Ÿè¯„ä»·çŠ¶æ€ $s_t$ çš„å¥½åã€‚</li></ul></li><li><p>$v(s_t;\mathbf{w})$ å’Œ $r_t + \gamma \cdot v(s_{t+1};\mathbf{w})$ çš„ <strong>åŒºåˆ«</strong>ï¼š</p><ul><li>$v(s_t;\mathbf{w})$ æ˜¯åœ¨ $t$ æ—¶åˆ»åšå‡ºçš„é¢„æµ‹ï¼Œè¿™ä¸ªé¢„æµ‹æ˜¯åœ¨æ‰§è¡ŒåŠ¨ä½œ $a_t$ ä¹‹å‰åšå‡ºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªé¢„æµ‹ä¸åŠ¨ä½œ $a_t$ æ— å…³ã€‚</li><li>$r_t + \gamma \cdot v(s_{t+1};\mathbf{w})$ æ˜¯åœ¨ $t+1$ æ—¶åˆ»åšå‡ºçš„é¢„æµ‹ï¼Œè¿™ä¸ªé¢„æµ‹å—åŠ¨ä½œ $a_t$ çš„å½±å“ï¼ŒåŠ¨ä½œ $a_t$ è¶Šå¥½ï¼Œæ–°çš„çŠ¶æ€ $s_{t+1}$ å°±è¶Šå¥½ï¼Œ$r_t + \gamma \cdot v(s_{t+1};\mathbf{w})$ çš„å€¼ä¹Ÿå°±è¶Šå¤§ã€‚</li><li>å¦‚æœåŠ¨ä½œ $a_t$ è¶Šå¥½ï¼Œ$r_t + \gamma \cdot v(s_{t+1};\mathbf{w})$ çš„å€¼å°±æ¯” $v(s_t;\mathbf{w})$ æ›´å¤§ï¼Œå®ƒä»¬çš„å·®å€¼å°±æ˜¯æ­£æ•°ï¼Œåä¹‹äº¦ç„¶ã€‚æ‰€ä»¥ä¸¤è€…çš„å·®å¯ä»¥åæ˜ åŠ¨ä½œ $a_t$ å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œä¸¤è€…çš„å·®å°±å«åš Advantage ã€‚</li></ul></li></ol><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/playlist?list=PLvOO0btloRnujjKTwoC5fOJxC7nmiQ4c4">ç­–ç•¥æ¢¯åº¦ä¸baseline</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç­–ç•¥æ¢¯åº¦ </tag>
            
            <tag> baseline </tag>
            
            <tag> è’™ç‰¹å¡æ´› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºç­–ç•¥çš„å¼ºåŒ–å­¦ä¹ </title>
      <link href="ji-yu-ce-lue-de-qiang-hua-xue-xi/"/>
      <url>ji-yu-ce-lue-de-qiang-hua-xue-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç­–ç•¥å‡½æ•°"><a href="#ä¸€ã€ç­–ç•¥å‡½æ•°" class="headerlink" title="ä¸€ã€ç­–ç•¥å‡½æ•°"></a>ä¸€ã€ç­–ç•¥å‡½æ•°</h2><p>ç­–ç•¥å‡½æ•° $\pi(a|s)$ çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆProbability Density Functionï¼Œ PDFï¼‰ã€‚å®ƒå°†ä»ç¯å¢ƒè§‚å¯Ÿåˆ°çš„çŠ¶æ€ $s$ ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºæ‰€æœ‰åŠ¨ä½œä¸­æ¯ä¸ªåŠ¨ä½œçš„æ¦‚ç‡ã€‚åœ¨éœ€è¦æ‰§è¡ŒåŠ¨ä½œæ—¶ï¼Œå°±ä»è¿™äº›åŠ¨ä½œæ¦‚ç‡ä¸­éšæœºæŠ½å–ä¸€ä¸ªåŠ¨ä½œæ¥æ‰§è¡Œã€‚</p><h2 id="äºŒã€ç­–ç•¥ç½‘ç»œ"><a href="#äºŒã€ç­–ç•¥ç½‘ç»œ" class="headerlink" title="äºŒã€ç­–ç•¥ç½‘ç»œ"></a>äºŒã€ç­–ç•¥ç½‘ç»œ</h2><p>å› ä¸ºä»ç¯å¢ƒè§‚å¯Ÿåˆ°çš„çŠ¶æ€ $s$ å¸¸å¸¸æœ‰æ— æ•°å¤šç§ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç¥ç»ç½‘ç»œ $\pi(a|s; \theta)$ æ¥è¿‘ä¼¼ç­–ç•¥å‡½æ•° $\pi({a|s})$ï¼Œå…¶ä¸­ $\theta$ æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ã€‚ç¥ç»ç½‘ç»œ $\pi(a|s; \theta)$ å°±æ˜¯ç­–ç•¥ç½‘ç»œã€‚</p><p>å› ä¸ºç­–ç•¥ç½‘ç»œè¾“å‡ºçš„æ˜¯å„ä¸ªåŠ¨ä½œçš„æ¦‚ç‡ï¼Œè€Œå„ä¸ªåŠ¨ä½œæ¦‚ç‡çš„æ€»å’Œåº”è¯¥æ˜¯1ï¼Œæ‰€ä»¥ç­–ç•¥ç½‘ç»œæœ€åçš„æ¿€æ´»å‡½æ•°é€šå¸¸æ˜¯ softmax ä»¥ä¿è¯ç­–ç•¥ç½‘ç»œè¾“å‡ºå€¼çš„æ€»å’Œä¸º1ã€‚</p><h2 id="ä¸‰ã€å¦‚ä½•è®­ç»ƒç­–ç•¥ç½‘ç»œ"><a href="#ä¸‰ã€å¦‚ä½•è®­ç»ƒç­–ç•¥ç½‘ç»œ" class="headerlink" title="ä¸‰ã€å¦‚ä½•è®­ç»ƒç­–ç•¥ç½‘ç»œ"></a>ä¸‰ã€å¦‚ä½•è®­ç»ƒç­–ç•¥ç½‘ç»œ</h2><p>æ ¹æ®çŠ¶æ€ä»·å€¼å‡½æ•°çš„å®šä¹‰æœ‰ï¼ˆä¸ºä¾¿äºæ¨å¯¼ï¼Œå‡å®šåŠ¨ä½œæ˜¯ç¦»æ•£çš„ï¼‰ï¼š</p><script type="math/tex; mode=display">V_{\pi}(s_t) = \mathbb{E}_A[Q_{\pi}(s_t, A)] = \sum_a \pi(a | s_t) \cdot Q_{\pi}(s_t, a)</script><p>ä½¿ç”¨ç¥ç»ç½‘ç»œ $\pi(a|s; \theta)$ æ¥è¿‘ä¼¼ç­–ç•¥å‡½æ•° $\pi({a|s})$ å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">V(s; \theta) = \sum_a \pi(a | s; \theta) \cdot Q_{\pi}(s, a)</script><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<a href="https://kibazen.cn/ma-er-ke-fu-he-bei-er-man-gong-shi-yi-ji-sheng-cheng-mo-shi/">å½“æ‰¾åˆ°æœ€ä¼˜ä»·å€¼å‡½æ•°æ—¶ï¼Œå°±è§£å†³äº†é©¬å°”ç§‘å¤«å†³ç­–é—®é¢˜</a>ã€‚å³å½“æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªç­–ç•¥ç½‘ç»œçš„å‚æ•°å€¼ $\hat{\theta}$ ä½¿å¾— $V(s; \hat{\theta})$ çš„å€¼æœ€å¤§ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€ä¸ªæœ€ä¼˜çš„ç­–ç•¥ç½‘ç»œã€‚</p><p>æ‰€ä»¥ï¼Œä»¤ï¼š</p><script type="math/tex; mode=display">J(\theta) = \mathbb{E}_s[V(s; \theta)]</script><p>å¯ä»¥ä½¿ç”¨ <strong>æ¢¯åº¦ä¸Šå‡</strong> æ–¹æ³•æ¥æ›´æ–°ç­–ç•¥ç½‘ç»œçš„å‚æ•°å€¼ $\theta$ ï¼š</p><ol><li>ä»ç¯å¢ƒè§‚å¯Ÿåˆ°çš„çŠ¶æ€ $s$ ã€‚</li><li>æ›´æ–°ç­–ç•¥ç½‘ç»œï¼ˆ $\beta$ æ˜¯å­¦ä¹ ç‡ï¼‰<script type="math/tex; mode=display">\theta \leftarrow \theta + \beta \cdot \frac{\partial V(s; \theta)}{\partial \theta}</script></li></ol><h2 id="å››ã€ç­–ç•¥æ¢¯åº¦"><a href="#å››ã€ç­–ç•¥æ¢¯åº¦" class="headerlink" title="å››ã€ç­–ç•¥æ¢¯åº¦"></a>å››ã€ç­–ç•¥æ¢¯åº¦</h2><p>ç­–ç•¥æ¢¯åº¦å°±æ˜¯ä½¿ç”¨ç¥ç»ç½‘ç»œ $\pi(a|s; \theta)$ æ¥è¿‘ä¼¼ç­–ç•¥å‡½æ•° $\pi({a|s})$ åå¾—åˆ°çš„çŠ¶æ€ä»·å€¼å‡½æ•°å¯¹ç¥ç»ç½‘ç»œå‚æ•° $\theta$ çš„å¯¼æ•°ï¼Œå³ $\frac{\partial V(s; \theta)}{\partial \theta}$ ã€‚</p><script type="math/tex; mode=display">\begin{aligned}\frac{\partial V(s; \theta)}{\partial \theta}& = \frac{\partial \sum_a \pi(a | s; \theta) \cdot Q_{\pi}(s, a)}{\partial \theta} \\& = \sum_a \frac{\partial \pi(a | s; \theta) \cdot Q_{\pi}(s, a)}{\partial \theta} \\&ï¼ˆè™½ç„¶ä¸å‡†ç¡®ï¼Œä½†æ˜¯ä¸ºäº†ç®€åŒ–æ¨å¯¼ï¼Œå‡è®¾ Q_{\pi}(s, a) ä¸ä¾èµ–äº \theta ï¼‰ \\& = \sum_a \frac{\partial \pi(a | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, a) \\& ï¼ˆé“¾å¼æ±‚å¯¼æ³•åˆ™ï¼‰ \\& = \sum_a \pi(a | s; \theta) \cdot \frac{\partial \log \pi(a | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, a) \\& = \mathbb{E}_{A \sim \pi(\cdot | s; \theta)} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, A) \right] \\\end{aligned}</script><blockquote><ol><li>ä¸Šé¢çš„è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œå‡è®¾äº† $Q_{\pi}(s, a)$ ä¸ä¾èµ–äº $\theta$ ï¼Œè¿™æ˜¯ä¸ºäº†ç®€åŒ–æ¨å¯¼ï¼Œä¾¿äºç†è§£ã€‚å®é™…ä¸Šå³ä½¿å°† $Q_{\pi}(s, a)$ å¯¹äº $\theta$ çš„å¯¼æ•°ä¹Ÿè€ƒè™‘è¿›å»ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</li><li>é“¾å¼æ±‚å¯¼æ³•åˆ™<script type="math/tex; mode=display">\frac{\partial \log [\pi (\theta)]}{\partial \theta} = \frac{1}{\pi (\theta)} \cdot \frac{\partial \pi (\theta)}{\partial \theta}</script></li></ol></blockquote><p>å³ï¼š</p><script type="math/tex; mode=display">\frac{\partial V(s; \theta)}{\partial \theta} = \sum_a \frac{\partial \pi(a | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, a) \tag{4.1}</script><script type="math/tex; mode=display">\frac{\partial V(s; \theta)}{\partial \theta} = \mathbb{E}_{A \sim \pi(\cdot | s; \theta)} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, A) \right] \tag{4.2}</script><h2 id="äº”ã€è®¡ç®—ç­–ç•¥æ¢¯åº¦"><a href="#äº”ã€è®¡ç®—ç­–ç•¥æ¢¯åº¦" class="headerlink" title="äº”ã€è®¡ç®—ç­–ç•¥æ¢¯åº¦"></a>äº”ã€è®¡ç®—ç­–ç•¥æ¢¯åº¦</h2><h3 id="5-1-ç¦»æ•£åŠ¨ä½œ"><a href="#5-1-ç¦»æ•£åŠ¨ä½œ" class="headerlink" title="5.1 ç¦»æ•£åŠ¨ä½œ"></a>5.1 ç¦»æ•£åŠ¨ä½œ</h3><p>å¦‚æœåŠ¨ä½œæ˜¯ç¦»æ•£çš„ï¼Œæ¯”å¦‚åŠ¨ä½œç©ºé—´æ˜¯ $\mathcal{A} \in \{ \text{â€œleftâ€}, \text{â€œrightâ€}, \text{â€œfireâ€} \}$ã€‚å¯ä»¥ä½¿ç”¨ <strong>å…¬å¼4.1</strong> ï¼š</p><script type="math/tex; mode=display">\frac{\partial V(s; \theta)}{\partial \theta} = \sum_a \frac{\partial \pi(a | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, a) \tag{4.1}</script><ol><li><p>å¯¹æ¯ä¸ªåŠ¨ä½œ $a \in \mathcal{A}$ ï¼Œè®¡ç®—</p><script type="math/tex; mode=display">\mathbf{f}(a, \theta) = \frac{\partial \pi(a | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, a)</script></li><li><p>è®¡ç®—ç­–ç•¥æ¢¯åº¦</p><script type="math/tex; mode=display">\frac{\partial V(s; \theta)}{\partial \theta} = \mathbf{f}(\text{"left"}, \theta) + \mathbf{f}(\text{"right"}, \theta) + \mathbf{f}(\text{"fire"}, \theta)</script></li></ol><h3 id="5-2-è¿ç»­åŠ¨ä½œ"><a href="#5-2-è¿ç»­åŠ¨ä½œ" class="headerlink" title="5.2 è¿ç»­åŠ¨ä½œ"></a>5.2 è¿ç»­åŠ¨ä½œ</h3><p>å¦‚æœåŠ¨ä½œæ˜¯è¿ç»­çš„ï¼Œæ¯”å¦‚åŠ¨ä½œç©ºé—´æ˜¯ $\mathcal{A} = [0,1]$ã€‚å¯ä»¥ä½¿ç”¨ <strong>å…¬å¼4.2</strong> ï¼š</p><script type="math/tex; mode=display">\frac{\partial V(s; \theta)}{\partial \theta} = \mathbb{E}_{A \sim \pi(\cdot | s; \theta)} \left[ \frac{\partial \log \pi(A | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, A) \right] \tag{4.2}</script><p>å› ä¸ºç›´æ¥æ±‚æœŸæœ›å¾ˆéš¾ï¼Œæ‰€ä»¥å¯ä»¥å¯¹æœŸæœ›åšè’™ç‰¹å¡æ´›ï¼ˆMonte Carloï¼‰è¿‘ä¼¼ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ä»æ¦‚ç‡å¯†åº¦å‡½æ•° $\pi(\cdot | s; \theta)$ ä¸­éšæœºæŠ½æ ·å¾—åˆ°ä¸€ä¸ªåŠ¨ä½œ $\hat{a}$ ã€‚</li><li><p>è®¡ç®—</p><script type="math/tex; mode=display">\mathbf{g}(\hat{a}, \theta) = \frac{\partial \log \pi(\hat{a} | s; \theta)}{\partial \theta} \cdot Q_{\pi}(s, \hat{a})</script><blockquote><ol><li>æ˜¾ç„¶æœ‰ $\mathbb{E}_A \left[ \mathbf{g}(A, \theta) \right]= \frac{\partial V(s; \theta)}{\partial \theta}$ ã€‚</li><li>å› ä¸º $\hat{a}$ æ˜¯ä» $\pi(\cdot | s; \theta)$ ä¸­éšæœºæŠ½æ ·å¾—åˆ°çš„ï¼Œæ‰€ä»¥ $\mathbf{g}(\hat{a}, \theta)$ æ˜¯ $\frac{\partial V(s; \theta)}{\partial \theta}$ çš„ä¸€ä¸ªæ— åä¼°è®¡ã€‚</li></ol></blockquote></li><li><p>ä½¿ç”¨ $\mathbf{g}(\hat{a}, \theta)$ æ¥è¿‘ä¼¼ $\frac{\partial V(s; \theta)}{\partial \theta}$ ï¼ˆè’™ç‰¹å¡æ´›è¿‘ä¼¼ï¼‰ã€‚</p></li></ol><p>ä¸Šé¢çš„è¿™ç§æ–¹æ³•å¯¹ç¦»æ•£çš„åŠ¨ä½œä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p><h2 id="å…­ã€ä½¿ç”¨ç­–ç•¥æ¢¯åº¦æ¥æ›´æ–°ç­–ç•¥ç½‘ç»œ"><a href="#å…­ã€ä½¿ç”¨ç­–ç•¥æ¢¯åº¦æ¥æ›´æ–°ç­–ç•¥ç½‘ç»œ" class="headerlink" title="å…­ã€ä½¿ç”¨ç­–ç•¥æ¢¯åº¦æ¥æ›´æ–°ç­–ç•¥ç½‘ç»œ"></a>å…­ã€ä½¿ç”¨ç­–ç•¥æ¢¯åº¦æ¥æ›´æ–°ç­–ç•¥ç½‘ç»œ</h2><p>å®Œæ•´çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ä»ç¯å¢ƒè§‚å¯Ÿåˆ°çš„çŠ¶æ€ $s_t$ ã€‚</li><li>ä»æ¦‚ç‡å¯†åº¦å‡½æ•° $\pi(\cdot | s_t; \theta_t)$ ä¸­éšæœºæŠ½æ ·å¾—åˆ°ä¸€ä¸ªåŠ¨ä½œ $a_t$ ã€‚</li><li>è®¡ç®—åŠ¨ä½œä»·å€¼ $q_t \approx Q_{\pi}(s_t, a_t)$ ã€‚</li><li>è®¡ç®—ç­–ç•¥æ¢¯åº¦ $\mathbf{d}_{\theta, t} = \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \mid_{\theta = {\theta}_t}$ ã€‚</li><li>è®¡ç®—ç­–ç•¥æ¢¯åº¦çš„è¿‘ä¼¼å€¼ $\mathbf{g}(a_t, {\theta}_t) = q_t \cdot \mathbf{d}_{\theta, t}$ ã€‚</li><li>æ›´æ–°ç­–ç•¥ç½‘ç»œ $\theta_{t+1} = \theta_t + \beta \cdot \mathbf{g}(a_t, \theta_t)$ ã€‚</li></ol><p>åœ¨ä¸Šé¢çš„æ­¥éª¤3ä¸­ï¼Œè®¡ç®— $q_t$ çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚</p><h3 id="6-1-REINFORCE"><a href="#6-1-REINFORCE" class="headerlink" title="6.1 REINFORCE"></a>6.1 REINFORCE</h3><p>ä½¿ç”¨è§‚æµ‹åˆ°çš„ $g_t$ æ¥ä»£æ›¿ $Q_{\pi}(s_t, a_t)$ ã€‚</p><ul><li>ç”¨ç­–ç•¥ç½‘ç»œ $\pi(\cdot | s_t; \theta_t)$ æ§åˆ¶ agent ä»æ¸¸æˆå¼€å§‹åˆ°æ¸¸æˆç»“æŸç©ä¸€å±€å®Œæ•´çš„æ¸¸æˆï¼Œå¾—åˆ°æ¸¸æˆè½¨è¿¹ $s_1, a_1, r_1, s_2, a_2, r_2, \cdots , s_T, a_T, r_T$ ã€‚</li><li>è®¡ç®—æ‰€æœ‰æ—¶åˆ»çš„æŠ˜æ‰£å›æŠ¥ $g_t = \sum_{k=t}^T \gamma^{k-t} r_k$ ã€‚</li><li>å› ä¸º $Q_\pi (s_t, a_t) = \mathbb{E}[G_t]$ ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æŠ˜æ‰£å›æŠ¥ $g_t$ æ¥è¿‘ä¼¼ $Q_\pi (s_t, a_t)$ ï¼Œå³ $q_t = g_t$ ã€‚</li></ul><h3 id="6-2-Actor-Critic-Method"><a href="#6-2-Actor-Critic-Method" class="headerlink" title="6.2 Actor-Critic Method"></a>6.2 Actor-Critic Method</h3><p>ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è¿‘ä¼¼ $Q_{\pi}(s_t, a_t)$ã€‚</p><p>æˆ‘ä»¬å·²ç»ä½¿ç”¨ç¥ç»ç½‘ç»œ $\pi(a|s; \theta)$ æ¥è¿‘ä¼¼ç­–ç•¥å‡½æ•° $\pi({a|s})$ï¼Œå…¶ä¸­ $\theta$ æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å†ä½¿ç”¨ç¥ç»ç½‘ç»œ $q(s,a;\mathbf{w})$ æ¥è¿‘ä¼¼ä»·å€¼å‡½æ•° $Q_{\pi}(s, a)$ï¼Œå…¶ä¸­ $\mathbf{w}$ æ˜¯ç¥ç»ç½‘ç»œçš„å‚æ•°ã€‚</p><script type="math/tex; mode=display">V(s; \theta, \mathbf{w}) = \sum_a \pi(a | s; \theta) \cdot q_{\pi}(s, a; \mathbf{w})</script><p>è®­ç»ƒæ—¶ï¼Œç­–ç•¥ç½‘ç»œ $\pi(a|s; \theta)$ ç›¸å½“äºè¿åŠ¨å‘˜ï¼ˆActorï¼‰ï¼Œè€Œä»·å€¼ç½‘ç»œ $q(s,a;\mathbf{w})$ ç›¸å½“äºè£åˆ¤ï¼ˆCriticï¼‰ï¼š</p><ul><li>è®­ç»ƒ Actor çš„ç›®çš„æ˜¯è®© Critic çš„æ‰“åˆ†å°½å¯èƒ½çš„é«˜ï¼Œå³æ›´æ–°ç­–ç•¥ç½‘ç»œ $\pi(a|s; \theta)$ ä½¿çŠ¶æ€ä»·å€¼ $V(s; \theta, \mathbf{w})$ çš„å€¼å¢åŠ ã€‚ Actor ä¾é  Critic çš„æ‰“åˆ†æ¥æ”¹è¿›è‡ªå·±ã€‚</li><li>è€Œè®­ç»ƒ Critic çš„ç›®çš„åˆ™æ˜¯è®©å®ƒå¯¹ Actor çš„æ‰“åˆ†æ›´å‡†ç¡®ï¼Œå³æ›´æ–°ä»·å€¼ç½‘ç»œ $q_{\pi}(s, a; \mathbf{w})$ ä»¥èƒ½å¤Ÿæ›´å¥½çš„ä¼°è®¡æœªæ¥å¥–åŠ±çš„æ€»å’Œã€‚ Critic ä¾é ç¯å¢ƒç»™ä¸çš„å¥–åŠ±æ¥æ”¹è¿›è‡ªå·±ã€‚</li><li>å½“ Critic çš„æ‰“åˆ†æ¯”è¾ƒå‡†ç¡®ä¸” Actor çš„å¾—åˆ†éƒ½æ¯”è¾ƒé«˜æ—¶ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç­–ç•¥ç½‘ç»œäº†ã€‚</li></ul><p>åœ¨æ¨ç†æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨ Actor æ¥æ§åˆ¶ agent åŠ¨ä½œå°±å¯ä»¥äº†ï¼Œæ¨ç†æ—¶çš„ä¸éœ€è¦ Critic ã€‚</p><p>ç®—æ³•å®Œæ•´çš„è®­ç»ƒæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>ä»ç¯å¢ƒè·å¾—çŠ¶æ€ $s_t$ è¾“å…¥ç­–ç•¥ç½‘ç»œ $\pi(a|s; \theta)$ ï¼Œå¹¶ä»å¾—åˆ°çš„åŠ¨ä½œæ¦‚ç‡ $\pi(a|s_t; \theta)$ ä¸­æŠ½æ ·å¾—åˆ°åŠ¨ä½œ $a_t$ ã€‚</p></li><li><p>åœ¨ç¯å¢ƒä¸­æ‰§è¡ŒåŠ¨ä½œ $a_t$ å¹¶è·å–åˆ°æ–°çš„ç¯å¢ƒçŠ¶æ€ $s_{t+1}$ å’Œå¥–åŠ± $r_t$ ã€‚</p></li><li><p>å°†æ–°çš„ç¯å¢ƒçŠ¶æ€ $s_{t+1}$ è¾“å…¥ç­–ç•¥ç½‘ç»œä¸­ $\pi(a|s; \theta)$ å¹¶éšæœºæŠ½æ ·å¾—åˆ°ä¸€ä¸ªä¸´æ—¶çš„åŠ¨ä½œ $\hat{a}_{t+1}$ ï¼ˆ<strong>è¿™ä¸ªåŠ¨ä½œä¸ä¼šåœ¨ç¯å¢ƒä¸­æ‰§è¡Œï¼Œä»…ç”¨äºæ›´æ–°ä»·å€¼ç½‘ç»œ</strong>ï¼‰ã€‚</p><blockquote><p>éšæœºæŠ½æ ·ä¿è¯æ ·æœ¬çš„æ— åæ€§ï¼Œè¿™æ ·æ‰èƒ½ç”¨æ¥åšè’™ç‰¹å¡æ´›è¿‘ä¼¼ï¼Œè¯¦è§<a href="#52-è¿ç»­åŠ¨ä½œ">5.2 è¿ç»­åŠ¨ä½œ</a>ã€‚</p></blockquote></li><li><p>è®¡ç®—åŠ¨ä½œ $a_t$ å’Œ $\hat{a}_{t+1}$ çš„åŠ¨ä½œä»·å€¼</p><script type="math/tex; mode=display">q_t = q(s_t, a_t; \mathbf{w}_t)</script><script type="math/tex; mode=display">q_{t+1} = q(s_{t+1}, \hat{a}_{t+1}; \mathbf{w}_t)</script></li><li><p>è®¡ç®— <strong>TD error</strong></p><script type="math/tex; mode=display">{\delta}_t = q_t - (r_t + \gamma \cdot q_{t+1})</script></li><li><p>å¯¹ä»·å€¼ç½‘ç»œ $q(s,a;\mathbf{w})$ æ±‚å¯¼</p><script type="math/tex; mode=display">\mathbf{d}_{\mathbf{w}, t} = \frac{\partial q(s_t, a_t; \mathbf{w})}{\partial \mathbf{w}} \mid_{\mathbf{w} = \mathbf{w}_t}</script></li><li><p>ä½¿ç”¨<a href="https://kibazen.cn/qiang-hua-xue-xi-zhong-shi-xu-chai-fen-xue-xi/">æ—¶åºå·®åˆ†å­¦ä¹ </a>æ¥æ›´æ–°ä»·å€¼ç½‘ç»œï¼ˆ $\alpha$ æ˜¯å­¦ä¹ ç‡ï¼‰</p><script type="math/tex; mode=display">\mathbf{w}_{t+1} = \mathbf{w}_t - \alpha \cdot {\delta}_t \cdot \mathbf{d}_{\mathbf{w}, t}</script><blockquote><p>å…¶ä¸­ ${\delta}_t \cdot \mathbf{d}_{\mathbf{w}, t}$ æ˜¯ <strong>TD error</strong> $\delta_t$ çš„å‡æ–¹å·®å…³äºå‚æ•° $\mathbf{w}$ çš„å¯¼æ•°</p><script type="math/tex; mode=display">\frac{\partial \delta_t ^2 / 2}{\partial \mathbf{w}} = \delta_t \cdot \mathbf{d}_{\mathbf{w}, t}</script></blockquote></li><li><p>å¯¹ç­–ç•¥ç½‘ç»œ $\pi(a|s; \theta)$ æ±‚å¯¼</p><script type="math/tex; mode=display">\mathbf{d}_{\theta, t} = \frac{\partial \log \pi(a_t | s_t; \theta)}{\partial \theta} \mid_{\theta = {\theta}_t}</script></li><li><p>ä½¿ç”¨æ¢¯åº¦ä¸Šå‡æ–¹æ³•æ¥æ›´æ–°ç­–ç•¥ç½‘ç»œï¼ˆ $\beta$ æ˜¯å­¦ä¹ ç‡ï¼‰</p><script type="math/tex; mode=display">\theta_{t+1} = \theta_t + \beta \cdot q_t \cdot \mathbf{d}_{\theta, t}</script><blockquote><p>æ³¨æ„ï¼šå®ç°ä¸­å¤§å¤šéƒ½ä½¿ç”¨ç¬¬ 5 æ­¥è®¡ç®—å‡ºæ¥çš„ ${\delta}_t$ æ¥æ›¿ä»£ä¸Šé¢å…¬å¼ä¸­çš„ $q_t$ å¾—åˆ°</p><script type="math/tex; mode=display">\theta_{t+1} = \theta_t + \beta \cdot {\delta}_t \cdot \mathbf{d}_{\theta, t}</script><p>è¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯å¯¹çš„ï¼Œä½¿ç”¨ $q_t$ æ˜¯æ ‡å‡†ç®—æ³•ï¼Œè€Œä½¿ç”¨ ${\delta}_t$ åˆ™æ˜¯ <strong>Policy Gradient with Baseline</strong> ã€‚ ä½¿ç”¨äº† Baseline çš„æ–¹æ³•ä¸å½±å“æœŸæœ›ï¼Œä½†æ˜¯é™ä½äº†æ–¹å·®ï¼Œèƒ½è®©ç®—æ³•æ”¶æ•›æ›´å¿«ï¼Œæ‰€ä»¥æ•ˆæœæ›´å¥½ã€‚</p></blockquote></li></ol><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=qI0vyfR2_Rc&amp;list=PLvOO0btloRnsiqM72G4Uid0UWljikENlU&amp;index=3&amp;ab_channel=ShusenWang">ç­–ç•¥å­¦ä¹  Policy-Based Reinforcement Learning</a><br>Policy Gradient è®ºæ–‡ï¼š<a href="https://papers.nips.cc/paper/1713-policy-gradient-methods-for-reinforcement-learning-with-function-approximation.pdf">Policy Gradient Methods for Reinforcement Learning with Function Approximation</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç­–ç•¥å‡½æ•° </tag>
            
            <tag> ç­–ç•¥ç½‘ç»œ </tag>
            
            <tag> ç­–ç•¥æ¢¯åº¦ </tag>
            
            <tag> ç­–ç•¥å­¦ä¹  </tag>
            
            <tag> Actor-Critic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DQNä¸­çš„é«˜ä¼°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</title>
      <link href="dqn-zhong-de-gao-gu-wen-ti-ji-jie-jue-fang-an/"/>
      <url>dqn-zhong-de-gao-gu-wen-ti-ji-jie-jue-fang-an/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€DQN-ä¸­çš„-Bootstrapping"><a href="#ä¸€ã€DQN-ä¸­çš„-Bootstrapping" class="headerlink" title="ä¸€ã€DQN ä¸­çš„ Bootstrapping"></a>ä¸€ã€DQN ä¸­çš„ Bootstrapping</h2><p>Bootstrappingï¼Œè‡ªä¸¾ï¼Œå­—é¢æ„æ€æ˜¯ï¼šæ‹”è‡ªå·±çš„é‹å¸¦ï¼ŒæŠŠè‡ªå·±ä¸¾èµ·æ¥ã€‚è€Œ Bootstrapping åœ¨å¼ºåŒ–å­¦ä¹ ä¸­çš„æ„æ€æ˜¯ï¼š<strong>ç”¨ä¸€ä¸ªä¼°ç®—å»æ›´æ–°åŒç±»çš„ä¼°ç®—</strong>ã€‚</p><p>åœ¨ DQN ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬è®© DQN åœ¨ $t$ æ—¶åˆ»çš„ä¼°è®¡å€¼ $Q(s_t)$ å°½é‡æ¥è¿‘ <strong>TD target</strong>ï¼š</p><script type="math/tex; mode=display">y_t = r_t + \gamma \cdot \underset{a}{\operatorname{max}} Q_*(s_{t+1}, a)</script><p><strong>TD target</strong> ä¸­ä½¿ç”¨åˆ°äº† DQN åœ¨ $t+1$ æ—¶åˆ»çš„ä¼°è®¡å€¼ $Q(s_{t+1})$ ï¼Œå³ï¼šæˆ‘ä»¬ <strong>ç”¨</strong> Q ç½‘ç»œåœ¨ $t+1$ æ—¶åˆ»çš„ <strong>ä¼°è®¡å€¼</strong> å»æ›´æ–° $t$ æ—¶åˆ»çš„ <strong>ä¼°è®¡å€¼</strong> ã€‚</p><h2 id="äºŒã€DQN-ä¸­çš„é«˜ä¼°é—®é¢˜"><a href="#äºŒã€DQN-ä¸­çš„é«˜ä¼°é—®é¢˜" class="headerlink" title="äºŒã€DQN ä¸­çš„é«˜ä¼°é—®é¢˜"></a>äºŒã€DQN ä¸­çš„é«˜ä¼°é—®é¢˜</h2><h3 id="2-1-æœ€å¤§åŒ–æ“ä½œå¯¼è‡´é«˜ä¼°"><a href="#2-1-æœ€å¤§åŒ–æ“ä½œå¯¼è‡´é«˜ä¼°" class="headerlink" title="2.1 æœ€å¤§åŒ–æ“ä½œå¯¼è‡´é«˜ä¼°"></a>2.1 æœ€å¤§åŒ–æ“ä½œå¯¼è‡´é«˜ä¼°</h3><p><strong>æœ€å¤§åŒ–æ“ä½œæœ¬èº«ä¼šå¯¼è‡´å€¼è¢«é«˜ä¼°ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„ $A$ï¼š</p><script type="math/tex; mode=display">A = [-1,  5, -6,  8,  3,  2, -4, -7,  9]</script><p>æ•°ç»„ $A$ çš„æœ€å¤§å€¼æ˜¯9ï¼Œå¹³å‡å€¼æ˜¯1ã€‚</p><p>æ•°ç»„ $A$ åŠ ä¸Šä¸€ä¸ªå‡å€¼ä¸º0æ•°ç»„ $B$ï¼š</p><script type="math/tex; mode=display">B = [-1,  1, -1,  0,  1,  1, -1, -1,  1]</script><p>åå¾—åˆ°çš„æ•°ç»„ $C$ï¼š</p><script type="math/tex; mode=display">C = A+B = [-2,  6, -7,  8,  4,  3, -5, -8, 10]</script><p>æ•°ç»„ $C$ çš„å¹³å‡å€¼ä¾ç„¶æ˜¯1ï¼Œä½†æ˜¯æœ€å¤§å€¼å´å˜æˆäº†10ã€‚</p><p>åœ¨ DQN ä¸­ï¼Œæ•°ç»„ $A$ ç›¸å½“äºå„ä¸ªåŠ¨ä½œçœŸå®çš„ Q å€¼ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¿™ä¸ªçœŸå®å€¼ï¼Œæ‰€ä»¥ç”¨ DQN æ¥ä¼°ç®—å®ƒä»¬ã€‚è€Œä¼°ç®—æ€»ä¼šæœ‰è¯¯å·®ï¼Œç›¸å½“äºå¼•å…¥äº†ä¸Šé¢çš„æ•°ç»„ $B$ ã€‚å‡è®¾ DQN å¯¹çœŸå®åŠ¨ä½œä»·å€¼çš„ä¼°ç®—æ˜¯æ— åçš„ï¼ˆæ— åä¼°è®¡ï¼‰ï¼Œå³ DQN å¯¹åŠ¨ä½œä¼°ç®—çš„ Q å€¼å’ŒçœŸå®çš„ Q å€¼çš„å‡å€¼ç›¸åŒï¼Œè¿™å’Œä¸Šé¢çš„ä¾‹å­ä¸€æ ·ã€‚æœ€å DQN ä¼°ç®—å‡ºå„ä¸ªåŠ¨ä½œçš„ Q å€¼çš„ç»“æœç›¸å½“äºä¸Šé¢ä¾‹å­çš„ $A+B$ ï¼Œå‡å€¼ä¾ç„¶ä¿æŒä¸å˜ï¼Œä½†æ˜¯æœ€å¤§å€¼å´å˜å¤§äº†ï¼Œæ‰€ä»¥ DQN ä¸­æœ€å¤§åŒ–æ“ä½œå¯èƒ½å¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯æ¯”çœŸå® Q å€¼æ›´å¤§çš„å€¼ï¼Œå³æœ€å¤§åŒ–çš„æ“ä½œå¯¼è‡´äº† DQN é«˜ä¼°äº† Q å€¼ã€‚</p><h3 id="2-2-Bootstrapping-ä¼ æ’­é«˜ä¼°"><a href="#2-2-Bootstrapping-ä¼ æ’­é«˜ä¼°" class="headerlink" title="2.2 Bootstrapping ä¼ æ’­é«˜ä¼°"></a>2.2 Bootstrapping ä¼ æ’­é«˜ä¼°</h3><p>åœ¨ä¸Šé¢åˆ†æåˆ°ï¼Œ <strong>TD target</strong> ä¸­ä½¿ç”¨äº† Q ç½‘ç»œåœ¨ $t+1$ æ—¶åˆ»çš„é¢„ä¼°å€¼ï¼Œå› ä¸ºé¢„ä¼°æœ¬èº«å¯èƒ½ä¼šå¯¼è‡´é«˜ä¼°çœŸå®çš„ Q å€¼ï¼Œè€Œè®© DQN åœ¨ $t$ æ—¶åˆ»çš„ä¼°è®¡å€¼ $Q(s_t)$ å°½é‡æ¥è¿‘ <strong>TD target</strong> åˆ™ä¼šå°†é«˜ä¼°ä¼ æ’­å› DQNï¼Œä»è€Œå½¢æˆäº†ä¸€ç§æ­£åé¦ˆã€‚æ‰€ä»¥ï¼Œä¸€æ—¦ DQN ä¸­å‡ºç°äº†é«˜ä¼°ï¼Œè¿™ç§æ­£åé¦ˆä¼šè®©é«˜ä¼°è¶Šæ¥è¶Šä¸¥é‡ã€‚</p><h2 id="å››ã€é«˜ä¼°å¯¼è‡´çš„é—®é¢˜"><a href="#å››ã€é«˜ä¼°å¯¼è‡´çš„é—®é¢˜" class="headerlink" title="å››ã€é«˜ä¼°å¯¼è‡´çš„é—®é¢˜"></a>å››ã€é«˜ä¼°å¯¼è‡´çš„é—®é¢˜</h2><p>å¯¹ä¸åŒåŠ¨ä½œä¸åŒç¨‹åº¦çš„é«˜ä¼°ä¼šå¯¼è‡´åŸæœ¬æœ€ä¼˜çš„åŠ¨ä½œå˜æˆä¸æ˜¯æœ€ä¼˜çš„ï¼ŒåŸæœ¬æœ€å·®çš„åŠ¨ä½œå¯èƒ½ä¼šå˜æˆæœ€ä¼˜çš„åŠ¨ä½œã€‚</p><p>å‡è®¾æŸä¸ªçŠ¶æ€ä¸‹ï¼Œä¸¤ä¸ªåŠ¨ä½œçœŸå®çš„ Q å€¼åˆ†åˆ«æ˜¯110å’Œ150ï¼Œä½†æ˜¯ç»è¿‡ DQN é«˜ä¼°åå¾—åˆ° Q å€¼åˆ†åˆ«æ˜¯200å’Œ180ã€‚æ˜¾ç„¶ï¼Œç»è¿‡é«˜ä¼°åçš„å„ä¸ªåŠ¨ä½œçš„ä¼˜åŠ£å®Œå…¨å˜äº†æ ·ï¼šåŸæœ¬æœ€ä¼˜çš„åŠ¨ä½œå˜æˆäº†æœ€å·®çš„ï¼Œæœ€å·®çš„åŠ¨ä½œå´æˆäº†æœ€ä¼˜çš„äº†ã€‚</p><p>å› ä¸ºå„ä¸ªçŠ¶æ€ä¸‹å„ä¸ªåŠ¨ä½œå‡ºç°çš„æ¦‚ç‡æ€»æ˜¯ä¸å‡åŒ€çš„ï¼Œè¶Šé¢‘ç¹å‡ºç°çš„åŠ¨ä½œ DQN å¯¹è¯¥åŠ¨ä½œçš„ä¼°ç®—æ›´æ–°å¾—ä¹Ÿæ›´é¢‘ç¹ï¼Œä¼°ç®—ä¸­å‡ºç°çš„é«˜ä¼°åˆ™è¿›ä¸€æ­¥åŠ å‰§äº†è¿™ç§æƒ…å†µã€‚æœ€åå¯¼è‡´äº† DQN å¯¹å„ä¸ªçŠ¶æ€ä¸‹å„ä¸ªåŠ¨ä½œçš„é«˜ä¼°ç¨‹åº¦ä¸åŒã€‚</p><h2 id="äº”ã€è§£å†³æ–¹æ¡ˆ"><a href="#äº”ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äº”ã€è§£å†³æ–¹æ¡ˆ"></a>äº”ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="5-1-ä½¿ç”¨-target-network-é¿å…-Bootstrapping"><a href="#5-1-ä½¿ç”¨-target-network-é¿å…-Bootstrapping" class="headerlink" title="5.1 ä½¿ç”¨ target network é¿å… Bootstrapping"></a>5.1 ä½¿ç”¨ target network é¿å… Bootstrapping</h3><p>åœ¨ DQN ä¸­æ–°åŠ ä¸€ä¸ªåä¸º <strong>target network</strong> çš„ç½‘ç»œ $Q(s,a; \mathbf{w}^-)$ ï¼Œå…¶ç»“æ„å’ŒåŸå§‹çš„ Q ç½‘ç»œ $Q(s,a; \mathbf{w})$ ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨ä¸åŒçš„ç½‘ç»œå‚æ•° $\mathbf{w}^-$ ã€‚</p><p>ä¸¤ä¸ªç½‘ç»œçš„ç”¨å¤„ä¸åŒï¼ŒåŸæ¥çš„ Q ç½‘ç»œ $Q(s,a; \mathbf{w})$ ç”¨æ¥æ§åˆ¶æ™ºèƒ½ä½“å’Œæ”¶é›†å­¦ä¹ ç”¨çš„ç»éªŒï¼Œè€Œ <strong>target network</strong> åˆ™ç”¨æ¥è®¡ç®— <strong>TD target</strong> ã€‚</p><p>ä½¿ç”¨äº† <strong>target network</strong> çš„ DQN ç®—æ³•çš„å®Œæ•´æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>è®¡ç®— <strong>TD target</strong> ï¼š</p><script type="math/tex; mode=display">y_t = r_t + \gamma \cdot \underset{a}{\operatorname{max}} Q(s_{t+1}, a; \mathbf{w}^-)</script></li><li><p>è®¡ç®— <strong>TD error</strong> ï¼š</p><script type="math/tex; mode=display">\delta^t = Q(s_t,a_t; \mathbf{w}) - y_t</script></li><li><p>ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥æ›´æ–° Q ç½‘ç»œ $Q(s_t,a_t; \mathbf{w})$ çš„å‚æ•°ï¼š</p><script type="math/tex; mode=display">\mathbf{w} \leftarrow \mathbf{w} - \alpha \cdot \delta^t \cdot \frac{\partial Q(s_t,a_t;\mathbf{w})}{\partial \mathbf{w}}</script></li></ol><p>å› ä¸ºä½¿ç”¨äº† <strong>target network</strong> çš„é¢„ä¼°å€¼æ¥æ›´æ–°åŸæ¥çš„ Q ç½‘ç»œçš„é¢„ä¼°å€¼ï¼Œè¿™å°±é¿å…äº† Bootstrapping ï¼Œç¼“è§£äº†é«˜ä¼°çš„é—®é¢˜ã€‚ä½†æ˜¯å› ä¸ºéœ€è¦å‘¨æœŸæ€§çš„ç”¨ Q ç½‘ç»œçš„å‚æ•°å€¼æ¥æ›´æ–° <strong>target network</strong>ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½å®Œå…¨è§£å†³é«˜ä¼°é—®é¢˜ï¼Œåªèƒ½ç¼“è§£ã€‚</p><p><strong>target network</strong> å‚æ•°çš„æ›´æ–°æ–¹å¼æ˜¯å‘¨æœŸæ€§çš„åŒæ­¥è‡ªåŸæ¥çš„Qç½‘ç»œã€‚åŒæ­¥çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ol><li><p>ç›´æ¥ä½¿ç”¨åŸæ¥çš„ Q ç½‘ç»œå‚æ•°æ›¿æ¢ <strong>target network</strong> çš„å‚æ•°ï¼š</p><script type="math/tex; mode=display">\mathbf{w}^- \leftarrow \mathbf{w}</script></li><li><p>å°†åŸæ¥çš„ Q ç½‘ç»œå‚æ•°å’Œ <strong>target network</strong> çš„å‚æ•°åšåŠ æƒå¹³å‡ï¼š</p><script type="math/tex; mode=display">\mathbf{w}^- \leftarrow \tau \cdot \mathbf{w} + (1 - \tau) \cdot \mathbf{w}^-</script></li></ol><h3 id="5-2-ä½¿ç”¨-Double-DQN-é¿å…æœ€å¤§åŒ–å¯¼è‡´çš„é«˜ä¼°"><a href="#5-2-ä½¿ç”¨-Double-DQN-é¿å…æœ€å¤§åŒ–å¯¼è‡´çš„é«˜ä¼°" class="headerlink" title="5.2 ä½¿ç”¨ Double DQN é¿å…æœ€å¤§åŒ–å¯¼è‡´çš„é«˜ä¼°"></a>5.2 ä½¿ç”¨ Double DQN é¿å…æœ€å¤§åŒ–å¯¼è‡´çš„é«˜ä¼°</h3><h4 id="5-2-1-åŸå§‹çš„-DQN"><a href="#5-2-1-åŸå§‹çš„-DQN" class="headerlink" title="5.2.1 åŸå§‹çš„ DQN"></a>5.2.1 åŸå§‹çš„ DQN</h4><p>å…¶å® DQN åœ¨è®¡ç®— <strong>TD target</strong> æ—¶ï¼Œå…¶ä¸­çš„ $\underset{a}{\operatorname{max}} Q(s_{t+1}, a; \mathbf{w})$ å¯ä»¥åˆ†è§£æˆä¸¤æ­¥æ“ä½œï¼š</p><ol><li>ä½¿ç”¨ <strong>åŸæ¥çš„ Q ç½‘ç»œ</strong> é€‰æ‹©æœ€ä¼˜åŠ¨ä½œ<script type="math/tex; mode=display">a_* = \underset{a}{\operatorname{argmax}} Q(s_{t+1},a; \mathbf{w})</script></li><li><strong>åŒæ—¶</strong> ä½¿ç”¨ <strong>åŸæ¥çš„ Q ç½‘ç»œ</strong> é¢„ä¼°åŠ¨ä½œçš„ä»·å€¼<script type="math/tex; mode=display">y_t = r_t + \gamma \cdot Q(s_{t+1}, a_*; \mathbf{w})</script></li></ol><p>è¿™ä¸¤æ­¥ç”¨çš„éƒ½æ˜¯ <strong>åŸæ¥çš„ Q ç½‘ç»œ</strong> æ¥è¿›è¡Œè®¡ç®—ï¼Œè¿™ç§æ–¹å¼çš„è¡¨ç°æœ€å·®ï¼Œè®­ç»ƒå‡ºçš„ç½‘ç»œä¼šä¸¥é‡é«˜ä¼°çœŸå®çš„åŠ¨ä½œä»·å€¼ã€‚</p><h4 id="5-2-2-ä½¿ç”¨äº†-target-network-çš„-DQN"><a href="#5-2-2-ä½¿ç”¨äº†-target-network-çš„-DQN" class="headerlink" title="5.2.2 ä½¿ç”¨äº† target network çš„ DQN"></a>5.2.2 ä½¿ç”¨äº† <strong>target network</strong> çš„ DQN</h4><p>ä½¿ç”¨äº† <strong>target network</strong> çš„ DQN è®¡ç®— <strong>TD target</strong> æ—¶ï¼š</p><ol><li>ä½¿ç”¨ <strong>target network</strong> é€‰æ‹©æœ€ä¼˜åŠ¨ä½œ<script type="math/tex; mode=display">a_* = \underset{a}{\operatorname{argmax}} Q(s_{t+1},a; \mathbf{w}^-)</script></li><li><strong>åŒæ—¶</strong> ä½¿ç”¨ <strong>target network</strong> é¢„ä¼°åŠ¨ä½œçš„ä»·å€¼<script type="math/tex; mode=display">y_t = r_t + \gamma \cdot Q(s_{t+1}, a_*; \mathbf{w}^-)</script></li></ol><p>è¿™ä¸¤æ­¥ç”¨çš„éƒ½æ˜¯ <strong>target network</strong> æ¥è¿›è¡Œè®¡ç®—ï¼Œè¿™ç§æ–¹å¼å› é¿å…äº† Bootstrappingï¼Œæ‰€ä»¥è¡¨ç°ä¼šæ¯”åŸå§‹çš„ DQN å¥½ä¸€äº›ï¼Œä½†æ˜¯è®­ç»ƒå‡ºçš„ç½‘ç»œä¾ç„¶ä¼šé«˜ä¼°çœŸå®çš„åŠ¨ä½œä»·å€¼ã€‚</p><h4 id="5-2-3-Double-DQN"><a href="#5-2-3-Double-DQN" class="headerlink" title="5.2.3 Double DQN"></a>5.2.3 Double DQN</h4><p>è€Œ Double DQN åˆ™æ˜¯å¯¹åŸå§‹çš„ DQN å’Œä½¿ç”¨äº† <strong>target network</strong> çš„ DQN çš„ä¸€ç§æ”¹è¿›ï¼š</p><ol><li>ä½¿ç”¨ <strong>åŸæ¥çš„ Q ç½‘ç»œ</strong> é€‰æ‹©æœ€ä¼˜åŠ¨ä½œ<script type="math/tex; mode=display">a_* = \underset{a}{\operatorname{argmax}} Q(s_{t+1},a; \mathbf{w})</script></li><li>ä½¿ç”¨ <strong>target network</strong> é¢„ä¼°åŠ¨ä½œçš„ä»·å€¼<script type="math/tex; mode=display">y_t = r_t + \gamma \cdot Q(s_{t+1}, a_*; \mathbf{w}^-)</script></li></ol><p>Double DQN ä¸­ä½¿ç”¨ <strong>åŸæ¥çš„ Q ç½‘ç»œ</strong> é€‰æ‹©æœ€ä¼˜åŠ¨ä½œï¼Œå¦å¤–ä½¿ç”¨äº† <strong>target network</strong> é¢„ä¼°åŠ¨ä½œçš„ä»·å€¼ã€‚ä¸¤æ­¥ä½¿ç”¨äº†ä¸åŒäº†ç½‘ç»œï¼Œè™½ç„¶æ”¹åŠ¨å¾ˆå°‘ï¼Œä½†æ˜¯å´èƒ½è¿›ä¸€æ­¥çš„ç¼“è§£é«˜ä¼°çš„é—®é¢˜ï¼ˆä¾ç„¶æ²¡æœ‰æ ¹é™¤é«˜ä¼°çš„é—®é¢˜ï¼‰ã€‚</p><p>å¯¹ <strong>target network</strong> æ¥è¯´å¯ä»¥è¯æ˜å¦‚ä¸‹çš„ç­‰å¼æ˜¯æˆç«‹çš„ï¼š</p><script type="math/tex; mode=display">Q(s_{t+1}, a_*; \mathbf{w}^-) \le \underset{a}{\operatorname{max}} Q(s_{t+1}, a; \mathbf{w}^-)</script><p>ç­‰å¼å·¦è¾¹æ˜¯ Double DQN ç®—å‡ºçš„ï¼Œç­‰å¼å³è¾¹æ˜¯ <strong>target network</strong> ç®—å‡ºçš„ã€‚ä¸Šé¢çš„ç­‰å¼è¡¨é¢äº† Double DQN ä¼°ç®—å‡ºçš„ Q å€¼æ€»æ˜¯ä¸é«˜äºä½¿ç”¨ <strong>target network</strong> è®¡ç®—å‡º Q å€¼ï¼Œæ‰€ä»¥ç¼“è§£äº†é«˜ä¼°çš„é—®é¢˜ã€‚</p><h3 id="5-3-ä½¿ç”¨-Dueling-Network-æ”¹è¿›ç½‘ç»œç»“æ„"><a href="#5-3-ä½¿ç”¨-Dueling-Network-æ”¹è¿›ç½‘ç»œç»“æ„" class="headerlink" title="5.3 ä½¿ç”¨ Dueling Network æ”¹è¿›ç½‘ç»œç»“æ„"></a>5.3 ä½¿ç”¨ Dueling Network æ”¹è¿›ç½‘ç»œç»“æ„</h3><p>Dueling Network ä¸­ä½¿ç”¨åˆ°äº†ä¼˜åŠ¿å‡½æ•°çš„æ¦‚å¿µï¼Œè¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹ä¼˜åŠ¿å‡½æ•°ã€‚</p><blockquote><p>åé¢çš„æ¨å¯¼ï¼Œç‰¹åˆ«æ˜¯å…³äºä¼˜åŠ¿å‡½æ•°çš„æ¨å¯¼ä¸åŸè®ºæ–‡ä¸­çš„æ¨å¯¼ä¸åŒã€‚</p></blockquote><h4 id="5-3-1-ä¼˜åŠ¿å‡½æ•°ï¼ˆAdvantage-Functionï¼‰"><a href="#5-3-1-ä¼˜åŠ¿å‡½æ•°ï¼ˆAdvantage-Functionï¼‰" class="headerlink" title="5.3.1 ä¼˜åŠ¿å‡½æ•°ï¼ˆAdvantage Functionï¼‰"></a>5.3.1 ä¼˜åŠ¿å‡½æ•°ï¼ˆAdvantage Functionï¼‰</h4><ol><li><p>å®šä¹‰</p><p> å®šä¹‰ä¼˜åŠ¿å‡½æ•°ä¸ºï¼š</p><script type="math/tex; mode=display">A_*(s,a) = Q_*(s,a) - V_*(s)</script><p> å…¶æ„ä¹‰æ˜¯ï¼šå°† <script type="math/tex">V_*(s)</script> ä½œä¸ºåŸºå‡†ï¼Œåœ¨çŠ¶æ€ $s$ çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡ŒåŠ¨ä½œ $a$ çš„å¥½åã€‚å³åŠ¨ä½œ $a$ ç›¸å¯¹ <script type="math/tex">V_*(s)</script> çš„ä¼˜åŠ¿ã€‚</p></li><li><p>æ€§è´¨</p><p> å¯¹ä¼˜åŠ¿å‡½æ•°ç­‰å¼çš„ä¸¤è¾¹åŒæ—¶åšåŸºäºåŠ¨ä½œ $a$ çš„ $max$ æ“ä½œå¾—åˆ°ï¼š</p><script type="math/tex; mode=display">\underset{a}{max}A_*(s,a) = \underset{a}{max}Q_*(s,a) - V_*(s)</script><p> æ ¹æ®è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ï¼ˆBellman Optimality Equationï¼‰ï¼š</p><script type="math/tex; mode=display">V_*(s) = \max_a Q_*(s,a)</script><p> äºæ˜¯ï¼š</p><script type="math/tex; mode=display"> \begin{aligned} \underset{a}{max}A_*(s,a) & = \underset{a}{max}Q_*(s,a) - V_*(s) \\ & = \underset{a}{max}Q_*(s,a) - \underset{a}{max}Q_*(s,a) \\ & = 0 \end{aligned}</script><p> å³ï¼š</p><script type="math/tex; mode=display">\underset{a}{max}A_*(s,a) = 0</script></li><li><p>æ¨å¯¼</p><p> å˜æ¢ä¸€ä¸‹ä¼˜åŠ¿å‡½æ•°å®šä¹‰çš„ç­‰å¼ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç­‰å¼ï¼š</p><script type="math/tex; mode=display">Q_*(s,a) = V_*(s) + A_*(s,a)</script><p> åŒæ—¶æ ¹æ®ä¼˜åŠ¿å‡½æ•°çš„æ€§è´¨ï¼Œå¯ä»¥åœ¨ä¸Šé¢ç­‰å¼å³è¾¹å‡å»ä¸€ä¸ª $0$ï¼Œå¾—åˆ°ç­‰å¼ï¼š</p><script type="math/tex; mode=display">Q_*(s,a) = V_*(s) + A_*(s,a) - \underset{a}{max}A_*(s,a) \tag{5.3.1}</script><p> ä½†æ˜¯ä¸ºä»€ä¹ˆè¦åœ¨ç­‰å¼çš„å³è¾¹å‡å»ä¸€ä¸ª0å‘¢ï¼Ÿå¯¹æ¯”ä¸€ä¸‹å‡å»0å‰åçš„ä¸¤ä¸ªç­‰å¼ï¼š</p><script type="math/tex; mode=display"> \begin{aligned} Q_*(s,a) & = V_*(s) + A_*(s,a) \\ Q_*(s,a) & = V_*(s) + A_*(s,a) - \underset{a}{max}A_*(s,a) \\ \end{aligned}</script><p> å‘ç°ï¼Œä¸Šé¢çš„å…¬å¼æœ‰ä¸€ä¸ªä¸‹é¢å…¬å¼æ²¡æœ‰çš„ <strong>å”¯ä¸€è§£é—®é¢˜</strong> ï¼šå¦‚æœ <script type="math/tex">V_*(s)</script> çš„å€¼æ•´ä½“åŠ  $x$ï¼Œè€Œ <script type="math/tex">A_*(s,a)</script> çš„å€¼æ•´ä½“å‡ $x$ã€‚ä¸Šé¢çš„ç­‰å¼æœ€åçš„å€¼ <script type="math/tex">Q_*(s,a)</script> æ²¡å˜ï¼Œä½†æ˜¯ä¸‹é¢ç­‰å¼æœ€åçš„å€¼å¢åŠ äº† $x$ã€‚ è€Œæ²¡æœ‰å”¯ä¸€è§£åœ¨å¼ºåŒ–å­¦ä¹ ä¸­å°±æ„å‘³ç€éš¾ä»¥è®­ç»ƒå‡ºæ¨¡å‹ï¼Œæ‰€ä»¥ä¸‹é¢ä¸€ä¸ªç­‰å¼æ‰èƒ½åº”ç”¨åˆ°å¼ºåŒ–å­¦ä¹ ä¸­ã€‚</p></li></ol><h4 id="5-3-2-ä¼˜åŠ¿å‡½æ•°çš„åº”ç”¨-Dueling-Network"><a href="#5-3-2-ä¼˜åŠ¿å‡½æ•°çš„åº”ç”¨-Dueling-Network" class="headerlink" title="5.3.2 ä¼˜åŠ¿å‡½æ•°çš„åº”ç”¨ Dueling Network"></a>5.3.2 ä¼˜åŠ¿å‡½æ•°çš„åº”ç”¨ Dueling Network</h4><p>æ ¹æ®ä¸Šé¢åˆ©ç”¨ä¼˜åŠ¿å‡½æ•°æ¨å¯¼å‡ºçš„ç­‰å¼ï¼š</p><script type="math/tex; mode=display">Q_*(s,a) = V_*(s) + A_*(s,a) - \underset{a}{max}A_*(s,a)</script><p>ä½¿ç”¨ä¸¤ä¸ªç¥ç»ç½‘ç»œæ¥åˆ†åˆ«è¿‘ä¼¼ <script type="math/tex">V_*(s)</script> å‡½æ•°å’Œ <script type="math/tex">A_*(s,a)</script> å‡½æ•°ï¼Œè¿›è€Œå°±å¯ä»¥å¾—åˆ° <script type="math/tex">Q_*(s,a)</script> å‡½æ•°ï¼Œè¿™å°±æ˜¯ Dueling Networkã€‚</p><p><strong>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œæ ¹æ®æ•°å­¦å…¬å¼æ¨å¯¼å‡ºçš„ Dueling Network ä¸­å¯¹ä¼˜åŠ¿å‡½æ•°æ±‚æœ€å¤§åŒ–çš„æ“ä½œï¼Œæ¢æˆå‡å€¼æ“ä½œå¾—åˆ°çš„æ•ˆæœæ›´å¥½æ›´ç¨³å®šï¼Œè¿™ç§æ›¿æ¢æ“ä½œæ²¡æœ‰ç†è®ºä¾æ®ï¼Œä½†æ˜¯å®é™…æ•ˆæœæ›´å¥½ã€‚</strong></p><script type="math/tex; mode=display">Q_*(s,a) = V_*(s) + A_*(s,a) - \underset{a}{mean}A_*(s,a)</script><p>æœ€åï¼Œå› ä¸º Dueling Network åªæ˜¯æ”¹è¿›äº† DQN ä¸­åŸå§‹ Q ç½‘ç»œçš„ç»“æ„ï¼Œæ‰€ä»¥ä½¿ç”¨äº† Dueling Network çš„ DQN çš„è®­ç»ƒæ–¹æ³•ä¸ä½¿ç”¨äº†åŸå§‹çš„ Q ç½‘ç»œçš„ DQN è®­ç»ƒæ–¹æ³•ç›¸åŒï¼ŒDQN æ”¹è¿›çš„æŠ€å·§ï¼ˆæ¯”å¦‚Double DQNï¼‰ä¹Ÿä¾ç„¶éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚</p><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=X2-56QN79zc&amp;list=PLvOO0btloRntS5U8rQWT9mHFcUdYOUmIC&amp;index=2&amp;ab_channel=ShusenWang">é«˜ä¼°é—®é¢˜ã€Target Networkã€Double DQN</a><br>DQN è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1312.5602">Playing Atari with Deep Reinforcement Learning</a><br>Target Network è®ºæ–‡ï¼š<a href="https://web.stanford.edu/class/psych209/Readings/MnihEtAlHassibis15NatureControlDeepRL.pdf">Human-level control through deep reinforcement learning</a><br>Double DQN è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1509.06461">Deep Reinforcement Learning with Double Q-learning</a><br>Dueling Network è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1511.06581">Dueling Network Architectures for Deep Reinforcement Learning</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é«˜ä¼°é—®é¢˜ </tag>
            
            <tag> Target Network </tag>
            
            <tag> Double DQN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºåŒ–å­¦ä¹ ä¸­çš„ç»éªŒå›æ”¾</title>
      <link href="qiang-hua-xue-xi-zhong-de-jing-yan-hui-fang/"/>
      <url>qiang-hua-xue-xi-zhong-de-jing-yan-hui-fang/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal-Difference-Learningï¼‰"><a href="#ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal-Difference-Learningï¼‰" class="headerlink" title="ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal Difference Learningï¼‰"></a>ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal Difference Learningï¼‰</h2><p>å¼ºåŒ–å­¦ä¹ ä¸­å¸¸ç”¨æ—¶åºå·®åˆ†å­¦ä¹ æ¥æ›´æ–°æ¨¡å‹ï¼Œ<a href="https://kibazen.cn/qiang-hua-xue-xi-zhong-shi-xu-chai-fen-xue-xi/">æ—¶åºå·®åˆ†å­¦ä¹ </a>çš„ä¸€èˆ¬æµç¨‹æ˜¯ï¼š</p><ol><li>æ¨¡å‹æ ¹æ®è·å–åˆ°çš„çŠ¶æ€ $s_t$ å†³å®šé‡‡å–åŠ¨ä½œ $a_t$ ã€‚</li><li>ç¯å¢ƒåœ¨æ‰§è¡ŒåŠ¨ä½œ $a_t$ åä¼šç»™å‡ºå¯¹åº”çš„å¥–åŠ± $r_t$ å’Œæ–°çš„çŠ¶æ€ $s_{t+1}$ ã€‚</li><li>æ ¹æ® <strong>TD target</strong> è®¡ç®—å‡º <strong>TD error</strong> ï¼Œ ç„¶åä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Gradient_descent">æ¢¯åº¦ä¸‹é™</a> ç­‰æ–¹æ³•æ›´æ–°æ¨¡å‹æ¥é™ä½ <strong>TD error</strong> çš„å€¼ã€‚</li><li>å›åˆ°1é‡å¤ã€‚</li></ol><h2 id="äºŒã€ç»éªŒå›æ”¾ï¼ˆExperience-Replayï¼‰"><a href="#äºŒã€ç»éªŒå›æ”¾ï¼ˆExperience-Replayï¼‰" class="headerlink" title="äºŒã€ç»éªŒå›æ”¾ï¼ˆExperience Replayï¼‰"></a>äºŒã€ç»éªŒå›æ”¾ï¼ˆExperience Replayï¼‰</h2><p>åŸå§‹çš„æ—¶åºå·®åˆ†å­¦ä¹ åœ¨å®é™…çš„åº”ç”¨ä¸­æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š</p><ol><li>ç»éªŒæµªè´¹<br> ä»ä¸Šé¢çš„æµç¨‹å¯ä»¥çœ‹å‡ºï¼Œç»éªŒ $(s_r, a_t, r_t, s_{t+1})$ åœ¨ä½¿ç”¨ä¸€æ¬¡åå°±ä¼šè¢«ä¸¢æ‰ã€‚ä½†æ˜¯äº‹å®ä¸Šï¼Œè¿™äº›ç»éªŒå¯ä»¥é‡å¤åˆ©ç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯éœ€è¦åšç»éªŒå›æ”¾çš„ä¸»è¦åŸå› ã€‚</li><li>ç»éªŒç›¸å…³æ€§å¤ªå¼º<br> å‰åç›¸é‚»çš„ç»éªŒçš„ç›¸å…³æ€§å¤ªå¼ºäº†ã€‚æ¯”å¦‚å¯¹æ¸¸æˆæ¥è¯´ï¼Œä¸Šä¸€å¸§çš„ç”»é¢å’Œä¸‹ä¸€å¸§çš„ç”»é¢å˜åŒ–å¾ˆå°ã€‚å®éªŒè¯æ˜è¿™ç§ç›¸å…³æ€§æ˜¯æœ‰å®³çš„ï¼Œä¸åˆ©äºæ¨¡å‹çš„è®­ç»ƒã€‚</li></ol><p>ç»éªŒå›æ”¾åˆ™å¯ä»¥æœ‰æ•ˆçš„è§£å†³ä¸Šé¢çš„ä¸¤ä¸ªç¼ºç‚¹ã€‚</p><p>ç»éªŒå›æ”¾çš„åŸç†å°±æ˜¯åªä¿ç•™æœ€è¿‘çš„ $n$ æ¡ç»éªŒï¼Œæ¯æ¬¡è®­ç»ƒæ—¶ <strong>éšæœºå‡åŒ€çš„</strong> ä»è¿™äº›ç»éªŒä¸­ <strong>ä¸é‡å¤çš„</strong> é€‰å–ä¸€æ¡æˆ–å¤šæ¡ç»éªŒæ¥è®­ç»ƒã€‚</p><blockquote><p>$n$ çš„å¤§å°é€šå¸¸åœ¨åä¸‡åˆ°ç™¾ä¸‡ä¹‹é—´ï¼Œè§†æƒ…å†µè€Œå®šã€‚è¿™ä¸ªå€¼å¯¹è®­ç»ƒå½±å“è¾ƒå¤§ã€‚<br>ç»éªŒå›æ”¾ç°åœ¨æ˜¯æ·±åº¦å¼ºåŒ–å­¦ä¹ çš„æ ‡å‡†æŠ€å·§ä¹‹ä¸€ã€‚</p></blockquote><h2 id="ä¸‰ã€ä¼˜å…ˆç»éªŒå›æ”¾ï¼ˆPrioritized-Experience-Replayï¼‰"><a href="#ä¸‰ã€ä¼˜å…ˆç»éªŒå›æ”¾ï¼ˆPrioritized-Experience-Replayï¼‰" class="headerlink" title="ä¸‰ã€ä¼˜å…ˆç»éªŒå›æ”¾ï¼ˆPrioritized Experience Replayï¼‰"></a>ä¸‰ã€ä¼˜å…ˆç»éªŒå›æ”¾ï¼ˆPrioritized Experience Replayï¼‰</h2><p>å¯¹ç»éªŒå›æ”¾æ”¹è¿›æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ä¸€ä¸ªå¸¸è§çš„æ˜¯ä¼˜å…ˆç»éªŒå›æ”¾ã€‚</p><p>ä¼˜å…ˆç»éªŒå›æ”¾çš„åŸç†æ˜¯ <strong>ç”¨éå‡åŒ€æŠ½æ ·ä»£æ›¿å‡åŒ€æŠ½æ ·</strong> æ¥æŠ½å–ç»éªŒã€‚</p><h3 id="3-1-ç»éªŒçš„é‡è¦æ€§ä¸åŒ"><a href="#3-1-ç»éªŒçš„é‡è¦æ€§ä¸åŒ" class="headerlink" title="3.1 ç»éªŒçš„é‡è¦æ€§ä¸åŒ"></a>3.1 ç»éªŒçš„é‡è¦æ€§ä¸åŒ</h3><p>æ¨¡å‹åœ¨å’Œç¯å¢ƒäº¤äº’æ—¶ï¼Œè·å¾—çš„ç»éªŒçš„é‡è¦æ€§æ˜¯ä¸åŒçš„ã€‚</p><p>æ¯”å¦‚ï¼šåœ¨ä¸€ä¸ªæ‰“æ€ªå‡çº§çš„æ¸¸æˆä¸­ï¼Œå¤§å¤šæ•°ç»éªŒéƒ½æ˜¯å’Œå°å…µæˆ˜æ–—ï¼Œåªæœ‰å¾ˆå°‘çš„ç»éªŒæ˜¯å’ŒBOSSæˆ˜æ–—ã€‚è¿™æ ·å°±å®¹æ˜“å¯¼è‡´è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹å®¹æ˜“æˆ˜èƒœå°å…µï¼Œä½†æ˜¯å¾ˆéš¾æ‰“èµ¢BOSSã€‚æ‰€ä»¥å’ŒBOSSæˆ˜æ–—çš„ç»éªŒæ¯”å’Œå°å…µæˆ˜æ–—çš„ç»éªŒæ›´ä¸ºé‡è¦ã€‚</p><h3 id="3-2-ç»éªŒçš„æŠ½æ ·æ¦‚ç‡"><a href="#3-2-ç»éªŒçš„æŠ½æ ·æ¦‚ç‡" class="headerlink" title="3.2 ç»éªŒçš„æŠ½æ ·æ¦‚ç‡"></a>3.2 ç»éªŒçš„æŠ½æ ·æ¦‚ç‡</h3><p>å¯¹äºè¶Šä¸ç†Ÿæ‚‰çš„çŠ¶æ€ï¼Œæ¨¡å‹é¢„æµ‹å‡ºçš„ <strong>TD error</strong> çš„ç»å¯¹å€¼å°±ä¼šè¶Šå¤§ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ® <strong>TD error</strong> çš„ç»å¯¹å€¼çš„å¤§å°æ¥åˆ¤æ–­ä¸€æ¡ç»éªŒçš„é‡è¦æ€§ã€‚å³ <strong>TD error</strong> çš„ç»å¯¹å€¼è¶Šå¤§è¶Šé‡è¦ã€‚</p><p>å°† <strong>TD error</strong> å¯¹åº”åˆ°æŠ½æ ·æ¦‚ç‡çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ol><li><p>ç»éªŒæŠ½æ ·çš„æ¦‚ç‡ $p_t$ æ­£æ¯”äº <strong>TD error</strong> $\delta_t$ çš„ç»å¯¹å€¼åŠ ä¸Šä¸€ä¸ªå¾ˆå°çš„æ•° $\epsilon$ ï¼ˆé¿å…æ¦‚ç‡ä¸º0ï¼‰ã€‚</p><script type="math/tex; mode=display">p_t \propto \vert \delta_t \vert + \epsilon</script></li><li><p>å°†æ‰€æœ‰ç»éªŒçš„ <strong>TD error</strong> çš„ç»å¯¹å€¼è¿›è¡Œæ’åºï¼Œå¤§çš„é å‰ï¼Œå°çš„é åã€‚ ç»éªŒæŠ½æ ·çš„æ¦‚ç‡åæ¯”äºæ’åºåç»éªŒæ‰€å¤„çš„ä½ç½®ã€‚</p><script type="math/tex; mode=display">p_t \propto \frac{1}{rank(t)}</script></li></ol><h3 id="3-3-è°ƒæ•´å­¦ä¹ ç‡"><a href="#3-3-è°ƒæ•´å­¦ä¹ ç‡" class="headerlink" title="3.3 è°ƒæ•´å­¦ä¹ ç‡"></a>3.3 è°ƒæ•´å­¦ä¹ ç‡</h3><p>å› ä¸ºæŠ½æ ·æ—¶æ˜¯éå‡åŒ€çš„ï¼Œæ‰€ä»¥éœ€è¦è°ƒæ•´å­¦ä¹ ç‡æ¥æŠµæ¶ˆä¸åŒæŠ½æ ·æ¦‚ç‡é€ æˆçš„åå·®ã€‚</p><p>å¦‚æœä¸€æ¡ç»éªŒçš„æŠ½æ ·æ¦‚ç‡å¾ˆå¤§ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šç»å¸¸çš„è¢«æŠ½åˆ°ç”¨äºæ›´æ–°æ¨¡å‹ï¼Œæ‰€ä»¥éœ€è¦è°ƒå°è¿™æ¡ç»éªŒçš„å­¦ä¹ ç‡ã€‚åä¹‹äº¦ç„¶ã€‚</p><p>æ¯æ¡ç»éªŒçš„å­¦ä¹ ç‡éƒ½éœ€è¦ä¹˜ä»¥ç³»æ•° $(n \cdot p_t)^{-\beta}$ï¼Œå…¶ä¸­ $n$ æ˜¯ç»éªŒå›æ”¾æ± ä¸­ç»éªŒçš„æ€»æ¡æ•°ï¼Œ $p_t$ æ˜¯æ¯æ¡ç»éªŒçš„æŠ½éªŒæ¦‚ç‡ï¼Œ $\beta$ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œå€¼åœ¨0åˆ°1ä¹‹é—´ï¼Œ $\beta \in (0, 1)$ã€‚</p><p>å¯¹äºå‡åŒ€æŠ½æ ·æ¥è¯´ï¼Œæ¯æ¡ç»éªŒæ¦‚ç‡ç›¸åŒï¼Œ$p_1 = \cdots = p_n = \frac{1}{n}$ ï¼Œå­¦ä¹ ç‡ç³»æ•° $(n \cdot p_t)^{-\beta}$ å€¼çš„å’Œä¸º1ã€‚</p><p>å¯¹äºéå‡åŒ€æŠ½æ ·æ¥è¯´ï¼ŒæŠ½æ ·æ¦‚ç‡ $p_t$ è¶Šå¤§ï¼Œå­¦ä¹ ç‡ç³»æ•° $(n \cdot p_t)^{-\beta}$ çš„å€¼è¶Šå°ã€‚è®ºæ–‡ä¸­æ¨èå¼€å§‹æ—¶ $\beta$ å€¼å¾ˆå°ï¼Œåé¢é€æ­¥å¢é•¿åˆ°1ã€‚</p><h3 id="3-4-å®ç°ç»†èŠ‚"><a href="#3-4-å®ç°ç»†èŠ‚" class="headerlink" title="3.4 å®ç°ç»†èŠ‚"></a>3.4 å®ç°ç»†èŠ‚</h3><p>éœ€è¦å°†æ‰€æœ‰çš„ç»éªŒ $(s_r, a_t, r_t, s_{t+1})$ éƒ½è®¡ç®—å‡ºå¯¹åº”çš„ <strong>TD error</strong>ã€‚</p><p>å¯¹äºåˆšåˆšæ”¶é›†åˆ°çš„ç»éªŒï¼Œå¯ä»¥å°†å…¶ <strong>TD error</strong> çš„å€¼è®¾ç½®ä¸ºæœ€å¤§å€¼ã€‚</p><p>æ¯æ¬¡ä½¿ç”¨ç»éªŒåéƒ½éœ€è¦æ›´æ–°å¯¹åº”çš„ <strong>TD error</strong> ã€‚</p><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=rhslMPmj7SY&amp;list=PLvOO0btloRntS5U8rQWT9mHFcUdYOUmIC&amp;ab_channel=ShusenWang">Experience Replay</a><br>ç»éªŒå›æ”¾è®ºæ–‡ï¼š<a href="http://isl.anthropomatik.kit.edu/pdf/Lin1993.pdf">Reinforcement Learning for Robots Using Neural Networks</a><br>ä¼˜å…ˆç»éªŒå›æ”¾è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1511.05952">Prioritized Experience Replay</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åºå·®åˆ†å­¦ä¹  </tag>
            
            <tag> ç»éªŒå›æ”¾ </tag>
            
            <tag> ä¼˜å…ˆç»éªŒå›æ”¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºåŒ–å­¦ä¹ ä¸­æ—¶åºå·®åˆ†å­¦ä¹ </title>
      <link href="qiang-hua-xue-xi-zhong-shi-xu-chai-fen-xue-xi/"/>
      <url>qiang-hua-xue-xi-zhong-shi-xu-chai-fen-xue-xi/</url>
      
        <content type="html"><![CDATA[<p>åœ¨<a href="https://kibazen.cn/li-jie-meng-te-qia-luo-fang-fa-he-shi-xu-chai-fen-xue-xi/">ç†è§£è’™ç‰¹å¡æ´›æ–¹æ³•å’Œæ—¶åºå·®åˆ†å­¦ä¹ </a>ä¸€æ–‡ä¸­å·²ç»å¯¹æ—¶åºå·®åˆ†å­¦ä¹ è¿›è¡Œäº†ç›´è§‚ä¸Šçš„è§£é‡Šï¼Œæœ¬æ–‡ä¸­å°†å…·ä½“çš„æè¿°æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼è¿‡ç¨‹åŠåœ¨å¼ºåŒ–å­¦ä¹ ä¸­çš„åº”ç”¨ã€‚</p><h2 id="ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼"><a href="#ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼" class="headerlink" title="ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼"></a>ä¸€ã€æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼</h2><p>æ ¹æ®æŠ˜æ‰£å›æŠ¥ï¼ˆDiscounted Returnï¼‰çš„å®šä¹‰ï¼Œæœ‰ï¼š</p><script type="math/tex; mode=display">\begin{aligned}G_t& = R_t + \gamma \cdot R_{t+1} + \gamma^2 \cdot R_{t+2} + \gamma^3 \cdot R_{t+3} + \cdots \\& = R_t + \gamma \cdot (R_{t+1} + \gamma \cdot R_{t+2} + \gamma^2 \cdot R_{t+3} + \cdots) \\& = R_t + \gamma \cdot G_{t+1}\end{aligned}</script><p>æ ¹æ®åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆAction-value functionï¼‰çš„å®šä¹‰ï¼Œæœ‰ï¼š</p><script type="math/tex; mode=display">\begin{aligned}Q_{\pi}(s_t, a_t)& = \mathbb{E}[G_t | s_t, a_t] \\& = \mathbb{E}[R_t + \gamma \cdot G_{t+1} | s_t, a_t] \\& = \mathbb{E}[R_t | s_t, a_t] + \gamma \cdot \mathbb{E}[G_{t+1} | s_t, a_t] \\& = \mathbb{E}[R_t | s_t, a_t] + \gamma \cdot \mathbb{E}[Q_{\pi}(S_{t+1}, A_{t+1}) | s_t, a_t] \\& = \mathbb{E}[R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})] \\\end{aligned}</script><p>å³ï¼Œå¯¹æ‰€æœ‰çš„ç­–ç•¥ $\pi$ éƒ½æœ‰å¦‚ä¸‹çš„ç­‰å¼ï¼š</p><script type="math/tex; mode=display">Q_{\pi}(s_t, a_t) = \mathbb{E}[R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})], \text{ for all }\pi</script><p>ç›´æ¥æ±‚ $R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})$ çš„æœŸæœ›å¾ˆå›°éš¾ï¼Œå¯ä»¥å¯¹æœŸæœ›åšè’™ç‰¹å¡æ´›ï¼ˆMonte Carloï¼‰è¿‘ä¼¼ï¼Œå³ï¼š</p><ul><li>ä½¿ç”¨çœŸå®çš„å¥–åŠ±å€¼ $r_t$ æ¥è¿‘ä¼¼ $R_t$ã€‚</li><li>ä½¿ç”¨çœŸå®çš„Qå€¼ $Q_{\pi}(s_{t+1}, a_{t+1})$ æ¥è¿‘ä¼¼ $Q_{\pi}(S_{t+1}, A_{t+1})$ ã€‚</li></ul><p>æ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">\begin{aligned}Q_{\pi}(s_t, a_t)& = \mathbb{E}[R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})] \\& \approx r_t + \gamma \cdot Q_{\pi}(s_{t+1}, a_{t+1}) \\\end{aligned}</script><p>ç»“è®ºï¼š</p><ol><li>å¸¸å°† $r_t + \gamma \cdot Q_{\pi}(s_{t+1}, a_{t+1})$ çš„å€¼è®°ä½œ $y_t$ ã€‚</li><li>å› ä¸º $y_t$ ä¸­åŒ…å«äº†çœŸå®çš„å¥–åŠ±å€¼ $r_t$ ï¼Œæ‰€ä»¥è®¤ä¸º $y_t$ æ¯” $Q_{\pi}(s_t, a_t)$ æ›´å‡†ç¡®ã€‚</li><li>å°† $y_t$ å‘½åä¸º <strong>TD target</strong>ï¼Œè€Œå°† $y_t - Q_{\pi}(s_t, a_t)$ çš„å€¼å‘½åä¸º <strong>TD error</strong>ã€‚</li><li><strong>TD error</strong> çš„ç»å¯¹å€¼è¶Šå°ï¼Œå°±è¡¨æ˜æ¨¡å‹é¢„æµ‹è¯¯å·®è¶Šå°ï¼Œé¢„æµ‹çš„ç»“æœè¶Šå‡†ç¡®ã€‚æ‰€ä»¥ï¼Œåœ¨ç¡®å®šå¥½ <strong>TD error</strong> çš„è®¡ç®—æ–¹å¼åï¼Œå¯ä»¥é€šè¿‡ <strong>æ¢¯åº¦ä¸‹é™</strong> æ–¹æ³•æ¥æ›´æ–°æ¨¡å‹çš„å‚æ•°ï¼Œé™ä½ <strong>TD error</strong> ã€‚</li><li>æ—¶åºå·®åˆ†å­¦ä¹ çš„ç›®çš„æ˜¯è®©æ¨¡å‹é¢„æµ‹å‡ºçš„ $Q_{\pi}(s_t, a_t)$ å€¼ä¸æ–­çš„æ¥è¿‘<strong>TD target</strong> ã€‚</li></ol><h2 id="äºŒã€Sarsaç®—æ³•"><a href="#äºŒã€Sarsaç®—æ³•" class="headerlink" title="äºŒã€Sarsaç®—æ³•"></a>äºŒã€Sarsaç®—æ³•</h2><blockquote><p>Sarsaæ˜¯Stateâ€“actionâ€“rewardâ€“stateâ€“actionè¿™å‡ ä¸ªå•è¯çš„ç¼©å†™ã€‚</p></blockquote><p><a href="#ä¸€æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼">æ—¶åºå·®åˆ†å­¦ä¹ </a>çš„ä¸€ä¸ªåº”ç”¨å°±æ˜¯Sarsaç®—æ³•ï¼ŒSarsaç®—æ³•çš„ç›®çš„å°±æ˜¯ä½¿ç”¨ç¥ç»ç½‘ç»œ $Q(s,a)$ å»é€¼è¿‘ <strong>åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆaction-value functionï¼‰$Q_{\pi}(s,a)$</strong> ã€‚</p><p>Sarsaç®—æ³•çš„<strong>TD target</strong>ä¸º $y_t = r_t + \gamma \cdot Q(s_{t+1}, a_{t+1})$ ã€‚</p><h2 id="ä¸‰ã€Q-Learningç®—æ³•çš„æ•°å­¦æ¨å¯¼"><a href="#ä¸‰ã€Q-Learningç®—æ³•çš„æ•°å­¦æ¨å¯¼" class="headerlink" title="ä¸‰ã€Q-Learningç®—æ³•çš„æ•°å­¦æ¨å¯¼"></a>ä¸‰ã€Q-Learningç®—æ³•çš„æ•°å­¦æ¨å¯¼</h2><p>åœ¨<a href="#ä¸€æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼">æ—¶åºå·®åˆ†å­¦ä¹ çš„æ•°å­¦æ¨å¯¼</a>ä¸­å¾—åˆ°äº†ï¼Œå¯¹æ‰€æœ‰çš„ç­–ç•¥ $\pi$ éƒ½æœ‰å¦‚ä¸‹çš„ç­‰å¼ï¼š</p><script type="math/tex; mode=display">Q_{\pi}(s_t, a_t) = \mathbb{E}[R_t + \gamma \cdot Q_{\pi}(S_{t+1}, A_{t+1})], \text{ for all }\pi</script><p>å¯¹æœ€ä¼˜ç­–ç•¥ ${\pi}_*$ ä¹Ÿæˆç«‹ï¼Œæ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">Q_*(s_t, a_t) = \mathbb{E}[R_t + \gamma \cdot Q_*(S_{t+1}, A_{t+1})]</script><blockquote><p><script type="math/tex">Q_{\pi_*}(s_t, a_t)</script> å¯ä»¥ç®€å†™ä¸º <script type="math/tex">Q_*(s_t, a_t)</script> ï¼Œéƒ½å¯ä»¥è¡¨ç¤ºæœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ã€‚</p></blockquote><p>å› ä¸ºæœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°æ€»æ˜¯é‡‡ç”¨æœ€ä¼˜çš„åŠ¨ä½œï¼š</p><script type="math/tex; mode=display">A_{t+1} = \underset{a}{\operatorname{argmax}}Q_*(S_{t+1}, a)</script><p>æ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">Q_*(S_{t+1}, A_{t+1}) = \max_a Q_* (S_{t+1}, a)</script><p>å³ï¼š</p><script type="math/tex; mode=display">\begin{aligned}Q_*(s_t, a_t)& = \mathbb{E}[R_t + \gamma \cdot Q_*(S_{t+1}, A_{t+1})] \\& = \mathbb{E}[R_t + \gamma \cdot \underset{a}{\operatorname{max}} Q_* (S_{t+1}, a)] \\\end{aligned}</script><p>ç›´æ¥æ±‚ $R_t + \gamma \cdot \underset{a}{\operatorname{max}} Q_* (S_{t+1}, a)$ çš„æœŸæœ›å¾ˆå›°éš¾ï¼Œå¯ä»¥å¯¹æœŸæœ›åšè’™ç‰¹å¡æ´›ï¼ˆMonte Carloï¼‰è¿‘ä¼¼ï¼Œå³ï¼š</p><ul><li>ä½¿ç”¨çœŸå®çš„å¥–åŠ±å€¼ $r_t$ æ¥è¿‘ä¼¼ $R_t$ã€‚</li><li>ä½¿ç”¨çœŸå®çš„Qå€¼ <script type="math/tex">\underset{a}{ \operatorname{max} } Q_*(s_{t+1}, a)</script> æ¥è¿‘ä¼¼ <script type="math/tex">\underset{a}{ \operatorname{max} } Q_*(S_{t+1}, a)</script> ã€‚</li></ul><p>æ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">\begin{aligned}Q_*(s_t, a_t)& = \mathbb{E}[R_t + \gamma \cdot \underset{a}{\operatorname{max}} Q_* (S_{t+1}, a)] \\& \approx r_t + \gamma \cdot \underset{a}{\operatorname{max}} Q_*(s_{t+1}, a) \\\end{aligned}</script><h2 id="å››ã€Q-Learningç®—æ³•"><a href="#å››ã€Q-Learningç®—æ³•" class="headerlink" title="å››ã€Q-Learningç®—æ³•"></a>å››ã€Q-Learningç®—æ³•</h2><p><a href="#ä¸‰q-learningç®—æ³•çš„æ•°å­¦æ¨å¯¼">æ—¶åºå·®åˆ†å­¦ä¹ </a>çš„å¦ä¸€ä¸ªåº”ç”¨å°±æ˜¯Q-Learningç®—æ³•ï¼ŒQ-Learningç®—æ³•çš„ç›®çš„å°±æ˜¯ä½¿ç”¨ç¥ç»ç½‘ç»œ $Q(s,a)$ å»é€¼è¿‘ <strong>æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆoptimal action-value functionï¼‰<script type="math/tex">Q_*(s,a)</script></strong> ã€‚</p><p>Q-Learningç®—æ³•çš„<strong>TD target</strong>ä¸º <script type="math/tex">y_t = r_t + \gamma \cdot \underset{a}{\operatorname{max}} Q_*(s_{t+1}, a)</script> ã€‚</p><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=-cYWdUubB6Q&amp;list=PLvOO0btloRnvWZCkAUrBbVB5ZjDI2hUAM&amp;ab_channel=ShusenWang">TD Learning</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åºå·®åˆ†å­¦ä¹  </tag>
            
            <tag> Sarsaç®—æ³• </tag>
            
            <tag> Q-Learningç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç†è§£è’™ç‰¹å¡æ´›æ–¹æ³•å’Œæ—¶åºå·®åˆ†å­¦ä¹ </title>
      <link href="li-jie-meng-te-qia-luo-fang-fa-he-shi-xu-chai-fen-xue-xi/"/>
      <url>li-jie-meng-te-qia-luo-fang-fa-he-shi-xu-chai-fen-xue-xi/</url>
      
        <content type="html"><![CDATA[<p>å­¦ä¹ æœºå™¨å­¦ä¹ æ—¶å¸¸å¸¸ä¼šç”¨åˆ°è’™ç‰¹å¡æ´›æ–¹æ³•å’Œæ—¶åºå·®åˆ†å­¦ä¹ ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬æœ‰ä¸€ä¸ªç›´è§‚çš„ç†è§£è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚æœ¬æ–‡é€šè¿‡ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£ã€‚</p><p>å‡å¦‚è¦è®­ç»ƒä¸€ä¸ªé¢„ä¼°å¼€è½¦ä»æˆéƒ½åˆ°åŒ—äº¬éœ€è¦è€—æ—¶å¤šä¹…çš„æ¨¡å‹ï¼ˆModelï¼‰ï¼Œé‚£ä¹ˆå¦‚ä½•è®­ç»ƒå‘¢ï¼Ÿ</p><div id="flowchart-0" class="flow-chart"></div><h2 id="1-è’™ç‰¹å¡æ´›æ–¹æ³•ï¼ˆMonte-Carlo-methodï¼‰"><a href="#1-è’™ç‰¹å¡æ´›æ–¹æ³•ï¼ˆMonte-Carlo-methodï¼‰" class="headerlink" title="1. è’™ç‰¹å¡æ´›æ–¹æ³•ï¼ˆMonte Carlo methodï¼‰"></a>1. è’™ç‰¹å¡æ´›æ–¹æ³•ï¼ˆMonte Carlo methodï¼‰</h2><p>æœ€ç›´è§‚çš„æ–¹æ³•ï¼Œæ—¢ç„¶è¦é¢„ä¼°å¼€è½¦ä»æˆéƒ½åˆ°åŒ—äº¬éœ€è¦è€—æ—¶å¤šä¹…ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è®°å½•å¼€è½¦ä»æˆéƒ½åˆ°åŒ—äº¬æ‰€éœ€è¦çš„æ—¶é—´ã€‚ç„¶åé‡å¤å¾ˆå¤šæ¬¡ï¼Œæ¯”å¦‚100æ¬¡ï¼ŒæŠŠæ¯æ¬¡çš„è€—æ—¶éƒ½ç»™æ¨¡å‹å­¦ä¹ ï¼ˆè‡³äºæ¨¡å‹å…·ä½“æ€ä¹ˆå­¦ä¹ ï¼Œåˆéœ€è¦å¦å¤–çš„ç®—æ³•äº†ï¼Œæ¯”å¦‚ï¼š<a href="https://en.wikipedia.org/wiki/Gradient_descent">æ¢¯åº¦ä¸‹é™</a>ï¼‰ï¼Œè¿™æ ·æ¨¡å‹å°±èƒ½é¢„ä¼°å‡ºä¸€ä¸ªæ¯”è¾ƒå‡†ç¡®çš„æ—¶é—´äº†ã€‚</p><p>ä¸Šé¢è¿™ç§æ–¹æ³•å…¶å®å°±æ˜¯<a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">è’™ç‰¹å¡æ´›æ–¹æ³•</a>ã€‚è¿™ç§ç®—æ³•çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><strong>ç®€å•ç›´æ¥</strong>ï¼šè¦é¢„ä¼°å¼€è½¦ä»æˆéƒ½åˆ°åŒ—äº¬éœ€è¦è€—æ—¶å¤šä¹…ï¼Œé‚£ç›´æ¥åšå¾ˆå¤šæ¬¡ï¼Œå¹¶è®°å½•ç»éªŒï¼Œç„¶åå°±èƒ½æ¯”è¾ƒå‡†ç¡®çš„è®­ç»ƒäº†ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><strong>æ”¶é›†æ•°æ®éº»çƒ¦</strong>ï¼šç›´æ¥å°è¯•è¿˜æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œä»£ä»·å¤ªé«˜ã€‚å¦‚æœè¦è®­ç»ƒä¸€ä¸ªé¢„æµ‹æ‰‹æœ¯æˆåŠŸç‡çš„æ¨¡å‹ï¼Œæ€»ä¸èƒ½æ‹¿äººå»è¯•å§ã€‚</li><li><strong>éœ€è¦ç­‰åˆ°å®Œæ•´çš„ä¸€æ¬¡è¿‡ç¨‹åæ‰èƒ½å¼€å§‹è®­ç»ƒ</strong>ï¼šå¼€è½¦åˆ°ä¸€åŠæ—¶æ˜¯ä¸èƒ½è®­ç»ƒæ¨¡å‹çš„ï¼Œå¿…é¡»è¦åˆ°äº†ç›®çš„åœ°æ‰èƒ½è®­ç»ƒã€‚å¦‚æœè·¯ä¸Šè½¦å‡ºäº†æ•…éšœï¼Œé‚£ä¹ˆä¹‹å‰å¼€çš„è·¯éƒ½ç™½è´¹äº†ï¼Œä»£ä»·ä¹Ÿå¤ªé«˜äº†ã€‚</li></ul><p>ç¬¬ä¸€ä¸ªç¼ºç‚¹ä¸å¥½è§£å†³ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªç¼ºç‚¹è¿˜æ˜¯æœ‰åŠæ³•æ”¹å–„çš„ï¼Œé‚£å°±æ˜¯ä½¿ç”¨<a href="#2-æ—¶åºå·®åˆ†å­¦ä¹ temporal-difference-learning">æ—¶åºå·®åˆ†å­¦ä¹ </a>ã€‚</p><h2 id="2-æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal-Difference-Learningï¼‰"><a href="#2-æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal-Difference-Learningï¼‰" class="headerlink" title="2. æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal Difference Learningï¼‰"></a>2. æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal Difference Learningï¼‰</h2><p>æ—¶åºå·®åˆ†å­¦ä¹ çš„æ¦‚å¿µä¸æ˜¯é‚£ä¹ˆå®¹æ˜“è§£é‡Šï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ›´å®é™…çš„ä¾‹å­æ¥ç†è§£ï¼š</p><p>å¼€å§‹æ—¶æ¨¡å‹é¢„ä¼°å¼€è½¦ä»æˆéƒ½åˆ°åŒ—äº¬éœ€è¦èŠ±100ä¸ªå°æ—¶ã€‚</p><div id="flowchart-1" class="flow-chart"></div><p>å®é™…å¼€è½¦ä»æˆéƒ½å‡ºå‘ï¼Œå®é™…èŠ±è´¹äº†30ä¸ªå°æ—¶åˆ°è¥¿å®‰ï¼Œæ­¤æ—¶æ¨¡å‹é¢„ä¼°åˆ°åŒ—äº¬è¿˜æ˜¯60ä¸ªå°æ—¶ã€‚</p><div id="flowchart-2" class="flow-chart"></div><p>æ‰€ä»¥æ¨¡å‹åœ¨å¼€å§‹æ—¶æ›´å‡†ç¡®çš„é¢„ä¼°åº”è¯¥æ˜¯ï¼š</p><p>30å°æ—¶ï¼ˆæˆéƒ½åˆ°è¥¿å®‰çš„<strong>å®é™…æ—¶é—´</strong>ï¼‰+ 60å°æ—¶ï¼ˆæ–°çš„<strong>é¢„ä¼°æ—¶é—´</strong>ï¼‰= 90å°æ—¶</p><p>åœ¨æ—¶åºå·®åˆ†å­¦ä¹ ä¸­ï¼Œè¿™ä¸ªæ›´å‡†ç¡®çš„ä¼°è®¡å°±å«åš <strong>TD target</strong> ã€‚æœ‰äº†è¿™ä¸ªæ›´å‡†ç¡®é¢„ä¼°åï¼Œå°±çŸ¥é“å¼€å§‹æ—¶çš„é¢„ä¼°æ—¶é—´æ˜¯å¤šäº†è¿˜æ˜¯å°‘äº†ï¼Œä»è€Œå°±èƒ½æ›´æ–°æ¨¡å‹çš„å‚æ•°è®©æ¨¡å‹çš„é¢„ä¼°è¶Šæ¥è¶Šå‡†ç¡®ã€‚è¿™æ ·å°±èƒ½å¤Ÿåšåˆ°ä¸åšå®Œæ•´ä»¶äº‹å°±å¼€å§‹è®­ç»ƒæ¨¡å‹äº†ã€‚</p><p>è€Œæœ€åˆçš„é¢„ä¼°æ—¶é—´å’Œ <strong>TD target</strong> çš„å·®å€¼å°±æ˜¯ <strong>TD error</strong>ï¼š</p><p><strong>TD error</strong> = 100å°æ—¶(å¼€å§‹æ—¶çš„é¢„ä¼°è€—æ—¶ï¼‰ - 90å°æ—¶ï¼ˆ<strong>TD error</strong>ï¼‰ = 10å°æ—¶</p><p>æ—¶åºå·®åˆ†å­¦ä¹ çš„ç›®æ ‡å°±æ˜¯è®© <strong>TD error</strong> çš„å€¼æ¥è¿‘0ã€‚</p><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=jflq6vNcZyA&amp;t=1344s&amp;ab_channel=ShusenWang">Value-Based Reinforcement Learning</a></p><p><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">cd=&gt;start: æˆéƒ½bj=&gt;end: åŒ—äº¬cd-&gt;bj</textarea><textarea id="flowchart-0-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">cd=&gt;start: æˆéƒ½bj=&gt;end: åŒ—äº¬ï¼ˆæ¨¡å‹é¢„ä¼°éœ€100å°æ—¶ï¼‰cd-&gt;bj</textarea><textarea id="flowchart-1-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script><textarea id="flowchart-2-code" style="display: none">cd=&gt;start: æˆéƒ½xa=&gt;end: è¥¿å®‰ï¼ˆå®é™…å¼€è½¦èŠ±è´¹30å°æ—¶ï¼‰bj=&gt;end: åŒ—äº¬ï¼ˆæ¨¡å‹é¢„ä¼°è¿˜éœ€60å°æ—¶ï¼‰cd-&gt;xa-&gt;bj</textarea><textarea id="flowchart-2-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-2-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-2-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-2", options);</script></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¶åºå·®åˆ†å­¦ä¹  </tag>
            
            <tag> è’™ç‰¹å¡æ´›æ–¹æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç†è§£å¼ºåŒ–å­¦ä¹ ä¸­çš„åŸºæœ¬æ¦‚å¿µ</title>
      <link href="li-jie-qiang-hua-xue-xi-zhong-de-ji-ben-gai-nian/"/>
      <url>li-jie-qiang-hua-xue-xi-zhong-de-ji-ben-gai-nian/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€éšæœºå˜é‡"><a href="#ä¸€ã€éšæœºå˜é‡" class="headerlink" title="ä¸€ã€éšæœºå˜é‡"></a>ä¸€ã€éšæœºå˜é‡</h2><p>å˜é‡çš„å€¼æ— æ³•é¢„å…ˆç¡®å®šä»…ä»¥ä¸€å®šçš„å¯èƒ½æ€§ï¼ˆæ¦‚ç‡ï¼‰å–å€¼çš„é‡ã€‚</p><p>å¼ºåŒ–å­¦ä¹ ä¸­ä¸€èˆ¬ç”¨å¤§å†™çš„å­—æ¯è¡¨ç¤ºéšæœºå˜é‡ï¼Œç”¨å°å†™çš„å­—æ¯è¡¨ç¤ºéšæœºå˜é‡çš„è§‚æµ‹å€¼ï¼ˆç¡®å®šçš„å€¼ï¼‰ã€‚</p><blockquote><p>æ¯”å¦‚ï¼šæ·éª°å­ä¸­ï¼Œç”¨å¤§å†™çš„å˜é‡ $X$ è¡¨ç¤ºå¯èƒ½æ·å‡ºæ¥éª°å­çš„å€¼ã€‚å‡å¦‚æ·ä¸€æ¬¡éª°å­ï¼Œå¾—åˆ°å®ƒçš„å€¼æ˜¯2ç‚¹ï¼Œå¯ä»¥ç”¨å°å†™çš„å˜é‡ $x$ æ¥è¡¨ç¤ºï¼Œå³ $x = 2$ ã€‚</p></blockquote><p>éšæœºå˜é‡åˆ†ä¸¤ç§åŸºæœ¬çš„ç±»å‹ï¼šç¦»æ•£å‹éšæœºå˜é‡å’Œè¿ç»­å‹éšæœºå˜é‡ã€‚</p><blockquote><p>å¼ºåŒ–å­¦ä¹ ä¸­è®­ç»ƒä¸åŒç±»å‹çš„å˜é‡ä¸€èˆ¬éœ€è¦ä½¿ç”¨ä¸åŒç±»å‹çš„ç®—æ³•ï¼Œåªæœ‰å°‘éƒ¨åˆ†ç®—æ³•åŒæ—¶æ”¯æŒä¸¤ç§ç±»å‹çš„å˜é‡è®­ç»ƒã€‚<br>è®­ç»ƒç¦»æ•£å‹éšæœºå˜é‡ä½¿ç”¨çš„æŸå¤±å‡½æ•°ä¸€èˆ¬æ˜¯äº¤å‰ç†µï¼ˆCross Entropyï¼‰ï¼Œè€Œè®­ç»ƒè¿ç»­å‹éšæœºå˜é‡ä½¿ç”¨çš„æŸå¤±å‡½æ•°ä¸€èˆ¬æ˜¯å‡æ–¹è¯¯å·®ï¼ˆMSE, Mean Squared Errorï¼‰ã€‚</p></blockquote><h2 id="äºŒã€æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆProbability-Density-Functionï¼ŒPDFï¼‰"><a href="#äºŒã€æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆProbability-Density-Functionï¼ŒPDFï¼‰" class="headerlink" title="äºŒã€æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆProbability Density Functionï¼ŒPDFï¼‰"></a>äºŒã€æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆProbability Density Functionï¼ŒPDFï¼‰</h2><p>æè¿°éšæœºå˜é‡çš„è¾“å‡ºå€¼ï¼Œç‰©ç†æ„ä¹‰ä¸ºéšæœºå˜é‡åœ¨æŸä¸ªç¡®å®šçš„å–å€¼ç‚¹é™„è¿‘çš„å¯èƒ½æ€§ã€‚</p><blockquote><p>æ¯”å¦‚ï¼šæ·éª°å­çš„æ¦‚ç‡å¯†åº¦å‡½æ•° $p(X) = \frac{1}{6}$ ã€‚<br>å¼ºåŒ–å­¦ä¹ ä¸­çš„ç­–ç•¥ $\pi$ å°±æ˜¯ä¸€ä¸ªæ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚å› ä¸ºå®ƒè¾“å‡ºçš„å…¶å®æ˜¯å„ä¸ªåŠ¨ä½œçš„æ¦‚ç‡ã€‚</p></blockquote><p>å› ä¸ºæ¦‚ç‡çš„æ€»å’Œæ€»æ˜¯1ï¼Œæ‰€ä»¥ï¼š</p><ol><li>å¯¹äºç¦»æ•£å‹éšæœºå˜é‡ $X$ åŠå…¶å¯èƒ½å€¼çš„é›†åˆ $\mathcal{X}$ æœ‰ï¼š<script type="math/tex; mode=display">\sum_{x \in \mathcal{X}} p(x) = 1</script></li><li>å¯¹äºè¿ç»­å‹éšæœºå˜é‡ $X$ åŠå…¶å¯èƒ½å€¼çš„åŸŸ $\mathcal{X}$ æœ‰ï¼š<script type="math/tex; mode=display">\int_{\mathcal{X}} p(x) \mathrm{d}x = 1</script></li></ol><h2 id="ä¸‰ã€æœŸæœ›"><a href="#ä¸‰ã€æœŸæœ›" class="headerlink" title="ä¸‰ã€æœŸæœ›"></a>ä¸‰ã€æœŸæœ›</h2><p>éšæœºå˜é‡å€¼äº§ç”Ÿçš„æ¦‚ç‡ä¹˜ä»¥éšæœºå˜é‡å€¼çš„æ€»å’Œã€‚æœŸæœ›ååº”äº†éšæœºå˜é‡å¹³å‡å–å€¼çš„å¤§å°ã€‚</p><ol><li>å¯¹äºç¦»æ•£å‹éšæœºå˜é‡ $X$ åŠå…¶å¯èƒ½å€¼çš„é›†åˆ $\mathcal{X}$ ï¼Œå…¶æœŸæœ›å…¬å¼ä¸ºï¼š<script type="math/tex; mode=display">\mathbb{E}[f(X)] = \sum_{x \in \mathcal{X}} p(x) \cdot f(x)</script></li><li>å¯¹äºè¿ç»­å‹éšæœºå˜é‡ $X$ åŠå…¶å¯èƒ½å€¼çš„åŸŸ $\mathcal{X}$ ï¼Œå…¶æœŸæœ›å…¬å¼ä¸ºï¼š<script type="math/tex; mode=display">\mathbb{E}[f(X)] = \int_{x \in \mathcal{X}} p(x) \cdot f(x) \mathrm{d}x</script></li></ol><h2 id="å››ã€å¼ºåŒ–å­¦ä¹ æ¨¡å‹"><a href="#å››ã€å¼ºåŒ–å­¦ä¹ æ¨¡å‹" class="headerlink" title="å››ã€å¼ºåŒ–å­¦ä¹ æ¨¡å‹"></a>å››ã€å¼ºåŒ–å­¦ä¹ æ¨¡å‹</h2><p><img src="/images/ç†è§£å¼ºåŒ–å­¦ä¹ ä¸­çš„åŸºæœ¬æ¦‚å¿µ/å¼ºåŒ–å­¦ä¹ æ¨¡å‹.jpg" alt="å¼ºåŒ–å­¦ä¹ æ¨¡å‹"></p><p>æ¨¡å‹çš„æ„æˆï¼š</p><ol><li><p>æ™ºèƒ½ä½“ï¼ˆAgentï¼‰<br> ä»ç¯å¢ƒä¸­è§‚æµ‹åˆ°çŠ¶æ€ï¼ˆstateï¼‰å¹¶æ‰§è¡ŒæŸä¸ªåŠ¨ä½œï¼ˆactionï¼‰çš„å¯¹è±¡ã€‚</p><blockquote><p>æ¯”å¦‚åœ¨é©¬é‡Œå¥¥æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬æ§åˆ¶çš„é©¬é‡Œå¥¥è§’è‰²å°±æ˜¯æ™ºèƒ½ä½“ï¼›åœ¨èµ›è½¦æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬æ§åˆ¶çš„èµ›è½¦å°±æ˜¯æ™ºèƒ½ä½“ã€‚</p></blockquote><p> ä¸æ™ºèƒ½ä½“ç´§å¯†ç›¸å…³çš„æ¦‚å¿µæ˜¯ç­–ç•¥ $\pi$ ã€‚ ç­–ç•¥ $\pi$ ç”¨æ¥æ§åˆ¶æ™ºèƒ½ä½“ï¼Œå®ƒçš„è¾“å…¥å°±æ˜¯æ™ºèƒ½ä½“è§‚æµ‹åˆ°çš„çŠ¶æ€ï¼Œç„¶åè¾“å‡ºå„ä¸ªåŠ¨ä½œçš„æ¦‚ç‡ã€‚æ™ºèƒ½ä½“æ‰§è¡Œçš„åŠ¨ä½œå°±æ˜¯ä»è¿™äº›åŠ¨ä½œæ¦‚ç‡ä¸­æŠ½å–å‡ºæ¥çš„ã€‚ç­–ç•¥ $\pi$ å…¶å®å°±æ˜¯ä¸€ä¸ªæ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œå…¶æ•°å­¦å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">\pi(a|s) = \mathbb{P}(A = a | S = s)</script></li><li><p>åŠ¨ä½œï¼ˆActiosï¼‰<br> ä¸ç¯å¢ƒäº¤äº’æ—¶å¯ä»¥é‡‡å–çš„åŠ¨ä½œçš„é›†åˆã€‚</p><blockquote><p>æ¯”å¦‚åœ¨é©¬é‡Œå¥¥æ¸¸æˆä¸­ï¼Œå¯ä»¥é‡‡å–çš„åŠ¨ä½œæœ‰ï¼šå‘å·¦èµ°ã€å‘å³èµ°ã€å‘ä¸Šè·³ã€‚</p></blockquote></li><li><p>ç¯å¢ƒï¼ˆEnvironmentï¼‰<br> æ™ºèƒ½ä½“æ‰€å¤„çš„ç¯å¢ƒã€‚</p><blockquote><p>æ¯”å¦‚åœ¨é©¬é‡Œå¥¥æ¸¸æˆä¸­ï¼Œå°±æ˜¯æŒ‡é©¬é‡Œå¥¥å½“å‰æ‰€å¤„åœ¨çš„æ¸¸æˆç¯å¢ƒã€‚</p></blockquote></li><li><p>çŠ¶æ€ï¼ˆStateï¼‰<br> æ™ºèƒ½ä½“å¯¹ç¯å¢ƒçš„è§‚æµ‹ã€‚</p><blockquote><p>æ¯”å¦‚åœ¨é©¬é‡Œå¥¥æ¸¸æˆä¸­ï¼Œæ¸¸æˆå½“å‰çš„ç”»é¢å°±å¯ä»¥è®¤ä¸ºæ˜¯ç¯å¢ƒå½“å‰çš„çŠ¶æ€ã€‚</p></blockquote><p> å½“æ™ºèƒ½ä½“æ‰§è¡ŒåŠ¨ä½œåï¼Œç¯å¢ƒä¼šè¿›å…¥åˆ°ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œè¿™ä¸ªå°±æ˜¯çŠ¶æ€è½¬ç§»çš„æ¦‚å¿µã€‚çŠ¶æ€è½¬ç§»çš„è¿‡ç¨‹æ˜¯éšæœºçš„ã€‚è¿™ä¸ªéšæœºæ€§æ¥è‡ªäºä¸¤ä¸ªæ–¹é¢ï¼š</p><ul><li>æ™ºèƒ½ä½“æ‰§è¡Œçš„åŠ¨ä½œæ˜¯éšæœºçš„ã€‚æ™ºèƒ½ä½“ç”±ç­–ç•¥ $\pi$ æ§åˆ¶çš„ï¼Œç­–ç•¥ $\pi$ è¾“å‡ºçš„æ˜¯å„ä¸ªåŠ¨ä½œçš„æ¦‚ç‡ã€‚æ‰§è¡Œçš„åŠ¨ä½œæ˜¯ä»è¿™äº›åŠ¨ä½œæ¦‚ç‡ä¸­æŠ½å–å‡ºæ¥çš„ï¼Œæ‰€ä»¥è¯´æ‰§è¡Œçš„åŠ¨ä½œæ˜¯éšæœºçš„ã€‚</li><li><p>ç¯å¢ƒæœ¬èº«çš„å˜åŒ–ä¹Ÿæ˜¯éšæœºçš„ã€‚å³ä½¿æ¯æ¬¡æ™ºèƒ½ä½“æ‰§è¡Œçš„éƒ½æ˜¯ç›¸åŒçš„åŠ¨ä½œï¼Œç¯å¢ƒä¹Ÿä¼šéšæœºçš„å˜åŒ–ã€‚</p><blockquote><p>æ¯”å¦‚åœ¨é©¬é‡Œå¥¥æ¸¸æˆä¸­ï¼Œå³ä½¿æ¯æ¬¡éƒ½è®©é©¬é‡Œå¥¥å‘å‰èµ°ï¼Œä½†æ˜¯æ¸¸æˆé‡Œçš„æ€ªç‰©æ€»æ˜¯ä¼šéšæœºçš„ç§»åŠ¨ï¼Œæ‰€ä»¥æœ€åç¯å¢ƒçš„çŠ¶æ€ä¹Ÿæ˜¯éšæœºçš„ã€‚</p></blockquote><p>çŠ¶æ€è½¬ç§»çš„éšæœºæ€§ç”¨æ•°å­¦è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">p(s\prime | s,a) = \mathbb{P}(S\prime = s\prime | S = s, A = a)</script></li></ul></li><li><p>å¥–åŠ±ï¼ˆRewardï¼‰<br> æ™ºèƒ½ä½“åœ¨ç¯å¢ƒä¸­æ‰§è¡ŒåŠ¨ä½œåè·å¾—çš„å¥–åŠ±æˆ–æƒ©ç½šã€‚</p><blockquote><p>æ¯”å¦‚åœ¨é©¬é‡Œå¥¥æ¸¸æˆä¸­ï¼Œåƒåˆ°ä¸€ä¸ªé‡‘å¸ï¼Œå°±æœ‰é‡‘å¸å¥–åŠ±ã€‚</p></blockquote></li></ol><blockquote><p>å…³äºæ™ºèƒ½ä½“å¯¹ç¯å¢ƒçš„è§‚æµ‹çš„è¡¨è¿°ã€‚ç”¨ state æ—¶è¡¨ç¤ºæ™ºèƒ½ä½“èƒ½è§‚å¯Ÿåˆ°ç¯å¢ƒçš„æ‰€æœ‰å†…éƒ¨çŠ¶æ€ï¼Œç”¨ observation æ—¶è¡¨ç¤ºæ™ºèƒ½ä½“ä¸èƒ½è§‚å¯Ÿåˆ°ç¯å¢ƒçš„æ‰€æœ‰å†…éƒ¨çŠ¶æ€ã€‚æ¯”å¦‚ç©å›´æ£‹æ—¶ç”¨ state ï¼Œç©æ‰‘å…‹ç‰Œæ—¶ç”¨ observation ï¼ˆå› ä¸ºä½ çœ‹ä¸åˆ°åˆ«äººæ‰‹ä¸­çš„ç‰Œï¼‰ã€‚</p></blockquote><p>äº¤äº’çš„æµç¨‹ï¼š</p><ol><li>æ™ºèƒ½ä½“ä»ç¯å¢ƒè§‚æµ‹åˆ°çŠ¶æ€ $s_t$ ã€‚</li><li>æ™ºèƒ½ä½“æ ¹æ®è·å–åˆ°çš„çŠ¶æ€ $s_t$ å†³å®šä¸‹ä¸€æ­¥é‡‡å–åŠ¨ä½œ $a_t$ ã€‚</li><li>ç¯å¢ƒæ‰§è¡ŒåŠ¨ä½œ $a_t$ åè½¬ç§»åˆ°æ–°çš„çŠ¶æ€ $s_{t+1}$ ï¼Œå¹¶ç»™å‡ºæ™ºèƒ½ä½“æ‰§è¡ŒåŠ¨ä½œè·å¾—çš„å¥–åŠ± $r_t$ ã€‚</li><li>å›åˆ°ç¬¬1æ­¥ã€‚</li></ol><blockquote><p>ç¬¬3æ­¥ä¸­è·å¾—çš„å¥–åŠ± $r_t$ ï¼Œä¸€äº›èµ„æ–™ä¸­ä¹Ÿè®°ä¸º $r_{t+1}$ ã€‚æ¯”å¦‚ï¼š<a href="https://www.youtube.com/watch?v=lfHX2hHRMVQ&amp;list=PLqYmG7hTraZDM-OYHWgPebj2MfCFzFObQ&amp;index=2&amp;ab_channel=DeepMind">RL Course by David Silver - Lecture 2: Markov Decision Process</a> ã€‚</p></blockquote><h2 id="äº”ã€å›æŠ¥ï¼ˆReturnï¼‰"><a href="#äº”ã€å›æŠ¥ï¼ˆReturnï¼‰" class="headerlink" title="äº”ã€å›æŠ¥ï¼ˆReturnï¼‰"></a>äº”ã€å›æŠ¥ï¼ˆReturnï¼‰</h2><p>å¼ºåŒ–å­¦ä¹ çš„ç›®çš„æ˜¯è®©æ™ºèƒ½ä½“ä¸ç¯å¢ƒäº¤äº’æ—¶è·å¾—çš„å¥–åŠ±å°½å¯èƒ½çš„å¤šã€‚</p><p>æ™ºèƒ½ä½“ä» $t$ æ—¶åˆ»å¼€å§‹åˆ°æ¸¸æˆç»“æŸè·å¾—çš„æ‰€æœ‰å¥–åŠ± <strong>å›æŠ¥ï¼ˆReturnï¼ŒCumulative Future Rewardï¼‰</strong> ä¸ºï¼š</p><script type="math/tex; mode=display">G_t = R_t + R_{t+1} + R_{t+2} + R_{t+3} + \cdots</script><p>è€ƒè™‘åˆ°æœªæ¥çš„å¥–åŠ±ä¸å¦‚ç°åœ¨çš„å¥–åŠ±æœ‰ä»·å€¼ï¼Œæˆ‘ä»¬ç»™æœªæ¥çš„å¥–åŠ±åŠ ä¸€ä¸ªæŠ˜æ‰£ç³»æ•° $\gamma$ ï¼Œä¸” $\gamma \in [0, 1]$ ã€‚</p><p>æ‰€ä»¥æ™ºèƒ½ä½“ä» $t$ æ—¶åˆ»å¼€å§‹åˆ°æ¸¸æˆç»“æŸè·å¾—çš„æ‰€æœ‰å¥–åŠ± <strong>æŠ˜æ‰£å›æŠ¥ï¼ˆDiscounted Returnï¼ŒCumulative Discounted Future Rewardï¼‰</strong> ä¸ºï¼š</p><script type="math/tex; mode=display">G_t = R_t + \gamma \cdot R_{t+1} + \gamma^2 \cdot R_{t+2} + \gamma^3 \cdot R_{t+3} + \cdots</script><p>æ ¹æ®<a href="https://kibazen.cn/ma-er-ke-fu-he-bei-er-man-gong-shi-yi-ji-sheng-cheng-mo-shi/">é©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹</a>æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒæŠ˜æ‰£å›æŠ¥ä¹Ÿæ˜¯ä¸€ä¸ªéšæœºå˜é‡ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ol><li>æ™ºèƒ½ä½“é‡‡å–çš„åŠ¨ä½œæ˜¯ä¸€ä¸ªéšæœºå˜é‡ï¼š<script type="math/tex; mode=display">\mathbb{P}[A=a | S=s] = \pi(a|s)</script></li><li>ç¯å¢ƒçŠ¶æ€çš„è½¬ç§»ä¹Ÿæ˜¯éšæœºçš„ï¼š<script type="math/tex; mode=display">\mathbb{P}[S\prime = s\prime | S = s, A=a] = p(s\prime | s, a)</script></li></ol><p>è€Œå¯¹äºæœªæ¥çš„ä»»æ„æ—¶åˆ» $i \ge t$ ï¼Œå¥–åŠ± $R_i$ éƒ½ä¾èµ– $S_i$ å’Œ $A_i$ ã€‚</p><blockquote><p>æ¯”å¦‚åœ¨é©¬é‡Œå¥¥æ¸¸æˆä¸­ï¼Œå¦‚æœé©¬é‡Œå¥¥å¤´ä¸Šæœ‰ä¸€ä¸ªé‡‘å¸ï¼Œè¿™ä¸ªæ—¶å€™å‘ä¸Šè·³å°±èƒ½è·å¾—é‡‘å¸å¥–åŠ±ï¼Œä½†æ˜¯å¦‚æœè¿™æ—¶ä¸å‘ä¸Šè·³æˆ–è€…å‘ä¸Šè·³æ—¶å¤´ä¸Šæ²¡æœ‰é‡‘å¸éƒ½ä¸èƒ½è·å¾—é‡‘å¸å¥–åŠ±ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œå¯¹æŸä¸€ä¸ªæ—¶åˆ» $t$ çš„çŠ¶æ€ $s_t$ æ¥è¯´ï¼ŒæŠ˜æ‰£å¥–åŠ± $G_t$ ä¾èµ–äºæœªæ¥æ‰€æœ‰çš„éšæœºåŠ¨ä½œ $A_t, A_{t+1}, A_{t+2}, \cdots$ å’ŒéšæœºçŠ¶æ€ $S_{t+1}, S_{t+2}, \cdots$ ã€‚</p><p>æŠ˜æ‰£å¥–åŠ± $G_t$ å®šä¹‰äº†æœªæ¥è·å–å¥–åŠ±çš„æ€»å’Œï¼Œæœºå™¨å­¦ä¹ çš„ç›®çš„å°±æ˜¯æ§åˆ¶ agent è®© $G_t$ çš„å€¼è¶Šå¤§è¶Šå¥½ã€‚</p><h2 id="å…­ã€åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆAction-Value-Functionï¼‰"><a href="#å…­ã€åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆAction-Value-Functionï¼‰" class="headerlink" title="å…­ã€åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆAction-Value Functionï¼‰"></a>å…­ã€åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆAction-Value Functionï¼‰</h2><p>ç”±äº $G_t$ æ˜¯éšæœºå˜é‡ï¼Œåœ¨ $t$ æ—¶åˆ»å¹¶ä¸èƒ½è®¡ç®—å‡º $G_t$ çš„å€¼ã€‚ä½†æ˜¯ä¸ºäº†ä¾¿äºè¯„ä¼° $t$ æ—¶åˆ»çš„å½¢åŠ¿ï¼Œæ¶ˆé™¤ $G_t$ ä¸­çš„éšæœºæ€§ï¼Œå¯ä»¥å¯¹ $G_t$ æ±‚æœŸæœ›ï¼Œå°†éšæœºæ€§éƒ½ç”¨ç§¯åˆ†ç§¯æ‰ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå®æ•°ã€‚å³ï¼š</p><script type="math/tex; mode=display">Q_{\pi}(s_t,a_t) = \mathbb{E}[G_t | S_t=s_t, A_t=a_t]</script><p>æ±‚æœŸæœ›å¾—åˆ°çš„å‡½æ•° $Q_{\pi}(s_t,a_t)$ è¢«ç§°ä¸ºåŠ¨ä½œä»·å€¼å‡½æ•°ã€‚</p><p>æŠŠ $G_t$ å½“åšæœªæ¥æ‰€æœ‰åŠ¨ä½œ $A$ å’Œæ‰€æœ‰çŠ¶æ€ $S$ çš„å‡½æ•°ï¼Œé™¤äº† $a_t$ å’Œ $s_t$ ï¼Œå…¶ä½™çš„éƒ½ç”¨ç§¯åˆ†ç§¯æ‰ã€‚è¢«ç§¯åˆ†ç§¯æ‰çš„å˜é‡åŒ…æ‹¬ $A_{t+1}, A_{t+2}, \cdots$ å’Œ $S_{t+1}, S_{t+2}, \cdots$ã€‚</p><ol><li>åŠ¨ä½œçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š<script type="math/tex; mode=display">\mathbb{P}[A=a | S=s] = \pi(a|s)</script></li><li>çŠ¶æ€è½¬ç§»çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š<script type="math/tex; mode=display">\mathbb{P}[S\prime = s\prime | S = s, A=a] = p(s\prime | s, a)</script></li></ol><p>å‡½æ•° $Q_{\pi}(s_t,a_t)$ å’Œå½“å‰çš„çŠ¶æ€ $s_t$ å’ŒåŠ¨ä½œ $a_t$ æœ‰å…³ã€‚ $a_t$ å’Œ $s_t$ å½“ä½œè¢«è§‚æµ‹åˆ°çš„å€¼æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯éšæœºå˜é‡ã€‚å‡½æ•° $Q_{\pi}(s_t,a_t)$ è¿˜æœ‰ç­–ç•¥ $\pi$ æœ‰å…³ï¼Œå› ä¸ºç§¯åˆ†æ—¶ä¼šç”¨åˆ°ç­–ç•¥ $\pi$ ã€‚</p><p>åŠ¨ä½œä»·å€¼å‡½æ•°çš„æ„ä¹‰åœ¨äºå¯ä»¥è¯„ä¼°ç­–ç•¥ $\pi$ åœ¨çŠ¶æ€ $s_t$ æ—¶é‡‡å–åŠ¨ä½œ $a_t$ çš„æœŸæœ›å›æŠ¥ã€‚å³ï¼Œç­–ç•¥ $\pi$ å¤„åœ¨çŠ¶æ€ $s_t$ æ—¶ï¼ŒåŠ¨ä½œä»·å€¼å‡½æ•° $Q_{\pi}(s_t,a_t)$ å¯ä»¥ç»™åŠ¨ä½œ $a_t$ æ‰“åˆ†ï¼Œç”¨æ¥åˆ¤æ–­æ‰§è¡ŒåŠ¨ä½œ $a$ æ˜¯å¦æ˜æ™ºã€‚</p><blockquote><p>å°±ç›¸å½“äºä½ åœ¨æ‰“ç‰Œæ—¶æœ‰ä¸€ä¸ªå…ˆçŸ¥å¯ä»¥å‘Šè¯‰ä½ è¿™æ¬¡ï¼ˆä»…ä¸€æ¬¡ï¼‰å‡ºæ¯ç§ç‰Œåä½ èµ¢é’±çš„æœŸæœ›ã€‚</p></blockquote><h2 id="ä¸ƒã€æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆOptimal-Action-Value-Functionï¼‰"><a href="#ä¸ƒã€æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆOptimal-Action-Value-Functionï¼‰" class="headerlink" title="ä¸ƒã€æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆOptimal Action-Value Functionï¼‰"></a>ä¸ƒã€æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆOptimal Action-Value Functionï¼‰</h2><p>å¯¹å‡½æ•° $Q_{\pi}(s_t,a_t)$ åšå…³äºç­–ç•¥ $\pi$ çš„æœ€å¤§åŒ–æ“ä½œï¼Œå°±å¯ä»¥å¾—åˆ°æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ï¼š</p><script type="math/tex; mode=display">Q_*(s_t,a_t) = \max_{\pi} Q_{\pi}(s_t,a_t)</script><blockquote><p><script type="math/tex">Q_*(s_t,a_t)</script> æ˜¯ <script type="math/tex">Q_{\pi_*}(s_t,a_t)</script> çš„ç®€å†™ã€‚</p></blockquote><p>æœ€å¤§åŒ–æ“ä½œå°±æ˜¯é€‰å–æ— æ•°ç§ç­–ç•¥ä¸­ï¼Œè®© $Q_{\pi}(s_t,a_t)$ çš„å€¼æœ€å¤§çš„é‚£ä¸ªç­–ç•¥ $\pi_*$ ã€‚æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ä¸ç­–ç•¥ $\pi$ æ— å…³ï¼Œå› ä¸º $\pi$ å·²ç»è¢«æœ€å¤§åŒ–æ“ä½œæ¶ˆé™¤äº†ã€‚</p><p>æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°çš„æ„ä¹‰åœ¨äºå¯ä»¥è¯„ä¼°åœ¨çŠ¶æ€ $s_t$ æ—¶é‡‡å–åŠ¨ä½œ $a_t$ åæœ€å¤§èƒ½è·å¾—çš„æœŸæœ›å›æŠ¥ã€‚</p><blockquote><p>å°±ç›¸å½“äºåœ¨æ‰“ç‰Œæ—¶æœ‰ä¸€æŠŠç‰Œè®©ä¸–ç•Œä¸Šç‰ŒæŠ€æœ€å¥½çš„äººæ¥ç©æ—¶å‡ºæ¯ç§ç‰Œåèµ¢é’±çš„æœŸæœ›ã€‚</p></blockquote><h2 id="å…«ã€çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆState-Value-Functionï¼‰"><a href="#å…«ã€çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆState-Value-Functionï¼‰" class="headerlink" title="å…«ã€çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆState-Value Functionï¼‰"></a>å…«ã€çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆState-Value Functionï¼‰</h2><p>çŠ¶æ€ä»·å€¼å‡½æ•°æ˜¯åŠ¨ä½œä»·å€¼å‡½æ•°å…³äºåŠ¨ä½œçš„æœŸæœ›ã€‚</p><p>å°†åŠ¨ä½œ $A$ è§†ä¸ºéšæœºå˜é‡ï¼Œç„¶åå¯¹åŠ¨ä½œä»·å€¼å‡½æ•° $Q_{\pi}(s_t,A)$ å…³äºåŠ¨ä½œ $A$ æ±‚æœŸæœ›å°±å¯ä»¥å¾—åˆ°çŠ¶æ€ä»·å€¼å‡½æ•°ï¼š</p><script type="math/tex; mode=display">V_{\pi}(s_t) = \mathbb{E}_{A \sim \pi(\cdot | s_t)} [Q_{\pi}(s_t,A)]</script><p>çŠ¶æ€ä»·å€¼å‡½æ•° $V_{\pi}(s_t)$ åªä¸ç­–ç•¥ $\pi$ å’ŒçŠ¶æ€ $s_t$ æœ‰å…³ã€‚</p><p>çŠ¶æ€ä»·å€¼å‡½æ•°å¯ä»¥åæ˜ ç­–ç•¥ $\pi$ å¤„äºçŠ¶æ€ $s_t$ æ—¶çš„ä¼˜åŠ£åŠ¿ã€‚</p><blockquote><p>æ¯”å¦‚ä¸‹å›´æ£‹æ—¶ï¼ŒçŠ¶æ€ä»·å€¼å‡½æ•°å¯ä»¥åæ˜ å‡ºå½“å‰çš„å±€é¢æ˜¯å¿«èµ¢äº†è¿˜æ˜¯å¿«è¾“äº†ç­‰ã€‚</p></blockquote><ol><li>å¦‚æœåŠ¨ä½œæ˜¯ç¦»æ•£å‹éšæœºå˜é‡ï¼Œåˆ™ï¼š<script type="math/tex; mode=display">V_{\pi}(s_t) = \mathbb{E}_A[Q_{\pi}(s_t, A)] = \sum_a \pi(a | s_t) \cdot Q_{\pi}(s_t, a)</script></li><li>å¦‚æœåŠ¨ä½œæ˜¯è¿ç»­å‹éšæœºå˜é‡ï¼Œåˆ™ï¼š<script type="math/tex; mode=display">V_{\pi}(s_t) = \mathbb{E}_A[Q_{\pi}(s_t, A)] = \int \pi(a | s_t) \cdot Q_{\pi}(s_t, a) \mathrm{d}x</script></li></ol><p>çŠ¶æ€ä»·å€¼å‡½æ•°çš„æ„ä¹‰åœ¨äºå¯ä»¥è¯„ä¼°ç­–ç•¥ $\pi$ å¤„åœ¨çŠ¶æ€ $s_t$ æ—¶çš„æœŸæœ›å›æŠ¥ã€‚</p><blockquote><p>å°±ç›¸å½“äºä½ åœ¨æ‰“ç‰Œæ—¶ï¼Œä½ æ‹¿äº†ä¸€æŠŠç‰Œï¼Œæœ‰ä¸€ä¸ªå…ˆçŸ¥å¯ä»¥å‘Šè¯‰ä½ ä½ ç©è¿™æŠŠç‰Œèµ¢é’±çš„æœŸæœ›ã€‚</p></blockquote><h2 id="ä¹ã€æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆOptimal-State-Value-Functionï¼‰"><a href="#ä¹ã€æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆOptimal-State-Value-Functionï¼‰" class="headerlink" title="ä¹ã€æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆOptimal State-Value Functionï¼‰"></a>ä¹ã€æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆOptimal State-Value Functionï¼‰</h2><p>å¯¹çŠ¶æ€ä»·å€¼å‡½æ•° $V_{\pi}(s_t)$ åšå…³äºç­–ç•¥ $\pi$ çš„æœ€å¤§åŒ–æ“ä½œï¼Œå°±å¯ä»¥å¾—åˆ°æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ï¼š</p><script type="math/tex; mode=display">V_*(s_t) = \max_{\pi} V_{\pi}(s_t)</script><blockquote><p><script type="math/tex">V_*(s_t)</script> æ˜¯ <script type="math/tex">V_{\pi_*}(s_t)</script> çš„ç®€å†™ã€‚</p></blockquote><p>æœ€å¤§åŒ–æ“ä½œå°±æ˜¯é€‰å–æ— æ•°ç§ç­–ç•¥ä¸­ï¼Œè®© $V_{\pi}(s_t)$ çš„å€¼æœ€å¤§çš„é‚£ä¸ªç­–ç•¥ $\pi_*$ ã€‚æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ä¸ç­–ç•¥ $\pi$ æ— å…³ï¼Œå› ä¸º $\pi$ å·²ç»è¢«æœ€å¤§åŒ–æ“ä½œæ¶ˆé™¤äº†ã€‚</p><p>æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°çš„æ„ä¹‰åœ¨äºå¯ä»¥è¯„ä¼°åœ¨çŠ¶æ€ $s_t$ æ—¶æœ€å¤§èƒ½è·å¾—çš„æœŸæœ›å›æŠ¥ã€‚</p><blockquote><p>å°±ç›¸å½“äºåœ¨æ‰“ç‰Œæ—¶æœ‰ä¸€æŠŠç‰Œè®©ä¸–ç•Œä¸Šç‰ŒæŠ€æœ€å¥½çš„äººæ¥ç©æ—¶èµ¢é’±çš„æœŸæœ›ã€‚</p></blockquote><h2 id="åã€ç”¨å¼ºåŒ–å­¦ä¹ ç©æ¸¸æˆ"><a href="#åã€ç”¨å¼ºåŒ–å­¦ä¹ ç©æ¸¸æˆ" class="headerlink" title="åã€ç”¨å¼ºåŒ–å­¦ä¹ ç©æ¸¸æˆ"></a>åã€ç”¨å¼ºåŒ–å­¦ä¹ ç©æ¸¸æˆ</h2><p>å¼ºåŒ–å­¦ä¹ çš„ç›®çš„å°±æ˜¯å­¦ä¼šå¦‚ä½•æ§åˆ¶æ™ºèƒ½ä½“ ï¼Œè®©æ™ºèƒ½ä½“åŸºäºå½“å‰çš„çŠ¶æ€ $s$ æ¥åšå‡ºç›¸åº”çš„åŠ¨ä½œ $a$ ï¼Œäº‰å–èƒ½åœ¨æœªæ¥è·å–å°½é‡å¤šçš„å¥–åŠ±ã€‚</p><p>å¼ºåŒ–å­¦ä¹ é€šå¸¸è¦å­¦ä¹ çš„æ˜¯ç­–ç•¥ $\pi(a|s)$ æˆ–è€…æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•° $Q_*(s, a)$ï¼Œå½“æœ‰äº†è¿™ä¸¤ä¸ªä¸­çš„ä¸€ä¸ªï¼Œå°±å¯ä»¥æ§åˆ¶æ™ºèƒ½ä½“è‡ªåŠ¨çš„ç©æ¸¸æˆäº†ã€‚</p><h3 id="10-1-å‡å¦‚æœ‰ä¸€ä¸ªå¥½çš„ç­–ç•¥"><a href="#10-1-å‡å¦‚æœ‰ä¸€ä¸ªå¥½çš„ç­–ç•¥" class="headerlink" title="10.1 å‡å¦‚æœ‰ä¸€ä¸ªå¥½çš„ç­–ç•¥"></a>10.1 å‡å¦‚æœ‰ä¸€ä¸ªå¥½çš„ç­–ç•¥</h3><ol><li>è¾“å…¥è§‚æµ‹åˆ°çš„çŠ¶æ€ $s_t$ ç»™ç­–ç•¥ $\pi(a|s)$ ï¼Œå®ƒä¼šè¿”å›ä¸åŒåŠ¨ä½œçš„æ¦‚ç‡ã€‚</li><li>æ ¹æ®ç­–ç•¥ $\pi(a|s)$ è¿”å›çš„è¿™äº›æ¦‚ç‡é‡‡æ ·å¾—åˆ°ä¸€ä¸ªåŠ¨ä½œ $a_t$ã€‚</li><li>è®©ç¯å¢ƒæ‰§è¡ŒåŠ¨ä½œ $a_t$ ï¼Œå¾—åˆ°æ–°çš„çŠ¶æ€ $s_{t+1}$å’Œå¥–åŠ± $r_t$ã€‚</li><li>å›åˆ°ç¬¬1æ­¥ã€‚</li></ol><blockquote><p>å¥½çš„ç­–ç•¥ç›¸å½“äºä¸€ä¸ªç‰ŒæŠ€å¥½çš„äººï¼Œç‰ŒæŠ€å¥½çš„äººèµ¢é’±çš„æœŸæœ›æ€»æ˜¯é«˜ã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥è®­ç»ƒå‡ºä¸€ä¸ªå¥½çš„ç­–ç•¥å°±å¯ä»¥äº†ã€‚</p><p>è¿™ç§ç›´æ¥è®­ç»ƒç­–ç•¥çš„æ–¹å¼å°±æ˜¯å¼ºåŒ–å­¦ä¹ ä¸­çš„ <strong>åŸºäºç­–ç•¥çš„å­¦ä¹ ï¼ˆPolicy Based Learningï¼‰</strong> ã€‚</p><h3 id="10-2-å‡å¦‚æœ‰æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°"><a href="#10-2-å‡å¦‚æœ‰æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°" class="headerlink" title="10.2 å‡å¦‚æœ‰æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°"></a>10.2 å‡å¦‚æœ‰æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°</h3><ol><li>æ ¹æ®è§‚æµ‹åˆ°çš„çŠ¶æ€ $s_t$ å’Œæœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•° $Q_*(s_t,a_t)$ è®¡ç®—å‡ºèƒ½å¤Ÿè·å¾—æœ€å¤§æœŸæœ›å¥–åŠ±çš„åŠ¨ä½œ<script type="math/tex; mode=display">a_t = \underset{a \in A}{\operatorname{argmax}} \; Q_*(s_t,a)</script></li><li>è®©ç¯å¢ƒæ‰§è¡ŒåŠ¨ä½œ $a_t$ ï¼Œå¾—åˆ°æ–°çš„çŠ¶æ€ $s_{t+1}$ å’Œå¥–åŠ± $r_t$ã€‚</li><li>å›åˆ°ç¬¬1æ­¥ã€‚</li></ol><blockquote><p>æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•° $Q_*(s_t,a_t)$ ç›¸å½“äºä¸€ä¸ªå…ˆçŸ¥ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä»¬å‡ºæ¯ç§ç‰Œèµ¢é’±çš„æœŸæœ›ï¼Œåªè¦æˆ‘ä»¬æ¯æ¬¡éƒ½å‡ºèµ¢é’±æœŸæœ›æœ€å¤§çš„ç‰Œï¼Œé‚£ä¹ˆæœ€åèµ¢é’±çš„æœŸæœ›å°±ä¼šæœ€é«˜ã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è®­ç»ƒå‡ºä¸€ä¸ªå…ˆçŸ¥ï¼Œå³æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ã€‚</p><p>è¿™ç§è®­ç»ƒæœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°çš„æ–¹å¼å°±æ˜¯å¼ºåŒ–å­¦ä¹ ä¸­çš„ <strong>åŸºäºä»·å€¼çš„å­¦ä¹ ï¼ˆValue Based Learningï¼‰</strong> ã€‚</p><h2 id="åä¸€ã€ç†µ"><a href="#åä¸€ã€ç†µ" class="headerlink" title="åä¸€ã€ç†µ"></a>åä¸€ã€ç†µ</h2><h3 id="11-1-è‡ªä¿¡æ¯"><a href="#11-1-è‡ªä¿¡æ¯" class="headerlink" title="11.1 è‡ªä¿¡æ¯"></a>11.1 è‡ªä¿¡æ¯</h3><p><a href="https://zh.wikipedia.org/wiki/%E8%87%AA%E4%BF%A1%E6%81%AF">è‡ªä¿¡æ¯ï¼ˆself-informationï¼‰</a> è¡¨ç¤ºä¸€ä¸ªéšæœºäº‹ä»¶æ‰€åŒ…å«çš„ä¿¡æ¯é‡ã€‚</p><blockquote><p>ä¸€ä¸ªéšæœºäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡è¶Šé«˜ï¼Œå…¶è‡ªä¿¡æ¯è¶Šä½ã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶å¿…ç„¶å‘ç”Ÿï¼Œå…¶è‡ªä¿¡æ¯ä¸º 0ã€‚</p></blockquote><p>å¯¹éšæœºå˜é‡ $X$ ï¼Œå…¶æ¦‚ç‡åˆ†å¸ƒä¸º $P(x)$ ï¼Œå½“ $X = x$ æ—¶ï¼Œè‡ªä¿¡æ¯ $I(x)$ å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">I(x) = - log P(x)</script><h3 id="11-2-ä¿¡æ¯ç†µ"><a href="#11-2-ä¿¡æ¯ç†µ" class="headerlink" title="11.2 ä¿¡æ¯ç†µ"></a>11.2 ä¿¡æ¯ç†µ</h3><p>å¯¹äºåˆ†å¸ƒä¸º $P(x)$ çš„éšæœºå˜é‡ $X$ ï¼Œå…¶ç†µï¼ˆentropyï¼‰ï¼ˆ<strong>è‡ªä¿¡æ¯çš„æœŸæœ›</strong>ï¼‰å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">H(P) = E_X [I(x)] = E_X[- log P(x)] = - \sum_x P(x) log P(x)</script><p>ä¿¡æ¯è®ºçš„åŸºæœ¬å®šç†ä¹‹ä¸€æŒ‡å‡ºï¼Œä¸ºäº†å¯¹ä»åˆ†å¸ƒ $P$ ä¸­éšæœºæŠ½å–çš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œè‡³å°‘éœ€è¦ $H[P]$ â€œçº³ç‰¹ï¼ˆnatï¼‰â€å¯¹å…¶è¿›è¡Œç¼–ç ã€‚â€œçº³ç‰¹â€ç›¸å½“äºä½ï¼Œå½“æ—¶å¯¹æ•°åº•ä¸º $e$ è€Œä¸æ˜¯ 2ï¼Œã€‚å› æ­¤ï¼Œä¸€ä¸ªçº³ç‰¹æ˜¯ $\frac{1}{log(2)} \approx 1.44$ ä½ã€‚</p><p>ä¿¡æ¯ç†µè¡¨è¾¾éšæœºå˜é‡æ‰€éœ€çš„å¹³å‡ä¿¡æ¯é‡ã€‚å³ <strong>ä»ä¸äº†è§£åˆ°äº†è§£ä¸€ä»¶äº‹æ‰€éœ€è¦çš„æœ€å°ä¿¡æ¯é‡ã€‚</strong></p><h3 id="11-3-äº¤å‰ç†µ"><a href="#11-3-äº¤å‰ç†µ" class="headerlink" title="11.3 äº¤å‰ç†µ"></a>11.3 äº¤å‰ç†µ</h3><p>å¯¹äºåˆ†å¸ƒä¸º $P(x)$ çš„éšæœºå˜é‡ï¼Œç†µ $H(P)$ è¡¨ç¤ºå…¶æœ€ä¼˜ç¼–ç é•¿åº¦ã€‚äº¤å‰ç†µæ˜¯æŒ‰ç…§æ¦‚ç‡åˆ†å¸ƒ $Q$ çš„æœ€ä¼˜ç¼–ç å¯¹çœŸå®åˆ†å¸ƒ $P$ çš„ä¿¡æ¯è¿›è¡Œç¼–ç çš„é•¿åº¦ï¼ˆç”¨ $Q$ è¡¨ç¤º $P$ï¼‰ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">H(P,Q) = E_P[- log Q(x)] = - \sum_x P(x) log Q(x)</script><p>äº¤å‰ç†µæ˜¯ä¸€ç§åˆ†å¸ƒæè¿°å¦ä¸€ç§åˆ†å¸ƒæ‰€éœ€è¦çš„ä¿¡æ¯é‡ã€‚</p><h3 id="11-4-KL-æ•£åº¦"><a href="#11-4-KL-æ•£åº¦" class="headerlink" title="11.4 KL æ•£åº¦"></a>11.4 KL æ•£åº¦</h3><p>KL æ•£åº¦ä¹Ÿå« <strong>KL è·ç¦»</strong> æˆ–è€… <strong>ç›¸å¯¹ç†µ</strong>ï¼Œæ˜¯ç”¨æ¦‚ç‡åˆ†å¸ƒ $Q$ æ¥è¿‘ä¼¼ $P$ æ—¶æ‰€é€ æˆçš„ä¿¡æ¯æŸå¤±é‡ã€‚</p><p>KL æ•£åº¦æ˜¯æŒ‰ç…§æ¦‚ç‡åˆ†å¸ƒ $Q$ çš„æœ€ä¼˜ç¼–ç å¯¹çœŸå®åˆ†å¸ƒ $P$ çš„ä¿¡æ¯è¿›è¡Œç¼–ç ï¼Œå…¶å¹³å‡ç¼–ç é•¿åº¦ï¼ˆ<strong>äº¤å‰ç†µ</strong>ï¼‰$H(P,Q)$ å’Œ $P$ çš„æœ€ä¼˜ç¼–ç é•¿åº¦ï¼ˆ<strong>ç†µ</strong>ï¼‰ $H(P)$ ä¹‹é—´çš„å·®å¼‚ã€‚</p><p>å¯¹äºç¦»æ•£æ¦‚ç‡åˆ†å¸ƒ $P$ å’Œ $Q$ ï¼Œä» $Q$ åˆ° $P$ çš„ KL æ•£åº¦å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">KL(P,Q) = H(P,Q) - H(P) = \sum_x P(x) log \frac{P(x)}{Q(x)}</script><p>KL æ•£åº¦ æ€»æ˜¯éè´Ÿçš„ï¼Œå³ $KL(P,Q) \ge 0$ ï¼Œå¯ä»¥è¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»ã€‚åªæœ‰å½“ $Q = P$ æ—¶ï¼Œ $KL(P,Q) = 0$ ã€‚</p><script type="math/tex; mode=display">KL æ•£åº¦ = äº¤å‰ç†µ - ä¿¡æ¯ç†µ</script><h2 id="åäºŒã€æå¤§ä¼¼ç„¶ä¼°è®¡"><a href="#åäºŒã€æå¤§ä¼¼ç„¶ä¼°è®¡" class="headerlink" title="åäºŒã€æå¤§ä¼¼ç„¶ä¼°è®¡"></a>åäºŒã€æå¤§ä¼¼ç„¶ä¼°è®¡</h2><p>æå¤§ä¼¼ç„¶ä¼°è®¡ï¼Œé€šä¿—ç†è§£æ¥è¯´ï¼Œå°±æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ ·æœ¬ç»“æœä¿¡æ¯ï¼Œåæ¨æœ€å…·æœ‰å¯èƒ½ï¼ˆæœ€å¤§æ¦‚ç‡ï¼‰å¯¼è‡´è¿™äº›æ ·æœ¬ç»“æœå‡ºç°çš„æ¨¡å‹å‚æ•°å€¼ã€‚</p><h2 id="åä¸‰ã€å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#åä¸‰ã€å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="åä¸‰ã€å·ç§¯ç¥ç»ç½‘ç»œ"></a>åä¸‰ã€å·ç§¯ç¥ç»ç½‘ç»œ</h2><h3 id="13-1-å·å…¥ç¥ç»ç½‘ç»œçš„è¾“å‡ºå½¢çŠ¶"><a href="#13-1-å·å…¥ç¥ç»ç½‘ç»œçš„è¾“å‡ºå½¢çŠ¶" class="headerlink" title="13.1 å·å…¥ç¥ç»ç½‘ç»œçš„è¾“å‡ºå½¢çŠ¶"></a>13.1 å·å…¥ç¥ç»ç½‘ç»œçš„è¾“å‡ºå½¢çŠ¶</h3><p>è‹¥</p><ul><li>è¾“å…¥å½¢çŠ¶ä¸º $n_h \times n_w$</li><li>å·ç§¯æ ¸å½¢çŠ¶ä¸º $k_h\times k_w$</li><li>ä¸Šä¸‹å„å¡«å…… $p_h$ è¡Œï¼Œå·¦å³å„å¡«å…… $p_w$ åˆ—</li><li>å‚ç›´æ­¥å¹… $s_h$ ï¼Œæ°´å¹³æ­¥å¹… $s_w$</li></ul><p>åˆ™è¾“å‡ºå½¢çŠ¶ä¸º</p><script type="math/tex; mode=display">\left\lfloor\frac{n_h  + 2 \times p_h - k_h}{s_h} + 1\right\rfloor \times \left\lfloor\frac{n_w  + 2 \times p_w - k_w}{s_w} + 1\right\rfloor</script><blockquote><p><a href="https://pytorch.org/docs/stable/generated/torch.nn.Conv2d.html">torch.nn.Conv2d</a></p></blockquote><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=vmkRMvhCW5c&amp;list=PLvOO0btloRnsiqM72G4Uid0UWljikENlU&amp;ab_channel=ShusenWang">Deep Reinforcement Learning</a></p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/AIHUBEI/article/details/104720246">è‡ªä¿¡æ¯ã€ç†µã€è”åˆç†µã€æ¡ä»¶ç†µã€äº’ä¿¡æ¯ã€äº¤å‰ç†µã€KLæ•£åº¦</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšæœºå˜é‡ </tag>
            
            <tag> æ¦‚ç‡å¯†åº¦å‡½æ•° </tag>
            
            <tag> å¼ºåŒ–å­¦ä¹ æ¨¡å‹ </tag>
            
            <tag> åŠ¨ä½œä»·å€¼å‡½æ•° </tag>
            
            <tag> çŠ¶æ€ä»·å€¼å‡½æ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é©¬å°”å¯å¤«å’Œè´å°”æ›¼å…¬å¼ä»¥åŠç”Ÿæˆæ¨¡å¼</title>
      <link href="ma-er-ke-fu-he-bei-er-man-gong-shi-yi-ji-sheng-cheng-mo-shi/"/>
      <url>ma-er-ke-fu-he-bei-er-man-gong-shi-yi-ji-sheng-cheng-mo-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€é©¬å°”å¯å¤«"><a href="#ä¸€ã€é©¬å°”å¯å¤«" class="headerlink" title="ä¸€ã€é©¬å°”å¯å¤«"></a>ä¸€ã€é©¬å°”å¯å¤«</h2><p>ç¯å¢ƒçš„çŠ¶æ€å¿…é¡»æ˜¯å…¨éƒ¨èƒ½å¤Ÿè·å–çš„ï¼ˆfully observableï¼‰ï¼Œå³ç¯å¢ƒçš„ <strong>observation</strong> å°±æ˜¯ <strong>state</strong>ã€‚</p><h3 id="1-é©¬å°”å¯å¤«æ€§ï¼ˆMarkov-Propertyï¼‰"><a href="#1-é©¬å°”å¯å¤«æ€§ï¼ˆMarkov-Propertyï¼‰" class="headerlink" title="1. é©¬å°”å¯å¤«æ€§ï¼ˆMarkov Propertyï¼‰"></a>1. é©¬å°”å¯å¤«æ€§ï¼ˆMarkov Propertyï¼‰</h3><p>ç¯å¢ƒçš„ä¸‹ä¸€ä¸ªçŠ¶æ€åªç”±å½“å‰çš„çš„çŠ¶æ€å†³å®šï¼Œä¸è¿‡å»æ— å…³ã€‚</p><script type="math/tex; mode=display">\mathbb{P}[S_{t+1}|S_t] = \mathbb{P}[S_{t+1} | S_1, \ldots, S_t]</script><p>æ¯”å¦‚ä¸‹æ£‹ï¼Œåªç”¨å…³å¿ƒå½“å‰çš„å±€é¢ï¼Œä¸ç”¨ç®¡è¿‡å»æ“ä½œã€‚</p><h3 id="2-çŠ¶æ€è½¬ç§»çŸ©é˜µï¼ˆState-Transition-matrixï¼‰"><a href="#2-çŠ¶æ€è½¬ç§»çŸ©é˜µï¼ˆState-Transition-matrixï¼‰" class="headerlink" title="2. çŠ¶æ€è½¬ç§»çŸ©é˜µï¼ˆState Transition matrixï¼‰"></a>2. çŠ¶æ€è½¬ç§»çŸ©é˜µï¼ˆState Transition matrixï¼‰</h3><p>ç¯å¢ƒä»ä¸€ä¸ªçŠ¶æ€è½¬åŒ–æˆå¦ä¸€ä¸ªçŠ¶æ€çš„æ¦‚ç‡ç»„æˆçš„çŸ©é˜µã€‚</p><script type="math/tex; mode=display">P_{ss\prime} = \mathbb{P}[S_{t+1}=s\prime | S_t=s] \tag{2}</script><p><strong>å…¬å¼2</strong> è¡¨ç¤ºé©¬å°”å¯å¤«çŠ¶æ€ $s$ è½¬ç§»åˆ°å…¶åç»§çŠ¶æ€ $s\prime$ çš„æ¦‚ç‡ä¸º $P_{ss\prime}$ï¼Œè€ŒçŠ¶æ€è½¬ç§»çŸ©é˜µåˆ™è¡¨ç¤ºå¯¹äºæ‰€æœ‰çŠ¶æ€è½¬ç§»åˆ°å…¶æ‰€æœ‰åç»§çŠ¶æ€çš„æ¦‚ç‡ï¼Œå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">P =\left[\begin{matrix}P_{11} & \cdots & P_{1n} \\\vdots & \ddots & \vdots \\P_{n1} & \cdots & P_{nn} \\\end{matrix}\right]</script><blockquote><p>$P$ ä¸­ä»»æ„è¡Œçš„å€¼çš„å’Œä¸º1ã€‚</p></blockquote><h3 id="3-é©¬å°”å¯å¤«è¿‡ç¨‹ï¼ˆMarkov-Process-MPï¼‰"><a href="#3-é©¬å°”å¯å¤«è¿‡ç¨‹ï¼ˆMarkov-Process-MPï¼‰" class="headerlink" title="3. é©¬å°”å¯å¤«è¿‡ç¨‹ï¼ˆMarkov Process, MPï¼‰"></a>3. é©¬å°”å¯å¤«è¿‡ç¨‹ï¼ˆMarkov Process, MPï¼‰</h3><p>è‹¥ç¯å¢ƒçŠ¶æ€å˜åŒ–çš„è¿‡ç¨‹æ»¡è¶³é©¬å°”å¯å¤«æ€§ï¼Œåˆ™ç§°ä¸ºé©¬å°”å¯å¤«è¿‡ç¨‹ã€‚é©¬å°”å¯å¤«è¿‡ç¨‹ï¼ˆæˆ–è€…é©¬å°”å¯å¤«é“¾ï¼‰ç”±ä¸€ä¸ªäºŒå…ƒç»„ $\lt S, P \gt$ å®šä¹‰ã€‚å…¶ä¸­ï¼š</p><ul><li>$S$ è¡¨ç¤ºç¯å¢ƒæ‰€æœ‰å¯èƒ½çŠ¶æ€çš„æœ‰é™é›†åˆ</li><li>$P$ è¡¨ç¤ºè¿™äº›çŠ¶æ€ä¹‹é—´è½¬ç§»æ¦‚ç‡çš„çŸ©é˜µ <script type="math/tex">P_{ss\prime} = \mathbb{P}[S_{t+1}=s\prime | S_t=s]</script></li></ul><h3 id="4-é©¬å°”å¯å¤«é“¾ï¼ˆMarkov-Chainï¼‰"><a href="#4-é©¬å°”å¯å¤«é“¾ï¼ˆMarkov-Chainï¼‰" class="headerlink" title="4. é©¬å°”å¯å¤«é“¾ï¼ˆMarkov Chainï¼‰"></a>4. é©¬å°”å¯å¤«é“¾ï¼ˆMarkov Chainï¼‰</h3><p>é©¬å°”å¯å¤«è¿‡ç¨‹ä¸‹äº§ç”Ÿçš„æœ‰é™çŠ¶æ€çš„é›†åˆã€‚</p><h3 id="5-é©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹ï¼ˆMarkov-Reward-Process-MRPï¼‰"><a href="#5-é©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹ï¼ˆMarkov-Reward-Process-MRPï¼‰" class="headerlink" title="5. é©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹ï¼ˆMarkov Reward Process, MRPï¼‰"></a>5. é©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹ï¼ˆMarkov Reward Process, MRPï¼‰</h3><p>åŒ…å« <strong>ä»·å€¼ï¼ˆvaluesï¼‰</strong> çš„é©¬å°”å¯å¤«é“¾å°±æ˜¯é©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹ï¼Œç”±ä¸€ä¸ªå››å…ƒç»„ $\lt S, P, R, \gamma \gt$ å®šä¹‰ã€‚å…¶ä¸­ï¼š</p><ul><li>$S$ è¡¨ç¤ºç¯å¢ƒæ‰€æœ‰å¯èƒ½çŠ¶æ€çš„æœ‰é™é›†åˆ</li><li>$P$ è¡¨ç¤ºè¿™äº›çŠ¶æ€ä¹‹é—´è½¬ç§»æ¦‚ç‡çš„çŸ©é˜µ <script type="math/tex">P_{ss\prime} = \mathbb{P}[S_{t+1}=s\prime | S_t=s]</script></li><li><strong>$R$ è¡¨ç¤ºå›æŠ¥è®¡ç®—å‡½æ•° <script type="math/tex">R_s = \mathbb{E}[R_{t+1} | S_t=s]</script></strong></li><li><strong>$\gamma$ è¡°å‡ç³»æ•°ï¼ˆDiscount factorï¼‰ï¼Œ$\gamma \in [0, 1]$</strong></li></ul><h4 id="5-1-å›æŠ¥ï¼ˆReturnï¼‰"><a href="#5-1-å›æŠ¥ï¼ˆReturnï¼‰" class="headerlink" title="5.1 å›æŠ¥ï¼ˆReturnï¼‰"></a>5.1 å›æŠ¥ï¼ˆReturnï¼‰</h4><p>ä»æ—¶åˆ» $t$ å¼€å§‹æ‰€æœ‰çš„æŠ˜æ‰£å›æŠ¥ä¹‹å’Œ</p><script type="math/tex; mode=display">G_t = R_{t+1} + \gamma R_{t+2} + \cdots = \sum_{k=0} ^{\infty} \gamma^k R_{t+k+1}</script><h4 id="5-2-è¡°å‡ç³»æ•°ï¼ˆDiscount-factorï¼‰"><a href="#5-2-è¡°å‡ç³»æ•°ï¼ˆDiscount-factorï¼‰" class="headerlink" title="5.2 è¡°å‡ç³»æ•°ï¼ˆDiscount factorï¼‰"></a>5.2 è¡°å‡ç³»æ•°ï¼ˆDiscount factorï¼‰</h4><p>å­˜åœ¨çš„åŸå› ï¼š</p><ul><li>æ•°å­¦è¡¨è¾¾æ›´æ–¹ä¾¿</li><li>é¿å…é™·å…¥å¾ªç¯</li><li>é•¿è¿œçš„åˆ©ç›Šå…·æœ‰ä¸ç¡®å®šæ€§</li></ul><p>æ„ä¹‰ï¼š</p><ul><li>å€¼è¶Šæ¥è¿‘0è¡¨ç¤ºè¶Šçœ‹é‡å½“å‰çš„åˆ©ç›Š</li><li>å€¼è¶Šæ¥è¿‘1è¡¨ç¤ºè¶Šçœ‹é‡é•¿è¿œçš„åˆ©ç›Š</li></ul><h3 id="5-3-çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆValue-Functionï¼‰"><a href="#5-3-çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆValue-Functionï¼‰" class="headerlink" title="5.3 çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆValue Functionï¼‰"></a>5.3 çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆValue Functionï¼‰</h3><p>çŠ¶æ€ä»·å€¼å‡½æ•°ç”¨äºè®¡ç®—ä»çŠ¶æ€ $s$ å¼€å§‹çš„æœŸæœ›å›æŠ¥</p><script type="math/tex; mode=display">v(s) = \mathbb{E}[G_t | S_t=s]</script><h3 id="5-4-è´å°”æ›¼æ–¹ç¨‹ï¼ˆBellman-Equationï¼‰"><a href="#5-4-è´å°”æ›¼æ–¹ç¨‹ï¼ˆBellman-Equationï¼‰" class="headerlink" title="5.4 è´å°”æ›¼æ–¹ç¨‹ï¼ˆBellman Equationï¼‰"></a>5.4 è´å°”æ›¼æ–¹ç¨‹ï¼ˆBellman Equationï¼‰</h3><script type="math/tex; mode=display">\begin{aligned}v(s)& = \mathbb{E}[G_t | S_t = s] \\& = \mathbb{E}[R_{t+1} + \gamma R_{t+2} + {\gamma}^2 R_{t+3} + \cdots | S_t = s] \\& = \mathbb{E}[R_{t+1} + \gamma(R_{t+2} + \gamma R_{t+3} + \cdots) | S_t = s] \\& = \mathbb{E}[R_{t+1} + \gamma G_{t+1} | S_t = s] \\& (æ³¨æ„ v(S_{t+1}) æ˜¯å¤§å†™çš„ S_{t+1} æ˜¯å› ä¸º S_t = s çš„ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯éšæœºçš„) \\& = \mathbb{E}[R_{t+1} + \gamma v(S_{t+1}) | S_t = s] \\& (åˆ†åˆ«å¯¹ R_{t+1} å’Œ v(S_{t+1}) æ±‚æœŸæœ›ï¼Œå’Œçš„æœŸæœ›ç­‰äºæœŸæœ›çš„å’Œ) \\& = \mathbb{E}[R_{t+1} | S_t = s] + \gamma \mathbb{E}[v(S_{t+1}) | S_t = s] \\& (å¦‚æœå·²çŸ¥çŠ¶æ€è½¬ç§»çŸ©é˜µ P ï¼Œåˆ™å¯ä»¥å°†ä¸Šå¼å±•å¼€) \\& = R_s + \gamma \sum_{s\prime \in S} P_{ss\prime} v(s\prime) \\\end{aligned}</script><p>å³ï¼š</p><script type="math/tex; mode=display">v(s) = R_s + \gamma \sum_{s\prime \in S} P_{ss\prime} v(s\prime)</script><p>å¯¹åº”çš„çŸ©é˜µå½¢å¼çš„æ–¹ç¨‹ä¸ºï¼š</p><script type="math/tex; mode=display">v = R + \gamma Pv</script><script type="math/tex; mode=display">\left[\begin{matrix}v(1) \\\vdots \\v(n) \\\end{matrix}\right] = \left[\begin{matrix}R_{1} \\\vdots \\R_{n} \\\end{matrix}\right] + \gamma \left[\begin{matrix}P_{11} & \cdots & P_{1n} \\\vdots & \ddots & \vdots \\P_{n1} & \cdots & P_{nn} \\\end{matrix}\right] \left[\begin{matrix}v(1) \\\vdots \\v(n) \\\end{matrix}\right]</script><blockquote><p>å…¶ä¸­ $R_{t+1}$ æ˜¯ç«‹å³å›æŠ¥ï¼Œ $\gamma v(S_{t+1})$ æ˜¯åç»­çŠ¶æ€çš„æŠ˜æ‰£å€¼å‡½æ•°</p></blockquote><h3 id="5-5-è´å°”æ›¼æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•"><a href="#5-5-è´å°”æ›¼æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•" class="headerlink" title="5.5 è´å°”æ›¼æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•"></a>5.5 è´å°”æ›¼æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•</h3><ol><li><p>ç›´æ¥æ±‚è§£</p><script type="math/tex; mode=display"> \begin{aligned} v &= R + \gamma Pv \\ (I - \gamma P)v &= R \\ v &= (I - \gamma P)^{-1} R \\ \end{aligned}</script><p> é—®é¢˜ï¼šå¤æ‚åº¦å¤ªé«˜ $O(n^3)$ï¼Œnä¸ºçŠ¶æ€çš„æ•°é‡</p></li><li><p>è¿­ä»£æ±‚è§£</p><ul><li>åŠ¨æ€è§„åˆ’ï¼ˆDynamic programmingï¼‰</li><li>è’™åœ°å¡ç½—è¯„ä¼°ï¼ˆMonte-Carlo evaluationï¼‰</li><li>æ—¶åºå·®åˆ†å­¦ä¹ ï¼ˆTemporal-Difference learningï¼‰</li></ul></li></ol><h3 id="6-é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMarkov-Decision-Process-MDPï¼‰"><a href="#6-é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMarkov-Decision-Process-MDPï¼‰" class="headerlink" title="6. é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMarkov Decision Process, MDPï¼‰"></a>6. é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMarkov Decision Process, MDPï¼‰</h3><p>åŒ…å« <strong>å†³ç­–ï¼ˆdecisionsï¼‰</strong> çš„é©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹å°±æ˜¯é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ï¼Œç”±ä¸€ä¸ªäº”å…ƒç»„ $\lt S, A, P, R, \gamma \gt$ å®šä¹‰ã€‚å…¶ä¸­ï¼š</p><ul><li>$S$ è¡¨ç¤ºç¯å¢ƒæ‰€æœ‰å¯èƒ½çŠ¶æ€çš„æœ‰é™é›†åˆ</li><li><strong>$A$ è¡¨ç¤ºæœ‰é™çš„åŠ¨ä½œé›†åˆ</strong></li><li><strong>$P$ è¡¨ç¤ºè¿™äº›çŠ¶æ€ä¹‹é—´è½¬ç§»æ¦‚ç‡çš„çŸ©é˜µ <script type="math/tex">P_{ss\prime}^a = \mathbb{P}[S_{t+1}=s\prime | S_t=s, A_t=a]</script></strong></li><li><strong>$R$ è¡¨ç¤ºå›æŠ¥è®¡ç®—å‡½æ•° <script type="math/tex">R_s^a = \mathbb{E}[R_{t+1} | S_t=s, A_t=a]</script></strong></li><li>$\gamma$ è¡°å‡ç³»æ•°ï¼ˆDiscount factorï¼‰ï¼Œ$\gamma \in [0, 1]$</li></ul><h4 id="6-1-ç­–ç•¥ï¼ˆPolicyï¼‰"><a href="#6-1-ç­–ç•¥ï¼ˆPolicyï¼‰" class="headerlink" title="6.1 ç­–ç•¥ï¼ˆPolicyï¼‰"></a>6.1 ç­–ç•¥ï¼ˆPolicyï¼‰</h4><p>ç­–ç•¥ $\pi$ æ˜¯çŠ¶æ€ $s$ æ—¶å¯èƒ½æ‰§è¡Œçš„åŠ¨ä½œ $a$ çš„æ¦‚ç‡åˆ†å¸ƒ</p><script type="math/tex; mode=display">\pi (a|s) = \mathbb{P}[A_t=a | S_t=s]</script><p>å½“ç»™å®šé©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ $\lt S,A,P,R,\gamma \gt$ å’Œç­–ç•¥ $\pi$ æ—¶ï¼š</p><ul><li>çŠ¶æ€åºåˆ— $S_1, S_2, \ldots$ å°±æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«è¿‡ç¨‹ $\lt S,P^{\pi} \gt$</li><li>çŠ¶æ€å›æŠ¥åºåˆ— $S_1, R_2, S_2, \ldots$ å°±æ˜¯ä¸€ä¸ªé©¬å°”ç§‘å¤«å›æŠ¥è¿‡ç¨‹ $\lt S, P^{\pi}, R^{\pi}, \gamma \gt$</li></ul><p>å…¶ä¸­ï¼š</p><script type="math/tex; mode=display">P_{s,s\prime}^{\pi} = \sum_{a \in A}\pi(a|s) P_{s,s\prime}^a</script><script type="math/tex; mode=display">R_s^{\pi} = \sum_{a \in A}\pi(a|s) R_s^a</script><h4 id="6-2-åŸºäºç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°"><a href="#6-2-åŸºäºç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°" class="headerlink" title="6.2 åŸºäºç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°"></a>6.2 åŸºäºç­–ç•¥çš„çŠ¶æ€ä»·å€¼å‡½æ•°</h4><p>é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ä¸­ï¼ŒåŸºäºç­–ç•¥ $\pi$ çš„ <strong>çŠ¶æ€</strong> ä»·å€¼å‡½æ•°ç”¨äºè®¡ç®—ä»çŠ¶æ€ $s$ å¼€å§‹ï¼Œéµå¾ªç­–ç•¥ $\pi$ æ—¶çš„æœŸæœ›å›æŠ¥</p><script type="math/tex; mode=display">v_{\pi}(s) = \mathbb{E}[G_t | S_t=s]</script><h4 id="6-3-åŸºäºç­–ç•¥çš„åŠ¨ä½œä»·å€¼å‡½æ•°"><a href="#6-3-åŸºäºç­–ç•¥çš„åŠ¨ä½œä»·å€¼å‡½æ•°" class="headerlink" title="6.3 åŸºäºç­–ç•¥çš„åŠ¨ä½œä»·å€¼å‡½æ•°"></a>6.3 åŸºäºç­–ç•¥çš„åŠ¨ä½œä»·å€¼å‡½æ•°</h4><p>é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ä¸­ï¼ŒåŸºäºç­–ç•¥ $\pi$ çš„ <strong>åŠ¨ä½œ</strong> ä»·å€¼å‡½æ•°ç”¨äºè®¡ç®—ä»çŠ¶æ€ $s$ å¼€å§‹ï¼Œå…ˆé‡‡å–åŠ¨ä½œ $a$ï¼Œå†éµå¾ªç­–ç•¥ $\pi$ æ—¶çš„æœŸæœ›å›æŠ¥</p><script type="math/tex; mode=display">q_{\pi}(s,a) = \mathbb{E}_{\pi}[G_t | S_t=s, A_t=a]</script><h4 id="6-4-è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼ˆBellman-Expectation-Equationï¼‰"><a href="#6-4-è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼ˆBellman-Expectation-Equationï¼‰" class="headerlink" title="6.4 è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼ˆBellman Expectation Equationï¼‰"></a>6.4 è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼ˆBellman Expectation Equationï¼‰</h4><ol><li><p>åŸºäºç­–ç•¥çš„ <strong>çŠ¶æ€</strong> ä»·å€¼å‡½æ•°çš„è´å°”æ›¼æ–¹ç¨‹å¯ä»¥åˆ†è§£ä¸º <strong>ç«‹å³å›æŠ¥</strong> ä¸ <strong>åç»­çŠ¶æ€çš„æŠ˜æ‰£å›æŠ¥</strong> çš„å’Œ</p><script type="math/tex; mode=display">v_{\pi}(s) = \mathbb{E}[R_{t+1} + \gamma v_{\pi}(S_{t+1}) | S_t=s]</script><p> å¯¹åº”çš„çŸ©é˜µå½¢å¼çš„æ–¹ç¨‹ä¸ºï¼š</p><script type="math/tex; mode=display">v_{\pi} = R^{\pi} + \gamma P^{\pi} v_{\pi}</script><script type="math/tex; mode=display">v_{\pi} = (I - \gamma P^{\pi})^{-1} R^{\pi}</script><p> åŒæ—¶ï¼ŒçŠ¶æ€ $s$ çš„ä»·å€¼ä¹Ÿå¯ä»¥é€šè¿‡è®¡ç®—åœ¨éµå¾ªç­–ç•¥ $\pi$ æ—¶é‡‡å–æ‰€æœ‰å¯èƒ½ <strong>åŠ¨ä½œçš„ä»·å€¼</strong> ä¸å¯¹åº” <strong>åŠ¨ä½œå‘ç”Ÿçš„æ¦‚ç‡</strong> ä¹˜ç§¯çš„å’Œæ¥è·å¾—ï¼Œå³ï¼š</p><script type="math/tex; mode=display">v_{\pi}(s) = \sum_{a \in A}\pi(a|s) q_{\pi}(s,a) \tag{6.4.1}</script></li><li><p>åŸºäºç­–ç•¥çš„ <strong>åŠ¨ä½œ</strong> ä»·å€¼å‡½æ•°çš„è´å°”æ›¼æ–¹ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„</p><script type="math/tex; mode=display">q_{\pi}(s,a) = \mathbb{E}[R_{t+1} + \gamma q_{\pi}(S_{t+1},A_{t+1}) | S_t=s, A_t=a]</script><p> ç±»ä¼¼çš„ï¼ŒçŠ¶æ€ $s$ ä¸‹æ‰§è¡ŒåŠ¨ä½œ $a$ çš„ä»·å€¼ä¹Ÿå¯ä»¥åˆ†è§£ä¸º <strong>ç¦»å¼€çŠ¶æ€ $s$ çš„ç«‹å³å›æŠ¥</strong> ä¸ <strong>æ‰€æœ‰å¯èƒ½ä¼šè¿›å…¥çŠ¶æ€çš„ä»·å€¼ä¸å¯¹åº”è¿›å…¥æ¦‚ç‡</strong> çš„ä¹˜ç§¯çš„å’Œï¼Œå³ï¼š</p><script type="math/tex; mode=display">q_{\pi}(s,a) = R_s^a + \gamma \sum_{s\prime \in S} P_{ss\prime}^a v_{\pi}(s\prime) \tag{6.4.2}</script></li><li><p>ç»„åˆä¸Šé¢çš„ <strong>æ–¹ç¨‹6.4.1</strong> å’Œ <strong>æ–¹ç¨‹6.4.2</strong> ï¼Œå¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">v_{\pi}(s) = \sum_{a \in A}\pi(a|s) \left( R_s^a + \gamma \sum_{s\prime \in S} P_{ss\prime}^a v_{\pi}(s\prime) \right)</script><script type="math/tex; mode=display">q_{\pi}(s,a) = R_s^a + \gamma \sum_{s\prime \in S} P_{ss\prime}^a \sum_{a\prime \in A}\pi(a\prime|s\prime) q_{\pi}(s\prime,a\prime)</script></li></ol><h4 id="6-5-æœ€ä¼˜ä»·å€¼å‡½æ•°ï¼ˆOptimal-Value-Functionï¼‰"><a href="#6-5-æœ€ä¼˜ä»·å€¼å‡½æ•°ï¼ˆOptimal-Value-Functionï¼‰" class="headerlink" title="6.5 æœ€ä¼˜ä»·å€¼å‡½æ•°ï¼ˆOptimal Value Functionï¼‰"></a>6.5 æœ€ä¼˜ä»·å€¼å‡½æ•°ï¼ˆOptimal Value Functionï¼‰</h4><ol><li><p><strong>æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ï¼ˆOptimal State-Value Functionï¼‰</strong> å°±æ˜¯ä»æ‰€æœ‰å¯èƒ½çš„ç­–ç•¥ä¸­ï¼Œ<strong>é€‰å–</strong> äº§ç”Ÿæœ€å¤§çŠ¶æ€ä»·å€¼å‡½æ•°å€¼çš„ <strong>ç­–ç•¥çš„å‡½æ•°</strong></p><script type="math/tex; mode=display">v_*(s) = \max_{\pi} v_{\pi}(s) \tag{6.5.1}</script><blockquote><p><script type="math/tex">v_*(s)</script> æ˜¯ <script type="math/tex">v_{\pi_*}(s)</script> çš„ç®€å†™ï¼Œéƒ½å¯ä»¥è¡¨ç¤ºæœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°ã€‚</p></blockquote></li><li><p><strong>æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ï¼ˆOptimal Action-Value Functionï¼‰</strong> å°±æ˜¯ä»æ‰€æœ‰å¯èƒ½çš„ç­–ç•¥ä¸­ï¼Œ<strong>é€‰å–</strong> äº§ç”Ÿæœ€å¤§åŠ¨ä½œçŠ¶æ€ä»·å€¼å‡½æ•°å€¼çš„ <strong>ç­–ç•¥çš„å‡½æ•°</strong></p><script type="math/tex; mode=display">q_*(s,a) = \max_{\pi} q_{\pi}(s,a) \tag{6.5.2}</script><blockquote><p><script type="math/tex">q_*(s,a)</script> æ˜¯ <script type="math/tex">q_{\pi_*}(s,a)</script> çš„ç®€å†™ï¼Œéƒ½å¯ä»¥è¡¨ç¤ºæœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°ã€‚</p></blockquote></li><li><p>æœ€ä¼˜ä»·å€¼å‡½æ•°èƒ½å¤Ÿåœ¨é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ä¸­æ‰¾åˆ°æœ€å¥½çš„ç­–ç•¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æ‰¾åˆ°äº†æœ€ä¼˜ä»·å€¼å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è§£å†³é©¬å°”ç§‘å¤«å†³ç­–é—®é¢˜</p></li></ol><h4 id="6-6-æœ€ä¼˜ç­–ç•¥ï¼ˆOptimal-Policyï¼‰"><a href="#6-6-æœ€ä¼˜ç­–ç•¥ï¼ˆOptimal-Policyï¼‰" class="headerlink" title="6.6 æœ€ä¼˜ç­–ç•¥ï¼ˆOptimal Policyï¼‰"></a>6.6 æœ€ä¼˜ç­–ç•¥ï¼ˆOptimal Policyï¼‰</h4><ol><li><p>å¯¹äºä»»æ„å¯èƒ½çš„çŠ¶æ€ï¼Œå¦‚æœéµå¾ªä¸€ä¸ªç­–ç•¥çš„ä»·å€¼æ€»æ˜¯ä¸å·®äºéµå¾ªå¦ä¸€ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªç­–ç•¥å°±è¦ä¼˜äºåä¸€ä¸ªç­–ç•¥</p><script type="math/tex; mode=display">\pi \ge \pi\prime \quad if \; v_{\pi}(s) \ge v_{\pi\prime}(s), \forall{s}</script></li><li><p>å®šç†ï¼šå¯¹ä»»æ„é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ï¼Œæœ‰ï¼š</p></li></ol><ul><li><p>å­˜åœ¨ä¸€ä¸ªæœ€ä¼˜ç­–ç•¥ ${\pi}_*$ ä¸å·®äºå…¶ä»–ä»»ä½•ç­–ç•¥</p><script type="math/tex; mode=display">{\pi}_* \ge \pi, \forall{\pi}</script></li><li><p>æ‰€æœ‰çš„æœ€ä¼˜ç­–ç•¥æœ‰ç›¸åŒçš„æœ€ä¼˜çŠ¶æ€ä»·å€¼å‡½æ•°</p><script type="math/tex; mode=display">v_{\pi_*}(s) = v_*(s) \tag{6.6.2a}</script></li><li><p>æ‰€æœ‰çš„æœ€ä¼˜ç­–ç•¥å…·æœ‰ç›¸åŒçš„æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•°</p><script type="math/tex; mode=display">q_{\pi_*}(s,a) = q_*(s,a) \tag{6.6.2b}</script></li></ul><h4 id="6-7-å¯»æ‰¾æœ€ä¼˜ç­–ç•¥"><a href="#6-7-å¯»æ‰¾æœ€ä¼˜ç­–ç•¥" class="headerlink" title="6.7 å¯»æ‰¾æœ€ä¼˜ç­–ç•¥"></a>6.7 å¯»æ‰¾æœ€ä¼˜ç­–ç•¥</h4><p>å¯ä»¥é€šè¿‡æœ€å¤§åŒ–æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•° $q_*(s,a)$ æ¥æ‰¾åˆ°æœ€ä¼˜ç­–ç•¥</p><script type="math/tex; mode=display">\pi_*(a|s) =\begin{cases}    1 & if \; a = \underset{a \in A}{\operatorname{argmax}} \; q_*(s,a) \\    0 & otherwise \\\end{cases}\tag{6.7}</script><ul><li>å¯¹ä»»æ„é©¬å°”ç§‘å¤«å†³ç­–è¿‡ç¨‹ï¼Œæ€»å­˜åœ¨ä¸€ä¸ªç¡®å®šæ€§çš„æœ€ä¼˜ç­–ç•¥</li><li>å¦‚æœæˆ‘ä»¬çŸ¥é“æœ€ä¼˜åŠ¨ä½œä»·å€¼å‡½æ•° $q_*(s,a)$ ï¼Œåˆ™è¡¨æ˜æˆ‘ä»¬æ‰¾åˆ°äº†æœ€ä¼˜ç­–ç•¥</li></ul><h4 id="6-8-è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ï¼ˆBellman-Optimality-Equationï¼‰"><a href="#6-8-è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ï¼ˆBellman-Optimality-Equationï¼‰" class="headerlink" title="6.8 è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ï¼ˆBellman Optimality Equationï¼‰"></a>6.8 è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ï¼ˆBellman Optimality Equationï¼‰</h4><ol><li><p>ä¸€ä¸ªçŠ¶æ€çš„æœ€ä¼˜ä»·å€¼ç­‰äºä»è¯¥çŠ¶æ€å‡ºå‘é‡‡å–çš„æ‰€æœ‰åŠ¨ä½œäº§ç”Ÿçš„åŠ¨ä½œä»·å€¼ä¸­æœ€å¤§çš„é‚£ä¸ªåŠ¨ä½œä»·å€¼</p><script type="math/tex; mode=display"> \begin{aligned} v_*(s) & = v_{\pi_*}(s) & \text{å…¬å¼6.6.2a} \\ & = \sum_{a \in A}\pi_*(a|s) q_{\pi_*}(s,a) & \text{å…¬å¼6.4.1} \\ & = \max_a q_{\pi_*}(s,a) & \text{å…¬å¼6.7} \\ & = \max_a q_*(s,a) & \text{å…¬å¼6.6.2b} \\ \end{aligned}</script><p> å³</p><script type="math/tex; mode=display">v_*(s) = \max_a q_*(s,a) \tag{6.8.1}</script></li><li><p>ä¸ <strong>æ–¹ç¨‹6.4.2</strong> ç±»ä¼¼ï¼ŒçŠ¶æ€ $s$ ä¸‹æ‰§è¡ŒåŠ¨ä½œ $a$ çš„æœ€ä¼˜ä»·å€¼ä¹Ÿå¯ä»¥åˆ†è§£ä¸º <strong>ç¦»å¼€çŠ¶æ€ $s$ çš„ç«‹å³å›æŠ¥</strong> ä¸ <strong>æ‰€æœ‰å¯èƒ½ä¼šè¿›å…¥çŠ¶æ€çš„æœ€ä¼˜çŠ¶æ€ä»·å€¼ä¸å¯¹åº”è¿›å…¥æ¦‚ç‡</strong> çš„ä¹˜ç§¯çš„å’Œï¼Œå³ï¼š</p><script type="math/tex; mode=display">q_*(s,a) = R_s^a + \gamma \sum_{s\prime \in S} P_{ss\prime}^a v_*(s\prime) \tag{6.8.2}</script></li><li><p>ç»„åˆä¸Šé¢çš„ <strong>æ–¹ç¨‹6.8.1</strong> å’Œ <strong>æ–¹ç¨‹6.8.2</strong> ï¼Œå¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">q_*(s,a) = R_s^a + \gamma \sum_{s\prime \in S} P_{ss\prime}^a  \max_{a\prime} q_*(s\prime,a\prime)</script><script type="math/tex; mode=display">v_*(s) = \max_a \left(R_s^a + \gamma \sum_{s\prime \in S} P_{ss\prime}^a v_*(s\prime)\right)</script></li></ol><h4 id="6-9-è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•"><a href="#6-9-è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•" class="headerlink" title="6.9 è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•"></a>6.9 è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„æ±‚è§£æ–¹æ³•</h4><ol><li>è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹æ˜¯éçº¿æ€§çš„</li><li>è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹é€šå¸¸æ²¡æœ‰å›ºå®šçš„è§£å†³æ–¹æ¡ˆ</li><li>å¯ä»¥é€šè¿‡ä¸€äº›è¿­ä»£çš„æ–¹æ³•æ¥è§£å†³ï¼š<ul><li>ä»·å€¼è¿­ä»£ï¼ˆValue Iterationï¼‰</li><li>ç­–ç•¥è¿­ä»£ï¼ˆPolicy Iterationï¼‰</li><li>Q-learning</li><li>Sarsa</li></ul></li></ol><h3 id="6-10-è´å°”æ›¼æœŸæœ›æ–¹ç¨‹å’Œè´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„å…³ç³»"><a href="#6-10-è´å°”æ›¼æœŸæœ›æ–¹ç¨‹å’Œè´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„å…³ç³»" class="headerlink" title="6.10 è´å°”æ›¼æœŸæœ›æ–¹ç¨‹å’Œè´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„å…³ç³»"></a>6.10 è´å°”æ›¼æœŸæœ›æ–¹ç¨‹å’Œè´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹çš„å…³ç³»</h3><ol><li>è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ä¸­ï¼Œç­–ç•¥æ˜¯å·²çŸ¥çš„ï¼Œæ±‚è§£è´å°”æ›¼æœŸæœ›æ–¹ç¨‹å°±æ˜¯åœ¨è¯„ä»·ç­–ç•¥çš„ä¼˜åŠ£</li><li>è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ä¸­ï¼Œç­–ç•¥æ˜¯æœªçŸ¥çš„ï¼Œæ±‚è§£è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹å°±æ˜¯åœ¨æ‰¾æœ€ä¼˜çš„ç­–ç•¥</li></ol><hr><h2 id="äºŒã€ç”Ÿæˆæ¨¡å¼ï¼ˆGenerating-Patternsï¼‰"><a href="#äºŒã€ç”Ÿæˆæ¨¡å¼ï¼ˆGenerating-Patternsï¼‰" class="headerlink" title="äºŒã€ç”Ÿæˆæ¨¡å¼ï¼ˆGenerating Patternsï¼‰"></a>äºŒã€ç”Ÿæˆæ¨¡å¼ï¼ˆGenerating Patternsï¼‰</h2><h3 id="1-ç¡®å®šæ€§æ¨¡å¼ï¼ˆDeterministic-Patternsï¼‰"><a href="#1-ç¡®å®šæ€§æ¨¡å¼ï¼ˆDeterministic-Patternsï¼‰" class="headerlink" title="1. ç¡®å®šæ€§æ¨¡å¼ï¼ˆDeterministic Patternsï¼‰"></a>1. ç¡®å®šæ€§æ¨¡å¼ï¼ˆDeterministic Patternsï¼‰</h3><p>ç¯å¢ƒçš„ä¸‹ä¸€ä¸ªçŠ¶æ€å¯ä»¥æ ¹æ®ä¸Šä¸€ä¸ªçŠ¶æ€è®¡ç®—å‡ºæ¥ã€‚</p><p>æ¯”å¦‚ï¼šè¿‡å®Œç”Ÿæ—¥ä½ å°±é•¿äº†ä¸€å²ã€‚</p><h3 id="2-éç¡®å®šæ€§æ¨¡å¼ï¼ˆNon-deterministic-patternsï¼‰"><a href="#2-éç¡®å®šæ€§æ¨¡å¼ï¼ˆNon-deterministic-patternsï¼‰" class="headerlink" title="2. éç¡®å®šæ€§æ¨¡å¼ï¼ˆNon-deterministic patternsï¼‰"></a>2. éç¡®å®šæ€§æ¨¡å¼ï¼ˆNon-deterministic patternsï¼‰</h3><p>ç¯å¢ƒçš„ä¸‹ä¸€ä¸ªçŠ¶æ€ä¸èƒ½æ ¹æ®ä¸Šä¸€ä¸ªçŠ¶æ€è®¡ç®—å‡ºæ¥ã€‚</p><p>æ¯”å¦‚ï¼šæ·éª°å­ã€‚</p><p>é©¬å°”å¯å¤«å‡è®¾ï¼šç¯å¢ƒå½“å‰çš„çŠ¶æ€ä»…ä»…ä¾èµ–äºä¹‹å‰çš„å‡ ä¸ªçŠ¶æ€ã€‚<br>$n$ é˜¶é©¬å°”å¯å¤«æ¨¡å‹ï¼šç¯å¢ƒçš„ä¸‹ä¸€ä¸ªçŠ¶æ€åªç”±è¿‡å»çš„ $n$ ä¸ªçŠ¶æ€å†³å®šï¼Œä¸å…¶ä»–çŠ¶æ€æ— å…³ã€‚</p><h3 id="3-éšè—æ¨¡å¼ï¼ˆHidden-Patternsï¼‰"><a href="#3-éšè—æ¨¡å¼ï¼ˆHidden-Patternsï¼‰" class="headerlink" title="3. éšè—æ¨¡å¼ï¼ˆHidden Patternsï¼‰"></a>3. éšè—æ¨¡å¼ï¼ˆHidden Patternsï¼‰</h3><p>éšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHidden Markov Model, HMMï¼‰</p><hr><blockquote><p>å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=lfHX2hHRMVQ&amp;list=PLqYmG7hTraZDM-OYHWgPebj2MfCFzFObQ&amp;index=2&amp;ab_channel=DeepMind">RL Course by David Silver - Lecture 2: Markov Decision Process</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é©¬å°”å¯å¤« </tag>
            
            <tag> è´å°”æ›¼å…¬å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³Ubuntuæ’­æ”¾å£°éŸ³å¡é¡¿å’Œçˆ†éŸ³</title>
      <link href="jie-jue-ubuntu-bo-fang-sheng-yin-qia-dun-he-bao-yin/"/>
      <url>jie-jue-ubuntu-bo-fang-sheng-yin-qia-dun-he-bao-yin/</url>
      
        <content type="html"><![CDATA[<h2 id="æ’­æ”¾å£°éŸ³å¡é¡¿"><a href="#æ’­æ”¾å£°éŸ³å¡é¡¿" class="headerlink" title="æ’­æ”¾å£°éŸ³å¡é¡¿"></a>æ’­æ”¾å£°éŸ³å¡é¡¿</h2><p>å®‰è£…å®ŒUbuntu18.04åï¼Œç”¨ç½‘æ˜“äº‘éŸ³ä¹å¬æ­Œæ—¶ï¼Œå£°éŸ³æ€»æ˜¯æ¯éš”å‡ ç§’å¡é¡¿ä¸€ä¸‹ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹è§£å†³æ–¹æ³•ã€‚</p><p>ç”¨å‘½ä»¤<code>sudo lspci -v | grep -A7 Audio</code>æŸ¥çœ‹ç³»ç»Ÿçš„ä½¿ç”¨çš„å£°å¡è®¾å¤‡æ˜¯<strong>Intel Corporation 200 Series PCH HD Audio</strong>ï¼Œä½¿ç”¨çš„é©±åŠ¨æ—¶<strong>snd_hda_intel</strong>ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~ <span class="token function">sudo</span> lspci -v <span class="token operator">|</span> <span class="token function">grep</span> -A7 Audio00:1f.3 Audio device: Intel Corporation <span class="token number">200</span> Series PCH HD Audio    Subsystem: Gigabyte Technology Co., Ltd <span class="token number">200</span> Series PCH HD Audio    Flags: bus master, fast devsel, latency <span class="token number">32</span>, IRQ <span class="token number">125</span>    Memory at f7140000 <span class="token punctuation">(</span><span class="token number">64</span>-bit, non-prefetchable<span class="token punctuation">)</span> <span class="token punctuation">[</span>size<span class="token operator">=</span>16K<span class="token punctuation">]</span>    Memory at f7120000 <span class="token punctuation">(</span><span class="token number">64</span>-bit, non-prefetchable<span class="token punctuation">)</span> <span class="token punctuation">[</span>size<span class="token operator">=</span>64K<span class="token punctuation">]</span>    Capabilities: <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span> Power Management version <span class="token number">3</span>    Capabilities: <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span> MSI: Enable+ <span class="token assign-left variable">Count</span><span class="token operator">=</span><span class="token number">1</span>/1 Maskable- 64bit+    Kernel driver <span class="token keyword">in</span> use: snd_hda_intel    Kernel modules: snd_hda_intel--01:00.1 Audio device: NVIDIA Corporation GP107GL High Definition Audio Controller <span class="token punctuation">(</span>rev a1<span class="token punctuation">)</span>    Subsystem: NVIDIA Corporation GP107GL High Definition Audio Controller    Flags: bus master, fast devsel, latency <span class="token number">0</span>, IRQ <span class="token number">17</span>    Memory at f7080000 <span class="token punctuation">(</span><span class="token number">32</span>-bit, non-prefetchable<span class="token punctuation">)</span> <span class="token punctuation">[</span>size<span class="token operator">=</span>16K<span class="token punctuation">]</span>    Capabilities: <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span> Power Management version <span class="token number">3</span>    Capabilities: <span class="token punctuation">[</span><span class="token number">68</span><span class="token punctuation">]</span> MSI: Enable- <span class="token assign-left variable">Count</span><span class="token operator">=</span><span class="token number">1</span>/1 Maskable- 64bit+    Capabilities: <span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">]</span> Express Endpoint, MSI 00    Capabilities: <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> Advanced Error Reporting    Kernel driver <span class="token keyword">in</span> use: snd_hda_intel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ’­æ”¾å£°éŸ³çˆ†éŸ³"><a href="#æ’­æ”¾å£°éŸ³çˆ†éŸ³" class="headerlink" title="æ’­æ”¾å£°éŸ³çˆ†éŸ³"></a>æ’­æ”¾å£°éŸ³çˆ†éŸ³</h2><p>æœ‰æ—¶ç”µè„‘é‡å¯åï¼Œå£°éŸ³å°±ä¸€ç›´æ¯éš”å‡ ç§’çˆ†éŸ³ä¸€ä¸‹ï¼Œé‡å¯ä¹Ÿæ²¡ç”¨ã€‚å¯ä»¥æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œé‡å¯ä¸€ä¸‹<strong>pulseaudio</strong>ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pulseaudio --kill <span class="token punctuation">\</span>  <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -r ~/.config/pulse/* <span class="token punctuation">\</span>  <span class="token operator">&amp;&amp;</span> pulseaudio --start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠEffective Modern C++ã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="effective-modern-c-du-shu-bi-ji/"/>
      <url>effective-modern-c-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å‹åˆ«æ¨å¯¼"><a href="#ä¸€ã€å‹åˆ«æ¨å¯¼" class="headerlink" title="ä¸€ã€å‹åˆ«æ¨å¯¼"></a>ä¸€ã€å‹åˆ«æ¨å¯¼</h2><h3 id="1-ç†è§£æ¨¡æ¿å‹åˆ«æ¨å¯¼"><a href="#1-ç†è§£æ¨¡æ¿å‹åˆ«æ¨å¯¼" class="headerlink" title="1. ç†è§£æ¨¡æ¿å‹åˆ«æ¨å¯¼"></a>1. ç†è§£æ¨¡æ¿å‹åˆ«æ¨å¯¼</h3><ol><li>åœ¨æ¨¡æ¿å‹åˆ«æ¨å¯¼è¿‡ç¨‹ä¸­ï¼Œå…·æœ‰å¼•ç”¨å‹åˆ«çš„å®å‚ä¼šè¢«å½“æˆéå¼•ç”¨å‹åˆ«æ¥å¤„ç†ã€‚æ¢è¨€ä¹‹ï¼Œå…¶å¼•ç”¨æ€§ä¼šè¢«å¿½ç•¥ã€‚</li><li>å¯¹ä¸‡èƒ½å¼•ç”¨(Universal Reference)å½¢å‚è¿›è¡Œæ¨å¯¼æ—¶ï¼Œå·¦å€¼å®å‚ä¼šè¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</li><li>å¯¹æŒ‰å€¼ä¼ é€’çš„å½¢å‚è¿›è¡Œæ¨å¯¼æ—¶ï¼Œè‹¥å®å‚å‹åˆ«ä¸­å¸¦æœ‰constæˆ–volatileé¥°è¯ï¼Œåˆ™å®ƒä»¬è¿˜æ˜¯ä¼šè¢«å½“ä½œä¸å¸¦constæˆ–volatileé¥°è¯çš„å‹åˆ«æ¥å¤„ç†ã€‚</li><li>åœ¨æ¨¡æ¿å‹åˆ«æ¨å¯¼è¿‡ç¨‹ä¸­ï¼Œæ•°ç»„æˆ–å‡½æ•°å‹åˆ«çš„å®å‚ä¼šé€€åŒ–æˆå¯¹åº”çš„æŒ‡é’ˆï¼Œé™¤éå®ƒä»¬è¢«ç”¨æ¥åˆå§‹åŒ–å¼•ç”¨ã€‚</li></ol><h3 id="2-ç†è§£autoå‹åˆ«æ¨å¯¼"><a href="#2-ç†è§£autoå‹åˆ«æ¨å¯¼" class="headerlink" title="2. ç†è§£autoå‹åˆ«æ¨å¯¼"></a>2. ç†è§£autoå‹åˆ«æ¨å¯¼</h3><ol><li>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œautoå‹åˆ«æ¨å¯¼å’Œæ¨¡æ¿å‹åˆ«æ¨å¯¼æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œä½†æ˜¯autoå‹åˆ«æ¨å¯¼ä¼šå‡å®šç”¨å¤§æ‹¬å·æ‹¬èµ·çš„åˆå§‹åŒ–è¡¨è¾¾å¼ä»£è¡¨ä¸€ä¸ªstd::initializer_listï¼Œä½†æ¨¡æ¿å‹åˆ«æ¨å¯¼å´ä¸ä¼šã€‚</li><li>åœ¨å‡½æ•°è¿”å›å€¼æˆ–lambdaå¼çš„å½¢å‚ä¸­ä½¿ç”¨autoï¼Œæ„æ€æ˜¯ä½¿ç”¨æ¨¡æ¿å‹åˆ«æ¨å¯¼è€Œéautoå‹åˆ«æ¨å¯¼ã€‚</li></ol><h3 id="3-ç†è§£decltype"><a href="#3-ç†è§£decltype" class="headerlink" title="3. ç†è§£decltype"></a>3. ç†è§£decltype</h3><ol><li>ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œdecltypeä¼šå¾—å‡ºå˜é‡æˆ–è¡¨è¾¾å¼çš„å‹åˆ«è€Œä¸ä½œä»»ä½•ä¿®æ”¹ã€‚</li><li><p>å¯¹äºå‹åˆ«ä¸ºTçš„å·¦å€¼è¡¨è¾¾å¼ï¼Œé™¤éè¯¥è¡¨è¾¾å¼ä»…æœ‰ä¸€ä¸ªåå­—ï¼Œdecltypeæ€»æ˜¯å¾—å‡ºå‹åˆ«T&amp;ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>i<span class="token punctuation">;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>     <span class="token comment">// -&gt; int</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// -&gt; int&amp;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span>    <span class="token comment">// -&gt; int&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li>C++14æ”¯æŒdecltype(auto)ï¼Œå’Œautoä¸€æ ·ï¼Œå®ƒä¼šä»å…¶åˆå§‹åŒ–è¡¨è¾¾å¼å‡ºå‘æ¥æ¨å¯¼å‹åˆ«ï¼Œä½†æ˜¯å®ƒçš„å‹åˆ«æ¨å¯¼ä½¿ç”¨çš„æ˜¯decltypeçš„è§„åˆ™ã€‚</li></ol><h3 id="4-æŒæ¡æŸ¥çœ‹å‹åˆ«æ¨å¯¼ç»“æœçš„æ–¹æ³•"><a href="#4-æŒæ¡æŸ¥çœ‹å‹åˆ«æ¨å¯¼ç»“æœçš„æ–¹æ³•" class="headerlink" title="4. æŒæ¡æŸ¥çœ‹å‹åˆ«æ¨å¯¼ç»“æœçš„æ–¹æ³•"></a>4. æŒæ¡æŸ¥çœ‹å‹åˆ«æ¨å¯¼ç»“æœçš„æ–¹æ³•</h3><ol><li>åˆ©ç”¨IDEç¼–è¾‘å™¨ã€ç¼–è¯‘å™¨é”™è¯¯æ¶ˆæ¯å’ŒBoost.TypeIndexåº“å¸¸å¸¸èƒ½å¤ŸæŸ¥çœ‹åˆ°æ¨å¯¼è€Œå¾—çš„å‹åˆ«ã€‚</li><li>æœ‰äº›å·¥å…·äº§ç”Ÿçš„ç»“æœå¯èƒ½ä¼šæ— ç”¨ï¼Œæˆ–è€…ä¸å‡†ç¡®ã€‚æ‰€ä»¥ï¼Œç†è§£C++å‹åˆ«æ¨å¯¼è§„åˆ™æ˜¯å¿…è¦çš„ã€‚</li></ol><h2 id="äºŒã€auto"><a href="#äºŒã€auto" class="headerlink" title="äºŒã€auto"></a>äºŒã€auto</h2><h3 id="5-ä¼˜å…ˆé€‰ç”¨autoï¼Œè€Œéæ˜¾ç¤ºå‹åˆ«å£°æ˜"><a href="#5-ä¼˜å…ˆé€‰ç”¨autoï¼Œè€Œéæ˜¾ç¤ºå‹åˆ«å£°æ˜" class="headerlink" title="5. ä¼˜å…ˆé€‰ç”¨autoï¼Œè€Œéæ˜¾ç¤ºå‹åˆ«å£°æ˜"></a>5. ä¼˜å…ˆé€‰ç”¨autoï¼Œè€Œéæ˜¾ç¤ºå‹åˆ«å£°æ˜</h3><ol><li>autoå˜é‡å¿…é¡»åˆå§‹åŒ–ï¼ŒåŸºæœ¬ä¸Šå¯¹ä¼šå¯¼è‡´å…¼å®¹æ€§å’Œæ•ˆç‡é—®é¢˜çš„å‹åˆ«ä¸åŒ¹é…ç°è±¡å…ç–«ï¼Œè¿˜å¯ä»¥ç®€åŒ–é‡æ„æµç¨‹ï¼Œé€šå¸¸ä¹Ÿæ¯”æ˜¾ç¤ºæŒ‡å®šå‹åˆ«è¦å°‘æ‰“ä¸€äº›å­—ã€‚</li><li>autoå‹åˆ«çš„å˜é‡éƒ½æœ‰ç€<a href="#2-ç†è§£autoå‹åˆ«æ¨å¯¼">æ¡æ¬¾2</a>å’Œ<a href="#6-å½“autoæ¨å¯¼çš„å‹åˆ«ä¸ç¬¦åˆè¦æ±‚æ—¶ï¼Œä½¿ç”¨å¸¦æ˜¾ç¤ºå‹åˆ«çš„åˆå§‹åŒ–ç‰©ä¹ æƒ¯ç”¨æ³•">æ¡æ¬¾6</a>ä¸­æ‰€æè¿°çš„æ¯›ç—…ã€‚</li></ol><h3 id="6-å½“autoæ¨å¯¼çš„å‹åˆ«ä¸ç¬¦åˆè¦æ±‚æ—¶ï¼Œä½¿ç”¨å¸¦æ˜¾ç¤ºå‹åˆ«çš„åˆå§‹åŒ–ç‰©ä¹ æƒ¯ç”¨æ³•"><a href="#6-å½“autoæ¨å¯¼çš„å‹åˆ«ä¸ç¬¦åˆè¦æ±‚æ—¶ï¼Œä½¿ç”¨å¸¦æ˜¾ç¤ºå‹åˆ«çš„åˆå§‹åŒ–ç‰©ä¹ æƒ¯ç”¨æ³•" class="headerlink" title="6. å½“autoæ¨å¯¼çš„å‹åˆ«ä¸ç¬¦åˆè¦æ±‚æ—¶ï¼Œä½¿ç”¨å¸¦æ˜¾ç¤ºå‹åˆ«çš„åˆå§‹åŒ–ç‰©ä¹ æƒ¯ç”¨æ³•"></a>6. å½“autoæ¨å¯¼çš„å‹åˆ«ä¸ç¬¦åˆè¦æ±‚æ—¶ï¼Œä½¿ç”¨å¸¦æ˜¾ç¤ºå‹åˆ«çš„åˆå§‹åŒ–ç‰©ä¹ æƒ¯ç”¨æ³•</h3><ol><li>â€œéšå½¢â€çš„ä»£ç†å‹åˆ«å¯ä»¥å¯¼è‡´autoæ ¹æ®åˆå§‹åŒ–è¡¨è¾¾å¼æ¨å¯¼å‡ºâ€œé”™è¯¯çš„â€å‹åˆ«ã€‚</li><li>å¸¦æ˜¾ç¤ºå‹åˆ«çš„åˆå§‹åŒ–ç‰©ä¹ æƒ¯ç”¨æ³•å¼ºåˆ¶autoæ¨å¯¼å‡ºä½ æƒ³è¦çš„å‹åˆ«ã€‚</li></ol><h2 id="ä¸‰ã€è½¬å‘ç°ä»£C"><a href="#ä¸‰ã€è½¬å‘ç°ä»£C" class="headerlink" title="ä¸‰ã€è½¬å‘ç°ä»£C++"></a>ä¸‰ã€è½¬å‘ç°ä»£C++</h2><h3 id="7-åœ¨åˆ›å»ºå¯¹è±¡æ—¶æ³¨æ„åŒºåˆ†-å’Œ"><a href="#7-åœ¨åˆ›å»ºå¯¹è±¡æ—¶æ³¨æ„åŒºåˆ†-å’Œ" class="headerlink" title="7. åœ¨åˆ›å»ºå¯¹è±¡æ—¶æ³¨æ„åŒºåˆ†()å’Œ{}"></a>7. åœ¨åˆ›å»ºå¯¹è±¡æ—¶æ³¨æ„åŒºåˆ†()å’Œ{}</h3><ol><li>å¤§æ‹¬å·åˆå§‹åŒ–å¯ä»¥åº”ç”¨çš„è¯­å¢ƒæœ€ä¸ºå®½æ³›ï¼Œå¯ä»¥é˜»æ­¢éšå¼çª„åŒ–å‹åˆ«è½¬æ¢ï¼Œè¿˜å¯¹æœ€ä»¤äººè‹¦æ¼ä¹‹è§£æè¯­æ³•å…ç–«ã€‚</li><li>åœ¨æ„é€ å‡½æ•°é‡è½½å†³è®®æœŸé—´ï¼Œåªè¦æœ‰ä»»ä½•å¯èƒ½ï¼Œå¤§æ‹¬å·åˆå§‹åŒ–ç‰©å°±ä¼šä¸å¸¦æœ‰std::initializer_listå‹åˆ«çš„å½¢å‚ç›¸åŒ¹é…ï¼Œå³ä½¿å…¶ä»–é‡è½½ç‰ˆæœ¬æœ‰ç€è²Œä¼¼æ›´åŠ åŒ¹é…çš„å½¢å‚è¡¨ã€‚</li><li>ä½¿ç”¨å°æ‹¬å·è¿˜æ˜¯å¤§æ‹¬å·ï¼Œä¼šé€ æˆç»“æœå¤§ç›¸å¾„åº­çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼šä½¿ç”¨ä¸¤ä¸ªå®å‚åˆ›å»ºä¸€ä¸ªstd::vector&lt;æ•°å€¼å‹åˆ«&gt;å¯¹è±¡ã€‚</li><li>åœ¨æ¨¡æ¿å†…å®¹è¿›è¡Œå¯¹è±¡åˆ›å»ºæ—¶ï¼Œåˆ°åº•åº”è¯¥ä½¿ç”¨å°æ‹¬å·è¿˜æ˜¯å¤§æ‹¬å·ä¼šæˆä¸ºä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ã€‚</li></ol><h4 id="å‡ ä¸ªå®¹æ˜“æ··æ·†çš„ä¾‹å­"><a href="#å‡ ä¸ªå®¹æ˜“æ··æ·†çš„ä¾‹å­" class="headerlink" title="å‡ ä¸ªå®¹æ˜“æ··æ·†çš„ä¾‹å­"></a>å‡ ä¸ªå®¹æ˜“æ··æ·†çš„ä¾‹å­</h4><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Widget w1<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°</span>Widget <span class="token function">w2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å£°æ˜äº†ä¸€ä¸ªåä¸ºw2çš„å‡½æ•°</span>Widget <span class="token function">w3</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è°ƒç”¨å¸¦æœ‰std::initializer_listå‹åˆ«å½¢å‚çš„æ„é€ å‡½æ•°</span>Widget w4<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// åŒä¸Š</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-ä¼˜å…ˆé€‰ç”¨nullptrï¼Œè€Œé0æˆ–NULL"><a href="#8-ä¼˜å…ˆé€‰ç”¨nullptrï¼Œè€Œé0æˆ–NULL" class="headerlink" title="8. ä¼˜å…ˆé€‰ç”¨nullptrï¼Œè€Œé0æˆ–NULL"></a>8. ä¼˜å…ˆé€‰ç”¨nullptrï¼Œè€Œé0æˆ–NULL</h3><ol><li>ç›¸å¯¹äº0æˆ–NULLï¼Œä¼˜å…ˆé€‰ç”¨nullptrã€‚</li><li>é¿å…åœ¨æ•´å‹å’ŒæŒ‡é’ˆå‹åˆ«ä¹‹é—´é‡è½½ã€‚</li></ol><h3 id="9-ä¼˜å…ˆé€‰ç”¨åˆ«åå£°æ˜ï¼Œè€Œétypedef"><a href="#9-ä¼˜å…ˆé€‰ç”¨åˆ«åå£°æ˜ï¼Œè€Œétypedef" class="headerlink" title="9. ä¼˜å…ˆé€‰ç”¨åˆ«åå£°æ˜ï¼Œè€Œétypedef"></a>9. ä¼˜å…ˆé€‰ç”¨åˆ«åå£°æ˜ï¼Œè€Œétypedef</h3><ol><li>typedefä¸æ”¯æŒæ¨¡æ¿åŒ–ï¼Œä½†åˆ«åå£°æ˜æ”¯æŒã€‚</li><li>åˆ«åæ¨¡æ¿å¯ä»¥è®©äººå…å†™â€œ::typeâ€åç¼€ï¼Œå¹¶ä¸”åœ¨æ¨¡æ¿å†…ï¼Œå¯¹äºå†…åµŒtypedefçš„å¼•ç”¨ç»å¸¸è¦æ±‚åŠ ä¸Štypenameå‰ç¼€ã€‚</li></ol><h3 id="10-ä¼˜å…ˆé€‰ç”¨é™å®šä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«ï¼Œè€Œéä¸é™ä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«"><a href="#10-ä¼˜å…ˆé€‰ç”¨é™å®šä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«ï¼Œè€Œéä¸é™ä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«" class="headerlink" title="10. ä¼˜å…ˆé€‰ç”¨é™å®šä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«ï¼Œè€Œéä¸é™ä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«"></a>10. ä¼˜å…ˆé€‰ç”¨é™å®šä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«ï¼Œè€Œéä¸é™ä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«</h3><ol><li>C++98é£æ ¼çš„æšä¸¾å‹åˆ«ï¼Œç°åœ¨ç§°ä¸ºä¸é™èŒƒå›´çš„æšä¸¾å‹åˆ«ã€‚</li><li>é™å®šä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«ä»…åœ¨æšä¸¾å‹åˆ«å†…å¯è§ã€‚å®ƒä»¬åªèƒ½é€šè¿‡å¼ºåˆ¶å‹åˆ«è½¬æ¢ä»¥è½¬æ¢è‡³å…¶ä»–å‹åˆ«ã€‚</li><li>é™åˆ¶ä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«å’Œä¸é™èŒƒå›´çš„æšä¸¾å‹åˆ«éƒ½æ”¯æŒåº•å±‚å‹åˆ«æŒ‡å®šã€‚é™åˆ¶ä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«çš„é»˜è®¤åº•å±‚å‹åˆ«æ˜¯intï¼Œè€Œä¸é™èŒƒå›´çš„æšä¸¾å‹åˆ«æ²¡æœ‰é»˜è®¤åº•å±‚å‹åˆ«ã€‚</li><li>é™åˆ¶ä½œç”¨åŸŸçš„æšä¸¾å‹åˆ«æ€»æ˜¯å¯ä»¥è¿›è¡Œå‰ç½®å£°æ˜ï¼Œè€Œä¸é™èŒƒå›´çš„æšä¸¾å‹åˆ«å´åªæœ‰åœ¨æŒ‡å®šäº†é»˜è®¤åº•å±‚å‹åˆ«çš„å‰æä¸‹æ‰å¯ä»¥è¿›è¡Œå‰ç½®å£°æ˜ã€‚</li></ol><h3 id="11-ä¼˜å…ˆé€‰ç”¨åˆ é™¤å‡½æ•°ï¼Œè€Œéprivateæœªå®šä¹‰å‡½æ•°"><a href="#11-ä¼˜å…ˆé€‰ç”¨åˆ é™¤å‡½æ•°ï¼Œè€Œéprivateæœªå®šä¹‰å‡½æ•°" class="headerlink" title="11. ä¼˜å…ˆé€‰ç”¨åˆ é™¤å‡½æ•°ï¼Œè€Œéprivateæœªå®šä¹‰å‡½æ•°"></a>11. ä¼˜å…ˆé€‰ç”¨åˆ é™¤å‡½æ•°ï¼Œè€Œéprivateæœªå®šä¹‰å‡½æ•°</h3><ol><li>ä¼˜å…ˆé€‰ç”¨åˆ é™¤å‡½æ•°ï¼Œè€Œéprivateæœªå®šä¹‰å‡½æ•°ã€‚</li><li>ä»»ä½•å‡½æ•°éƒ½å¯ä»¥åˆ é™¤ï¼ŒåŒ…æ‹¬éæˆå‘˜å‡½æ•°å’Œæ¨¡æ¿å…·ç°ã€‚</li></ol><h3 id="12-ä¸ºæ„åœ¨æ”¹å†™çš„å‡½æ•°æ·»åŠ overrideå£°æ˜"><a href="#12-ä¸ºæ„åœ¨æ”¹å†™çš„å‡½æ•°æ·»åŠ overrideå£°æ˜" class="headerlink" title="12. ä¸ºæ„åœ¨æ”¹å†™çš„å‡½æ•°æ·»åŠ overrideå£°æ˜"></a>12. ä¸ºæ„åœ¨æ”¹å†™çš„å‡½æ•°æ·»åŠ overrideå£°æ˜</h3><ol><li>ä¸ºæ„åœ¨æ”¹å†™çš„å‡½æ•°æ·»åŠ overrideå£°æ˜ã€‚</li><li>æˆå‘˜å‡½æ•°å¼•ç”¨é¥°è¯ä½¿å¾—å¯¹äºå·¦å€¼å’Œå³å€¼å¯¹è±¡ï¼ˆ*thisï¼‰çš„å¤„ç†èƒ½å¤ŸåŒºåˆ†å¼€æ¥ã€‚</li></ol><h3 id="13-ä¼˜å…ˆé€‰ç”¨const-iteratorï¼Œè€Œéiterator"><a href="#13-ä¼˜å…ˆé€‰ç”¨const-iteratorï¼Œè€Œéiterator" class="headerlink" title="13. ä¼˜å…ˆé€‰ç”¨const_iteratorï¼Œè€Œéiterator"></a>13. ä¼˜å…ˆé€‰ç”¨const_iteratorï¼Œè€Œéiterator</h3><ol><li>ä¼˜å…ˆé€‰ç”¨const_iteratorï¼Œè€Œéiteratorã€‚</li><li>åœ¨æœ€é€šç”¨çš„ä»£ç ä¸­ï¼Œä¼˜å…ˆé€‰ç”¨éæˆå‘˜å‡½æ•°ç‰ˆæœ¬çš„beginã€endå’Œrbeginç­‰ï¼Œè€Œéå…¶æˆå‘˜å‡½æ•°ç‰ˆæœ¬ã€‚</li></ol><h3 id="14-åªè¦å‡½æ•°ä¸ä¼šå‘å°„å¼‚å¸¸ï¼Œå°±ä¸ºå…¶åŠ ä¸Šnoexceptå£°æ˜"><a href="#14-åªè¦å‡½æ•°ä¸ä¼šå‘å°„å¼‚å¸¸ï¼Œå°±ä¸ºå…¶åŠ ä¸Šnoexceptå£°æ˜" class="headerlink" title="14. åªè¦å‡½æ•°ä¸ä¼šå‘å°„å¼‚å¸¸ï¼Œå°±ä¸ºå…¶åŠ ä¸Šnoexceptå£°æ˜"></a>14. åªè¦å‡½æ•°ä¸ä¼šå‘å°„å¼‚å¸¸ï¼Œå°±ä¸ºå…¶åŠ ä¸Šnoexceptå£°æ˜</h3><ol><li>noexceptå£°æ˜æ˜¯å‡½æ•°æ¥å£çš„ç»„æˆéƒ¨åˆ†ï¼Œè¿™æ„å‘³ç€è°ƒç”¨æ–¹å¯èƒ½ä¼šå¯¹å®ƒæœ‰ä¾èµ–ã€‚</li><li>ç›¸å¯¹äºä¸å¸¦noexceptå£°æ˜çš„å‡½æ•°ï¼Œå¸¦æœ‰noexceptå£°æ˜çš„å‡½æ•°æœ‰æ›´å¯¹æœºä¼šå¾—åˆ°ä¼˜åŒ–ã€‚</li><li>noexceptæ€§è´¨å¯¹äºç§»åŠ¨æ“ä½œã€swapã€å‡½æ•°é‡Šæ”¾å‡½æ•°å’Œææ„å‡½æ•°æœ€æœ‰ä»·å€¼ã€‚</li><li>å¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯å¼‚å¸¸ä¸­ç«‹çš„ï¼Œä¸å…·å¤‡noexceptæ€§è´¨ã€‚</li></ol><h4 id="å…³äºæ¡æ¬¾14çš„è¡¥å……è¯´æ˜"><a href="#å…³äºæ¡æ¬¾14çš„è¡¥å……è¯´æ˜" class="headerlink" title="å…³äºæ¡æ¬¾14çš„è¡¥å……è¯´æ˜"></a>å…³äºæ¡æ¬¾14çš„è¡¥å……è¯´æ˜</h4><ul><li><p>åœ¨å¸¦æœ‰noexceptå£°æ˜çš„å‡½æ•°ä¸­ï¼Œä¼˜åŒ–å™¨ä¸éœ€è¦åœ¨å¼‚å¸¸ä¼ å‡ºå‡½æ•°çš„å‰æä¸‹ï¼Œå°†æ‰§è¡ŒæœŸæ ˆä¿æŒåœ¨å¯å¼€è§£çŠ¶æ€ï¼›ä¹Ÿä¸éœ€è¦åœ¨å¼‚å¸¸æº¢å‡ºå‡½æ•°çš„å‰æä¸‹ï¼Œä¿è¯æ‰€æœ‰å…¶ä¸­çš„å¯¹è±¡ä»¥å…¶è¢«æ„é€ é¡ºåºçš„é€†åºå®Œæˆææ„ã€‚è€Œé‚£äº›ä»¥â€œthrow()â€å¼‚å¸¸è§„æ ¼å£°æ˜çš„å‡½æ•°å°±äº«å—ä¸åˆ°è¿™æ ·çš„ä¼˜åŒ–çµæ´»æ€§ï¼Œå’Œæ²¡æœ‰åŠ å¼‚å¸¸è§„æ ¼å£°æ˜çš„å‡½æ•°ä¸€æ ·ã€‚</p></li><li><p>åœ¨C++98ä¸­ï¼Œå…è®¸å†…å­˜é‡Šæ”¾å‡½æ•°ï¼ˆå³operator deleteæˆ–operator delete[]ï¼‰å’Œææ„å‡½æ•°å‘å°„å¼‚å¸¸ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸€ç§å·®åŠ²çš„ç¼–ç¨‹é£æ ¼ã€‚è€Œåœ¨C++11ä¸­ï¼Œè¿™ç§é£æ ¼è§„åˆ™è¢«å‡çº§æˆäº†ä¸€æ¡è¯­è¨€è§„åˆ™ã€‚<strong>é»˜è®¤åœ°ï¼Œå†…å­˜é‡Šæ”¾å‡½æ•°å’Œæ‰€æœ‰çš„ææ„å‡½æ•°ï¼ˆæ— è®ºæ˜¯ç”¨æˆ·å®šä¹‰çš„ï¼Œè¿˜æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ï¼‰éƒ½éšå¼åœ°å…·å¤‡noexceptæ€§è´¨ã€‚</strong></p></li></ul><h3 id="15-åªè¦æœ‰å¯èƒ½ä½¿ç”¨constexprï¼Œå°±ä½¿ç”¨å®ƒ"><a href="#15-åªè¦æœ‰å¯èƒ½ä½¿ç”¨constexprï¼Œå°±ä½¿ç”¨å®ƒ" class="headerlink" title="15. åªè¦æœ‰å¯èƒ½ä½¿ç”¨constexprï¼Œå°±ä½¿ç”¨å®ƒ"></a>15. åªè¦æœ‰å¯èƒ½ä½¿ç”¨constexprï¼Œå°±ä½¿ç”¨å®ƒ</h3><ol><li>constexprå¯¹è±¡éƒ½å…·å¤‡constå±æ€§ï¼Œå¹¶ç”±ç¼–è¯‘æœŸå·²çŸ¥çš„å€¼å®Œæˆåˆå§‹åŒ–ã€‚</li><li>constexprå‡½æ•°åœ¨è°ƒç”¨æ—¶è‹¥ä¼ å…¥çš„å®å‚å€¼æ˜¯ç¼–è¯‘æœŸå·²çŸ¥çš„ï¼Œåˆ™ä¼šäº§ç”Ÿå‡ºç¼–è¯‘æœŸç»“æœã€‚</li><li>æ¯”èµ·éconstexprå¯¹è±¡æˆ–constexprå‡½æ•°è€Œè¨€ï¼Œconstexprå¯¹è±¡æˆ–æ˜¯constexprå‡½æ•°å¯ä»¥ç”¨åœ¨ä¸€ä¸ªä½œç”¨åŸŸæ›´å¹¿çš„è¯­å¢ƒä¸­ã€‚</li></ol><h4 id="å…³äºconstexprå‡½æ•°çš„è¯´æ˜"><a href="#å…³äºconstexprå‡½æ•°çš„è¯´æ˜" class="headerlink" title="å…³äºconstexprå‡½æ•°çš„è¯´æ˜"></a>å…³äºconstexprå‡½æ•°çš„è¯´æ˜</h4><ul><li>constexprå‡½æ•°å¯ä»¥ç”¨åœ¨è¦æ±‚ç¼–è¯‘æœŸå¸¸é‡çš„è¯­å¢ƒä¸­ã€‚åœ¨è¿™æ ·çš„è¯­å¢ƒä¸­ï¼Œè‹¥ä½ ä¼ ç»™ä¸€ä¸ªconstexprå‡½æ•°çš„å®å‚å€¼æ˜¯åœ¨ç¼–è¯‘æœŸå·²çŸ¥çš„ï¼Œåˆ™ç»“æœä¹Ÿä¼šåœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å‡ºæ¥ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªå®å‚å€¼åœ¨ç¼–è¯‘æœŸæœªçŸ¥ï¼Œåˆ™ä½ çš„ä»£ç å°†æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</li><li>åœ¨è°ƒç”¨constexprå‡½æ•°æ—¶ï¼Œè‹¥ä¼ å…¥çš„å€¼æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåœ¨ç¼–è¯‘æœŸæœªçŸ¥ï¼Œåˆ™å®ƒçš„è¿ä½œæ–¹å¼å’Œæ™®é€šå‡½æ•°æ— å¼‚ï¼Œäº¦å³å®ƒä¹Ÿæ˜¯åœ¨è¿è¡ŒæœŸæ‰§è¡Œç»“æœçš„è®¡ç®—ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœå‡½æ•°æ‰§è¡Œçš„æ˜¯åŒæ ·çš„æ“ä½œï¼Œä»…ä»…åº”ç”¨çš„è¯­å¢ƒä¸€ä¸ªæ˜¯è¦æ±‚ç¼–è¯‘æœŸå¸¸é‡çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºæ‰€æœ‰å…¶ä»–å€¼çš„è¯ï¼Œé‚£å°±ä¸å¿…å†™ä¸¤ä¸ªå‡½æ•°ã€‚constexprå‡½æ•°å°±å¯ä»¥åŒæ—¶æ»¡è¶³æ‰€æœ‰éœ€æ±‚ã€‚</li></ul><h4 id="å…³äºconstexpråœ¨C-11å’ŒC-14ä¸­çš„ä¸åŒ"><a href="#å…³äºconstexpråœ¨C-11å’ŒC-14ä¸­çš„ä¸åŒ" class="headerlink" title="å…³äºconstexpråœ¨C++11å’ŒC++14ä¸­çš„ä¸åŒ"></a>å…³äºconstexpråœ¨C++11å’ŒC++14ä¸­çš„ä¸åŒ</h4><p>constexprå‡½æ•°ä»…é™äºä¼ å…¥å’Œè¿”å›å­—é¢å‹åˆ«ï¼ˆliteral typeï¼‰ï¼Œæ„æ€å°±æ˜¯è¿™æ ·çš„å‹åˆ«èƒ½å¤ŸæŒæœ‰ç¼–è¯‘æœŸå¯ä»¥å†³è®®çš„å€¼ã€‚åœ¨C++11ä¸­ï¼Œæ‰€æœ‰çš„å†…å»ºå‹åˆ«ï¼Œé™¤äº†voidï¼Œéƒ½ç¬¦åˆè¿™ä¸ªæ¡ä»¶ã€‚ä½†æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å‹åˆ«åŒæ ·å¯èƒ½ä¹Ÿæ˜¯å­—é¢å‹åˆ«ï¼Œå› ä¸ºå®ƒçš„æ„é€ å‡½æ•°å’Œå…¶ä»–æˆå‘˜å‡½æ•°å¯èƒ½ä¹Ÿæ˜¯constexprå‡½æ•°ã€‚</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">constexpr</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">double</span> xVal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">double</span> yVal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span>    <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>xVal<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span>yVal<span class="token punctuation">)</span>    <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">constexpr</span> <span class="token keyword">double</span> <span class="token function">xValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">constexpr</span> <span class="token keyword">double</span> <span class="token function">yValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> y<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">setX</span><span class="token punctuation">(</span><span class="token keyword">double</span> newX<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> newX<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">setY</span><span class="token punctuation">(</span><span class="token keyword">double</span> newY<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> y <span class="token operator">=</span> newY<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨C++11ä¸­ï¼Œæœ‰ä¸¤ä¸ªé™åˆ¶ä½¿å¾—Pointçš„æˆå‘˜å‡½æ•°setXå’ŒsetYæ— æ³•å£°æ˜ä¸ºconstexprã€‚</p><ol><li>é¦–å…ˆï¼Œå®ƒä»¬ä¿®æ”¹äº†æ“ä½œå¯¹è±¡ã€‚åœ¨C++11ä¸­ï¼Œconstexprå‡½æ•°éƒ½éšå¼åœ°è¢«å£°æ˜ä¸ºconstçš„äº†ã€‚<em>è¿™é‡Œè¯´çš„å¹¶éå‡½æ•°è¿”å›å€¼çš„constå±æ€§ï¼Œè€Œæ˜¯æŒ‡æˆå‘˜å‡½æ•°çš„consté¥°è¯ï¼Œè¿™æ„å‘³ç€è¯¥æˆå‘˜å‡½æ•°ä¸èƒ½ä¿®æ”¹å…¶æ“ä½œå¯¹è±¡ï¼ˆä¸¥æ ¼åœ°è¯´æ˜¯ä¸èƒ½ä¿®æ”¹å…¶émutableæ•°æ®æˆå‘˜ï¼‰ã€‚</em></li><li>å…¶æ¬¡ï¼Œå®ƒä»¬çš„è¿”å›å‹åˆ«æ˜¯voidã€‚è€Œåœ¨C++11ä¸­ï¼Œvoidå¹¶ä¸æ˜¯ä¸ªå­—é¢å‹åˆ«ã€‚</li></ol><p>ä¸è¿‡è¿™ä¸¤ä¸ªé™åˆ¶åœ¨C++14ä¸­éƒ½è¢«è§£é™¤äº†ï¼Œæ‰€ä»¥åœ¨C++14ä¸­ï¼Œå°±è¿è®¾ç½®å™¨ä¹Ÿå¯ä»¥å£°æ˜ä¸ºconstexprã€‚</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">constexpr</span> <span class="token keyword">void</span> <span class="token function">setX</span><span class="token punctuation">(</span><span class="token keyword">double</span> newX<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> newX<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// C++14</span>    <span class="token keyword">constexpr</span> <span class="token keyword">void</span> <span class="token function">setY</span><span class="token punctuation">(</span><span class="token keyword">double</span> newY<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> y <span class="token operator">=</span> newY<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// C++14</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å…³äºæ¡æ¬¾15çš„è¡¥å……è¯´æ˜"><a href="#å…³äºæ¡æ¬¾15çš„è¡¥å……è¯´æ˜" class="headerlink" title="å…³äºæ¡æ¬¾15çš„è¡¥å……è¯´æ˜"></a>å…³äºæ¡æ¬¾15çš„è¡¥å……è¯´æ˜</h4><ul><li><p>æ‰€æœ‰constexprå¯¹è±¡éƒ½æ˜¯constå¯¹è±¡ï¼Œè€Œå¹¶éæ‰€æœ‰çš„constå¯¹è±¡éƒ½æ˜¯constexprå¯¹è±¡ã€‚å¦‚æœä½ æƒ³è®©ç¼–è¯‘å™¨æä¾›ä¿è¯ï¼Œè®©å˜é‡æ‹¥æœ‰ä¸€ä¸ªå€¼ï¼Œç”¨äºè¦æ±‚ç¼–è¯‘æœŸå¸¸é‡çš„è¯­å¢ƒï¼Œé‚£ä¹ˆèƒ½è¾¾åˆ°è¿™ä¸ªç›®çš„çš„å·¥å…·æ˜¯constexprï¼Œè€Œéconstã€‚</p></li><li><p>åœ¨C++11ä¸­ï¼Œconstexprå‡½æ•°ä¸å¾—åŒ…å«å¤šäºä¸€ä¸ªå¯æ‰§è¡Œè¯­å¥ï¼Œå³ä¸€ä¸ªreturnè¯­å¥ã€‚åœ¨C++14ä¸­ï¼Œé™åˆ¶æ¡ä»¶å¤§å¤§åœ°æ”¾å®½äº†ã€‚</p></li></ul><h3 id="16-ä¿è¯constæˆå‘˜å‡½æ•°çš„çº¿ç¨‹å®‰å…¨æ€§"><a href="#16-ä¿è¯constæˆå‘˜å‡½æ•°çš„çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="16. ä¿è¯constæˆå‘˜å‡½æ•°çš„çº¿ç¨‹å®‰å…¨æ€§"></a>16. ä¿è¯constæˆå‘˜å‡½æ•°çš„çº¿ç¨‹å®‰å…¨æ€§</h3><ol><li>ä¿è¯constæˆå‘˜å‡½æ•°çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œé™¤éå¯ä»¥ç¡®ä¿¡å®ƒä»¬ä¸ä¼šç”¨åœ¨å¹¶å‘è¯­å¢ƒä¸­ã€‚</li><li>è¿ç”¨std::atomicå‹åˆ«çš„å˜é‡ä¼šæ¯”è¿ç”¨äº’æ–¥é‡æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œä½†å‰è€…ä»…é€‚ç”¨å¯¹å•ä¸ªå˜é‡æˆ–å†…å­˜åŒºåŸŸçš„æ“ä½œã€‚</li></ol><h3 id="17-ç†è§£ç‰¹ç§æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶"><a href="#17-ç†è§£ç‰¹ç§æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶" class="headerlink" title="17. ç†è§£ç‰¹ç§æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶"></a>17. ç†è§£ç‰¹ç§æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶</h3><ol><li>ç‰¹ç§æˆå‘˜å‡½æ•°æ˜¯æŒ‡é‚£äº›C++ä¼šè‡ªè¡Œç”Ÿæˆçš„æˆå‘˜å‡½æ•°ï¼šé»˜è®¤æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€å¤åˆ¶æ“ä½œï¼Œä»¥åŠç§»åŠ¨æ“ä½œã€‚</li><li>ç§»åŠ¨æ“ä½œä»…å½“ç±»ä¸­æœªåŒ…å«ç”¨æˆ·æ˜¾å¼å£°æ˜çš„å¤åˆ¶æ“ä½œã€ç§»åŠ¨æ“ä½œå’Œææ„å‡½æ•°æ—¶æ‰ç”Ÿæˆã€‚</li><li>å¤åˆ¶æ„é€ å‡½æ•°ä»…å½“ç±»ä¸­ä¸åŒ…å«ç”¨æˆ·æ˜¾ç¤ºå£°æ˜çš„å¤åˆ¶æ„é€ å‡½æ•°æ—¶æ‰ç”Ÿæˆï¼Œå¦‚æœè¯¥ç±»å£°æ˜äº†ç§»åŠ¨æ“ä½œåˆ™å¤åˆ¶æ„é€ å‡½æ•°å°†è¢«åˆ é™¤ã€‚å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦ä»…å½“ç±»ä¸­ä¸åŒ…å«ç”¨æˆ·æ˜¾ç¤ºå£°æ˜çš„å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦æ‰ç”Ÿæˆï¼Œå¦‚æœè¯¥ç±»å£°æ˜äº†ç§»åŠ¨æ“ä½œåˆ™å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦å°†è¢«åˆ é™¤ã€‚åœ¨å·²ç»å­˜åœ¨æ˜¾å¼å£°æ˜çš„ææ„å‡½æ•°çš„æ¡ä»¶ä¸‹ï¼Œç”Ÿæˆå¤åˆ¶æ“ä½œå·²ç»æˆä¸ºäº†è¢«åºŸå¼ƒçš„è¡Œä¸ºã€‚</li><li>æˆå‘˜å‡½æ•°æ¨¡æ¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šæŠ‘åˆ¶ç‰¹ç§æˆå‘˜å‡½æ•°çš„ç”Ÿæˆã€‚</li></ol><h4 id="å¤§ä¸‰å¾‹"><a href="#å¤§ä¸‰å¾‹" class="headerlink" title="å¤§ä¸‰å¾‹"></a>å¤§ä¸‰å¾‹</h4><p>å¦‚æœä½ å£°æ˜äº†å¤åˆ¶æ„é€ å‡½æ•°ã€å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦ï¼Œæˆ–ææ„å‡½æ•°ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œä½ å°±å¾—åŒæ—¶å£°æ˜æ‰€æœ‰è¿™ä¸‰ä¸ªã€‚</p><p>å®ƒæ¤æ ¹äºè¿™æ ·çš„æ€æƒ³ï¼šå¦‚æœæœ‰æ”¹å†™å¤åˆ¶æ“ä½œçš„éœ€æ±‚ï¼Œå¾€å¾€æ„å‘³ç€è¯¥ç±»éœ€è¦æ‰§è¡ŒæŸç§èµ„æºç®¡ç†ï¼Œè€Œè¿™å°±æ„å‘³ç€ï¼š</p><ol><li>åœ¨ä¸€ç§å¤åˆ¶æ“ä½œä¸­è¿›è¡Œçš„ä»»ä½•èµ„æºç®¡ç†ï¼Œä¹Ÿææœ‰å¯èƒ½åœ¨å¦ä¸€ç§å¤åˆ¶æ“ä½œä¸­ä¹Ÿéœ€è¦è¿›è¡Œï¼›</li><li>è¯¥ç±»çš„ææ„å‡½æ•°ä¹Ÿä¼šå‚ä¸åˆ°è¯¥èµ„æºçš„ç®¡ç†ä¸­ï¼ˆé€šå¸¸æ˜¯é‡Šæ”¾ä¹‹ï¼‰ã€‚</li></ol><h4 id="ç§»åŠ¨æ“ä½œçš„ç”Ÿæˆæ¡ä»¶ï¼ˆå¦‚æœéœ€è¦ç”Ÿæˆï¼‰ä»…å½“ä¸€ä¸‹ä¸‰è€…åŒæ—¶æˆç«‹"><a href="#ç§»åŠ¨æ“ä½œçš„ç”Ÿæˆæ¡ä»¶ï¼ˆå¦‚æœéœ€è¦ç”Ÿæˆï¼‰ä»…å½“ä¸€ä¸‹ä¸‰è€…åŒæ—¶æˆç«‹" class="headerlink" title="ç§»åŠ¨æ“ä½œçš„ç”Ÿæˆæ¡ä»¶ï¼ˆå¦‚æœéœ€è¦ç”Ÿæˆï¼‰ä»…å½“ä¸€ä¸‹ä¸‰è€…åŒæ—¶æˆç«‹"></a>ç§»åŠ¨æ“ä½œçš„ç”Ÿæˆæ¡ä»¶ï¼ˆå¦‚æœéœ€è¦ç”Ÿæˆï¼‰ä»…å½“ä¸€ä¸‹ä¸‰è€…åŒæ—¶æˆç«‹</h4><ol><li><p>è¯¥ç±»æœªå£°æ˜ä»»ä½•å¤åˆ¶æ“ä½œ</p><p> å£°æ˜å¤åˆ¶æ“ä½œï¼ˆæ— è®ºæ˜¯å¤åˆ¶æ„é€ è¿˜æ˜¯å¤åˆ¶èµ‹å€¼ï¼‰çš„è¡Œä¸ºè¡¨æ˜äº†å¯¹è±¡çš„å¸¸è§„å¤åˆ¶é€”å¾„ï¼ˆæŒ‰æˆå‘˜å¤åˆ¶ï¼‰å¯¹äºè¯¥ç±»å¹¶ä¸é€‚ç”¨ã€‚ç¼–è¯‘å™¨ä»è€Œåˆ¤å®šï¼Œæ—¢ç„¶æŒ‰æˆå‘˜å¤åˆ¶ä¸é€‚ç”¨äºå¤åˆ¶æ“ä½œï¼Œåˆ™æŒ‰æˆå‘˜ç§»åŠ¨ææœ‰å¯èƒ½ä¹Ÿä¸é€‚ç”¨äºç§»åŠ¨æ“ä½œã€‚</p></li><li><p>è¯¥ç±»æœªå£°æ˜ä»»ä½•ç§»åŠ¨æ“ä½œ</p><p> å‡è®¾ä½ å£°æ˜äº†ä¸€ä¸ªç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä½ å®é™…ä¸Šè¡¨æ˜ç§»åŠ¨æ“ä½œçš„å®ç°æ–¹å¼å°†ä¼šä¸ç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤æŒ‰æˆå‘˜ç§»åŠ¨çš„ç§»åŠ¨æ„é€ å‡½æ•°å¤šå°‘æœ‰äº›ä¸åŒã€‚è€Œè‹¥æ˜¯æŒ‰æˆå‘˜è¿›è¡Œçš„ç§»åŠ¨æ„é€ æ“ä½œæœ‰ä¸åˆç”¨ä¹‹å¤„çš„è¯ï¼Œé‚£ä¹ˆæŒ‰æˆå‘˜è¿›è¡Œçš„ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ææœ‰å¯èƒ½ä¹Ÿä¼šæœ‰ä¸åˆç”¨ä¹‹å¤„ã€‚</p></li><li><p>è¯¥ç±»æœªå£°æ˜ä»»ä½•ææ„å‡½æ•°</p><ul><li><a href="#å¤§ä¸‰å¾‹">å¤§ä¸‰å¾‹</a>çš„ä¸€ä¸ªæ¨è®ºæ˜¯ï¼Œå¦‚æœå­˜åœ¨ç”¨æˆ·å£°æ˜çš„ææ„å‡½æ•°ï¼Œåˆ™å¹³å‡¡çš„ï¼ˆtrivialï¼‰æŒ‰æˆå‘˜å¤åˆ¶çš„ä¹Ÿä¸é€‚ç”¨äºè¯¥ç±»ã€‚æ ¹æ®è¿™ä¸ªæ¨è®ºï¼Œåˆèƒ½å¾—å‡ºè¿›ä¸€æ­¥çš„ç»“è®ºï¼Œå¦‚æœå£°æ˜äº†ææ„å‡½æ•°ï¼Œåˆ™å¤åˆ¶æ“ä½œå°±ä¸è¯¥è¢«è‡ªåŠ¨ç”Ÿæˆï¼Œå› ä¸ºå®ƒä»¬çš„è¡Œä¸ºä¸å¯èƒ½æ­£ç¡®ã€‚ä¸è¿‡åœ¨C++98æ ‡å‡†è¢«æ¥å—çš„æ—¶ä»£ï¼Œè¿™æ ·çš„è®ºè¯è¿‡ç¨‹æ²¡æœ‰å¾—åˆ°å……åˆ†çš„é‡è§†ï¼Œæ‰€ä»¥åœ¨C++98ä¸­ï¼Œç”¨æˆ·å£°æ˜çš„ææ„å‡½æ•°å³ä½¿å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šå½±å“ç¼–è¯‘å™¨ç”Ÿæˆå¤åˆ¶æ“ä½œçš„æ„æ„¿ã€‚è¿™ç§æƒ…å†µåœ¨C++11ä»ç„¶å¾—åˆ°äº†ä¿æŒï¼Œä½†åŸå› ä»…ä»…åœ¨äºï¼Œå¦‚æœè¦å¯¹å¤åˆ¶æ“ä½œçš„ç”Ÿæˆæ¡ä»¶æ–½åŠ æ›´ä¸¥æ ¼çš„é™åˆ¶ï¼Œå°±ä¼šç ´åå¤ªå¤šçš„é—ç•™ä»£ç äº†ã€‚</li><li>ç”±äº<a href="#å¤§ä¸‰å¾‹">å¤§ä¸‰å¾‹</a>èƒŒåçš„ç†ç”±ä»ç„¶æˆç«‹ï¼Œå†ç»“åˆå£°æ˜äº†å¤åˆ¶æ“ä½œå°±ä¼šé˜»æ­¢éšå¼ç”Ÿæˆç§»åŠ¨æ“ä½œçš„äº‹å®ï¼Œå°±æ¨åŠ¨äº†C++11ä¸­çš„è¿™æ ·ä¸€ä¸ªè§„å®šï¼šåªè¦ç”¨æˆ·å£°æ˜äº†ææ„å‡½æ•°ï¼Œå°±ä¸ä¼šç”Ÿæˆç§»åŠ¨æ“ä½œã€‚</li></ul></li></ol><h4 id="å…³äºæ¡æ¬¾17çš„è¡¥å……è¯´æ˜"><a href="#å…³äºæ¡æ¬¾17çš„è¡¥å……è¯´æ˜" class="headerlink" title="å…³äºæ¡æ¬¾17çš„è¡¥å……è¯´æ˜"></a>å…³äºæ¡æ¬¾17çš„è¡¥å……è¯´æ˜</h4><ul><li>å½“ç§»åŠ¨æ“ä½œåœ¨æŸä¸ªæ•°æ®æˆå‘˜æˆ–åŸºç±»éƒ¨åˆ†ä¸Šæ‰§è¡Œç§»åŠ¨æ„é€ æˆ–ç§»åŠ¨èµ‹å€¼çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ä¿è¯ç§»åŠ¨æ“ä½œçœŸçš„ä¼šå‘ç”Ÿã€‚â€œæŒ‰æˆå‘˜ç§»åŠ¨â€å®é™…ä¸Šæ›´åƒæ˜¯æŒ‰æˆå‘˜çš„ç§»åŠ¨è¯·æ±‚ï¼Œå› ä¸ºé‚£äº›ä¸å¯ç§»åŠ¨çš„å‹åˆ«ï¼ˆå³é‚£äº›å¹¶æœªä¸ºç§»åŠ¨æ“ä½œæä¾›ç‰¹æ®Šæ”¯æŒçš„å‹åˆ«ï¼Œè¿™åŒ…æ‹¬äº†å¤§å¤šæ•°C++98çš„é—ç•™å‹åˆ«ï¼‰å°†é€šè¿‡å…¶å¤åˆ¶æ“ä½œå®ç°â€œç§»åŠ¨â€ã€‚æ¯ä¸ªæŒ‰æˆå‘˜è¿›è¡Œçš„â€œç§»åŠ¨â€æ“ä½œï¼Œå…¶æ ¸å¿ƒåœ¨äºæŠŠstd::moveåº”ç”¨äºæ¯ä¸€ä¸ªç§»åŠ¨æºå¯¹è±¡ï¼Œå…¶è¿”å›å€¼è¢«ç”¨äºå‡½æ•°é‡è½½å†³è®®ï¼Œæœ€ç»ˆå†³å®šæ˜¯æ‰§è¡Œä¸€ä¸ªç§»åŠ¨è¿˜æ˜¯å¤åˆ¶æ“ä½œï¼Œè¿™ä¸ªæµç¨‹å°†åœ¨<a href="#23-ç†è§£std::moveå’Œstd::forward">æ¡æ¬¾23</a>ä¸­è¯¦è¿°ã€‚åœ¨æœ¬æ¡æ¬¾ä¸­ï¼Œåªéœ€è®°ä½ï¼ŒæŒ‰æˆå‘˜ç§»åŠ¨æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†æ˜¯åœ¨æ”¯æŒç§»åŠ¨æ“ä½œçš„æˆå‘˜ä¸Šæ‰§è¡Œç§»åŠ¨æ“ä½œï¼Œå¦ä¸€éƒ¨åˆ†å®åœ¨ä¸æ”¯æŒç§»åŠ¨æ“ä½œçš„æˆå‘˜ä¸Šæ‰§è¡Œå¤åˆ¶æ“ä½œã€‚</li></ul><h2 id="å››ã€æ™ºèƒ½æŒ‡é’ˆ"><a href="#å››ã€æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="å››ã€æ™ºèƒ½æŒ‡é’ˆ"></a>å››ã€æ™ºèƒ½æŒ‡é’ˆ</h2><h3 id="18-ä½¿ç”¨std-unique-ptrç®¡ç†å…·å¤‡ä¸“å±æ‰€æœ‰æƒçš„èµ„æº"><a href="#18-ä½¿ç”¨std-unique-ptrç®¡ç†å…·å¤‡ä¸“å±æ‰€æœ‰æƒçš„èµ„æº" class="headerlink" title="18. ä½¿ç”¨std::unique_ptrç®¡ç†å…·å¤‡ä¸“å±æ‰€æœ‰æƒçš„èµ„æº"></a>18. ä½¿ç”¨std::unique_ptrç®¡ç†å…·å¤‡ä¸“å±æ‰€æœ‰æƒçš„èµ„æº</h3><ol><li>std::unique_ptræ˜¯å°å·§ã€é«˜é€Ÿçš„ã€å…·å¤‡åªç§»å‹åˆ«çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå¯¹æ‰˜ç®¡èµ„æºå®æ–½ä¸“å±æ‰€æœ‰æƒè¯­ä¹‰ã€‚</li><li>é»˜è®¤åœ°ï¼Œèµ„æºææ„é‡‡ç”¨deleteè¿ç®—ç¬¦æ¥å®ç°ï¼Œä½†å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰åˆ é™¤å™¨ã€‚æœ‰çŠ¶æ€çš„åˆ é™¤å™¨å’Œé‡‡ç”¨å‡½æ•°æŒ‡é’ˆå®ç°çš„åˆ é™¤å™¨ä¼šå¢åŠ std::unique_ptrå‹åˆ«çš„å¯¹è±¡å°ºå¯¸ã€‚</li><li>å°†std::unique_ptrè½¬æ¢æˆstd::shared_ptræ˜¯å®¹æ˜“å®ç°çš„ã€‚</li></ol><h3 id="19-ä½¿ç”¨std-shared-ptrç®¡ç†å…·å¤‡å…±äº«æ‰€æœ‰æƒçš„èµ„æº"><a href="#19-ä½¿ç”¨std-shared-ptrç®¡ç†å…·å¤‡å…±äº«æ‰€æœ‰æƒçš„èµ„æº" class="headerlink" title="19. ä½¿ç”¨std::shared_ptrç®¡ç†å…·å¤‡å…±äº«æ‰€æœ‰æƒçš„èµ„æº"></a>19. ä½¿ç”¨std::shared_ptrç®¡ç†å…·å¤‡å…±äº«æ‰€æœ‰æƒçš„èµ„æº</h3><ol><li>std::shared_ptræä¾›æ–¹ä¾¿çš„æ‰‹æ®µï¼Œå®ç°äº†ä»»æ„èµ„æºåœ¨å…±äº«æ‰€æœ‰æƒè¯­ä¹‰ä¸‹è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†çš„åƒåœ¾å›æ”¶ã€‚</li><li>ä¸std::unique_ptrç›¸æ¯”ï¼Œstd::shared_ptrçš„å°ºå¯¸é€šå¸¸æ˜¯è£¸æŒ‡é’ˆå°ºå¯¸çš„ä¸¤å€ï¼Œå®ƒè¿˜ä¼šå¸¦æ¥æ§åˆ¶å—çš„å¼€é”€ï¼Œå¹¶è¦æ±‚åŸå­åŒ–çš„å¼•ç”¨æŠ€æœ¯æ“ä½œã€‚</li><li>é»˜è®¤çš„èµ„æºææ„é€šè¿‡deleteè¿ç®—ç¬¦è¿›è¡Œï¼Œä½†åŒæ—¶ä¹Ÿæ”¯æŒå®šåˆ¶åˆ é™¤å™¨ã€‚åˆ é™¤å™¨çš„å‹åˆ«å¯¹std::shared_ptrçš„å‹åˆ«æ²¡æœ‰å½±å“ã€‚</li><li>é¿å…ä½¿ç”¨è£¸æŒ‡é’ˆå‹åˆ«çš„å˜é‡æ¥åˆ›å»ºstd::shared_ptræŒ‡é’ˆã€‚</li></ol><h3 id="20-å¯¹äºç±»ä¼¼std-shared-pträ½†æœ‰å¯èƒ½ç©ºæ‚¬çš„æŒ‡é’ˆä½¿ç”¨std-weak-ptr"><a href="#20-å¯¹äºç±»ä¼¼std-shared-pträ½†æœ‰å¯èƒ½ç©ºæ‚¬çš„æŒ‡é’ˆä½¿ç”¨std-weak-ptr" class="headerlink" title="20. å¯¹äºç±»ä¼¼std::shared_pträ½†æœ‰å¯èƒ½ç©ºæ‚¬çš„æŒ‡é’ˆä½¿ç”¨std::weak_ptr"></a>20. å¯¹äºç±»ä¼¼std::shared_pträ½†æœ‰å¯èƒ½ç©ºæ‚¬çš„æŒ‡é’ˆä½¿ç”¨std::weak_ptr</h3><ol><li>ä½¿ç”¨std::weak_ptræ¥ä»£æ›¿å¯èƒ½ç©ºæ‚¬çš„std::shared_ptrã€‚</li><li>std::weak_ptrå¯èƒ½çš„ç”¨æ­¦ä¹‹åœ°åŒ…æ‹¬ç¼“å­˜ï¼Œè§‚å¯Ÿè€…åˆ—è¡¨ï¼Œä»¥åŠé¿å…std::shared_ptræŒ‡é’ˆç¯è·¯ã€‚</li></ol><h3 id="21-ä¼˜å…ˆé€‰ç”¨std-make-uniqueå’Œstd-make-sharedï¼Œè€Œéç›´æ¥ä½¿ç”¨new"><a href="#21-ä¼˜å…ˆé€‰ç”¨std-make-uniqueå’Œstd-make-sharedï¼Œè€Œéç›´æ¥ä½¿ç”¨new" class="headerlink" title="21. ä¼˜å…ˆé€‰ç”¨std::make_uniqueå’Œstd::make_sharedï¼Œè€Œéç›´æ¥ä½¿ç”¨new"></a>21. ä¼˜å…ˆé€‰ç”¨std::make_uniqueå’Œstd::make_sharedï¼Œè€Œéç›´æ¥ä½¿ç”¨new</h3><ol><li>ç›¸æ¯”äºç›´æ¥ä½¿ç”¨newè¡¨è¾¾å¼ï¼Œmakeç³»åˆ—å‡½æ•°æ¶ˆé™¤äº†é‡å¤ä»£ç ã€æ”¹è¿›äº†å¼‚å¸¸å®‰å…¨æ€§ï¼Œå¹¶ä¸”å¯¹äºstd::make_sharedå’Œstd::allocated_sharedè€Œè¨€ï¼Œç”Ÿæˆçš„ç›®æ ‡ä»£ç ä¼šå°ºå¯¸æ›´å°ã€é€Ÿåº¦æ›´å¿«ã€‚</li><li>ä¸é€‚äºä½¿ç”¨makeç³»åˆ—å‡½æ•°çš„åœºæ™¯åŒ…æ‹¬éœ€è¦å®šåˆ¶åˆ é™¤å™¨ï¼Œä»¥åŠæœŸæœ›ç›´æ¥ä¼ é€’å¤§æ‹¬å·åˆå§‹åŒ–ç‰©ã€‚</li><li>å¯¹äºstd::shared_ptrï¼Œä¸å»ºè®®ä½¿ç”¨makeç³»åˆ—å‡½æ•°çš„é¢å¤–åœºæ™¯åŒ…æ‹¬ï¼šï¼ˆ1ï¼‰è‡ªå®šä¹‰å†…å­˜ç®¡ç†çš„ç±»ï¼›ï¼ˆ2ï¼‰å†…å­˜ç´§å¼ çš„ç³»ç»Ÿã€éå¸¸å¤§çš„å¯¹è±¡ã€ä»¥åŠå­˜åœ¨æ¯”æŒ‡æ¶‰åˆ°ç›¸åŒå¯¹è±¡çš„std::shared_ptrç”Ÿå­˜æœŸæ›´ä¹…çš„std::weak_ptrã€‚</li></ol><h3 id="22-ä½¿ç”¨Pimplä¹ æƒ¯ç”¨æ³•æ—¶ï¼Œå°†ç‰¹æ®Šæˆå‘˜å‡½æ•°çš„å®šä¹‰æ”¾åˆ°å®ç°æ–‡ä»¶ä¸­"><a href="#22-ä½¿ç”¨Pimplä¹ æƒ¯ç”¨æ³•æ—¶ï¼Œå°†ç‰¹æ®Šæˆå‘˜å‡½æ•°çš„å®šä¹‰æ”¾åˆ°å®ç°æ–‡ä»¶ä¸­" class="headerlink" title="22. ä½¿ç”¨Pimplä¹ æƒ¯ç”¨æ³•æ—¶ï¼Œå°†ç‰¹æ®Šæˆå‘˜å‡½æ•°çš„å®šä¹‰æ”¾åˆ°å®ç°æ–‡ä»¶ä¸­"></a>22. ä½¿ç”¨Pimplä¹ æƒ¯ç”¨æ³•æ—¶ï¼Œå°†ç‰¹æ®Šæˆå‘˜å‡½æ•°çš„å®šä¹‰æ”¾åˆ°å®ç°æ–‡ä»¶ä¸­</h3><ol><li>Pimplæƒ¯ç”¨æ³•é€šè¿‡é™ä½ç±»çš„å®¢æˆ·å’Œç±»å®ç°è€…ä¹‹é—´çš„ä¾èµ–æ€§ï¼Œå‡å°‘äº†æ„å»ºéæ•°ã€‚</li><li>å¯¹äºé‡‡ç”¨std::unique_ptræ¥å®ç°çš„pImplæŒ‡é’ˆï¼Œé¡»åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å£°æ˜ç‰¹ç§æˆå‘˜å‡½æ•°ï¼Œä½†åœ¨å®ç°æ–‡ä»¶ä¸­å®ç°å®ƒä»¬ã€‚å³ä½¿é»˜è®¤å‡½æ•°å®ç°æœ‰ç€æ­£ç¡®è¡Œä¸ºï¼Œä¹Ÿå¿…é¡»è¿™æ ·åšã€‚</li><li>ä¸Šè¿°å»ºè®®ä»…é€‚ç”¨äºstd::unique_ptrï¼Œä½†å¹¶ä¸ä½¿ç”¨std::shared_ptrã€‚</li></ol><h2 id="äº”ã€å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘"><a href="#äº”ã€å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘" class="headerlink" title="äº”ã€å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘"></a>äº”ã€å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘</h2><p>åœ¨é˜…è¯»æœ¬ç« ä¸­çš„æ¡æ¬¾æ—¶ï¼Œä¸€å®šè¦æŠŠè¿™ä¸€ç‚¹é“­è®°åœ¨å¿ƒï¼š<strong>å½¢å‚æ€»æ˜¯å·¦å€¼ï¼Œå³ä½¿å…¶å‹åˆ«æ˜¯å³å€¼å¼•ç”¨ã€‚</strong>å³ï¼Œç»™å®šå‡½æ•°å½¢å¦‚ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span>Widget<span class="token operator">&amp;&amp;</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½¢å‚wæ˜¯ä¸ªå·¦å€¼ã€‚å³ä½¿å®ƒçš„å‹åˆ«æ˜¯ä¸ªæŒ‡æ¶‰åˆ°Widgetå‹åˆ«å¯¹è±¡çš„å³å€¼å¼•ç”¨ï¼ˆå¦‚æœä½ å¯¹æ­¤æ„Ÿè§‰æ„å¤–ï¼Œè¯·å‚é˜…æœ¬ä¹¦ç¬¬ä¸€ç« å°±å†™ç€çš„å…³äºå·¦å€¼å’Œå³å€¼çš„æ¦‚è¿°ï¼‰ã€‚</p><h3 id="23-ç†è§£std-moveå’Œstd-forward"><a href="#23-ç†è§£std-moveå’Œstd-forward" class="headerlink" title="23. ç†è§£std::moveå’Œstd::forward"></a>23. ç†è§£std::moveå’Œstd::forward</h3><ol><li>std::moveå®æ–½çš„æ˜¯æ— æ¡ä»¶çš„å‘å³å€¼å‹åˆ«çš„å¼ºåˆ¶å‹åˆ«è½¬æ¢ã€‚å°±å…¶æœ¬èº«è€Œè¨€ï¼Œå®ƒä¸ä¼šæ‰§è¡Œç§»åŠ¨æ“ä½œã€‚</li><li>ä»…å½“ä¼ å…¥çš„å®å‚è¢«ç»‘å®šåˆ°å³å€¼æ—¶ï¼Œstd::forwardæ‰é’ˆå¯¹è¯¥å®å‚å®æ–½å‘å³å€¼å‹åˆ«çš„å¼ºåˆ¶å‹åˆ«è½¬æ¢ã€‚</li><li>åœ¨è¿è¡ŒæœŸï¼Œstd::moveå’Œstd::forwardéƒ½ä¸ä¼šåšä»»ä½•æ“ä½œã€‚</li></ol><h3 id="24-åŒºåˆ†ä¸‡èƒ½å¼•ç”¨å’Œå³å€¼å¼•ç”¨"><a href="#24-åŒºåˆ†ä¸‡èƒ½å¼•ç”¨å’Œå³å€¼å¼•ç”¨" class="headerlink" title="24. åŒºåˆ†ä¸‡èƒ½å¼•ç”¨å’Œå³å€¼å¼•ç”¨"></a>24. åŒºåˆ†ä¸‡èƒ½å¼•ç”¨å’Œå³å€¼å¼•ç”¨</h3><ol><li>å¦‚æœå‡½æ•°æ¨¡æ¿å½¢å‚å…·å¤‡T&amp;&amp;å‹åˆ«ï¼Œå¹¶ä¸”Tçš„å‹åˆ«ç³»æ¨å¯¼è€Œæ¥ï¼Œæˆ–å¦‚æœå¯¹è±¡ä½¿ç”¨auto&amp;&amp;å£°æ˜å…¶å‹åˆ«ï¼Œåˆ™è¯¥å½¢å‚æˆ–å¯¹è±¡å°±æ˜¯ä¸ªä¸‡èƒ½å¼•ç”¨ã€‚</li><li>å¦‚æœå‹åˆ«å£°æ˜å¹¶ä¸ç²¾ç¡®åœ°å…·å¤‡type&amp;&amp;çš„å½¢å¼ï¼Œæˆ–è€…å‹åˆ«æ¨å¯¼å¹¶æœªå‘ç”Ÿï¼Œåˆ™type&amp;&amp;å°±ä»£è¡¨å³å€¼å¼•ç”¨ã€‚</li><li>è‹¥é‡‡ç”¨å³å€¼æ¥åˆå§‹åŒ–ä¸‡èƒ½å¼•ç”¨ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚è‹¥é‡‡ç”¨å·¦å€¼æ¥åˆå§‹åŒ–ä¸‡èƒ½å¼•ç”¨ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªå·¦å€¼å¼•ç”¨ã€‚</li></ol><h3 id="25-é’ˆå¯¹å³å€¼å¼•ç”¨å®æ–½std-moveï¼Œé’ˆå¯¹ä¸‡èƒ½å¼•ç”¨å®æ–½std-forward"><a href="#25-é’ˆå¯¹å³å€¼å¼•ç”¨å®æ–½std-moveï¼Œé’ˆå¯¹ä¸‡èƒ½å¼•ç”¨å®æ–½std-forward" class="headerlink" title="25. é’ˆå¯¹å³å€¼å¼•ç”¨å®æ–½std::moveï¼Œé’ˆå¯¹ä¸‡èƒ½å¼•ç”¨å®æ–½std::forward"></a>25. é’ˆå¯¹å³å€¼å¼•ç”¨å®æ–½std::moveï¼Œé’ˆå¯¹ä¸‡èƒ½å¼•ç”¨å®æ–½std::forward</h3><ol><li>é’ˆå¯¹å³å€¼å¼•ç”¨çš„æœ€åä¸€æ¬¡ä½¿ç”¨å®æ–½std::moveï¼Œé’ˆå¯¹ä¸‡èƒ½å¼•ç”¨çš„æœ€åä¸€æ¬¡ä½¿ç”¨å®æ–½std::forwardã€‚</li><li>ä½œä¸ºæŒ‰å€¼è¿”å›çš„å‡½æ•°çš„å³å€¼å¼•ç”¨å’Œä¸‡èƒ½å¼•ç”¨ï¼Œä¾ä¸Šä¸€æ¡æ‰€è¿°é‡‡å–ç›¸åŒè¡Œä¸ºã€‚</li><li>è‹¥å±€éƒ¨å¯¹è±¡å¯èƒ½é€‚ç”¨äºè¿”å›å€¼ä¼˜åŒ–ï¼Œåˆ™è¯·å‹¿é’ˆå¯¹å…¶å®æ–½std::moveæˆ–std::forwardã€‚</li></ol><h4 id="RVOçš„æ¡ä»¶"><a href="#RVOçš„æ¡ä»¶" class="headerlink" title="RVOçš„æ¡ä»¶"></a>RVOçš„æ¡ä»¶</h4><ul><li><p>å±€éƒ¨å¯¹è±¡å‹åˆ«å’Œå‡½æ•°è¿”å›å€¼å‹åˆ«ç›¸åŒã€‚</p>  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Widget <span class="token function">makeWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Widget w<span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">move</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  <code>std::move(w)</code>è¿”å›çš„ä¸æ˜¯å±€éƒ¨å¯¹è±¡wï¼Œè€Œæ˜¯wçš„å¼•ç”¨ï¼Œstd::move(w)çš„ç»“æœã€‚è¿”å›ä¸€ä¸ªå±€éƒ¨å¯¹è±¡çš„å¼•ç”¨å¹¶ä¸æ»¡è¶³å®æ–½RVOçš„å‰ææ¡ä»¶ï¼Œå› æ­¤ç¼–è¯‘å™¨å¿…é¡»æŠŠwç§»å…¥å‡½æ•°çš„è¿”å›å€¼å­˜å‚¨ä½ç½®ã€‚</p></li><li><p>è¿”å›çš„å°±æ˜¯å±€éƒ¨å¯¹è±¡æœ¬èº«ã€‚</p></li></ul><p>å³ä½¿å®æ–½RVOçš„å‰ææ¡ä»¶æ»¡è¶³ï¼Œä½†ç¼–è¯‘å™¨é€‰æ‹©ä¸æ‰§è¡Œå¤åˆ¶çœç•¥çš„æ—¶å€™ï¼Œè¿”å›å¯¹è±¡å¿…é¡»ä½œä¸ºå³å€¼å¤„ç†ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œå°±ç­‰äºæ ‡å‡†è¦æ±‚ï¼š<strong>å½“RVOçš„å‰ææ¡ä»¶å…è®¸æ—¶ï¼Œè¦ä¹ˆå‘ç”Ÿå¤åˆ¶çœç•¥ï¼Œè¦ä¹ˆstd::moveéšå¼åœ°è¢«å®æ–½äºè¿”å›çš„å±€éƒ¨å¯¹è±¡ä¸Šã€‚</strong></p><h3 id="26-é¿å…ä¾ä¸‡èƒ½å¼•ç”¨å‹å‹åˆ«è¿›è¡Œé‡è½½"><a href="#26-é¿å…ä¾ä¸‡èƒ½å¼•ç”¨å‹å‹åˆ«è¿›è¡Œé‡è½½" class="headerlink" title="26. é¿å…ä¾ä¸‡èƒ½å¼•ç”¨å‹å‹åˆ«è¿›è¡Œé‡è½½"></a>26. é¿å…ä¾ä¸‡èƒ½å¼•ç”¨å‹å‹åˆ«è¿›è¡Œé‡è½½</h3><ol><li>æŠŠä¸‡èƒ½å¼•ç”¨ä½œä¸ºé‡è½½å€™é€‰å‹åˆ«ï¼Œå‡ ä¹æ€»ä¼šè®©è¯¥é‡è½½ç‰ˆæœ¬åœ¨å§‹æ–™æœªåŠçš„æƒ…å†µä¸‹è¢«è°ƒç”¨åˆ°ã€‚</li><li>å®Œç¾è½¬å‘æ„é€ å‡½æ•°çš„é—®é¢˜å°¤å…¶ä¸¥é‡ï¼Œå› ä¸ºå¯¹äºéå¸¸é‡çš„å·¦å€¼å‹åˆ«è€Œè¨€ï¼Œå®ƒä»¬ä¸€èˆ¬éƒ½ä¼šå½¢æˆç›¸å¯¹äºå¤åˆ¶æ„é€ å‡½æ•°çš„æ›´ä½³åŒ¹é…ï¼Œå¹¶ä¸”å®ƒä»¬è¿˜ä¼šåŠ«æŒæ´¾ç”Ÿç±»ä¸­å¯¹åŸºç±»çš„å¤åˆ¶å’Œç§»åŠ¨æ„é€ å‡½æ•°çš„è°ƒç”¨ã€‚</li></ol><h3 id="27-ç†Ÿæ‚‰ä¾ä¸‡èƒ½å¼•ç”¨å‹åˆ«è¿›è¡Œé‡è½½çš„æ›¿ä»£æ–¹æ¡ˆ"><a href="#27-ç†Ÿæ‚‰ä¾ä¸‡èƒ½å¼•ç”¨å‹åˆ«è¿›è¡Œé‡è½½çš„æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="27. ç†Ÿæ‚‰ä¾ä¸‡èƒ½å¼•ç”¨å‹åˆ«è¿›è¡Œé‡è½½çš„æ›¿ä»£æ–¹æ¡ˆ"></a>27. ç†Ÿæ‚‰ä¾ä¸‡èƒ½å¼•ç”¨å‹åˆ«è¿›è¡Œé‡è½½çš„æ›¿ä»£æ–¹æ¡ˆ</h3><ol><li>å¦‚æœä¸ä½¿ç”¨ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½çš„ç»„åˆï¼Œåˆ™æ›¿ä»£æ–¹æ¡ˆåŒ…æ‹¬ä½¿ç”¨å½¼æ­¤ä¸åŒçš„å‡½æ•°åå­—ã€ä¼ é€’const T&amp;å‹åˆ«çš„å½¢å‚ã€ä¼ å€¼å’Œæ ‡ç­¾åˆ†æ´¾ã€‚</li><li>ç»ç”±std::enable_ifå¯¹æ¨¡æ¿æ–½åŠ é™åˆ¶ï¼Œå°±å¯ä»¥å°†ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¸€èµ·ä½¿ç”¨ï¼Œä¸è¿‡è¿™ç§æŠ€æœ¯æ§åˆ¶äº†ç¼–è¯‘å™¨å¯ä»¥è°ƒç”¨åˆ°æ¥å—ä¸‡èƒ½å¼•ç”¨çš„é‡è½½ç‰ˆæœ¬çš„æ¡ä»¶ã€‚</li><li>ä¸‡èƒ½å¼•ç”¨å½¢å‚é€šå¸¸åœ¨æ€§èƒ½æ–¹é¢å…·å¤‡ä¼˜åŠ¿ï¼Œä½†åœ¨æ˜“ç”¨æ€§æ–¹é¢ä¸€èˆ¬ä¼šæœ‰åŠ£åŠ¿ã€‚</li></ol><h3 id="28-ç†è§£å¼•ç”¨æŠ˜å "><a href="#28-ç†è§£å¼•ç”¨æŠ˜å " class="headerlink" title="28. ç†è§£å¼•ç”¨æŠ˜å "></a>28. ç†è§£å¼•ç”¨æŠ˜å </h3><ol><li>å¼•ç”¨æŠ˜å ä¼šåœ¨å››ç§è¯­å¢ƒä¸­å‘ç”Ÿï¼šæ¨¡æ¿å®ä¾‹åŒ–ï¼Œautoå‹åˆ«ç”Ÿæˆã€åˆ›å»ºå’Œè¿ç”¨typedefå’Œåˆ«åå£°æ˜ï¼Œä»¥åŠdecltypeã€‚</li><li>å½“ç¼–è¯‘å™¨åœ¨å¼•ç”¨æŠ˜å çš„è¯­å¢ƒä¸‹ç”Ÿæˆå¼•ç”¨çš„å¼•ç”¨æ—¶ï¼Œç»“æœä¼šå˜æˆå•ä¸ªå¼•ç”¨ã€‚å¦‚æœåŸå§‹çš„å¼•ç”¨ä¸­æœ‰ä»»ä¸€å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ï¼Œåˆ™ç»“æœä¸ºå·¦å€¼å¼•ç”¨ã€‚å¦åˆ™ï¼Œç»“æœä¸ºå³å€¼å¼•ç”¨ã€‚</li><li>ä¸‡èƒ½å¼•ç”¨å°±æ˜¯åœ¨å‹åˆ«æ¨å¯¼çš„è¿‡ç¨‹ä¸­ä¼šåŒºåˆ«å·¦å€¼å’Œå³å€¼ï¼Œä»¥åŠä¼šå‘ç”Ÿå¼•ç”¨æŠ˜å çš„è¯­å¢ƒä¸­çš„å³å€¼å¼•ç”¨ã€‚</li></ol><h3 id="29-å‡å®šç§»åŠ¨æ“ä½œä¸å­˜åœ¨ã€æˆæœ¬é«˜ã€æœªä½¿ç”¨"><a href="#29-å‡å®šç§»åŠ¨æ“ä½œä¸å­˜åœ¨ã€æˆæœ¬é«˜ã€æœªä½¿ç”¨" class="headerlink" title="29. å‡å®šç§»åŠ¨æ“ä½œä¸å­˜åœ¨ã€æˆæœ¬é«˜ã€æœªä½¿ç”¨"></a>29. å‡å®šç§»åŠ¨æ“ä½œä¸å­˜åœ¨ã€æˆæœ¬é«˜ã€æœªä½¿ç”¨</h3><ol><li>å‡å®šç§»åŠ¨æ“ä½œä¸å­˜åœ¨ã€æˆæœ¬é«˜ã€æœªä½¿ç”¨ã€‚</li><li>å¯¹äºé‚£äº›å‹åˆ«æˆ–å¯¹äºç§»åŠ¨è¯­ä¹‰çš„æ”¯æŒæƒ…å†µå·²çŸ¥çš„ä»£ç ï¼Œåˆ™æ— éœ€ä½œä»¥ä¸Šå‡å®šã€‚</li></ol><h3 id="30-ç†Ÿæ‚‰å®Œç¾è½¬å‘çš„å¤±è´¥æƒ…å½¢"><a href="#30-ç†Ÿæ‚‰å®Œç¾è½¬å‘çš„å¤±è´¥æƒ…å½¢" class="headerlink" title="30. ç†Ÿæ‚‰å®Œç¾è½¬å‘çš„å¤±è´¥æƒ…å½¢"></a>30. ç†Ÿæ‚‰å®Œç¾è½¬å‘çš„å¤±è´¥æƒ…å½¢</h3><ol><li>å®Œç¾è½¬å‘çš„å¤±è´¥æƒ…å½¢ï¼Œæ˜¯æºäºæ¨¡æ¿å‹åˆ«æ¨å¯¼å¤±è´¥ï¼Œæˆ–æ¨å¯¼ç»“æœæ˜¯é”™è¯¯çš„å‹åˆ«ã€‚</li><li>ä¼šå¯¼è‡´å®Œç¾è½¬å‘å¤±è´¥çš„å®å‚ç§ç±»æœ‰å¤§æ‹¬å·åˆå§‹åŒ–ç‰©ã€ä»¥å€¼0æˆ–NULLè¡¨è¾¾çš„ç©ºæŒ‡é’ˆã€ä»…æœ‰å£°æ˜çš„æ•´å‹static constæˆå‘˜å˜é‡ã€æ¨¡æ¿æˆ–é‡è½½çš„å‡½æ•°åå­—ï¼Œä»¥åŠä½åŸŸã€‚</li></ol><h2 id="å…­ã€lambdaè¡¨è¾¾å¼"><a href="#å…­ã€lambdaè¡¨è¾¾å¼" class="headerlink" title="å…­ã€lambdaè¡¨è¾¾å¼"></a>å…­ã€lambdaè¡¨è¾¾å¼</h2><h3 id="31-é¿å…é»˜è®¤æ•è·æ¨¡å¼"><a href="#31-é¿å…é»˜è®¤æ•è·æ¨¡å¼" class="headerlink" title="31. é¿å…é»˜è®¤æ•è·æ¨¡å¼"></a>31. é¿å…é»˜è®¤æ•è·æ¨¡å¼</h3><ol><li>æŒ‰å¼•ç”¨çš„é»˜è®¤æ•è·ä¼šå¯¼è‡´ç©ºæ‚¬æŒ‡é’ˆé—®é¢˜ã€‚</li><li>æŒ‰å€¼çš„é»˜è®¤æ•è·ææ˜“å—ç©ºæ‚¬æŒ‡é’ˆå½±å“ï¼ˆå°¤å…¶æ˜¯thisï¼‰ï¼Œå¹¶ä¼šè¯¯å¯¼äººä»¬è®¤ä¸ºlambdaå¼æ˜¯è‡ªæ´½çš„ã€‚</li></ol><h3 id="32-ä½¿ç”¨åˆå§‹åŒ–æ•è·å°†å¯¹è±¡ç§»å…¥é—­åŒ…"><a href="#32-ä½¿ç”¨åˆå§‹åŒ–æ•è·å°†å¯¹è±¡ç§»å…¥é—­åŒ…" class="headerlink" title="32. ä½¿ç”¨åˆå§‹åŒ–æ•è·å°†å¯¹è±¡ç§»å…¥é—­åŒ…"></a>32. ä½¿ç”¨åˆå§‹åŒ–æ•è·å°†å¯¹è±¡ç§»å…¥é—­åŒ…</h3><ol><li>ä½¿ç”¨C++14çš„åˆå§‹åŒ–æ•è·å°†å¯¹è±¡ç§»å…¥é—­åŒ…ã€‚</li><li>åœ¨C++11ä¸­ï¼Œç»ç”±æ‰‹å·¥å®ç°çš„ç±»æˆ–std::bindå»æ¨¡æ‹Ÿåˆå§‹åŒ–æ•è·ã€‚</li></ol><h3 id="33-å¯¹auto-amp-amp-å‹åˆ«çš„å½¢å‚ä½¿ç”¨decltypeï¼Œä»¥std-forwardä¹‹"><a href="#33-å¯¹auto-amp-amp-å‹åˆ«çš„å½¢å‚ä½¿ç”¨decltypeï¼Œä»¥std-forwardä¹‹" class="headerlink" title="33. å¯¹auto&amp;&amp;å‹åˆ«çš„å½¢å‚ä½¿ç”¨decltypeï¼Œä»¥std::forwardä¹‹"></a>33. å¯¹auto&amp;&amp;å‹åˆ«çš„å½¢å‚ä½¿ç”¨decltypeï¼Œä»¥std::forwardä¹‹</h3><ol><li><p>å¯¹auto&amp;&amp;å‹åˆ«çš„å½¢å‚ä½¿ç”¨decltypeï¼Œä»¥std::forwardä¹‹ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token function">normalize</span><span class="token punctuation">(</span>std<span class="token operator">::</span>forward<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="34-ä¼˜å…ˆé€‰ç”¨lambdaå¼ï¼Œè€Œéstd-bind"><a href="#34-ä¼˜å…ˆé€‰ç”¨lambdaå¼ï¼Œè€Œéstd-bind" class="headerlink" title="34. ä¼˜å…ˆé€‰ç”¨lambdaå¼ï¼Œè€Œéstd::bind"></a>34. ä¼˜å…ˆé€‰ç”¨lambdaå¼ï¼Œè€Œéstd::bind</h3><ol><li>lambdaå¼æ¯”èµ·ä½¿ç”¨std::bindè€Œè¨€ï¼Œå¯è¯»æ€§æ›´å¥½ã€è¡¨è¾¾åŠ›æ›´å¼ºï¼Œå¯èƒ½è¿è¡Œæ•ˆç‡ä¹Ÿæ›´é«˜ã€‚</li><li>ä»…åœ¨C++11ä¸­ï¼Œstd::bindåœ¨å®ç°ç§»åŠ¨æ•è·ï¼Œæˆ–æ˜¯ç»‘å®šåˆ°å…·å¤‡æ¨¡æ¿åŒ–çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦çš„å¯¹è±¡çš„åœºåˆä¸­ï¼Œå¯èƒ½å°šæœ‰ä½™çƒ­å¯ä»¥å‘æŒ¥ã€‚</li></ol><h2 id="ä¸ƒã€å¹¶å‘API"><a href="#ä¸ƒã€å¹¶å‘API" class="headerlink" title="ä¸ƒã€å¹¶å‘API"></a>ä¸ƒã€å¹¶å‘API</h2><h3 id="35-ä¼˜å…ˆé€‰ç”¨åŸºäºä»»åŠ¡è€ŒéåŸºäºçº¿ç¨‹çš„ç¨‹åºè®¾è®¡"><a href="#35-ä¼˜å…ˆé€‰ç”¨åŸºäºä»»åŠ¡è€ŒéåŸºäºçº¿ç¨‹çš„ç¨‹åºè®¾è®¡" class="headerlink" title="35. ä¼˜å…ˆé€‰ç”¨åŸºäºä»»åŠ¡è€ŒéåŸºäºçº¿ç¨‹çš„ç¨‹åºè®¾è®¡"></a>35. ä¼˜å…ˆé€‰ç”¨åŸºäºä»»åŠ¡è€ŒéåŸºäºçº¿ç¨‹çš„ç¨‹åºè®¾è®¡</h3><ol><li>std::threadçš„APIæœªæä¾›ç›´æ¥è·å–å¼‚æ­¥è¿è¡Œå‡½æ•°è¿”å›å€¼çš„é€”å¾„ï¼Œè€Œä¸”å¦‚æœé‚£äº›å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºå°±ä¼šç»ˆæ­¢ã€‚</li><li>åŸºäºçº¿ç¨‹çš„ç¨‹åºè®¾è®¡è¦æ±‚æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹è€—å°½ã€è¶…è®¢ã€è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠæ–°å¹³å°é€‚é…ã€‚</li><li>ç»ç”±åº”ç”¨äº†é»˜è®¤å¯åŠ¨ç­–ç•¥çš„std::asyncè¿›è¡ŒåŸºäºä»»åŠ¡çš„ç¨‹åºè®¾è®¡ï¼Œå¤§éƒ¨åˆ†è¿™ç±»é—®é¢˜éƒ½èƒ½æ‰¾åˆ°è§£å†³çŸ¥é“ã€‚</li></ol><h3 id="36-å¦‚æœå¼‚æ­¥æ˜¯å¿…è¦çš„ï¼Œåˆ™æŒ‡å®šstd-launch-async"><a href="#36-å¦‚æœå¼‚æ­¥æ˜¯å¿…è¦çš„ï¼Œåˆ™æŒ‡å®šstd-launch-async" class="headerlink" title="36. å¦‚æœå¼‚æ­¥æ˜¯å¿…è¦çš„ï¼Œåˆ™æŒ‡å®šstd::launch::async"></a>36. å¦‚æœå¼‚æ­¥æ˜¯å¿…è¦çš„ï¼Œåˆ™æŒ‡å®šstd::launch::async</h3><ol><li>std::asyncçš„é»˜è®¤å¯åŠ¨ç­–ç•¥æ—¢å…è®¸ä»»åŠ¡å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼Œä¹Ÿå…è®¸ä»»åŠ¡ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œã€‚</li><li>å¦‚æ­¤çš„å¼¹æ€§ä¼šå¯¼è‡´ä½¿ç”¨thread_localå˜é‡æ—¶çš„ä¸ç¡®å®šæ€§ï¼Œéšå«ç€ä»»åŠ¡å¯èƒ½æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œè¿˜ä¼šå½±å“è¿ç”¨äº†åŸºäºè¶…æ—¶çš„waitè°ƒç”¨çš„ç¨‹åºé€»è¾‘ã€‚</li><li>å¦‚æœå¼‚æ­¥æ˜¯å¿…è¦çš„ï¼Œåˆ™æŒ‡å®šstd::launch::asyncã€‚</li></ol><h3 id="37-ä½¿std-threadå‹åˆ«å¯¹è±¡åœ¨æ‰€æœ‰è·¯å¾„çš†ä¸å¯è”ç»“ï¼ˆunjoinableï¼‰"><a href="#37-ä½¿std-threadå‹åˆ«å¯¹è±¡åœ¨æ‰€æœ‰è·¯å¾„çš†ä¸å¯è”ç»“ï¼ˆunjoinableï¼‰" class="headerlink" title="37. ä½¿std::threadå‹åˆ«å¯¹è±¡åœ¨æ‰€æœ‰è·¯å¾„çš†ä¸å¯è”ç»“ï¼ˆunjoinableï¼‰"></a>37. ä½¿std::threadå‹åˆ«å¯¹è±¡åœ¨æ‰€æœ‰è·¯å¾„çš†ä¸å¯è”ç»“ï¼ˆunjoinableï¼‰</h3><ol><li>ä½¿std::threadå‹åˆ«å¯¹è±¡åœ¨æ‰€æœ‰è·¯å¾„çš†ä¸å¯è”ç»“ã€‚</li><li>åœ¨ææ„æ—¶è°ƒç”¨joinå¯èƒ½å¯¼è‡´éš¾ä»¥è°ƒè¯•çš„æ€§èƒ½å¼‚å¸¸ã€‚</li><li>åœ¨ææ„æ—¶è°ƒç”¨detachå¯èƒ½å¯¼è‡´éš¾ä»¥è°ƒè¯•çš„æœªå®šä¹‰è¡Œä¸ºã€‚</li><li>åœ¨æˆå‘˜åˆ—è¡¨çš„æœ€åå£°æ˜std::threadå‹åˆ«å¯¹è±¡ã€‚</li></ol><h4 id="ä¸å¯è”ç»“çš„std-threadå‹åˆ«å¯¹è±¡"><a href="#ä¸å¯è”ç»“çš„std-threadå‹åˆ«å¯¹è±¡" class="headerlink" title="ä¸å¯è”ç»“çš„std::threadå‹åˆ«å¯¹è±¡"></a>ä¸å¯è”ç»“çš„std::threadå‹åˆ«å¯¹è±¡</h4><ol><li><strong>é»˜è®¤æ„é€ çš„std::threadã€‚</strong> æ­¤ç±»std::threadæ²¡æœ‰å¯ä»¥æ‰§è¡Œçš„å‡½æ•°ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰å¯¹åº”çš„åº•å±‚æ‰§è¡Œçº¿ç¨‹ã€‚</li><li><strong>å·²ç§»åŠ¨çš„std::threadã€‚</strong> ç§»åŠ¨æ“ä½œçš„ç»“æœæ˜¯ï¼Œä¸€ä¸ªstd::threadæ‰€å¯¹åº”çš„åº•å±‚æ‰§è¡Œçº¿ç¨‹ï¼ˆè‹¥æœ‰ï¼‰è¢«å¯¹åº”åˆ°å¦ä¸€ä¸ªstd::threadã€‚</li><li><strong>å·²è”ç»“çš„std::threadã€‚</strong> è”ç»“åï¼Œstd::threadå‹åˆ«å¯¹è±¡ä¸åœ¨å¯¹åº”è‡³å·²ç»“æŸè¿è¡Œçš„åº•å±‚æ‰§è¡Œçº¿ç¨‹ã€‚</li><li><strong>å·²åˆ†ç¦»çš„std::threadã€‚</strong> åˆ†ç¦»æ“ä½œä¼šæŠŠstd::threadå‹åˆ«å¯¹è±¡å’Œå®ƒå¯¹åº”çš„åº•å±‚æ‰§è¡Œçº¿ç¨‹ä¹‹é—´çš„è¿æ¥æ–­å¼€ã€‚</li></ol><h4 id="å…³äºæ¡æ¬¾37çš„è¡¥å……è¯´æ˜"><a href="#å…³äºæ¡æ¬¾37çš„è¡¥å……è¯´æ˜" class="headerlink" title="å…³äºæ¡æ¬¾37çš„è¡¥å……è¯´æ˜"></a>å…³äºæ¡æ¬¾37çš„è¡¥å……è¯´æ˜</h4><ul><li>å¦‚æœå¯è”ç»“çº¿ç¨‹å¯¹è±¡çš„ææ„å‡½æ•°è¢«è°ƒç”¨ï¼Œåˆ™ç¨‹åºçš„æ‰§è¡Œå°±ç»ˆæ­¢äº†ã€‚</li></ul><h3 id="38-å¯¹å˜åŒ–å¤šç«¯çš„çº¿ç¨‹å¥æŸ„ææ„å‡½æ•°è¡Œä¸ºä¿æŒå…³æ³¨"><a href="#38-å¯¹å˜åŒ–å¤šç«¯çš„çº¿ç¨‹å¥æŸ„ææ„å‡½æ•°è¡Œä¸ºä¿æŒå…³æ³¨" class="headerlink" title="38. å¯¹å˜åŒ–å¤šç«¯çš„çº¿ç¨‹å¥æŸ„ææ„å‡½æ•°è¡Œä¸ºä¿æŒå…³æ³¨"></a>38. å¯¹å˜åŒ–å¤šç«¯çš„çº¿ç¨‹å¥æŸ„ææ„å‡½æ•°è¡Œä¸ºä¿æŒå…³æ³¨</h3><ol><li>æœŸå€¼ï¼ˆstd::future/std::shared_futureï¼‰çš„ææ„å‡½æ•°åœ¨å¸¸è§„æƒ…å†µä¸‹ï¼Œä»…ä¼šææ„æœŸå€¼çš„æˆå‘˜å˜é‡ã€‚</li><li>æŒ‡æ¶‰åˆ°ç»ç”±std::asyncå¯åŠ¨çš„æœªæ¨è¿Ÿä»»åŠ¡çš„å…±äº«çŠ¶æ€çš„æœ€åä¸€ä¸ªæœŸå€¼ä¼šä¿æŒé˜»å¡ï¼Œç›´è‡³è¯¥ä»»åŠ¡ç»“æŸã€‚</li></ol><h3 id="39-è€ƒè™‘é’ˆå¯¹ä¸€æ¬¡æ€§äº‹ä»¶é€šä¿¡ä½¿ç”¨ä»¥voidä¸ºæ¨¡æ¿å‹åˆ«å®å‚çš„æœŸå€¼"><a href="#39-è€ƒè™‘é’ˆå¯¹ä¸€æ¬¡æ€§äº‹ä»¶é€šä¿¡ä½¿ç”¨ä»¥voidä¸ºæ¨¡æ¿å‹åˆ«å®å‚çš„æœŸå€¼" class="headerlink" title="39. è€ƒè™‘é’ˆå¯¹ä¸€æ¬¡æ€§äº‹ä»¶é€šä¿¡ä½¿ç”¨ä»¥voidä¸ºæ¨¡æ¿å‹åˆ«å®å‚çš„æœŸå€¼"></a>39. è€ƒè™‘é’ˆå¯¹ä¸€æ¬¡æ€§äº‹ä»¶é€šä¿¡ä½¿ç”¨ä»¥voidä¸ºæ¨¡æ¿å‹åˆ«å®å‚çš„æœŸå€¼</h3><ol><li>å¦‚æœä»…ä¸ºäº†å®ç°å¹³å‡¡äº‹ä»¶é€šä¿¡ï¼ŒåŸºäºæ¡ä»¶å˜é‡çš„è®¾è®¡ä¼šè¦æ±‚å¤šä½™çš„äº’æ–¥é‡ï¼Œè¿™ä¼šç»™ç›¸äº’å…³è”çš„æ£€æµ‹å’Œååº”ä»»åŠ¡å¸¦æ¥çº¦æŸï¼Œå¹¶è¦æ±‚ååº”ä»»åŠ¡æ ¡éªŒäº‹ä»¶ç¡®å·²å‘ç”Ÿã€‚</li><li>ä½¿ç”¨æ ‡å¿—ä½çš„è®¾è®¡å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ï¼Œä½†è¿™ä¸€è®¾è®¡åŸºäºè½®è®­è€Œéé˜»å¡ã€‚</li><li>æ¡ä»¶å˜é‡å’Œæ ‡å¿—ä½å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œä½†è¿™æ ·çš„é€šä¿¡æœºåˆ¶è®¾è®¡ç»“æœä¸ç”šè‡ªç„¶ã€‚</li><li>ä½¿ç”¨std::promiseå‹åˆ«å¯¹è±¡å’ŒæœŸå€¼å°±å¯ä»¥å›é¿è¿™äº›é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ¥è¿™ä¸ªé€”å¾„ä¸ºäº†å…±äº«çŠ¶æ€éœ€è¦ä½¿ç”¨å †å†…å­˜ï¼Œè€Œä¸”ä»…é™äºä¸€æ¬¡æ€§é€šä¿¡ã€‚</li></ol><h3 id="40-å¯¹å¹¶å‘ä½¿ç”¨std-atomicï¼Œå¯¹ç‰¹ç§å†…å­˜ä½¿ç”¨volatile"><a href="#40-å¯¹å¹¶å‘ä½¿ç”¨std-atomicï¼Œå¯¹ç‰¹ç§å†…å­˜ä½¿ç”¨volatile" class="headerlink" title="40. å¯¹å¹¶å‘ä½¿ç”¨std::atomicï¼Œå¯¹ç‰¹ç§å†…å­˜ä½¿ç”¨volatile"></a>40. å¯¹å¹¶å‘ä½¿ç”¨std::atomicï¼Œå¯¹ç‰¹ç§å†…å­˜ä½¿ç”¨volatile</h3><ol><li>std::atomicç”¨äºå¤šçº¿ç¨‹è®¿é—®çš„æ•°æ®ï¼Œä¸”ä¸ç”¨äº’æ–¥é‡ã€‚å®ƒæ˜¯æ’°å†™å¹¶å‘è½¯ä»¶çš„å·¥å…·ã€‚</li><li><p>volatileç”¨äºè¯»å†™æ“ä½œä¸å¯ä»¥è¢«ä¼˜åŒ–æ‰çš„å†…å­˜ã€‚å®ƒæ˜¯åœ¨é¢å¯¹ç‰¹ç§å†…å­˜æ—¶ä½¿ç”¨çš„å·¥å…·ã€‚</p><p> ç»™yåŠ ä¸Švolatileå¯ä»¥é¿å…ç¼–è¯‘å™¨å°†ä»£ç ï¼š</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token operator">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">y</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>y<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> ä¼˜åŒ–æˆï¼š</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">register</span> <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>std<span class="token operator">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token keyword">register</span><span class="token punctuation">)</span><span class="token punctuation">;</span>y<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">register</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="å…«ã€å¾®è°ƒ"><a href="#å…«ã€å¾®è°ƒ" class="headerlink" title="å…«ã€å¾®è°ƒ"></a>å…«ã€å¾®è°ƒ</h2><h3 id="41-é’ˆå¯¹å¯å¤åˆ¶çš„å½¢å‚ï¼Œåœ¨ç§»åŠ¨æˆæœ¬ä½å¹¶ä¸”ä¸€å®šä¼šè¢«å¤åˆ¶çš„å‰æä¸‹ï¼Œè€ƒè™‘å°†å…¶æŒ‰å€¼ä¼ é€’"><a href="#41-é’ˆå¯¹å¯å¤åˆ¶çš„å½¢å‚ï¼Œåœ¨ç§»åŠ¨æˆæœ¬ä½å¹¶ä¸”ä¸€å®šä¼šè¢«å¤åˆ¶çš„å‰æä¸‹ï¼Œè€ƒè™‘å°†å…¶æŒ‰å€¼ä¼ é€’" class="headerlink" title="41. é’ˆå¯¹å¯å¤åˆ¶çš„å½¢å‚ï¼Œåœ¨ç§»åŠ¨æˆæœ¬ä½å¹¶ä¸”ä¸€å®šä¼šè¢«å¤åˆ¶çš„å‰æä¸‹ï¼Œè€ƒè™‘å°†å…¶æŒ‰å€¼ä¼ é€’"></a>41. é’ˆå¯¹å¯å¤åˆ¶çš„å½¢å‚ï¼Œåœ¨ç§»åŠ¨æˆæœ¬ä½å¹¶ä¸”ä¸€å®šä¼šè¢«å¤åˆ¶çš„å‰æä¸‹ï¼Œè€ƒè™‘å°†å…¶æŒ‰å€¼ä¼ é€’</h3><ol><li>å¯¹äºå¯å¤åˆ¶çš„ã€åœ¨ç§»åŠ¨æˆæœ¬ä½å»‰çš„å¹¶ä¸”ä¸€å®šä¼šè¢«å¤åˆ¶çš„å½¢å‚è€Œè¨€ï¼ŒæŒ‰å€¼ä¼ é€’å¯èƒ½ä¼šå’ŒæŒ‰å¼•ç”¨ä¼ é€’çš„å…·å¤‡ç›¸è¿‘çš„æ•ˆç‡ï¼Œå¹¶ä¸”å¯èƒ½ç”Ÿæˆæ›´å°‘é‡çš„ç›®æ ‡ä»£ç ã€‚</li><li>ç»ç”±æ„é€ å¤åˆ¶å½¢å‚çš„æˆæœ¬å¯èƒ½æ¯”ç»ç”±èµ‹å€¼å¤åˆ¶å½¢å‚é«˜å‡ºå¾ˆå¤šã€‚</li><li>æŒ‰å€¼ä¼ é€’è‚¯å®šä¼šå¯¼è‡´åˆ‡ç‰‡é—®é¢˜ï¼Œæ‰€ä»¥åŸºç±»å‹åˆ«ç‰¹åˆ«ä¸é€‚ç”¨äºæŒ‰å€¼ä¼ é€’ã€‚</li></ol><h3 id="42-è€ƒè™‘ç½®å…¥è€Œéæ’å…¥"><a href="#42-è€ƒè™‘ç½®å…¥è€Œéæ’å…¥" class="headerlink" title="42. è€ƒè™‘ç½®å…¥è€Œéæ’å…¥"></a>42. è€ƒè™‘ç½®å…¥è€Œéæ’å…¥</h3><ol><li>ä»åŸç†ä¸Šè¯´ï¼Œç½®å…¥å‡½æ•°ï¼ˆå¦‚ï¼šemplace_backï¼‰åº”è¯¥æœ‰æ—¶æ¯”å¯¹åº”çš„æ’å…¥å‡½æ•°ï¼ˆå¦‚ï¼špush_backï¼‰é«˜æ•ˆï¼Œè€Œä¸”ä¸åº”è¯¥æœ‰æ›´ä½æ•ˆçš„å¯èƒ½ã€‚</li><li>ä»å®è·µä¸Šè¯´ï¼Œç½®å…¥å‡½æ•°åœ¨ä»¥ä¸‹å‡ ä¸ªå‰ææˆç«‹æ—¶ï¼Œææœ‰å¯èƒ½ä¼šè¿è¡Œå¾—æ›´å¿«ï¼šï¼ˆ1ï¼‰å¾…æ·»åŠ çš„å€¼æ˜¯ä»¥æ„é€ è€Œéèµ‹å€¼æ–¹å¼åŠ å…¥å®¹å™¨ï¼›ï¼ˆ2ï¼‰ä¼ é€’çš„å®å‚å‹åˆ«ä¸å®¹å™¨æŒæœ‰ä¹‹ç‰©çš„å‹åˆ«ä¸åŒï¼›ï¼ˆ3ï¼‰å®¹å™¨ä¸ä¼šç”±äºå­˜åœ¨é‡å¤å€¼è€Œæ‹’ç»å¾…æ·»åŠ çš„å€¼ã€‚</li><li><p>ç½®å…¥å‡½æ•°å¯èƒ½ä¼šæ‰§è¡Œåœ¨æ’å…¥å‡½æ•°ä¸­ä¼šè¢«æ‹’ç»çš„å‹åˆ«è½¬æ¢ã€‚</p><p> å¤åˆ¶åˆå§‹åŒ–æ˜¯ä¸å…è®¸è°ƒç”¨å¸¦æœ‰explicitå£°æ˜é¥°è¯çš„æ„é€ å‡½æ•°çš„ï¼Œä½†ç›´æ¥åˆå§‹åŒ–å°±å…è®¸ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token operator">::</span>regex r1 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>    <span class="token comment">// é”™è¯¯ï¼æ— æ³•é€šè¿‡ç¼–è¯‘ ï¼ˆå¤åˆ¶åˆå§‹åŒ–ï¼‰</span>std<span class="token operator">::</span>regex <span class="token function">r2</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// èƒ½ç¼–è¯‘ ï¼ˆç›´æ¥åˆå§‹åŒ–ï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ</title>
      <link href="tcp-mo-xing-xie-yi-zhuang-tai-ji-su-lan/"/>
      <url>tcp-mo-xing-xie-yi-zhuang-tai-ji-su-lan/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€OSI-æ¨¡å‹"><a href="#ä¸€ã€OSI-æ¨¡å‹" class="headerlink" title="ä¸€ã€OSI æ¨¡å‹"></a>ä¸€ã€OSI æ¨¡å‹</h2><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„.png" alt="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"></p><div class="table-container"><table><thead><tr><th>åå­—</th><th>åŠŸèƒ½</th><th>æ•°æ®åŒ…å</th><th>å¸¸ç”¨åè®®åŠè®¾å¤‡</th></tr></thead><tbody><tr><td>åº”ç”¨å±‚</td><td>ä¸ºåº”ç”¨è¿›ç¨‹æä¾›æœåŠ¡</td><td></td><td>HTTPã€FTPã€TELNETã€DNSã€BTã€NTPã€DHCPã€SNMP</td></tr><tr><td>è¡¨ç¤ºå±‚</td><td>æä¾›æ•°æ®æ ¼å¼è½¬æ¢æœåŠ¡</td><td></td><td>JPEGã€MPEGã€ASCll</td></tr><tr><td>ä¼šè¯å±‚</td><td>å»ºç«‹ç«¯è¿æ¥å¹¶æä¾›è®¿é—®éªŒè¯å’Œä¼šè¯ç®¡ç†</td><td></td><td>SSLã€TLSã€NFSã€SQLã€NETBIOSã€RPC</td></tr><tr><td>ä¼ è¾“å±‚</td><td>å‘ä¸¤ä¸ªä¸»æœºä¸­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›æœåŠ¡</td><td>æ®µ Segment</td><td>TCPã€UDPã€SPX</td></tr><tr><td>ç½‘ç»œå±‚</td><td>å®ç°ä¸¤ä¸ªç«¯ç³»ç»Ÿä¹‹é—´çš„æ•°æ®é€æ˜ä¼ é€</td><td>åŒ… Packet</td><td>IPã€ICMPã€ARPã€RARPã€OSPFã€IPXã€RIPã€IGRPï¼›è·¯ç”±å™¨</td></tr><tr><td>æ•°æ®é“¾è·¯å±‚</td><td>åœ¨ä¸å¯é çš„ç‰©ç†çº¿è·¯ä¸Šè¿›è¡Œæ•°æ®çš„å¯é ä¼ è¾“</td><td>å¸§ Frame</td><td>PPPã€Ethernetï¼›ç½‘æ¡¥ã€äº¤æ¢æœº</td></tr><tr><td>ç‰©ç†å±‚</td><td>å®Œæˆç›¸é‚»ç»“ç‚¹ä¹‹é—´åŸå§‹æ¯”ç‰¹æµä¼ è¾“</td><td>æ¯”ç‰¹ Bit</td><td>RJ45ã€ç½‘çº¿ã€ä¸­ç»§å™¨ã€é›†çº¿å™¨</td></tr></tbody></table></div><blockquote><p>å‚è€ƒï¼š<a href="http://www.colasoft.com.cn/download/protocols_map.php">ç½‘ç»œé€šè®¯åè®®å›¾</a></p></blockquote><h3 id="1-1-ç‰©ç†å±‚"><a href="#1-1-ç‰©ç†å±‚" class="headerlink" title="1.1 ç‰©ç†å±‚"></a>1.1 ç‰©ç†å±‚</h3><p>å¯ç”¨ä¸€æ ¹ç½‘çº¿ï¼ˆ1ï¼3ã€2ï¼6 äº¤å‰æ¥æ³•ï¼‰ç›´è¿ä¸¤å°ç”µè„‘ç»„æˆä¸€ä¸ªæœ€å°çš„å±€åŸŸç½‘ã€‚</p><p>é€šè¿‡ç½‘çº¿ä¸Šç”µå¹³çš„é«˜ä½æ¥ä¼ é€’ä¿¡æ¯ï¼Œä»¥å¤ªç½‘ä½¿ç”¨ <strong><a href="https://zh.wikipedia.org/wiki/%E6%9B%BC%E5%BD%BB%E6%96%AF%E7%89%B9%E7%BC%96%E7%A0%81">æ›¼å½»æ–¯ç‰¹ç¼–ç ï¼ˆManchester codingï¼‰</a></strong> æ¥ç¼–ç ä¿¡æ¯ã€‚</p><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/æ›¼å½»æ–¯ç‰¹ç¼–ç .png" alt="æ›¼å½»æ–¯ç‰¹ç¼–ç "></p><p>ç›¸å…³è®¾å¤‡ï¼š</p><ul><li><a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E7%BB%A7%E5%99%A8">ä¸­ç»§å™¨ï¼ˆRepeaterï¼‰</a>å°†æ”¶åˆ°ä¿¡å·åŠ å¼ºå¹¶é‡æ–°å‘é€å‡ºå»ä»¥å¢åŠ ä¿¡å·çš„ä¼ è¾“è®°å½•ã€‚</li><li><a href="https://zh.wikipedia.org/wiki/%E9%9B%86%E7%B7%9A%E5%99%A8">é›†çº¿å™¨ï¼ˆHubï¼‰</a>å°†ä¸€ä¸ªç½‘å£ä¸Šæ”¶åˆ°çš„æ¯ä¸€ä¸ª <strong>æ¯”ç‰¹ï¼ˆBitï¼‰</strong>ï¼Œéƒ½å¤åˆ¶åˆ°å…¶ä»–ç½‘å£ä¸Šã€‚</li></ul><h3 id="1-2-æ•°æ®é“¾è·¯å±‚"><a href="#1-2-æ•°æ®é“¾è·¯å±‚" class="headerlink" title="1.2 æ•°æ®é“¾è·¯å±‚"></a>1.2 æ•°æ®é“¾è·¯å±‚</h3><p><strong><a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82">æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰</a></strong> å¯ç»†åˆ†æˆï¼š</p><ul><li><strong><a href="https://zh.wikipedia.org/wiki/%E4%BB%8B%E8%B4%A8%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6">åª’ä½“è®¿é—®æ§åˆ¶ï¼ˆMedium Access Controlï¼ŒMACï¼‰</a></strong> å­å±‚ï¼šä¸“èŒå¤„ç†ä»‹è´¨è®¿é—®çš„äº‰ç”¨ä¸å†²çªé—®é¢˜ï¼›</li><li><strong><a href="https://zh.wikipedia.org/wiki/%E9%80%BB%E8%BE%91%E9%93%BE%E8%B7%AF%E6%8E%A7%E5%88%B6">é€»è¾‘é“¾è·¯æ§åˆ¶ï¼ˆLogical Link Controlï¼ŒLLCï¼‰</a></strong> å­å±‚ï¼šå±è”½å„ç§ MAC çš„å·®åˆ«å¹¶ä¸ºç½‘ç»œå±‚æä¾›ç»Ÿä¸€çš„æ•°æ®é“¾è·¯æœåŠ¡ã€‚</li></ul><p>ä»¥ä»¥å¤ªç½‘ä¸ºä¾‹ï¼Œé€šè¿‡ç½‘çº¿è¿æ¥åœ¨ä¸€èµ·çš„è®¾å¤‡ï¼Œåœ¨å‘é€åŒ…ä¹‹å‰éœ€è¦å…ˆè§£å†³å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li><p>è°å…ˆå‘ã€è°åå‘ï¼Ÿ</p><p> è¿™ä¸ªç”±è§„åˆ™ï¼ˆå­¦åï¼š<strong>å¤šè·¯è®¿é—®</strong>ï¼‰æ§åˆ¶ã€‚ä»¥å¼€è½¦ä¸ºä¾‹ï¼Œå¸¸è§çš„æœ‰ï¼š</p><ul><li>ä¿¡é“åˆ’åˆ†ï¼šåˆ†å¤šä¸ªè½¦é“ï¼Œæ¯ä¸ªè½¦ä¸€ä¸ªè½¦é“ï¼›</li><li>è½®æµåè®®ï¼šå•åŒå·å‡ºè¡Œï¼Œè½®ç€æ¥ï¼›</li><li><a href="https://zh.wikipedia.org/wiki/%E8%BD%BD%E6%B3%A2%E4%BE%A6%E5%90%AC%E5%A4%9A%E8%B7%AF%E8%AE%BF%E9%97%AE">æŒ‰éœ€ä½¿ç”¨</a>ï¼šå…ˆçœ‹çœ‹è·¯ä¸Šæœ‰è½¦æ²¡ï¼Œæ²¡è½¦å°±å‡ºé—¨ï¼Œå¦åˆ™ç­‰ä¸€ä¼šå†çœ‹çœ‹ã€‚<strong>ä»¥å¤ªç½‘ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚</strong></li></ul></li><li><p>åŒ…å‘ç»™è°ã€è°æ¥æ”¶ï¼Ÿ</p><p> æ¯ä¸ªç½‘å¡éƒ½æœ‰ä¸€ä¸ªå…¨çƒå”¯ä¸€çš„ç‰©ç†åœ°å€ï¼Œå« <strong>é“¾è·¯å±‚åœ°å€</strong>ã€‚ä½†å› ä¸ºä¸»è¦ç”¨æ¥è§£å†³åª’ä½“è®¿é—®æ§åˆ¶å±‚çš„é—®é¢˜ï¼Œæ‰€ä»¥å¸¸è¢«ç§°ä¸º <strong><a href="https://zh.wikipedia.org/wiki/MAC%E5%9C%B0%E5%9D%80">MAC åœ°å€</a></strong>ã€‚åœ¨å‘é€æ—¶ï¼Œæºåœ°å€å’Œç›®çš„åœ°å€å¡«çš„éƒ½æ˜¯ MAC åœ°å€ã€‚</p><p> å½“åªçŸ¥é“ç›®æ ‡æœºå™¨çš„ IP åœ°å€ï¼Œè€Œä¸çŸ¥é“ç›®æ ‡æœºå™¨çš„ MAC æ—¶ï¼Œéœ€è¦é€šè¿‡ <strong><a href="https://zh.wikipedia.org/wiki/%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE">åœ°å€è§£æåè®®ï¼ˆAddress Resolution Protocolï¼ŒARPï¼‰</a></strong> æ¥è·å– IP åœ°å€å¯¹åº”çš„ MAC åœ°å€ã€‚</p></li><li><p>å‘é€å‡ºé”™æ€ä¹ˆåŠï¼Ÿ</p><p> å¯¹äºä»¥å¤ªç½‘æ¥è¯´ï¼Œä¼šåœ¨æ¯ä¸ªå‘å‡ºçš„ <strong>å¸§ï¼ˆFrameï¼‰</strong> åé¢åŠ ä¸Š <strong><a href="https://zh.wikipedia.org/wiki/%E5%BE%AA%E7%92%B0%E5%86%97%E9%A4%98%E6%A0%A1%E9%A9%97">å¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCyclic Redundancy Checkï¼ŒCRCï¼‰</a>ç </strong>ï¼Œæ¥åˆ¤æ–­å‘é€æ˜¯å¦å‡ºé”™ï¼Œå¹¶åœ¨å‡ºé”™æ—¶é‡å‘ã€‚</p></li></ol><p>ç›¸å…³è®¾å¤‡ï¼š</p><ul><li><a href="https://zh.wikipedia.org/wiki/%E6%A9%8B%E6%8E%A5%E5%99%A8">ç½‘æ¡¥ï¼ˆNetwork bridgeï¼‰</a>è§£ææ”¶åˆ°çš„å¸§ï¼Œå­¦ä¹ å¹¶è®°å½•æ¯ä¸ªç½‘å£ä¸Šè¿æ¥è®¾å¤‡çš„ MAC åœ°å€ï¼Œå½¢æˆä¸€ä¸ªè½¬å‘è¡¨ã€‚åœ¨è½¬å‘æ—¶å°±åªæŠŠå¸§è½¬å‘åˆ°ä¸å¸§ä¸­ç›®çš„ MAC åœ°å€å¯¹åº”çš„æŸä¸ªç½‘å£ä¸Šã€‚</li><li><a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E4%BA%A4%E6%8F%9B%E5%99%A8">äº¤æ¢æœºï¼ˆSwitchï¼‰</a>æ˜¯ä¸€ç§å¤šç«¯å£çš„ç½‘æ¡¥ã€‚ä¸€ä¸ª N å£äº¤æ¢æœºå¯ä»¥çœ‹æˆæ˜¯ N x (N-1) ä¸ªç½‘æ¡¥çš„é›†åˆã€‚</li></ul><p>ç›¸å…³åè®®ï¼š</p><ul><li><a href="https://zh.wikipedia.org/wiki/%E7%94%9F%E6%88%90%E6%A0%91%E5%8D%8F%E8%AE%AE">ç”Ÿæˆæ ‘åè®®ï¼ˆSpanning Tree Protocolï¼ŒSTPï¼‰</a>é˜²æ­¢äº¤æ¢æœºå†—ä½™é“¾è·¯äº§ç”Ÿçš„ç¯è·¯ï¼Œé¿å…å¹¿æ’­é£æš´å ç”¨äº¤æ¢æœºèµ„æºã€‚åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡ <strong>ç”Ÿæˆæ ‘ç®—æ³•ï¼ˆspanning-tree algorithmï¼ŒSPAï¼‰</strong> åœ¨ç½‘ç»œä¸­æ„å»ºä¸€ä¸ªæ ‘å½¢ç»“æ„çš„é€»è¾‘ç½‘ç»œï¼Œç¡®ä¿åˆ°æ¯ä¸ªç›®æ ‡éƒ½åªæœ‰ä¸€æ¡è·¯å¾„ï¼Œä¸ä¼šäº§ç”Ÿç¯è·¯ã€‚</li><li><a href="https://zh.wikipedia.org/wiki/TRILL">å¤šé“¾æ¥é€æ˜äº’è”åè®®ï¼ˆTransparent Interconnection of Lots of Linkï¼ŒTRILLï¼‰</a>å¤šç”¨äº<a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83">æ•°æ®ä¸­å¿ƒï¼ˆData centerï¼‰</a>ã€‚åŸºæœ¬æ€è·¯æ˜¯æŠŠä¸‰å±‚çš„è·¯ç”±èƒ½åŠ›æ¨¡æ‹Ÿåœ¨äºŒå±‚å®ç°ã€‚è¿è¡Œ TRILL åè®®çš„äº¤æ¢æœºç§°ä¸º RBridgeï¼Œæ˜¯ <strong>å…·æœ‰è·¯ç”±è½¬å‘ç‰¹æ€§çš„ç½‘æ¡¥è®¾å¤‡</strong> ï¼Œåªä¸è¿‡è¿™ä¸ªè·¯ç”±æ˜¯æ ¹æ® MAC åœ°å€æ¥çš„ï¼Œä¸æ˜¯æ ¹æ® IP æ¥çš„ã€‚RBridge ä¹‹é—´é€šè¿‡é“¾è·¯çŠ¶æ€åè®®è¿ä½œã€‚</li></ul><h3 id="1-3-ç½‘ç»œå±‚"><a href="#1-3-ç½‘ç»œå±‚" class="headerlink" title="1.3 ç½‘ç»œå±‚"></a>1.3 ç½‘ç»œå±‚</h3><p>è·¯ç”±å™¨ä¸­çš„è·¯ç”±è¡¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼é…ç½®ï¼šé™æ€è·¯ç”±å’ŒåŠ¨æ€è·¯ç”±ã€‚</p><p>é™æ€è·¯ç”±æŒ‡è·¯ç”±å™¨çš„è·¯ç”±è¡¨ç”±æ‰‹åŠ¨é…ç½®ï¼Œä¸ä¼šæ ¹æ®ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„å˜åŒ–è€Œå˜åŒ–ã€‚</p><p>åŠ¨æ€è·¯ç”±æŒ‡è·¯ç”±å™¨çš„è·¯ç”±è¡¨æ ¹æ®è·¯ç”±åè®®ç®—æ³•ç”Ÿæˆï¼Œéšç½‘ç»œè¿è¡ŒçŠ¶å†µçš„å˜åŒ–è€Œå˜åŒ–ã€‚</p><h4 id="1-3-1-åŠ¨æ€è·¯ç”±ç®—æ³•"><a href="#1-3-1-åŠ¨æ€è·¯ç”±ç®—æ³•" class="headerlink" title="1.3.1 åŠ¨æ€è·¯ç”±ç®—æ³•"></a>1.3.1 åŠ¨æ€è·¯ç”±ç®—æ³•</h4><ol><li><p>è·ç¦»çŸ¢é‡è·¯ç”±ç®—æ³•ï¼ˆDistance Vector Routingï¼‰</p><p> ä¹Ÿç§°ä¸º <a href="https://zh.wikipedia.org/wiki/%E8%B4%9D%E5%B0%94%E6%9B%BC-%E7%A6%8F%E7%89%B9%E7%AE%97%E6%B3%95">Bellman-Ford ç®—æ³•</a>ã€‚åŸºäºè¿™ç±»ç®—æ³•å®ç°çš„åè®®æœ‰ï¼šRIPã€BGP ç­‰ã€‚</p><p> åŸºæœ¬æ€è·¯ï¼šç½‘ç»œä¸­æ¯ä¸ªè·¯ç”±å™¨éƒ½ç»´æŠ¤ä¸€å¼ çŸ¢é‡è¡¨ï¼Œè¿™ä¸ªçŸ¢é‡è¡¨ä¸­æ¯ä¸€è¡Œè®°å½•äº†ä»å½“å‰ä½ç½®èƒ½åˆ°è¾¾çš„ç›®æ ‡è·¯ç”±å™¨çš„æœ€ä½³å‡ºå£ï¼ˆæ¥å£ï¼‰å’Œè·ç¦»ï¼ˆè·³æ•°ï¼‰ã€‚æ¯éš”ä¸€æ®µæ—¶é—´å½“å‰è·¯ç”±å™¨ä¼šå‘æ‰€æœ‰çš„é‚»å±…èŠ‚ç‚¹å‘é€è‡ªå·±çš„è¿™ä¸ªè¡¨ï¼ŒåŒæ—¶å®ƒä¹Ÿä¼šæ¥æ”¶æ¯ä¸ªé‚»å±…å‘æ¥çš„å®ƒä»¬çš„è¡¨ã€‚å¹¶ä¼šå°†é‚»å±…çš„è¡¨å’Œè‡ªå·±çš„è¡¨åšä¸€ä¸ªå¯¹æ¯”æ›´æ–°ã€‚</p><p> ä¼˜ç‚¹ï¼šç®€å•æ˜äº†ï¼ŒåŠ å…¥ç½‘ç»œçš„æ–°èŠ‚ç‚¹èƒ½å¾ˆå¿«çš„ä¸å…¶å®ƒèŠ‚ç‚¹å»ºç«‹èµ·è”ç³»è·å¾—è¡¥å……ä¿¡æ¯ã€‚</p><p> ç¼ºç‚¹ï¼šæ¯æ¬¡å‘é€ä¿¡æ¯çš„æ—¶å€™ï¼Œè¦å‘é€æ•´ä¸ªå…¨å±€è·¯ç”±è¡¨ï¼›æ”¶æ•›æ—¶é—´å¤ªæ…¢ã€‚</p></li><li><p>é“¾è·¯çŠ¶æ€è·¯ç”±ç®—æ³•ï¼ˆLink State Routingï¼‰</p><p> åŸºäº <a href="https://zh.wikipedia.org/wiki/%E6%88%B4%E5%85%8B%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95">Dijkstra ç®—æ³•</a>ï¼Œä»¥å›¾è®ºä½œä¸ºç†è®ºåŸºç¡€ï¼Œç”¨å›¾æ¥è¡¨ç¤ºç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œç”¨å›¾è®ºä¸­çš„æœ€çŸ­è·¯å¾„ç®—æ³•æ¥è®¡ç®—ç½‘ç»œé—´çš„æœ€ä½³è·¯ç”±ã€‚åŸºäºè¿™ç±»ç®—æ³•å®ç°çš„åè®®æœ‰ï¼šOSPF ç­‰ã€‚</p><p> åŸºæœ¬æ€è·¯ï¼šè·¯ç”±å™¨å…ˆå‘ç°ä¸è‡ªå·±ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œç„¶åå°†è‡ªå·±ä¸é‚»å±…èŠ‚ç‚¹ä¹‹é—´çš„é“¾è·¯çŠ¶æ€ä¿¡æ¯å¹¿æ’­åˆ°æ•´ä¸ªç½‘ç»œä¸­ã€‚åŒæ—¶æ”¶é›†ç½‘ç»œä¸­å…¶ä»–è·¯ç”±å™¨å¹¿æ’­æ¥çš„é“¾è·¯çŠ¶æ€ä¿¡æ¯ï¼Œåœ¨æœ¬åœ°æ„å»ºå‡ºä¸€ä¸ªå…¨ç½‘çš„æ‹“æ‰‘å›¾ï¼Œå¹¶æ ¹æ®æ­¤å›¾æ¥è®¡ç®—å½“å‰èŠ‚ç‚¹åˆ°å…¶å®ƒè·¯ç”±å™¨ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œä»è€Œç”Ÿæˆè·¯ç”±è¡¨ã€‚å½“æŸå°è·¯ç”±å™¨ä¸ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„é“¾è·¯çŠ¶æ€å‘ç°å˜åŒ–æ—¶ï¼Œä¾ç„¶é€šè¿‡å¹¿æ’­é€šçŸ¥å…¶ä»–æ‰€æœ‰è·¯ç”±å™¨æ›´æ–°ç½‘ç»œæ‹“è¡¥å›¾å¹¶é‡æ–°è®¡ç®—æœ€çŸ­è·¯å¾„ã€‚</p><p> ä¼˜ç‚¹ï¼šæ›´æ–°ä¿¡æ¯å°ï¼›èƒ½å¿«é€Ÿæ”¶æ•›ã€‚</p></li></ol><h4 id="1-3-2-åŠ¨æ€è·¯ç”±åè®®"><a href="#1-3-2-åŠ¨æ€è·¯ç”±åè®®" class="headerlink" title="1.3.2 åŠ¨æ€è·¯ç”±åè®®"></a>1.3.2 åŠ¨æ€è·¯ç”±åè®®</h4><ol><li><p><a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E6%94%BE%E5%BC%8F%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88">å¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼ˆOpen Shortest Path Firstï¼ŒOSPFï¼‰</a>æ˜¯ä¸€ä¸ªåŸºäºé“¾è·¯çŠ¶æ€è·¯ç”±ç®—æ³•çš„åè®®ï¼Œç”±äºä¸»è¦ç”¨åœ¨<a href="https://zh.wikipedia.org/wiki/%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F">è‡ªæ²»ç³»ç»Ÿï¼ˆAutonomous systemï¼ŒASï¼‰</a>ï¼ˆå¦‚ï¼šæ•°æ®ä¸­å¿ƒï¼‰å†…éƒ¨ï¼Œç”¨äºè·¯ç”±å†³ç­–ï¼Œå› è€Œç§°ä¸º<a href="https://zh.wikipedia.org/wiki/%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE">å†…éƒ¨ç½‘å…³åè®®ï¼ˆInterior Gateway Protocolï¼ŒIGPï¼‰</a>ã€‚æœ‰æ—¶ OSPF å¯ä»¥å‘ç°å¤šä¸ªæœ€çŸ­çš„è·¯å¾„ï¼Œå¯ä»¥åœ¨è¿™äº›è·¯å¾„ä¸­è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œè¿™å¸¸è¢«ç§°ä¸ºç­‰ä»·è·¯ç”±ã€‚</p></li><li><p><a href="https://zh.wikipedia.org/wiki/%E8%BE%B9%E7%95%8C%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE">è¾¹ç•Œç½‘å…³åè®®ï¼ˆBorder Gateway Protocolï¼ŒBGPï¼‰</a>æ˜¯ä¸€ä¸ªåŸºäºè·ç¦»çŸ¢é‡è·¯ç”±ç®—æ³•çš„åè®®ï¼Œä¸»è¦ç”¨åœ¨è‡ªæ²»ç³»ç»Ÿä¹‹é—´ã€‚BGP åˆåˆ†ä¸ºä¸¤ç±»ï¼ŒeBGP å’Œ iBGPã€‚è‡ªæ²»ç³»ç»Ÿé—´ï¼Œè¾¹ç•Œè·¯ç”±å™¨ä¹‹é—´ä½¿ç”¨ eBGP å¹¿æ’­è·¯ç”±ã€‚å†…éƒ¨ç½‘ç»œä¹Ÿéœ€è¦è®¿é—®å…¶ä»–çš„è‡ªæ²»ç³»ç»Ÿï¼Œæ–¹æ³•å°±æ˜¯è¾¹ç•Œè·¯ç”±å™¨é€šè¿‡è¿è¡Œ iBGPï¼Œä½¿å¾—å†…éƒ¨çš„è·¯ç”±å™¨èƒ½å¤Ÿæ‰¾åˆ°åˆ°è¾¾å¤–ç½‘ç›®çš„åœ°çš„æœ€å¥½è¾¹ç•Œè·¯ç”±å™¨ã€‚</p></li></ol><p>ç›¸å…³è®¾å¤‡ï¼š</p><ul><li><a href="https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1%E5%99%A8">è·¯ç”±å™¨ï¼ˆRouterï¼‰</a>ä¸ä»…æ‹¥æœ‰äº¤æ¢æœºçš„åŠŸèƒ½ï¼Œè¿˜èƒ½è§£æç½‘ç»œåœ°å€å¹¶æ ¹æ®è·¯ç”±è¡¨é€‰æ‹©åˆé€‚çš„ IP è·¯å¾„ã€‚</li></ul><h2 id="äºŒã€å¸¸ç”¨åè®®"><a href="#äºŒã€å¸¸ç”¨åè®®" class="headerlink" title="äºŒã€å¸¸ç”¨åè®®"></a>äºŒã€å¸¸ç”¨åè®®</h2><h3 id="2-1-ä»¥å¤ªç½‘åè®®å¤´æ ¼å¼"><a href="#2-1-ä»¥å¤ªç½‘åè®®å¤´æ ¼å¼" class="headerlink" title="2.1 ä»¥å¤ªç½‘åè®®å¤´æ ¼å¼"></a>2.1 ä»¥å¤ªç½‘åè®®å¤´æ ¼å¼</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/ä»¥å¤ªç½‘åè®®å¤´æ ¼å¼.png" alt="ä»¥å¤ªç½‘åè®®å¤´æ ¼å¼"></p><h3 id="2-2-IPv4-åè®®å¤´æ ¼å¼"><a href="#2-2-IPv4-åè®®å¤´æ ¼å¼" class="headerlink" title="2.2 IPv4 åè®®å¤´æ ¼å¼"></a>2.2 IPv4 åè®®å¤´æ ¼å¼</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/IPv4åè®®å¤´æ ¼å¼.png" alt="IPv4åè®®å¤´æ ¼å¼"></p><h3 id="2-3-ICMP-åè®®å¤´æ ¼å¼"><a href="#2-3-ICMP-åè®®å¤´æ ¼å¼" class="headerlink" title="2.3 ICMP åè®®å¤´æ ¼å¼"></a>2.3 ICMP åè®®å¤´æ ¼å¼</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/ICMPåè®®å¤´æ ¼å¼.png" alt="ICMPåè®®å¤´æ ¼å¼"></p><h3 id="2-4-TCP-åè®®å¤´æ ¼å¼"><a href="#2-4-TCP-åè®®å¤´æ ¼å¼" class="headerlink" title="2.4 TCP åè®®å¤´æ ¼å¼"></a>2.4 TCP åè®®å¤´æ ¼å¼</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/TCPåè®®å¤´æ ¼å¼.png" alt="TCPåè®®å¤´æ ¼å¼"></p><h3 id="2-5-UDP-åè®®å¤´æ ¼å¼"><a href="#2-5-UDP-åè®®å¤´æ ¼å¼" class="headerlink" title="2.5 UDP åè®®å¤´æ ¼å¼"></a>2.5 UDP åè®®å¤´æ ¼å¼</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/UDPåè®®å¤´æ ¼å¼.png" alt="UDPåè®®å¤´æ ¼å¼"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="https://nmap.org/book/tcpip-ref.html">TCP/IP Reference</a></p></blockquote><h2 id="ä¸‰ã€TCPçŠ¶æ€æœº"><a href="#ä¸‰ã€TCPçŠ¶æ€æœº" class="headerlink" title="ä¸‰ã€TCPçŠ¶æ€æœº"></a>ä¸‰ã€TCPçŠ¶æ€æœº</h2><h3 id="3-1-å®Œæ•´-TCP-è¿æ¥å’Œæ–­å¼€çŠ¶æ€å›¾"><a href="#3-1-å®Œæ•´-TCP-è¿æ¥å’Œæ–­å¼€çŠ¶æ€å›¾" class="headerlink" title="3.1 å®Œæ•´ TCP è¿æ¥å’Œæ–­å¼€çŠ¶æ€å›¾"></a>3.1 å®Œæ•´ TCP è¿æ¥å’Œæ–­å¼€çŠ¶æ€å›¾</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/å®Œæ•´TCPè¿æ¥å’Œæ–­å¼€çŠ¶æ€å›¾.png" alt="å®Œæ•´TCPè¿æ¥å’Œæ–­å¼€çŠ¶æ€å›¾"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.tcpipguide.com/free/t_TCPOperationalOverviewandtheTCPFiniteStateMachineF-2.htm">TCP Operational Overview and the TCP Finite State Machine (FSM) 2</a></p></blockquote><h3 id="3-2-TCP-æ–­å¼€çŠ¶æ€å›¾"><a href="#3-2-TCP-æ–­å¼€çŠ¶æ€å›¾" class="headerlink" title="3.2 TCP æ–­å¼€çŠ¶æ€å›¾"></a>3.2 TCP æ–­å¼€çŠ¶æ€å›¾</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/TCPæ–­å¼€çŠ¶æ€å›¾.png" alt="TCPæ–­å¼€çŠ¶æ€å›¾"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.tcpipguide.com/free/t_TCPConnectionTermination-2.htm">TCP Connection Termination 2</a></p></blockquote><h3 id="3-3-TCP-åŒæ–¹åŒæ—¶æ–­å¼€çŠ¶æ€å›¾"><a href="#3-3-TCP-åŒæ–¹åŒæ—¶æ–­å¼€çŠ¶æ€å›¾" class="headerlink" title="3.3 TCP åŒæ–¹åŒæ—¶æ–­å¼€çŠ¶æ€å›¾"></a>3.3 TCP åŒæ–¹åŒæ—¶æ–­å¼€çŠ¶æ€å›¾</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/TCPåŒæ–¹åŒæ—¶æ–­å¼€çŠ¶æ€å›¾.png" alt="TCPåŒæ–¹åŒæ—¶æ–­å¼€çŠ¶æ€å›¾"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.tcpipguide.com/free/t_TCPConnectionTermination-4.htm">TCP Connection Termination 4</a></p></blockquote><h3 id="3-4-å®é™…æ“ä½œå’Œæˆªå›¾"><a href="#3-4-å®é™…æ“ä½œå’Œæˆªå›¾" class="headerlink" title="3.4 å®é™…æ“ä½œå’Œæˆªå›¾"></a>3.4 å®é™…æ“ä½œå’Œæˆªå›¾</h3><h4 id="3-4-1-TCP-è¿æ¥å‘é€æ•°æ®æ–­å¼€çš„-Wireshark-æˆªå›¾"><a href="#3-4-1-TCP-è¿æ¥å‘é€æ•°æ®æ–­å¼€çš„-Wireshark-æˆªå›¾" class="headerlink" title="3.4.1 TCP è¿æ¥å‘é€æ•°æ®æ–­å¼€çš„ Wireshark æˆªå›¾"></a>3.4.1 TCP è¿æ¥å‘é€æ•°æ®æ–­å¼€çš„ Wireshark æˆªå›¾</h4><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/TCPè¿æ¥å‘é€æ•°æ®æ–­å¼€çš„Wiresharkæˆªå›¾.png" alt="TCPè¿æ¥å‘é€æ•°æ®æ–­å¼€çš„Wiresharkæˆªå›¾"></p><ul><li><p>è®© Wireshark æ˜¾ç¤ºç»å¯¹çš„ sequence numbers</p><p>  åœ¨èœå•æ ä¾æ¬¡ç‚¹å‡» <code>ç¼–è¾‘</code> -&gt; <code>é¦–é€‰é¡¹</code> -&gt; <code>Protocols</code> -&gt; <code>TCP</code> ä¸­ï¼Œå–æ¶ˆé€‰é¡¹ <code>Relative sequence numbers</code> å‰çš„å¤é€‰æ¡†ã€‚</p></li><li><p>å¦‚ä½•æ˜¾ç¤ºæˆªå›¾çš„ç•Œé¢</p><p>  åœ¨èœå•æ ä¾æ¬¡ç‚¹å‡» <code>ç»Ÿè®¡</code> -&gt; <code>æµé‡å›¾</code>ï¼Œç„¶åç‚¹å‡»å³é”®ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­é€‰æ‹©<code>æ”¾å¤§</code>/<code>ç¼©å°</code>è°ƒæ•´å›¾å½¢ã€‚</p></li></ul><h4 id="3-4-2-ç¯å¢ƒåŠæ“ä½œ"><a href="#3-4-2-ç¯å¢ƒåŠæ“ä½œ" class="headerlink" title="3.4.2 ç¯å¢ƒåŠæ“ä½œ"></a>3.4.2 ç¯å¢ƒåŠæ“ä½œ</h4><p>ä¸¤å°æœºå™¨åˆ†åˆ«æ˜¯ï¼š</p><ul><li>A: 192.168.81.88ï¼ˆWindows 10ï¼‰</li><li>B: 192.168.20.122ï¼ˆCentOS 7.7ï¼‰</li></ul><p>æ“ä½œæ­¥éª¤ï¼š</p><ol><li>B åœ¨ 9999 ç«¯å£ç›‘å¬ TCP è¿æ¥ï¼›</li><li>A è¿æ¥ Bçš„9999 ç«¯å£ï¼›</li><li>A å‘ B å‘é€ 4 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼›</li><li>B å‘ A å‘é€ 4 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼›</li><li>B ä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚</li></ol><h3 id="3-5-å¸¸è§é—®é¢˜"><a href="#3-5-å¸¸è§é—®é¢˜" class="headerlink" title="3.5 å¸¸è§é—®é¢˜"></a>3.5 å¸¸è§é—®é¢˜</h3><h4 id="3-5-1-TIME-WAIT-ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°"><a href="#3-5-1-TIME-WAIT-ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°" class="headerlink" title="3.5.1 TIME_WAIT ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°"></a>3.5.1 TIME_WAIT ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°</h4><p>å¦‚æœå¤„äº TIMEWAIT çŠ¶æ€ï¼Œè¯´æ˜åŒæ–¹å»ºç«‹æˆåŠŸè¿‡è¿æ¥ï¼Œè€Œä¸”å·²ç»å‘é€äº†æœ€åçš„ ACK ä¹‹åï¼Œæ‰ä¼šå¤„äºè¿™ä¸ªçŠ¶æ€ï¼Œè€Œä¸”æ˜¯ä¸»åŠ¨å‘èµ·å…³é—­çš„ä¸€æ–¹å¤„äºè¿™ä¸ªçŠ¶æ€ã€‚</p><p>å…¶æ¬¡ï¼Œå½“æ–­å¼€TCPçš„ä¸»åŠ¨æ–¹æ”¶åˆ°äº†è¢«åŠ¨æ–¹å‘æ¥çš„FINåŒ…å¹¶å›å¤å¯¹åº”çš„ACKåŒ…ç»™è¢«åŠ¨æ–¹åï¼Œä¸»åŠ¨æ–¹å°±è¿›å…¥äº†TIME_WAITçŠ¶æ€ã€‚ç„¶åç­‰å¾…<code>2 * MSL</code>æ—¶é—´ï¼ˆæ­¤æ—¶é—´æ®µå†…å¦‚æœå†æ¬¡æ”¶åˆ°è¢«åŠ¨æ–¹å‘æ¥çš„FINæ¶ˆæ¯ï¼Œè¯´æ˜ä¹‹å‰å›å¤çš„ACKåŒ…ä¸¢å¤±ï¼Œéœ€è¦é‡æ–°å‘é€ç»™è¢«åŠ¨æ–¹ï¼Œå¹¶é‡æ–°å¼€å§‹è®¡æ—¶ï¼‰åï¼Œå†è¿›å…¥CLOSEDçŠ¶æ€ï¼Œæ­¤æ—¶æ‰èƒ½å®Œæˆçš„é‡Šæ”¾ç›¸å…³çš„èµ„æºã€‚</p><p>å¦‚æœå­˜åœ¨å¤§é‡çš„ TIMEWAITï¼Œå¾€å¾€æ˜¯å› ä¸ºçŸ­è¿æ¥å¤ªå¤šï¼Œä¸æ–­çš„åˆ›å»ºè¿æ¥ï¼Œç„¶åé‡Šæ”¾è¿æ¥ï¼Œä»è€Œå¯¼è‡´å¾ˆå¤šè¿æ¥åœ¨è¿™ä¸ªçŠ¶æ€ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— æ³•å‘èµ·æ–°çš„è¿æ¥ã€‚è§£å†³çš„æ–¹å¼å¾€å¾€æ˜¯ï¼š</p><ul><li>æ‰“å¼€ tcp_tw_recycle å’Œ tcp_timestamps é€‰é¡¹ï¼›</li><li>æ‰“å¼€ tcp_tw_reuse å’Œ tcp_timestamps é€‰é¡¹ï¼›</li><li>ç¨‹åºä¸­ä½¿ç”¨ SO_LINGERï¼Œåº”ç”¨å¼ºåˆ¶ä½¿ç”¨ rst å…³é—­ã€‚</li></ul><p>å½“å®¢æˆ·ç«¯æ”¶åˆ° Connection Resetï¼Œå¾€å¾€æ˜¯æ”¶åˆ°äº† TCP çš„ RST æ¶ˆæ¯ï¼ŒRST æ¶ˆæ¯ä¸€èˆ¬åœ¨ä¸‹é¢çš„æƒ…å†µä¸‹å‘é€ï¼š</p><ul><li>è¯•å›¾è¿æ¥ä¸€ä¸ªæœªè¢«ç›‘å¬çš„æœåŠ¡ç«¯ï¼›</li><li>å¯¹æ–¹å¤„äº TIMEWAIT çŠ¶æ€ï¼Œæˆ–è€…è¿æ¥å·²ç»å…³é—­å¤„äº CLOSED çŠ¶æ€ï¼Œæˆ–è€…é‡æ–°ç›‘å¬ seq num ä¸åŒ¹é…ï¼›</li><li>å‘èµ·è¿æ¥æ—¶è¶…æ—¶ï¼Œé‡ä¼ è¶…æ—¶ï¼Œkeepalive è¶…æ—¶ï¼›</li><li>åœ¨ç¨‹åºä¸­ä½¿ç”¨ SO_LINGERï¼Œå…³é—­è¿æ¥æ—¶ï¼Œæ”¾å¼ƒç¼“å­˜ä¸­çš„æ•°æ®ï¼Œç»™å¯¹æ–¹å‘é€ RSTã€‚</li></ul><h4 id="3-5-2-ä»€ä¹ˆæ˜¯-MSL"><a href="#3-5-2-ä»€ä¹ˆæ˜¯-MSL" class="headerlink" title="3.5.2 ä»€ä¹ˆæ˜¯ MSL"></a>3.5.2 ä»€ä¹ˆæ˜¯ MSL</h4><p><a href="https://en.wikipedia.org/wiki/Maximum_segment_lifetime">MSL, Maximum Segment Lifetime</a>ï¼ŒTCP Segment åœ¨ç½‘ç»œä¸Šçš„æœ€é•¿å­˜æ´»æ—¶é—´ã€‚</p><p><a href="www.rfc-editor.org/rfc/rfc793.txt">RFC793</a> å°† MSL å®šä¹‰ä¸º 2 åˆ†é’Ÿã€‚Linux ä¸‹ MSL é»˜è®¤æ˜¯ 30 ç§’ï¼ŒWindows ä¸‹ MSL é»˜è®¤æ˜¯ 240 ç§’ã€‚Linux ä¸‹å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å®é™…çš„ MSL å€¼ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sysctl net.ipv4.tcp_fin_timeout<span class="token function">cat</span> /proc/sys/net/ipv4/tcp_fin_timeout<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3-5-3-ä¸ºä»€ä¹ˆä¸ç›´æ¥è¿›å…¥-CLOSED-çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…-2-MSL-æ—¶é—´"><a href="#3-5-3-ä¸ºä»€ä¹ˆä¸ç›´æ¥è¿›å…¥-CLOSED-çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…-2-MSL-æ—¶é—´" class="headerlink" title="3.5.3 ä¸ºä»€ä¹ˆä¸ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾… 2 * MSL æ—¶é—´"></a>3.5.3 ä¸ºä»€ä¹ˆä¸ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾… <code>2 * MSL</code> æ—¶é—´</h4><p>ä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼š</p><ol><li><p>è¿›å…¥TIME_WAITçŠ¶æ€å¹¶ç­‰å¾… <code>2 * MSL</code>ï¼Œä¿è¯äº†å¦‚æœè¢«åŠ¨æ–¹æ²¡æœ‰æ”¶åˆ°ä¸»åŠ¨æ–¹å›å¤çš„ ACKï¼Œè¢«åŠ¨æ–¹è‡³å°‘æœ‰æ—¶é—´èƒ½é‡å‘ä¸€æ¬¡ä¹‹å‰ FIN åŒ…ã€‚ä¸€å›ä¸€é‡å‘ï¼Œæ­£å¥½ <code>2 * MSL</code>ã€‚</p><blockquote><p>å¦‚æœä¸»åŠ¨æ–¹å›çš„ ACK åŒ…ä¸¢å¤±ï¼Œè¢«åŠ¨æ–¹é‡å‘çš„ FIN åŒ…ä¹Ÿä¸¢å¤±ï¼Œé‚£ä¹ˆå°±ä¸ç®¡äº†ã€‚</p></blockquote></li><li><p>é¿å…æ–­å¼€çš„ TCP è¿æ¥ä¸å½±å“åé¢æ–°å»ºç«‹çš„ TCP è¿æ¥ã€‚</p><blockquote><p>å¦‚æœä¸»åŠ¨æ–¹ä¸ç­‰å¾… <code>2*MSL</code> ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œç„¶åå†é‡æ–°å»ºç«‹ TCP è¿æ¥ï¼Œå¦‚æœæ­¤æ—¶æ”¶åˆ°äº†ä¹‹å‰å…³é—­çš„è¢«åŠ¨æ–¹é‡å‘ FIN æ¶ˆæ¯ï¼Œé‚£ä¹ˆé‡æ–°å»ºç«‹çš„ TCP è¿æ¥å°±ä¼šè¢«æ–­å¼€ã€‚</p></blockquote></li></ol><h2 id="å››ã€TCP-æ»‘åŠ¨çª—å£"><a href="#å››ã€TCP-æ»‘åŠ¨çª—å£" class="headerlink" title="å››ã€TCP æ»‘åŠ¨çª—å£"></a>å››ã€TCP æ»‘åŠ¨çª—å£</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£"><a href="#4-1-ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£"></a>4.1 ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£</h3><p>æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰ï¼Œä¹Ÿå«å‘é€çª—å£ï¼ˆSend Windowï¼‰ï¼Œæ»‘åŠ¨çª—å£è¡¨æ˜æ¥æ”¶æ–¹æœ‰å¤šå°‘ç©ºé—´æ¥æ¥æ”¶æ•°æ®ã€‚åœ¨ TCP è¿æ¥å»ºç«‹çš„è¿‡ç¨‹ä¸­åå•†æ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œå½“è¿æ¥æˆåŠŸå»ºç«‹åï¼ŒåŒæ–¹çš„æ»‘åŠ¨çª—å£çš„å¤§å°éƒ½åå•†å¥½äº†ã€‚åœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥åŠ¨æ€çš„ä¿®æ”¹æ»‘åŠ¨çª—å£çš„å¤§å°ã€‚</p><p>æ»‘åŠ¨çª—å£ä¸»è¦ç”¨æ¥åšæµæ§ï¼ˆFlow Controlï¼‰ï¼Œå®ƒä¸»è¦å— TCP è¿æ¥åŒæ–¹å†…å­˜å¤§å°çš„å½±å“ï¼Œå¹¶ä¸ç›´æ¥å…³å¿ƒç½‘é€Ÿç­‰é—®é¢˜ã€‚æ‰€ä»¥å®Œæ•´çš„ TCP æ§åˆ¶é™¤äº†æµæ§ï¼ˆFlow Controlï¼‰å¤–ï¼Œè¿˜æœ‰éœ€è¦æ‹¥å¡å¤„ç†ï¼ˆCongestion Handlingï¼‰æ¥å¤„ç†ç½‘ç»œç›¸å…³çš„é—®é¢˜ã€‚</p><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£.png" alt="ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£"></p><ol><li>å·²ç»æ”¶åˆ° ACK ç¡®è®¤çš„æ•°æ®ã€‚å­—èŠ‚ 1-31ï¼›</li><li>åœ¨æ»‘åŠ¨çª—å£ä¸­ï¼Œå·²ç»å‘é€å‡ºå»äº†ï¼Œä½†æ˜¯è¿˜æ²¡æ”¶åˆ° ACK ç¡®è®¤çš„æ•°æ®ã€‚å­—èŠ‚ 32-45ï¼›</li><li>åœ¨æ»‘åŠ¨çª—å£ä¸­ï¼Œè¿˜æ²¡å‘é€å‡ºå»çš„æ•°æ®ï¼ˆæ¥æ”¶æ–¹è¿˜æœ‰ç©ºé—´æ¥æ”¶ï¼‰ã€‚å­—èŠ‚ 46-51ï¼›</li><li>å¾…å‘é€çš„æ•°æ®ï¼ˆæ¥æ”¶æ–¹æ²¡æœ‰ç©ºé—´æ¥æ”¶ï¼‰ã€‚å­—èŠ‚ 52 åŠä»¥ä¸Šã€‚</li></ol><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.tcpipguide.com/free/t_TCPSlidingWindowAcknowledgmentSystemForDataTranspo-6.htm">TCP Sliding Window Acknowledgment System For Data Transport, Reliability and Flow Control 6</a></p></blockquote><h3 id="4-2-æ»‘åŠ¨çª—å£æ€ä¹ˆå·¥ä½œ"><a href="#4-2-æ»‘åŠ¨çª—å£æ€ä¹ˆå·¥ä½œ" class="headerlink" title="4.2 æ»‘åŠ¨çª—å£æ€ä¹ˆå·¥ä½œ"></a>4.2 æ»‘åŠ¨çª—å£æ€ä¹ˆå·¥ä½œ</h3><ol><li><p>å½“ä¸Šå›¾ä¸­æ‰€æœ‰æ»‘åŠ¨çª—å£å†…çš„æ•°æ®éƒ½å‘é€å‡ºåï¼Œæ»‘åŠ¨çª—å£å†…çš„çŠ¶æ€å˜æˆäº†ä¸‹å›¾çš„çŠ¶æ€ï¼š</p><p> <img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/æ»‘åŠ¨çª—å£å†…çš„æ•°æ®éƒ½å·²è¢«å‘é€ä½†æœªè¢«ç¡®è®¤.png" alt="æ»‘åŠ¨çª—å£å†…çš„æ•°æ®éƒ½å·²è¢«å‘é€ä½†æœªè¢«ç¡®è®¤"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.tcpipguide.com/free/t_TCPSlidingWindowAcknowledgmentSystemForDataTranspo-7.htm">TCP Sliding Window Acknowledgment System For Data Transport, Reliability and Flow Control 7</a></p></blockquote><ol><li>å·²ç»æ”¶åˆ° ACK ç¡®è®¤çš„æ•°æ®ã€‚å­—èŠ‚ 1-31ï¼›</li><li>åœ¨æ»‘åŠ¨çª—å£ä¸­ï¼Œå·²ç»å‘é€å‡ºå»äº†ï¼Œä½†æ˜¯è¿˜æ²¡æ”¶åˆ° ACK ç¡®è®¤çš„æ•°æ®ã€‚å­—èŠ‚ 32-51ï¼›</li><li>åœ¨æ»‘åŠ¨çª—å£ä¸­ï¼Œè¿˜æ²¡å‘é€å‡ºå»çš„æ•°æ®ï¼ˆæ¥æ”¶æ–¹è¿˜æœ‰ç©ºé—´æ¥æ”¶ï¼‰ã€‚æ— ï¼›</li><li>å¾…å‘é€çš„æ•°æ®ï¼ˆæ¥æ”¶æ–¹æ²¡æœ‰ç©ºé—´æ¥æ”¶ï¼‰ã€‚å­—èŠ‚ 52 åŠä»¥ä¸Šï¼›</li></ol></li><li><p>å¦‚æœä¸€æ®µæ—¶é—´åï¼Œæ”¶åˆ°äº† 32-36 å­—èŠ‚çš„ ACK ç¡®è®¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£å°±ä¼šå‘åé¢æ»‘åŠ¨ï¼Œå¹¶å¯ä»¥å‘é€å­—èŠ‚ 52-56ã€‚å¦‚ä¸‹å›¾ï¼š</p><p> <img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/æ»‘åŠ¨çª—å£æ”¶åˆ°ç¡®è®¤åå‘åæ»‘åŠ¨.png" alt="æ»‘åŠ¨çª—å£æ”¶åˆ°ç¡®è®¤åå‘åæ»‘åŠ¨"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.tcpipguide.com/free/t_TCPSlidingWindowAcknowledgmentSystemForDataTranspo-8.htm">TCP Sliding Window Acknowledgment System For Data Transport, Reliability and Flow Control 8</a></p></blockquote><ol><li>å·²ç»æ”¶åˆ° ACK ç¡®è®¤çš„æ•°æ®ã€‚å­—èŠ‚ 1-36ï¼›</li><li>åœ¨æ»‘åŠ¨çª—å£ä¸­ï¼Œå·²ç»å‘é€å‡ºå»äº†ï¼Œä½†æ˜¯è¿˜æ²¡æ”¶åˆ° ACK ç¡®è®¤çš„æ•°æ®ã€‚å­—èŠ‚ 37-51ï¼›</li><li>åœ¨æ»‘åŠ¨çª—å£ä¸­ï¼Œè¿˜æ²¡å‘é€å‡ºå»çš„æ•°æ®ï¼ˆæ¥æ”¶æ–¹è¿˜æœ‰ç©ºé—´æ¥æ”¶ï¼‰ã€‚å­—èŠ‚ 52-56ï¼›</li><li>å¾…å‘é€çš„æ•°æ®ï¼ˆæ¥æ”¶æ–¹æ²¡æœ‰ç©ºé—´æ¥æ”¶ï¼‰ã€‚å­—èŠ‚ 57 åŠä»¥ä¸Šã€‚</li></ol></li><li><p>å¾ªç¯ä¸Šé¢çš„æ­¥éª¤å°±èƒ½å¤Ÿä¸€ç›´å‘é€æ•°æ®äº†ã€‚å¦‚ä¸‹å›¾ï¼ˆä¸‹å›¾ä¸­æ»‘åŠ¨çª—å£æ²¡æœ‰å‘åæ»‘åŠ¨ï¼Œæ‰€ä»¥æœ€åæ»‘åŠ¨çª—å£çš„å¤§å°ä¼šå˜æˆ 0ï¼‰ï¼š</p><p> <img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/æ»‘åŠ¨çª—å£å®Œæ•´å·¥ä½œæµç¨‹.png" alt="æ»‘åŠ¨çª—å£å®Œæ•´å·¥ä½œæµç¨‹"></p><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href="http://www.tcpipguide.com/free/t_TCPWindowSizeAdjustmentandFlowControl-2.htm">TCP Window Size Adjustment and Flow Control 2</a></p></blockquote></li></ol><h3 id="4-3-å¸¸è§é—®é¢˜"><a href="#4-3-å¸¸è§é—®é¢˜" class="headerlink" title="4.3 å¸¸è§é—®é¢˜"></a>4.3 å¸¸è§é—®é¢˜</h3><h4 id="4-3-1-å¦‚æœæ»‘åŠ¨çª—å£å˜æˆäº†-0-ä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#4-3-1-å¦‚æœæ»‘åŠ¨çª—å£å˜æˆäº†-0-ä¼šå‘ç”Ÿä»€ä¹ˆ" class="headerlink" title="4.3.1 å¦‚æœæ»‘åŠ¨çª—å£å˜æˆäº† 0 ä¼šå‘ç”Ÿä»€ä¹ˆ"></a>4.3.1 å¦‚æœæ»‘åŠ¨çª—å£å˜æˆäº† 0 ä¼šå‘ç”Ÿä»€ä¹ˆ</h4><p>å½“æ»‘åŠ¨çª—å£å‡å°‘åˆ° 0 åï¼Œå°±ä¸èƒ½å†å‘é€æ•°æ®ç»™å¯¹æ–¹äº†ã€‚æ­¤æ—¶å¯ä»¥å‘é€ <code>Zero Window Probe</code> åŒ…ç»™å¯¹æ–¹ï¼Œè¿™æ ·åœ¨å¯¹æ–¹å›å¤æ­¤åŒ…çš„ ACK çš„åŒæ—¶ï¼Œå¯ä»¥æ›´æ–°æ»‘åŠ¨çª—å£çš„å¤§å°ã€‚</p><h4 id="4-3-2-ä»€ä¹ˆæ˜¯â€œç³Šæ¶‚çª—å£ç»¼åˆç—‡â€"><a href="#4-3-2-ä»€ä¹ˆæ˜¯â€œç³Šæ¶‚çª—å£ç»¼åˆç—‡â€" class="headerlink" title="4.3.2 ä»€ä¹ˆæ˜¯â€œç³Šæ¶‚çª—å£ç»¼åˆç—‡â€"></a>4.3.2 ä»€ä¹ˆæ˜¯â€œç³Šæ¶‚çª—å£ç»¼åˆç—‡â€</h4><p>å¦‚æœå‘é€æ–¹æ¯æ¬¡éƒ½å‘é€å¾ˆå°‘çš„å­—èŠ‚ï¼Œæˆ–è€…æ¥å—æ–¹æ¯æ¬¡éƒ½å¤„ç†å¾ˆå°‘çš„å­—èŠ‚æ—¶ï¼Œæˆ–è€…åŒæ–¹éƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œå°±å« <code>ç³Šæ¶‚çª—å£ç»¼åˆç—‡ï¼ˆSilly Window Syndromeï¼‰</code>ã€‚å› ä¸ºæ¯æ¬¡å‘é€å‡ºå»çš„å­—èŠ‚æ•°å¾ˆå°‘ï¼Œæ¯”å¦‚å‡ ä¸ªå­—èŠ‚ï¼Œæ˜æ˜¾å°äºäº† TCP/IP çš„åè®®å¤´çš„å¤§å°ï¼ˆTCP+IP å¤´æœ‰ 40 ä¸ªå­—èŠ‚ï¼‰ï¼Œæ­¤æ—¶ç½‘ç»œä¼ è¾“çš„æ•ˆç‡å°±å¾ˆä½ã€‚</p><p>ä¸€ä¸ªè§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨<a href="https://en.wikipedia.org/wiki/Nagle%27s_algorithm">çº³æ ¼ç®—æ³•ï¼ŒNagleâ€™s algorithm</a>ï¼Œè¿™ä¸ªç®—æ³•é»˜è®¤æ˜¯å¯ç”¨çš„ã€‚è¯¥ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">if there is new data to send then    if the window size â‰¥ MSS and available data is â‰¥ MSS then        send complete MSS segment now    else        if there is unconfirmed data still in the pipe then            enqueue data in the buffer until an acknowledge is received        else            send data immediately        end if    end ifend if<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº”ã€TCPæ‹¥å¡å¤„ç†"><a href="#äº”ã€TCPæ‹¥å¡å¤„ç†" class="headerlink" title="äº”ã€TCPæ‹¥å¡å¤„ç†"></a>äº”ã€TCPæ‹¥å¡å¤„ç†</h2><h3 id="5-1-ä¸ºä»€ä¹ˆéœ€è¦æ‹¥å¡å¤„ç†"><a href="#5-1-ä¸ºä»€ä¹ˆéœ€è¦æ‹¥å¡å¤„ç†" class="headerlink" title="5.1 ä¸ºä»€ä¹ˆéœ€è¦æ‹¥å¡å¤„ç†"></a>5.1 ä¸ºä»€ä¹ˆéœ€è¦æ‹¥å¡å¤„ç†</h3><p>å¦‚æœç½‘ç»œå»¶æ—¶çªç„¶å¢å¤§ä¸¢åŒ…ä¸¥é‡ï¼ŒTCP å‘é€å‡ºå»çš„æ•°æ®åŒ…ï¼Œå¾ˆä¹…éƒ½æ²¡æ”¶åˆ°å¯¹åº”åŒ…çš„ ACKï¼Œé‚£ä¹ˆ TCP å°±åªèƒ½é€‰æ‹©é‡ä¼ è¯¥æ•°æ®åŒ…ã€‚ä½†æ˜¯ä¸èƒ½æ— é™åˆ¶ä¸é—´æ–­çš„é‡å‘æ•°æ®åŒ…ï¼Œå› ä¸ºè¿™ä¼šå¢åŠ ç½‘ç»œçš„è´Ÿæ‹…ï¼Œå¯¼è‡´æ›´å¤§çš„ç½‘ç»œå»¶è¿Ÿå’Œæ›´å¤šçš„ç½‘ç»œä¸¢åŒ…ï¼Œæ‰€ä»¥éœ€è¦æ‹¥å¡å¤„ç†ï¼ˆCongestion Handlingï¼‰æ¥æ§åˆ¶æ•°æ®åŒ…çš„é‡å‘ã€‚</p><h2 id="å…­ã€å…¶ä»–å¸¸è§é—®é¢˜"><a href="#å…­ã€å…¶ä»–å¸¸è§é—®é¢˜" class="headerlink" title="å…­ã€å…¶ä»–å¸¸è§é—®é¢˜"></a>å…­ã€å…¶ä»–å¸¸è§é—®é¢˜</h2><h3 id="6-1-MTU-1500-çš„å…·ä½“å«ä¹‰æ˜¯ä»€ä¹ˆ"><a href="#6-1-MTU-1500-çš„å…·ä½“å«ä¹‰æ˜¯ä»€ä¹ˆ" class="headerlink" title="6.1 MTU 1500 çš„å…·ä½“å«ä¹‰æ˜¯ä»€ä¹ˆ"></a>6.1 MTU 1500 çš„å…·ä½“å«ä¹‰æ˜¯ä»€ä¹ˆ</h3><p>MTUï¼ˆMaximum Transmission Unitï¼Œæœ€å¤§ä¼ è¾“å•å…ƒï¼‰æ˜¯äºŒå±‚çš„ä¸€ä¸ªå®šä¹‰ã€‚ä»¥ä»¥å¤ªç½‘ä¸ºä¾‹ï¼ŒMTU ä¸º 1500 ä¸ª Byteï¼Œå‰é¢æœ‰ 6 ä¸ª Byte çš„ç›®æ ‡ MAC åœ°å€ï¼Œ6 ä¸ª Byte çš„æº MAC åœ°å€ï¼Œ2 ä¸ª Byte çš„ç±»å‹ï¼Œåé¢æœ‰ 4 ä¸ª Byte çš„ CRC æ ¡éªŒï¼Œå…± 1518 ä¸ª Byteã€‚</p><p>åœ¨ IP å±‚ï¼Œä¸€ä¸ª IP æ•°æ®æŠ¥åœ¨ä»¥å¤ªç½‘ä¸­ä¼ è¾“ï¼Œå¦‚æœå®ƒçš„é•¿åº¦å¤§äºè¯¥ MTU å€¼ï¼Œå°±è¦è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ã€‚å¦‚æœä¸å…è®¸åˆ†ç‰‡ DFï¼Œå°±ä¼šå‘é€ ICMP åŒ…ï¼Œ</p><p>åœ¨ TCP å±‚æœ‰ä¸ª MSSï¼ˆMaximum Segment Sizeï¼Œæœ€å¤§åˆ†æ®µå¤§å°ï¼‰ï¼Œå®ƒç­‰äº MTU å‡å» IP å¤´ï¼Œå†å‡å» TCP å¤´ã€‚å³åœ¨ä¸åˆ†ç‰‡çš„æƒ…å†µä¸‹ï¼ŒTCP é‡Œé¢æ”¾çš„æœ€å¤§å†…å®¹ã€‚</p><h3 id="6-2-HTTPS-çš„åŒå‘è®¤è¯æµç¨‹"><a href="#6-2-HTTPS-çš„åŒå‘è®¤è¯æµç¨‹" class="headerlink" title="6.2 HTTPS çš„åŒå‘è®¤è¯æµç¨‹"></a>6.2 HTTPS çš„åŒå‘è®¤è¯æµç¨‹</h3><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/HTTPSçš„åŒå‘è®¤è¯æµç¨‹.jpg" alt="HTTPSçš„åŒå‘è®¤è¯æµç¨‹"></p><p>å…¶ä¸­ï¼Œéšæœºæ•°å’Œ premaster çš„å«ä¹‰æ˜¯ï¼š</p><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/HTTPSä¸­çš„éšæœºæ•°å’Œpremaster.jpg" alt="HTTPSä¸­çš„éšæœºæ•°å’Œpremaster"></p><h3 id="6-3-RTMP-è¿æ¥å»ºç«‹çš„è¿‡ç¨‹"><a href="#6-3-RTMP-è¿æ¥å»ºç«‹çš„è¿‡ç¨‹" class="headerlink" title="6.3 RTMP è¿æ¥å»ºç«‹çš„è¿‡ç¨‹"></a>6.3 RTMP è¿æ¥å»ºç«‹çš„è¿‡ç¨‹</h3><ol><li>é¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘é€ C0 è¡¨æ˜è‡ªå·±çš„ç‰ˆæœ¬å·ï¼Œä¸å¿…ç­‰å¯¹æ–¹çš„å›å¤ï¼Œç„¶åå‘é€ C1 è¡¨æ˜è‡ªå·±çš„æ—¶é—´æˆ³ã€‚</li><li>æœåŠ¡å™¨åªæœ‰åœ¨æ”¶åˆ° C0 çš„æ—¶å€™ï¼Œæ‰èƒ½è¿”å› S0ï¼Œè¡¨æ˜è‡ªå·±çš„ç‰ˆæœ¬å·ã€‚å¦‚æœç‰ˆæœ¬ä¸åŒ¹é…ï¼Œå¯ä»¥æ–­å¼€è¿æ¥ã€‚</li><li>æœåŠ¡å™¨å‘é€å®Œ S0 åï¼Œä¹Ÿä¸ç”¨ç­‰ä»€ä¹ˆï¼Œå°±ç›´æ¥å‘é€è‡ªå·±çš„æ—¶é—´æˆ³ S1ã€‚å®¢æˆ·ç«¯æ”¶åˆ° S1 çš„æ—¶å€™ï¼Œå‘ä¸€ä¸ªçŸ¥é“äº†å¯¹æ–¹æ—¶é—´æˆ³çš„ ACK C2ã€‚åŒç†æœåŠ¡å™¨æ”¶åˆ° C1 çš„æ—¶å€™ï¼Œå‘ä¸€ä¸ªçŸ¥é“äº†å¯¹æ–¹æ—¶é—´æˆ³çš„ ACK S2ã€‚</li><li>æ¡æ‰‹å®Œæˆã€‚</li></ol><p><img src="/images/TCPæ¨¡å‹åè®®çŠ¶æ€æœºé€Ÿè§ˆ/RTMPè¿æ¥å»ºç«‹çš„è¿‡ç¨‹.jpg" alt="RTMPè¿æ¥å»ºç«‹çš„è¿‡ç¨‹"></p><h3 id="6-4-ä¸ä¼šå¯¼è‡´äº§ç”Ÿ-ICMP-å·®é”™æŠ¥æ–‡æƒ…å†µ"><a href="#6-4-ä¸ä¼šå¯¼è‡´äº§ç”Ÿ-ICMP-å·®é”™æŠ¥æ–‡æƒ…å†µ" class="headerlink" title="6.4 ä¸ä¼šå¯¼è‡´äº§ç”Ÿ ICMP å·®é”™æŠ¥æ–‡æƒ…å†µ"></a>6.4 ä¸ä¼šå¯¼è‡´äº§ç”Ÿ ICMP å·®é”™æŠ¥æ–‡æƒ…å†µ</h3><ol><li>ICMP å·®é”™æŠ¥æ–‡ï¼ˆICMP æŸ¥è¯¢æŠ¥æ–‡å¯èƒ½ä¼šäº§ç”Ÿ ICMP å·®é”™æŠ¥æ–‡ï¼‰ï¼›</li><li>ç›®çš„åœ°å€æ˜¯å¹¿æ’­åœ°å€æˆ–å¤šæ’­åœ°å€çš„ IP æ•°æ®æŠ¥ï¼›</li><li>ä½œä¸ºé“¾è·¯å±‚å¹¿æ’­çš„æ•°æ®æŠ¥ï¼›</li><li>ä¸æ˜¯ IP åˆ†ç‰‡çš„ç¬¬ä¸€ç‰‡ï¼›</li><li>æºåœ°å€ä¸æ˜¯å•ä¸ªä¸»æœºçš„æ•°æ®æŠ¥ã€‚è¿™å°±æ˜¯è¯´ï¼Œæºåœ°å€ä¸èƒ½ä¸ºé›¶åœ°å€ã€ç¯å›åœ°å€ã€å¹¿æ’­åœ°å€æˆ–å¤šæ’­åœ°å€ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCPçŠ¶æ€æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šæ·±åº¦æ¢ç´¢C++å¯¹è±¡æ¨¡å‹ã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="shen-du-tan-suo-c-dui-xiang-mo-xing-du-shu-bi-ji/"/>
      <url>shen-du-tan-suo-c-dui-xiang-mo-xing-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å…³äºå¯¹è±¡"><a href="#ä¸€ã€å…³äºå¯¹è±¡" class="headerlink" title="ä¸€ã€å…³äºå¯¹è±¡"></a>ä¸€ã€å…³äºå¯¹è±¡</h2><p>å…³äºè±å½¢ç»§æ‰¿å¯¹è±¡çš„å†…å­˜åˆ†å¸ƒï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://kibazen.cn/c-ling-xing-ji-cheng-nei-cun-bu-ju-fen-xi/">C++è±å½¢ç»§æ‰¿å†…å­˜å¸ƒå±€åˆ†æ</a>äº†è§£ã€‚</p><h2 id="äºŒã€æ„é€ å‡½æ•°è¯­ä¹‰å­¦"><a href="#äºŒã€æ„é€ å‡½æ•°è¯­ä¹‰å­¦" class="headerlink" title="äºŒã€æ„é€ å‡½æ•°è¯­ä¹‰å­¦"></a>äºŒã€æ„é€ å‡½æ•°è¯­ä¹‰å­¦</h2><ol><li><p>å››ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæœªå£°æ˜ contructor çš„ class åˆæˆä¸€ä¸ª default constructorã€‚</p><ul><li><p>å¸¦æœ‰ Default Constructor çš„ Member Class Object</p><blockquote><p>å¦‚æœä¸€ä¸ª class æ²¡æœ‰ä»»ä½•çš„ constructorï¼Œ ä½†æ˜¯å®ƒå«æœ‰ä¸€ä¸ªæ‹¥æœ‰ default constructor çš„ member objectï¼Œé‚£ä¹ˆè¿™ä¸ª class çš„ <strong>implicit default constructor</strong> å°±æ˜¯ nontrivialï¼Œç¼–è¯‘å™¨éœ€è¦ä¸ºæ­¤ class åˆæˆä¸€ä¸ª default constructorã€‚æ­¤ class çš„ default constructor ä¼šè°ƒç”¨æ¯ä¸ª member object çš„ default constructorã€‚</p></blockquote></li><li><p>å¸¦æœ‰ Default Constructor çš„ Base Class</p><blockquote><p>ç±»ä¼¼çš„é“ç†ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½• constructor çš„ class æ´¾ç”Ÿè‡ªä¸€ä¸ªå¸¦æœ‰ default constructor çš„ base classï¼Œè¿™ä¸ª derived class çš„ default constructor ä¼šè¢«è§†ä¸º nontrivialï¼Œå¹¶éœ€è¦è¢«åˆæˆå‡ºæ¥ã€‚å®ƒå°†è°ƒç”¨ä¸Šä¸€å±‚ base class çš„ default constructor ï¼ˆæ ¹æ®å®ƒä»¬çš„å£°æ˜æ¬¡åºï¼‰ã€‚å¯¹è¿™ä¸ª derived class æ¥è¯´ï¼Œåˆæˆå‡ºæ¥çš„ constructor å’Œä¸€ä¸ªæ˜ç¡®æä¾›çš„ default constructor ä¸€æ ·ã€‚</p></blockquote></li><li><p>å¸¦æœ‰ä¸€ä¸ªVirtual Function çš„ Class</p><blockquote><p>å¦å¤–ä¸¤ç§æƒ…å†µï¼Œä¹Ÿéœ€è¦åˆæˆå‡º default constructorï¼š</p><ol><li>class å£°æ˜ï¼ˆæˆ–ç»§æ‰¿ï¼‰ä¸€ä¸ª virtual functionã€‚</li><li>class æ´¾ç”Ÿè‡ªä¸€ä¸ªç»§æ‰¿ä¸²é“¾ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæˆ–æ›´å¤šçš„ virtual base classesã€‚</li></ol></blockquote></li><li><p>å¸¦æœ‰ä¸€ä¸ª Virtual Base Class çš„ Class</p><p>è¿™äº›åˆæˆçš„ constructor å« <strong>implicit nontrivial default constructor</strong>ã€‚ä¸æ»¡è¶³ä¸Šé¢å››ç§æƒ…å†µä¸”æ²¡æœ‰å£°æ˜ä»»ä½• constructor çš„ classï¼Œ ä»–ä»¬çš„ constructor å« <strong>implicit trivial default constructor</strong>ï¼Œç¼–è¯‘ä¸ä¼šä¸ºè¿™äº› class åˆæˆ constructorã€‚</p><p>åœ¨åˆæˆçš„ default constructor ä¸­ï¼Œåªæœ‰ <strong>base class subojects</strong> å’Œ <strong>member class objects</strong> ä¼šè¢«åˆå§‹åŒ–ã€‚æ‰€æœ‰å…¶ä»–çš„ nonstatic data memberï¼Œå¦‚æ•´æ•°ã€æ•´æ•°æŒ‡é’ˆã€æ•´æ•°æ•°ç»„ç­‰éƒ½ä¸ä¼šè¢«åˆå§‹åŒ–ã€‚</p></li></ul></li><li><p>å’Œ default constructor ä¸€æ ·ï¼Œå¦‚æœ class æ²¡æœ‰å£°æ˜ä¸€ä¸ª copy constructorï¼Œç¼–è¯‘å™¨å°±ä¼šéšå¼çš„å£°æ˜ï¼ˆimplicitly declaredï¼‰æˆ–éšå¼çš„å®šä¹‰ï¼ˆimplicitly definedï¼‰ä¸€ä¸ªã€‚copy constructor ä¹Ÿåˆ†ä¸º trivial å’Œ nontrivial ä¸¤ç§ã€‚åªæœ‰ nontrivial çš„å®ä½“æ‰ä¼šè¢«åˆæˆäºç¨‹åºä¸­ã€‚å†³å®šä¸€ä¸ª copy constructor æ˜¯å¦ä¸º trivial çš„æ ‡å‡†åœ¨äº class æ˜¯å¦å±•ç°å‡ºæ‰€è°“çš„â€œbitwise copy semanticâ€ã€‚</p></li><li><p>å››ç§æƒ…å†µä¸‹ï¼Œclass ä¸å±•ç°å‡ºâ€œbitwise copy semanticâ€ã€‚</p><ul><li><p>å½“ class å†…å«ä¸€ä¸ª member object è€Œåè€…çš„ class å£°æ˜ä¸­æœ‰ä¸€ä¸ª copy constructorã€‚</p></li><li><p>å½“ class ç»§æ‰¿è‡ªä¸€ä¸ª base class è€Œåè€…å­˜åœ¨æœ‰ä¸€ä¸ª copy constructor æ—¶ï¼ˆä¸èƒ½æ˜¯è¢«æ˜ç¡®å£°æ˜æˆ–æ˜¯è¢«åˆæˆè€Œå¾—ï¼‰ã€‚</p></li><li><p>å½“ class å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ª virtual functions æ—¶ã€‚</p></li><li><p>å½“ class æ´¾ç”Ÿè‡ªä¸€ä¸ªç»§æ‰¿ä¸²é“¾ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª virtual base classes æ—¶ã€‚</p></li></ul></li></ol><h2 id="ä¸‰ã€Data-è¯­æ„å­¦"><a href="#ä¸‰ã€Data-è¯­æ„å­¦" class="headerlink" title="ä¸‰ã€Data è¯­æ„å­¦"></a>ä¸‰ã€Data è¯­æ„å­¦</h2><ol><li><p>ä¸Šå¤æ—¶æœŸï¼Œä¸‹é¢ä»£ç ä¸­ï¼Œç±»Açš„æˆå‘˜å‡½æ•°è¿”å›çš„æ˜¯å…¨å±€xï¼Œè€Œä¸æ˜¯æˆå‘˜å˜é‡xã€‚è¿™ä¸ªé—®é¢˜å·²ç»ä¿®å¤äº†ï¼Œç°åœ¨æ€»æ•°è¿”å›æˆå‘˜å˜é‡xã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> x<span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> x<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> x<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œval_tçš„ç±»å‹æ˜¯ä½¿ç”¨å…¨å±€çš„val_tçš„å®šä¹‰ï¼Œå³xï¼Œè€Œä¸æ˜¯ç±»ä¸­å£°æ˜çš„val_tï¼Œæ‰€ä»¥éœ€æ³¨æ„ã€‚</p> <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">using</span> val_t <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">FuncA</span><span class="token punctuation">(</span>val_t v<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(val_t) = %d\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// = sizeof(int) = 4</span>    <span class="token punctuation">}</span>    <span class="token keyword">using</span> val_t <span class="token operator">=</span> <span class="token keyword">char</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">FuncB</span><span class="token punctuation">(</span>val_t v<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(val_t) = %d\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// = sizeof(char) = 1</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    A a<span class="token punctuation">;</span>    a<span class="token punctuation">.</span><span class="token function">FuncA</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    a<span class="token punctuation">.</span><span class="token function">FuncB</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> è¿è¡Œç»“æœ</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">sizeof(val_t) = 4sizeof(val_t) = 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h2 id="å››ã€Function-è¯­æ„å­¦"><a href="#å››ã€Function-è¯­æ„å­¦" class="headerlink" title="å››ã€Function è¯­æ„å­¦"></a>å››ã€Function è¯­æ„å­¦</h2><h2 id="äº”ã€æ„é€ ã€è§£æ„ã€æ‹·è´è¯­æ„å­¦"><a href="#äº”ã€æ„é€ ã€è§£æ„ã€æ‹·è´è¯­æ„å­¦" class="headerlink" title="äº”ã€æ„é€ ã€è§£æ„ã€æ‹·è´è¯­æ„å­¦"></a>äº”ã€æ„é€ ã€è§£æ„ã€æ‹·è´è¯­æ„å­¦</h2><h2 id="å…­ã€æ‰§è¡ŒæœŸè¯­æ„å­¦"><a href="#å…­ã€æ‰§è¡ŒæœŸè¯­æ„å­¦" class="headerlink" title="å…­ã€æ‰§è¡ŒæœŸè¯­æ„å­¦"></a>å…­ã€æ‰§è¡ŒæœŸè¯­æ„å­¦</h2><h2 id="ä¸ƒã€ç«™åœ¨å¯¹è±¡æ¨¡å‹çš„å°–ç«¯"><a href="#ä¸ƒã€ç«™åœ¨å¯¹è±¡æ¨¡å‹çš„å°–ç«¯" class="headerlink" title="ä¸ƒã€ç«™åœ¨å¯¹è±¡æ¨¡å‹çš„å°–ç«¯"></a>ä¸ƒã€ç«™åœ¨å¯¹è±¡æ¨¡å‹çš„å°–ç«¯</h2>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++è±å½¢ç»§æ‰¿å†…å­˜å¸ƒå±€åˆ†æ</title>
      <link href="c-ling-xing-ji-cheng-nei-cun-bu-ju-fen-xi/"/>
      <url>c-ling-xing-ji-cheng-nei-cun-bu-ju-fen-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç¼–è¯‘ç¯å¢ƒ"><a href="#ä¸€ã€ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="ä¸€ã€ç¼–è¯‘ç¯å¢ƒ"></a>ä¸€ã€ç¼–è¯‘ç¯å¢ƒ</h2><ul><li>Visual Studio 2017</li><li>G++ (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0</li><li>Clang++ 6.0.0-1ubuntu2</li></ul><hr><h2 id="äºŒã€éè™šç»§æ‰¿"><a href="#äºŒã€éè™šç»§æ‰¿" class="headerlink" title="äºŒã€éè™šç»§æ‰¿"></a>äºŒã€éè™šç»§æ‰¿</h2><h3 id="2-1-æµ‹è¯•ä»£ç "><a href="#2-1-æµ‹è¯•ä»£ç " class="headerlink" title="2.1 æµ‹è¯•ä»£ç "></a>2.1 æµ‹è¯•ä»£ç </h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// filename: nonvirtual.cpp</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio&gt;</span></span><span class="token keyword">struct</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> a <span class="token operator">=</span> <span class="token number">0x1111111111111111LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">B</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">A</span></span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> b <span class="token operator">=</span> <span class="token number">0x2222222222222222LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">C</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">A</span></span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> c <span class="token operator">=</span> <span class="token number">0x3333333333333333LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token class-name">C</span></span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> d <span class="token operator">=</span> <span class="token number">0x4444444444444444LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    A a<span class="token punctuation">;</span>    B b<span class="token punctuation">;</span>    C c<span class="token punctuation">;</span>    D d<span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(void*) = %zu\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(a) = %zu, &amp;a = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(b) = %zu, &amp;b = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(c) = %zu, &amp;c = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(d) = %zu, &amp;d = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-ç¼–è¯‘æ–¹å¼"><a href="#2-2-ç¼–è¯‘æ–¹å¼" class="headerlink" title="2.2 ç¼–è¯‘æ–¹å¼"></a>2.2 ç¼–è¯‘æ–¹å¼</h3><h4 id="2-2-1-VS20177"><a href="#2-2-1-VS20177" class="headerlink" title="2.2.1 VS20177"></a>2.2.1 VS20177</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">Debug x64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-2-2-G"><a href="#2-2-2-G" class="headerlink" title="2.2.2 G++"></a>2.2.2 G++</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">g++ -std<span class="token operator">=</span>c++11 -ggdb -o gcc-nv.out nonvirtual.cpp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-2-3-Clang"><a href="#2-2-3-Clang" class="headerlink" title="2.2.3 Clang++"></a>2.2.3 Clang++</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">clang++ -std<span class="token operator">=</span>c++11 -ggdb -o clang-nv.out nonvirtual.cpp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-3-æ‰§è¡Œç»“æœ"><a href="#2-3-æ‰§è¡Œç»“æœ" class="headerlink" title="2.3 æ‰§è¡Œç»“æœ"></a>2.3 æ‰§è¡Œç»“æœ</h3><h4 id="2-3-1-VS2017"><a href="#2-3-1-VS2017" class="headerlink" title="2.3.1 VS2017"></a>2.3.1 VS2017</h4><ol><li><p>æ‰§è¡Œç»“æœ</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">sizeof(void*) = 8sizeof(a) = 16, &amp;a = 000000204193F818sizeof(b) = 24, &amp;b = 000000204193F848sizeof(c) = 24, &amp;c = 000000204193F878sizeof(d) = 56, &amp;d = 000000204193F8A8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Dçš„å†…å­˜å¸ƒå±€</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">+----------------+|                || +------------+ || |            | |      +---------+| | +--------+ | |      |         || | | A.vptr+----------&gt;+ A::FA() || | | A::a   | | |      | B::FB() || | +--------+ | |      | D::FD() || |   B::b     | |      |         || +------------+ |      +---------+|                || +------------+ || |            | |      +---------+| | +--------+ | |      |         || | | A.vptr+----------&gt;+ A::FA() || | | A::a   | | |      | C::FC() || | +--------+ | |      |         || |   C::c     | |      +---------+| +------------+ ||                ||     D::d       ||                |+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Dçš„å†…å­˜DUMP</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">0x000000204193F8A8  00007ff7c032b1e8 1111111111111111 2222222222222222 00007ff7c032ae18 1111111111111111 33333333333333330x000000204193F8D8  44444444444444440x00007FF7C032B1E8  00007ff7c0321302 00007ff7c03211b8 00007ff7c032105a0x00007FF7C032AE18  00007ff7c0321302 00007ff7c03212e4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="2-3-2-G"><a href="#2-3-2-G" class="headerlink" title="2.3.2 G++"></a>2.3.2 G++</h4><ol><li><p>æ‰§è¡Œç»“æœ</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">sizeof(void*) = 8sizeof(a) = 16, &amp;a = 0x7fffffffe350sizeof(b) = 24, &amp;b = 0x7fffffffe360sizeof(c) = 24, &amp;c = 0x7fffffffe380sizeof(d) = 56, &amp;d = 0x7fffffffe3a0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Dçš„å†…å­˜å¸ƒå±€</p><p> å’ŒVS2017çš„ç»“æœç±»ä¼¼ã€‚</p></li><li><p>ç±»Dçš„å†…å­˜DUMP</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">(gdb) x /7a &amp;d0x7fffffffe3a0: 0x555555755ca8 &lt;_ZTV1D+16&gt;      0x11111111111111110x7fffffffe3b0: 0x2222222222222222      0x555555755cd0 &lt;_ZTV1D+56&gt;0x7fffffffe3c0: 0x1111111111111111      0x33333333333333330x7fffffffe3d0: 0x4444444444444444(gdb) x /3a 0x555555755ca80x555555755ca8 &lt;_ZTV1D+16&gt;:     0x555555554b96 &lt;A::FA()&gt;        0x555555554ba2 &lt;B::FB()&gt;0x555555755cb8 &lt;_ZTV1D+32&gt;:     0x555555554bba &lt;D::FD()&gt;(gdb) x /2a 0x555555755cd00x555555755cd0 &lt;_ZTV1D+56&gt;:     0x555555554b96 &lt;A::FA()&gt;        0x555555554bae &lt;C::FC()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="2-3-3-Clang"><a href="#2-3-3-Clang" class="headerlink" title="2.3.3 Clang++"></a>2.3.3 Clang++</h4><ol><li><p>æ‰§è¡Œç»“æœ</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">sizeof(void*) = 8sizeof(a) = 16, &amp;a = 0x7fffffffe3c0sizeof(b) = 24, &amp;b = 0x7fffffffe3a8sizeof(c) = 24, &amp;c = 0x7fffffffe390sizeof(d) = 56, &amp;d = 0x7fffffffe358<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Dçš„å†…å­˜å¸ƒå±€</p><p> å’ŒVS2017çš„ç»“æœç±»ä¼¼ã€‚</p></li><li><p>ç±»Dçš„å†…å­˜DUMP</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">(gdb) x /7a &amp;d0x7fffffffe358: 0x400a88 &lt;_ZTV1D+16&gt;    0x11111111111111110x7fffffffe368: 0x2222222222222222      0x400ab0 &lt;_ZTV1D+56&gt;0x7fffffffe378: 0x1111111111111111      0x33333333333333330x7fffffffe388: 0x4444444444444444(gdb) x /3a 0x400a880x400a88 &lt;_ZTV1D+16&gt;:   0x400880 &lt;A::FA()&gt;      0x400890 &lt;B::FB()&gt;0x400a98 &lt;_ZTV1D+32&gt;:   0x4008b0 &lt;D::FD()&gt;(gdb) x /2a 0x400ab00x400ab0 &lt;_ZTV1D+56&gt;:   0x400880 &lt;A::FA()&gt;      0x4008a0 &lt;C::FC()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><hr><h2 id="ä¸‰ã€è™šç»§æ‰¿"><a href="#ä¸‰ã€è™šç»§æ‰¿" class="headerlink" title="ä¸‰ã€è™šç»§æ‰¿"></a>ä¸‰ã€è™šç»§æ‰¿</h2><h3 id="3-1-æµ‹è¯•ä»£ç "><a href="#3-1-æµ‹è¯•ä»£ç " class="headerlink" title="3.1 æµ‹è¯•ä»£ç "></a>3.1 æµ‹è¯•ä»£ç </h3><p>ä¸<a href="#äºŒéè™šç»§æ‰¿">éè™šæ‹Ÿç»§æ‰¿</a>çš„æµ‹è¯•ä»£ç ç±»ä¼¼ï¼Œåªæ˜¯å°†éè™šæ‹Ÿç»§æ‰¿æ”¹æˆäº†è™šæ‹Ÿç»§æ‰¿ã€‚</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// filename: virtual.cpp</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio&gt;</span></span><span class="token keyword">struct</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> a <span class="token operator">=</span> <span class="token number">0x1111111111111111LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">B</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> b <span class="token operator">=</span> <span class="token number">0x2222222222222222LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">C</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token class-name">A</span></span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> c <span class="token operator">=</span> <span class="token number">0x3333333333333333LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token class-name">C</span></span><span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> d <span class="token operator">=</span> <span class="token number">0x4444444444444444LL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    A a<span class="token punctuation">;</span>    B b<span class="token punctuation">;</span>    C c<span class="token punctuation">;</span>    D d<span class="token punctuation">;</span>    <span class="token keyword">auto</span> pba <span class="token operator">=</span> <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>A<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> pda <span class="token operator">=</span> <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>A<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> pdb <span class="token operator">=</span> <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>B<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(void*) = %zu\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(a) = %zu, &amp;a = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(b) = %zu, &amp;b = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(c) = %zu, &amp;c = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(d) = %zu, &amp;d = %p\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-ç¼–è¯‘æ–¹å¼"><a href="#3-2-ç¼–è¯‘æ–¹å¼" class="headerlink" title="3.2 ç¼–è¯‘æ–¹å¼"></a>3.2 ç¼–è¯‘æ–¹å¼</h3><h4 id="3-2-1-vs2017"><a href="#3-2-1-vs2017" class="headerlink" title="3.2.1 vs2017"></a>3.2.1 vs2017</h4><pre class="line-numbers language-text" data-language="text"><code class="language-text">Debug x64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-2-2-G"><a href="#3-2-2-G" class="headerlink" title="3.2.2 G++"></a>3.2.2 G++</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">g++ -std<span class="token operator">=</span>c++11 -ggdb -o gcc-v.out virtual.cpp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-2-3-Clang"><a href="#3-2-3-Clang" class="headerlink" title="3.2.3 Clang++"></a>3.2.3 Clang++</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">clang++ -std<span class="token operator">=</span>c++11 -ggdb -o clang-v.out virtual.cpp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-æ‰§è¡Œç»“æœ"><a href="#3-3-æ‰§è¡Œç»“æœ" class="headerlink" title="3.3 æ‰§è¡Œç»“æœ"></a>3.3 æ‰§è¡Œç»“æœ</h3><p>VS2017çš„æ‰§è¡Œç»“æœä¸G++å’ŒClang++ä¸åŒã€‚</p><h4 id="3-3-1-VS2017"><a href="#3-3-1-VS2017" class="headerlink" title="3.3.1 VS2017"></a>3.3.1 VS2017</h4><ol><li><p>æ‰§è¡Œç»“æœ</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">sizeof(void*) = 8sizeof(a) = 16, &amp;a = 00000002F65FF658sizeof(b) = 40, &amp;b = 00000002F65FF688sizeof(c) = 40, &amp;c = 00000002F65FF6C8sizeof(d) = 72, &amp;d = 00000002F65FF710<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹ç±»Bçš„åˆ†æ</p><ul><li><p>ç±»Bçš„å†…å­˜åˆ†å¸ƒ</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">                +--------------+                |              |+---------+     | +----------+ || B::FB() +&lt;--------+B.vptr   | |      +--------------------++---------+     | | B.offset+--------&gt;+ offset2ptr    = -8 |                | | B::b     | |      | offset2A.vptr = 16 |                | +----------+ |      +--------------------+                |              |+---------+     | +----------+ || A::FA() +&lt;-------+A.vptr   | |+---------+     | | A::a     | |                | +----------+ |                |              |                +--------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Bçš„å†…å­˜DUMP</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">0x00000002F65FF688  00007ff6cd4eadb0 00007ff6cd4eb1e0 2222222222222222 00007ff6cd4eadc8 11111111111111110x00007FF6CD4EADB0  00007ff6cd4e11b8 &lt;B::FB()&gt;0x00007FF6CD4EB1E0  fffffff8 000000100x00007FF6CD4EADC8  00007ff6cd4e1302 &lt;A::FA()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>å¯¹ç±»Dçš„åˆ†æ</p><ul><li><p>ç±»Dçš„å†…å­˜å¸ƒå±€</p><p>  offsetä¸­ï¼Œoffset2ptrçš„æ•°æ®æ˜¯æ²¡ä½¿ç”¨çš„ã€‚</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">                +--------------+                |              |+---------+     | +----------+ || B::FB() +&lt;-------+B.vptr   | |      +--------------------+| D::FD() |     | | B.offset+--------&gt;+ offset2ptr    = -8 |+---------+     | | B::b     | |      | offset2A.vptr = 48 |                | +----------+ |      | offset2vptr   = -8 |                |              |      | offset2C.vptr = 24 |+---------+     | +----------+ |      +--------------------+| C::FC() +&lt;-------+C.vptr   | |      +--------------------++---------+     | | C.offset+--------&gt;+ offset2vptr   = -8 |                | | C::c     | |      | offset2A.vptr = 24 |                | +----------+ |      +--------------------+                |              |                |   D::d       |                |              |+---------+     | +----------+ || A::FA() +&lt;-------+A.vptr   | |+---------+     | | A::a     | |                | +----------+ |                |              |                +--------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Dçš„å†…å­˜DUMP</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">0x00000002F65FF710  00007ff6cd4eb098 00007ff6cd4eac10 2222222222222222 00007ff6cd4eae70 00007ff6cd4eac18 33333333333333330x00000002F65FF740  4444444444444444 00007ff6cd4eae90 11111111111111110x00007FF6CD4EB098  00007ff6cd4e11b8 &lt;B::FB()&gt; 00007ff6cd4e105a &lt;D::FD()&gt;0x00007FF6CD4EAC10  fffffff8 00000030 fffffff8 000000180x00007FF6CD4EAE70  00007ff6cd4e12e4 &lt;C::FC()&gt;0x00007FF6CD4EAC18  fffffff8 000000180x00007FF6CD4EAE90  00007ff6cd4e1302 &lt;A::FA()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ol><h4 id="3-3-2-G"><a href="#3-3-2-G" class="headerlink" title="3.3.2 G++"></a>3.3.2 G++</h4><ol><li><p>æ‰§è¡Œç»“æœ</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">sizeof(void*) = 8sizeof(a) = 16, &amp;a = 0x7fffffffe360sizeof(b) = 32, &amp;b = 0x7fffffffe370sizeof(c) = 32, &amp;c = 0x7fffffffe390sizeof(d) = 56, &amp;d = 0x7fffffffe3b0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹ç±»Bçš„åˆ†æ</p><ul><li><p>ç±»Bçš„å†…å­˜DUMP</p></li><li><p>ç±»Bçš„å†…å­˜å¸ƒå±€</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">+------------+|            || +--------+ |     +---------+| | B.vptr+-------&gt;+ B::FB() || | B::b   | |     +---------+| +--------+ || +--------| |     +---------+| | A.vptr+-------&gt;+ A::FA() || | A::a   | |     +---------+| +--------+ ||            |+------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">&gt;&gt;&gt; x /4a &amp;b0x7fffffffe370: 0x555555755cc8 &lt;_ZTV1B+24&gt;      0x22222222222222220x7fffffffe380: 0x555555755ce8 &lt;_ZTV1B+56&gt;      0x1111111111111111&gt;&gt;&gt; x /1a 0x555555755cc80x555555755cc8 &lt;_ZTV1B+24&gt;:     0x555555554dc4 &lt;B::FB()&gt;&gt;&gt;&gt; x /1a 0x555555755ce80x555555755ce8 &lt;_ZTV1B+56&gt;:     0x555555554db8 &lt;A::FA()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>å¯¹ç±»Dçš„åˆ†æ</p><ul><li><p>ç±»Dçš„å†…å­˜å¸ƒå±€</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">+----------------+|                || +------------+ || |            | || | +--------+ | |      +---------+| | | B.vptr+----------&gt;+ B::FB() || | | B::b   | | |      | D::FD() || | +--------+ | |      +---------+| | +--------| | |      +---------+| | | C.vptr+----------&gt;+ C::FC() || | | C::c   | | |      +---------+| | +--------+ | || |            | || +------------+ ||                ||     D::d       ||                ||   +--------+   |      +---------+|   | A.vptr+----------&gt;+ A::FA() ||   | A::a   |   |      +---------+|   +--------+   ||                |+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Dçš„å†…å­˜DUMP</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">&gt;&gt;&gt; x /7a &amp;d0x7fffffffe3b0: 0x555555755b58 &lt;_ZTV1D+24&gt;      0x22222222222222220x7fffffffe3c0: 0x555555755b80 &lt;_ZTV1D+64&gt;      0x33333333333333330x7fffffffe3d0: 0x4444444444444444      0x555555755ba0 &lt;_ZTV1D+96&gt;0x7fffffffe3e0: 0x1111111111111111&gt;&gt;&gt; x /2a 0x555555755b580x555555755b58 &lt;_ZTV1D+24&gt;:     0x555555554dc4 &lt;B::FB()&gt;        0x555555554ddc &lt;D::FD()&gt;&gt;&gt;&gt; x /1a 0x555555755b800x555555755b80 &lt;_ZTV1D+64&gt;:     0x555555554dd0 &lt;C::FC()&gt;&gt;&gt;&gt; x /1a 0x555555755ba00x555555755ba0 &lt;_ZTV1D+96&gt;:     0x555555554db8 &lt;A::FA()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ol><h4 id="3-3-3-Clang"><a href="#3-3-3-Clang" class="headerlink" title="3.3.3 Clang++"></a>3.3.3 Clang++</h4><p>Clang++çš„ç»“æœå’ŒG++çš„ä¸€æ ·ã€‚</p><ol><li><p>æ‰§è¡Œç»“æœ</p> <pre class="line-numbers language-text" data-language="text"><code class="language-text">sizeof(void*) = 8sizeof(a) = 16, &amp;a = 0x7fffffffe3c0sizeof(b) = 32, &amp;b = 0x7fffffffe3a0sizeof(c) = 32, &amp;c = 0x7fffffffe380sizeof(d) = 56, &amp;d = 0x7fffffffe348<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹ç±»Bçš„åˆ†æ</p><ul><li><p>ç±»Bçš„å†…å­˜å¸ƒå±€</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">+------------+|            || +--------+ |     +---------+| | B.vptr+-------&gt;+ B::FB() || | B::b   | |     +---------+| +--------+ || +--------| |     +---------+| | A.vptr+-------&gt;+ A::FA() || | A::a   | |     +---------+| +--------+ ||            |+------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Bçš„å†…å­˜DUMP</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">&gt;&gt;&gt; x /4a &amp;b0x7fffffffe3a0: 0x400b60 &lt;_ZTV1B+24&gt;    0x22222222222222220x7fffffffe3b0: 0x400b80 &lt;_ZTV1B+56&gt;    0x1111111111111111&gt;&gt;&gt; x /1a 0x400b600x400b60 &lt;_ZTV1B+24&gt;:   0x400960 &lt;B::FB()&gt;&gt;&gt;&gt; x /1a 0x400b800x400b80 &lt;_ZTV1B+56&gt;:   0x400950 &lt;A::FA()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>å¯¹ç±»Dçš„åˆ†æ</p><ul><li><p>ç±»Dçš„å†…å­˜å¸ƒå±€</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">+----------------+|                || +------------+ || |            | || | +--------+ | |      +---------+| | | B.vptr+----------&gt;+ B::FB() || | | B::b   | | |      | D::FD() || | +--------+ | |      +---------+| | +--------| | |      +---------+| | | C.vptr+----------&gt;+ C::FC() || | | C::c   | | |      +---------+| | +--------+ | || |            | || +------------+ ||                ||     D::d       ||                ||   +--------+   |      +---------+|   | A.vptr+----------&gt;+ A::FA() ||   | A::a   |   |      +---------+|   +--------+   ||                |+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»Dçš„å†…å­˜DUMP</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">&gt;&gt;&gt; x /7a &amp;d0x7fffffffe348: 0x400c60 &lt;_ZTV1D+24&gt;    0x22222222222222220x7fffffffe358: 0x400c88 &lt;_ZTV1D+64&gt;    0x33333333333333330x7fffffffe368: 0x4444444444444444      0x400ca8 &lt;_ZTV1D+96&gt;0x7fffffffe378: 0x1111111111111111&gt;&gt;&gt; x /2a 0x400c600x400c60 &lt;_ZTV1D+24&gt;:   0x400960 &lt;B::FB()&gt;      0x400a00 &lt;D::FD()&gt;&gt;&gt;&gt; x /1a 0x400c880x400c88 &lt;_ZTV1D+64&gt;:   0x400970 &lt;C::FC()&gt;&gt;&gt;&gt; x /1a 0x400ca80x400ca8 &lt;_ZTV1D+96&gt;:   0x400950 &lt;A::FA()&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ol><hr><h2 id="å››ã€åˆ†æç»“è®º"><a href="#å››ã€åˆ†æç»“è®º" class="headerlink" title="å››ã€åˆ†æç»“è®º"></a>å››ã€åˆ†æç»“è®º</h2><h3 id="4-1-ç»“è®º1"><a href="#4-1-ç»“è®º1" class="headerlink" title="4.1 ç»“è®º1"></a>4.1 ç»“è®º1</h3><p>è±å½¢éè™šç»§æ‰¿æ—¶ VS2017 ã€ G++ 7.5 å’Œ Clang++ 6 ç¼–è¯‘ç”Ÿæˆçš„ç±»çš„å†…å­˜å¸ƒå±€ç›¸åŒã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+----------------+|                || +------------+ || |            | |      +---------+| | +--------+ | |      |         || | | A.vptr+----------&gt;+ A::FA() || | | A::a   | | |      | B::FB() || | +--------+ | |      | D::FD() || |   B::b     | |      |         || +------------+ |      +---------+|                || +------------+ || |            | |      +---------+| | +--------+ | |      |         || | | A.vptr+----------&gt;+ A::FA() || | | A::a   | | |      | C::FC() || | +--------+ | |      |         || |   C::c     | |      +---------+| +------------+ ||                ||     D::d       ||                |+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-ç»“è®º2"><a href="#4-2-ç»“è®º2" class="headerlink" title="4.2 ç»“è®º2"></a>4.2 ç»“è®º2</h3><p>è±å½¢è™šæ‹Ÿç»§æ‰¿æ—¶ VS2017 ç¼–è¯‘ç”Ÿæˆç±»çš„å†…å­˜å¸ƒå±€ä¸ G++ 7.5 å’Œ Clang++ 6 çš„ç»“æœä¸åŒã€‚</p><ul><li><p>VS2017ç”Ÿæˆçš„ç±»çš„å†…å­˜å¸ƒå±€ï¼š</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">                +--------------+                |              |+---------+     | +----------+ || B::FB() +&lt;--------+B.vptr   | |      +--------------------+| D::FD() |     | | B.offset+--------&gt;+ offset2ptr    = -8 |+---------+     | | B::b     | |      | offset2A.vptr = 48 |                | +----------+ |      | offset2vptr   = -8 |                |              |      | offset2C.vptr = 24 |+---------+     | +----------+ |      +--------------------+| C::FC() +&lt;-------+C.vptr   | |      +--------------------++---------+     | | C.offset+--------&gt;+ offset2vptr   = -8 |                | | C::c     | |      | offset2A.vptr = 24 |                | +----------+ |      +--------------------+                |              |                |   D::d       |                |              |+---------+     | +----------+ || A::FA() +&lt;-------+A.vptr   | |+---------+     | | A::a     | |                | +----------+ |                |              |                +--------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>G++ 7.5 å’Œ Clang++ 6 ç”Ÿæˆçš„ç±»çš„å†…å­˜å¸ƒå±€ç›¸åŒï¼š</p>  <pre class="line-numbers language-text" data-language="text"><code class="language-text">+----------------+|                || +------------+ || |            | || | +--------+ | |      +---------+| | | B.vptr+----------&gt;+ B::FB() || | | B::b   | | |      | D::FD() || | +--------+ | |      +---------+| | +--------| | |      +---------+| | | C.vptr+----------&gt;+ C::FC() || | | C::c   | | |      +---------+| | +--------+ | || |            | || +------------+ ||                ||     D::d       ||                ||   +--------+   |      +---------+|   | A.vptr+----------&gt;+ A::FA() ||   | A::a   |   |      +---------+|   +--------+   ||                |+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> é€†å‘å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šå·¦è€³å¬é£ã€‹å­¦ä¹ ç¬”è®°</title>
      <link href="zuo-er-ting-feng-xue-xi-bi-ji/"/>
      <url>zuo-er-ting-feng-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç¨‹åºå‘˜å¦‚ä½•ç”¨æŠ€æœ¯å˜ç°"><a href="#ä¸€ã€ç¨‹åºå‘˜å¦‚ä½•ç”¨æŠ€æœ¯å˜ç°" class="headerlink" title="ä¸€ã€ç¨‹åºå‘˜å¦‚ä½•ç”¨æŠ€æœ¯å˜ç°"></a>ä¸€ã€ç¨‹åºå‘˜å¦‚ä½•ç”¨æŠ€æœ¯å˜ç°</h2><h3 id="ï¼ˆä¸€ï¼‰ä¸€äº›å­¦ä¹ ç»éªŒ"><a href="#ï¼ˆä¸€ï¼‰ä¸€äº›å­¦ä¹ ç»éªŒ" class="headerlink" title="ï¼ˆä¸€ï¼‰ä¸€äº›å­¦ä¹ ç»éªŒ"></a>ï¼ˆä¸€ï¼‰ä¸€äº›å­¦ä¹ ç»éªŒ</h3><ol><li>è¦å»ç»å†å¤§å¤šæ•°äººç»å†ä¸åˆ°çš„ï¼Œè¦æŠŠå­¦ä¹ æ—¶é—´èŠ±åœ¨é‚£äº›æ¯”è¾ƒéš¾çš„åœ°æ–¹ã€‚</li><li>è¦å†™æ–‡ç« å°±è¦å†™æ²¡æœ‰äººå†™è¿‡çš„ï¼Œæˆ–æ˜¯åˆ«äººå†™è¿‡ï¼Œä½†æˆ‘èƒ½å†™å¾—æ›´å¥½çš„ã€‚</li><li>æ›´é‡è¦çš„æ˜¯ï¼ŒæŠ€æœ¯å’ŒçŸ¥è¯†å®Œå…¨æ˜¯å¯ä»¥å˜ç°çš„ã€‚</li></ol><h3 id="ï¼ˆäºŒï¼‰å¦‚ä½•ä¿æŒç«äº‰åŠ›"><a href="#ï¼ˆäºŒï¼‰å¦‚ä½•ä¿æŒç«äº‰åŠ›" class="headerlink" title="ï¼ˆäºŒï¼‰å¦‚ä½•ä¿æŒç«äº‰åŠ›"></a>ï¼ˆäºŒï¼‰å¦‚ä½•ä¿æŒç«äº‰åŠ›</h3><p>ä¸€ä¸ªæ˜¯æŠ€æœ¯å’ŒæŠ€èƒ½çš„é¢†å…ˆï¼ŒäºŒæ˜¯å¯¹æŠ€æœ¯æœ¬è´¨å’Œè¶‹åŠ¿çš„æ•æ„Ÿåº¦ã€‚</p><h3 id="ï¼ˆä¸‰ï¼‰å¦‚ä½•è®©è‡ªå·±çš„æŠ€èƒ½å˜ç°"><a href="#ï¼ˆä¸‰ï¼‰å¦‚ä½•è®©è‡ªå·±çš„æŠ€èƒ½å˜ç°" class="headerlink" title="ï¼ˆä¸‰ï¼‰å¦‚ä½•è®©è‡ªå·±çš„æŠ€èƒ½å˜ç°"></a>ï¼ˆä¸‰ï¼‰å¦‚ä½•è®©è‡ªå·±çš„æŠ€èƒ½å˜ç°</h3><h4 id="1-åƒé‡Œä¹‹è¡Œï¼Œç§¯äºè·¬æ­¥"><a href="#1-åƒé‡Œä¹‹è¡Œï¼Œç§¯äºè·¬æ­¥" class="headerlink" title="1.åƒé‡Œä¹‹è¡Œï¼Œç§¯äºè·¬æ­¥"></a>1.åƒé‡Œä¹‹è¡Œï¼Œç§¯äºè·¬æ­¥</h4><p>æŒæ¡å¤§å¤šæ•°äººä¸èƒ½æŒæ¡çš„æŠ€èƒ½æˆ–æŠ€æœ¯ï¼Œéœ€è¦ä½ æ›´å¤šåœ°å­¦ä¹ ï¼Œå¹¶è¦æœ‰æ›´å¤šçš„åˆ«äººæ²¡æœ‰çš„ç»éªŒå’Œç»å†ã€‚</p><h4 id="2-å…³æ³¨æœ‰ä»·å€¼çš„ä¸œè¥¿"><a href="#2-å…³æ³¨æœ‰ä»·å€¼çš„ä¸œè¥¿" class="headerlink" title="2.å…³æ³¨æœ‰ä»·å€¼çš„ä¸œè¥¿"></a>2.å…³æ³¨æœ‰ä»·å€¼çš„ä¸œè¥¿</h4><ul><li>å…³äºå¸‚åœºéœ€æ±‚ã€‚ä½ è¦çœ‹æ¸…å¸‚åœºï¼Œå°±éœ€è¦çœ‹çœ‹å„ä¸ªå…¬å¸éƒ½åœ¨åšä»€ä¹ˆï¼Œä»–ä»¬çš„éš¾é¢˜æ˜¯ä»€ä¹ˆã€‚</li><li>å…³äºæŠ€æœ¯è¶‹åŠ¿ã€‚è¦çœ‹ä¸€ä¸ªæ–°çš„æŠ€æœ¯æ˜¯å¦é¡ºåº”æŠ€æœ¯å‘å±•è¶‹åŠ¿ï¼Œä½ éœ€è¦å°†ä¸€äº›è€æŠ€æœ¯çš„æœ¬è´¨åƒå¾—å¾ˆé€ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨å­¦ä¹ æŠ€æœ¯çš„è¿‡ç¨‹ä¸€å®šè¦å¤šé—®è‡ªå·±ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>ä¸€ï¼Œè¿™ä¸ªæŠ€æœ¯è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆåˆ«çš„åŒç±»æŠ€æœ¯åšä¸åˆ°ï¼Ÿ</li><li>äºŒï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™æ ·è§£å†³çš„ï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼ï¼Ÿ</li></ul><p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç®€å•çš„åˆ¤æ–­æ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªæ–°çš„æŠ€æœ¯é¡ºåº”æŠ€æœ¯å‘å±•è¶‹åŠ¿ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ–°çš„æŠ€æœ¯å‡ºç°æ—¶ï¼Œåé¢ä¸€å®šä¼šæœ‰å¤§å‹çš„å•†ä¸šå…¬å¸æ”¯æŒï¼Œè¿™ç±»å…¬å¸æ”¯æŒå¾—è¶Šå¤šï¼Œå°±è¯´æ˜ä½ è¶Šéœ€è¦å…³æ³¨ã€‚</p><h4 id="3-æ‰¾åˆ°èƒ½ä½“ç°ä»·å€¼çš„åœ°æ–¹"><a href="#3-æ‰¾åˆ°èƒ½ä½“ç°ä»·å€¼çš„åœ°æ–¹" class="headerlink" title="3.æ‰¾åˆ°èƒ½ä½“ç°ä»·å€¼çš„åœ°æ–¹"></a>3.æ‰¾åˆ°èƒ½ä½“ç°ä»·å€¼çš„åœ°æ–¹</h4><ul><li>åœ¨ä¸€å®¶é«˜é€Ÿå‘å±•çš„å…¬å¸ä¸­ï¼ŒæŠ€æœ¯äººå‘˜çš„ä»·å€¼å¯ä»¥è¾¾åˆ°æœ€å¤§åŒ–ã€‚</li><li>åœ¨ä¸€å®¶å¤§å…¬å¸ä¸­ï¼ŒæŠ€æœ¯æ¶æ„å’Œä¸šåŠ¡å·²ç»å®šå‹ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå¤ªå¤šçš„äº‹å¯ä»¥åšçš„ã€‚è€Œä¸”å¯¹äºå·²ç»å‘å±•èµ·æ¥çš„å¤§å…¬å¸æ¥è¯´ï¼Œå¾€å¾€ç¨³å®šçš„é‡è¦æ€§è¶…è¿‡äº†åˆ›æ–°ã€‚</li><li>è€Œåˆšèµ·æ­¥çš„å…¬å¸ï¼Œä¸šåŠ¡è¿˜æ²¡æœ‰è·‘é¡ºï¼Œå…¬å¸çš„ä¸»è¦ç²¾åŠ›ä¼šæ”¾åœ¨ä¸šåŠ¡æ‹“å±•ä¸Šï¼Œè¿™ä¸ªæ—¶å€™ä¹Ÿä¸å¤ªéœ€è¦é«˜ç²¾å°–çš„æŠ€æœ¯ï¼Œæ‰€ä»¥ï¼ŒæŠ€æœ¯äººå‘˜çš„ä»·å€¼ä¹Ÿä½“ç°ä¸å‡ºæ¥ã€‚</li><li>æ¯”è¾ƒå¥½çš„æˆé•¿è·¯å¾„æ˜¯ï¼Œå…ˆè¿›å…¥å¤§å…¬å¸å­¦ä¹ å¤§å…¬å¸çš„æŠ€æœ¯å’ŒæˆåŠŸçš„ç»éªŒæ–¹æ³•ï¼Œç„¶åå†æ‰¾åˆ°é«˜é€Ÿæˆé•¿çš„å…¬å¸ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å®ç°è‡ªå·±æ›´å¤šçš„ä»·å€¼ã€‚</li></ul><h4 id="4-åŠ¨æ‰‹èƒ½åŠ›å¾ˆé‡è¦"><a href="#4-åŠ¨æ‰‹èƒ½åŠ›å¾ˆé‡è¦" class="headerlink" title="4.åŠ¨æ‰‹èƒ½åŠ›å¾ˆé‡è¦"></a>4.åŠ¨æ‰‹èƒ½åŠ›å¾ˆé‡è¦</h4><ul><li>åœ¨è§£å†³ä»»ä½•ä¸€ä¸ªå…·ä½“é—®é¢˜çš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰åŠ¨æ‰‹èƒ½åŠ›å°±æˆä¸ºäº†å…³é”®ã€‚</li><li>ä»£ç é‡Œå…¨æ˜¯ç»†èŠ‚ï¼Œç»†èŠ‚æ˜¯é­”é¬¼ï¼Œåªæœ‰äº†è§£äº†ç»†èŠ‚ï¼Œä½ æ‰èƒ½æå‡ºæ›´å¥½æˆ–æ˜¯æ›´é è°±ã€å¯ä»¥è½åœ°çš„è§£å†³æ–¹æ¡ˆã€‚è€Œä¸æ˜¯ä¸€äº›ç¬¼ç»Ÿå’Œæ¨¡ç³Šçš„ä¸œè¥¿ã€‚</li></ul><h4 id="5-å…³æ³¨æŠ€æœ¯ä»˜è´¹ç‚¹"><a href="#5-å…³æ³¨æŠ€æœ¯ä»˜è´¹ç‚¹" class="headerlink" title="5.å…³æ³¨æŠ€æœ¯ä»˜è´¹ç‚¹"></a>5.å…³æ³¨æŠ€æœ¯ä»˜è´¹ç‚¹</h4><p>æŠ€æœ¯ä»˜è´¹ç‚¹åŸºæœ¬ä½“ç°åœ¨ä¸¤ä¸ªåœ°æ–¹:</p><ul><li>èƒ½å¸®åˆ«äººâ€œæŒ£é’±â€çš„åœ°æ–¹ï¼›</li><li>èƒ½å¸®åˆ«äººâ€œçœé’±â€çš„åœ°æ–¹ã€‚</li></ul><h4 id="6-æå‡è‡ªå·±çš„èƒ½åŠ›å’Œç»å†"><a href="#6-æå‡è‡ªå·±çš„èƒ½åŠ›å’Œç»å†" class="headerlink" title="6.æå‡è‡ªå·±çš„èƒ½åŠ›å’Œç»å†"></a>6.æå‡è‡ªå·±çš„èƒ½åŠ›å’Œç»å†</h4><ul><li>å‚ä¸çŸ¥åçš„å¼€æºé¡¹ç›®ã€‚</li><li>æˆä¸ºå…¬å¸æ ¸å¿ƒé¡¹ç›®çš„å¼€å‘äººå‘˜ã€‚</li></ul><h4 id="7-æ‰¾åˆ°æœ‰ä»·å€¼çš„ä¿¡æ¯æº"><a href="#7-æ‰¾åˆ°æœ‰ä»·å€¼çš„ä¿¡æ¯æº" class="headerlink" title="7.æ‰¾åˆ°æœ‰ä»·å€¼çš„ä¿¡æ¯æº"></a>7.æ‰¾åˆ°æœ‰ä»·å€¼çš„ä¿¡æ¯æº</h4><ul><li>å¦‚æœä½ çš„ä¿¡æ¯æ¥è‡ªæœ‹å‹åœˆã€å¾®åšã€çŸ¥ä¹ã€ç™¾åº¦æˆ–æ˜¯ä»Šæ—¥å¤´æ¡ï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—ä½ å®Œè›‹äº†ã€‚è¿™äº›æ¸ é“æœ‰ä»·å€¼çš„ä¿¡æ¯ä¸å¤šã€‚</li><li>ç”¨å¥½ Googleï¼Œæ¯”å¦‚ä½ åœ¨ Google æœç´¢å¼•æ“é‡Œè¾“å…¥ â€œXXX Best Practiceâ€ï¼Œæˆ–æ˜¯ â€œBest programming resourceâ€â€¦â€¦ä½ å°±ä¼šæ‰¾åˆ°å¾ˆå¤šã€‚</li></ul><h4 id="8-è¾“å‡ºè§‚ç‚¹å’Œä»·å€¼è§‚"><a href="#8-è¾“å‡ºè§‚ç‚¹å’Œä»·å€¼è§‚" class="headerlink" title="8.è¾“å‡ºè§‚ç‚¹å’Œä»·å€¼è§‚"></a>8.è¾“å‡ºè§‚ç‚¹å’Œä»·å€¼è§‚</h4><h4 id="9-æœ‹å‹åœˆå¾ˆé‡è¦"><a href="#9-æœ‹å‹åœˆå¾ˆé‡è¦" class="headerlink" title="9.æœ‹å‹åœˆå¾ˆé‡è¦"></a>9.æœ‹å‹åœˆå¾ˆé‡è¦</h4><p>ä¼˜è´¨çš„æœ‹å‹åœˆåŸºæœ¬ä¸Šéƒ½æœ‰è¿™æ ·çš„ç‰¹æ€§ï¼š</p><ul><li>è¿™äº›äººéƒ½æ¯”è¾ƒæœ‰æƒ³æ³•ã€æœ‰è§‚ç‚¹ï¼Œç»éªŒä¹Ÿæ¯”è¾ƒä¸°å¯Œï¼›</li><li>è¿™äº›äººæ¶‰çŒçš„é¢æ¯”è¾ƒå¹¿ï¼›</li><li>è¿™äº›äººéƒ½æœ‰æˆ–å¤šæˆ–å°‘çš„æˆåŠŸï¼›</li><li>è¿™äº›äººéƒ½æ˜¯å–œæ¬¢æŠ˜è…¾å–œæ¬¢æäº‹çš„äººï¼›</li><li>è¿™äº›äººéƒ½å¯¹ç°çŠ¶æœ‰äº›ä¸æ»¡ï¼Œå¹¶æƒ³åšä¸€äº›æ”¹å˜ï¼›</li><li>è¿™äº›äººéƒ½æœ‰ä¸€å®šçš„å½±å“åŠ›ã€‚</li></ul><p>æœ€åæœ‰ä¸ªå…³é”®çš„é—®é¢˜æ˜¯ï¼Œç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†ã€‚å¦‚æœä½ ä¸åšåˆ°è¿™äº›ï¼Œä½ æ€ä¹ˆèƒ½è¿›å…¥åˆ°è¿™æ ·çš„æœ‹å‹åœˆå‘¢ï¼Ÿ</p><p>æ€»ä¹‹ï¼Œå°±ä¸€å¥è¯ï¼Œ<strong>ä¼šæŒ£é’±çš„äººä¸€å®šæ˜¯ä¼šæŠ•èµ„çš„äººã€‚æˆ‘ä¸€ç›´è®¤ä¸ºï¼Œæœ€å®è´µçš„è´¢å¯Œå¹¶ä¸æ˜¯é’±ï¼Œè€Œæ˜¯ä½ çš„æ—¶é—´ï¼Œæ—¶é—´æ¯”é’±æ›´å®è´µï¼Œå› ä¸ºé’±ä½ ä¸ç”¨è¿˜åœ¨é‚£é‡Œï¼Œè€Œæ—¶é—´ä½ ä¸ç”¨å°±æµªè´¹æ‰äº†ã€‚ä½ æŠŠä½ çš„æ—¶é—´æŠ•èµ„åœ¨å“ªäº›åœ°æ–¹ï¼Œå°±æ„å‘³ç€ä½ æœªæ¥ä¼šèµ°ä»€ä¹ˆæ ·çš„è·¯ã€‚æ‰€ä»¥ï¼Œåˆ©ç”¨å¥½ä½ çš„æ—¶é—´ï¼ŒæŠ•åˆ°ä¸€äº›æœ‰æ„ä¹‰çš„åœ°æ–¹å§ã€‚</strong></p><h3 id="ï¼ˆå››ï¼‰å¦‚ä½•æŠ€æœ¯å˜ç°å¥—è·¯æ€»ç»“-æ¥è‡ªè¯„è®º"><a href="#ï¼ˆå››ï¼‰å¦‚ä½•æŠ€æœ¯å˜ç°å¥—è·¯æ€»ç»“-æ¥è‡ªè¯„è®º" class="headerlink" title="ï¼ˆå››ï¼‰å¦‚ä½•æŠ€æœ¯å˜ç°å¥—è·¯æ€»ç»“(æ¥è‡ªè¯„è®º)"></a>ï¼ˆå››ï¼‰å¦‚ä½•æŠ€æœ¯å˜ç°å¥—è·¯æ€»ç»“(æ¥è‡ªè¯„è®º)</h3><ol><li>ç¨‹åºå‘˜ç”¨æ‰‹è‰ºã€æŠ€æœ¯å…»æ´»è‡ªå·±ï¼Œä¸ä¾é å…¬å¸ï¼›</li><li>æé«˜å·¥ä½œæ•ˆç‡ï¼Œå»ç ”ç©¶é‚£äº›éš¾çš„ï¼Œå…¬å¸å†…å¤–çš„æ ¸å¿ƒæŠ€æœ¯ï¼›</li><li>æ³¨é‡è¾“å‡ºï¼Œè¾“å‡ºæŠ€æœ¯ã€ä»·å€¼è§‚ï¼Œå¸®åŠ©æ›´å¤šçš„äººï¼Œæé«˜å½±å“åŠ›ã€‚</li></ol><hr><h2 id="äºŒã€ä½•ä¸ºæŠ€æœ¯é¢†å¯¼åŠ›"><a href="#äºŒã€ä½•ä¸ºæŠ€æœ¯é¢†å¯¼åŠ›" class="headerlink" title="äºŒã€ä½•ä¸ºæŠ€æœ¯é¢†å¯¼åŠ›"></a>äºŒã€ä½•ä¸ºæŠ€æœ¯é¢†å¯¼åŠ›</h2><h3 id="ï¼ˆä¸€ï¼‰äººç±»ç¤¾ä¼šçš„å‘å±•é˜¶æ®µ"><a href="#ï¼ˆä¸€ï¼‰äººç±»ç¤¾ä¼šçš„å‘å±•é˜¶æ®µ" class="headerlink" title="ï¼ˆä¸€ï¼‰äººç±»ç¤¾ä¼šçš„å‘å±•é˜¶æ®µ"></a>ï¼ˆä¸€ï¼‰äººç±»ç¤¾ä¼šçš„å‘å±•é˜¶æ®µ</h3><ol><li>é‡è›®å¼€é‡‡ã€‚è¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ç‰¹ç‚¹æ˜¯èµ„æºè¿‡å¤šï¼Œåªéœ€è¦å¼€é‡‡å°±å¥½äº†ã€‚</li><li>èµ„æºæ•´åˆã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œèµ„æºå·²ç»è¢«ä¸åŒçš„äººç»™å æœ‰äº†ï¼Œä½†æ˜¯éœ€è¦å¯¹èµ„æºæ•´åˆä¼˜åŒ–ï¼Œæé«˜åˆ©ç”¨ç‡ã€‚è¿™æ—¶é€šè¿‡ç®¡ç†æ‰‹æ®µå°±èƒ½å®ç°ã€‚</li><li>ç²¾è€•ç»†ä½œã€‚è¿™ä¸ªé˜¶æ®µåŸºæœ¬ä¸Šæ˜¯å¯¹ç¬¬äºŒé˜¶æ®µçš„ç²¾ç»†åŒ–è¿ä½œï¼Œå¹¶ä¸”é€šè¿‡ç§‘å­¦çš„æ‰‹æ®µæ¥è¾¾åˆ°ã€‚</li><li>å‘æ˜åˆ›é€ ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œäººä»¬åˆ©ç”¨å·²æœ‰ä¸è¶³çš„èµ„æºæ¥åˆ›é€ æ›´å¥½çš„èµ„æºï¼Œå¹¶æ›¿ä»£å·²æœ‰çš„é©¬ä¸Šè¦æ¯ç«­çš„èµ„æºã€‚è¿™å°±éœ€è¦é‡‡ç”¨é«˜ç§‘æŠ€æ¥è¾¾åˆ°äº†ã€‚</li></ol><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåƒäºšé©¬é€Šã€Facebook è¿™æ ·çš„å…¬å¸ï¼Œæœ€ç»ˆéƒ½ä¼šå»å‘å±•è‡ªå·±çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæé«˜è‡ªå·±çš„æŠ€æœ¯é¢†å¯¼åŠ›ï¼Œä»æ—©æœŸçš„ä¸šåŠ¡å‹å…¬å¸è½¬å˜æˆä¸ºæŠ€æœ¯å‹å…¬å¸çš„åŸå› ã€‚é‚£äº›æœ¬æ¥æŠ€æœ¯å¾ˆå¥½çš„å…¬å¸ï¼Œæ¯”å¦‚é›…è™ã€ç™¾åº¦ï¼Œåœ¨å‘å±•åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œå°†è‡ªå·±å®šä½æˆäº†ä¸€ä¸ªå¹¿å‘Šå…¬å¸ï¼Œç„¶åå¼€å§‹å˜å‘³ã€èµ°ä¸‹å¡è·¯ã€‚</p><h3 id="ï¼ˆäºŒï¼‰å‡ æ¬¡å·¥ä¸šé©å‘½æ”¹å˜æœ¬è´¨"><a href="#ï¼ˆäºŒï¼‰å‡ æ¬¡å·¥ä¸šé©å‘½æ”¹å˜æœ¬è´¨" class="headerlink" title="ï¼ˆäºŒï¼‰å‡ æ¬¡å·¥ä¸šé©å‘½æ”¹å˜æœ¬è´¨"></a>ï¼ˆäºŒï¼‰å‡ æ¬¡å·¥ä¸šé©å‘½æ”¹å˜æœ¬è´¨</h3><ol><li>å…³é”®æŠ€æœ¯ã€‚è’¸æ±½æœºã€ç”µã€åŒ–å·¥ã€åŸå­èƒ½ã€ç‚¼é’¢ã€è®¡ç®—æœºï¼Œå¦‚æœåªçœ‹è¿™äº›ä¸œè¥¿çš„è¯ï¼Œä¼¼ä¹æ²¡ä»€ä¹ˆç”¨ã€‚ä½†è¿™äº›æ ¸å¿ƒæŠ€æœ¯çš„çªç ´ï¼Œå¯ä»¥è®©æˆ‘ä»¬å»ºé€ å¾ˆå¤šæ›´ç‰›çš„å·¥å…·ï¼Œè€Œè¿™äº›å·¥å…·èƒ½è®©äººç±»å¹²å‡ºä»¥å‰å¹²ä¸å‡ºæ¥çš„äº‹ã€‚</li><li>è‡ªåŠ¨åŒ–ã€‚è¿™å…¶ä¸­æœ€é‡è¦çš„äº‹å°±æ˜¯è‡ªåŠ¨åŒ–ã€‚ä¸‰æ¬¡é©å‘½ä¸­æœ€é‡è¦çš„äº‹å°±æ˜¯ç”¨æœºå™¨æ¥è‡ªåŠ¨åŒ–ã€‚é€šä¿¡ã€äº¤é€šã€å†›äº‹ã€æ•™è‚²ã€é‡‘èç­‰å„ä¸ªé¢†åŸŸéƒ½æ˜¯åœ¨æ‹¼å‘½åœ°è‡ªåŠ¨åŒ–ï¼Œä»¥æé«˜æ•ˆç‡â€”â€”ç”¨æ›´ä½çš„æˆæœ¬æ¥å®Œæˆæ›´å¤šçš„äº‹ã€‚</li><li>è§£æ”¾ç”Ÿäº§åŠ›ã€‚æŠŠäººä»åŠ³åŠ¨å¯†é›†å‹çš„å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ï¼Œå»åšæ›´é«˜å±‚æ¬¡çš„çŸ¥è¯†å¯†é›†å‹çš„å·¥ä½œã€‚è¯´å¾—éš¾å¬ä¸€ç‚¹ï¼Œå°±æ˜¯å–ä»£äººç±»ï¼Œè®©äººå¤±ä¸šã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»Šå¤©çš„ AI åœ¨å¼€å§‹å–ä»£äººç±»çš„çŸ¥è¯†å¯†é›†å‹çš„å·¥ä½œâ€¦â€¦</li></ol><h3 id="ï¼ˆä¸‰ï¼‰æŠ€æœ¯é¢†å¯¼åŠ›"><a href="#ï¼ˆä¸‰ï¼‰æŠ€æœ¯é¢†å¯¼åŠ›" class="headerlink" title="ï¼ˆä¸‰ï¼‰æŠ€æœ¯é¢†å¯¼åŠ›"></a>ï¼ˆä¸‰ï¼‰æŠ€æœ¯é¢†å¯¼åŠ›</h3><p>å›é¡¾å‡ æ¬¡å·¥ä¸šé©å‘½æ”¹å˜æœ¬è´¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„æŠ€æœ¯é¢†å¯¼åŠ›æ˜¯ï¼š</p><ul><li>å°Šé‡æŠ€æœ¯ï¼Œè¿½æ±‚æ ¸å¿ƒåŸºç¡€æŠ€æœ¯ã€‚</li><li>è¿½é€è‡ªåŠ¨åŒ–çš„é«˜æ•ˆç‡çš„å·¥å…·å’ŒæŠ€æœ¯ï¼ŒåŒæ—¶é¿å…æ— æ•ˆç‡çš„ç»„ç»‡æ¶æ„å’Œç®¡ç†ã€‚</li><li>è§£æ”¾ç”Ÿäº§åŠ›ï¼Œè¿½é€äººæ•ˆçš„æé«˜ã€‚å¼€å‘æŠ½è±¡å’Œé«˜è´¨é‡çš„å¯ä»¥é‡ç”¨çš„æŠ€æœ¯ç»„ä»¶ã€‚</li><li>åšæŒé«˜äºç¤¾ä¼šä¸»æµçš„æŠ€æœ¯æ ‡å‡†å’Œè¦æ±‚ã€‚</li></ul><h3 id="ï¼ˆå››ï¼‰å¦‚ä½•æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›"><a href="#ï¼ˆå››ï¼‰å¦‚ä½•æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›" class="headerlink" title="ï¼ˆå››ï¼‰å¦‚ä½•æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›"></a>ï¼ˆå››ï¼‰å¦‚ä½•æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›</h3><p>ä½œä¸ºä¸€ä¸ªè½¯ä»¶å·¥ç¨‹å¸ˆæ€æ ·æ‰ç®—æ˜¯æ‹¥æœ‰â€œæŠ€æœ¯é¢†å¯¼åŠ›â€ï¼š</p><ul><li>èƒ½å¤Ÿå‘ç°é—®é¢˜ã€‚èƒ½å¤Ÿå‘ç°ç°æœ‰æ–¹æ¡ˆçš„é—®é¢˜ã€‚</li><li>èƒ½å¤Ÿæä¾›è§£å†³é—®é¢˜çš„æ€è·¯å’Œæ–¹æ¡ˆï¼Œå¹¶èƒ½æ¯”è¾ƒè¿™äº›æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€‚</li><li>èƒ½å¤Ÿåšå‡ºæ­£ç¡®çš„æŠ€æœ¯å†³å®šã€‚ç”¨ä»€ä¹ˆæ ·çš„æŠ€æœ¯ã€ä»€ä¹ˆè§£å†³æ–¹æ¡ˆã€æ€æ ·å®ç°æ¥å®Œæˆä¸€ä¸ªé¡¹ç›®ã€‚</li><li>èƒ½å¤Ÿç”¨æ›´ä¼˜é›…ï¼Œæ›´ç®€å•ï¼Œæ›´å®¹æ˜“çš„æ–¹å¼æ¥è§£å†³é—®é¢˜ã€‚</li><li>èƒ½å¤Ÿæé«˜ä»£ç æˆ–è½¯ä»¶çš„æ‰©å±•æ€§ã€é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li>èƒ½å¤Ÿç”¨æ­£ç¡®çš„æ–¹å¼ç®¡ç†å›¢é˜Ÿã€‚æ‰€è°“æ­£ç¡®çš„æ–¹å¼ï¼Œä¸€æ–¹é¢æ˜¯ï¼Œè®©æ­£ç¡®çš„äººåšæ­£ç¡®çš„äº‹ï¼Œå¹¶å‘æŒ¥æ¯ä¸ªäººçš„æ½œåŠ›ï¼›å¦ä¸€æ–¹é¢æ˜¯ï¼Œå¯ä»¥æé«˜å›¢é˜Ÿçš„ç”Ÿäº§åŠ›å’Œäººæ•ˆï¼Œæ‰¾åˆ°æœ€æœ‰ä»·å€¼çš„éœ€æ±‚ï¼Œç”¨æœ€å°‘çš„æˆæœ¬å®ç°ä¹‹ã€‚å¹¶ä¸”ï¼Œå¯ä»¥ä¸æ–­åœ°æé«˜è‡ªèº«å’Œå›¢é˜Ÿçš„æ ‡å‡†ã€‚</li><li>åˆ›æ–°èƒ½åŠ›ã€‚èƒ½å¤Ÿä½¿ç”¨æ–°çš„æ–¹æ³•æ–°çš„æ–¹å¼è§£å†³é—®é¢˜ï¼Œè¿½é€æ–°çš„å·¥å…·å’ŒæŠ€æœ¯ã€‚</li></ul><p>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯ï¼š</p><ul><li>æ‰å®çš„åŸºç¡€æŠ€æœ¯ï¼›</li><li>éåŒä¸€èˆ¬çš„å­¦ä¹ èƒ½åŠ›ï¼›</li><li>åšæŒåšæ­£ç¡®çš„äº‹ï¼›</li><li>ä¸æ–­æé«˜å¯¹è‡ªå·±çš„è¦æ±‚æ ‡å‡†ï¼›</li></ul><hr><h2 id="ä¸‰ã€å¦‚ä½•æ‰èƒ½æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›"><a href="#ä¸‰ã€å¦‚ä½•æ‰èƒ½æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›" class="headerlink" title="ä¸‰ã€å¦‚ä½•æ‰èƒ½æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›"></a>ä¸‰ã€å¦‚ä½•æ‰èƒ½æ‹¥æœ‰æŠ€æœ¯é¢†å¯¼åŠ›</h2><h3 id="ï¼ˆä¸€ï¼‰ã€åƒé€åŸºç¡€æŠ€æœ¯"><a href="#ï¼ˆä¸€ï¼‰ã€åƒé€åŸºç¡€æŠ€æœ¯" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€åƒé€åŸºç¡€æŠ€æœ¯"></a>ï¼ˆä¸€ï¼‰ã€åƒé€åŸºç¡€æŠ€æœ¯</h3><p>åŸºç¡€æŠ€æœ¯æ˜¯å„ç§ä¸Šå±‚æŠ€æœ¯å…±åŒçš„åŸºç¡€ã€‚åƒé€åŸºç¡€æŠ€æœ¯æ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£ç¨‹åºçš„è¿è¡ŒåŸç†ï¼Œå¹¶åŸºäºè¿™äº›åŸºç¡€æŠ€æœ¯è¿›åŒ–å‡ºæ›´ä¼˜åŒ–çš„äº§å“ã€‚</p><p>åŸºç¡€æŠ€æœ¯ä¸»è¦åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šç¼–ç¨‹å’Œç³»ç»Ÿã€‚</p><p>ç¼–ç¨‹éƒ¨åˆ†</p><ul><li>Cè¯­è¨€</li><li>ç¼–ç¨‹èŒƒå¼</li><li>ç®—æ³•å’Œæ•°æ®ç»“æ„</li></ul><p>ç³»ç»Ÿéƒ¨åˆ†</p><ul><li>è®¡ç®—æœºç³»ç»ŸåŸç†</li><li>æ“ä½œç³»ç»ŸåŸç†å’ŒåŸºç¡€</li><li>ç½‘ç»œåŸºç¡€</li><li>æ•°æ®åº“åŸç†</li><li>åˆ†å¸ƒå¼æŠ€æœ¯æ¶æ„</li></ul><h3 id="ï¼ˆäºŒï¼‰ã€æé«˜å­¦ä¹ èƒ½åŠ›"><a href="#ï¼ˆäºŒï¼‰ã€æé«˜å­¦ä¹ èƒ½åŠ›" class="headerlink" title="ï¼ˆäºŒï¼‰ã€æé«˜å­¦ä¹ èƒ½åŠ›"></a>ï¼ˆäºŒï¼‰ã€æé«˜å­¦ä¹ èƒ½åŠ›</h3><p>æ‰€è°“å­¦ä¹ èƒ½åŠ›ï¼Œå°±æ˜¯èƒ½å¤Ÿå¾ˆå¿«åœ°å­¦ä¹ æ–°æŠ€æœ¯ï¼Œåˆèƒ½åœ¨å…³é”®æŠ€æœ¯ä¸Šæ·±å…¥çš„èƒ½åŠ›ã€‚åªæœ‰åœ¨æŒæ¡äº†ä¸Šè¿°çš„åŸºç¡€åŸç†ä¹‹ä¸Šï¼Œä½ æ‰èƒ½æ‹¥æœ‰å¥½çš„å­¦ä¹ èƒ½åŠ›ã€‚å¦‚ä½•æé«˜å‘¢ï¼Ÿ</p><ul><li>å­¦ä¹ çš„ä¿¡æ¯æºã€‚ä¿¡æ¯æºå¾ˆé‡è¦ï¼Œæœ‰å¥½çš„ä¿¡æ¯æºå°±å¯ä»¥æ›´å¿«é€Ÿåœ°è·å–æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œå¹¶æå‡å­¦ä¹ æ•ˆç‡ã€‚å¸¸è§çš„ä¿¡æ¯æºæœ‰ Google ç­‰æœç´¢å¼•æ“ï¼ŒStack Overflowã€Quora ç­‰ç¤¾åŒºï¼Œå›¾ä¹¦ï¼ŒAPI æ–‡æ¡£ï¼Œè®ºæ–‡å’Œåšå®¢ç­‰ã€‚</li><li>ä¸é«˜æ‰‹äº¤æµã€‚ç¨‹åºå‘˜å¯ä»¥é€šè¿‡æŠ€æœ¯ç¤¾åŒºä»¥åŠå‚åŠ æŠ€æœ¯ä¼šè®®ä¸é«˜æ‰‹äº¤æµï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‚åŠ å¼€æºé¡¹ç›®æ¥å’Œé«˜æ‰‹åˆ‡ç£‹ã€‚</li><li>ä¸¾ä¸€åä¸‰çš„æ€è€ƒã€‚æ¯”å¦‚ï¼Œäº†è§£äº†æ“ä½œç³»ç»Ÿçš„ç¼“å­˜å’Œç½‘é¡µç¼“å­˜ä»¥åï¼Œä½ è¦æ€è€ƒå…¶ç›¸åŒç‚¹å’Œä¸åŒç‚¹ã€‚</li><li>ä¸æ€•å›°éš¾çš„æ€åº¦ã€‚</li><li>å¼€æ”¾çš„å¿ƒæ€ã€‚å®ç°ä¸€ä¸ªç›®çš„é€šå¸¸æœ‰å¤šç§åŠæ³•ã€‚å¸¦æœ‰å¼€æ”¾çš„å¿ƒæ€ï¼Œä¸æ‹˜æ³¥äºä¸€ä¸ªå¹³å°ã€ä¸€ç§è¯­è¨€ï¼Œå¾€å¾€èƒ½å¸¦æ¥æ›´å¤šæ€è€ƒï¼Œä¹Ÿèƒ½å¾—åˆ°æ›´å¥½çš„ç»“æœã€‚è€Œä¸”ï¼Œèƒ½åœ¨ä¸åŒçš„æ–¹æ³•å’Œæ–¹æ¡ˆé—´åšæ¯”è¾ƒï¼Œæ¯”è¾ƒå®ƒä»¬çš„ä¼˜ç¼ºç‚¹ï¼Œé‚£ä¹ˆä½ ä¼šçŸ¥é“åœ¨ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹ç”¨ä»€ä¹ˆæ ·çš„æ–¹æ¡ˆï¼Œä½ å°±ä¼šæ¯”ä¸€èˆ¬äººèƒ½å¤Ÿæœ‰æ›´å…¨é¢å’Œæ›´å®Œæ•´çš„æ€è·¯ã€‚</li></ul><h3 id="ï¼ˆä¸‰ï¼‰ã€åšæŒåšæ­£ç¡®çš„äº‹"><a href="#ï¼ˆä¸‰ï¼‰ã€åšæŒåšæ­£ç¡®çš„äº‹" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€åšæŒåšæ­£ç¡®çš„äº‹"></a>ï¼ˆä¸‰ï¼‰ã€åšæŒåšæ­£ç¡®çš„äº‹</h3><p>åšæ­£ç¡®çš„äº‹ï¼Œæ¯”ç”¨æ­£ç¡®çš„æ–¹å¼åšäº‹æ›´é‡è¦ï¼Œå› ä¸ºè¿™æ ·æ‰å§‹ç»ˆä¼šå‘ç›®çš„åœ°é æ‹¢ã€‚å“ªäº›æ˜¯æ­£ç¡®çš„äº‹å‘¢ï¼Ÿ</p><ul><li>æé«˜æ•ˆç‡çš„äº‹ã€‚ä½ è¦å­¦ä¹ å’ŒæŒæ¡è‰¯å¥½çš„æ—¶é—´ç®¡ç†æ–¹å¼ï¼Œç®¡ç†å¥½è‡ªå·±çš„æ—¶é—´ï¼Œèƒ½æ˜¾è‘—æé«˜è‡ªå·±çš„æ•ˆç‡ã€‚</li><li>è‡ªåŠ¨åŒ–çš„äº‹ã€‚ç¨‹åºå‘˜è¦å……åˆ†åˆ©ç”¨è‡ªå·±çš„èŒä¸šç‰¹è´¨ï¼Œå½“çœ‹è§æœ‰å¯ä»¥è‡ªåŠ¨åŒ–çš„æ­¥éª¤æ—¶ï¼Œç¼–å†™ç¨‹åºæ¥è‡ªåŠ¨åŒ–æ“ä½œï¼Œå¯ä»¥æ˜¾è‘—æé«˜æ•ˆç‡ã€‚</li><li>æŒæ¡å‰æ²¿æŠ€æœ¯çš„äº‹ã€‚æŒæ¡å‰æ²¿çš„æŠ€æœ¯ï¼Œæœ‰åˆ©äºæ‹“å±•è‡ªå·±çš„çœ¼ç•Œï¼Œä¹Ÿæœ‰åˆ©äºæ‰¾åˆ°æ›´å¥½çš„å·¥ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›æŠ€æœ¯è™½ç„¶å½“ä¸‹å¾ˆç«ï¼Œä½†æœªå¿…å‰æ²¿ï¼Œè€Œæ˜¯å› ä¸ºå®ƒæ¯”è¾ƒæ˜“å­¦æ˜“ç”¨ï¼Œæˆ–è€…æ€§ä»·æ¯”é«˜ã€‚ç”±äºå­¦ä¹ ä¸€é—¨æŠ€æœ¯éœ€è¦èŠ±è´¹ä¸å°‘æ—¶é—´ï¼Œä½ åº”è¯¥é€‰æ‹©è‡ªå·±æœ€æ„Ÿå…´è¶£çš„ï¼Œæœ‰çš„æ”¾çŸ¢åœ°å»å­¦ä¹ ã€‚</li><li>çŸ¥è¯†å¯†é›†å‹çš„äº‹ã€‚çŸ¥è¯†å¯†é›†å‹æ˜¯ç›¸å¯¹äºåŠ³åŠ¨å¯†é›†å‹æ¥è¯´çš„ã€‚åŸºæœ¬ä¸Šï¼ŒåŠ³åŠ¨å¯†é›†å‹çš„äº‹éƒ½èƒ½é€šè¿‡ç¨‹åºå’Œæœºå™¨æ¥å®Œæˆï¼Œè€ŒçŸ¥è¯†å¯†é›†å‹çš„äº‹å´ä»éœ€è¦äººæ¥å®Œæˆï¼Œæ‰€ä»¥äººçš„ä»·å€¼æ­¤æ—¶å°±æ˜¾ç°å‡ºæ¥äº†ã€‚</li><li>æŠ€æœ¯é©±åŠ¨çš„äº‹ã€‚ä¸ä»…æ˜¯æŒ‡ç”¨ç¨‹åºé©±åŠ¨çš„äº‹ï¼Œè€Œä¸”è¿˜åŒ…æ‹¬ä¸€åˆ‡æŠ€æœ¯æ”¹å˜ç”Ÿæ´»çš„äº‹ã€‚æ¯”å¦‚è‡ªåŠ¨é©¾é©¶ã€ç«æ˜Ÿç™»é™†ç­‰ã€‚å°±ç®—è‡ªå·±ä¸€æ—¶ç”¨ä¸ç€ï¼Œä½ ä¹Ÿè¦äº†è§£è¿™äº›ï¼Œä»¥ä¾¿å°†æ¥è¿™äº›æŠ€æœ¯æ¥ä¸´æ—¶èƒ½é€‚åº”å®ƒä»¬ã€‚</li></ul><h4 id="ï¼ˆå››ï¼‰ã€é«˜æ ‡å‡†è¦æ±‚è‡ªå·±"><a href="#ï¼ˆå››ï¼‰ã€é«˜æ ‡å‡†è¦æ±‚è‡ªå·±" class="headerlink" title="ï¼ˆå››ï¼‰ã€é«˜æ ‡å‡†è¦æ±‚è‡ªå·±"></a>ï¼ˆå››ï¼‰ã€é«˜æ ‡å‡†è¦æ±‚è‡ªå·±</h4><p>åªæœ‰ä¸æ–­åœ°æé«˜æ ‡å‡†ï¼Œä½ æ‰å¯èƒ½è¶Šèµ°è¶Šé«˜ï¼Œæ‰€ä»¥ï¼Œè¦ä»¥é«˜æ ‡å‡†è¦æ±‚è‡ªå·±ï¼Œä¸æ–­åœ°åæ€ã€æ€»ç»“å’Œå®¡è§†è‡ªå·±ï¼Œæ‰èƒ½å¤Ÿæå‡è‡ªå·±ã€‚</p><ul><li>Google çš„è‡ªæˆ‘è¯„åˆ†å¡ã€‚</li><li>æ•é”çš„æŠ€æœ¯å—…è§‰ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ç»¼åˆçš„èƒ½åŠ›ï¼Œä½ éœ€è¦å……åˆ†åˆ©ç”¨ä¿¡æ¯æºï¼ŒGET åˆ°æ–°çš„æŠ€æœ¯åŠ¨æ€ï¼Œå¹¶é€šè¿‡å‚ä¸æŠ€æœ¯ç¤¾åŒºçš„è®¨è®ºï¼Œä¸°å¯Œè‡ªå·±äº†è§£æŠ€æœ¯çš„è§’åº¦ã€‚</li><li>å¼ºè°ƒå®è·µï¼Œå­¦ä»¥è‡´ç”¨ã€‚å­¦ä¹ çŸ¥è¯†ï¼Œä¸€å®šè¦å®é™…ç”¨ä¸€ç”¨ï¼Œå¯ä»¥æ˜¯å·¥ä½œä¸­çš„é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå·±çš„é¡¹ç›®ï¼Œä¸ä»…æœ‰åˆ©äºå¸æ”¶ç†è§£ï¼Œæ›´æœ‰åˆ©äºæ·±å…¥åˆ°æŠ€æœ¯çš„æœ¬è´¨ã€‚å¹¶å¯ä»¥ä¸ç°æœ‰æŠ€æœ¯å¯¹æ¯”ä¸€ä¸‹ï¼ŒåŒæ ·çš„é—®é¢˜ï¼Œç”¨æ–°æŠ€æœ¯è§£å†³æœ‰ä»€ä¹ˆä¸åŒï¼Œå¸¦æ¥äº†å“ªäº›ä¼˜åŠ¿ï¼Œè¿˜æœ‰å“ªäº›æœ‰å¾…æ”¹è¿›çš„åœ°æ–¹ã€‚</li><li>Lead by Exampleã€‚æ°¸è¿œåœ¨ç¼–ç¨‹ã€‚ä¸å†™ä»£ç ï¼Œä½ å°±å¯¹æŠ€æœ¯ç»†èŠ‚ä¸æ•æ„Ÿï¼Œä½ æ— æ³•åšå‡ºå¯ä»¥å®è·µçš„æŠ€æœ¯å†³ç­–å’Œæ–¹æ¡ˆã€‚</li></ul><hr><h2 id="å››ã€å¦‚ä½•æˆä¸ºä¸€ä¸ªå¤§å®¶æ„¿æ„è¿½éšçš„-Leader"><a href="#å››ã€å¦‚ä½•æˆä¸ºä¸€ä¸ªå¤§å®¶æ„¿æ„è¿½éšçš„-Leader" class="headerlink" title="å››ã€å¦‚ä½•æˆä¸ºä¸€ä¸ªå¤§å®¶æ„¿æ„è¿½éšçš„ Leader"></a>å››ã€å¦‚ä½•æˆä¸ºä¸€ä¸ªå¤§å®¶æ„¿æ„è¿½éšçš„ Leader</h2><h3 id="ï¼ˆä¸€ï¼‰ã€Leader-å’Œ-Boss-çš„ä¸åŒ"><a href="#ï¼ˆä¸€ï¼‰ã€Leader-å’Œ-Boss-çš„ä¸åŒ" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€Leader å’Œ Boss çš„ä¸åŒ"></a>ï¼ˆä¸€ï¼‰ã€Leader å’Œ Boss çš„ä¸åŒ</h3><p>å†æˆ–è€…ç”¨é€šä¿—çš„è¯è¯´ï¼ŒLeader æ˜¯å¤§å®¶è·Ÿæˆ‘ä¸€èµ·ä¸Šï¼Œè€Œ Boss åˆ™æ˜¯å¤§å®¶ç»™æˆ‘ä¸Šï¼Œä¸€ä¸ªåœ¨å›¢é˜Ÿçš„å‰é¢ï¼Œä¸€ä¸ªåœ¨å›¢é˜Ÿçš„åé¢ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œè¿™ä¸¤è€…çš„ä¸åŒç‚¹å¦‚ä¸‹ï¼š</p><ul><li><p>Boss æ˜¯é©±åŠ¨å‘˜å·¥ï¼ŒLeader æ˜¯æŒ‡å¯¼å‘˜å·¥ã€‚</p><p>  åœ¨é¢å¯¹é¡¹ç›®çš„æ—¶å€™ï¼ŒBoss åˆ¶å®šæ—¶é—´è®¡åˆ’ï¼Œå¹¶ä¸”æ¨åŠ¨ï¼ˆpushï¼‰å’Œé­ç­–å‘˜å·¥å®Œæˆå·¥ä½œï¼Œè€Œ Leader åˆ™æ˜¯å’Œå‘˜å·¥ä¸€èµ·è®¨è®ºå·¥ä½œç»†èŠ‚ï¼ŒæŒ‡å¯¼å‘˜å·¥å…³æ³¨å·¥ä½œçš„é‡ç‚¹ï¼Œå’Œå‘˜å·¥ä¸€èµ·è§„åˆ’å‡ºï¼ˆwork outï¼‰å·¥ä½œçš„æ–¹å‘å’Œè®¡åˆ’ï¼Œå¹¶ä¸”åœ¨å·¥ä½œä¸­å’Œå‘˜å·¥ä¸€èµ·è§£å†³ç»†èŠ‚éš¾é¢˜ï¼Œå¸®åŠ©å‘˜å·¥å®Œæˆå·¥ä½œã€‚</p></li><li><p>Bossåˆ¶é€ ç•æƒ§ï¼ŒLeaderåˆ¶é€ çƒ­æƒ…ã€‚</p><p>  Boss åœ¨å·¥ä½œä¸­æ˜¯ç”¨å·¥ä½œèŒä½çº§åˆ«å‹äººï¼Œç”¨ä½ çš„ç»©æ•ˆè€ƒæ ¸æ¥åˆ¶é€ å¨æ…‘ï¼Œè®©å‘˜å·¥ç•æƒ§ä»–ï¼Œä»è€Œæ¨è¡Œå·¥ä½œã€‚è€Œ Leader æ˜¯é€šè¿‡æç»˜è¿œæ™¯ï¼Œåˆ¶é€ æ¿€åŠ¨äººå¿ƒçš„ç›®æ ‡æ¥é¼“èˆå’Œè§¦å‘å›¢é˜Ÿçš„çƒ­æƒ…å’Œæ–—å¿—ã€‚</p></li><li><p>Bossé¢å¯¹é”™è¯¯å–œæ¬¢ä½¿ç”¨äººäº‹æƒ©ç½šçš„æ‰‹æ®µï¼Œè€ŒLeaderé¢å¯¹é”™è¯¯å–œæ¬¢å¯»æ‰¾è§£å†³é—®é¢˜çš„æŠ€æœ¯æˆ–ç®¡ç†æ–¹æ³•ã€‚</p><p>  æƒ©ç½šå‘˜å·¥å’Œè§£å†³é—®é¢˜å®Œå…¨æ˜¯ä¸¤ç äº‹ï¼ŒBosså› ä¸ºå¹¶ä¸æ‡‚æŠ€æœ¯ä¹Ÿå¹¶ä¸æ‡‚é—®é¢˜çš„ç»†èŠ‚ï¼Œæ‰€ä»¥ä»–ä»¬åªèƒ½ä½¿ç”¨æƒ©ç½šè¿™æ ·çš„æ‰‹æ®µï¼Œè€ŒLeaderé€šå¸¸æ˜¯å–œæ¬¢è§£å†³é—®é¢˜çš„æŠ€æœ¯å‹äººæ‰ï¼Œæ‰€ä»¥ï¼Œä»–ä»¬ä¼šæ·±å…¥æŠ€æœ¯ç»†èŠ‚ï¼Œä»æŠ€æœ¯ä¸Šæ‰¾åˆ°æ—¢æ²»æ ‡åˆæ²»æœ¬çš„æŠ€æœ¯æ–¹æ¡ˆæˆ–ç®¡ç†æ–¹å¼ã€‚</p></li><li><p>Boss åªæ˜¯çŸ¥é“æ€ä¹ˆåšï¼Œè€Œ Leader åˆ™æ˜¯å±•ç¤ºæ€ä¹ˆåšã€‚</p><p>  ä¸€ä¸ªå¥½ Leader çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ Lead by Exampleï¼Œä»¥èº«ä½œåˆ™ï¼Œç”¨èº«æ•™è€Œä¸æ˜¯è¨€ä¼ ã€‚è€Œ Boss åªæ˜¯åœ¨è¯´æ•™ï¼Œæ€»æ˜¯åœ¨å¤§é“ç†ä¸Šè¯´çš„ä¸€å¥—åˆä¸€å¥—ï¼Œä½†ä»æ¥ä¸ç®¡æŠ€æœ¯ç»†èŠ‚ã€‚</p></li><li><p>Boss æ˜¯ç”¨äººï¼Œè€Œ Leader æ˜¯å‘å±•äººã€‚</p><p>  Boss ä¸å…³å¿ƒäººçš„å‘å±•ï¼ŒæŠŠäººå½“æˆåŠ³åŠ¨åŠ›ã€‚è€Œ Leader åˆ™ä¼šçœ‹åˆ°äººçš„æ½œåŠ›å’Œç‰¹é•¿ï¼Œé€šè¿‡æˆæƒã€æŒ‡å¯¼å’Œç»™å‘˜å·¥åˆ¶å®šæˆé•¿è®¡åˆ’è®©å‘˜å·¥æˆé•¿ï¼Œä»è€Œå‘å±•å‘˜å·¥ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥çœ‹åˆ° Boss æ€»æ˜¯è¯´è‡ªå·±çš„å‘˜å·¥æœ‰è¿™ä¸ªé—®é¢˜æœ‰é‚£ä¸ªé—®é¢˜ï¼Œè€Œ Leader æ€»æ˜¯è¯´ï¼Œå¦‚ä½•è®©å‘˜å·¥æˆé•¿ä»¥è§£å†³å‘˜å·¥ä¸ªäººçš„å„ç§é—®é¢˜ã€‚</p></li><li><p>Boss ä»å›¢é˜Ÿæ”¶å‰²æˆç»©ï¼Œè€Œ Leader åˆ™æ˜¯ç»™äºˆå›¢é˜Ÿæˆç»©ã€‚</p><p>  Boss é€šå¸¸éƒ½ä¼šæŠŠå›¢é˜Ÿçš„æˆç»©å ä¸ºå·±æœ‰ï¼Œè™½ç„¶ Boss ä¼šè¯´è¿™æ˜¯å›¢é˜Ÿçš„åŠŸåŠ³ï¼Œä½†åŸºæœ¬ä¸Šæ˜¯ä¸€å¥å¸¦è¿‡ã€‚è€Œ Leader åˆ™æ˜¯è®©å›¢é˜ŸæˆåŠŸï¼Œè®©å›¢é˜Ÿçš„æˆå‘˜ç«™åœ¨å°å‰ï¼Œè‡ªå·±ç”˜å½“ç»¿å¶å’Œé“ºè·¯çŸ³ã€‚Leader çŸ¥é“åªæœ‰å›¢é˜Ÿçš„æ¯ä¸ªäººæˆåŠŸäº†ï¼Œå›¢é˜Ÿæ‰ä¼šæˆåŠŸï¼Œæ‰€ä»¥ï¼ŒLeader ä¼šå¸®åŠ©å›¢é˜Ÿä¸­çš„æ¯ä¸ªäººæ›´å¥½æ›´æµç•…åœ°èµ°å‘æˆåŠŸã€‚</p></li><li><p>Boss å–œæ¬¢å‘½ä»¤å’Œæ§åˆ¶ï¼ˆ Command + Control ï¼‰ï¼Œè€Œ Leader å–œæ¬¢æ²Ÿé€šå’Œåä½œï¼ˆ Communication + Cooperation ï¼‰ã€‚</p><p>  Boss å–œæ¬¢é€šè¿‡å‘½ä»¤æ¥æ§åˆ¶å‘˜å·¥çš„è¡Œä¸ºï¼Œä»è€Œå®ç°å›¢é˜Ÿçš„æœ‰æ•ˆè¿è½¬ï¼Œè€Œ Leader å–œæ¬¢é€šè¿‡æ²Ÿé€šå’Œåä½œæ¥å¢åŠ å‘˜å·¥çš„å‚ä¸æ„Ÿï¼Œä»è€Œè®©å‘˜å·¥è§‰å¾—è¿™æ˜¯è‡ªå·±çš„äº‹ï¼Œæ„¿æ„ä¸ºä¹‹ä»˜å‡ºã€‚</p></li><li><p>Boss å–œæ¬¢è¯´â€œç»™æˆ‘ä¸Šâ€ï¼Œè€Œ Leader å–œæ¬¢è¯´â€œè·Ÿæˆ‘ä¸Šâ€ã€‚</p><p>  Boss æ€»æ˜¯èº²åœ¨å›¢é˜Ÿåé¢ï¼Œè®©å›¢é˜Ÿå†²é”‹é™·é˜µï¼Œè€Œ Leader æ€»æ˜¯å†²åœ¨å‰é¢ç”¨è‡ªå·±çš„è¡ŒåŠ¨é¢†ç€å›¢é˜Ÿæµ´è¡€å¥‹æˆ˜ã€‚</p></li></ul><h3 id="ï¼ˆäºŒï¼‰ã€å¦‚ä½•æˆä¸ºä¼—äººæ„¿æ„è¿½éšçš„-Leader"><a href="#ï¼ˆäºŒï¼‰ã€å¦‚ä½•æˆä¸ºä¼—äººæ„¿æ„è¿½éšçš„-Leader" class="headerlink" title="ï¼ˆäºŒï¼‰ã€å¦‚ä½•æˆä¸ºä¼—äººæ„¿æ„è¿½éšçš„ Leader"></a>ï¼ˆäºŒï¼‰ã€å¦‚ä½•æˆä¸ºä¼—äººæ„¿æ„è¿½éšçš„ Leader</h3><ul><li><p>å¸®äººè§£å†³é—®é¢˜ã€‚</p><p>  å›¢é˜Ÿæˆ–èº«è¾¹å¤§å¤šæ•°äººéƒ½åœ¨é—®ï¼šâ€œè¿™ä¸ªé—®é¢˜æ€ä¹ˆåŠï¼Ÿâ€ï¼Œè€Œä½ æ€»æ˜¯èƒ½ç«™å‡ºæ¥å‘Šè¯‰å¤§å®¶è¯¥æ€ä¹ˆåŠã€‚</p></li><li><p>è¢«äººä¾èµ–ã€‚</p><p>  å›¢é˜Ÿæˆ–èº«è¾¹å¤§å¤šæ•°äººåœ¨åšæ¯”è¾ƒå…³é”®çš„å†³å®šæ—¶ï¼Œéƒ½ä¼šæ¥æ‰¾ä½ å’¨è¯¢æ„è§å’Œæƒ³æ³•ã€‚</p></li></ul><p>è¦æœ‰èƒ½å¤Ÿåšåˆ°ä¸Šé¢çš„è¦æ±‚ï¼Œä½ éœ€è¦æœ‰æŠ€æœ¯é¢†å¯¼åŠ›ã€‚æœ‰æ²¡æœ‰æŠ€æœ¯é¢†å¯¼åŠ›ï¼ˆLeadershipï¼‰ï¼Œæ˜¯æˆä¸ºä¸€ä¸ª Leader éå¸¸å…³é”®çš„å› ç´ ã€‚å› ä¸ºäººä»¬æƒ³è¦è·Ÿéšçš„äººé€šå¸¸éƒ½æ˜¯æ¯”è‡ªå·±å¼ºæ¯”è‡ªå·±å‡ºè‰²çš„äººï¼Œæˆ–æ˜¯èƒ½å¤Ÿè·Ÿä»–å­¦åˆ°ä¸œè¥¿ï¼Œèƒ½å¤Ÿè·Ÿä»–æˆé•¿çš„äººã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰äº†æŠ€æœ¯é¢†å¯¼åŠ›å¯èƒ½å¹¶ä¸å¤Ÿï¼Œä¸‹é¢æ˜¯æˆ‘ç½—åˆ—çš„ä¸€äº›æ¯”è¾ƒå…³é”®çš„é™¤äº†æŠ€æœ¯é¢†å¯¼åŠ›ä¹‹å¤–çš„ä¸€ä¸ª Leader éœ€è¦çš„ç´ è´¨ï¼š</p><ul><li><p>èµ¢å¾—ä»–äººçš„ä¿¡ä»»ã€‚</p><p>  å¯¹äºä¿¡ä»»æ¥è¯´ï¼Œå¹¶ä¸å®Œå…¨æ˜¯åˆ«äººç›¸ä¿¡ä½ èƒ½åšåˆ°æŸä¸ªäº‹ï¼Œè¿˜æœ‰åˆ«äººæ„¿æ„å‘ä½ æ‰“å¼€å¿ƒæ‰‰ï¼Œå’Œä½ è¯´ä»–å¿ƒé‡Œé¢æœ€æŸ”è½¯çš„ä¸œè¥¿ã€‚è€Œåè€…æ‰æ˜¯çœŸæ­£çš„ä¿¡ä»»ã€‚</p></li><li><p>å¼€æ”¾çš„å¿ƒæ€ + å€¾å‘æ€§çš„ä»·å€¼è§‚ã€‚</p><ol><li><p>å¯¹äºæ–°ç”Ÿäº‹ç‰©è¦æœ‰å¼€æ”¾çš„å¿ƒæ€ï¼Œå¯¹äºæ¯ä¸ªäººçš„è§‚ç‚¹éƒ½æœ‰å¼€æ”¾çš„å¿ƒæ€ï¼Œä½†å¹¶ä¸æ˜¯è¦è®¤åŒæ‰€æœ‰çš„è§‚ç‚¹å’Œäº‹æƒ…ï¼Œæˆä¸ºä¸€ä¸ªæ²¹è…”æ»‘è°ƒçš„äººã€‚</p></li><li><p>å°±ä»·å€¼è§‚æ¥è¯´ï¼Œè¿˜æ˜¯éœ€è¦æœ‰å€¾å‘æ€§çš„ï¼Œæ¯”å¦‚ï¼Œæˆ‘å°±å€¾å‘äºä¸åŠ ç­çš„æ–‡åŒ–ï¼Œå€¾å‘äºå…¨æ ˆï¼Œå€¾å‘äºæŒ‰èŒè´£åˆ†å·¥è€Œä¸æ˜¯æŒ‰æŠ€èƒ½åˆ†å·¥ï¼Œå€¾å‘äºåšä¸€ä¸ª Leader è€Œä¸æ˜¯ Bossï¼Œå€¾å‘äºæŠ€æœ¯æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›ï¼Œå€¾å‘äº OKR è€Œä¸æ˜¯ KPIâ€¦â€¦</p></li></ol></li></ul><p>æˆ‘çš„è¿™äº›å€¾å‘æ€§å¯ä»¥è®©åˆ«äººæ›´æ¸…æ¥šåœ°çŸ¥é“æˆ‘æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„äººï¼Œè€Œä¸ä¼šå¯¹æˆ‘ç¢ç£¨ä¸é€ï¼Œä¸€ä¼šä¸œä¸€ä¼šè¥¿åªä¼šè®©äººè§‰å¾—ä½ å¤ªæ²¹äº†ï¼Œåè€Œä¼šäº§ç”Ÿè·ç¦»æ„Ÿå’ŒåŒæ¶æ„Ÿã€‚æˆ‘è®¤ä¸ºï¼Œå€¾å‘æ€§çš„ä»·å€¼è§‚æ˜¯åˆ«äººæ˜¯å¦å¯ä»¥è·Ÿéšä½ çš„ä¸€ä¸ªåŸºç¡€ã€‚</p><ul><li><p>Lead by Exampleã€‚</p><ol><li>ç”¨è‡ªå·±çš„è¡Œä¸ºæ¥å‘å¤§å®¶å±•ç¤ºä½ çš„ Leadershipã€‚è¿™å°±æ˜¯è¯´ï¼Œä½ éœ€è¦ç»™å¤§å®¶åšç¤ºèŒƒã€‚å¾ˆå¤šæ—¶å€™ï¼Œé“ç†äººäººéƒ½çŸ¥é“ï¼Œä½†æœªå¿…äººäººéƒ½ä¼šåšï¼ŒçŸ¥æ˜“è¡Œéš¾ï¼Œä»¥èº«ç¤ºèŒƒï¼Œä¸€ä¸ªç¤ºä¾‹ä¼šæ¯”è®²ä¸€ä¸‡éé“ç†éƒ½ç®¡ç”¨ã€‚</li><li>æ‰€ä»¥æˆ‘è®¤ä¸ºï¼Œå¯¹äºè½¯ä»¶å¼€å‘æ¥è¯´ï¼Œä¸å†™ä»£ç çš„æ¶æ„å¸ˆæ˜¯æ ¹æœ¬ä¸é è°±çš„ã€‚è¦åšä¸€ä¸ªæœ‰äººæ„¿æ„è·Ÿéšçš„æŠ€æœ¯ Leaderï¼Œä½ éœ€è¦ç»ˆèº«å†™ä»£ç ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ ABC â€“ Always Be Codingã€‚è¿™æ ·ï¼Œä½ ä¼šå¾—åˆ°æ›´å¤šçš„å®é™…ç»éªŒï¼Œèƒ½å¤Ÿéå¸¸æ˜ç™½ä¸€ä¸ªæŠ€æœ¯æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼Œå®ç°å¤æ‚åº¦ï¼ŒçŸ¥é“ä»€ä¹ˆæ˜¯ Best Practiceï¼Œä½ çš„æ–¹æ¡ˆæ‰ä¼šæ›´å…·æ‰§è¡ŒåŠ›å’Œå®è·µæ€§ã€‚å½“æœ‰äº†æ‰§è¡ŒåŠ›ï¼Œä½ å°±ä¼šè·å¾—æ›´å¤šçš„æˆå°±ï¼Œè€Œè¿™äº›æˆå°±åè¿‡æ¥ä¼šè®©æ›´å¤šçš„äººæ¥è·Ÿéšä½ ã€‚</li></ol></li><li><p>èƒ½å¤ŸæŠ“ä½é‡ç‚¹ï¼Œçœ‹é€äº‹ç‰©çš„æœ¬è´¨ã€‚</p><p>  ä½œä¸ºä¸€ä¸ª Leaderï¼Œèƒ½å¤ŸæŠ“ä½ä¸»è¦çŸ›ç›¾ï¼Œçœ‹æ¸…äº‹ç‰©çš„æœ¬è´¨ï¼Œç»™å‡ºæ¸…æ¥šçš„è§‚ç‚¹æˆ–æ–¹å‘ï¼Œç®€åŒ–å¤æ‚çš„äº‹æƒ…ï¼Œä¼ é“è§£æƒ‘ã€å¼€å¯æ°‘æ™ºï¼Œè®©äººè±ç„¶å¼€æœ—ã€é†é†çŒé¡¶ï¼Œæ‰ä¼šè®©äººè¿½éšä¹‹ã€‚</p></li><li><p>æç»˜ä»¤äººæ¿€åŠ¨çš„æ–¹å‘ï¼Œæä¾›ä»¤äººå‘ä½çš„ç¯å¢ƒã€‚</p><p>  ä¸€ä¸ªå¥½çš„ Leader ä¸€å®šä¼šæŠŠæ¯ä¸ªäººå¿ƒä¸­æœ€çœŸå–„ç¾çš„ä¸œè¥¿å‘¼å”¤å‡ºæ¥ï¼Œå¹¶ä¸”è¿˜èƒ½è®©äººç›¸ä¿¡è¿™æ˜¯æœ‰æœºä¼šæœ‰å¯èƒ½åšåˆ°çš„ã€‚</p></li><li><p>ç”˜å½“é“ºè·¯çŸ³ï¼Œä¸ºä»–äººåˆ›é€ æœºä¼šã€‚</p><p>  åˆ«äººæ„¿æ„è·Ÿéšä½ ï¼Œæ„¿æ„å’Œä½ å…±äº‹ï¼Œæœ‰ä¸€éƒ¨åˆ†åŸå› æ˜¯ä½ èƒ½å¤Ÿç»™åˆ«äººå¸¦æ¥æ›´å¤šçš„å¯èƒ½æ€§å’Œæœºä¼šï¼Œåˆ«äººè§‰å¾—å’Œä½ åœ¨ä¸€èµ·èƒ½å¤Ÿæˆé•¿ï¼Œèƒ½å¤Ÿè¿›æ­¥ï¼Œä½ èƒ½å¤Ÿå¸¦ç€å¤§å®¶åˆ°è¾¾æ›´è¿œçš„åœ°æ–¹ã€‚å¸®åŠ©åˆ«äººå…¶å®å°±æ˜¯å¸®åŠ©è‡ªå·±ï¼Œæˆå°±ä»–äººå…¶å®ä¹Ÿæ˜¯åœ¨æˆå°±è‡ªå·±ï¼Œè¿™å°±åƒä¸€ä¸ªå¥½çš„è¶³çƒé˜Ÿä¸€æ ·ï¼Œçƒé˜Ÿä¸­çš„äººéƒ½äº’ç›¸ç»™é˜Ÿå‹åˆ›é€ æœºä¼šï¼Œæ•´ä¸ªå›¢é˜ŸæˆåŠŸäº†ï¼Œçƒé˜Ÿçš„æ¯ä¸ªäººä¹Ÿå°±æˆåŠŸäº†ã€‚ä½œä¸ºä¸€ä¸ªå¥½çš„ Leaderï¼Œä½ ä¸€å®šè¦åœ¨å›¢é˜Ÿä¸­åˆ›é€ å¥½è¿™æ ·çš„æ–‡åŒ–å’Œé£æ°”ã€‚</p></li></ul><hr><h2 id="äº”ã€æ—¶é—´ç®¡ç†ï¼šåŒæ‰­æ›²æ—¶é—´çš„äº‹å„¿æŠ—äº‰"><a href="#äº”ã€æ—¶é—´ç®¡ç†ï¼šåŒæ‰­æ›²æ—¶é—´çš„äº‹å„¿æŠ—äº‰" class="headerlink" title="äº”ã€æ—¶é—´ç®¡ç†ï¼šåŒæ‰­æ›²æ—¶é—´çš„äº‹å„¿æŠ—äº‰"></a>äº”ã€æ—¶é—´ç®¡ç†ï¼šåŒæ‰­æ›²æ—¶é—´çš„äº‹å„¿æŠ—äº‰</h2><h3 id="ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨ç®¡ç†"><a href="#ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨ç®¡ç†" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨ç®¡ç†"></a>ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨ç®¡ç†</h3><p>æ— è®ºä»€ä¹ˆäº‹æƒ…ï¼Œå¦‚æœä½ å‘ç°ä½ æŒç»­å¤„äºè¢«åŠ¨çš„çŠ¶æ€ä¸‹ï¼Œé‚£ä¹ˆä½ ä¸€å®šè¦åœä¸‹æ¥æƒ³ä¸€æƒ³å¦‚ä½•æŠŠè¢«åŠ¨å˜ä¸ºä¸»åŠ¨ã€‚å› ä¸ºåœ¨è¢«åŠ¨çš„æ–¹å¼ä¸‹å·¥ä½œï¼Œä½ æ˜¯ä¸å¯èƒ½åšå¥½å·¥ä½œçš„ï¼Œæ— è®ºä»€ä¹ˆäº‹ã€‚</p><p><strong>ä½ è¦ä¸»åŠ¨ç®¡ç†çš„ä¸æ˜¯ä½ çš„æ—¶é—´ï¼Œè€Œæ˜¯ç®¡ç†ä½ çš„åŒäº‹ï¼Œç®¡ç†ä½ çš„ä¿¡æ¯ã€‚</strong></p><h3 id="ï¼ˆäºŒï¼‰ã€å­¦ä¼šè¯´â€œä¸â€"><a href="#ï¼ˆäºŒï¼‰ã€å­¦ä¼šè¯´â€œä¸â€" class="headerlink" title="ï¼ˆäºŒï¼‰ã€å­¦ä¼šè¯´â€œä¸â€"></a>ï¼ˆäºŒï¼‰ã€å­¦ä¼šè¯´â€œä¸â€</h3><ul><li><p>å½“ä½ é¢å¯¹åšä¸åˆ°çš„éœ€æ±‚æ—¶ï¼Œä½ ä¸è¦è¯´è¿™ä¸ªéœ€æ±‚åšä¸åˆ°ï¼Œå°¤å…¶æ˜¯ï¼Œä½ ä¸è¦é©¬ä¸Šè¯´åšä¸åˆ°ã€‚</p><p>  ä½ è¦å…ˆæƒ³ä¸€ä¸‹ï¼Œè¿™æ ·è®©åˆ«äººè§‰å¾—ä½ æ˜¯æƒ³åšçš„ï¼Œä½†æ˜¯ï¼Œåœ¨è®¤çœŸæ€è€ƒè¿‡åï¼Œä½ è§‰å¾—åšä¸åˆ°ï¼Œå¹¶ä¸”ç»™å‡ºä¸€ä¸ªä½ è§‰å¾—èƒ½åšåˆ°çš„æ–¹æ¡ˆã€‚è¿™é‡Œçš„è¯€çªæ˜¯â€”â€”<strong>ç»™å‡ºå¦ä¸€ä¸ªä½ å¯ä»¥åšåˆ°çš„æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯æŠŠå¯¹æ–¹çš„æ–¹æ¡ˆç›´æ¥å›ç»æ‰ã€‚</strong></p></li><li><p>å½“ä½ é¢å¯¹è¿‡äºå¤æ‚çš„éœ€æ±‚æ—¶ï¼Œä½ ä¸è¦è¯´ä¸ã€‚</p><p>  ä½ è¦åé—®ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿè¿™æ ·åšçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿå½“äº†è§£å®Œç›®çš„ä»¥åï¼Œä½ å¯ä»¥ç»™å‡ºä¸€ä¸ªè‡ªå·±çš„æ–¹æ¡ˆï¼Œæˆ–æ˜¯å’Œå¯¹æ–¹è®¨è®ºä¸€ä¸ªæ€§ä»·æ¯”æ›´å¥½çš„æ–¹æ¡ˆã€‚ä½ å¯ä»¥å›å¤è¯´ï¼Œè¿™ä¸ªéœ€æ±‚å¥½å¤æ‚ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½å…ˆå¹²è¿™ä¸ªï¼Œå†åšé‚£ä¸ªï¼Œè¿™æ ·ä¼šæ›´ç»æµä¸€äº›ã€‚è¿™é‡Œçš„è¯€çªæ˜¯â€”â€”<strong>æˆ‘ä¸è¯´æˆ‘ä¸èƒ½å®Œå…¨æ»¡è¶³ä½ ï¼Œä½†æˆ‘è¯´æˆ‘å¯ä»¥éƒ¨åˆ†æ»¡è¶³ä½ ã€‚</strong></p></li><li><p>å½“ä½ é¢å¯¹æ—¶é—´å®Œå…¨ä¸å¤Ÿçš„éœ€æ±‚æ—¶ï¼Œä½ ä¹Ÿä¸è¦è¯´ä¸ã€‚</p><p>  æ—¢ç„¶å¯¹æ–¹æŠŠå‹åŠ›ç»™ä½ ï¼Œä½ è¦æƒ³åŠæ³•æŠŠè¿™ä¸ªå‹åŠ›è¿˜å›å»ï¼Œæˆ–æ˜¯è®©å¯¹æ–¹æ¥å’Œä½ ä¸€åŒåˆ†æ‹…è¿™ä¸ªå‹åŠ›ã€‚</p></li></ul><p>æƒ¯ç”¨çš„æ–¹å¼æ˜¯ç»™å›ä¸‰ä¸ªé€‰æ‹©ï¼š</p><ul><li>æˆ‘å¯ä»¥åŠ ç­åŠ ç‚¹å®Œæˆï¼Œä½†æ˜¯æˆ‘ä¸ä¿è¯å¥½çš„è´¨é‡ï¼Œæœ‰ bug ä½ å¾—è®¤ï¼Œè€Œä¸”äº‹åä½ è¦ç»™æˆ‘ 1 ä¸ªæœˆçš„æ—¶é—´è¿˜å€ºã€‚</li><li>æˆ‘å¯ä»¥åŠ ç­åŠ ç‚¹ï¼Œè¿˜èƒ½ä¿è¯è´¨é‡ï¼Œä½†æˆ‘æ²¡åŠæ³•å®Œæˆè¿™ä¹ˆå¤šéœ€æ±‚ï¼Œèƒ½ä¸èƒ½å‡å°‘ä¸€äº›ï¼Ÿ</li><li>æˆ‘å¯ä»¥ä¿è´¨ä¿é‡åœ°å®Œæˆæ‰€æœ‰çš„éœ€æ±‚ï¼Œä½†æ˜¯ï¼Œèƒ½ä¸èƒ½å¤šç»™æˆ‘ 2 å‘¨æ—¶é—´ï¼Ÿ</li></ul><h3 id="ï¼ˆä¸‰ï¼‰ã€åŠ ç­å’Œå¼€ä¼š"><a href="#ï¼ˆä¸‰ï¼‰ã€åŠ ç­å’Œå¼€ä¼š" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€åŠ ç­å’Œå¼€ä¼š"></a>ï¼ˆä¸‰ï¼‰ã€åŠ ç­å’Œå¼€ä¼š</h3><p><strong>å¦‚æœæ€ä¹ˆåšéƒ½è¦å—ä¼¤å®³ï¼Œé‚£ä¹ˆä¸¤å®³ç›¸æƒå–å…¶è½»</strong>ã€‚ä½ è¦å­¦ä¼šæ¯”è¾ƒæ˜¯é¡¹ç›®å»¶æœŸçš„ä¼¤å®³å¤§ï¼Œè¿˜æ˜¯çº¿ä¸Šæ•…éšœçš„ä¼¤å®³å¤§ï¼Œæ˜¯å…ˆè‹¦åç”œå¥½ï¼Œè¿˜æ˜¯ç§¯å‹é—®é¢˜å¥½ï¼Œèªæ˜çš„ä½ åº”è¯¥èƒ½åšå‡ºæ­£ç¡®çš„åˆ¤æ–­ã€‚</p><p><strong>å¼€ä¼šï¼Œä¸æ˜¯è®¨è®ºé—®é¢˜ï¼Œè€Œæ˜¯è®¨è®ºæ–¹æ¡ˆï¼Œå¼€ä¼šä¸æ˜¯è¦æœ‰è®®é¢˜ï¼Œè€Œæ˜¯è¦æœ‰è®®æ¡ˆã€‚</strong></p><hr><h2 id="å…­ã€æ—¶é—´ç®¡ç†ï¼šå¦‚ä½•åˆ©ç”¨å¥½è‡ªå·±çš„æ—¶é—´"><a href="#å…­ã€æ—¶é—´ç®¡ç†ï¼šå¦‚ä½•åˆ©ç”¨å¥½è‡ªå·±çš„æ—¶é—´" class="headerlink" title="å…­ã€æ—¶é—´ç®¡ç†ï¼šå¦‚ä½•åˆ©ç”¨å¥½è‡ªå·±çš„æ—¶é—´"></a>å…­ã€æ—¶é—´ç®¡ç†ï¼šå¦‚ä½•åˆ©ç”¨å¥½è‡ªå·±çš„æ—¶é—´</h2><h3 id="ï¼ˆä¸€ï¼‰ã€æŠ•èµ„è‡ªå·±çš„æ—¶é—´"><a href="#ï¼ˆä¸€ï¼‰ã€æŠ•èµ„è‡ªå·±çš„æ—¶é—´" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€æŠ•èµ„è‡ªå·±çš„æ—¶é—´"></a>ï¼ˆä¸€ï¼‰ã€æŠ•èµ„è‡ªå·±çš„æ—¶é—´</h3><ul><li><p>èŠ±æ—¶é—´å­¦ä¹ åŸºç¡€çŸ¥è¯†ï¼ŒèŠ±æ—¶é—´è¯»æ–‡æ¡£ã€‚</p><p>  ç³»ç»Ÿåœ°å­¦ä¹ ä¸€é—¨æŠ€æœ¯æ˜¯éå¸¸å…³é”®çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶é—´æ˜¯å€¼å¾—æŠ•èµ„çš„ã€‚</p></li><li><p>èŠ±æ—¶é—´åœ¨è§£æ”¾è‡ªå·±ç”Ÿäº§åŠ›çš„äº‹ä¸Šã€‚</p><p>  åœ¨è‡ªåŠ¨åŒ–ã€å¯é…ç½®ã€å¯é‡ç”¨ã€å¯æ‰©å±•ä¸Šè¦å¤šèŠ±æ—¶é—´ã€‚èŠ±æ—¶é—´åœ¨è§£æ”¾è‡ªå·±çš„äº‹ä¸Šæ˜¯æœ€æœ‰æ„ä¹‰çš„äº†ã€‚</p></li><li><p>èŠ±æ—¶é—´åœ¨è®©è‡ªå·±æˆé•¿çš„äº‹ä¸Šã€‚</p><p>  æ³¨æ„ï¼Œæ™‹å‡å¹¶ä¸ä»£è¡¨æˆé•¿ï¼Œæˆé•¿ä¸åº”è¯¥åªçœ‹åœ¨ä¸€ä¸ªå…¬å¸å†…ï¼Œè€Œæ˜¯è¦çœ‹åœ¨è¡Œä¸šå†…ï¼Œåœ¨è¡Œä¸šå†…çš„æˆé•¿æ‰æ˜¯çœŸæ­£çš„æˆé•¿ã€‚æ‰€ä»¥ï¼ŒæŠŠæ—¶é—´èŠ±åœ¨èƒ½è®©è‡ªå·±æˆé•¿ï¼Œèƒ½è®©è‡ªå·±æœ‰æ›´å¼ºçš„ç«äº‰åŠ›ï¼Œèƒ½è®©è‡ªå·±æœ‰æ›´å¤§çš„è§†é‡ï¼Œèƒ½è®©è‡ªå·±æœ‰æ›´å¤šå¯èƒ½æ€§çš„äº‹æƒ…ä¸Šã€‚</p></li><li><p>èŠ±æ—¶é—´åœ¨å»ºç«‹é«˜æ•ˆçš„ç¯å¢ƒä¸Šã€‚</p><p>  ä¸ä»…ä»…æ˜¯å·¥å…·ä¸Šï¼ŒèŠ±äº›æ—¶é—´åœ¨å½±å“ä½ èº«è¾¹çš„äººä¸Šï¼Œæ¯”å¦‚ä½ çš„åŒäº‹ï¼Œä½ çš„äº§å“ç»ç†ï¼Œä½ çš„è€æ¿ï¼Œå»å½±å“ä»–ä»¬ï¼Œè®©ä»–ä»¬ç†è§£ä½ ï¼Œè®©ä»–ä»¬é…åˆä½ æ¥å»ºç«‹æ›´å¥½çš„æµç¨‹å’Œç®¡ç†æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹å‘ä¸ŠèŠ±æ—¶é—´ä¹Ÿæ˜¯å¾ˆå€¼å¾—çš„ã€‚</p></li></ul><h3 id="ï¼ˆäºŒï¼‰ã€è§„åˆ’è‡ªå·±çš„æ—¶é—´"><a href="#ï¼ˆäºŒï¼‰ã€è§„åˆ’è‡ªå·±çš„æ—¶é—´" class="headerlink" title="ï¼ˆäºŒï¼‰ã€è§„åˆ’è‡ªå·±çš„æ—¶é—´"></a>ï¼ˆäºŒï¼‰ã€è§„åˆ’è‡ªå·±çš„æ—¶é—´</h3><ul><li><p>å®šä¹‰å¥½ä¼˜å…ˆçº§ã€‚</p><p>  æ— è®ºä½ å†™ä¸å†™å‡ºæ¥ï¼Œä½ ä¸€å®šéƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„ to-do listã€‚çŸ¥é“ä»€ä¹ˆäº‹æ˜¯é‡è¦çš„ï¼Œä»€ä¹ˆäº‹æ˜¯ç´§æ€¥çš„ï¼Œä»€ä¹ˆäº‹é‡è¦ä½†ä¸ç´§æ€¥ï¼Œä»€ä¹ˆäº‹åˆé‡è¦åˆç´§æ€¥ã€‚è¿™æœ‰åˆ©äºä½ åˆ’åˆ†ä¼˜å…ˆçº§ã€‚</p></li><li><p>æœ€çŸ­ä½œä¸šä¼˜å…ˆã€‚</p><p>  å¯¹äºç›¸åŒä¼˜å…ˆçº§çš„äº‹ï¼Œæˆ‘ä¸ªäººå–œæ¬¢çš„æ˜¯â€œæœ€çŸ­ä½œä¸šä¼˜å…ˆâ€çš„è°ƒåº¦ç®—æ³•ã€‚</p></li><li><p>æƒ³æ¸…æ¥šå†åšã€‚</p><p>  å¯¹äºä¸€äº›æ²¡æƒ³æ¸…æ¥šçš„äº‹ï¼Œæˆ–æ˜¯è‡ªå·±ä¸å¤ªæœ‰ä¿¡å¿ƒçš„äº‹ï¼Œè¿˜æ˜¯å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰å·²æœ‰çš„æˆç†Ÿè§£å†³æ–¹æ¡ˆï¼Œæˆ–æ˜¯æ‰¾æ›´ç‰›çš„äººæ¥ç»™ä½ æŠŠæŠŠå…³ï¼Œå¸®ä½ å‡ºå‡ºä¸»æ„ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ›´å¥½ã€æ›´ç®€å•çš„æ–¹å¼ã€‚</p></li><li><p>å…³æ³¨é•¿æœŸåˆ©ç›Šè§„åˆ’ã€‚</p><p>  è¦å¤šå…³æ³¨é•¿è¿œå¯ä»¥èŠ‚çœå¤šå°‘æ—¶é—´ï¼Œè€Œä¸æ˜¯å½“å‰ä¼šèŠ±è´¹å¤šå°‘æ—¶é—´ã€‚é•¿æœŸæˆæœ¬ä¼šæ¯”çŸ­æœŸæˆæœ¬å¤§å¾—å¤šã€‚æ‰€ä»¥ï¼Œå®å¯åœ¨çŸ­æœŸå»¶æœŸï¼Œä¹Ÿä¸è¦é€æ”¯æœªæ¥ã€‚è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼Œå·¥ä½œä¸Šçš„äº‹ä½ æ°¸è¿œä¹Ÿåšä¸å®Œçš„ï¼Œé•¿ç—›ä¸å¦‚çŸ­ç—›ã€‚</p></li></ul><p><strong>ä½ è¦å­¦ä¼šè§„åˆ’è‡ªå·±çš„è¡ŒåŠ¨è®¡åˆ’ï¼Œä¸æ˜¯çŸ­æœŸçš„ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸­é•¿æœŸçš„ã€‚æˆ‘ä¸ªäººå»ºè®®æ˜¯æŒ‰å­£åº¦æ¥è§„åˆ’ï¼Œè¿™ä¸ªå­£åº¦åšä»€ä¹ˆï¼Œè¾¾åˆ°ä»€ä¹ˆç›®æ ‡ï¼Œä¸€å¹´å¾€å‰èµ°å››æ­¥ï¼Œè€Œä¸æ˜¯åªè€ƒè™‘çœ¼ä¸‹ã€‚</strong></p><h3 id="ï¼ˆä¸‰ï¼‰ã€ç”¨å¥½è‡ªå·±çš„æ—¶é—´"><a href="#ï¼ˆä¸‰ï¼‰ã€ç”¨å¥½è‡ªå·±çš„æ—¶é—´" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€ç”¨å¥½è‡ªå·±çš„æ—¶é—´"></a>ï¼ˆä¸‰ï¼‰ã€ç”¨å¥½è‡ªå·±çš„æ—¶é—´</h3><ul><li><p><strong>å°†å†›èµ¶è·¯ä¸è¿½å°å…”</strong>ã€‚</p><p>  èƒ½ä¸“æ³¨åœ°æŠŠæ—¶é—´æŠ•å…¥åˆ°ä¸€ä¸ªæœ‰ä»·å€¼çš„äº‹ä¸Šæ˜¯éå¸¸é‡è¦çš„ã€‚ç¡®å®šè‡ªå·±çš„ç›®æ ‡ï¼Œä¸“æ³¨è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œè€Œä¸æ˜¯åˆ†å¿ƒã€‚å°†å†›çš„ç›®æ ‡æ˜¯è¦æ”»åŸï¼Œè€Œä¸æ˜¯è¿½å…”å­ã€‚æ‰€ä»¥ï¼Œä½ è¦å­¦ä¼šè¿‡æ»¤æ‰ä¸è‡ªå·±ç›®æ ‡æ— å…³çš„äº‹ï¼Œä¸è¦è®©é‚£äº›æ— å…³çš„äº‹æ§åˆ¶è‡ªå·±ã€‚</p></li><li><p>å½¢æˆä¹ æƒ¯ã€‚</p><p>  åœ¨è®²è¿°å®Œå¦‚ä½•äº‰å–æ—¶é—´ï¼ŒåŠå¦‚ä½•ä½¿ç”¨æ—¶é—´ä¹‹åï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹å¦‚ä½•å°†è¿™äº›æ—¶é—´ç®¡ç†æ–¹æ³•å½¢æˆä¹ æƒ¯ï¼Œå› ä¸ºæˆ‘åšä¿¡ï¼š<strong>â€œåšâ€æ¯”â€œåšå¥½â€æ›´é‡è¦</strong>ã€‚å…»æˆä¸€ä¸ªå¥½ä¹ æƒ¯é€šå¸¸éœ€è¦ 30 å¤©å·¦å³çš„æ—¶é—´ï¼Œå°¤å…¶åœ¨æœ€åˆçš„å‡ å¤©å°±æ›´ä¸ºé‡è¦äº†ã€‚è¿™æ—¶ï¼Œä¸å¦¨å°†æ–‡ç« ä¸­æåˆ°çš„æ–¹æ³•å’Œå‡ ä¸ªè¦ç‚¹ï¼Œå†™åœ¨æŸæœ¬ä¹¦æˆ–è€…ç¬”è®°æœ¬çš„æ‰‰é¡µä¸Šï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼Œæ—¶åˆ»æé†’è‡ªå·±ã€‚</p></li><li><p>å½¢æˆæ­£åé¦ˆã€‚</p><p>  è¦æœ‰æ­£åé¦ˆï¼Œä¹Ÿå°±æ˜¯æˆå°±æ„Ÿï¼Œæœ‰åŠ©äºå®Œæˆä¸€äº›çœ‹ä¼¼éš¾ä»¥å®Œæˆçš„äº‹å„¿ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œå­¦ä¹ æ˜¯é€†äººæ€§çš„äº‹å„¿ï¼Œä½†å¦‚æœåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¸æ–­åœ°æœ‰æ­£åé¦ˆï¼Œå°±æ›´åˆ©äºæˆ‘ä»¬åšæŒä¸‹å»ã€‚è¦è®©è‡ªå·±æœ‰æ­£åé¦ˆï¼Œé‚£å°±éœ€è¦æŠŠæ—¶é—´èŠ±åœ¨æœ‰ä»·å€¼çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼Œè§£å†³è‡ªå·±å’Œä»–äººçš„ç—›ç‚¹ï¼Œè¿™æ ·ä½ ä¼šæ”¶è·åˆ«äººçš„èµæ‰¬å’Œé¼“åŠ±ã€‚</p></li><li><p>åæ€å’Œä¸¾ä¸€åä¸‰ã€‚</p><p>  å¯ä»¥å°è¯•æ¯å‘¨æœ«èŠ±ä¸Šç‚¹æ—¶é—´æ€è€ƒä¸€ä¸‹ï¼Œæœ¬å‘¨åšäº†å“ªäº›äº‹å„¿ï¼Ÿæ—¶é—´å®‰æ’æ˜¯å¦åˆç†ï¼Ÿè¿˜æœ‰å“ªäº›å¯ä»¥ä¼˜åŒ–æé«˜çš„åœ°æ–¹ï¼Ÿæœ‰ç‚¹å„¿ç±»ä¼¼äºæˆ‘ä»¬å¸¸è¯´çš„â€œå¤ç›˜â€ã€‚ç„¶åæ€è€ƒä¸€ä¸‹ï¼Œä¸‹å‘¨çš„ä¸»è¦ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿå¹¶æ ¹æ®ä¼˜å…ˆçº§è§„åˆ’ä¸€ä¸‹å®Œæˆè¿™äº›ä»»åŠ¡çš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯åšä¸€äº›ä¸‹å‘¨çš„å·¥ä½œè§„åˆ’ã€‚</p></li></ul><hr><h2 id="ä¸ƒã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•å‰çš„å‡†å¤‡"><a href="#ä¸ƒã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•å‰çš„å‡†å¤‡" class="headerlink" title="ä¸ƒã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•å‰çš„å‡†å¤‡"></a>ä¸ƒã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•å‰çš„å‡†å¤‡</h2><h3 id="ï¼ˆä¸€ï¼‰ã€æ€æ ·å†™ç®€å†"><a href="#ï¼ˆä¸€ï¼‰ã€æ€æ ·å†™ç®€å†" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€æ€æ ·å†™ç®€å†"></a>ï¼ˆä¸€ï¼‰ã€æ€æ ·å†™ç®€å†</h3><p><strong>æˆ‘ä»¬çŸ¥é“çœŸæ­£çš„å¥½ç®€å†æ˜¯è¦ç”¨è‡ªå·±çš„ç»å†å»å†™çš„ã€‚</strong></p><p>å†™ç®€å†çš„æœ€ä½³å®è·µâ€”â€”ç”¨è‡ªå·±çš„ç»å†èŠï¼Œè€Œä¸æ˜¯ç”¨æ–‡å­—å†™ã€‚</p><p>åŸºæœ¬ä¸Šæ¥è¯´ï¼Œç®€å†ä¸Šçš„ä¿¡æ¯ä¸è¦å†™å¤ªå¤šï¼Œä¿¡æ¯å¤ªå¤šç›¸å½“äºæ²¡æœ‰ä¿¡æ¯ï¼Œä¸è¦å•çº¯åœ°ç½—åˆ—ï¼Œè¦çªå‡ºè‡ªå·±çš„é•¿å¤„å’ŒæŠ€èƒ½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç®€å†éœ€è¦åŒ…æ‹¬ä»¥ä¸‹å‡ é¡¹å†…å®¹ï¼š</p><ul><li><p>è‡ªæˆ‘ç®€ä»‹ã€‚</p><p>  ç”¨æœ€ç®€å•çš„è¯æ¥è¯´æ˜è‡ªå·±çš„æƒ…å†µï¼Œä¸è¶…è¿‡ 200 å­—ã€‚æ¯”å¦‚ï¼š10+ å¹´çš„è½¯ä»¶å¼€å‘ç»éªŒï¼ˆè¯´æ˜ä½ çš„ä¸»ä¸šï¼‰ï¼Œ4+ å¹´çš„å›¢é˜Ÿ leader ç»éªŒï¼ˆè¯´æ˜ä½ çš„é¢†å¯¼åŠ›ï¼‰ï¼Œæ“…é•¿é«˜å¯ç”¨é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼æ¶æ„ï¼ˆè¯´æ˜ä½ çš„ä¸“ä¸šå’Œä¸“æ”»ï¼‰ï¼Œå¤šå¹´äº’è”ç½‘å’Œé‡‘èè¡Œä¸šèƒŒæ™¯ï¼ˆè¯´æ˜ä½ çš„è¡Œä¸šèƒŒæ™¯ï¼‰ï¼Œä»»èŒäº XXX å…¬å¸çš„ XX èŒä½ï¼ˆè¯´æ˜ä½ çš„èŒä¸šï¼‰ï¼Œè´Ÿè´£ XXX å¹³å°æˆ–ç³»ç»Ÿï¼ˆè¯´æ˜ä½ çš„ä¸šåŠ¡åœºæ™¯ï¼‰â€¦â€¦</p></li><li><p>ä¸ªäººä¿¡æ¯ã€‚</p><ol><li>åŸºæœ¬ä¿¡æ¯ã€‚ç”µå­é‚®ç®±å»ºè®®ç”¨ Gmailï¼Œåƒä¸‡ä¸è¦ç”¨ QQ é‚®ç®±ï¼Œè¦è®©äººæ„Ÿè§‰èŒä¸šåŒ–ä¸€äº›ã€‚</li><li>ä¸ªäººç½‘ç«™ã€‚å¦‚æœä½ æœ‰ä¸ªäººä¸»é¡µã€åšå®¢ã€GitHub æˆ–æ˜¯ Stack Overflowï¼Œè¯·ä¸€å®šé™„ä¸Šï¼Œè¿™æ˜¯åŠ åˆ†é¡¹ã€‚å¦‚æœä¸ªäººä¸»é¡µæˆ–åšå®¢æœ‰ç‹¬ç«‹åŸŸåï¼Œé‚£æ›´å¥½ï¼Œè¿™ä¼šç»™äººä¸€ç§ä½ çˆ±åŠ¨æ‰‹åšäº‹çš„æ„Ÿè§‰ã€‚é¡µé¢ä¹Ÿè¦å¹²å‡€æœ‰ç¾æ„Ÿï¼Œè¿™æ ·ä¼šè®©äººæ„Ÿè§‰ä½ æœ‰å“å‘³ã€‚</li><li>ç½‘ç«™å†…å®¹ã€‚ä¸€èˆ¬æ¥è¯´è¿™äº›é¡¹éƒ½ä¼šè¢«é¢è¯•å®˜ç‚¹çœ‹æµè§ˆï¼Œæ‰€ä»¥ï¼Œé‡Œé¢çš„å†…å®¹ä½ éœ€è¦å°å¿ƒç»„ç»‡å’Œå‘ˆç°ï¼Œåƒä¸‡ä¸è¦é€ å‡ã€‚å¦å¤–ï¼Œé™¤äº†æŠ€æœ¯ä¸Šçš„ä¸€äº›çŸ¥è¯†æ€»ç»“ï¼ˆä¸è¦å¤ªåˆçº§ï¼Œè¦æœ‰æ·±åº¦çš„ã€åŸç†å‹çš„ã€åˆ¨æ ¹é—®åº•å‹çš„æ–‡ç« ï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥ç§€ä¸€ç§€è‡ªå·±çš„æŠ€æœ¯ä»·å€¼è§‚ï¼ˆæ¯”å¦‚ï¼Œå¯¹ä»£ç æ•´æ´çš„è¿½æ±‚ï¼Œå¯¹ä¸€äº›æŠ€æœ¯çƒ­ç‚¹äº‹ä»¶çš„çœ‹æ³•ï¼‰ï¼Œè¿™ä¼šè®©ä½ æ›´å®¹æ˜“è·å¾—é¢è¯•å®˜çš„å¥½æ„Ÿã€‚é¢è¯•å®˜çš„å¥½æ„Ÿå¾ˆé‡è¦ã€‚</li><li>ä½œå“å±•ã€‚å¦‚æœä½ æœ‰ä¸€äº›ä½œå“å±•ç°ï¼Œä¼šæ›´å¥½ã€‚å½“ç„¶ï¼Œå¯¹äºå‰ç«¯ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚è€Œå¯¹äºåç«¯ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™ä¼šæ¯”è¾ƒéš¾ä¸€äº›ï¼Œåªèƒ½å±•ç¤ºä¸€ä¸‹è‡ªå·±çš„ GitHub äº†ã€‚å¦‚æœä½ æœ‰ä¸€äº›æ¯”è¾ƒä¸é”™çš„è¯ä¹¦æˆ–å¥–é¡¹ï¼ˆå¦‚å¾®è½¯çš„è®¤è¯ã€Oracle çš„è®¤è¯ï¼‰ï¼Œä¹Ÿå¯ä»¥å±•ç¤ºä¸€ä¸‹ã€‚</li></ol></li></ul><p><strong>å¯¹åº”äºä½ çš„ç®€å†ï¼Œå¦‚æœèƒ½å’Œåº”è˜èŒä½çš„éœ€æ±‚çœ‹é½æœ‰ç›¸ç±»ä¼¼çš„æè¿°ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿåœ°è®©äººè§‰å¾—ä½ å’Œè¦åº”è˜çš„èŒä½å¾ˆåŒ¹é…ã€‚</strong></p><ul><li><p>å·¥ä½œç»å†å’Œæ•™è‚²ç»å†ã€‚</p><ol><li>åˆ—ä¸€ä¸‹ä½ çš„å·¥ä½œç»å†ã€‚æ¯ä»½å·¥ä½œå®Œæˆçš„ä¸»è¦é¡¹ç›®ï¼ˆä¸è¦åˆ—ä¸€å¤§å †é¡¹ç›®ï¼ŒæŒ‘é‡è¦çš„ï¼‰ï¼Œä¸»è¦çªå‡ºé¡¹ç›®çš„éš¾åº¦ã€è§„æ¨¡ã€æŒ‘æˆ˜ã€èŒè´£ï¼Œä»¥åŠè·å¾—çš„è®¤å¯å’Œè£èª‰ã€‚</li><li>å·¥ä½œç»å†å’Œæ•™è‚²ç»å†ï¼Œä¸»è¦æ˜¯å¯¹ä¸Šè¿°çš„ä¸ªäººæŠ€èƒ½çš„å°è¯ã€‚ä¸è¦ä¸œæ‹‰è¥¿æ‰¯ï¼Œè¦ç´§ç´§åœ°å›´ç»•ç€ä½ çš„æŠ€èƒ½ã€ç‰¹é•¿å’Œäº®ç‚¹æ¥å±•å¼€ã€‚</li></ol></li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œä½ ç®€å†ä¸­çš„å†…å®¹æœ€å¥½æ§åˆ¶åœ¨ä¸¤é¡µ A4 çº¸ä»¥å†…ï¼Œæœ€å¥½æœ‰ä¸­è‹±æ–‡ç‰ˆï¼Œç®€å†ä¸è¦æ˜¯ Word ç‰ˆçš„ï¼Œæœ€å¥½æ˜¯ PDF ç‰ˆï¼Œç„¶åç®€å†çš„æ ¼å¼å’Œé£æ ¼è¯·å‚è€ƒ LinkedIn ä¸Šçš„ï¼ˆåœ¨ å¾®è½¯çš„ Office æ¨¡æ¿ç½‘ç«™ ä¸Šä¹Ÿèƒ½æ‰¾åˆ°ä¸€äº›ä¸é”™çš„ç®€å†æ¨¡æ¿ï¼‰ã€‚ç®€å†çš„å†…å®¹ä¸è¦å¤ªå¤šï¼Œå†…å®¹å¤ªå¤šï¼Œé‡ç‚¹å°±ä¸æ˜æ˜¾äº†ã€‚å†™ç®€å†çš„ç›®çš„æ˜¯å‘ˆç°è‡ªå·±çš„ç‰¹é•¿ã€äº®ç‚¹å’Œç‰¹ç‚¹ã€‚åªè¦ä½ èƒ½å‘ˆç°å‡º 2-3 ä¸ªäº®ç‚¹å’Œç‰¹é•¿ï¼Œå°±å¯ä»¥å¸å¼•åˆ°äººäº†ã€‚</p><p>å¦‚æœç®€å†ä¸Šçš„ç»å†å’ŒæŠ€æœ¯äº®ç‚¹ä¸è¶³çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨ç®€å†çš„ç‰ˆå¼å’Œå½¢å¼çš„åˆ¶ä½œä¸ŠèŠ±äº›å¿ƒæ€ï¼Œä»¥åŠåœ¨ç®€å†çš„è‡ªæˆ‘æè¿°ä¸­åŠ ä¸Šä¸€äº›â€œè™šâ€çš„ä¸œè¥¿ã€‚</p><p>æ¯”å¦‚â€œå·¥ä½œæ€åº¦ç§¯æï¼Œä¸åˆ†ä»½å†…å’Œä»½å¤–çš„äº‹ï¼Œåªè¦å¯¹å…¬å¸å’Œä¸ªäººæœ‰åˆ©ï¼Œéƒ½ä¼šåŠªåŠ›åšå¥½ï¼›å‹¤å¥‹è¸å®ï¼Œçƒ­çˆ±å­¦ä¹ ï¼Œå–œæ¬¢åšä¸€ä¸ªå…¨æ ˆå·¥ç¨‹å¸ˆï¼›å–„äºå‘ç°é—®é¢˜ï¼Œå¹¶è§£å†³é—®é¢˜â€¦â€¦â€è¡¨ç¤ºæˆ‘è™½ç„¶ç°åœ¨çš„ç»å†å’ŒæŠ€èƒ½ä¸è¶³ä»¥æ‰“åŠ¨ä½ ï¼Œä½†æ˜¯æˆ‘çš„æ€åº¦ç«¯æ­£ï¼Œæ½œåŠ›å·¨å¤§ï¼Œä½ ä¸èƒ½é”™è¿‡â€¦â€¦</p><h3 id="ï¼ˆäºŒï¼‰ã€æŠ€æœ¯çŸ¥è¯†å‡†å¤‡"><a href="#ï¼ˆäºŒï¼‰ã€æŠ€æœ¯çŸ¥è¯†å‡†å¤‡" class="headerlink" title="ï¼ˆäºŒï¼‰ã€æŠ€æœ¯çŸ¥è¯†å‡†å¤‡"></a>ï¼ˆäºŒï¼‰ã€æŠ€æœ¯çŸ¥è¯†å‡†å¤‡</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œä½ çš„ç®€å†ä¸Šå†™ä»€ä¹ˆï¼Œé¢è¯•å®˜å°±ä¼šé—®ä»€ä¹ˆï¼Œæ‰€ä»¥ï¼Œä¸è¦æ‰“è‡ªå·±çš„è„¸ï¼Œç²¾é€šå°±æ˜¯ç²¾é€šï¼Œç†Ÿæ‚‰å°±æ˜¯ç†Ÿæ‚‰ï¼Œäº†è§£å°±æ˜¯äº†è§£ã€‚ç„¶åå¯¹äºä½ åˆ—å‡ºæ¥çš„è¿™äº›æŠ€æœ¯ï¼Œä½ ä¸€å®šè¦æŠŠå…¶æœ€åŸºæœ¬çš„æŠ€æœ¯ç»†èŠ‚ç»™æŒæ¡äº†ã€‚ä½ ä¸è§å¾—è¦è®°ä½æ‰€æœ‰çš„çŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯ 80% ä»¥ä¸Šçš„å…³é”®çŸ¥è¯†ç‚¹ï¼Œä½ å¤šå°‘å¾—çŸ¥é“å§ã€‚é¢è¯•å®˜ä¸€èˆ¬ä¹Ÿä¼šé€æ­¥åŠ å¤§é—®é¢˜çš„éš¾åº¦å’Œæ·±åº¦ï¼Œçœ‹çœ‹ä½ åˆ°åº•åœ¨å“ªä¸ªå±‚æ¬¡ä¸Šã€‚æ‰€ä»¥ï¼Œä½ è¿˜æ˜¯éœ€è¦ç³»ç»Ÿåœ°çœ‹çœ‹ä¹¦ï¼Œæ‰èƒ½åº”å¯¹é¢è¯•å®˜çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼š</p><ul><li>ä½ å†™ä¸Šäº† Javaï¼Œé‚£ä¹ˆ Java çš„åŸºæœ¬è¯­æ³•éƒ½è¦äº†è§£ï¼Œå¹¶å‘ç¼–ç¨‹ã€NIOã€JVM ç­‰ï¼Œä½ å¤šå°‘è¦æœ‰ç‚¹å„¿äº†è§£ï¼ŒSpringã€Netty è¿™äº›æ¡†æ¶ä¹Ÿè¦äº†è§£ã€‚</li><li>ä½ å†™ä¸Šäº† Goï¼Œé‚£ä¹ˆè‡³å°‘å¾—æŠŠå®˜ç½‘ä¸Šçš„ Effective Go ç»™çœ‹äº†ã€‚</li><li>ä½ å†™ä¸Šäº† Redisï¼Œé‚£ä¹ˆé™¤äº† Redis çš„æ•°æ®ç»“æ„ï¼ŒRedis çš„æ€§èƒ½ä¼˜åŒ–ã€é«˜å¯ç”¨é…ç½®ã€åˆ†å¸ƒå¼é”ä»€ä¹ˆçš„ï¼Œä½ å¤šå°‘ä¹Ÿè¦æŠŠå®˜ç½‘ä¸Šçš„é‚£å‡ ç¯‡æ–‡ç« è¯»ä¸€è¯»ã€‚</li><li>ä½ å†™ä¸Šäº†é¢å‘å¯¹è±¡ï¼Œé‚£ä¹ˆæ€ä¹ˆç€ä¹Ÿå¾—æŠŠã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸­çš„ 23 ä¸ªæ¨¡å¼äº†è§£ä¸€ä¸‹ã€‚</li><li>ä½ å†™ä¸Šäº†åˆ†å¸ƒå¼æ¶æ„ï¼Œé‚£ä¹ˆ CAP ç†è®ºã€å¾®æœåŠ¡æ¶æ„ã€å¼¹åŠ›è®¾è®¡ã€Spring Cloudã€Cloud Native è¿™äº›æ¶æ„å°±è¦åšåˆ°å¿ƒé‡Œæœ‰æ•°ã€‚</li><li>ä½ å†™ä¸Šç½‘ç»œç¼–ç¨‹ï¼Œé‚£ä¹ˆ TCP/IP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼Œä¸¤ç«¯çš„çŠ¶æ€å˜åŒ–ä½ å¾—çŸ¥é“å§ï¼ŒSocket ç¼–ç¨‹çš„é‚£å‡ ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè¿˜æœ‰ selectã€pollã€epoll è¿™äº›å¼‚æ­¥ IO å¤šè·¯å¤ç”¨çš„ä¸œè¥¿ï¼Œä½ å¾—çŸ¥é“ã€‚</li></ul><h3 id="ï¼ˆä¸‰ï¼‰ã€ç®—æ³•é¢˜å‡†å¤‡"><a href="#ï¼ˆä¸‰ï¼‰ã€ç®—æ³•é¢˜å‡†å¤‡" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€ç®—æ³•é¢˜å‡†å¤‡"></a>ï¼ˆä¸‰ï¼‰ã€ç®—æ³•é¢˜å‡†å¤‡</h3><p>é¢è¯•å‰å»LeetCodeç»ƒç»ƒã€‚<a href="https://www.geeksforgeeks.org/top-20-dynamic-programming-interview-questions/">Top 20 çš„åŠ¨æ€è§„åˆ’é¢˜çš„åˆ—è¡¨</a>ã€‚</p><h3 id="ï¼ˆå››ï¼‰ã€å·¥ä½œé¡¹ç›®å‡†å¤‡"><a href="#ï¼ˆå››ï¼‰ã€å·¥ä½œé¡¹ç›®å‡†å¤‡" class="headerlink" title="ï¼ˆå››ï¼‰ã€å·¥ä½œé¡¹ç›®å‡†å¤‡"></a>ï¼ˆå››ï¼‰ã€å·¥ä½œé¡¹ç›®å‡†å¤‡</h3><p><strong>æ— è®ºä»€ä¹ˆå…¬å¸çš„é¢è¯•ï¼Œéƒ½ä¼šè®©ä½ è¯´ä¸€ä¸ªä½ åšè¿‡çš„é¡¹ç›®ï¼Œæˆ–æ˜¯ä½ è¿‡å»è§£å†³è¿‡çš„ä¸€ä¸ªéš¾é¢˜ã€‚</strong> ä¸€èˆ¬æ¥è¯´ï¼Œä¼šæœ‰ä¸‹é¢è¿™æ ·çš„å‡ ä¸ªç»å…¸çš„é¢è¯•é—®é¢˜ï¼š</p><ol><li>è¯´ä¸€ä¸ªä½ åšè¿‡çš„æœ€è‡ªè±ªçš„é¡¹ç›®ï¼Œæˆ–æ˜¯æœ€è¿‘åšè¿‡çš„ä¸€ä¸ªé¡¹ç›®ã€‚</li><li>è¯´ä¸€ä¸ªä½ è§£å†³è¿‡çš„æœ€éš¾çš„æŠ€æœ¯é—®é¢˜ï¼Œæˆ–æ˜¯æœ€æœ‰æŠ€æœ¯å«é‡çš„é—®é¢˜ã€‚</li><li>è¯´ä¸€ä¸ªä½ æœ€ç—›è‹¦çš„é¡¹ç›®ï¼Œæˆ–æœ€è‰°éš¾çš„é¡¹ç›®ã€‚</li><li>è¯´ä¸€ä¸ªçŠ¯è¿‡çš„æœ€å¤§çš„æŠ€æœ¯é”™è¯¯ï¼Œæˆ–æ˜¯å¼•å‘çš„æŠ€æœ¯æ•…éšœã€‚</li></ol><p>å¯¹äºä¸Šé¢è¿™å››ä¸ªé—®é¢˜ï¼šç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸»è¦æ˜¯æƒ³çœ‹çœ‹ä½ è¿‡å»å·¥ä½œä¸­åšè¿‡çš„æœ€é«˜çº§çš„äº‹æ˜¯ä»€ä¹ˆï¼Œè¿˜æœ‰ä½ çš„å…´è¶£ç‚¹å’Œå…´å¥‹ç‚¹æ˜¯ä»€ä¹ˆï¼›ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œä¸»è¦æ˜¯æƒ³çœ‹çœ‹ä½ è§£å†³éš¾é¢˜çš„èƒ½åŠ›ï¼Œä»¥åŠé¢å¯¹å‹åŠ›å’Œå›°éš¾æ—¶çš„å¿ƒæ€ï¼›ç¬¬å››ä¸ªé—®é¢˜ï¼Œä¸»è¦æ˜¯æƒ³äº†è§£ä¸€ä¸‹ä½ é¢å¯¹é”™è¯¯æ—¶çš„æ€åº¦ï¼Œè¿˜è¦äº†è§£ä½ æ˜¯å¦ä¼šå¯¹é”™è¯¯æœ‰æ‰€æ€»ç»“å’Œæ”¹è¿›ã€‚</p><p>æ€æ ·å‡†å¤‡è¿™æ ·çš„é¢˜ï¼Œæˆ‘è¿™é‡Œæœ‰å‡ ä¸ªæç¤ºï¼š</p><ul><li><p>è¦æœ‰æ¡†æ¶ã€‚</p><p>  è®²æ•…äº‹è¦å­¦ä¼šä½¿ç”¨ STAR ã€‚Situation - åœ¨ä»€ä¹ˆæ ·çš„ç¯å¢ƒå’ŒèƒŒæ™¯ä¸‹ï¼ŒTask - ä½ è¦å¹²ä»€ä¹ˆæ ·çš„äº‹ï¼ŒAction - ä½ é‡‡å–äº†ä»€ä¹ˆæ ·çš„è¡ŒåŠ¨å’ŒåŠªåŠ›ï¼ŒResult - æœ€ç»ˆå¾—åˆ°äº†ä»€ä¹ˆæ ·çš„æ•ˆæœã€‚è¿™æ˜¯æ•´ä¸ªè¯­è¨€ç»„ç»‡çš„æ¡†æ¶ï¼Œä¸è¦å†—é•¿å•°å—¦ã€‚</p></li><li><p>è¦æœ‰ç»†èŠ‚ã€‚</p><p>  æ²¡æœ‰ç»†èŠ‚çš„æ•…äº‹å¬èµ·æ¥å°±å¾ˆå‡ï¼Œæ‰€ä»¥ï¼Œå…¶ä¸­è¦æœ‰å¾ˆå¤šç»†èŠ‚ã€‚å› ä¸ºæ˜¯æŠ€æœ¯æ–¹é¢çš„ï¼Œæ‰€ä»¥ï¼Œä¸€å®šè¦æœ‰å¾ˆå¤šæŠ€æœ¯ç»†èŠ‚ã€‚</p></li><li><p>è¦æœ‰æ„Ÿæƒ…ã€‚</p><p>  è®²è¿™äº›æ•…äº‹ä¸€å®šè¦å¸¦æ„Ÿæƒ…ã€‚è¦è®©é¢è¯•å®˜æ„Ÿå—åˆ°ä½ çš„çƒ­æƒ…ã€éª„å‚²ã€åšéŸ§å’Œé¡½å¼ºã€‚ä¸€å®šè¦æ˜¯çœŸå®çš„ï¼Œåªæœ‰çœŸå®çš„äº‹æ‰ä¼šæœ‰çœŸå®çš„æ„Ÿæƒ…ã€‚</p></li><li><p>è¦æœ‰æ€è€ƒã€‚</p><p>  åªæœ‰ç»†èŠ‚å’Œæ•…äº‹è¿˜ä¸å¤Ÿï¼Œè¿˜è¦æœ‰è‡ªå·±çš„æ€è€ƒå’Œå¾—å¤±æ€»ç»“ï¼Œä»¥åŠåç»­çš„æ”¹è¿›ã€‚</p></li></ul><p>å¯¹æ­¤ï¼Œå¦‚æœä½ æƒ³æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é¢è¯•å›ç­”æ•ˆæœï¼Œ<strong>è¿™ä¸æ˜¯ä½ èƒ½ä¸´æ—¶å‡†å¤‡å‡ºæ¥çš„ï¼Œå·¥å¤«éƒ½æ˜¯èŠ±åœ¨å¹³æ—¶çš„ã€‚è€Œè®­ç»ƒè¿™æ–¹é¢èƒ½åŠ›çš„æœ€å¥½æ–¹å¼å°±æ˜¯åœ¨å·¥ä½œä¸­å†™æ–‡æ¡£ ï¼Œåœ¨å·¥ä½œä¹‹ä½™å†™åšå®¢ã€‚</strong> åªæœ‰å†™å¾—å¤šäº†ï¼Œå†™å¾—å¥½äº†ï¼Œä½ è¿™æ ·çš„èƒ½åŠ›æ‰èƒ½è®­ç»ƒå‡ºæ¥ã€‚</p><hr><h2 id="å…«ã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•ä¸­çš„æŠ€å·§"><a href="#å…«ã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•ä¸­çš„æŠ€å·§" class="headerlink" title="å…«ã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•ä¸­çš„æŠ€å·§"></a>å…«ã€ç¨‹åºå‘˜é¢è¯•æ”»ç•¥ï¼šé¢è¯•ä¸­çš„æŠ€å·§</h2><h3 id="ï¼ˆä¸€ï¼‰ã€å½¢è±¡å’Œè°ˆå"><a href="#ï¼ˆä¸€ï¼‰ã€å½¢è±¡å’Œè°ˆå" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€å½¢è±¡å’Œè°ˆå"></a>ï¼ˆä¸€ï¼‰ã€å½¢è±¡å’Œè°ˆå</h3><ul><li>ç€è£…è®©äººæ„Ÿåˆ°å¹²å‡€ã€æ•´æ´ã€‚</li><li>ä¿æŒå¾®ç¬‘ï¼Œè¡¨ç°å¾—çƒ­æƒ…ã€å¼€æœ—å’Œå¹½é»˜ã€‚</li><li>è¯´è¯çš„æ—¶å€™ï¼Œè¦çœ‹ç€å¯¹æ–¹ï¼Œä¸€æ–¹é¢è¿™æ˜¯å¯¹å¯¹æ–¹çš„å°Šé‡å’Œç¤¼è²Œï¼Œå¦ä¸€æ–¹é¢ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§è‡ªä¿¡ã€‚</li><li>é¢è¯•å®˜é—®çš„é—®é¢˜ï¼Œä½ è¦ç»™å‡ºå……è¶³çš„ç»†èŠ‚ï¼Œåƒä¸‡ä¸è¦è®©é¢è¯•å®˜ä¸æ–­åœ°è¿½é—®ï¼Œé‚£æ ·å°±è¢«åŠ¨äº†ã€‚</li></ul><h3 id="ï¼ˆäºŒï¼‰ã€ç­”ä¸å‡ºæ¥"><a href="#ï¼ˆäºŒï¼‰ã€ç­”ä¸å‡ºæ¥" class="headerlink" title="ï¼ˆäºŒï¼‰ã€ç­”ä¸å‡ºæ¥"></a>ï¼ˆäºŒï¼‰ã€ç­”ä¸å‡ºæ¥</h3><p>é¢è¯•ä¸­æœ‰ä¸€äº›é—®é¢˜å¾ˆéš¾ï¼Œä½†æ˜¯ä¸è¦æ”¾å¼ƒï¼Œè¦ä¸æ–­å°è¯•ã€‚å¾ˆå¤šæ—¶å€™ï¼Œé¢è¯•å®˜å¹¶ä¸æœŸå¾…ä½ èƒ½åœ¨å¾ˆçŸ­çš„æ—¶å€™å†…è§£å‡ºä¸€é“éš¾é¢˜ï¼Œä»–åªæ˜¯æƒ³çœ‹ä¸€ä¸‹ä½ é‡åˆ°éš¾é¢˜æ—¶çš„æ€åº¦å’Œæ€ç»´æ–¹å¼ã€‚å¦‚æœä½ èƒ½è¯æ˜ç»™é¢è¯•å®˜çœ‹ï¼Œä½ è§£å†³é—®é¢˜çš„æ–¹å‘å’Œæ–¹æ³•æ˜¯æ­£ç¡®çš„ï¼Œå°±ç®—æ˜¯æ²¡æœ‰æ‰¾åˆ°ç­”æ¡ˆï¼Œä¹Ÿæ˜¯å¾ˆä¸é”™çš„ã€‚å› ä¸ºåªè¦æ–¹å‘èµ°å¯¹äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ—¶é—´é—®é¢˜äº†ã€‚</p><p>å¦‚æœå®åœ¨è§£ä¸å‡ºæ¥ï¼Œæˆ–æ˜¯è¢«é—®äº†ä¸æ‡‚çš„çŸ¥è¯†æ€§é—®é¢˜ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¯´ä¸æ‡‚å°±å¥½äº†ã€‚è®°ä¸‹æ¥ï¼Œå›å»å¤šçœ‹å¤šç»ƒï¼Œä¸‹æ¬¡è®°ä½äº†å°±å¥½ã€‚</p><p>å¦å¤–ï¼Œå¯¹äºæ²¡æœ‰ç­”ä¸Šæ¥çš„é—®é¢˜ï¼Œæœ‰çš„äººä¼šåœ¨é¢è¯•åè¯·æ•™ä¸€ä¸‹é¢è¯•å®˜ã€‚ä½†æ˜¯æˆ‘è§‰å¾—æ›´å¥½çš„æ–¹å¼æ˜¯ï¼Œé—®é¢è¯•å®˜è¦ä¸ªä»–çš„é‚®ç®±æˆ–å¾®ä¿¡ï¼Œå›å»åï¼ŒåŠªåŠ›ææ‡‚ï¼Œä¸¾ä¸€åä¸‰ï¼Œç„¶åå†™ä¸ªä¸œè¥¿å†å‘å›å»ã€‚è¿™æ ·åšæ˜¯æœ‰å¯èƒ½è®©ä½ èµ·æ­»å›ç”Ÿçš„ã€‚å¤šå°‘å¯ä»¥æš—ç¤ºå¯¹æ–¹ï¼šâ€œä½ çœ‹ï¼Œæˆ‘æœ‰ä¸æ‡‚çš„ï¼Œä½†æ˜¯æˆ‘èƒ½ä¸‹å·¥å¤«å¾ˆå¿«å°±ææ‡‚äº†ï¼Œä½ çœ‹æˆ‘çš„å­¦ä¹ èƒ½åŠ›è¿˜ä¸é”™å“¦ã€‚ä½ å°±ä¸å†è€ƒè™‘ä¸€ä¸‹äº†å—ï¼Ÿâ€</p><h3 id="ï¼ˆä¸‰ï¼‰ã€å°–é”é—®é¢˜"><a href="#ï¼ˆä¸‰ï¼‰ã€å°–é”é—®é¢˜" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€å°–é”é—®é¢˜"></a>ï¼ˆä¸‰ï¼‰ã€å°–é”é—®é¢˜</h3><ul><li><p>ä½ ä¸ºä»€ä¹ˆè¦ç¦»å¼€ç°åœ¨çš„å…¬å¸ï¼Ÿ</p><p>  ä¸€èˆ¬æ¥è¯´ï¼Œæ°¸è¿œä¸è¦è¯´ä¹‹å‰å…¬å¸çš„åè¯ã€‚è¯´å®¢è§‚åŸå› ã€‚</p></li><li><p>è¯´ä¸€ä¸‹ä½ çš„ç¼ºç‚¹ï¼Ÿ</p><ol><li>çœŸå®çš„å›ç­”ã€‚</li><li>æœ€åè¿˜è¦è¡¥ä¸€å¥ï¼Œæˆ‘çŸ¥é“æˆ‘çš„ç¼ºç‚¹ï¼Œæˆ‘ä¹Ÿåœ¨åŠªåŠ›æ”¹æ­£ï¼Œæˆ‘æ­£åœ¨é€šè¿‡ä»€ä¹ˆæ ·çš„æ–¹å¼æ”¹æ­£ã€‚è¿™éå¸¸å…³é”®ï¼Œå› ä¸ºè¿™åŸºæœ¬ä¸Šæ˜¯é¢è¯•å®˜æœ€å–œæ¬¢çœ‹åˆ°çš„ç­”æ¡ˆäº†ï¼Œå°±æ˜¯ä½ ä¸ä»…èƒ½æ­£è§†è‡ªå·±çš„ç¼ºç‚¹ï¼Œè€Œä¸”è¿˜èƒ½ä¸æ–­åœ°æ”¹æ­£ã€‚</li></ol></li><li><p>è¯´ä¸€ä¸‹ä½ çš„ä¼˜ç‚¹ï¼Ÿ</p><ol><li>çœŸå®çš„å›ç­”ã€‚ä¼˜ç‚¹æ˜¯éœ€è¦ç”¨è¯æ®æ¥è¯´æ˜çš„ã€‚</li><li>æ¯”å¦‚ï¼Œæˆ‘é€šå¸¸çš„å›ç­”æ˜¯ï¼Œæˆ‘çš„ä¼˜ç‚¹å°±æ˜¯å­¦ä¹ èƒ½åŠ›å¼ºï¼Œå› ä¸ºæˆ‘æŒæ¡çš„æŠ€æœ¯é¢å¾ˆå¹¿ï¼Œè€Œä¸”ï¼Œæˆ‘ä»€ä¹ˆæ ·çš„æŠ€æœ¯éƒ½å­¦ï¼Œæ¯”å¦‚æœ€æ–°çš„ Cloud Native æŠ€æœ¯ã€‚ä½œä¸ºåç«¯äººå‘˜æˆ‘è¿˜å­¦å‰ç«¯æ–¹é¢çš„æŠ€æœ¯å¦‚ React.js å’Œ Vue.jsï¼Œè¿™ä¸€åˆ‡éƒ½æ¥æºäºæˆ‘æ‰å®çš„åŸºç¡€çŸ¥è¯†â€¦â€¦</li><li>å›ç­”è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½ä¼šåè¡¬å‡ºä½ çš„ä»·å€¼è§‚ï¼ŒHR å°±æ˜¯æƒ³äº†è§£ä½ çš„ä»·å€¼è§‚ã€‚æ¯”å¦‚ï¼Œæˆ‘æ¯”è¾ƒè¸å®ï¼Œæˆ‘æƒ³æŠŠæŠ€æœ¯ä¸€ç›´åšåˆ°è€ã€‚å†æ¯”å¦‚ï¼Œæˆ‘æœ‰éŸ§æ€§ï¼Œæˆ‘å—è¿‡å“ªäº›æŒ«æŠ˜ã€å¤±è´¥ã€ä¸å…¬ã€æ— å¥ˆå’Œæ— åŠ©ï¼Œæˆ‘æ²¡æœ‰å½“é€ƒå…µâ€¦â€¦</li></ol></li><li><p>ä½ ä¸ºä»€ä¹ˆæ¢å·¥ä½œæ¢å¾—è¿™ä¹ˆå‹¤ï¼Ÿ</p><ol><li>ç»™å‡ºåˆç†çš„è§£é‡Šï¼Œä»¥æ¶ˆé™¤ç”¨äººæ–¹çš„ç–‘æƒ‘ã€‚</li><li>ä¸€æ–¹é¢ï¼Œä½ è¿˜æ˜¯éœ€è¦è¯šæ³ä¸€ç‚¹å„¿ï¼Œå¦ä¸€æ–¹é¢ï¼Œä½ åœ¨è§£é‡Šæ—¶éœ€è¦æ‰¿è®¤é¢‘ç¹æ¢å·¥ä½œä¹Ÿä¸æ˜¯è‡ªå·±æƒ³çš„ï¼Œè‡ªå·±ä½•å°ä¸æƒ³åœ¨ä¸€ä»½å·¥ä½œä¸Šå¹²å¾—æ—¶é—´é•¿ä¸€ç‚¹å„¿ã€‚æ— å¥ˆï¼Œè¦ä¹ˆæ˜¯å…¬å¸æœ‰å˜åŒ–ï¼Œè¦ä¹ˆå°±æ˜¯è‡ªå·±æ²¡é€‰å¥½ã€‚ä¸€æ–¹é¢è¡¨è¾¾è‡ªå·±ä¹ŸåŒå€¦äº†é¢‘ç¹æ¢å·¥ä½œè¿™ç§äº‹ï¼Œå¦ä¸€æ–¹é¢ï¼Œä½ è¦æŠŠè¿™ä¸ªè¯é¢˜å¼•åˆ°å¦å¤–ä¸€ä¸ªæ–¹å‘ä¸Šâ€”â€”ä»€ä¹ˆæ ·çš„å·¥ä½œè‡ªå·±å¯ä»¥å¹²å¾ˆä¹…ï¼Ÿè‡ªå·±æ‰€æœŸæœ›çš„å·¥ä½œå†…å®¹å’Œå·¥ä½œç¯å¢ƒæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿè¿™æ ·å°±è½¬è€Œå»è°ˆä½ æ‰€å‘å¾€çš„å·¥ä½œå†…å®¹å’Œç¯å¢ƒäº†ï¼Œå¹¶å†è¡¨è¾¾ä¸€ä¸‹åœ¨è¿™æ ·çš„å·¥ä½œç¯å¢ƒä¸‹ï¼Œæ˜¯å¯ä»¥å¾ˆé•¿æ—¶é—´åšä¸‹å»çš„ï¼Œå¹¶æ„¿æ„å’Œå…¬å¸ä¸€èµ·å‘å±•ã€‚</li><li>ä½†æ˜¯ï¼Œå…ˆä¸è¦è¯´å¾—å¤ªç†æƒ³äº†ï¼Œä¸ç„¶ï¼Œç”¨äººæ–¹ä¹Ÿä¼šè§‰å¾—è‡ªå·±æ˜¯åšä¸åˆ°çš„ã€‚æ­£ç¡®çš„è¯´æ³•æ˜¯ï¼Œè‡ªå·±å¹¶ä¸æ‹…å¿ƒå…¬å¸æœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œåªè¦æœ‰ä¸€èµ·æ‰›äº‹çš„é˜Ÿå‹ä¸€èµ·æ‹¼æï¼Œè¿™æ‰æ˜¯æœ€å…³é”®çš„ã€‚</li></ol></li><li><p>ä½ åœ¨ä¸€å®¶å…¬å¸å‘†äº†æ¥è¿‘ 10 å¹´ä¸ºä»€ä¹ˆæ²¡æœ‰åšåˆ°ç®¡ç†å±‚ï¼Ÿä½ åˆæ˜¯æ€ä¹ˆä¿æŒç«äº‰åŠ›çš„ï¼Ÿ</p><ol><li>ä¸€èˆ¬æ¥è¯´ï¼Œä¸æƒ³åšç®¡ç†çš„ç¨‹åºå‘˜ä¹ŸæŒºå¤šçš„ï¼Œåœ¨æŠ€æœ¯çš„æ–¹å‘ä¸Šå‹¤å‹¤æ³æ³æ·±è€•ç»†ä½œï¼Œä¼šæ˜¯ä¸€ä¸ªéå¸¸éš¾å¾—çš„ä¼˜ç§€å·¥ç¨‹å¸ˆã€‚ä¸“æ³¨äºæŠ€æœ¯ï¼Œä¸åˆ†å¿ƒï¼Œä¸æ–­åœ°åœ¨æŠ€æœ¯ä¸Šçš„æ·±åº¦å’Œå¹¿åº¦ä¸Šé’»ç ”ï¼Œè¿™å°±æ˜¯ä¿æŒç«äº‰åŠ›æœ€å¥½çš„æ–¹å¼ã€‚</li></ol></li><li><p>ä½ å·¥ä½œæ»¡ 5 å¹´äº†ï¼Œä¸ºä»€ä¹ˆè¿˜ä¸æ˜¯ä¸€ä¸ªé«˜çº§ç¨‹åºå‘˜ï¼Ÿ</p><ol><li>å¯¹äºå›½å¤–çš„é¡¶å°–å…¬å¸æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ 5 å¹´çš„å·¥ä½œç»éªŒï¼Œä½†è¿˜ä¸èƒ½èƒœä»»é«˜çº§ç¨‹åºå‘˜ï¼ˆAmazon çš„ SDE2ï¼‰çš„èŒä½ï¼Œé‚£ä¹ˆä½ è¿™ä¸ªäººå°±åŸºæœ¬ä¼šè¢« pass æ‰äº†ï¼ŒåŒ…æ‹¬åœ¨èŒçš„å‘˜å·¥ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</li><li>å›½å†…çš„å…¬å¸å¯èƒ½ä¼šé—®ä½ è¿™ä¸ªé—®é¢˜ï¼Œå¯¹æ­¤ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ¯”è¾ƒå¥½çš„å›ç­”æ˜¯è¦åˆ†å‡ æ–¹é¢æ¥è°ˆã€‚ä¸€æ–¹é¢ï¼Œè¿‡å»å› ä¸ºä»€ä¹ˆåŸå› è€½è¯¯äº†äº›æ—¶é—´ï¼ˆç¯å¢ƒå› ç´ ã€å®¢è§‚æ¡ä»¶å› ç´ ï¼‰ï¼Œå¦ä¸€æ–¹é¢ï¼Œè¦è¡¨ç¤ºåŒæ ·ä¹Ÿæœ‰ä¸»è§‚å› ç´ ï¼Œä¸ç„¶æ˜¾å¾—æœ‰ç‚¹æ‰¾å€Ÿå£çš„æ„Ÿè§‰ï¼Œä¸è¯šæ³ã€‚</li><li>æ¥ä¸‹æ¥ï¼Œè¦è¡¨æ˜è‡ªå·±å¿ƒé‡Œé¢ä¹Ÿæ¯”è¾ƒæ…Œï¼ˆè¡¨æ˜è‡ªå·±ä¸ç”¨åˆ«äººæé†’å¯ä»¥è‡ªå·±æ„è¯†åˆ°è‡ªå·±çš„é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥ï¼Œè¿‘ä¸€å¹´æ¥ä¸€ç›´åœ¨å­¦ä¹ ï¼Œç½—åˆ—ä¸€ä¸‹å­¦è¿‡å“ªäº›ä¸œè¥¿ï¼Œæœ€å¥½è¿˜æœ‰å­¦ä¹ ç›®æ ‡å’Œå­¦ä¹ è®¡åˆ’ï¼ˆè¡¨æ˜è‡ªå·±é™¤äº†æœ‰æ„è¯†å¤–ï¼Œè¿˜æœ‰è¡ŒåŠ¨ï¼‰ã€‚å½“ç„¶ï¼Œå‰å®³çš„é¢è¯•å®˜ä¼šä¸æ–­åœ°è¿½é—®ä½ ä¸€äº›ç»†èŠ‚ï¼Œä»¥æ­¤æ¥ç¡®å®šä½ æ²¡æœ‰è¯´å‡è¯ï¼Œå¯¹æ­¤ï¼Œä½ è¦æœ‰å……è¶³çš„å‡†å¤‡ã€‚</li></ol></li><li><p>ä½ ä¸ºä»€ä¹ˆæ¢äº†ä¸€ä¸ªæ–¹å‘ï¼Ÿä½ è§‰å¾—ä½ æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</p><ol><li>è¿™ä¸ªé—®é¢˜å…¶å®å¹¶ä¸éš¾å›ç­”ï¼Œå®è¯å®è¯´å°±å¥½äº†ã€‚ä½†æ˜¯ä¸è¦è®©æ‹›è˜æ–¹æ„Ÿå—åˆ°ä½ æµ®ç‡¥çš„å†…å¿ƒï¼Œæˆ–æ˜¯æœä¸‰æš®å››çš„æ€§æ ¼ï¼Œæ›´ä¸è¦è®©äººæ„Ÿè§‰åˆ°ä½ åƒâ€œå°çŒ«é’“é±¼â€é‚£æ ·ä¸€è¾¹ä¸è¡Œåˆæ¥æå¦ä¸€è¾¹ã€‚</li><li>æˆ‘è§‰å¾—å›ç­”è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯éå¸¸è‡ªä¿¡çš„å›ç­”â€”â€”â€œæˆ‘ä»æ¥æ²¡æœ‰æ”¹å˜æˆ‘çš„æ–¹å‘ï¼Œå› ä¸ºç§ç§åŸå› ï¼Œæˆ‘æ²¡èƒ½å¾—åˆ°æˆ‘æƒ³è¦çš„æ–¹å‘ï¼Œè™½ç„¶ç°åœ¨å¾ˆæ®‹é…·ï¼Œä½†æ˜¯æˆ‘ä¸€ç›´éƒ½æ²¡æœ‰æ”¾å¼ƒæˆ‘çš„æ–¹å‘ï¼Œæˆ‘ä¸€ç›´éƒ½åœ¨åŠªåŠ›å­¦ä¹ â€¦â€¦â€å¦‚æœä½ è¦è¿™ä¹ˆå›ç­”äº†ï¼Œä½ å°±è¦çœŸçš„æ˜¯è¿™æ ·çš„ï¼Œåœ¨æ–°çš„æ–¹å‘æœ‰æ‰€ç ”ç©¶å’Œå»ºæ ‘ï¼Œä¸ç„¶ä¼šè¢«è¯†ç ´çš„ã€‚</li><li>å¦ä¸€ç§å›ç­”åˆ™å¸¸è§„ä¸€ç‚¹ï¼Œé¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œè‡ªå·±çš„å…´è¶£çˆ±å¥½ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹å‘è¦æ¯”ä¹‹å‰çš„é‚£ä¸ªæ–¹å‘æ›´é€‚åˆè‡ªå·±ã€‚å¯ä»¥ç”¨å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œä½†å…¶ä¸­è¦æœ‰ä¸€äº›ç»†èŠ‚ï¼Œæ¯”å¦‚ï¼Œè‡ªå·±è¯•è¿‡è¿™ä¸ªæ–°æ–¹å‘ ï¼Œå‘ç°å¹²å¾—æ¯”åŸæ¥é‚£è¾¹æ›´å¥½ï¼Œæ›´å®¹æ˜“å‡ºæˆç»©ï¼Œè‡ªå·±çš„å…´å¥‹ç‚¹æ›´å¤§ï¼Œæ‰€ä»¥è§‰å¾—æ–°æ–¹å‘æ›´é€‚åˆè‡ªå·±ã€‚ç„¶åï¼Œæ‰¿è®¤æ¢ä¸€ä¸ªæ–¹å‘çŸ­æœŸå†…å¹¶æ²¡æœ‰ä¼˜åŠ¿ã€‚ä½†æ˜¯ï¼Œå› ä¸ºè‡ªå·±çš„æŸæŸç‰¹è´¨ï¼Œæ¯”å¦‚ï¼Œå­¦ä¹ èƒ½åŠ›å¼ºã€å‹¤å¥‹ã€èªæ˜ç­‰ç‰¹è´¨ï¼Œæœªæ¥ä¸€å®šæ˜¯å¯ä»¥èƒœä»»çš„ã€‚</li><li>ä½†æ˜¯ï¼Œä½ è¦ç”¨è¯æ®è¯æ˜ä½ çš„å­¦ä¹ èƒ½åŠ›å¼ºï¼Œä½ æ¯”ä¸€èˆ¬äººå‹¤å¥‹ï¼Œæ¯”ä¸€èˆ¬äººèªæ˜ã€‚ä¸ç„¶å¦‚æœå¯¹æ–¹è¿½é—®ä¸‹å»ï¼Œä¼šè®©ä½ ç ´ç»½ç™¾å‡ºçš„ã€‚æ€»ä¹‹ï¼Œå›ç­”è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦ä¸€å®šçš„è¯æ®ä½œä¸ºè¡¥å……ï¼Œè€Œä¸”è¿˜è¦ä¼´éšç€ä»¥é™èŒé™è–ªä¸ºä»£ä»·ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé€‰å®šæ–¹å‘æœ€å¥½ä¸è¦å†å˜äº†ï¼Œå¦‚æœä¸€å®šè¦å˜çš„è¯ï¼Œä½ ä¹Ÿè¦æœ‰å¿…èƒœçš„ä¿¡å¿ƒå’Œå…ˆä¸‹åä¸Šçš„å¿ƒæ€ï¼Œè€Œä¸”è¿™äº›ä¿¡å¿ƒå’Œå¿ƒæ€è¦è®©æ‹›è˜æ–¹çœ‹åˆ°ã€‚</li></ol></li><li><p>å¯¹äºæŠ€æœ¯çš„çƒ­æƒ…æˆ–åˆå¿ƒä½“ç°åœ¨ä½ ç”Ÿæ´»å’Œå·¥ä½œä¸­çš„å“ªé‡Œï¼Ÿ</p><ol><li>ä½ è¦å°å¿ƒå›ç­”ï¼Œè€Œä¸”æ˜¯è¦å¸¦æ„Ÿæƒ…çš„ï¼Œä½†ä¸€å®šè¦æ˜¯çœŸå®çš„ã€‚</li><li>æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹æŠ€æœ¯çš„çƒ­æƒ…æˆ–åˆå¿ƒï¼Œéœ€è¦è¡¨ç°åœ¨è¿™ä¹ˆå‡ ä¸ªç‰¹è´¨ä¸Šï¼šæ‰§ç€ã€åšæŒã€åšéŸ§ã€ä¸æœè¾“ã€æ‹…å½“ã€ä¸å¦¥åã€ä¸æµ®ç‡¥â€¦â€¦æˆ‘è¯´ä¸€å¥ï¼Œæˆ‘ç›¸ä¿¡æ¯ä¸ªäººæˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰è¿™äº›ç‰¹è´¨ï¼Œè¿™æ˜¯ä½ çš„äº®ç‚¹ï¼Œè¦å°å¿ƒå‘µæŠ¤ã€‚ä¸ç„¶ï¼Œä½ è·Ÿä¸€æ¡å’¸é±¼å°±æ²¡ä»€ä¹ˆä¸¤æ ·äº†ã€‚</li></ol></li></ul><h3 id="ï¼ˆå››ï¼‰ã€ç»“å°¾é—®é¢˜"><a href="#ï¼ˆå››ï¼‰ã€ç»“å°¾é—®é¢˜" class="headerlink" title="ï¼ˆå››ï¼‰ã€ç»“å°¾é—®é¢˜"></a>ï¼ˆå››ï¼‰ã€ç»“å°¾é—®é¢˜</h3><ul><li><p>å¦‚æœä½ é¢å¾—æ¯”è¾ƒå¥½</p><ol><li>è¿™ä¸ªæ—¶å€™å¯ä»¥é—®å‡ ä¸ªå°–é”çš„é—®é¢˜ï¼Œè¿™æ ·æœ‰åˆ©äºåé¢è°ˆ offer å’Œå²—ä½ï¼ˆæŠ“ä½æœºä¼šåè½¬è¢«åŠ¨ä¸ºä¸»åŠ¨ï¼‰ã€‚æ¯”å¦‚ï¼š</li><li>ä½ ä»¬å…¬å¸æœ‰å¤šå°‘ä¸€çº¿å¼€å‘ç»ç†è¿˜åœ¨å†™ä»£ç ï¼Ÿä½ ä»¬çš„ä¸€çº¿ç»ç†éƒ½æ²¡æœ‰æ—¶é—´æ¥å†™ä»£ç äº†ï¼Œä¸çŸ¥é“ç»†èŠ‚æ€ä¹ˆåšå¥½ç®¡ç†ï¼Ÿå¦å¤–æ˜¯ä¸æ˜¯è¯´æ˜ä½ ä»¬å…¬å¸æœ‰å¤§é‡çš„å†…è€—ï¼Ÿ</li><li>ä»»ä½•å…¬å¸éƒ½æœ‰å¥½çš„æœ‰ä¸å¥½çš„ï¼Œä½ èƒ½ä¸èƒ½åˆ†äº«ä¸€ä¸‹ä½ æœ€å–œæ¬¢è¿™ä¸ªå…¬å¸çš„åœ°æ–¹å’Œæœ€ä¸å–œæ¬¢çš„åœ°æ–¹ï¼Ÿ</li></ol></li><li><p>å¦‚æœä½ é¢å¾—ä¸€èˆ¬</p><ol><li>è¿™ä¸ªæ—¶å€™ä½ ä¹Ÿå¯ä»¥é—®äº›åŠ åˆ†çš„é—®é¢˜ã€‚</li><li>æ¯”å¦‚ï¼šç›®å‰è´µå…¬å¸æˆ–æ˜¯è´µå›¢é˜Ÿæœ€éœ€è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿæˆ‘èƒ½å¸®è´µå…¬å¸åšäº›ä»€ä¹ˆï¼Ÿèƒ½ä¸èƒ½ç»™æˆ‘ä¸€äº›èµ„æ–™æˆ‘å…ˆäº†è§£ä¸€ä¸‹ï¼Œè¿™æ ·æˆ‘åé¢å¦‚æœèƒ½è¿›æ¥ï¼Œå°±èƒ½ä¸Šæ‰‹æ›´å¿«ä¸€äº›äº†ã€‚å› ä¸ºä½ é¢å¾—ä¸€èˆ¬çš„è¯ï¼Œé¢è¯•å®˜ä¼šæ¯”è¾ƒçŠ¹è±«å’Œçº ç»“ï¼Œæ­¤æ—¶ä½ éœ€è¦è®©é¢è¯•å®˜ä¸è¦çŠ¹è±«ï¼Œæ‰€ä»¥ï¼Œä½ å¯ä»¥è¡¨ç°å¾—æ›´åŠ çƒ­æƒ…å’Œä¸»åŠ¨ä¸€ç‚¹ã€‚ä½ çœ‹ï¼Œç«Ÿç„¶ä¸€å‰¯é€šè¿‡é¢è¯•æ˜å¤©å°±è¦ä¸Šç­çš„â€œæ— è€»å˜´è„¸â€ä¹Ÿä¼šä¸ºä½ åŠ ç‚¹åˆ†çš„â€¦â€¦ï¼ˆå“ˆå“ˆå“ˆï¼‰</li></ol></li><li><p>å¦‚æœä½ é¢å¾—å¾ˆä¸è¡Œï¼ŒåŸºæœ¬æŒ‚æ‰äº†</p><p>  è¿™ä¸ªæ—¶å€™ï¼Œä¹Ÿè¦é—®é—®é¢˜ã€‚ä½†æœ€å¥½é—®ä¸€ä¸‹é¢è¯•å®˜å¯¹ä½ çš„è¯„ä»·ï¼Œå¹¶ä¸”è®©ä»–æŒ‡å‡ºä½ çš„ä¸è¶³å’Œéœ€è¦æ”¹è¿›çš„åœ°æ–¹ã€‚é¢è¯•æœ¬æ¥å°±æ˜¯ä¸€æ¬¡ç»å†å’Œä¸€æ¬¡å­¦ä¹ ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå…¶å½“ä½œæ˜¯ä¸€ç§å—æ•™è‚²çš„è¿‡ç¨‹ã€‚æ‰€ä»¥ï¼Œä¸è¦æ”¾è¿‡è‡ªå·±å¯ä»¥æˆé•¿çš„æœºä¼šã€‚é€šè¿‡é¢è¯•å®˜ç»™ä½ çš„è¯„ä»·ï¼Œä½ æ—¥åå°±çŸ¥é“è‡ªå·±éœ€è¦åŠªåŠ›çš„åœ°æ–¹å’Œæ–¹å‘äº†ã€‚è¿™æ˜¯å¤šå¥½çš„ä¸€ä»¶äº‹å„¿å•Šã€‚</p></li></ul><hr><h2 id="ä¹ã€é«˜æ•ˆå­¦ä¹ ï¼šç«¯æ­£å­¦ä¹ æ€åº¦"><a href="#ä¹ã€é«˜æ•ˆå­¦ä¹ ï¼šç«¯æ­£å­¦ä¹ æ€åº¦" class="headerlink" title="ä¹ã€é«˜æ•ˆå­¦ä¹ ï¼šç«¯æ­£å­¦ä¹ æ€åº¦"></a>ä¹ã€é«˜æ•ˆå­¦ä¹ ï¼šç«¯æ­£å­¦ä¹ æ€åº¦</h2><h3 id="ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨å­¦ä¹ å’Œè¢«åŠ¨å­¦ä¹ "><a href="#ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨å­¦ä¹ å’Œè¢«åŠ¨å­¦ä¹ " class="headerlink" title="ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨å­¦ä¹ å’Œè¢«åŠ¨å­¦ä¹ "></a>ï¼ˆä¸€ï¼‰ã€ä¸»åŠ¨å­¦ä¹ å’Œè¢«åŠ¨å­¦ä¹ </h3><p>äººçš„å­¦ä¹ åˆ†ä¸ºã€Œè¢«åŠ¨å­¦ä¹ ã€å’Œã€Œä¸»åŠ¨å­¦ä¹ ã€ä¸¤ä¸ªå±‚æ¬¡ã€‚</p><ul><li>è¢«åŠ¨å­¦ä¹ ï¼šå¦‚å¬è®²ã€é˜…è¯»ã€è§†å¬ã€æ¼”ç¤ºï¼Œå­¦ä¹ å†…å®¹çš„å¹³å‡ç•™å­˜ç‡ä¸º 5%ã€10%ã€20% å’Œ 30%ã€‚</li><li>ä¸»åŠ¨å­¦ä¹ ï¼šå¦‚é€šè¿‡è®¨è®ºã€å®è·µã€æ•™æˆç»™ä»–äººï¼Œä¼šå°†åŸæ¥è¢«åŠ¨å­¦ä¹ çš„å†…å®¹ç•™å­˜ç‡ä» 5% æå‡åˆ° 50%ã€75% å’Œ 90%ã€‚</li></ul><p><strong>å­¦ä¹ ä¸æ˜¯åŠªåŠ›è¯»æ›´å¤šçš„ä¹¦ï¼Œç›²ç›®è¿½æ±‚é˜…è¯»çš„é€Ÿåº¦å’Œæ•°é‡ï¼Œè¿™ä¼šè®©äººäº§ç”Ÿä½å±‚æ¬¡çš„å‹¤å¥‹å’Œæˆé•¿çš„æ„Ÿè§‰ï¼Œè¿™åªæ˜¯åœ¨ä½¿è›®åŠ›ã€‚è¦æ€è¾¨ï¼Œè¦è·µè¡Œï¼Œè¦æ€»ç»“å’Œå½’çº³ï¼Œå¦åˆ™ï¼Œä½ åªæ˜¯åœ¨æœºæ¢°åœ°é‡å¤æŸä»¶äº‹ï¼Œè€Œä¸ä¼šæœ‰è´¨çš„æˆé•¿çš„ã€‚</strong></p><h3 id="ï¼ˆäºŒï¼‰ã€æµ…åº¦å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ "><a href="#ï¼ˆäºŒï¼‰ã€æµ…åº¦å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ " class="headerlink" title="ï¼ˆäºŒï¼‰ã€æµ…åº¦å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ "></a>ï¼ˆäºŒï¼‰ã€æµ…åº¦å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ </h3><p>è€å®è¯´ï¼Œå¯¹äºå½“å‰è¿™ä¸ªç¤¾ä¼šï¼š</p><ul><li>å¤§å¤šæ•°äººçš„ä¿¡æ¯æ¸ é“éƒ½è¢«å¾®ä¿¡æœ‹å‹åœˆã€å¾®åšã€çŸ¥ä¹ã€ä»Šæ—¥å¤´æ¡ã€æŠ–éŸ³å æ®ç€ã€‚è¿™äº›ä¿¡æ¯æ¸ é“ä¸­æœ‰è¥å…»çš„ä¿¡æ¯å°‘ä¹‹åˆå°‘ã€‚</li><li>å¤§å¤šæ•°å…¬å¸éƒ½æ˜¯å®è¡Œç±»ä¼¼äº 996 è¿™æ ·çš„åŠ ç­æ–‡åŒ–ï¼Œåœ¨é€æ”¯å’Œæ¶ˆè€—ç€ä¸‹ä¸€ä»£å¹´è½»äººï¼Œè®©ä»–ä»¬æˆé•¿ä¸èµ·æ¥ã€‚</li><li>å› ä¸ºå›½å†…äº’è”ç½‘è®¿é—®ä¸é€šç•…ï¼ŒåŠ ä¸Šè‹±æ–‡æ°´å¹³å—é™ï¼Œæ‰€ä»¥ï¼Œå¤§å¤šæ•°äººæ ¹æœ¬æ²¡æ³•è·å–åˆ°å›½å¤–çš„ç¬¬ä¸€æ‰‹ä¿¡æ¯ã€‚</li><li>å¿«é¤æ–‡åŒ–ç››è¡Œï¼Œç»å¤§å¤šæ•°äººéƒ½æ€¥äºé€Ÿæˆï¼Œå¿ƒæ€æ¯”è¾ƒæµ®ç‡¥ï¼Œå¯¹äº‹ç‰©ä¸æ±‚ç”šè§£ã€‚</li></ul><p>åªè¦ä½ æ³¨æ„è§‚å¯Ÿï¼Œå°±ä¼šå‘ç°ï¼Œå°‘æ•°çš„ç²¾è‹±äººå£«ï¼Œä»–ä»¬åœ¨è®­ç»ƒè‡ªå·±è·å–çŸ¥è¯†çš„èƒ½åŠ›ï¼Œä»–ä»¬åˆ°æºå¤´æŸ¥çœ‹ç¬¬ä¸€æ‰‹çš„èµ„æ–™ï¼Œç„¶åï¼Œæ·±åº¦é’»ç ”ï¼Œå¹¶é€šè¿‡è‡ªå·±çš„æ€è€ƒåï¼Œç”Ÿäº§æ›´å¥½çš„å†…å®¹ã€‚è€Œç»å¤§éƒ¨åˆ†å—ä¼—äº«å—è½»åº¦å­¦ä¹ ï¼Œæ¶ˆè´¹å†…å®¹ã€‚</p><p>ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œåœ¨çŸ¥è¯†çš„é¢†åŸŸä¹Ÿæœ‰é˜¶å±‚ä¹‹åˆ†ï¼Œé‚£äº›é•¿æœŸåœ¨åº•å±‚çŸ¥è¯†é˜¶å±‚çš„äººï¼Œéœ€è¦ç­‰ç€é«˜å±‚çš„äººæ¥å–‚å…»ï¼Œä»–ä»¬é•¿æœŸé™·äºå„ç§è°£è¨€å’Œä¸å‡†ç¡®çš„ä¿¡æ¯ç¯å¢ƒä¸­ï¼Œäºæ˜¯å°±å¯¼è‡´é”™è¯¯æˆ–å¹¼ç¨šçš„è®¤çŸ¥ï¼Œå¹¶ä¹ æƒ¯äºé‚£äº›ä¸è´¹åŠ²å„¿çš„è½»åº¦å­¦ä¹ æ–¹å¼ï¼Œä»è€Œä¸€ç‚¹ç‚¹åœ°ä¸§å¤±äº†æ·±åº¦å­¦ä¹ çš„ç‹¬ç«‹æ€è€ƒèƒ½åŠ›ï¼Œä»è€Œå†ä¹Ÿæ²¡æœ‰èƒ½åŠ›æ‰“ç ´çŸ¥è¯†é˜¶å±‚çš„é™åˆ¶ï¼Œè¢«å›°åœ¨è®¤çŸ¥åº•å±‚ç¿»ä¸äº†èº«ã€‚</p><p>å¯è§æ·±åº¦å­¦ä¹ ååˆ†é‡è¦ï¼Œä½†åº”è¯¥æ€æ ·è¿›è¡Œæ·±åº¦å­¦ä¹ å‘¢ï¼Ÿä¸‹é¢å‡ ç‚¹æ˜¯å…³é”®ã€‚</p><ul><li>é«˜è´¨é‡çš„ä¿¡æ¯æºå’Œç¬¬ä¸€æ‰‹çš„çŸ¥è¯†ã€‚</li><li>æŠŠçŸ¥è¯†è¿æˆåœ°å›¾ï¼Œå°†è‡ªå·±çš„ç†è§£åè¿°å‡ºæ¥ã€‚</li><li>ä¸æ–­åœ°åæ€å’Œæ€è¾¨ï¼Œä¸ä¸åŒå¹´é¾„æ®µçš„äººè®¨è®ºã€‚</li><li>ä¸¾ä¸€åä¸‰ï¼Œå¹¶è·µè¡Œä¹‹ï¼ŒæŠŠçŸ¥è¯†è½¬æ¢æˆæŠ€èƒ½ã€‚</li></ul><p>æ¢è¨€ä¹‹ï¼Œå­¦ä¹ æœ‰ä¸‰ä¸ªæ­¥éª¤ã€‚</p><ul><li>çŸ¥è¯†é‡‡é›†ã€‚ä¿¡æ¯æºæ˜¯éå¸¸é‡è¦çš„ï¼Œ<strong>è·å–ä¿¡æ¯æºå¤´ã€ç ´è§£è¡¨é¢ä¿¡æ¯çš„å†…åœ¨æœ¬è´¨ã€å¤šæ–¹æ•°æ®å°è¯</strong>ï¼Œæ˜¯è¿™ä¸ªæ­¥éª¤çš„å…³é”®ã€‚</li><li>çŸ¥è¯†ç¼åˆã€‚æ‰€è°“ç¼åˆå°±æ˜¯æŠŠä¿¡æ¯ç»„ç»‡èµ·æ¥ï¼Œæˆä¸ºç»“æ„ä½“çš„çŸ¥è¯†ã€‚è¿™é‡Œï¼Œ<strong>è¿æ¥è®°å¿†ï¼Œé€»è¾‘æ¨ç†ï¼ŒçŸ¥è¯†æ¢³ç†</strong>æ˜¯å¾ˆé‡è¦çš„ä¸‰éƒ¨åˆ†ã€‚</li><li>æŠ€èƒ½è½¬æ¢ã€‚é€šè¿‡<strong>ä¸¾ä¸€åä¸‰ã€å®è·µå’Œç»ƒä¹ ï¼Œä»¥åŠä¼ æˆæ•™å¯¼</strong>ï¼ŒæŠŠçŸ¥è¯†è½¬åŒ–æˆè‡ªå·±çš„æŠ€èƒ½ã€‚è¿™ç§æŠ€èƒ½å¯ä»¥è®©ä½ è¿›å…¥æ›´é«˜çš„é˜¶å±‚ã€‚</li></ul><h3 id="ï¼ˆä¸‰ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°æ–¹æ³•"><a href="#ï¼ˆä¸‰ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°æ–¹æ³•" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°æ–¹æ³•"></a>ï¼ˆä¸‰ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°æ–¹æ³•</h3><p><strong>å­¦ä¹ ä¸ä»…ä»…æ˜¯ä¸ºäº†æ‰¾åˆ°ç­”æ¡ˆï¼Œè€Œæ›´æ˜¯ä¸ºäº†æ‰¾åˆ°æ–¹æ³•ã€‚</strong></p><p>åªæœ‰æŒæ¡è§£é¢˜çš„æ€è·¯å’Œæ–¹æ³•ï¼Œä½ æ‰ç®—å¾—ä¸Šæ‹¥æœ‰è§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚æ‰€æœ‰çš„ç»ƒä¹ ï¼Œæ‰€æœ‰çš„ç­”æ¡ˆï¼Œå…¶å®éƒ½æ˜¯åœ¨å¼•å¯¼ä½ å»å¯»æ‰¾ä¸€ç§â€œä»¥ä¸å˜åº”ä¸‡å˜â€çš„æ–¹æ³•æˆ–èƒ½åŠ›ã€‚</p><p><strong>å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°é€šå¾€ç­”æ¡ˆçš„è·¯å¾„å’Œæ–¹æ³•ï¼Œæ˜¯ä¸ºäº†æ‹¥æœ‰æ— å¸ˆè‡ªé€šçš„èƒ½åŠ›ã€‚</strong></p><h3 id="ï¼ˆå››ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°åŸç†"><a href="#ï¼ˆå››ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°åŸç†" class="headerlink" title="ï¼ˆå››ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°åŸç†"></a>ï¼ˆå››ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ‰¾åˆ°åŸç†</h3><p><strong>å­¦ä¹ ä¸ä»…ä»…æ˜¯ä¸ºäº†çŸ¥é“ï¼Œè€Œæ›´æ˜¯ä¸ºäº†æ€è€ƒå’Œç†è§£ã€‚</strong> åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸æ˜¯ä¸ºäº†çŸ¥é“æŸä¸ªäº‹çš„è¡¨é¢æ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯è¦é€šè¿‡è¡¨è±¡å»æ¢ç´¢å…¶å†…åœ¨çš„æœ¬è´¨å’ŒåŸç†ã€‚</p><p>é—®é¢˜ä¼šé©±ä½¿ä½ åƒä¸€ä¸ªä¾¦æ¢ä¸€æ ·å»æ¢ç´¢èƒŒåçš„äº‹å®å’ŒçœŸç›¸ï¼Œå¹¶åœ¨ä¸æ–­çš„æ€è€ƒä¸­ä¸€ç‚¹ä¸€ç‚¹åœ°ç†è§£æ•´ä¸ªäº‹æƒ…çš„å†…åœ¨æœ¬è´¨ã€é€»è¾‘å’ŒåŸç†ã€‚ <strong>ä¸€æ—¦ç†è§£å’ŒæŒæ¡äº†è¿™äº›æœ¬è´¨çš„ä¸œè¥¿ï¼Œä½ å°±ä¼šå‘ç°ï¼Œæ•´ä¸ªå¤æ‚å¤šå˜çš„ä¸–ç•Œåœ¨å˜å¾—è¶Šæ¥è¶Šç®€å•ã€‚ä½ å°±å¥½åƒæ‰¾åˆ°äº†æ‰€æœ‰é—®é¢˜çš„æœ€ç»ˆç­”æ¡ˆä¼¼çš„ï¼Œä¸€é€šç™¾é€šäº†ã€‚</strong></p><h3 id="ï¼ˆäº”ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†äº†è§£è‡ªå·±"><a href="#ï¼ˆäº”ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†äº†è§£è‡ªå·±" class="headerlink" title="ï¼ˆäº”ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†äº†è§£è‡ªå·±"></a>ï¼ˆäº”ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†äº†è§£è‡ªå·±</h3><p><strong>å­¦ä¹ ä¸ä»…ä»…æ˜¯ä¸ºäº†å¼€æ‹“çœ¼ç•Œï¼Œè€Œæ›´æ˜¯ä¸ºäº†æ‰¾åˆ°è‡ªå·±çš„æœªçŸ¥ï¼Œä¸ºäº†äº†è§£è‡ªå·±ã€‚</strong> è‹±æ–‡ä¸­æœ‰å¥è¯å«ï¼šYou do not know what you do not knowï¼Œå¯ä»¥ç¿»è¯‘ä¸ºï¼šä½ ä¸çŸ¥é“ä½ ä¸çŸ¥é“çš„ä¸œè¥¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æ°¸è¿œä¸ä¼šå»å­¦ä¹ ä½ ä¸çŸ¥é“å…¶å­˜åœ¨çš„ä¸œè¥¿ã€‚å°±å¥½åƒä½ æ°¸è¿œ Google ä¸å‡ºæ¥ä½ ä¸çŸ¥é“çš„äº‹ï¼Œå› ä¸ºå¯¹äºä½ ä¸çŸ¥é“çš„äº‹ï¼Œä½ ä¸çŸ¥é“ç”¨ä»€ä¹ˆæ ·çš„å…³é”®è¯ï¼Œä½ ä¸çŸ¥é“å…³é”®è¯ï¼Œä½ å°±æ‰¾ä¸åˆ°ä½ æƒ³è¦çš„çŸ¥è¯†ã€‚</p><p><strong>å¼€æ‹“çœ¼ç•Œçš„ç›®çš„å°±æ˜¯å‘ç°è‡ªå·±çš„ä¸è¶³å’Œä¸Šå‡ç©ºé—´ï¼Œä»è€Œæ‰èƒ½è®©è‡ªå·±æˆé•¿ã€‚</strong></p><h3 id="ï¼ˆå…­ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ”¹å˜è‡ªå·±"><a href="#ï¼ˆå…­ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ”¹å˜è‡ªå·±" class="headerlink" title="ï¼ˆå…­ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ”¹å˜è‡ªå·±"></a>ï¼ˆå…­ï¼‰ã€å­¦ä¹ æ˜¯ä¸ºäº†æ”¹å˜è‡ªå·±</h3><p><strong>å­¦ä¹ ä¸ä»…ä»…æ˜¯ä¸ºäº†æˆé•¿ï¼Œè€Œæ›´æ˜¯ä¸ºäº†æ”¹å˜è‡ªå·±ã€‚</strong> å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬è§‰å¾—å­¦ä¹ æ˜¯ä¸ºäº†è‡ªå·±çš„æˆé•¿ï¼Œä½†æ˜¯å…¶å®ï¼Œå­¦ä¹ æ˜¯ä¸ºäº†æ”¹å˜è‡ªå·±ï¼Œç„¶åæ‰èƒ½è·å¾—æˆé•¿ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œäººéƒ½æ˜¯æœ‰ç›´è§‰çš„ï¼Œä½†å¦‚æœäººçš„ç›´è§‰çœŸçš„é è°±ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦å­¦ä¹ äº†ã€‚è€Œå­¦ä¹ å°±æ˜¯ä¸ºäº†å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬çš„å¾ˆå¤šç›´è§‰æˆ–æ˜¯æ€ç»´æ–¹å¼æ˜¯ä¸å¯¹çš„ï¼Œä¸å¥½çš„ï¼Œä¸ç§‘å­¦çš„ã€‚</p><p><strong>å­¦ä¹ æ˜¯ä¸ºäº†æ”¹å˜è‡ªå·±çš„æ€è€ƒæ–¹å¼ï¼Œæ”¹å˜è‡ªå·±çš„æ€ç»´æ–¹å¼ï¼Œæ”¹å˜è‡ªå·±ä¸ç”Ÿä¿±æ¥çš„é‚£äº›åƒåœ¾å’Œä½æ•ˆçš„ç®—æ³•ã€‚æ€»ä¹‹ï¼Œå­¦ä¹ è®©æˆ‘ä»¬æ”¹å˜è‡ªå·±ï¼Œè¡ŒåŠ¨å’Œè·µè¡Œï¼Œåæ€å’Œæ”¹å–„ï¼Œä»è€Œè·å¾—æˆé•¿ã€‚</strong></p><hr><h2 id="åã€é«˜æ•ˆå­¦ä¹ ï¼šæºå¤´ã€åŸç†å’ŒçŸ¥è¯†åœ°å›¾"><a href="#åã€é«˜æ•ˆå­¦ä¹ ï¼šæºå¤´ã€åŸç†å’ŒçŸ¥è¯†åœ°å›¾" class="headerlink" title="åã€é«˜æ•ˆå­¦ä¹ ï¼šæºå¤´ã€åŸç†å’ŒçŸ¥è¯†åœ°å›¾"></a>åã€é«˜æ•ˆå­¦ä¹ ï¼šæºå¤´ã€åŸç†å’ŒçŸ¥è¯†åœ°å›¾</h2><h3 id="ï¼ˆä¸€ï¼‰ã€æŒ‘é€‰çŸ¥è¯†å’Œä¿¡æ¯æº"><a href="#ï¼ˆä¸€ï¼‰ã€æŒ‘é€‰çŸ¥è¯†å’Œä¿¡æ¯æº" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€æŒ‘é€‰çŸ¥è¯†å’Œä¿¡æ¯æº"></a>ï¼ˆä¸€ï¼‰ã€æŒ‘é€‰çŸ¥è¯†å’Œä¿¡æ¯æº</h3><p>ä¿¡æ¯æºè¦æœ‰ä¸‹é¢å‡ ä¸ªç‰¹è´¨ï¼š</p><ul><li>åº”è¯¥æ˜¯ç¬¬ä¸€æ‰‹èµ„æ–™ï¼Œä¸æ˜¯è¢«åˆ«äººç†è§£è¿‡ã€æ¶ˆåŒ–è¿‡çš„äºŒæ‰‹èµ„æ–™ã€‚å°¤å…¶å¯¹äºçŸ¥è¯†æ€§çš„ä¸œè¥¿æ¥è¯´ï¼Œæ›´æ˜¯è¿™æ ·ã€‚åº”è¯¥æ˜¯åŸæ±åŸå‘³çš„ï¼Œä¸åº”è¯¥æ˜¯è¢«æ·»æ²¹åŠ é†‹çš„ã€‚</li><li>åº”è¯¥æ˜¯æœ‰ä½è¯ã€æœ‰æ•°æ®ã€æœ‰å¼•ç”¨çš„ï¼Œæˆ–æ˜¯æœ‰æƒå¨äººå£«æˆ–å¤§å…¬å¸ç”Ÿäº§ç³»ç»ŸèƒŒä¹¦çš„èµ„æ–™ã€‚åº”è¯¥æ˜¯è¢«æ—¶é—´å’Œå®è·µæ£€éªŒè¿‡çš„ï¼Œæˆ–æ˜¯å°å¿ƒæ±‚è¯è¿‡çš„ï¼Œä¸æ˜¯æ‹è„‘è¢‹é‡è·¯å­æˆ–æ˜¯é“å¬é€”è¯´å‡ºæ¥çš„èµ„æ–™ã€‚</li><li>åº”è¯¥æ˜¯åŠ å…¥äº†ä¸€äº›è‡ªå·±çš„ç»éªŒå’Œæ€è€ƒï¼Œå¯ä»¥å¼•å‘äººæ·±æ€çš„ï¼Œæ˜¯æ‰€è°“ä¿¡æ¯çš„å¯†é›†å¾ˆå¤§çš„æ–‡ç« ã€‚</li></ul><h3 id="ï¼ˆäºŒï¼‰ã€æ³¨é‡åŸºç¡€å’ŒåŸç†"><a href="#ï¼ˆäºŒï¼‰ã€æ³¨é‡åŸºç¡€å’ŒåŸç†" class="headerlink" title="ï¼ˆäºŒï¼‰ã€æ³¨é‡åŸºç¡€å’ŒåŸç†"></a>ï¼ˆäºŒï¼‰ã€æ³¨é‡åŸºç¡€å’ŒåŸç†</h3><p><strong>åŸºç¡€çŸ¥è¯†å’ŒåŸç†æ€§çš„ä¸œè¥¿å’ŒæŠ€æœ¯ï¼Œéƒ½æ˜¯ç»å†è¿‡é•¿æ—¶é—´çš„è€ƒéªŒçš„ï¼Œæ‰€ä»¥ï¼Œè¿™äº›åŸºç¡€æŠ€æœ¯ä¹Ÿæœ‰å¾ˆå¤šäººç±»å†å²ä¸Šçš„æ™ºæ…§ç»“æ™¶ï¼Œä¼šç»™ä½ å¾ˆå¤šå¯ç¤ºå’Œå¸®åŠ©ã€‚</strong> æ¯”å¦‚ï¼šTCP åè®®çš„çŠ¶æ€æœºï¼Œå¯ä»¥è®©ä½ æ˜ç™½ï¼Œå¦‚æœä½ è¦è®¾è®¡ä¸€ä¸ªå¼‚æ­¥é€šä¿¡åè®®ï¼ŒçŠ¶æ€æœºæ˜¯ä¸€ä»¶å¤šä¹ˆé‡è¦çš„äº‹ï¼Œè¿˜æœ‰ TCP æ‹¥å¡æ§åˆ¶ä¸­çš„æ–¹å¼ï¼Œè®©ä½ çŸ¥é“ï¼Œè®¾è®¡ä¸€ä¸ªä»¥å“åº”æ—¶é—´æ¥é™æµçš„ä¸­ä»¶é—´æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><h3 id="ï¼ˆä¸‰ï¼‰ã€ä½¿ç”¨çŸ¥è¯†å›¾"><a href="#ï¼ˆä¸‰ï¼‰ã€ä½¿ç”¨çŸ¥è¯†å›¾" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€ä½¿ç”¨çŸ¥è¯†å›¾"></a>ï¼ˆä¸‰ï¼‰ã€ä½¿ç”¨çŸ¥è¯†å›¾</h3><p>è”æƒ³è®°å¿†æ³•ã€‚æ¯”å¦‚ï¼Œåœ¨å­¦ä¹  C++ çš„æ—¶å€™ï¼Œé¢å¯¹ã€ŠC++ Primerã€‹è¿™ç§åšå¾—ä¸è¡Œçš„ä¹¦ï¼Œæˆ‘å°±ä½¿ç”¨è”æƒ³è®°å¿†æ³•ã€‚</p><p>æˆ‘æŠŠ C++ åˆ†æˆä¸‰éƒ¨åˆ†ï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ C++ æ˜¯ç”¨æ¥è§£å†³ C è¯­è¨€çš„é—®é¢˜çš„ï¼Œé‚£ä¹ˆ C è¯­è¨€æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼ŸæŒ‡é’ˆã€å®ã€é”™è¯¯å¤„ç†ã€æ•°æ®æ‹·è´â€¦â€¦ C++ ç”¨ä»€ä¹ˆæŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜å‘¢ï¼Ÿ</li><li>ç¬¬äºŒéƒ¨åˆ†æ˜¯ C++ çš„é¢å‘å¯¹è±¡ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚å°è£…ï¼Œè®©æˆ‘æƒ³åˆ°äº†æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ç­‰ã€‚æ„é€ å‡½æ•°è®©æˆ‘æƒ³åˆ°äº†åˆå§‹åŒ–åˆ—è¡¨ï¼Œæƒ³åˆ°äº†é»˜è®¤æ„é€ å‡½æ•°ï¼Œæƒ³åˆ°äº†æ‹·è´æ„é€ å‡½æ•°ï¼Œæƒ³åˆ°äº† newâ€¦â€¦å¤šæ€ï¼Œè®©æˆ‘æƒ³åˆ°äº†è™šå‡½æ•°ï¼Œæƒ³åˆ°äº† RTTIï¼ŒRTTI è®©æˆ‘æƒ³åˆ°äº† dynamic_cast å’Œ typeid ç­‰ã€‚</li><li>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ C++ çš„æ³›å‹ç¼–ç¨‹ã€‚æˆ‘æƒ³åˆ°äº† templateï¼Œæƒ³åˆ°äº†æ“ä½œç¬¦é‡è½½ï¼Œæƒ³åˆ°äº†å‡½æ•°å¯¹è±¡ï¼Œæƒ³åˆ° STLï¼Œæƒ³åˆ°æ•°æ®å®¹å™¨ï¼Œæƒ³åˆ°äº† iteratorï¼Œæƒ³åˆ°äº†é€šç”¨ç®—æ³•ï¼Œç­‰ç­‰ã€‚</li></ul><p>äºæ˜¯ï¼Œæˆ‘é€šè¿‡â€œé¡ºè—¤æ‘¸ç“œâ€çš„æ–¹å¼ï¼Œä»çŸ¥è¯†æ ‘çš„ä¸»å¹²å¼€å§‹åšå¹¿åº¦æˆ–æ˜¯æ·±åº¦éå†ï¼Œäºæ˜¯æˆ‘å°±å¾—åˆ°äº†ä¸€æ•´æ£µçš„çŸ¥è¯†æ ‘ã€‚è¿™ç§â€œé¡ºè—¤æ‘¸ç“œâ€çš„è®°å¿†æ–¹å¼è®©æˆ‘è®°ä½äº†å¾ˆå¤šçŸ¥è¯†ã€‚<strong>æœ€é‡è¦çš„æ˜¯ï¼Œå½“å‡ºç°ä¸€äº›æˆ‘ä¸çŸ¥é“çš„çŸ¥è¯†ç‚¹æ—¶ï¼Œæˆ‘å°±ä¼šå¾€è¿™æ£µçŸ¥è¯†æ ‘ä¸ŠæŒ‚ï¼Œè€Œè¿™æ ·ä¸€æ¥ï¼Œä¹Ÿä½¿å¾—æˆ‘çš„å­¦ä¹ æ›´ä¸ºç³»ç»Ÿå’Œå…¨é¢ã€‚</strong></p><p>è¿™ç§ç”»çŸ¥è¯†å›¾çš„æ–¹å¼å¯ä»¥è®©ä½ ä»ä¸€ä¸ªæŠ€æœ¯æœ€é‡è¦æœ€ä¸»å¹²çš„åœ°æ–¹å‡ºå‘å¼€å§‹éå†æ‰€æœ‰çš„æŠ€æœ¯ç»†èŠ‚ï¼Œä¹Ÿå°±æ˜¯ç”»åœ°å›¾çš„æ–¹å¼ã€‚å¦‚æœä½ ä¸æƒ³åœ¨çŸ¥è¯†çš„æµ·æ´‹ä¸­è¿·è·¯ï¼Œä½ éœ€è¦æœ‰ä¸€ä»½åœ°å›¾ï¼Œæ‰€ä»¥ï¼Œ<strong>å­¦ä¹ å¹¶ä¸æ˜¯ä¸ºäº†è¦è®°å¿†é‚£äº›çŸ¥è¯†ç‚¹ï¼Œè€Œæ˜¯ä¸ºäº†è¦æ‰¾åˆ°ä¸€ä¸ªçŸ¥è¯†çš„åœ°å›¾ï¼Œä½ åœ¨è¿™ä¸ªåœ°å›¾ä¸Šèƒ½é€šè¿‡å…³é”®è·¯å¾„æ‰¾åˆ°ä½ æƒ³è¦çš„ç­”æ¡ˆã€‚</strong></p><hr><h2 id="åä¸€ã€é«˜æ•ˆå­¦ä¹ ï¼šæ·±åº¦ï¼Œå½’çº³å’ŒåšæŒå®è·µ"><a href="#åä¸€ã€é«˜æ•ˆå­¦ä¹ ï¼šæ·±åº¦ï¼Œå½’çº³å’ŒåšæŒå®è·µ" class="headerlink" title="åä¸€ã€é«˜æ•ˆå­¦ä¹ ï¼šæ·±åº¦ï¼Œå½’çº³å’ŒåšæŒå®è·µ"></a>åä¸€ã€é«˜æ•ˆå­¦ä¹ ï¼šæ·±åº¦ï¼Œå½’çº³å’ŒåšæŒå®è·µ</h2><h3 id="ï¼ˆä¸€ï¼‰ã€ç³»ç»Ÿåœ°å­¦ä¹ "><a href="#ï¼ˆä¸€ï¼‰ã€ç³»ç»Ÿåœ°å­¦ä¹ " class="headerlink" title="ï¼ˆä¸€ï¼‰ã€ç³»ç»Ÿåœ°å­¦ä¹ "></a>ï¼ˆä¸€ï¼‰ã€ç³»ç»Ÿåœ°å­¦ä¹ </h3><p>å½“ç„¶å­¦ä¹ ä¸€é—¨æŠ€æœ¯æ—¶ï¼ŒGo è¯­è¨€ä¹Ÿå¥½ï¼ŒDocker ä¹Ÿå¥½ï¼Œæˆ‘éƒ½æœ‰ä¸€ä¸ªå­¦ä¹ æ¨¡æ¿ã€‚åªæœ‰æŠŠè¿™ä¸ªå­¦ä¹ æ¨¡æ¿ä¸­çš„å†…å®¹éƒ½å¡«å®äº†ï¼Œæˆ‘æ‰ç½¢ä¼‘ã€‚è¿™ä¸ªæ¨¡æ¿å¦‚ä¸‹ï¼š</p><ol><li><p>è¿™ä¸ªæŠ€æœ¯å‡ºç°çš„èƒŒæ™¯ã€åˆè¡·å’Œè¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„ç›®æ ‡æˆ–æ˜¯è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ã€‚</p><p> è¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ åœ¨å­¦ä¹ ä¸€ä¸ªæŠ€æœ¯çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“è¿™ä¸ªæŠ€æœ¯çš„æˆå› å’Œç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæŠ€æœ¯çš„çµé­‚ã€‚å¦‚æœä¸çŸ¥é“è¿™äº›çš„è¯ï¼Œé‚£ä¹ˆä½ ä¼šçœ‹ä¸æ‡‚è¿™ä¸ªæŠ€æœ¯çš„ä¸€äº›è®¾è®¡ç†å¿µã€‚</p></li><li><p>è¿™ä¸ªæŠ€æœ¯çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œæˆ–è€…è¯´ï¼Œè¿™ä¸ªæŠ€æœ¯çš„ trade-off æ˜¯ä»€ä¹ˆã€‚</p><p> ä»»ä½•æŠ€æœ¯éƒ½æœ‰å…¶å¥½åï¼Œåœ¨è§£å†³ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜ã€‚å¦å¤–ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•è®¾è®¡éƒ½æœ‰ trade-offï¼ˆè¦ä»€ä¹ˆå’Œä¸è¦ä»€ä¹ˆï¼‰ï¼Œæ‰€ä»¥ï¼Œä½ è¦æ¸…æ¥šè¿™ä¸ªæŠ€æœ¯çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Œä»¥åŠå¸¦æ¥çš„æŒ‘æˆ˜ã€‚</p></li><li><p>è¿™ä¸ªæŠ€æœ¯é€‚ç”¨çš„åœºæ™¯ã€‚</p><p> ä»»ä½•æŠ€æœ¯éƒ½æœ‰å…¶é€‚ç”¨çš„åœºæ™¯ï¼Œç¦»å¼€äº†è¿™ä¸ªåœºæ™¯ï¼Œè¿™ä¸ªæŠ€æœ¯å¯èƒ½ä¼šæœ‰å¾ˆå¤šæ§½ç‚¹ï¼Œæ‰€ä»¥å­¦ä¹ æŠ€æœ¯ä¸ä½†è¦çŸ¥é“è¿™ä¸ªæŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Œè¿˜è¦çŸ¥é“å…¶é€‚ç”¨çš„åœºæ™¯ã€‚æ²¡æœ‰ä»»ä½•ä¸€ä¸ªæŠ€æœ¯æ˜¯æ™®é€‚çš„ã€‚æ³¨æ„ï¼Œæ‰€è°“åœºæ™¯ä¸€èˆ¬åˆ†åˆ«ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä¸šåŠ¡åœºæ™¯ï¼Œä¸€ä¸ªæ˜¯æŠ€æœ¯åœºæ™¯ã€‚</p></li><li><p>æŠ€æœ¯çš„ç»„æˆéƒ¨åˆ†å’Œå…³é”®ç‚¹ã€‚</p><p> è¿™æ˜¯æŠ€æœ¯çš„æ ¸å¿ƒæ€æƒ³å’Œæ ¸å¿ƒç»„ä»¶äº†ï¼Œä¹Ÿæ˜¯è¿™ä¸ªæŠ€æœ¯çš„çµé­‚æ‰€åœ¨äº†ã€‚å­¦ä¹ æŠ€æœ¯çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯å¿«é€ŸæŒæ¡çš„å…³é”®ã€‚</p></li><li><p>æŠ€æœ¯çš„åº•å±‚åŸç†å’Œå…³é”®å®ç°ã€‚</p><p> ä»»ä½•ä¸€ä¸ªæŠ€æœ¯éƒ½æœ‰å…¶åº•å±‚çš„å…³é”®åŸºç¡€æŠ€æœ¯ï¼Œè¿™äº›å…³é”®æŠ€æœ¯å¾ˆæœ‰å¯èƒ½ä¹Ÿæ˜¯å…¶å®ƒæŠ€æœ¯çš„å…³é”®åŸºç¡€æŠ€æœ¯ã€‚æ‰€ä»¥ï¼Œå­¦ä¹ è¿™äº›å…³é”®çš„åŸºç¡€åº•å±‚æŠ€æœ¯ï¼Œå¯ä»¥è®©ä½ æœªæ¥å¾ˆå¿«åœ°æŒæ¡å…¶å®ƒæŠ€æœ¯ã€‚å¯ä»¥å‚çœ‹æˆ‘åœ¨ CoolShell ä¸Šå†™çš„ Docker åº•å±‚æŠ€æœ¯é‚£ä¸€ç³»åˆ—æ–‡ç« ã€‚</p></li><li><p>å·²æœ‰çš„å®ç°å’Œå®ƒä¹‹é—´çš„å¯¹æ¯”ã€‚</p><p> ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•ä¸€ä¸ªæŠ€æœ¯éƒ½ä¼šæœ‰ä¸åŒçš„å®ç°ï¼Œä¸åŒçš„å®ç°éƒ½ä¼šæœ‰ä¸åŒçš„ä¾§é‡ã€‚å­¦ä¹ ä¸åŒçš„å®ç°ï¼Œå¯ä»¥è®©ä½ å¾—åˆ°ä¸åŒçš„æƒ³æ³•å’Œæ€è·¯ï¼Œå¯¹äºå¼€é˜”æ€ç»´ï¼Œæ·±å…¥ç»†èŠ‚æ˜¯éå¸¸é‡è¦çš„ã€‚</p></li></ol><h3 id="ï¼ˆäºŒï¼‰ã€ä¸¾ä¸€åä¸‰"><a href="#ï¼ˆäºŒï¼‰ã€ä¸¾ä¸€åä¸‰" class="headerlink" title="ï¼ˆäºŒï¼‰ã€ä¸¾ä¸€åä¸‰"></a>ï¼ˆäºŒï¼‰ã€ä¸¾ä¸€åä¸‰</h3><p>æˆ‘è§‰å¾—ä¸€ä¸ªäººçš„ä¸¾ä¸€åä¸‰èƒ½åŠ›ï¼Œå¯ä»¥åˆ†è§£æˆå¦‚ä¸‹ä¸‰ç§åŸºæœ¬èƒ½åŠ›ï¼š</p><ol><li><p>è”æƒ³èƒ½åŠ›ã€‚</p><p> è¿™ç§èƒ½åŠ›çš„é”»ç‚¼éœ€è¦ä½ å¹³æ—¶å°±åœ¨ä¸åœåœ°æ€è€ƒåŒä¸€ä¸ªäº‹ç‰©çš„ä¸åŒçš„ç”¨æ³•ï¼Œæˆ–æ˜¯è”æƒ³ä¸ä¹‹æœ‰å…³çš„å…¶ä»–äº‹ç‰©ã€‚å¯¹äºè½¯ä»¶å¼€å‘å’ŒæŠ€æœ¯å­¦ä¹ ä¹Ÿä¸€æ ·ã€‚</p></li><li><p>æŠ½è±¡èƒ½åŠ›ã€‚</p><p> æŠ½è±¡èƒ½åŠ›æ˜¯ä¸¾ä¸€åä¸‰çš„åŸºæœ¬æŠ€èƒ½ã€‚å¹³æ—¶ä½ è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œå¦‚æœä½ èƒ½å¯¹è¿™ä¸ªé—®é¢˜è¿›è¡ŒæŠ½è±¡ï¼Œä½ å°±å¯ä»¥è·å¾—æ›´å¤šçš„è¡¨ç°å½¢å¼ã€‚æŠ½è±¡èƒ½åŠ›éœ€è¦æ‰¾åˆ°è§£å†³é—®é¢˜çš„é€šç”¨æ¨¡å‹ï¼Œæ¯”å¦‚æ•°å­¦å°±æ˜¯å¯¹ç°å®ä¸–ç•Œçš„ä¸€ç§æŠ½è±¡ã€‚åªè¦æˆ‘ä»¬èƒ½æŠŠç°å®ä¸–ç•Œçš„å„ç§é—®é¢˜å»ºç«‹æˆæ•°æ®æ¨¡å‹ï¼ˆå¦‚ï¼Œå»ºç«‹å„ç§ç»´åº¦çš„å‘é‡ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ•°å­¦æ¥æ±‚è§£ï¼Œè¿™ä¹Ÿæ˜¯æœºå™¨å­¦ä¹ çš„æœ¬è´¨ã€‚</p></li><li><p>è‡ªçœèƒ½åŠ›ã€‚</p><p> æ‰€è°“è‡ªçœèƒ½åŠ›å°±æ˜¯è‡ªå·±æ‰¾è‡ªå·±çš„éš¾çœ‹ã€‚å½“ä½ å¾—åˆ°ä¸€ä¸ªè§£çš„æ—¶å€™ï¼Œè¦ç«™åœ¨è‡ªå·±çš„å¯¹ç«‹é¢æ¥æ‰¾è¿™ä¸ªè§£çš„æ¼æ´ã€‚æœ‰ç‚¹åƒå·¦å³æ‰‹äº’åšã€‚è¿™ç§è‡ªå·±å’Œè‡ªå·±è¾©è®ºçš„èƒ½åŠ›åˆå«æ€è¾¨èƒ½åŠ›ã€‚å°†è‡ªå·±åˆ†è£‚æˆæ­£åæ–¹ï¼Œå·¦å³æ–¹ï¼Œç”šè‡³å¤šæ–¹ï¼Œç«™åœ¨ä¸åŒçš„ç«‹åœºä¸Šæ¥å’Œè‡ªå·±è¾©è®ºï¼Œä»è€Œåšåˆ°ä¸æ¼è¿‡ä¸€ä¸ª caseï¼Œä»è€Œè·å¾—å®Œæ•´å…¨é¢çš„é—®é¢˜åˆ†æèƒ½åŠ›ã€‚</p></li></ol><p>åœ¨è¿™æ–¹é¢ï¼Œæˆ‘å¯¹è‡ªå·±çš„è®­ç»ƒå¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºä¸€ä¸ªåœºæ™¯ï¼Œåˆ¶é€ å‡ºå„ç§ä¸åŒçš„é—®é¢˜æˆ–éš¾é¢˜ã€‚</li><li>å¯¹äºä¸€ä¸ªé—®é¢˜ï¼ŒåŠªåŠ›å¯»æ‰¾å°½å¯èƒ½å¤šçš„è§£ï¼Œå¹¶æ¯”è¾ƒè¿™äº›è§£çš„ä¼˜åŠ£ã€‚</li><li>å¯¹äºä¸€ä¸ªè§£ï¼ŒåŠªåŠ›å¯»æ‰¾å„ç§ä¸åŒçš„æµ‹è¯•æ¡ˆä¾‹ï¼Œä»¥å›¾è®©å…¶å¥å£®ã€‚</li></ul><h3 id="ï¼ˆä¸‰ï¼‰ã€æ€»ç»“å’Œå½’çº³"><a href="#ï¼ˆä¸‰ï¼‰ã€æ€»ç»“å’Œå½’çº³" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€æ€»ç»“å’Œå½’çº³"></a>ï¼ˆä¸‰ï¼‰ã€æ€»ç»“å’Œå½’çº³</h3><p>å¯¹è‡ªå·±çš„çŸ¥è¯†è¿›è¡Œæ€»ç»“å’Œå½’çº³æ˜¯æé«˜å­¦ä¹ èƒ½åŠ›çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ‰‹æ®µã€‚è¿™æ˜¯æŠŠä¸€ä¸ªå¤æ‚é—®é¢˜ç”¨ç®€å•çš„è¯­è¨€æ¥æè¿°çš„èƒ½åŠ›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æŠŠå­¦åˆ°çš„ä¸œè¥¿ç”¨è‡ªå·±çš„è¯­è¨€å’Œç†è§£é‡æ–°ç»„ç»‡å¹¶è¡¨è¾¾å‡ºæ¥ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹ä¿¡æ¯è¿›è¡Œæ¶ˆåŒ–å’Œå†åŠ å·¥çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæœ‰ä¿¡æ¯æŸå¤±ï¼Œä½†ä¹Ÿå¯èƒ½ä¼šæœ‰æ–°ä¿¡æ¯åŠ å…¥ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¿¡æ¯é‡æ„çš„è¿‡ç¨‹ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåªå­¦äº†éƒ¨åˆ†çŸ¥è¯†æˆ–è€…è¿˜æ²¡æœ‰å­¦é€ï¼Œå°±å¼€å§‹å¯¹çŸ¥è¯†è¿›è¡Œæ€»ç»“å½’çº³ï¼Œé‚£ä¹ˆæ€»ç»“å½’çº³å‡ºæ¥çš„çŸ¥è¯†ç»“æ„ä¹Ÿåªèƒ½æ˜¯æ··ä¹±å’Œå¹¼ç¨šçš„ã€‚å› æ­¤ï¼Œ <strong>å­¦ä¹ çš„å¼€å§‹é˜¶æ®µï¼Œå¯ä»¥ä¸æ€¥äºæ€»ç»“å½’çº³ï¼Œä¸æ€¥äºä¸‹åˆ¤æ–­ï¼Œåšç»“è®ºï¼Œè€Œåº”è¯¥ä¿ç•™éƒ¨åˆ†çŸ¥è¯†çš„ä¸ç¡®å®šæ€§ï¼Œä¿æŒå¯¹çŸ¥è¯†çš„å¼€æ”¾çŠ¶æ€ã€‚</strong> å½“å¯¹æ•´ä¸ªçŸ¥è¯†çš„ç†è§£æ›´æ·±å…¥ï¼Œè‡ªå·±ç«™çš„ä½ç½®æ›´é«˜ä»¥åï¼Œæ€»ç»“å’Œå½’çº³æ‰ä¼šæ›´æœ‰æ¡ç†ã€‚æ€»ç»“å½’çº³æ›´å¤šæ˜¯åœ¨å¤ä¹ ä¸­å¯¹çŸ¥è¯†çš„å›é¡¾å’Œé‡ç»„ï¼Œè€Œä¸æ˜¯ä¸€è¾¹å­¦ä¹ ä¸€è¾¹å°±æ€»ç»“å½’çº³ã€‚</p><p>æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹åšæ€»ç»“å½’çº³çš„æ–¹æ³•ï¼š<strong>æŠŠä½ çœ‹åˆ°å’Œå­¦ä¹ åˆ°çš„ä¿¡æ¯ï¼Œå½’æ•´å¥½ï¼Œæ’åˆ—å¥½ï¼Œå…³è”å¥½ï¼Œæ€»ä¹‹æŠŠä¿¡æ¯ç¢ç‰‡ç»™ç»“æ„åŒ–æ‰ï¼Œç„¶ååœ¨ç»“æ„åŒ–çš„ä¿¡æ¯ä¸­ï¼Œæ‰¾åˆ°è§„å¾‹ï¼Œæ‰¾åˆ°ç›¸é€šä¹‹å¤„ï¼Œæ‰¾åˆ°å…±åŒä¹‹å¤„ï¼Œè¿›è¡Œç®€åŒ–ã€å½’çº³å’Œæ€»ç»“ï¼Œæœ€ç»ˆå½¢æˆä¸€ç§å¥—è·¯ï¼Œä¸€ç§æ¨¡å¼ï¼Œä¸€ç§é€šç”¨æ–¹æ³•ã€‚</strong></p><p>è¦è®­ç»ƒè‡ªå·±è¿™æ–¹é¢çš„èƒ½åŠ›ï¼Œä½ éœ€è¦å¤šçœ‹ä¸€äº›ç»å…¸çš„æ–¹æ³•è®ºå›¾ä¹¦ï¼Œçœ‹çœ‹åˆ«äººæ˜¯æ€æ ·æ€»ç»“å’Œå½’çº³çŸ¥è¯†çš„ã€‚ä½ å¯ä»¥åœ¨ä¸€å¼€å§‹æ¨¡ä»¿å¹¶æŠŠè‡ªå·±çš„ç†è§£çš„çŸ¥è¯†ç»™å†™å‡ºæ¥ï¼Œå†™åšå®¢ä¼šæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ã€‚å¦å¤–ä¸€ç§æ›´å¥½çš„æ–¹å¼æ˜¯è®²ä¸€éç»™åˆ«äººå¬ã€‚æ€»ä¹‹ï¼Œä½ éœ€è¦æŠŠä½ æ€»ç»“å½’çº³çš„çŸ¥è¯†å…¬å¼€å‡ºæ¥ï¼Œç»™åˆ«äººçœ‹ï¼Œæ¥å—åˆ«äººçš„æ‰¹è¯„å’Œåé¦ˆï¼Œè¿™æ ·ä½ æ‰èƒ½æˆé•¿å¾—æ›´å¿«ã€‚å…¶å®ï¼Œæˆ‘ä¹Ÿåœ¨é”»ç‚¼è¿™æ ·çš„èƒ½åŠ›ã€‚</p><h3 id="ï¼ˆå››ï¼‰ã€å®è·µå‡ºçœŸçŸ¥"><a href="#ï¼ˆå››ï¼‰ã€å®è·µå‡ºçœŸçŸ¥" class="headerlink" title="ï¼ˆå››ï¼‰ã€å®è·µå‡ºçœŸçŸ¥"></a>ï¼ˆå››ï¼‰ã€å®è·µå‡ºçœŸçŸ¥</h3><p>æ‰€è°“å®è·µå‡ºçœŸçŸ¥ï¼Œä¹Ÿå°±æ˜¯å­¦ä»¥è‡´ç”¨ï¼Œä¸ç„¶åªæ˜¯çº¸ä¸Šè°ˆå…µï¼Œè¯¯å›½è¯¯æ°‘ã€‚åªæœ‰å®è·µè¿‡ï¼Œä½ æ‰èƒ½å¯¹å­¦åˆ°çš„ä¸œè¥¿æœ‰æ›´æ·±çš„ä½“ä¼šã€‚</p><p>å¤šå†™å¤šç”¨ã€‚</p><h3 id="ï¼ˆäº”ï¼‰ã€åšæŒä¸æ‡ˆ"><a href="#ï¼ˆäº”ï¼‰ã€åšæŒä¸æ‡ˆ" class="headerlink" title="ï¼ˆäº”ï¼‰ã€åšæŒä¸æ‡ˆ"></a>ï¼ˆäº”ï¼‰ã€åšæŒä¸æ‡ˆ</h3><p>ä¸€æ–¹é¢ä½ è¦æŠŠä½ çš„åšæŒå½¢æˆæˆæœæ™’å‡ºæ¥ï¼Œè®©åˆ«äººæ¥ç»™ä½ ç‚¹èµï¼Œå¦ä¸€æ–¹é¢ï¼Œä½ è¿˜è¦æŠŠåšæŒå˜æˆä¸€ç§ä¹ æƒ¯ï¼Œå°±åƒåƒé¥­å–æ°´ä¸€æ ·ï¼Œä½ æ„Ÿè§‰ä¸åˆ°å¤ªå¤šçš„æˆæœ¬ä»˜å‡ºã€‚åªæœ‰åšåˆ°è¿™ä¸¤ç‚¹ï¼Œä½ æ‰èƒ½å¤ŸçœŸæ­£åšæŒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èŒä¸šè§„åˆ’ </tag>
            
            <tag> æå®¢æ—¶é—´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠCè¯­è¨€ç¨‹åºè®¾è®¡ï¼šç°ä»£æ–¹æ³•(ç¬¬2ç‰ˆ)ã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="c-yu-yan-cheng-xu-she-ji-xian-dai-fang-fa-di-2-ban-du-shu-bi-ji/"/>
      <url>c-yu-yan-cheng-xu-she-ji-xian-dai-fang-fa-di-2-ban-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<p>ä¸»è¦æ˜¯å¤‡å¿˜C99æ ‡å‡†ä¸­çš„ä¸€äº›å˜åŒ–ã€‚</p><h2 id="å…è®¸ä»£ç æ®µä¸å£°æ˜æ··åˆ"><a href="#å…è®¸ä»£ç æ®µä¸å£°æ˜æ··åˆ" class="headerlink" title="å…è®¸ä»£ç æ®µä¸å£°æ˜æ··åˆ"></a>å…è®¸ä»£ç æ®µä¸å£°æ˜æ··åˆ</h2><p>å…è®¸åœ¨ç¨‹åºå—ä¸­ä»»ä½•åœ°æ–¹å£°æ˜å˜é‡ï¼Œåªè¦åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å˜é‡ä¹‹å‰å£°æ˜å°±å¯ä»¥ã€‚</p><h2 id="æ”¯æŒ-é£æ ¼æ³¨é‡Š"><a href="#æ”¯æŒ-é£æ ¼æ³¨é‡Š" class="headerlink" title="æ”¯æŒ//é£æ ¼æ³¨é‡Š"></a>æ”¯æŒ//é£æ ¼æ³¨é‡Š</h2><h2 id="å˜é‡ä¸å†éšå¼å£°æ˜ä¸ºintç±»å‹"><a href="#å˜é‡ä¸å†éšå¼å£°æ˜ä¸ºintç±»å‹" class="headerlink" title="å˜é‡ä¸å†éšå¼å£°æ˜ä¸ºintç±»å‹"></a>å˜é‡ä¸å†éšå¼å£°æ˜ä¸ºintç±»å‹</h2><h2 id="ä¸æ”¯æŒéšå¼å£°æ˜å‡½æ•°"><a href="#ä¸æ”¯æŒéšå¼å£°æ˜å‡½æ•°" class="headerlink" title="ä¸æ”¯æŒéšå¼å£°æ˜å‡½æ•°"></a>ä¸æ”¯æŒéšå¼å£°æ˜å‡½æ•°</h2><h2 id="æ›´å‡†ç¡®çš„æ•´å‹é™¤æ³•"><a href="#æ›´å‡†ç¡®çš„æ•´å‹é™¤æ³•" class="headerlink" title="æ›´å‡†ç¡®çš„æ•´å‹é™¤æ³•"></a>æ›´å‡†ç¡®çš„æ•´å‹é™¤æ³•</h2><p>C89ä¸­i/jçš„ä¸¤ä¸ªæ•´æ•°æ“ä½œæ•°ä¸­æœ‰è´Ÿæ•°æ—¶ï¼Œé™¤æ³•çš„ç»“æœæ—¢å¯ä»¥å‘ä¸Šå–æ•´ï¼Œä¹Ÿå¯ä»¥å‘ä¸‹å–æ•´ï¼Œåœ¨C99ä¸­æ€»æ˜¯å‘0å–æ•´ã€‚C89ä¸­å¦‚æœiæˆ–jä¸ºè´Ÿæ•°ï¼Œi%jç»“æœä¸å®ç°æœ‰å…³ï¼Œåœ¨c99ä¸­ç»“æœç¬¦å·æ€»ä¸içš„ç¬¦å·ç›¸åŒã€‚</p><h2 id="å¸ƒå°”ç±»å‹"><a href="#å¸ƒå°”ç±»å‹" class="headerlink" title="å¸ƒå°”ç±»å‹"></a>å¸ƒå°”ç±»å‹</h2><p>æ–°çš„å¸ƒå°”ç±»å‹<code>_Bool</code>ï¼Œæœ¬è´¨æ˜¯æ— ç¬¦å·çš„æ•´å‹ã€‚<code>_Bool</code>ç±»å‹çš„å˜é‡åªèƒ½å­˜å‚¨0æˆ–1ï¼Œæ‰€ä»¥ï¼Œå°†é0çš„å€¼èµ‹å€¼ç»™<code>_Bool</code>ç±»å‹çš„å˜é‡éƒ½ä¼šå¯¼è‡´å˜é‡çš„å€¼å˜ä¸º1ã€‚åŒæ—¶è¿˜æä¾›äº†æ–°çš„å¤´æ–‡ä»¶<stdbool.h>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</stdbool.h></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">__bool_true_false_are_defined   <span class="token number">1</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">bool    <span class="token keyword">_Bool</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">false   <span class="token number">0</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">true    <span class="token number">1</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="forè¯­å¥çš„å˜åŒ–"><a href="#forè¯­å¥çš„å˜åŒ–" class="headerlink" title="forè¯­å¥çš„å˜åŒ–"></a>forè¯­å¥çš„å˜åŒ–</h2><p>åœ¨C99ä¸­ï¼Œforè¯­è¨€çš„ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼å¯ä»¥æ›¿æ¢ä¸ºä¸€ä¸ªå£°æ˜ï¼Œä¸‹é¢çš„ä»£ç ä¹Ÿæ˜¯åˆæ³•çš„äº†ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="64ä½æ•´æ•°å’Œæ‰©å±•æ•´æ•°ç±»å‹çš„æ”¯æŒ"><a href="#64ä½æ•´æ•°å’Œæ‰©å±•æ•´æ•°ç±»å‹çš„æ”¯æŒ" class="headerlink" title="64ä½æ•´æ•°å’Œæ‰©å±•æ•´æ•°ç±»å‹çš„æ”¯æŒ"></a>64ä½æ•´æ•°å’Œæ‰©å±•æ•´æ•°ç±»å‹çš„æ”¯æŒ</h2><p>C99æä¾›äº†ä¸¤ä¸ªé¢å¤–çš„æ ‡å‡†æ•´æ•°ç±»å‹ï¼š<code>long long int</code>å’Œ<code>unsigned long long int</code>ï¼Œå¤§å°è‡³å°‘64ä½å®½ã€‚åŒæ—¶ï¼Œä»¥<code>LL</code>æˆ–<code>ll</code>ï¼ˆæ‰€æœ‰å­—æ¯çš„å¤§å°å†™è¦ä¸€è‡´ï¼‰ç»“å°¾çš„æ•´æ•°å¸¸é‡æ˜¯<code>long long int</code>ç±»å‹çš„ï¼Œä»¥<code>ULL</code>æˆ–<code>ull</code>ï¼ˆæ‰€æœ‰å­—æ¯çš„å¤§å°å†™è¦ä¸€è‡´ï¼‰ç»“å°¾çš„æ•´æ•°å¸¸é‡æ˜¯<code>unsigned long long int</code>ç±»å‹çš„ã€‚</p><p>é™¤äº†æ ‡å‡†çš„æ•´æ•°ç±»å‹å¤–ï¼ŒC99æ ‡å‡†è¿˜å…è®¸åœ¨å…·ä½“å®ç°æ—¶å®šä¹‰<code>æ‰©å±•çš„æ•°ç±»æ•´æ•°</code>ï¼ˆåŒ…æ‹¬æœ‰ç¬¦å·çš„å’Œæ— ç¬¦å·çš„ï¼‰ã€‚æ¯”å¦‚ï¼š128ä½çš„æ•´æ•°ç±»å‹ã€‚</p><h2 id="éšå¼è½¬æ¢çš„å˜åŒ–"><a href="#éšå¼è½¬æ¢çš„å˜åŒ–" class="headerlink" title="éšå¼è½¬æ¢çš„å˜åŒ–"></a>éšå¼è½¬æ¢çš„å˜åŒ–</h2><p>å› ä¸ºC99ä¸­å¢åŠ äº†ä¸€äº›ç±»å‹ï¼ˆ_Boolã€long longç±»å‹ã€æ‰©å±•çš„æ•´æ•°ç±»å‹å’Œå¤æ•°ç±»å‹ï¼‰ã€‚æ–°çš„éšå¼è½¬æ¢è§„åˆ™ç•¥æœ‰å˜åŒ–ï¼ˆè¿™é‡Œå¿½ç•¥äº†æ‰©å±•æ•´æ•°ç±»å‹å’Œæšä¸¾ç±»å‹ï¼‰ï¼š</p><ol><li>long long intã€unsigned long long int</li><li>long intã€unsigned long int</li><li>intã€unsigned int</li><li>short intã€unsigned short int</li><li>charã€signed charã€unsigned charï¼ˆè¿™é‡Œè¦æ³¨æ„charç±»å‹å’Œsigned charç±»å‹æ˜¯ä¸åŒçš„ç±»å‹ï¼‰</li><li>_Bool</li></ol><p>C99ç”¨æ•´æ•°æå‡ï¼ˆinteger promotionï¼‰å–ä»£äº†C89ä¸­çš„æ•´å€¼æå‡ï¼ˆintegral promotionï¼‰ï¼Œå¯ä»¥å°†ä»»ä½•ç­‰çº§ä½äºintå’Œunsigned intçš„ç±»å‹è½¬æ¢ä¸ºintï¼ˆåªè¦è¯¥ç±»å‹çš„æ‰€æœ‰å€¼éƒ½å¯ä»¥ç”¨intç±»å‹è¡¨ç¤ºï¼‰æˆ–unsigned intã€‚</p><p>å’ŒC89ä¸€æ ·ç±»ä¼¼ï¼ŒC99ä¸­æ‰§è¡Œå¸¸ç”¨çš„ç®—æœ¯è½¬æ¢çš„è§„åˆ™å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li><p><code>ä»»ä¸€æ“ä½œæ•°çš„ç±»å‹æ˜¯æµ®ç‚¹æ•°ç±»å‹çš„æƒ…å†µã€‚</code>åªè¦ä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸æ˜¯å¤æ•°å‹ï¼Œè§„åˆ™å¦‚ä¸‹(ä¸‹é¢çš„å†…å®¹æ‘˜å½•è‡ª<a href="https://book.douban.com/subject/1139336/">Cç¨‹åºè®¾è®¡è¯­è¨€(ç¬¬2ç‰ˆ_æ–°ç‰ˆ)</a>)ï¼š</p><ol><li>å¦‚æœä»»ä½•ä¸€ä¸ªæ“ä½œæ•°ä¸ºlong doubleç±»å‹ï¼Œå°†å¦ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºlong doubleç±»å‹ï¼Œè¿‡ç¨‹ç»“æŸã€‚</li><li>å¦‚æœä»»ä½•ä¸€ä¸ªæ“ä½œæ•°ä¸ºdoubleç±»å‹ï¼Œå°†å¦ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºdoubleç±»å‹ï¼Œè¿‡ç¨‹ç»“æŸã€‚</li><li>å¦‚æœä»»ä½•ä¸€ä¸ªæ“ä½œæ•°ä¸ºfloatç±»å‹ï¼Œå°†å¦ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºfloatç±»å‹ï¼Œè¿‡ç¨‹ç»“æŸã€‚</li></ol></li><li><p><code>ä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹éƒ½ä¸æ˜¯æµ®ç‚¹ç±»å‹çš„æƒ…å†µã€‚</code>é¦–å…ˆå¯¹ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡Œæ•´æ•°æå‡ã€‚å¦‚æœè¿™æ—¶ä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒï¼Œè¿‡ç¨‹ç»“æŸã€‚å¦åˆ™ï¼Œä¾æ¬¡å°è¯•ä¸‹é¢çš„è§„åˆ™ï¼Œä¸€æ—¦é‡åˆ°å¯åº”ç”¨çš„è§„åˆ™å°±ä¸å†è€ƒè™‘åˆ«çš„è§„åˆ™ï¼š</p><ol><li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯æœ‰ç¬¦å·å‹æˆ–éƒ½æ˜¯æ— ç¬¦å·å‹ï¼Œå°†æ•´æ•°è½¬æ¢ç­‰çº§ä½çš„æ“ä½œæ•°è½¬æ¢ä¸ºç­‰çº§è¾ƒé«˜çš„æ“ä½œæ•°çš„ç±»å‹ã€‚</li><li>å¦‚æœæ— ç¬¦å·æ“ä½œæ•°çš„ç­‰çº§<code>é«˜äºæˆ–ç­‰äº</code>æœ‰ç¬¦å·æ“ä½œæ•°çš„ç­‰çº§ï¼Œå°†æœ‰ç¬¦å·æ“ä½œæ•°è½¬æ¢ä¸ºæ— ç¬¦å·æ“ä½œæ•°çš„ç±»å‹ã€‚</li><li>å¦‚æœæœ‰ç¬¦å·æ“ä½œæ•°ç±»å‹å¯ä»¥è¡¨ç¤ºæ— ç¬¦å·æ“ä½œæ•°ç±»å‹çš„æ‰€æœ‰å€¼ï¼Œå°†æ— ç¬¦å·æ“ä½œæ•°è½¬æ¢ä¸ºæœ‰ç¬¦å·æ“ä½œæ•°çš„ç±»å‹ã€‚</li><li>å¦åˆ™ï¼Œå°†ä¸¤ä¸ªæ“ä½œæ•°éƒ½è½¬æ¢ä¸ºä¸æœ‰ç¬¦å·æ“ä½œæ•°çš„ç±»å‹ç›¸å¯¹åº”çš„æ— ç¬¦å·ç±»å‹ã€‚</li></ol></li></ul><p>å¦å¤–ï¼Œæ‰€æœ‰ç®—æœ¯ç±»å‹éƒ½å¯ä»¥è½¬æ¢ä¸º_Boolç±»å‹ã€‚å¦‚æœåŸå§‹å€¼ä¸º0åˆ™è½¬æ¢ç»“æœä¸º0ï¼Œå¦åˆ™ç»“æœä¸º1ã€‚</p><h2 id="æ•°ç»„åˆå§‹åŒ–"><a href="#æ•°ç»„åˆå§‹åŒ–" class="headerlink" title="æ•°ç»„åˆå§‹åŒ–"></a>æ•°ç»„åˆå§‹åŒ–</h2><blockquote><p>è¿™æ¡C99ä¸­æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯Cå’ŒC++ç•¥æœ‰ä¸åŒã€‚</p></blockquote><p>å¦‚æœæ•°ç»„çš„åˆå§‹åŒ–å¼æ¯”æ•°ç»„çŸ­ï¼Œé‚£ä¹ˆæ•°ç»„ä¸­å‰©ä½™çš„å…ƒç´ èµ‹å€¼ä¸º0ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/* initial value of a is {1, 2, 0} */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>ä½†æ˜¯åœ¨Cä¸­åˆå§‹åŒ–å¼å®Œå…¨ä¸ºç©ºæ˜¯éæ³•çš„ï¼Œå¦‚æœæƒ³è¦æŠŠæ•°ç»„å…¨éƒ¨åˆå§‹åŒ–ä¸º0ï¼Œå¿…é¡»è¦åœ¨å¤§æ‹¬å·ä¸­æ”¾ä¸€ä¸ª0ã€‚è¿™ç‚¹è¦æ±‚åœ¨C++ä¸­æ˜¯æ²¡æœ‰çš„ã€‚</code></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// initial value of a to {0, 0, 0}</span><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// invalid in c but valid in c++</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="æ•°ç»„æŒ‡å®šåˆå§‹åŒ–å¼"><a href="#æ•°ç»„æŒ‡å®šåˆå§‹åŒ–å¼" class="headerlink" title="æ•°ç»„æŒ‡å®šåˆå§‹åŒ–å¼"></a>æ•°ç»„æŒ‡å®šåˆå§‹åŒ–å¼</h2><p>C99ä¸­ï¼Œæä¾›äº†æŒ‡å®šä¸‹æ ‡çš„æ–¹å¼æ¥åˆå§‹åŒ–æ•°ç»„ä¸­æŒ‡å®šä½ç½®çš„å€¼ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">/* a is {0, 1, 0, 3, 0} */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒæ—¶ï¼Œåˆå§‹åŒ–å¼ä¸­è€æ–¹æ³•ï¼ˆé€ä¸ªå…ƒç´ åˆå§‹åŒ–ï¼‰å’Œæ–°æ–¹æ³•ï¼ˆæŒ‡å®šåˆå§‹åŒ–å¼ï¼‰å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">/* b is {1, 0, 2} */</span><span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">/* b us {0, 0, 2, 1}*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å˜é•¿æ•°ç»„"><a href="#å˜é•¿æ•°ç»„" class="headerlink" title="å˜é•¿æ•°ç»„"></a>å˜é•¿æ•°ç»„</h2><p>ä¸‹é¢çš„ä»£ç åœ¨C99æ ‡å‡†ä¸‹æ˜¯åˆæ³•çš„ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> a<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* C99 only*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å˜é•¿æ•°ç»„çš„é•¿åº¦æ˜¯åœ¨ç¨‹åºæ‰§è¡Œæ—¶è®¡ç®—çš„ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶è®¡ç®—çš„ã€‚å˜é•¿æ•°ç»„çš„ä¸»è¦é™åˆ¶æ˜¯å®ƒä»¬æ²¡æœ‰é™æ€å­˜å‚¨æ—¶é™ï¼ˆå› ä¸ºå®ƒæ˜¯æ”¾åœ¨æ ˆä¸Šé¢çš„ï¼‰ï¼Œå¦ä¸€ä¸ªé™åˆ¶æ˜¯å˜é•¿æ•°ç»„æ²¡æœ‰åˆå§‹åŒ–å¼ã€‚</p><h2 id="å˜é•¿æ•°ç»„å½¢å¼å‚æ•°"><a href="#å˜é•¿æ•°ç»„å½¢å¼å‚æ•°" class="headerlink" title="å˜é•¿æ•°ç»„å½¢å¼å‚æ•°"></a>å˜é•¿æ•°ç»„å½¢å¼å‚æ•°</h2><p>ä¸‹é¢çš„ä»£ç åœ¨C99æ ‡å‡†ä¸‹æ˜¯åˆæ³•çš„ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum_2d_array</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> arr<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„ï¼šå‚æ•°çš„é¡ºåºå¾ˆé‡è¦ã€‚<code>int m</code>å’Œ<code>int n</code>å¿…é¡»è¦åœ¨<code>int arr[m][n]</code>çš„å·¦è¾¹ã€‚</p></blockquote><p>åœ¨å£°æ˜åŒ…å«æœ‰å˜é•¿æ•°ç»„å½¢å¼çš„å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>*</code>ï¼Œæ¯”å¦‚ä¸Šé¢çš„å‡½æ•°å¯ä»¥å£°æ˜ä¸ºï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum_2d_array</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> arr<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">sum_2d_array</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">sum_2d_array</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">sum_2d_array</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>å˜é•¿æ•°ç»„å‚æ•°å¯¹ç¼–è¯‘å™¨æ¥è¯´ï¼Œåªæ˜¯æç¤ºæ€§çš„ï¼Œç¼–è¯‘å™¨å¹¶ä¸è¿›è¡Œé¢å¤–çš„é”™è¯¯æ£€æµ‹ï¼Œåªæ˜¯æ–¹ä¾¿ç¼–è¯‘ä¼˜åŒ–ç­‰ã€‚æ‰€ä»¥å®é™…ä¸Šå˜é•¿æ•°ç»„çš„å¤§å°å’Œå˜é•¿æ•°ç»„çš„å‚æ•°å¯èƒ½æ˜¯æ— å…³çš„ã€‚</code></p><h2 id="åœ¨æ•°ç»„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨static"><a href="#åœ¨æ•°ç»„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨static" class="headerlink" title="åœ¨æ•°ç»„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨static"></a>åœ¨æ•°ç»„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨static</h2><p>C99å…è®¸åœ¨æ•°ç»„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨å…³é”®å­—staticã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå°†staticæ”¾åœ¨æ•°å­—3ä¹‹å‰è¡¨ç¤ºæ•°ç»„açš„é•¿åº¦è‡³å°‘å¯ä»¥ä¿è¯ä¸º3ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum_array</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token keyword">static</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·ä½¿ç”¨staticå¯¹ç¨‹åºçš„è¡Œä¸ºä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚staticçš„å­˜åœ¨åªæ˜¯æç¤ºç¼–è¯‘å™¨ï¼Œæ–¹ä¾¿ç¼–è¯‘å™¨æ ¹æ®æ­¤æç¤ºä¼˜åŒ–æŒ‡ä»¤ã€‚</p><p>æœ€åï¼Œå¦‚æœæ•°ç»„å‚æ•°æ˜¯å¤šç»´çš„ï¼Œstaticä»…å¯ç”¨äºç¬¬ä¸€ç»´ï¼ˆæ¯”å¦‚ï¼ŒæŒ‡å®šäºŒç»´æ•°ç»„çš„è¡Œæ•°ï¼‰ã€‚</p><h2 id="æ•°ç»„å¤åˆå­—é¢é‡"><a href="#æ•°ç»„å¤åˆå­—é¢é‡" class="headerlink" title="æ•°ç»„å¤åˆå­—é¢é‡"></a>æ•°ç»„å¤åˆå­—é¢é‡</h2><p>ä»£ç ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>total <span class="token operator">=</span> <span class="token function">sum_array</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨C99ä¸­ï¼Œå¯ä»¥ç®€åŒ–ä¸ºï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">total <span class="token operator">=</span> <span class="token function">sum_array</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­ï¼Œ<code>(int []){3, 0, 3, 4, 1}</code>å°±æ˜¯<code>å¤åˆå­—é¢é‡</code>ã€‚</p><p>å¤åˆå­—é¢é‡æ˜¯é€šè¿‡æŒ‡å®šå…¶åŒ…å«çš„å…ƒç´ è€Œåˆ›å»ºçš„æ²¡æœ‰åå­—çš„æ•°ç»„ã€‚å…¶æ ¼å¼ä¸ºï¼šå…ˆåœ¨ä¸€å¯¹åœ†æ‹¬å·å†…ç»™å®šç±»å‹åï¼Œéšååœ¨ä¸€å¯¹èŠ±æ‹¬å·å†…è®¾å®šæ‰€åŒ…æ‹¬å…ƒç´ çš„å€¼ã€‚</p><p>å¤åˆå­—é¢é‡ç±»ä¼¼äºåº”ç”¨äºæ•°ç»„åˆå§‹åŒ–å¼çš„å¼ºåˆ¶è½¬æ¢ã€‚äº‹å®ä¸Šï¼Œå¤åˆå­—é¢é‡å’Œæ•°ç»„åˆå§‹åŒ–å¼éµå®ˆåŒæ ·çš„è§„åˆ™ã€‚å¤åˆå­—é¢é‡å¯ä»¥åŒ…å«æŒ‡ç¤ºç¬¦ï¼Œå°±åƒæŒ‡å®šåˆå§‹åŒ–å¼ä¸€æ ·ï¼›å¯ä»¥ä¸æä¾›æ•°ç»„å®Œå…¨çš„åˆå§‹åŒ–ï¼ˆæœªåˆå§‹åŒ–çš„å…ƒç´ é»˜è®¤è¢«åˆå§‹åŒ–ä¸º0ï¼‰ã€‚ä¾‹å¦‚ï¼šå¤åˆå­—é¢é‡<code>(int[10]){8,6}</code>æœ‰10ä¸ªå…ƒç´ ï¼Œå‰é¢ä¸¤ä¸ªå…ƒç´ çš„å€¼ä¸º8å’Œ6ï¼Œå‰©ä¸‹çš„å…ƒç´ å€¼ä¸º0ã€‚</p><p>å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å¤åˆå­—é¢é‡å¯ä»¥åŒ…å«ä»»æ„è¡¨è¾¾å¼ï¼Œä¸é™äºå¸¸é‡ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">total <span class="token operator">=</span> <span class="token function">sum_array</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">,</span> i<span class="token operator">+</span>j<span class="token punctuation">,</span> j<span class="token operator">*</span>k<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­iã€jã€kéƒ½æ˜¯å˜é‡ã€‚</p><p>å¤åˆå­—é¢é‡ä¸ºå·¦å€¼ï¼Œæ‰€ä»¥å…¶å…ƒç´ çš„å€¼å¯ä»¥æ”¹å˜ã€‚å¦‚æœè¦æ±‚å…¶å€¼ä¸ºâ€œåªè¯»â€ï¼Œå¯ä»¥åœ¨ç±»å‹å‰é¢åŠ ä¸Š<code>const</code>ï¼Œå¦‚<code>(const int[]){5,4}</code>ã€‚</p><h2 id="æŒ‡å‘å¸¸é‡æ•°ç»„å¤åˆå­—é¢é‡çš„æŒ‡é’ˆ"><a href="#æŒ‡å‘å¸¸é‡æ•°ç»„å¤åˆå­—é¢é‡çš„æŒ‡é’ˆ" class="headerlink" title="æŒ‡å‘å¸¸é‡æ•°ç»„å¤åˆå­—é¢é‡çš„æŒ‡é’ˆ"></a>æŒ‡å‘å¸¸é‡æ•°ç»„å¤åˆå­—é¢é‡çš„æŒ‡é’ˆ</h2><p>æŒ‡é’ˆæŒ‡å‘å¤åˆå­—é¢é‡åˆ›å»ºçš„æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ æ˜¯åˆæ³•çš„ã€‚ä¸‹é¢ä¸¤æ®µä»£ç éƒ½æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸”æ„ä¹‰ç›¸åŒã€‚</p><p>ä»£ç ä¸€ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä»£ç äºŒï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="C99ä¸­çš„æŒ‡é’ˆå’Œå˜é•¿æ•°ç»„"><a href="#C99ä¸­çš„æŒ‡é’ˆå’Œå˜é•¿æ•°ç»„" class="headerlink" title="C99ä¸­çš„æŒ‡é’ˆå’Œå˜é•¿æ•°ç»„"></a>C99ä¸­çš„æŒ‡é’ˆå’Œå˜é•¿æ•°ç»„</h2><p>æŒ‡é’ˆå¯ä»¥æŒ‡å‘å˜é•¿æ•°ç»„ä¸­çš„å…ƒç´ ã€‚å¦‚æœå˜é•¿æ•°ç»„æ˜¯å¤šç»´çš„ï¼ŒæŒ‡é’ˆçš„ç±»å‹å–å†³äºé™¤ç¬¬ä¸€ç»´å¤–æ¯ä¸€ç»´çš„é•¿åº¦ã€‚ä¸‹é¢æ˜¯äºŒç»´çš„æƒ…å†µï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>    p <span class="token operator">=</span> a<span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºpçš„ç±»å‹ä¾èµ–äºnï¼Œè€Œnä¸æ˜¯å¸¸é‡ï¼Œæ‰€ä»¥è¯´på…·æœ‰å¯æ”¹å˜ç±»å‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¼–è¯‘å™¨å¹¶éæ€»èƒ½ç¡®å®š<code>p = a</code>è¿™æ ·çš„èµ‹å€¼è¯­å¥çš„åˆæ³•æ€§ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œä½†åªæœ‰å½“<code>m = n</code>æ˜¯æ‰æ­£ç¡®ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> a<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">;</span>p <span class="token operator">=</span> a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœ<code>m != n</code>ï¼Œåç»­å¯¹pçš„ä½¿ç”¨éƒ½å°†å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚</p><p>ä¸å˜é•¿æ•°ç»„ä¸€æ ·ï¼Œå¯æ”¹å˜ç±»å‹ä¹Ÿå…·æœ‰ç‰¹å®šçš„é™åˆ¶ï¼Œå…¶ä¸­æœ€é‡è¦çš„é™åˆ¶æ˜¯ï¼Œå¯æ”¹å˜ç±»å‹çš„å£°æ˜å¿…é¡»å‡ºç°åœ¨å‡½æ•°ä½“å†…éƒ¨æˆ–è€…åœ¨å‡½æ•°åŸå‹ä¸­ã€‚</p><h2 id="C99ä¸­æ–°å¢çš„é¢„å®šä¹‰å®"><a href="#C99ä¸­æ–°å¢çš„é¢„å®šä¹‰å®" class="headerlink" title="C99ä¸­æ–°å¢çš„é¢„å®šä¹‰å®"></a>C99ä¸­æ–°å¢çš„é¢„å®šä¹‰å®</h2><div class="table-container"><table><thead><tr><th style="text-align:center">åå­—</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center"><code>__STDC_HOSTED__</code></td><td style="text-align:center">å¦‚æœæ˜¯æ‰˜ç®¡å¼å®ç°ï¼Œå€¼ä¸º1ï¼›å¦‚æœæ˜¯ç‹¬ç«‹å¼å®ç°ï¼Œå€¼ä¸º0</td></tr><tr><td style="text-align:center"><code>__STDC_VERSION__</code></td><td style="text-align:center">æ”¯æŒçš„Cæ ‡å‡†ç‰ˆæœ¬</td></tr><tr><td style="text-align:center"><code>__STDC_IEC_559__</code></td><td style="text-align:center">å¦‚æœæ”¯æŒIEC 60559æµ®ç‚¹ç®—æœ¯è¿ç®—ï¼Œåˆ™å®šä¹‰è¯¥å®ï¼Œä¸”å€¼ä¸º1</td></tr><tr><td style="text-align:center"><code>__STDC_IEC_559_COMPLEX</code></td><td style="text-align:center">å¦‚æœæ”¯æŒIEC 60559å¤æ•°ç®—æœ¯è¿ç®—ï¼Œåˆ™å®šä¹‰è¯¥å®ï¼Œä¸”å€¼ä¸º1</td></tr><tr><td style="text-align:center"><code>__STDC_ISO_10646__</code></td><td style="text-align:center">å¦‚æœwchar_tç±»å‹çš„å€¼ç”±ISO/IEC 10646æ ‡å‡†ä¸­çš„ç å€¼è¡¨ç¤ºï¼Œåˆ™å®šä¹‰è¯¥å®ï¼Œä¸”å€¼çš„æ ¼å¼æ˜¯yyyymmLï¼ˆè¡¨ç¤ºä¿®è®¢çš„å¹´æœˆï¼‰</td></tr></tbody></table></div><h2 id="ç©ºçš„å®å‚æ•°"><a href="#ç©ºçš„å®å‚æ•°" class="headerlink" title="ç©ºçš„å®å‚æ•°"></a>ç©ºçš„å®å‚æ•°</h2><p>C99å…è®¸å®è°ƒç”¨ä¸­çš„ä»»æ„æˆ–æ‰€æœ‰å‚æ•°ä¸ºç©ºã€‚ä½†æ˜¯è¿™æ ·çš„è°ƒç”¨éœ€è¦æœ‰å’Œä¸€èˆ¬è°ƒç”¨ä¸€æ ·å¤šçš„é€—å·ï¼ˆæ–¹ä¾¿çœ‹å‡ºå“ªäº›å‚æ•°è¢«çœç•¥äº†ï¼‰ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®é™…å‚æ•°ä¸ºç©ºçš„æ•ˆæœæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ADD</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span></span></span>i <span class="token operator">=</span> <span class="token function">ADD</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>i <span class="token operator">=</span> <span class="token function">ADD</span><span class="token punctuation">(</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç»è¿‡é¢„å¤„ç†åå˜æˆï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">i <span class="token operator">=</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å½“ç©ºå‚æ•°æ˜¯#æˆ–##è¿ç®—ç¬¦çš„æ“ä½œæ•°æ—¶ï¼Œç”¨æ³•æœ‰ç‰¹æ®Šè§„å®šã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">MK_STR</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> #x</span></span><span class="token keyword">char</span> empty_string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">MK_STR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">JOIN</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">)</span> x</span><span class="token punctuation">##</span><span class="token expression">y</span><span class="token punctuation">##</span><span class="token expression">z</span></span><span class="token keyword">int</span> <span class="token function">JOIN</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">JOIN</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">JOIN</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">JOIN</span><span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»è¿‡é¢„å¤„ç†åå˜æˆï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> empty_string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token keyword">int</span> abc<span class="token punctuation">,</span> ab<span class="token punctuation">,</span> ac<span class="token punctuation">,</span> c<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å‚æ•°ä¸ªæ•°å¯å˜çš„å®"><a href="#å‚æ•°ä¸ªæ•°å¯å˜çš„å®" class="headerlink" title="å‚æ•°ä¸ªæ•°å¯å˜çš„å®"></a>å‚æ•°ä¸ªæ•°å¯å˜çš„å®</h2><p>åœ¨C89ä¸­ï¼Œå¦‚æœå®æœ‰å‚æ•°ï¼Œé‚£ä¹ˆå‚æ•°çš„ä¸ªæ•°æ˜¯å›ºå®šçš„ã€‚åœ¨C99ä¸­ï¼Œè¿™ä¸ªæ¡ä»¶è¢«é€‚å½“æ”¾å®½äº†ï¼Œå…è®¸å®å…·æœ‰å¯å˜é•¿åº¦çš„å‚æ•°åˆ—è¡¨ã€‚</p><p>å®å…·æœ‰å¯å˜å‚æ•°ä¸ªæ•°çš„ä¸»è¦åŸå› æ˜¯ï¼šå®ƒå¯ä»¥å°†å‚æ•°ä¼ é€’ç»™å…·æœ‰å¯å˜å‚æ•°ä¸ªæ•°çš„å‡½æ•°ã€‚æ¯”å¦‚ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">TEST</span><span class="token punctuation">(</span>cond<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cond<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">"pass test: %s\n"</span><span class="token expression"><span class="token punctuation">,</span> #cond<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">printf</span><span class="token punctuation">(</span>__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>...</code>è®°å·ï¼ˆçœç•¥å·ï¼‰å‡ºç°åœ¨å®å‚æ•°åˆ—è¡¨çš„æœ€åï¼Œå‰é¢æ˜¯æ™®é€šå‚æ•°ã€‚<code>__VA_ARGS__</code>æ˜¯ä¸€ä¸ªä¸“ç”¨çš„æ ‡è¯†ç¬¦ï¼Œåªèƒ½å‡ºç°åœ¨å…·æœ‰å¯å˜å‚æ•°ä¸ªæ•°çš„å®çš„æ›¿æ¢åˆ—è¡¨ä¸­ï¼Œä»£è¡¨æ‰€æœ‰ä¸çœç•¥å·ç›¸å¯¹åº”çš„å‚æ•°ã€‚ï¼ˆè‡³å°‘æœ‰ä¸€ä¸ªä¸çœç•¥å·ç›¸å¯¹åº”çš„å‚æ•°ï¼Œä½†è¯¥å‚æ•°å¯ä»¥ä¸ºç©ºã€‚ï¼‰</p><h2 id="funcæ ‡è¯†ç¬¦"><a href="#funcæ ‡è¯†ç¬¦" class="headerlink" title="funcæ ‡è¯†ç¬¦"></a><strong>func</strong>æ ‡è¯†ç¬¦</h2><p>æ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥è®¿é—®<code>__func__</code>æ ‡è¯†ç¬¦ï¼Œå®ƒçš„è¡Œä¸ºå¾ˆåƒä¸€ä¸ªå­˜å‚¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„åå­—çš„å­—ç¬¦ä¸²å˜é‡ã€‚ä½œç”¨ç›¸å½“äºåœ¨å‡½æ•°ä½“çš„ä¸€å¼€å§‹åŒ…å«äº†å¦‚ä¸‹å£°æ˜ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token constant">__func__</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"function-name"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>__func__</code>çš„å¦ä¸€ä¸ªç”¨æ³•ï¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œè®©å‡½æ•°çŸ¥é“è°ƒç”¨å®ƒçš„å‡½æ•°çš„åå­—ã€‚</p><h2 id="Pragmaè¿ç®—ç¬¦"><a href="#Pragmaè¿ç®—ç¬¦" class="headerlink" title="_Pragmaè¿ç®—ç¬¦"></a>_Pragmaè¿ç®—ç¬¦</h2><p>C99å¼•å…¥äº†ä¸#pragmaæŒ‡ä»¤ä¸€èµ·ä½¿ç”¨çš„_Pragmaè¿ç®—ç¬¦ã€‚å…¶å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">_Pragma</span> <span class="token punctuation">(</span>å­—ç¬¦ä¸²å­—é¢é‡<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‡åˆ°è¯¥è¡¨è¾¾å¼æ—¶ï¼Œé¢„å¤„ç†å™¨é€šè¿‡ç§»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„åŒå¼•å·å¹¶åˆ†åˆ«ç”¨å­—ç¬¦<code>"</code>å’Œ<code>\</code>ä»£æ›¿è½¬ä¹‰åºåˆ—<code>\"</code>å’Œ<code>\\</code>æ¥å®ç°å¯¹å­—ç¬¦ä¸²å­—é¢é‡çš„â€œå»å­—ç¬¦ä¸²åŒ–â€ã€‚ä¸‹é¢çš„ä¸¤è¡Œä»£ç æ„ä¹‰ç›¸åŒï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">_Pragma</span><span class="token punctuation">(</span><span class="token string">"data(heap_size =&gt; 1000, stack_size =&gt; 2000)"</span><span class="token punctuation">)</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">data</span><span class="token punctuation">(</span>heap_size <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">,</span> stack_size <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2000</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ç»“æ„æŒ‡å®šåˆå§‹åŒ–å¼"><a href="#ç»“æ„æŒ‡å®šåˆå§‹åŒ–å¼" class="headerlink" title="ç»“æ„æŒ‡å®šåˆå§‹åŒ–å¼"></a>ç»“æ„æŒ‡å®šåˆå§‹åŒ–å¼</h2><p>ä¸æ•°ç»„æŒ‡å®šåˆå§‹åŒ–å¼ç±»ä¼¼ï¼Œç»“æ„ä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‡å®šåˆå§‹åŒ–å¼ã€‚ä¸‹é¢ä¸¤è¡Œåˆå§‹åŒ–ä»£ç æ„ä¹‰ç›¸åŒï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">KibaZen</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a<span class="token punctuation">;</span>    <span class="token keyword">int</span> b<span class="token punctuation">;</span>    <span class="token keyword">int</span> c<span class="token punctuation">;</span>    <span class="token keyword">int</span> d<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">kibaZen</span> k <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">KibaZen</span> z <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»“æ„å¤åˆå­—é¢é‡"><a href="#ç»“æ„å¤åˆå­—é¢é‡" class="headerlink" title="ç»“æ„å¤åˆå­—é¢é‡"></a>ç»“æ„å¤åˆå­—é¢é‡</h2><p>å’Œæ•°ç»„å¤åˆå­—é¢é‡ç±»ä¼¼ï¼Œç»“æ„ä¹Ÿæœ‰å¤åˆå­—é¢é‡ã€‚ä¸‹é¢çš„ä»£ç æ˜¯åˆæ³•çš„ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">KibaZen</span> kz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">kibaZen</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å—é™æŒ‡é’ˆ"><a href="#å—é™æŒ‡é’ˆ" class="headerlink" title="å—é™æŒ‡é’ˆ"></a>å—é™æŒ‡é’ˆ</h2><p>åœ¨C99ä¸­ï¼Œç”¨restrictå£°æ˜çš„æŒ‡é’ˆå«åšå—é™æŒ‡é’ˆï¼ˆrestricted pointerï¼‰ã€‚å®ƒå‘ç¼–è¯‘å™¨ä¿è¯ï¼Œåœ¨è¿™ä¸ªæŒ‡é’ˆçš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œä»»ä½•é€šè¿‡è¯¥æŒ‡é’ˆè®¿é—®çš„å†…å­˜ï¼Œéƒ½åªèƒ½è¢«è¿™ä¸ªæŒ‡é’ˆæ”¹å˜ã€‚ç›®çš„æ˜¯ä¸ºäº†æ˜¯ç»™ç¼–è¯‘å™¨æä¾›é¢å¤–çš„ä¿¡æ¯å¸®åŠ©ç¼–è¯‘å™¨è¿›è¡Œä»£ç ä¼˜åŒ–ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> restrict dst<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> restrict src<span class="token punctuation">,</span> size_t n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">memmove</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> dst<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> src<span class="token punctuation">,</span> size_t n<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>C99æ ‡å‡†ä¸‹ï¼Œ<code>memcpy</code>ä¸­çš„dstå’Œsrcéƒ½ä½¿ç”¨äº†restrictï¼Œè¯´æ˜å¤åˆ¶æºå’Œç›®çš„åœ°ä¸åº”äº’ç›¸é‡å ï¼ˆä½†ä¸èƒ½ç¡®ä¿ä¸é‡å ï¼‰ã€‚è€Œ<code>memmove</code>ä¸­çš„dstå’Œsrcæ²¡æœ‰ä½¿ç”¨restrictï¼Œè¯´æ˜å³ä½¿åœ¨é‡å æ—¶ä¹Ÿèƒ½æ­£å¸¸å¤åˆ¶ã€‚</p><h2 id="çµæ´»æ•°ç»„æˆå‘˜"><a href="#çµæ´»æ•°ç»„æˆå‘˜" class="headerlink" title="çµæ´»æ•°ç»„æˆå‘˜"></a>çµæ´»æ•°ç»„æˆå‘˜</h2><p>åœ¨å­˜å‚¨å­—ç¬¦ä¸²æ—¶æˆ‘ä»¬å¯èƒ½ä¼šå®šä¹‰ä¸‹é¢çš„ç»“æ„ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">vstring</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> len<span class="token punctuation">;</span>    <span class="token keyword">char</span> chars<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">vstring</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">vstring</span><span class="token punctuation">)</span> <span class="token operator">+</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>str<span class="token operator">-&gt;</span>nlen <span class="token operator">=</span> n<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä½¿ç”¨äº†ä¸€ç§â€œæ¬ºéª—â€çš„æ–¹æ³•ï¼Œåˆ†é…æ¯”è¯¥ç»“æ„å£°æ˜æ—¶åº”å…·æœ‰çš„å†…å­˜æ›´å¤šçš„å†…å­˜ï¼Œç„¶åä½¿ç”¨è¿™äº›å†…å­˜æ¥å­˜å‚¨charsæ•°ç»„é¢å¤–çš„å…ƒç´ ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºâ€œstruct hackâ€ã€‚C89æ ‡å‡†å¹¶ä¸èƒ½ä¿è¯struct hackæŠ€æœ¯å·¥ä½œï¼Œä¹Ÿä¸å…è®¸æ•°ç»„é•¿åº¦ä¸º0(GCCå…è®¸)ã€‚</p><p>C99æä¾›äº†çµæ´»æ•°ç»„æˆå‘˜ï¼ˆflexible array memberï¼‰æ¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚å½“ç»“æ„çš„æœ€åä¸€ä¸ªæˆå‘˜æ˜¯æ•°ç»„æ—¶ï¼Œå…¶é•¿åº¦å¯ä»¥çœç•¥ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">vstring</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> len<span class="token punctuation">;</span>    <span class="token keyword">char</span> chars<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">/* flexible array member - c99 only */</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">vstring</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">vstring</span><span class="token punctuation">)</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>str<span class="token operator">-&gt;</span>len <span class="token operator">=</span> n<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…·æœ‰çµæ´»æ•°ç»„æˆå‘˜çš„ç»“æ„æ˜¯ä¸å®Œæ•´ç±»å‹ï¼ˆincomplete typeï¼‰ã€‚ä¸å®Œæ•´ç±»å‹ç¼ºå°‘ç”¨äºç¡®å®šæ‰€éœ€å†…å­˜å¤§å°çš„ä¿¡æ¯ã€‚</p><h2 id="å†…è”å‡½æ•°"><a href="#å†…è”å‡½æ•°" class="headerlink" title="å†…è”å‡½æ•°"></a>å†…è”å‡½æ•°</h2><p>C99æ ‡å‡†ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­—inlineåˆ›å»ºå†…è”å‡½æ•°ã€‚</p><h2 id="æ–°çš„å¤´æ–‡ä»¶-lt-stdbool-h-gt"><a href="#æ–°çš„å¤´æ–‡ä»¶-lt-stdbool-h-gt" class="headerlink" title="æ–°çš„å¤´æ–‡ä»¶<stdbool.h>"></a>æ–°çš„å¤´æ–‡ä»¶<code>&lt;stdbool.h&gt;</code></h2><h2 id="C99å¯¹â€¦printfè½¬æ¢è¯´æ˜çš„ä¿®æ”¹"><a href="#C99å¯¹â€¦printfè½¬æ¢è¯´æ˜çš„ä¿®æ”¹" class="headerlink" title="C99å¯¹â€¦printfè½¬æ¢è¯´æ˜çš„ä¿®æ”¹"></a>C99å¯¹â€¦printfè½¬æ¢è¯´æ˜çš„ä¿®æ”¹</h2><p>C99å¯¹printfå‡½æ•°å’Œfprintfå‡½æ•°çš„è½¬æ¢è¯´æ˜åšäº†ä¸å°‘ä¿®æ”¹ã€‚</p><ul><li>å¢åŠ äº†é•¿åº¦ä¿®é¥°ç¬¦ï¼šhhã€llã€jã€zå’Œtã€‚</li><li>å¢åŠ äº†è½¬æ¢è¯´æ˜ç¬¦ï¼šFã€aå’ŒAã€‚</li><li>å…è®¸è¾“å‡ºæ— ç©·æ•°å’ŒNaNã€‚</li><li>æ”¯æŒå®½å­—ç¬¦è¾“å‡ºï¼š<code>%lc</code>å’Œ<code>%ls</code>ã€‚</li><li>C89æœªå®šä¹‰çš„è½¬æ¢è¯´æ˜C99å…è®¸äº†ã€‚%leã€%lEã€%lfã€%lgå’Œ%lGåœ¨C99æ˜¯åˆæ³•çš„ï¼ˆlé•¿åº¦ä¿®é¥°ç¬¦è¢«å¿½ç•¥ï¼‰ã€‚</li></ul><h2 id="C99å¯¹â€¦scanfè½¬æ¢è¯´æ˜çš„æ”¹å˜"><a href="#C99å¯¹â€¦scanfè½¬æ¢è¯´æ˜çš„æ”¹å˜" class="headerlink" title="C99å¯¹â€¦scanfè½¬æ¢è¯´æ˜çš„æ”¹å˜"></a>C99å¯¹â€¦scanfè½¬æ¢è¯´æ˜çš„æ”¹å˜</h2><p>C99å¯¹scanfå‡½æ•°å’Œfscanfå‡½æ•°çš„è½¬æ¢è¯´æ˜ä¹Ÿåšäº†ä¸€äº›ä¿®æ”¹ã€‚</p><ul><li>å¢åŠ äº†é•¿åº¦ä¿®é¥°ç¬¦ï¼šhhã€llã€jã€zå’Œtã€‚</li><li>å¢åŠ äº†è½¬æ¢è¯´æ˜ç¬¦ï¼šFã€aå’ŒAã€‚</li><li>å…·æœ‰è¯»æ— ç©·æ•°å’ŒNaNçš„èƒ½åŠ›ã€‚</li><li>æ”¯æŒå®½å­—ç¬¦ã€‚<code>%lc</code>è½¬æ¢è¯´æ˜ç”¨äºè¯»å‡ºå•ä¸ªçš„å¤šå­—èŠ‚å­—ç¬¦æˆ–è€…ä¸€ç³»åˆ—å¤šå­—èŠ‚å­—ç¬¦ï¼›<code>%ls</code>ç”¨äºè¯»å–ç”±å¤šå­—èŠ‚å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼ˆåœ¨ç»“å°¾æ·»åŠ ç©ºå­—ç¬¦ï¼‰ã€‚<code>%l[é›†åˆ]</code>å’Œ<code>%l[^é›†åˆ]</code>è½¬æ¢è¯´æ˜ä¹Ÿå¯ä»¥è¯»å–å¤šå­—èŠ‚å­—ç¬¦ä¸²ã€‚</li></ul><p>scanfç¤ºä¾‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">ä»£ç </th><th style="text-align:center">è¾“å…¥</th><th style="text-align:center">å˜é‡</th></tr></thead><tbody><tr><td style="text-align:center"><code>n = scanf("%i%i%i", &amp;i, &amp;j, &amp;k);</code></td><td style="text-align:center"><code>12 012 0x12</code></td><td style="text-align:center">n=3; i=12; j=10; k=18;</td></tr><tr><td style="text-align:center"><code>n = scanf("%[0123456789]", str);</code></td><td style="text-align:center"><code>123abc</code></td><td style="text-align:center">n=1; str=â€123â€;</td></tr><tr><td style="text-align:center"><code>n = scanf("%[0123456789]", str);</code></td><td style="text-align:center"><code>abc123</code></td><td style="text-align:center">n=0; strçš„å€¼ä¸å˜;</td></tr><tr><td style="text-align:center"><code>n = scanf("%[^0123456789]", str);</code></td><td style="text-align:center"><code>abc123</code></td><td style="text-align:center">n=1; str=â€abcâ€;</td></tr><tr><td style="text-align:center"><code>n = scanf("%*d%d%n", &amp;i, &amp;j);</code></td><td style="text-align:center"><code>10 20 30</code></td><td style="text-align:center">n=1; i=20; j=5;</td></tr></tbody></table></div><h2 id="åœ¨-lt-math-h-gt-ä¸­å¢åŠ è®¸å¤šç±»å‹ã€å®å’Œå‡½æ•°"><a href="#åœ¨-lt-math-h-gt-ä¸­å¢åŠ è®¸å¤šç±»å‹ã€å®å’Œå‡½æ•°" class="headerlink" title="åœ¨<math.h>ä¸­å¢åŠ è®¸å¤šç±»å‹ã€å®å’Œå‡½æ•°"></a>åœ¨<code>&lt;math.h&gt;</code>ä¸­å¢åŠ è®¸å¤šç±»å‹ã€å®å’Œå‡½æ•°</h2><h2 id="é€šç”¨å­—ç¬¦å"><a href="#é€šç”¨å­—ç¬¦å" class="headerlink" title="é€šç”¨å­—ç¬¦å"></a>é€šç”¨å­—ç¬¦å</h2><p>å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼ä¹¦å†™é€šç”¨å­—ç¬¦åï¼ˆ\uddddå’Œ\Uddddddddï¼‰ï¼Œæ¯ä¸ªdéƒ½æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°å­—ã€‚</p><p>UCSçš„ç å€¼å¯ä»¥åœ¨<a href="www.unicode.org/charts/">www.unicode.org/charts/</a>æ‰¾åˆ°ã€‚</p><h2 id="æ”¯æŒå®½å­—ç¬¦çš„-lt-wchar-h-gt-å’Œ-lt-wctype-h-gt-å‡½æ•°åº“"><a href="#æ”¯æŒå®½å­—ç¬¦çš„-lt-wchar-h-gt-å’Œ-lt-wctype-h-gt-å‡½æ•°åº“" class="headerlink" title="æ”¯æŒå®½å­—ç¬¦çš„<wchar.h>å’Œ<wctype.h>å‡½æ•°åº“"></a>æ”¯æŒå®½å­—ç¬¦çš„<code>&lt;wchar.h&gt;</code>å’Œ<code>&lt;wctype.h&gt;</code>å‡½æ•°åº“</h2><h2 id="åœ¨-lt-stdio-h-gt-å’Œ-lt-wchar-h-gt-ä¸­æ”¯æŒvscanfæ—å‡½æ•°"><a href="#åœ¨-lt-stdio-h-gt-å’Œ-lt-wchar-h-gt-ä¸­æ”¯æŒvscanfæ—å‡½æ•°" class="headerlink" title="åœ¨<stdio.h>å’Œ<wchar.h>ä¸­æ”¯æŒvscanfæ—å‡½æ•°"></a>åœ¨<code>&lt;stdio.h&gt;</code>å’Œ<code>&lt;wchar.h&gt;</code>ä¸­æ”¯æŒvscanfæ—å‡½æ•°</h2><h2 id="æ–°å¢-lt-stdint-h-gt-æ•´æ•°ç±»å‹"><a href="#æ–°å¢-lt-stdint-h-gt-æ•´æ•°ç±»å‹" class="headerlink" title="æ–°å¢<stdint.h>æ•´æ•°ç±»å‹"></a>æ–°å¢<code>&lt;stdint.h&gt;</code>æ•´æ•°ç±»å‹</h2><h2 id="æ–°å¢-lt-inttypes-h-gt-æ•´æ•°ç±»å‹çš„æ ¼å¼"><a href="#æ–°å¢-lt-inttypes-h-gt-æ•´æ•°ç±»å‹çš„æ ¼å¼" class="headerlink" title="æ–°å¢<inttypes.h>æ•´æ•°ç±»å‹çš„æ ¼å¼"></a>æ–°å¢<code>&lt;inttypes.h&gt;</code>æ•´æ•°ç±»å‹çš„æ ¼å¼</h2><h2 id="æ–°å¢-lt-complex-h-gt-å¤æ•°ç®—æœ¯è¿ç®—"><a href="#æ–°å¢-lt-complex-h-gt-å¤æ•°ç®—æœ¯è¿ç®—" class="headerlink" title="æ–°å¢<complex.h>å¤æ•°ç®—æœ¯è¿ç®—"></a>æ–°å¢<code>&lt;complex.h&gt;</code>å¤æ•°ç®—æœ¯è¿ç®—</h2><h2 id="æ–°å¢-lt-tgmath-h-gt-æ³›å‹æ•°å­¦"><a href="#æ–°å¢-lt-tgmath-h-gt-æ³›å‹æ•°å­¦" class="headerlink" title="æ–°å¢<tgmath.h>æ³›å‹æ•°å­¦"></a>æ–°å¢<code>&lt;tgmath.h&gt;</code>æ³›å‹æ•°å­¦</h2><p><tgmath.h>æä¾›äº†å¸¦å‚æ•°çš„å®ï¼Œå®çš„åå­—ä¸<math.h>å’Œ<complex.h>ä¸­çš„å‡½æ•°åç›¸åŒ¹é…ã€‚è¿™äº›æ³›å‹å®ï¼ˆtype-generic macroï¼‰å¯ä»¥æ£€æµ‹å‚æ•°çš„ç±»å‹ï¼Œç„¶åè°ƒç”¨<math.h>æˆ–<complex.h>ä¸­ç›¸å¯¹åº”çš„å‡½æ•°ã€‚</complex.h></math.h></complex.h></math.h></tgmath.h></p><p>æ¯”å¦‚ï¼šsqrtå‡½æ•°ä¸ä»…æœ‰3ç§å¤æ•°ç‰ˆæœ¬ï¼ˆcsqrtã€csqrtfå’Œcsqrtlï¼‰ï¼Œè¿˜æœ‰doubleï¼ˆsqrtï¼‰ã€floatï¼ˆsqrtfï¼‰ä»¥åŠlong doubleç‰ˆæœ¬ï¼ˆsqrtlï¼‰ã€‚ä½¿ç”¨<tgmath.h>åï¼Œç¨‹åºå‘˜å¯ä»¥ç›´æ¥ä½¿ç”¨sqrtï¼Œè€Œä¸ç”¨æ‹…å¿ƒéœ€è¦çš„åˆ°åº•æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼šæ ¹æ®å‚æ•°xç±»å‹çš„ä¸åŒï¼Œå‡½æ•°è°ƒç”¨sqrt(x)æœ‰å¯èƒ½æ˜¯6ä¸ªç‰ˆæœ¬sqrtä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚</tgmath.h></p><p>é¡ºä¾¿æä¸€ä¸‹ï¼Œ<tgmath.h>ä¸­åŒ…å«äº†<math.h>å’Œ<complex.h>ã€‚</complex.h></math.h></tgmath.h></p><h2 id="æ–°å¢-lt-fenv-h-gt-æµ®ç‚¹ç¯å¢ƒ"><a href="#æ–°å¢-lt-fenv-h-gt-æµ®ç‚¹ç¯å¢ƒ" class="headerlink" title="æ–°å¢<fenv.h>æµ®ç‚¹ç¯å¢ƒ"></a>æ–°å¢<code>&lt;fenv.h&gt;</code>æµ®ç‚¹ç¯å¢ƒ</h2><p>IEEEæ ‡å‡†754åœ¨è¡¨ç¤ºæµ®ç‚¹æ•°æ—¶ä½¿ç”¨æœ€å¹¿æ³›ã€‚ï¼ˆC99æ ‡å‡†æŠŠIEEE 754æˆä¸ºIEC 60559ï¼‰ã€‚<fenv.h>çš„ç›®çš„æ˜¯ä½¿ç¨‹åºå¯ä»¥è®¿é—®IEEEæ ‡å‡†æŒ‡å®šçš„æµ®ç‚¹çŠ¶æ€æ ‡å¿—å’Œæ§åˆ¶æ¨¡å¼ã€‚</fenv.h></p>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•=é€»è¾‘+æ§åˆ¶</title>
      <link href="suan-fa-luo-ji-kong-zhi/"/>
      <url>suan-fa-luo-ji-kong-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="è§‚ç‚¹"><a href="#è§‚ç‚¹" class="headerlink" title="è§‚ç‚¹"></a>è§‚ç‚¹</h2><p><a href="https://en.wikipedia.org/wiki/Robert_Kowalski">Robert Kowalski</a>åœ¨å…¶è®ºæ–‡<a href="https://www.doc.ic.ac.uk/~rak/papers/algorithm%20=%20logic%20+%20control.pdf">Algorithm = Logic + Control</a>ä¸­æŒ‡å‡ºï¼š</p><blockquote><p>An algorithm can be regarded as consisting of a logic component, which specifies the knowledge to be used in solving problems, and a control component, which determines the problem-solving strategies by means of which that knowledge is used. The logic component determines the meaning of the algorithm whereas the control component only affects its efficiency. The efficiency of an algorithm can often be improved by improving the control component without changing the logic of the algorithm. We argue that computer programs would be more often correct and more easily improved and modified if their logic and control aspects were identified and separated in the program text.</p><p>ç®—æ³•å¯ä»¥è§†ä¸ºç”±é€»è¾‘éƒ¨åˆ†å’Œæ§åˆ¶éƒ¨åˆ†ç»„æˆã€‚å…¶ä¸­ï¼Œé€»è¾‘éƒ¨åˆ†æŒ‡æ˜äº†è§£å†³é—®é¢˜æ—¶éœ€è¦ç”¨åˆ°çš„çŸ¥è¯†ã€‚è€Œæ§åˆ¶éƒ¨åˆ†åˆ™ï¼ˆæ ¹æ®é€»è¾‘éƒ¨åˆ†ç”¨åˆ°çš„çŸ¥è¯†æ¥ï¼‰å†³å®šè§£å†³é—®é¢˜æ—¶éœ€è¦ç”¨åˆ°çš„ç­–ç•¥ã€‚é€»è¾‘éƒ¨åˆ†ç¡®å®šç®—æ³•çš„å«ä¹‰ï¼Œè€Œæ§åˆ¶éƒ¨åˆ†åªå½±å“å…¶æ•ˆç‡ã€‚åœ¨ä¸æ”¹å˜ç®—æ³•é€»è¾‘éƒ¨åˆ†çš„æ¡ä»¶ä¸‹ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡æ”¹è¿›ç®—æ³•æ§åˆ¶éƒ¨åˆ†æ¥æå‡ç®—æ³•çš„æ•ˆç‡ã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œå¦‚æœè½¯ä»¶ä»£ç ä¸­çš„é€»è¾‘éƒ¨åˆ†å’Œæ§åˆ¶éƒ¨åˆ†èƒ½å¤Ÿæœ‰æ•ˆçš„è¯†åˆ«å’ŒåŒºåˆ†å¼€ï¼Œé‚£ä¹ˆè½¯ä»¶å°†ä¼šå˜å¾—æ›´åŠ å®¹æ˜“æ”¹è¿›å’Œç»´æŠ¤ã€‚</p><p>We have argued that conventional algorithms can usefully be regarded as consisting of two components:<br>(1) a logic component which specifies what is to be done and<br>(2) a control component which determines how it is to be done.</p><p>æˆ‘ä»¬è®¤ä¸ºä¼ ç»Ÿçš„ç®—æ³•å¯ä»¥è¢«è§†ä¸ºç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š<br>(1) ä¸€ä¸ªè¡¨æ˜ç®—æ³•<code>åšä»€ä¹ˆ</code>çš„é€»è¾‘éƒ¨åˆ†<br>(2) å’Œä¸€ä¸ªå†³å®šäº†ç®—æ³•<code>å¦‚ä½•åš</code>çš„æ§åˆ¶éƒ¨åˆ†ã€‚</p></blockquote><h2 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h2><p>é‚£ä¹ˆå¦‚ä½•æ¥ç†è§£<code>ç®—æ³• = é€»è¾‘ + æ§åˆ¶</code>ä»¥åŠå¦‚ä½•åŒºåˆ†ç®—æ³•ä¸­çš„<code>é€»è¾‘</code>å’Œ<code>æ§åˆ¶</code>å‘¢ï¼Ÿä½œè€…ä¸¾ä¾‹å‡ ä¸ªä¾‹å­æ¥é˜è¿°ï¼Œå…¶ä¸­ä¸€ä¸ªç®€å•æ˜“æ‡‚çš„ä¾‹å­å°±æ˜¯é˜¶ä¹˜ã€‚</p><p>é¦–å…ˆï¼Œé˜¶ä¹˜çš„å®šä¹‰æ˜¯ï¼š</p><ol><li><code>0</code>çš„é˜¶ä¹˜æ˜¯<code>1</code>ã€‚</li><li>å¦‚æœ<code>x</code>çš„é˜¶ä¹˜æ˜¯<code>v</code>ï¼Œé‚£ä¹ˆ<code>x+1</code>çš„é˜¶ä¹˜å°±æ˜¯<code>v*(x+1)</code>ã€‚</li></ol><p>æˆ‘ä»¬ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼è®¡ç®—ä¸€ä¸ªæ•°nçš„é˜¶ä¹˜ï¼š</p><ol><li>è‡ªåº•å‘ä¸Šã€‚é¦–å…ˆè®¡ç®—<code>0</code>çš„é˜¶ä¹˜ï¼Œç„¶åæ˜¯<code>1</code>ï¼Œç„¶åæ˜¯<code>2</code>â€¦ä¸€ç›´åˆ°<code>n</code>ã€‚æœ¬è´¨å°±æ˜¯ä»<code>0</code>å¾ªç¯è®¡ç®—ç›´åˆ°<code>n</code>ã€‚</li><li>è‡ªé¡¶å‘ä¸‹ã€‚è¦è®¡ç®—<code>n</code>çš„é˜¶ä¹˜ï¼Œé¦–å…ˆå°±è¦è®¡ç®—<code>n-1</code>çš„é˜¶ä¹˜ã€‚è¦è®¡ç®—<code>n-1</code>çš„é˜¶ä¹˜ï¼Œé¦–å…ˆå°±è¦è®¡ç®—<code>n-2</code>çš„é˜¶ä¹˜ã€‚è¿™æ ·ä¸€ç›´åˆ°éœ€è¦è®¡ç®—0çš„é˜¶ä¹˜ï¼Œè€Œæˆ‘ä»¬çŸ¥é“<code>0</code>çš„é˜¶ä¹˜æ˜¯<code>1</code>ã€‚æœ¬è´¨å°±æ˜¯é€’å½’çš„æ±‚è§£ã€‚</li></ol><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ç»“åˆ<a href="#è§‚ç‚¹">Robert Kowalskiçš„è§‚ç‚¹</a>å’Œä¸Šé¢çš„<a href="#ä¸¾ä¾‹">é˜¶ä¹˜çš„ä¾‹å­</a>æ¥ç†è§£ã€‚</p><p>é˜¶ä¹˜ç®—æ³•å¯ä»¥è§†ä¸ºç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ol><li>é€»è¾‘éƒ¨åˆ†ï¼Œæ˜¯é˜¶ä¹˜çš„å®šä¹‰ã€‚<br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿé€»è¾‘éƒ¨åˆ†çš„å®šä¹‰å°±æ˜¯<code>åšä»€ä¹ˆ</code>ï¼Œè€Œé˜¶ä¹˜ç®—æ³•çš„<code>åšä»€ä¹ˆ</code>å°±æ˜¯è®¡ç®—ä¸€ä¸ªæ•°çš„é˜¶ä¹˜ã€‚å…¶ä¸­â€<em>é€»è¾‘éƒ¨åˆ†æŒ‡æ˜äº†è§£å†³é—®é¢˜æ—¶éœ€è¦ç”¨åˆ°çš„çŸ¥è¯†</em>â€œçš„çŸ¥è¯†ï¼ŒæŒ‡çš„å°±æ˜¯é˜¶ä¹˜ç®—æ³•çš„å®šä¹‰ã€‚æ¢è€Œè¨€ä¹‹ï¼Œç®—æ³•çš„é€»è¾‘éƒ¨åˆ†ï¼ŒæŒ‡å®šæ˜¯ç®—æ³•çš„ä¸šåŠ¡é€»è¾‘ã€‚</li><li>æ§åˆ¶éƒ¨åˆ†ï¼Œæ˜¯é˜¶ä¹˜çš„è®¡ç®—æ–¹æ³•ã€‚<br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ§åˆ¶éƒ¨åˆ†çš„å®šä¹‰å°±æ˜¯<code>å¦‚ä½•åš</code>ï¼Œä¸Šé¢ä¾‹å­ä¸­å¦‚ä½•è®¡ç®—çš„é˜¶ä¹˜çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šè‡ªåº•å‘ä¸Šå’Œè‡ªé¡¶å‘ä¸‹ã€‚â€<em>åœ¨ä¸æ”¹å˜ç®—æ³•é€»è¾‘éƒ¨åˆ†çš„æ¡ä»¶ä¸‹ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡æ”¹è¿›ç®—æ³•æ§åˆ¶éƒ¨åˆ†æ¥æå‡ç®—æ³•çš„æ•ˆç‡ã€‚</em>â€œ æˆ‘ä»¬ä¹Ÿç¡®å®å¯ä»¥é€šè¿‡ä¼˜åŒ–é˜¶ä¹˜è®¡ç®—è¿‡ç¨‹ä¸­çš„ç»†èŠ‚æ¥æé«˜è®¡ç®—çš„æ•ˆç‡ï¼Œæ¯”å¦‚åœ¨è‡ªåº•å‘ä¸Šçš„æ–¹æ³•ä¸­ï¼Œç¼“å­˜è®¡ç®—è¿‡çš„å€¼ï¼Œé¿å…é‡å¤è®¡ç®—æ¥æé«˜æ•ˆç‡ã€‚ä½†æ˜¯æˆ‘ä»¬å¾ˆéš¾é€šè¿‡è°ƒæ•´é˜¶ä¹˜å®šä¹‰çš„æè¿°æ–¹å¼æ¥ä¼˜åŒ–æ•´ä¸ªé˜¶ä¹˜ç®—æ³•çš„æ•ˆç‡ã€‚</li></ol><p>å¦å¤–ä¸€ä¸ªå®¹æ˜“ç†è§£çš„ä¾‹å­æ˜¯æ’åºç®—æ³•ã€‚ä¸åŒçš„æ’åºç®—æ³•éƒ½å¯ä»¥å®ç°æ’åºçš„åŠŸèƒ½ï¼Œè€Œä¸ç”¨çš„æ’åºç®—æ³•çš„æ•ˆç‡æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚å†’æ³¡æ’åºï¼Œå½’å¹¶æ’åºç­‰ã€‚æ‰€ä»¥å¯¹æ’åºç®—æ³•æ¥è¯´ï¼Œæ’åºåŠŸèƒ½æ˜¯<code>é€»è¾‘éƒ¨åˆ†</code>ï¼Œå†’æ³¡ã€å½’å¹¶ç­‰å…·ä½“çš„åšæ³•åˆ™æ˜¯æ’åºç®—æ³•çš„<code>æ§åˆ¶éƒ¨åˆ†</code>ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p><a href="#è§‚ç‚¹">Robert Kowalskiçš„è§‚ç‚¹</a>å¸®åŠ©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½çš„åˆ†è§£ç¨‹åºä¸­çš„ç®—æ³•ï¼Œå°†<code>åšä»€ä¹ˆ</code>å’Œ<code>æ€ä¹ˆåš</code>çš„ä»£ç åˆ†å¼€ï¼Œå…¶å®ä¹Ÿæ˜¯åº”ç”¨<a href="https://kibazen.cn/she-ji-mo-shi-du-shu-bi-ji/">è®¾è®¡æ¨¡å¼</a>ä¸­<code>ç­–ç•¥æ¨¡å¼</code>çš„è¿‡ç¨‹ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç¨‹åºæ˜¯ç”±ç®—æ³•å’Œæ•°æ®ç»“æ„ç»„æˆçš„ï¼ˆæœ€å¼€å§‹ç”±<a href="https://en.wikipedia.org/wiki/Niklaus_Wirth">Niklaus Wirth</a>åœ¨å…¶ä¹¦<a href="http://www.ethoberon.ethz.ch/WirthPubl/AD.pdf">Algorithms + Data Structures = Programs</a>æå‡ºï¼‰ï¼Œå³<code>ç®—æ³• + æ•°æ®ç»“æ„ = ç¨‹åº</code>ï¼Œè€Œ<a href="#è§‚ç‚¹">Robert Kowalskiçš„è§‚ç‚¹</a>åˆ™æ˜¯å°†è¿™ä¸ªå…¬å¼è¿›ä¸€æ­¥çš„ç»†åŒ–ï¼Œä»è€Œè®©æˆ‘ä»¬èƒ½å¤Ÿå¾—å‡ºï¼š<code>ç®—æ³•é€»è¾‘ + ç®—æ³•æ§åˆ¶ + æ•°æ®ç»“æ„ = ç¨‹åº</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šä¿—æ˜“æ‡‚çš„ä»‹ç»CAPå®šç†</title>
      <link href="tong-su-yi-dong-de-jie-shao-cap-ding-li/"/>
      <url>tong-su-yi-dong-de-jie-shao-cap-ding-li/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡<code>æ„è¯‘</code>è‡ª<a href="http://ksat.me/">Kaushik Sathupadi</a>åšå®¢ä¸­çš„ä¸€ç¯‡åšæ–‡ï¼Œè¯¥åšæ–‡é€šä¿—æ˜“æ‡‚çš„ä»‹ç»äº†CAPå®šç†ã€‚<br>åŸæ–‡ï¼š<a href="http://ksat.me/a-plain-english-introduction-to-cap-theorem">A plain english introduction to CAP Theorem</a><br>ç¿»è¯‘ï¼š<a href="https://kibazen.cn">kibazen</a></p><hr><p>ä½ ç»å¸¸ä¼šå¬è¯´CAPå®šç†ï¼Œè¯¥å®šç†æŒ‡æ˜äº†åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶çš„ä¸€äº›ä¸Šé™é™åˆ¶ã€‚ä¸æˆ‘å¤§å¤šæ•°å…¶ä»–çš„æ•™ç¨‹ä¸€æ ·ï¼Œè®©æˆ‘ä»¬é€šè¿‡çœŸå®ä¸–ç•Œä¸­çš„ä¾‹å­æ¥ç†è§£CAPå®šç†ã€‚</p><blockquote><p>è¯‘æ³¨ï¼šCAPæŒ‡ï¼šä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition toleranceï¼‰ã€‚</p></blockquote><h2 id="ä¸€ã€æ–°çš„äº‹ä¸šâ€œè®°å¿†å…¬å¸â€"><a href="#ä¸€ã€æ–°çš„äº‹ä¸šâ€œè®°å¿†å…¬å¸â€" class="headerlink" title="ä¸€ã€æ–°çš„äº‹ä¸šâ€œè®°å¿†å…¬å¸â€"></a>ä¸€ã€æ–°çš„äº‹ä¸šâ€œè®°å¿†å…¬å¸â€</h2><p>æ˜¨æ™šï¼Œå½“ä½ çš„å¦»å­æ„Ÿè°¢ä½ è®°å¾—å¥¹çš„ç”Ÿæ—¥ï¼Œå¹¶ç»™å¥¹ä¹°äº†ç¤¼ç‰©æ—¶ï¼Œä½ çš„è„‘æµ·ä¸­çªç„¶å†’å‡ºä¸€ä¸ªå¥‡æ€ªçš„æƒ³æ³•ã€‚å¤§å®¶éƒ½ä¸æ“…é•¿è®°å¿†ï¼Œä½†æ˜¯ä½ å´æ“…é•¿è®°å¿†ã€‚æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆä¸ç”¨è‡ªå·±çš„è®°å¿†å¤©èµ‹æ¥åˆ›ä¸šå‘¢ï¼Ÿå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ï¼Œäºæ˜¯ä½ zåœ¨æŠ¥çº¸ä¸Šæ‰“äº†ä¸€ä¸ªå¹¿å‘Šï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">è®°å¿†å…¬å¸ â€”â€” å³ä½¿ä½ ä¸è®°å¾—ï¼Œéƒ½ä¸ä¼šå¿˜è®°æ˜¯å¦è¿˜åœ¨ä¸ºå¿˜è®°å¾ˆå¤šäº‹è€Œçƒ¦æ¼ï¼Ÿä¸ç”¨æ‹…å¿ƒï¼Œåªéœ€ä¸€ä¸ªç”µè¯å°±å¯ä»¥è§£å†³ï¼å½“ä½ éœ€è¦è®°ä½æŸäº‹æ—¶ï¼Œæ‹¨æ‰“ç”µè¯555-55-REMENå‘Šè¯‰æˆ‘ä»¬ä½ æƒ³è®°ä½çš„äº‹ã€‚æ¯”å¦‚ï¼šæ‰“ç”µè¯å‘Šè¯‰æˆ‘ä»¬ä½ ä¸Šå¸çš„ç”µè¯å·ç ï¼Œç„¶åå°±å¯ä»¥å¿˜è®°å®ƒäº†ã€‚å½“æ‹¨æ‰“åŒæ ·çš„ç”µè¯å·ç 555-55-REMENï¼Œæˆ‘ä»¬å°±ä¼šå‘Šè¯‰ä½ ä¸Šå¸çš„ç”µè¯å·ç ã€‚æ”¶è´¹ï¼šæ¯æ¬¡æœåŠ¡ä»…éœ€0.1å…ƒå“¦ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åï¼Œä½ ä¸å®¢æˆ·å…¸å‹çš„ä¸€æ¬¡å¯¹è¯å†…å®¹å°±ä¼šåƒä¸‹é¢è¿™æ ·ï¼š</p><ul><li>å®¢æˆ·ï¼šä½ å¥½ï¼Œéº»çƒ¦å¸®æˆ‘è®°ä¸€ä¸‹æˆ‘é‚»å±…çš„ç”Ÿæ—¥ï¼Ÿ</li><li>ä½ ï¼šå¥½çš„ï¼Œè¯·é—®æ˜¯å¤šå°‘ï¼Ÿ</li><li>å®¢æˆ·ï¼š1æœˆ2æ—¥</li><li>ä½ ï¼šï¼ˆè®°åœ¨ç¬”è®°æœ¬ä¸Šï¼‰å·²ç»è®°å½•å¥½äº†ã€‚å½“ä½ éœ€è¦æ—¶è¯·å†è”ç³»æˆ‘ä»¬ï¼</li><li>å®¢æˆ·ï¼šè°¢è°¢ï¼</li><li>ä½ ï¼šæ²¡å…³ç³»ï¼æœ¬æ¬¡æœåŠ¡æ”¶è´¹0.1å…ƒï¼</li></ul><h2 id="äºŒã€ä¸šåŠ¡å¢é•¿"><a href="#äºŒã€ä¸šåŠ¡å¢é•¿" class="headerlink" title="äºŒã€ä¸šåŠ¡å¢é•¿"></a>äºŒã€ä¸šåŠ¡å¢é•¿</h2><p>å› ä¸ºä½ çš„æƒ³æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦ç¬”è®°æœ¬å’Œç”µè¯å°±èƒ½é«˜æ•ˆçš„å®Œæˆä¸šåŠ¡ï¼Œå…¬å¸å‘å±•çš„å¾ˆé¡ºåˆ©ï¼Œä¹Ÿæ”¶åˆ°äº†YCombinatorçš„æŠ•èµ„ã€‚å…¬å¸çš„ä¸šåŠ¡è¶Šæ¥è¶Šå¤šï¼Œæ¯å¤©éƒ½ä¼šæ¥åˆ°ä¸Šåƒä¸ªç”µè¯ã€‚</p><p>ä½†æ˜¯é—®é¢˜ä¹Ÿå¼€å§‹å‡ºç°äº†ï¼Œå®¢æˆ·éœ€è¦ç­‰å¾…è¶Šæ¥è¶Šä¹…ç”µè¯æ‰ä¼šæ¥é€šã€‚ä¸€äº›å®¢æˆ·ç”šè‡³å¬çƒ¦äº†æœåŠ¡ç”µè¯çš„é“ƒå£°ï¼Œç›´æ¥åœ¨ç­‰å¾…æ¥é€šçš„è¿‡ç¨‹ä¸­å°±æŒ‚æ–­äº†ç”µè¯ã€‚åŒæ—¶ï¼Œå½“ä½ ç”Ÿç—…æ— æ³•å·¥ä½œæ—¶ï¼Œå°±ä¼šç™½ç™½çš„ä¸¢å¤±äº†ä¸€å¤©ä¸šåŠ¡ã€‚è¿™å¯¹å½“å¤©éœ€è¦æœåŠ¡çš„å®¢æˆ·æ¥è¯´ï¼Œä½“éªŒä¹Ÿå¾ˆä¸å¥½ã€‚æ‰€ä»¥ï¼Œæ˜¯æ—¶å€™æ‰©å¤§å…¬å¸çš„è§„æ¨¡äº†ï¼Œè®©ä½ çš„å¦»å­ä¹Ÿæ¥å¸®å¿™ã€‚</p><blockquote><p>è¯‘æ³¨ï¼šéšç€ä¸šåŠ¡çš„å¢é•¿ï¼Œå•ç‚¹çš„æœåŠ¡å·²ç»ä¸èƒ½æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ã€‚</p></blockquote><p>ä¸€ä¸ªç®€å•çš„è®¡åˆ’ï¼š</p><ol><li>ä½ å’Œä½ çš„å¦»å­åŒæ—¶æ¥å¬å®¢æˆ·çš„ç”µè¯ã€‚</li><li>å¯¹å®¢æˆ·æ¥è¯´ï¼Œè¿˜æ˜¯åªéœ€è¦è®°ä½<code>555-55-REMEN</code>è¿™ä¸ªç”µè¯ã€‚</li><li>å®¢æˆ·çš„æœåŠ¡ç”µè¯ä¼šå¹³å‡ä¸”é«˜æ•ˆçš„åˆ†é…ç»™ä½ ä»¬ã€‚</li></ol><h2 id="ä¸‰ã€æœåŠ¡ç¬¬ä¸€æ¬¡å‡ºç°é—®é¢˜"><a href="#ä¸‰ã€æœåŠ¡ç¬¬ä¸€æ¬¡å‡ºç°é—®é¢˜" class="headerlink" title="ä¸‰ã€æœåŠ¡ç¬¬ä¸€æ¬¡å‡ºç°é—®é¢˜"></a>ä¸‰ã€æœåŠ¡ç¬¬ä¸€æ¬¡å‡ºç°é—®é¢˜</h2><p>å®æ–½æ–°è®¡åˆ’çš„ä¸¤å¤©åï¼Œä½ æ¥åˆ°äº†è€å®¢æˆ·Johnçš„ç”µè¯ã€‚ä¸‹é¢æ˜¯å½“æ—¶çš„é€šè¯è®°å½•ï¼š</p><ul><li>Johnï¼šä½ å¥½ï¼</li><li>ä½ ï¼šæ¬¢è¿æ‹¨æ‰“è®°å¿†å…¬å¸çƒ­çº¿ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ï¼Ÿ</li><li>Johnï¼šè¯·å‘Šè¯‰æˆ‘åˆ°æ–°æ³½è¥¿çš„é£æœºæ˜¯å‡ ç‚¹çš„ï¼Ÿ</li><li>ä½ ï¼šå¥½çš„ï¼Œè¯·ç¨ç­‰â€¦â€¦ï¼ˆç¿»äº†ä¸€ä¸‹è‡ªå·±çš„ç¬”è®°æœ¬ï¼Œæ²¡æ‰¾åˆ°ç›¸å…³çš„å†…å®¹ï¼‰</li><li>ä½ ï¼šä½ å¥½ï¼Œä½ å¥½åƒå¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä½ é£æœºçš„ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œæ‰¾ä¸åˆ°ç›¸å…³çš„ä¿¡æ¯ã€‚</li><li>Johnï¼šä»€ä¹ˆï¼Ÿæˆ‘æ˜¨å¤©ä¸æ˜¯å‘Šè¯‰ä½ ä»¬äº†å—ï¼Ÿï¼ˆç”µè¯å°±è¢«æŒ‚æ–­äº†ï¼‰</li></ul><p>æ€ä¹ˆå›äº‹å‘¢ï¼ŸJohnè¯´è°äº†å—ï¼Ÿä½ æ€è€ƒäº†ä¸€ä¼šï¼Œç„¶åå‘ç°äº†é—®é¢˜çš„æ‰€åœ¨ï¼šæ˜¯ä¸æ˜¯æ˜¨å¤©æ˜¯ä½ çš„å¦»å­æ¥åˆ°çš„ç”µè¯ï¼Ÿç„¶åä½ çœ‹å¦»å­çš„ç¬”è®°æœ¬ä¸Šé¢ç¡®å®æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¿™æ—¶ä½ å’Œä½ çš„å¦»å­æ‰è®¤è¯†åˆ°å‡ºé—®é¢˜äº†ã€‚</p><p>è¿™ä¸ªç”µè¯åˆ†é…è®¡åˆ’è®¾è®¡çš„æœ‰é—®é¢˜å•Šï¼åˆ†é…ç³»ç»Ÿæ²¡æœ‰ä¿è¯<code>ä¸€è‡´æ€§</code>ï¼å®¢æˆ·æ¯æ¬¡æ‰“æ¥çš„ç”µè¯éƒ½ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªäººæ¥åˆ°ï¼Œé‚£ä¹ˆå®¢æˆ·å¾—åˆ°çš„å›ç­”å°±å¯èƒ½æ˜¯ä¸å¯¹çš„ã€‚</p><blockquote><p>è¯‘æ³¨ï¼šä¸€è‡´æ€§ï¼šåŒæ ·çš„è¯·æ±‚ï¼Œæ¯æ¬¡å¤„ç†çš„ç»“æœåº”å½“ä¸€è‡´ã€‚</p></blockquote><h2 id="å››ã€è§£å†³ä¸€è‡´æ€§é—®é¢˜"><a href="#å››ã€è§£å†³ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="å››ã€è§£å†³ä¸€è‡´æ€§é—®é¢˜"></a>å››ã€è§£å†³ä¸€è‡´æ€§é—®é¢˜</h2><p>ä½ çš„ç«äº‰å¯¹æ‰‹å¯èƒ½ä¼šå¿½ç•¥è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä½ ä¸ä¼šã€‚äºæ˜¯ä½ æ€è€ƒæ•´å¤œï¼Œç»ˆäºåœ¨æ—©ä¸Šæƒ³å‡ºäº†ä¸€ä¸ªä¸é”™çš„è®¡åˆ’ï¼š</p><ol><li>å½“æ¥åˆ°å®¢æˆ·è¦æ±‚æˆ‘ä»¬è®°å½•äº‹æƒ…çš„ç”µè¯æ—¶ï¼Œåœ¨æŒ‚ç”µè¯ä¹‹å‰ï¼Œéƒ½è¦å…ˆé€šçŸ¥å¦å¤–çš„äººæ–°è®°å½•äº‹æƒ…çš„å†…å®¹ã€‚</li><li>æ‰€æœ‰äººåŒæ—¶å°†æ–°çºªå½•äº‹æƒ…çš„å†…å®¹<code>æ›´æ–°</code>åˆ°å„è‡ªçš„ç¬”è®°æœ¬ä¸Šã€‚</li><li>å› ä¸ºæ‰€æœ‰äººçš„æœ¬å­ä¸Šéƒ½æœ‰æœ€æ–°çš„æ‰€æœ‰å·²è®°å½•çš„äº‹æƒ…ï¼Œæ‰€ä»¥ï¼Œå½“å®¢æˆ·å†æ¥é—®ä¹‹å‰è®°å½•çš„å†…å®¹æ—¶ï¼Œå°±ä¸ç”¨é—®å…¶ä»–äººï¼Œå› ä¸ºè‡ªå·±çš„ç¬”è®°æœ¬ä¸Šå°±å¯ä»¥æŸ¥åˆ°äº†ã€‚</li></ol><p>ä½†æ˜¯è¿™ä¸ªè®¡åˆ’æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç¬¬2æ­¥â€<code>æ›´æ–°</code>â€œä¼šå½±å“æ‰€æœ‰äººï¼Œè¿™æ ·å¤§å®¶å°±ä¸èƒ½åŒæ—¶å·¥ä½œäº†ã€‚æ¯”å¦‚ï¼šä½ æ¥åˆ°ä¸€ä¸ªè®°å½•äº‹æƒ…çš„ç”µè¯ï¼Œç„¶åé©¬ä¸Šå‘Šè¯‰æˆ‘ä¹Ÿéœ€è¦è®°å½•è¿™ä¸ªäº‹ï¼Œè¿™æ—¶æˆ‘å°±æ²¡åŠæ³•æ¥å¬å…¶ä»–å®¢æˆ·çš„ç”µè¯äº†ã€‚ä½†æ˜¯è¿™å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºå¤§å¤šæ•°å®¢æˆ·æ‰“æ¥ç”µè¯éƒ½æ˜¯æŸ¥è¯¢ä¹‹å‰çš„å†…å®¹ï¼ˆè®°ä¸€æ¬¡ï¼Œé—®å¤šæ¬¡ï¼‰ã€‚åŒæ—¶ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿè§£å†³äº†ä¹‹å‰è®°äº†äº‹æƒ…ä½†æ˜¯æŸ¥ä¸åˆ°çš„é—®é¢˜ã€‚</p><p>â€œè¿™ä¸ªç³»ç»Ÿè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ä½ æ²¡è€ƒè™‘åˆ°ã€‚â€ä½ çš„å¦»å­è¯´ã€‚å¦‚æœæˆ‘ä»¬ä¸­æœ‰ä¸€äººæŸå¤©æ²¡æœ‰å·¥ä½œæ—¶å°±ä¼šå‡ºé—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½å†è®°å½•ä»»ä½•æ–°çš„äº‹æƒ…ï¼Œå› ä¸ºæ— æ³•æ›´æ–°é‚£ä¸ªæ²¡å·¥ä½œçš„äººçš„ç¬”è®°æœ¬ã€‚è¿™æ ·å°±ä¼šå‡ºç°<code>å¯ç”¨æ€§</code>çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼šå¦‚æœä½ ä»Šå¤©æ²¡å·¥ä½œï¼Œè€Œæ­¤æ—¶æˆ‘åˆæ¥åˆ°ä¸€ä¸ªæ›´æ–°ç”µè¯ï¼Œé‚£æˆ‘å°±æ²¡æ³•å®Œæˆæ›´æ–°çš„å·¥ä½œï¼Œå› ä¸ºæˆ‘ä¸èƒ½æ›´æ–°ä½ çš„ç¬”è®°æœ¬ã€‚</p><blockquote><p>è¯‘æ³¨ï¼šå¯ç”¨æ€§ï¼šå³ä½¿ç³»ç»Ÿå†…éƒ¨æŸäº›å­ç³»ç»Ÿå‡ºç°é—®é¢˜ï¼Œæ•´ä¸ªç³»ç»Ÿä¾ç„¶èƒ½æ­£å¸¸çš„å¯¹å¤–æä¾›æœåŠ¡ã€‚</p></blockquote><h2 id="äº”ã€æ›´å¥½çš„è§£å†³æ–¹æ³•"><a href="#äº”ã€æ›´å¥½çš„è§£å†³æ–¹æ³•" class="headerlink" title="äº”ã€æ›´å¥½çš„è§£å†³æ–¹æ³•"></a>äº”ã€æ›´å¥½çš„è§£å†³æ–¹æ³•</h2><p>ä½ ç»ˆäºæ„è¯†åˆ°äº†ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿå¹¶æ²¡ä¸€å¼€å§‹æƒ³çš„é‚£ä¹ˆç®€å•äº†ã€‚éš¾é“å°±æ‰¾ä¸åˆ°ä¸€ä¸ªæ—¢èƒ½ä¿è¯<code>ä¸€è‡´æ€§</code>ï¼ŒåŒæ—¶ä¹Ÿèƒ½ä¿è¯<code>å¯ç”¨æ€§</code>çš„è§£å†³æ–¹æ³•äº†å—ï¼Ÿäºæ˜¯ä½ ç»è¿‡å½»å¤œçš„æ€è€ƒï¼Œåœ¨æ—©ä¸Šåˆæƒ³å‡ºäº†ä¸€ä¸ªå’Œä¹‹å‰çš„ç±»ä¼¼ï¼Œä½†æ˜¯æ›´å¥½çš„è®¡åˆ’ï¼š</p><ol><li>å½“æ¥åˆ°å®¢æˆ·è¦æ±‚æˆ‘ä»¬è®°å½•äº‹æƒ…çš„ç”µè¯æ—¶ï¼Œåœ¨æŒ‚ç”µè¯ä¹‹å‰ï¼Œéƒ½è¦å…ˆé€šçŸ¥å¦å¤–çš„äººæ–°è®°å½•äº‹æƒ…çš„å†…å®¹ã€‚</li><li>å¦‚æœå…¶ä»–äººåœ¨æ­£å¸¸çš„å·¥ä½œçš„è¯ï¼Œé‚£ä¹ˆå°±åŒæ—¶å°†æ–°çºªå½•äº‹æƒ…çš„å†…å®¹<code>æ›´æ–°</code>åˆ°å„è‡ªçš„ç¬”è®°æœ¬ä¸Šã€‚å¦‚æœæœ‰äººæ²¡æœ‰æ­£å¸¸å·¥ä½œçš„è¯ï¼Œå°±éœ€è¦ç»™ä»–å‘é‚®ä»¶æé†’ä»–æ›´æ–°ã€‚ç­‰åˆ°ä»–ä»¬å¼€å§‹æ­£å¸¸å·¥ä½œæ—¶ï¼Œé¦–å…ˆéœ€è¦æ ¹æ®æ‰€æœ‰æ”¶åˆ°çš„æ›´æ–°é‚®ä»¶æ¥æ›´æ–°ç¬”è®°æœ¬ï¼Œæ›´æ–°å®Œæˆåï¼Œæ‰èƒ½å¼€å§‹æ¥ç”µè¯ï¼Œä¸ºå®¢æˆ·æä¾›æœåŠ¡ã€‚</li><li>å› ä¸ºæ‰€æœ‰äººçš„æœ¬å­ä¸Šéƒ½æœ‰æœ€æ–°çš„æ‰€æœ‰å·²è®°å½•çš„äº‹æƒ…ï¼Œæ‰€ä»¥ï¼Œå½“å®¢æˆ·å†æ¥é—®ä¹‹å‰è®°å½•çš„å†…å®¹æ—¶ï¼Œå°±ä¸ç”¨é—®å…¶ä»–äººï¼Œå› ä¸ºè‡ªå·±çš„ç¬”è®°æœ¬ä¸Šå°±å¯ä»¥æŸ¥åˆ°äº†ã€‚</li></ol><p>å¤ªå¥½äº†ï¼è¿™ä¸‹â€œè®°å¿†å…¬å¸â€æä¾›çš„æœåŠ¡å°±èƒ½åŒæ—¶ä¿è¯<code>ä¸€è‡´æ€§</code>å’Œ<code>å¯ç”¨æ€§</code>äº†ã€‚</p><h2 id="å…­ã€å¦»å­æ€’äº†"><a href="#å…­ã€å¦»å­æ€’äº†" class="headerlink" title="å…­ã€å¦»å­æ€’äº†"></a>å…­ã€å¦»å­æ€’äº†</h2><p>æœ‰äº†ä¸Šé¢çš„è®¡åˆ’ï¼Œç°åœ¨å…¬å¸çš„äº‹æƒ…è¿›å±•çš„å¾ˆé¡ºåˆ©ã€‚ä½†æ˜¯å¦‚æœä½ å’Œä½ çš„å¦»å­éƒ½åœ¨ä¸Šç­ï¼Œè€Œå…¶ä¸­ä¸€ä¸ªäººæ¥æ”¶åˆ°æ›´æ–°ç”µè¯æ—¶å¹¶æ²¡æœ‰é€šçŸ¥å…¶ä»–äººæ›´æ–°å‘¢ï¼Ÿæ¯”å¦‚ï¼šä½ æƒ¹ä½ å¦»å­ä¸é«˜å…´äº†ï¼Œå¥¹å†³å®šä»Šå¤©ä¸€å¤©éƒ½ä¸ç†ä½ äº†ï¼Œä¹Ÿä¸é€šçŸ¥ä½ æ›´æ–°ç¬”è®°æœ¬äº†ã€‚é‚£ä¹ˆä»Šå¤©ä½ å¦»å­çš„ç¬”è®°æœ¬çš„æ‰€æœ‰æ›´æ–°ä½ ç¬”è®°æœ¬ä¸Šéƒ½æ²¡æœ‰ã€‚æ‰€ä»¥ï¼Œä¸Šé¢çš„è®¡åˆ’åªæ˜¯ä¿è¯<code>ä¸€è‡´æ€§</code>å’Œ<code>å¯ç”¨æ€§</code>ï¼Œå¹¶æ²¡æœ‰ä¿è¯<code>åˆ†åŒºå®¹å¿æ€§</code>ã€‚<br>ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨å“„å¥½å¦»å­ä¹‹å‰ï¼Œä¸æ¥ä»»ä½•å®¢æˆ·çš„ç”µè¯æ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯åœ¨ä½ å“„å¥½å¦»å­å‰çš„è¿™æ®µæ—¶é—´ï¼Œç³»ç»Ÿåˆæ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™æ ·åˆæ²¡æ³•ä¿è¯<code>å¯ç”¨æ€§</code>äº†ã€‚</p><blockquote><p>åˆ†åŒºå®¹å¿æ€§ï¼šå³ä½¿å„ä¸ªç³»ç»Ÿæš‚æ—¶æ— æ³•æ­£å¸¸çš„é€šä¿¡ï¼Œæ•´ä¸ªç³»ç»Ÿä¾ç„¶èƒ½æ­£å¸¸çš„å¯¹å¤–æä¾›æœåŠ¡ã€‚</p></blockquote><h2 id="ä¸ƒã€ç»“è®º"><a href="#ä¸ƒã€ç»“è®º" class="headerlink" title="ä¸ƒã€ç»“è®º"></a>ä¸ƒã€ç»“è®º</h2><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹CAPå®šç†åˆ°åº•åœ¨è¯´ä»€ä¹ˆã€‚CAPå®šç†è¯´çš„æ˜¯ï¼šå½“ä½ è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæ— æ³•åŒæ—¶è®©ç³»ç»Ÿæ»¡è¶³<code>ä¸€è‡´æ€§</code>ã€<code>å¯ç”¨æ€§</code>å’Œ<code>åˆ†åŒºå®¹å¿æ€§</code>ã€‚é¡¶å¤šåªèƒ½æ»¡è¶³å…¶ä¸­çš„ä¸¤ä¸ªï¼š</p><ol><li><code>ä¸€è‡´æ€§</code>ï¼šå¯¹ä½ çš„å®¢æˆ·æ¥è¯´ï¼Œä¸€æ—¦ä»–ä»¬æ›´æ–°è¦è®°ä½çš„äº‹ã€‚æ— è®ºä½•æ—¶ï¼Œä»–ä»¬æ€»æ˜¯èƒ½è·å–åˆ°æœ€æ–°çš„è®°å½•å†…å®¹ã€‚</li><li><code>å¯ç”¨æ€§</code>ï¼šåªè¦ä½ å’Œä½ çš„å¦»å­ä¸­æœ‰äººåœ¨ä¸Šç­ï¼Œå…¬å¸å°±èƒ½æ­£å¸¸ä¸”æ­£ç¡®è¿è¡Œã€‚</li><li><code>åˆ†åŒºå®¹å¿æ€§</code>ï¼šå³ä½¿ä½ å’Œä½ çš„å¦»å­æœ‰ä¸€æ®µæ—¶é—´ä¸æ²Ÿé€šäº†ï¼Œå…¬å¸ä¾ç„¶èƒ½æ­£å¸¸ä¸”æ­£ç¡®çš„è¿è¡Œã€‚</li></ol><h2 id="é¢å¤–å¥–åŠ±ï¼š-è¯·ä¸€ä¸ªå¯ä»¥æ¥å›è·‘çš„ç§˜ä¹¦æ¥ä¿è¯æœ€ç»ˆç»“æœçš„ä¸€è‡´æ€§"><a href="#é¢å¤–å¥–åŠ±ï¼š-è¯·ä¸€ä¸ªå¯ä»¥æ¥å›è·‘çš„ç§˜ä¹¦æ¥ä¿è¯æœ€ç»ˆç»“æœçš„ä¸€è‡´æ€§" class="headerlink" title="é¢å¤–å¥–åŠ±ï¼š è¯·ä¸€ä¸ªå¯ä»¥æ¥å›è·‘çš„ç§˜ä¹¦æ¥ä¿è¯æœ€ç»ˆç»“æœçš„ä¸€è‡´æ€§"></a>é¢å¤–å¥–åŠ±ï¼š è¯·ä¸€ä¸ªå¯ä»¥æ¥å›è·‘çš„ç§˜ä¹¦æ¥ä¿è¯æœ€ç»ˆç»“æœçš„ä¸€è‡´æ€§</h2><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå…¶ä»–çš„è§£å†³æ–¹æ³•ã€‚å¯ä»¥è¯·ä¸€ä¸ªç§˜ä¹¦ï¼Œå½“ä½ æˆ–ä½ çš„å¦»å­ç¬”è®°æœ¬æ›´æ–°æ—¶ï¼Œå¥¹å¯ä»¥å¸®ä½ ä»¬è‡ªåŠ¨çš„æ›´æ–°å…¶ä»–äººçš„ç¬”è®°æœ¬ä¸Šã€‚è¿™ä¹ˆåšçš„æœ€å¤§å¥½å¤„å°±æ˜¯ï¼šåœ¨æœ‰è®°å½•æ›´æ–°æ—¶ï¼Œå°±ä¸ç”¨ç­‰å¾…å…¶ä»–äººçš„ç¬”è®°æœ¬æ›´æ–°å®Œäº†æ‰èƒ½æ¥ä¸‹ä¸€ä¸ªç”µè¯äº†ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šNoSQLç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼šæ•°æ®åº“èŠ‚ç‚¹æœ¬åœ°æ›´æ–°è‡ªå·±ï¼Œç„¶åä¸€ä¸ªåå°è¿›ç¨‹å†å°†è¿™äº›ä¿®æ”¹åŒæ­¥åˆ°å…¶ä»–çš„æ•°æ®åº“èŠ‚ç‚¹ã€‚è¿™ç§æ–¹æ³•çš„å”¯ä¸€é—®é¢˜å°±åœ¨äºä¼šåœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±ä¸€è‡´æ€§ã€‚æ¯”å¦‚ï¼šä½ çš„å¦»å­æ¥åˆ°äº†å®¢æˆ·çš„æ›´æ–°ç”µè¯ï¼Œåœ¨ç§˜ä¹¦æŠŠä½ å¦»å­ç¬”è®°æœ¬ä¸Šçš„è¿™ä¸ªå˜åŒ–åŒæ­¥åˆ°ä½ çš„ç¬”è®°æœ¬ä¸Šä¹‹å‰ï¼Œè¿™ä¸ªå®¢æˆ·åˆæ‰“ç”µè¯æ¥é—®ï¼Œä½†æ˜¯æ˜¯ä½ æ¥åˆ°äº†è¿™ä¸ªç”µè¯ï¼Œè¿™æ—¶ä»–å°±ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯çš„å›ç­”ã€‚è¯è™½å¦‚æ­¤ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒå°‘çš„ã€‚æ¯”å¦‚ï¼šå‡å¦‚ä½ çš„å®¢æˆ·ä¸ä¼šåœ¨5åˆ†é’Ÿå†…å°±æ¥æ‰“ç”µè¯é—®å‘¢ã€‚</p><p>è¿™ä¸ªå°±æ˜¯CAPå’Œæœ€ç»ˆä¸€è‡´æ€§ï¼Œæœ¬æ–‡åˆ°æ­¤ç»“æŸã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¿»è¯‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºä¸­æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•</title>
      <link href="ji-suan-ji-zhong-fu-dian-shu-de-biao-shi-fang-fa/"/>
      <url>ji-suan-ji-zhong-fu-dian-shu-de-biao-shi-fang-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="IEEE-754æ ‡å‡†"><a href="#IEEE-754æ ‡å‡†" class="headerlink" title="IEEE 754æ ‡å‡†"></a>IEEE 754æ ‡å‡†</h2><p>åœ¨C/C++ç­‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„è¡¨ç¤ºé‡‡ç”¨çš„æ˜¯IEEE 754æ ‡å‡†ã€‚è¯¥æ ‡å‡†ä¸€å…±çš„è§„å®šäº†å››ç§è¡¨ç¤ºæµ®ç‚¹æ•°å€¼çš„æ–¹å¼ï¼Œå…¶ä¸­å¸¸è§çš„è¡¨ç¤ºæ–¹å¼æœ‰ä¸¤ç§ï¼šå•ç²¾ç¡®åº¦ï¼ˆ32ä½ï¼‰å’ŒåŒç²¾ç¡®åº¦ï¼ˆ64ä½ï¼‰ã€‚è¿™ä¸¤ç§è¡¨ç¤ºæ–¹å¼åœ¨C/C++è¯­è¨€ä¸­åˆ†åˆ«å¯ä»¥ç”¨<code>float</code>å’Œ<code>double</code>å…³é”®å­—æ¥å®šä¹‰ã€‚</p><h2 id="å•ç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•"><a href="#å•ç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="å•ç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•"></a>å•ç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•</h2><p>å•ç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•å…¶å®å°±æ˜¯æŠŠä¸€ä¸ª32ä½åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œå 1ä½ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„ç¬¦å·ï¼Œè‹±æ–‡Signï¼Œç®€ç§°ä¸ºSã€‚</li><li>ç¬¬äºŒä¸ªéƒ¨åˆ†ï¼Œå 8ä½ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„æŒ‡æ•°ï¼Œè‹±æ–‡Exponentï¼Œç®€ç§°ä¸ºEã€‚</li><li>ç¬¬ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå 23ä½ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„å°¾æ•°ï¼Œè‹±æ–‡Mantissaï¼Œç®€ç§°ä¸ºMã€‚</li></ol><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text"> 31         22                    0+----------------------------------+|S|EEEEEEEE|MMMMMMMMMMMMMMMMMMMMMMM|+----------------------------------+   30     23<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹åº”æµ®ç‚¹æ•°è¡¨ç¤ºçš„å€¼ä¸ºï¼š</p><script type="math/tex; mode=display">(-1)^S \cdot (1 + \frac{M}{2^{23}}) \cdot 2^{(E-127)}</script><p>ç»“åˆä¸Šé¢çš„å…¬å¼ï¼Œæ¥ç†è§£å„ä¸ªéƒ¨åˆ†çš„æ„ä¹‰å°±æ›´å®¹æ˜“äº†ï¼š</p><ol><li><p>ç¬¦å·éƒ¨åˆ†ï¼Œ$(-1)^S$</p><p> å½“Sä¸º0æ—¶ï¼Œ$(-1)^0 = 1$ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„å€¼å¤§äº0ï¼›åŒç†ï¼Œå½“Sä¸º1æ—¶ï¼Œ$(-1)^1 = -1$ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„å€¼å°äº0ã€‚</p></li><li><p>æŒ‡æ•°éƒ¨åˆ†ï¼Œ$2^{(E-127)}$</p><p> é¦–å…ˆè¦æ˜ç™½ï¼šå¯¹äºä»»ä½•ä¸€ä¸ªæ­£å®æ•°xï¼Œéƒ½å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ•´æ•°nï¼Œä½¿å¾—$2^n &lt;= x &lt; 2^{n+1}$ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚5ï¼Œå¯ä»¥æ‰¾åˆ°n=2ï¼Œä½¿å¾—$2^2 &lt;= 5 &lt; 2^3$ï¼Œå³$4 &lt;= 5 &lt; 8$ã€‚æµ®ç‚¹æ•°ä¸­çš„æŒ‡æ•°éƒ¨åˆ†å°±æ˜¯è¿™é‡Œçš„nã€‚</p><p> é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦å‡å»127å‘¢ï¼Ÿå› ä¸ºå½“æµ®ç‚¹æ•°å€¼çš„ç»å¯¹å€¼å°äº1æ—¶ï¼ŒæŒ‡æ•°éƒ¨åˆ†å…¶å®æ˜¯å°äº0çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚0.45ï¼Œåªæœ‰$n=-2$æ—¶ï¼Œä½¿å¾—$2^{-2} &lt;= 0.45 &lt; 2^{-1}$ï¼Œå³$0.25 &lt;= 0.45 &lt; 0.5$ã€‚è€Œæµ®ç‚¹æ•°ä¸­æŒ‡æ•°éƒ¨åˆ†å 8ä½ï¼Œå¯ä»¥è¡¨ç¤ºèŒƒå›´[0-$2^8$)ï¼Œå³[0-256)ï¼Œä¸ºäº†åœ¨æŒ‡æ•°éƒ¨åˆ†èƒ½å¤Ÿè¡¨ç¤ºè´Ÿæ•°ï¼Œ<code>IEEE 754è§„å®š</code>å‡å»127ï¼Œå³$n = E - 127$ã€‚æ‰€ä»¥ï¼Œå¦‚æœæµ®ç‚¹æ•°çš„$n=-2$ï¼Œé‚£ä¹ˆå®é™…çš„Eåº”è¯¥æ˜¯125ã€‚</p></li><li><p>å°¾æ•°éƒ¨åˆ†ï¼Œ$(1 + \frac{M}{2^{23}})$</p><p> å°¾æ•°éƒ¨åˆ†å 23ä½ï¼Œå¯ä»¥è¡¨ç¤ºèŒƒå›´[0-$2^{23}$)ï¼Œå³[0-8388608)ã€‚</p><p> å¯ä»¥è¿™æ ·ç†è§£å°¾æ•°éƒ¨åˆ†ï¼šæŠŠä¸€æ¡çº¿åˆ†æˆ8388608ä¸ªæ®µï¼Œä¹Ÿå°±æ˜¯æŠŠ$2^n$åˆ°$2^{n+1}$åˆ†æˆ8388608ä¸ªçº¿æ®µã€‚å°¾æ•°éƒ¨åˆ†çš„å€¼Mï¼Œè¡¨ç¤ºä»$2^n$åˆ°æµ®ç‚¹æ•°å€¼çš„ç»å¯¹å€¼xæ‰€è¦ç»è¿‡çš„çº¿æ®µæ•°é‡ï¼Œä¹Ÿå°±æ˜¯$2^n$åˆ°xçš„é•¿åº¦å $2^n$åˆ°$2^{n+1}$é•¿åº¦çš„æ¯”ä¾‹æ˜¯å¤šå°‘ã€‚è¿™ä¸ªæ¯”ä¾‹çš„å€¼å°±æ˜¯å°¾æ•°éƒ¨åˆ†å…¬å¼ä¸­$\frac{M}{2^{23}}$çš„æ¥ç”±ï¼Œè€ŒåŠ 1åˆ™è¡¨ç¤ºçº¿æ®µçš„èµ·ç‚¹$2^n$çš„å€¼ã€‚</p></li></ol><h2 id="å•ç²¾åº¦æµ®ç‚¹æ•°ä¸¾ä¾‹"><a href="#å•ç²¾åº¦æµ®ç‚¹æ•°ä¸¾ä¾‹" class="headerlink" title="å•ç²¾åº¦æµ®ç‚¹æ•°ä¸¾ä¾‹"></a>å•ç²¾åº¦æµ®ç‚¹æ•°ä¸¾ä¾‹</h2><p>æœ‰äº†ä¸Šé¢çš„è¯´æ˜ï¼Œå†ç»“åˆä¾‹å­æ¥ç†è§£ä¸€ä¸‹ï¼Œæ¯”å¦‚æµ®ç‚¹æ•°3.14ï¼š</p><ol><li><p>ç¬¦å·éƒ¨åˆ†</p><p> å› ä¸º3.14å¤§äº0ï¼Œæ‰€ä»¥$S = 0$ã€‚</p></li><li><p>æŒ‡æ•°éƒ¨åˆ†</p><p> $2^1 &lt;= 3.14 &lt; 2^2$ï¼Œæ‰€ä»¥$n=1$ï¼Œé‚£ä¹ˆ$E = n + 127 = 128$ã€‚</p></li><li><p>å°¾æ•°éƒ¨åˆ†</p><p> $2^1$åˆ°3.14çš„é•¿åº¦å $2^1$åˆ°$2^2$é•¿åº¦çš„æ¯”ä¾‹æ˜¯$\frac{(3.14 - 2^1)}{(2^2 - 2^1)} = 0.57$</p></li></ol><p>æ€»çº¿æ®µæ•°é‡ä¸º$2^{23}$ï¼Œé‚£ä¹ˆï¼Œä»$2^1$åˆ°3.14æ‰€è¦ç»è¿‡çš„çº¿æ®µæ•°é‡$M = 0.57 * 2^{23} = 4781506.56$ï¼Œå››èˆäº”å…¥ï¼Œè½¬æ¢æˆæ•´æ•°ç»“æœä¸º$M = 4781507$ã€‚<code>å› ä¸ºæœ‰å››èˆäº”å…¥ï¼Œæ‰€ä»¥æµ®ç‚¹æ•°ä¿å­˜çš„æ•°æ®å’Œå®é™…æ•°æ®æ˜¯æœ‰è¯¯å·®çš„ã€‚</code></p><p>æŠŠSã€Eã€Mè½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œå°±å¯ä»¥å¾—åˆ°3.14çš„äºŒè¿›åˆ¶è¡¨ç¤º<code>0x4048f5c3</code>ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text"> S     E             M+----------------------------------+|0|10000000|10010001111010111000011|+----------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åä»£å…¥æµ®ç‚¹æ•°å…¬å¼è®¡ç®—ï¼š</p><script type="math/tex; mode=display">(-1)^0 \cdot (1 + \frac{4781507}{2^{23}}) \cdot 2^{(128-127)} = 3.1400001049041748046875</script><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<a href="https://www.h-schmidt.net/FloatConverter/IEEE754.html">IEEE-754æµ®ç‚¹æ•°è½¬æ¢å·¥å…·</a>æ¥åˆ†ææµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•ã€‚</p><h2 id="åŒç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•"><a href="#åŒç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="åŒç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•"></a>åŒç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•</h2><p>åŒç²¾åº¦æµ®ç‚¹æ•°å’Œå•ç²¾åº¦æµ®ç‚¹æ•°çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å„ä¸ªéƒ¨åˆ†é•¿åº¦ä¸åŒè€Œå·²ã€‚</p><p>åŒç²¾åº¦æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•å…¶å®å°±æ˜¯æŠŠä¸€ä¸ª64ä½åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œå 1ä½ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„ç¬¦å·ï¼Œè‹±æ–‡Signï¼Œç®€ç§°ä¸ºSã€‚</li><li>ç¬¬äºŒä¸ªéƒ¨åˆ†ï¼Œå 11ä½ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„æŒ‡æ•°ï¼Œè‹±æ–‡Exponentï¼Œç®€ç§°ä¸ºEã€‚</li><li>ç¬¬ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå 52ä½ï¼Œè¡¨ç¤ºæµ®ç‚¹æ•°çš„å°¾æ•°ï¼Œè‹±æ–‡Mantissaï¼Œç®€ç§°ä¸ºMã€‚</li></ol><p>å¯¹åº”æµ®ç‚¹æ•°è¡¨ç¤ºçš„å€¼ä¸ºï¼š</p><script type="math/tex; mode=display">(-1)^S \cdot (1 + \frac{M}{2^{52}}) \cdot 2^{(E-1023)}</script>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ®ç‚¹æ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šé‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡(ç¬¬2ç‰ˆ)ã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="chong-gou-gai-shan-ji-you-dai-ma-de-she-ji-di-2-ban-du-shu-bi-ji/"/>
      <url>chong-gou-gai-shan-ji-you-dai-ma-de-she-ji-di-2-ban-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ol><li>é‡æ„(refactoring)ï¼šåœ¨ä¸æ”¹å˜ä»£ç å¤–åœ¨è¡Œä¸ºçš„å‰æä¸‹ï¼Œå¯¹ä»£ç åšå‡ºä¿®æ”¹ï¼Œä»¥æ”¹è¿›ç¨‹åºçš„å†…éƒ¨ç»“æ„ã€‚é‡æ„çš„æœ¬è´¨å°±æ˜¯åœ¨ä»£ç å†™å¥½ä¹‹åæ”¹è¿›å®ƒçš„è®¾è®¡ã€‚</li></ol><h2 id="ç¬¬1ç« -é‡æ„ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹"><a href="#ç¬¬1ç« -é‡æ„ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹" class="headerlink" title="ç¬¬1ç«  é‡æ„ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹"></a>ç¬¬1ç«  é‡æ„ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹</h2><ol><li>å¦‚æœä½ è¦ç»™ç¨‹åºæ·»åŠ ä¸€ä¸ªç‰¹æ€§ï¼Œä½†å‘ç°ä»£ç å› ç¼ºä¹è‰¯å¥½çš„ç»“æ„è€Œä¸æ˜“äºè¿›è¡Œæ›´æ”¹ï¼Œé‚£å°±å…ˆé‡æ„é‚£ä¸ªç¨‹åºï¼Œä½¿å…¶æ¯”è¾ƒå®¹æ˜“æ·»åŠ è¯¥ç‰¹æ€§ï¼Œç„¶åå†æ·»åŠ è¯¥ç‰¹æ€§ã€‚</li><li>éœ€æ±‚çš„å˜åŒ–ä½¿é‡æ„å˜å¾—å¿…è¦ã€‚å¦‚æœä¸€æ®µä»£ç èƒ½æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”ä¸ä¼šå†è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥ä¸å»é‡æ„å®ƒã€‚</li><li>é‡æ„çš„ç¬¬ä¸€æ­¥ï¼šç¡®ä¿å³å°†è¢«ä¿®æ”¹çš„ä»£ç æ‹¥æœ‰ä¸€ç»„å¯é çš„æµ‹è¯•ã€‚è¿™äº›æµ‹è¯•å¿…é¡»æœ‰è‡ªæˆ‘æ£€éªŒèƒ½åŠ›ã€‚</li><li>æ— è®ºæ¯æ¬¡é‡æ„å¤šä¹ˆç®€å•ï¼Œå…»æˆé‡æ„åå³è¿è¡Œæµ‹è¯•çš„ä¹ æƒ¯éå¸¸é‡è¦ã€‚</li><li>å¯¹äºé‡æ„è¿‡ç¨‹çš„æ€§èƒ½é—®é¢˜çš„å¤„ç†ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥å¿½ç•¥å®ƒã€‚å¦‚æœé‡æ„å¼•å…¥äº†æ€§èƒ½æŸè€—ï¼Œå…ˆå®Œæˆé‡æ„ï¼Œå†åšæ€§èƒ½ä¼˜åŒ–ã€‚</li><li>ç¼–ç¨‹æ—¶ï¼Œéœ€è¦éµå¾ªè¥åœ°æ³•åˆ™ï¼šä¿è¯ä½ ç¦»å¼€æ—¶çš„ä»£ç åº“ä¸€å®šæ¯”æ¥æ—¶æ›´å¥åº·ã€‚</li><li>å¥½ä»£ç çš„æ£€éªŒæ ‡å‡†å°±æ˜¯äººä»¬æ˜¯å¦èƒ½è½»è€Œæ˜“ä¸¾åœ°ä¿®æ”¹å®ƒã€‚</li></ol><h2 id="ç¬¬2ç« -é‡æ„çš„åŸåˆ™"><a href="#ç¬¬2ç« -é‡æ„çš„åŸåˆ™" class="headerlink" title="ç¬¬2ç«  é‡æ„çš„åŸåˆ™"></a>ç¬¬2ç«  é‡æ„çš„åŸåˆ™</h2><ol><li>é‡æ„(åè¯)ï¼šå¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„ä¸€ç§è°ƒæ•´ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œæé«˜å…¶å¯ç†è§£æ€§ï¼Œé™ä½å…¶ä¿®æ”¹æˆæœ¬ã€‚</li><li>é‡æ„(åŠ¨è¯)ï¼šä½¿ç”¨ä¸€ç³»åˆ—é‡æ„æ‰‹æ³•ï¼Œåœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œè°ƒæ•´å…¶ç»“æ„ã€‚</li><li>å¦‚æœæœ‰äººè¯´ä»–ä»¬çš„ä»£ç åœ¨é‡æ„è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸¤å¤©æ—¶é—´ä¸å¯ç”¨ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šï¼Œä»–ä»¬åœ¨åšçš„äº‹ä¸æ˜¯é‡æ„ã€‚</li><li>â€œç»“æ„è°ƒæ•´â€(restructuring)æ³›æŒ‡å¯¹ä»£ç åº“è¿›è¡Œçš„å„ç§å½¢å¼çš„é‡æ–°ç»„ç»‡æˆ–æ¸…ç†ï¼Œé‡æ„åˆ™æ˜¯ç‰¹å®šçš„ä¸€ç±»ç»“æ„è°ƒæ•´ã€‚</li><li>ä½¿ç”¨é‡æ„æŠ€æœ¯å¼€å‘è½¯ä»¶æ—¶ï¼Œæ·»åŠ æ–°åŠŸèƒ½å’Œé‡æ„ï¼ŒåŒä¸€æ—¶é—´ï¼ŒäºŒè€…åªèƒ½åšå…¶ä¸€ã€‚</li><li>ä¸ºä½•é‡æ„ï¼šé‡æ„æ”¹è¿›è½¯ä»¶çš„è®¾è®¡ï¼›é‡æ„ä½¿è½¯ä»¶æ›´å®¹æ˜“ç†è§£ï¼›é‡æ„å¸®åŠ©æ‰¾åˆ°bugï¼›é‡æ„æé«˜ç¼–ç¨‹é€Ÿåº¦ã€‚</li><li>ä½•æ—¶é‡æ„ï¼šé¢„å¤‡æ€§é‡æ„(æ·»åŠ æ–°åŠŸèƒ½ä¹‹å‰é‡æ„)ï¼›å¸®åŠ©ç†è§£çš„é‡æ„(æå‡ä»£ç é˜…è¯»æ€§)ï¼›æ¡åƒåœ¾å¼é‡æ„(æ¶ˆé™¤ä»£ç å†—ä½™ç­‰)ï¼›æœ‰è®¡åˆ’çš„é‡æ„(å›ºå®šå‘¨æœŸå¯¹ä¹‹å‰å†™è¿‡çš„ä»£ç é‡æ„)å’Œè§æœºè¡Œäº‹çš„é‡æ„(å†™æ–°ä»£ç è¿‡ç¨‹ä¸­å‘ç°å…¶ä»–ä»£ç éœ€è¦é‡æ„)ï¼›é•¿æœŸé‡æ„(æ›´æ–°ä¸‰æ–¹åº“ç­‰)ï¼›ä»£ç å¤å®¡æ—¶é‡æ„ã€‚</li><li>ä¸å¿…å°†é‡æ„ä¸æ·»åŠ æ–°åŠŸèƒ½åœ¨ç‰ˆæœ¬æ§åˆ¶çš„æäº¤ä¸­åˆ†å¼€ã€‚åŸå› ï¼šé‡æ„å¸¸å› æ–°åŠŸèƒ½æ‰€è‡´ï¼Œå•ç‹¬æäº¤è„±ç¦»é‡æ„çš„ä¸Šä¸‹æ–‡ï¼Œä½“ç°ä¸å‡ºä¸ºä½•éœ€è¦é‡æ„ï¼›é‡æ„çš„ä»£ç å’Œæ–°åŠŸèƒ½ä»£ç é«˜è€¦åˆã€‚</li><li>å¦‚æœç»ç†ä¸èƒ½æ¥å—ä»£ç é‡æ„éœ€è¦èŠ±æ—¶é—´ï¼Œé‚£å°±ä¸è¦ç»™ç»ç†è¯´ã€‚</li><li>ä½•æ—¶ä¸åº”è¯¥é‡æ„ï¼šå‡Œä¹±ä¸”ä¸éœ€è¦ä¿®æ”¹çš„ä»£ç ï¼›é‡å†™æ¯”é‡æ„æ›´å®¹æ˜“çš„ä»£ç ã€‚</li><li>é‡æ„çš„æŒ‘æˆ˜ï¼šå»¶ç¼“æ–°åŠŸèƒ½å¼€å‘ï¼›ä»£ç æ‰€æœ‰æƒ(ä»£ç æ˜¯å…¶ä»–éƒ¨é—¨å†™çš„)ï¼›åˆ†æ”¯(å¤šåˆ†æ”¯å¼€å‘ï¼Œæœ€ååˆå¹¶ä»£ç )ï¼›æµ‹è¯•(ä»£ç æµ‹è¯•ä¸å®Œå–„ï¼Œæ— æ³•ä¿è¯é‡æ„åä¸å¼•å…¥æ–°BUG)ï¼›é—ç•™ä»£ç ï¼›æ•°æ®åº“(æ”¹å­—æ®µå€¼)ã€‚</li><li>é‡æ„çš„å”¯ä¸€ç›®çš„å°±æ˜¯è®©æˆ‘ä»¬å¼€å‘æ›´å¿«ï¼Œç”¨æ›´å°‘çš„å·¥ä½œé‡åˆ›é€ æ›´å¤§çš„ä»·å€¼ã€‚</li><li>â€œå†™ä»£ç ä¹‹å‰å°±å®Œæˆè½¯ä»¶çš„è®¾è®¡å’Œæ¶æ„â€è¿™ä¸ªæ€æƒ³æ˜¯ä¸æ­£ç¡®çš„ã€‚å› ä¸ºéœ€æ±‚ä¼šå˜ï¼Œä¸”ä¸€å¼€å§‹çš„è€ƒè™‘è€Œä¸æ˜¯å®Œå…¨çš„å‘¨å…¨ã€‚</li><li>ä¸‰å¤§å®è·µï¼šè‡ªæµ‹è¯•ä»£ç ã€æŒç»­é›†æˆã€é‡æ„ã€‚</li><li>ç”¨æ€§èƒ½æµ‹è¯•å·¥å…·å»å®šä½æ€§èƒ½é—®é¢˜ï¼Œè€Œä¸æ˜¯æ ¹æ®å¯¹ä»£ç çš„äº†è§£æ¥çŒœæµ‹ã€‚</li><li>ä¸€äº›è¯­è¨€(Javaã€C#ç­‰)å¯ä»¥å€ŸåŠ©å·¥å…·è¿›è¡Œè‡ªåŠ¨åŒ–çš„é‡æ„ã€‚</li></ol><h2 id="ç¬¬3ç« -ä»£ç çš„åå‘³é“"><a href="#ç¬¬3ç« -ä»£ç çš„åå‘³é“" class="headerlink" title="ç¬¬3ç«  ä»£ç çš„åå‘³é“"></a>ç¬¬3ç«  ä»£ç çš„åå‘³é“</h2><ol><li>å½“ä½ â€é—»åˆ°â€ä»£ç ä¸­æœ‰åå‘³é“æ—¶ï¼Œå°±è¡¨æ˜ä»£ç éœ€è¦è¿›è¡Œé‡æ„äº†ã€‚</li><li>å½“ä½ æ„Ÿè§‰éœ€è¦æ’°å†™æ³¨é‡Šæ—¶ï¼Œè¯·å…ˆå°è¯•é‡æ„ï¼Œè¯•ç€è®©æ‰€æœ‰æ³¨é‡Šéƒ½å˜å¾—å¤šä½™ã€‚</li><li>ç¥ç§˜å‘½åã€‚</li><li>é‡å¤ä»£ç ã€‚</li><li>è¿‡é•¿å‡½æ•°ã€‚</li><li>è¿‡é•¿å‚æ•°åˆ—è¡¨ã€‚</li><li>å…¨å±€æ•°æ®ã€‚(PSï¼šæ…ç”¨å•ä¾‹æ¨¡å¼)</li><li>å¯å˜æ•°æ®(å¦‚åœ¨jsä¸­ä½¿ç”¨Immutable.js)ã€‚</li><li>å‘æ•£å¼å˜åŒ–(è¿èƒŒäº†å•ä¸€èŒè´£åŸåˆ™)ã€‚</li><li>éœ°å¼¹å¼ä¿®æ”¹(éœ€æ±‚å˜åŒ–æ˜¯ï¼Œéœ€è¦åœ¨å¾ˆå¤šä¸ªåœ°æ–¹åšä¿®æ”¹ã€‚å°è£…æ€§ä¸å¤Ÿå¥½)ã€‚</li><li>ä¾æ‹æƒ…ç»“(è¿èƒŒäº†ä¾èµ–å€’ç½®åŸåˆ™)ã€‚</li><li>æ•°æ®æ³¥å›¢(å¾ˆå¤šç±»ä¸­çš„å˜é‡åç›¸åŒï¼Œè€ƒè™‘æŠ½è±¡å‡ºåŸºç±»)ã€‚</li><li>åŸºæœ¬ç±»å‹åæ‰§(é’ˆå¯¹é—®é¢˜åŸŸå®šä¹‰æ–°çš„ç±»å‹è€Œä¸æ˜¯ç”¨åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚å®šä¹‰åæ ‡ç±»ï¼Œè€Œä¸æ˜¯ç”¨std::pair)ã€‚</li><li>é‡å¤çš„switchã€‚</li><li>å¾ªç¯è¯­å¥ã€‚</li><li>å†—èµ˜çš„å…ƒç´ (æœ‰äº›ç±»ç»“æ„æ˜¯ä¸å¿…è¦çš„)ã€‚</li><li>å¤¸å¤¸å…¶è°ˆé€šç”¨æ€§ã€‚</li><li>ä¸´æ—¶å­—æ®µ(ç±»å†…éƒ¨æŸä¸ªå­—æ®µä»…ä¸ºæŸç§ç‰¹å®šæƒ…å†µè€Œè®¾)ã€‚</li><li>è¿‡é•¿çš„æ¶ˆæ¯é“¾ã€‚</li><li>ä¸­é—´äºº(è¿‡åº¦ä½¿ç”¨å§”æ‰˜)ã€‚</li><li>å†…å¹•äº¤æ˜“(ç”¨å§”æ‰˜æ›¿ä»£ç»§æ‰¿ç­‰)ã€‚</li><li>è¿‡å¤§çš„ç±»ã€‚</li><li>å¼‚æ›²åŒå·¥çš„ç±»ã€‚</li><li>çº¯æ•°æ®ç±»(ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹è€Œä¸æ˜¯é¢å‘è¿‡ç¨‹)ã€‚</li><li>è¢«æ‹’ç»çš„é—èµ (å­ç±»å¤ç”¨äº†è¶…ç±»çš„å®ç°ï¼Œå´åˆä¸æ„¿æ„æ”¯æŒè¶…ç±»çš„æ¥å£ï¼Œé‚£å°±ä¸è¦ç”¨ç»§æ‰¿)ã€‚</li><li>æ³¨é‡Š(è¿‡é•¿çš„æ³¨é‡Š)ã€‚</li></ol><h2 id="ç¬¬4ç« -æ„ç­‘æµ‹è¯•ä½“ç³»"><a href="#ç¬¬4ç« -æ„ç­‘æµ‹è¯•ä½“ç³»" class="headerlink" title="ç¬¬4ç«  æ„ç­‘æµ‹è¯•ä½“ç³»"></a>ç¬¬4ç«  æ„ç­‘æµ‹è¯•ä½“ç³»</h2><ol><li>ç¨³å›ºçš„æµ‹è¯•é›†åˆæ˜¯æ­£ç¡®åœ°è¿›è¡Œé‡æ„çš„å‰ææ¡ä»¶ä¹‹ä¸€ã€‚</li><li>ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œè®©å®ƒä»¬æ£€æŸ¥è‡ªå·±çš„æµ‹è¯•ç»“æœã€‚</li><li>ä¸€å¥—æµ‹è¯•å°±æ˜¯ä¸€ä¸ªå¼ºå¤§çš„bugä¾¦æµ‹å™¨ï¼Œèƒ½å¤Ÿå¤§å¤§ç¼©å‡æŸ¥æ‰¾bugæ‰€éœ€çš„æ—¶é—´ã€‚</li><li>æµ‹è¯•é©±åŠ¨å¼€å‘çš„ç¼–ç¨‹æ–¹å¼ä¾èµ–äºä¸‹é¢è¿™ä¸ªçŸ­å¾ªç¯ï¼šå…ˆç¼–å†™ä¸€ä¸ªï¼ˆå¤±è´¥çš„ï¼‰æµ‹è¯•ï¼Œç¼–å†™ä»£ç ä½¿æµ‹è¯•é€šè¿‡ï¼Œç„¶åè¿›è¡Œé‡æ„ä»¥ä¿è¯ä»£ç æ•´æ´ã€‚</li><li>æ€»æ˜¯ç¡®ä¿æµ‹è¯•ä¸è¯¥é€šè¿‡æ—¶çœŸçš„ä¼šå¤±è´¥ã€‚</li><li>é¢‘ç¹åœ°è¿è¡Œæµ‹è¯•ã€‚å¯¹äºä½ æ­£åœ¨å¤„ç†çš„ä»£ç ï¼Œä¸å…¶å¯¹åº”çš„æµ‹è¯•è‡³å°‘æ¯éš”å‡ åˆ†é’Ÿå°±è¦è¿è¡Œä¸€æ¬¡ï¼Œæ¯å¤©è‡³å°‘è¿è¡Œä¸€æ¬¡æ‰€æœ‰çš„æµ‹è¯•ã€‚</li><li>ç¼–å†™æœªè‡»å®Œå–„çš„æµ‹è¯•å¹¶ç»å¸¸è¿è¡Œï¼Œå¥½è¿‡å¯¹å®Œç¾æµ‹è¯•çš„æ— å°½ç­‰å¾…ã€‚</li><li>è€ƒè™‘å¯èƒ½å‡ºé”™çš„è¾¹ç•Œæ¡ä»¶ï¼ŒæŠŠæµ‹è¯•ç«åŠ›é›†ä¸­åœ¨é‚£å„¿ã€‚</li><li>å¦‚æœé”™è¯¯ä¼šå¯¼è‡´è„æ•°æ®åœ¨åº”ç”¨ä¸­åˆ°å¤„ä¼ é€’ï¼Œæˆ–æ˜¯äº§ç”Ÿä¸€äº›å¾ˆéš¾è°ƒè¯•çš„å¤±è´¥ï¼Œè€ƒè™‘å¼•å…¥æ–­è¨€æ‰‹æ³•ï¼Œä½¿ä»£ç ä¸æ»¡è¶³é¢„è®¾æ¡ä»¶æ—¶å¿«é€Ÿå¤±è´¥ã€‚ä¸ç”¨ä¸ºè¿™æ ·çš„å¤±è´¥æ–­è¨€æ·»åŠ æµ‹è¯•ï¼Œå®ƒä»¬æœ¬èº«å°±æ˜¯ä¸€ç§æµ‹è¯•çš„å½¢å¼ã€‚</li><li>ä¸è¦å› ä¸ºæµ‹è¯•æ— æ³•æ•æ‰æ‰€æœ‰çš„bugå°±ä¸å†™æµ‹è¯•ï¼Œå› ä¸ºæµ‹è¯•çš„ç¡®å¯ä»¥æ•æ‰åˆ°å¤§å¤šæ•°bugã€‚</li><li>æ¯å½“ä½ æ”¶åˆ°bugæŠ¥å‘Šï¼Œè¯·å…ˆå†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¥æš´éœ²è¿™ä¸ªbugã€‚</li></ol><h2 id="ç¬¬5ç« -ä»‹ç»é‡æ„åå½•"><a href="#ç¬¬5ç« -ä»‹ç»é‡æ„åå½•" class="headerlink" title="ç¬¬5ç«  ä»‹ç»é‡æ„åå½•"></a>ç¬¬5ç«  ä»‹ç»é‡æ„åå½•</h2><ol><li>ä¹¦çš„å‰©ä½™éƒ¨åˆ†æ˜¯é‡æ„æ–¹æ³•çš„ç´¢å¼•ï¼Œä½œä¸ºå‚çœ‹ä¹¦æ¥ä½¿ç”¨ã€‚</li></ol><h2 id="ç¬¬6ç« -ç¬¬ä¸€ç»„é‡æ„"><a href="#ç¬¬6ç« -ç¬¬ä¸€ç»„é‡æ„" class="headerlink" title="ç¬¬6ç«  ç¬¬ä¸€ç»„é‡æ„"></a>ç¬¬6ç«  ç¬¬ä¸€ç»„é‡æ„</h2><ol><li>æç‚¼å‡½æ•° vs å†…è”å‡½æ•°ã€‚</li><li>æç‚¼å˜é‡ vs å†…è”å˜é‡ã€‚</li><li>æ”¹å˜å‡½æ•°å£°æ˜ã€‚</li><li>å°è£…å˜é‡ã€‚</li><li>å˜é‡æ”¹åã€‚</li><li>å¼•å…¥å‚æ•°å¯¹è±¡ã€‚</li><li>å‡½æ•°ç»„åˆæˆç±»v</li><li>å‡½æ•°ç»„åˆæˆå˜æ¢ã€‚</li><li>æ‹†åˆ†é˜¶æ®µã€‚</li></ol><h2 id="ç¬¬7ç« -å°è£…"><a href="#ç¬¬7ç« -å°è£…" class="headerlink" title="ç¬¬7ç«  å°è£…"></a>ç¬¬7ç«  å°è£…</h2><ol><li>å°è£…è®°å½•ã€‚</li><li>å°è£…é›†åˆã€‚</li><li>ä»¥å¯¹è±¡å–ä»£åŸºæœ¬ç±»å‹ã€‚</li><li>ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡ã€‚</li><li>æç‚¼ç±» vs å†…è”ç±»ã€‚</li><li>éšè—å§”æ‰˜å…³ç³» vs ç§»é™¤ä¸­é—´äººã€‚</li><li>æ›¿æ¢ç®—æ³•ã€‚</li></ol><h2 id="ç¬¬8ç« -æ¬ç§»ç‰¹æ€§"><a href="#ç¬¬8ç« -æ¬ç§»ç‰¹æ€§" class="headerlink" title="ç¬¬8ç«  æ¬ç§»ç‰¹æ€§"></a>ç¬¬8ç«  æ¬ç§»ç‰¹æ€§</h2><ol><li>æ¬ç§»å‡½æ•°ã€‚</li><li>æ¬ç§»å­—æ®µã€‚</li><li>æ¬ç§»è¯­å¥åˆ°å‡½æ•° vs æ¬ç§»è¯­å¥åˆ°è°ƒç”¨è€…ã€‚</li><li>ç§»åŠ¨è¯­å¥ã€‚</li><li>æ‹†åˆ†å¾ªç¯ã€‚</li><li>ä»¥ç®¡é“å–ä»£å¾ªç¯ã€‚</li><li>ç§»é™¤æ­»ä»£ç ã€‚</li></ol><h2 id="ç¬¬9ç« -é‡æ–°ç»„ç»‡æ•°æ®"><a href="#ç¬¬9ç« -é‡æ–°ç»„ç»‡æ•°æ®" class="headerlink" title="ç¬¬9ç«  é‡æ–°ç»„ç»‡æ•°æ®"></a>ç¬¬9ç«  é‡æ–°ç»„ç»‡æ•°æ®</h2><ol><li>æ‹†åˆ†å˜é‡ã€‚</li><li>å­—æ®µæ”¹åã€‚</li><li>ä»¥æŸ¥è¯¢å–ä»£æ´¾ç”Ÿå˜é‡ã€‚</li><li>å°†å¼•ç”¨å¯¹è±¡æ”¹ä¸ºå€¼å¯¹è±¡ vs å°†å€¼å¯¹è±¡æ”¹ä¸ºå¼•ç”¨å¯¹è±¡ã€‚</li></ol><h2 id="ç¬¬10ç« -ç®€åŒ–æ¡ä»¶é€»è¾‘"><a href="#ç¬¬10ç« -ç®€åŒ–æ¡ä»¶é€»è¾‘" class="headerlink" title="ç¬¬10ç«  ç®€åŒ–æ¡ä»¶é€»è¾‘"></a>ç¬¬10ç«  ç®€åŒ–æ¡ä»¶é€»è¾‘</h2><ol><li>åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ vs åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ã€‚</li><li>ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼(Replace Nested Conditional with Guard Clauses)ã€‚</li><li>ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ã€‚</li><li>å¼•å…¥ç‰¹ä¾‹ã€‚</li><li>å¼•å…¥æ–­è¨€ã€‚</li></ol><h2 id="ç¬¬11ç« -é‡æ„API"><a href="#ç¬¬11ç« -é‡æ„API" class="headerlink" title="ç¬¬11ç«  é‡æ„API"></a>ç¬¬11ç«  é‡æ„API</h2><ol><li>å°†æŸ¥è¯¢å‡½æ•°å’Œä¿®æ”¹å‡½æ•°åˆ†ç¦»ã€‚</li><li>å‡½æ•°å‚æ•°åŒ–ã€‚</li><li>ç§»é™¤æ ‡è®°å‚æ•°ã€‚</li><li>ä¿æŒå¯¹è±¡å®Œæ•´ã€‚</li><li>ä»¥æŸ¥è¯¢å–ä»£å‚æ•° vs ä»¥å‚æ•°å–ä»£æŸ¥è¯¢ã€‚</li><li>ç§»é™¤è®¾å€¼å‡½æ•°ã€‚</li><li>ä»¥å·¥å‚å‡½æ•°å–ä»£æ„é€ å‡½æ•°ã€‚</li><li>ä»¥å‘½ä»¤å–ä»£å‡½æ•° vs ä»¥å‡½æ•°å–ä»£å‘½ä»¤ã€‚</li></ol><h2 id="ç¬¬12ç« -å¤„ç†ç»§æ‰¿å…³ç³»"><a href="#ç¬¬12ç« -å¤„ç†ç»§æ‰¿å…³ç³»" class="headerlink" title="ç¬¬12ç«  å¤„ç†ç»§æ‰¿å…³ç³»"></a>ç¬¬12ç«  å¤„ç†ç»§æ‰¿å…³ç³»</h2><ol><li>å‡½æ•°ä¸Šç§» vs å‡½æ•°ä¸‹ç§»ã€‚</li><li>å­—æ®µä¸Šç§» vs å­—æ®µä¸‹ç§»ã€‚</li><li>æ„é€ å‡½æ•°æœ¬ä½“ä¸Šç§»ã€‚</li><li>ä»¥å­ç±»å–ä»£ç±»å‹ç  vs ç§»é™¤å­ç±»ã€‚</li><li>æç‚¼è¶…ç±»ã€‚</li><li>æŠ˜å ç»§æ‰¿ä½“ç³»ã€‚</li><li>ä»¥å§”æ‰˜å–ä»£å­ç±»ã€‚</li><li>ä»¥å§”æ‰˜å–ä»£è¶…ç±»ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‡æ„ </tag>
            
            <tag> é¢å‘å¯¹è±¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°</title>
      <link href="she-ji-mo-shi-du-shu-bi-ji/"/>
      <url>she-ji-mo-shi-du-shu-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å¼•è¨€"><a href="#ä¸€ã€å¼•è¨€" class="headerlink" title="ä¸€ã€å¼•è¨€"></a>ä¸€ã€å¼•è¨€</h2><h3 id="1-1-è®¾è®¡æ¨¡å¼çš„ç¼–ç›®"><a href="#1-1-è®¾è®¡æ¨¡å¼çš„ç¼–ç›®" class="headerlink" title="1.1 è®¾è®¡æ¨¡å¼çš„ç¼–ç›®"></a>1.1 è®¾è®¡æ¨¡å¼çš„ç¼–ç›®</h3><ol><li><strong>Abstract Factory</strong>: æä¾›äº†ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚</li><li><strong>Adapter</strong>: å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚Adapteræ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚</li><li><strong>Bridge</strong>: å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚</li><li><strong>Builder</strong>: å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</li><li><strong>Chain of Responsibility</strong>: ä¸ºè§£é™¤è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´è€¦åˆï¼Œè€Œä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒã€‚</li><li><strong>Command</strong>: å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ä½ å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯å–æ¶ˆçš„æ“ä½œã€‚</li><li><strong>Composite</strong>: å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ã€‚Compositeä½¿å¾—å®¢æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œå¤åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚</li><li><strong>Decorator</strong>: åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±æ‰©å±•åŠŸèƒ½è€Œè¨€ï¼ŒDecoratoræ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ–¹å¼æ›´ä¸ºçµæ´»ã€‚</li><li><strong>Facade</strong>: ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´ï¼ŒFacadeæ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚</li><li><strong>Factory Method</strong>: å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå°†å“ªä¸€ä¸ªç±»å®ä¾‹åŒ–ã€‚Factory Methodæ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚</li><li><strong>Flyweight</strong>: è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚</li><li><strong>Interpreter</strong>: ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚</li><li><strong>Iterator</strong>: æä¾›äº†ä¸€ä¸ªæ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</li><li><strong>Mediator</strong>: ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾ç¤ºåœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚</li><li><strong>Memento</strong>: åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·ä»¥åå°±å¯å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚</li><li><strong>Observer</strong>: å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä»¥ä¾¿å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨åˆ·æ–°ã€‚</li><li><strong>Prototype</strong>: ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™ä¸ªåŸå‹æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</li><li><strong>Proxy</strong>: ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</li><li><strong>Singleton</strong>: ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚</li><li><strong>State</strong>: å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚å¯¹è±¡çœ‹èµ·æ¥ä¼¼ä¹ä¿®æ”¹äº†å®ƒæ‰€å±çš„ç±»ã€‚</li><li><strong>Strategy</strong>: å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ã€‚æœ¬æ¨¡å¼ä½¿å¾—ç®—æ³•çš„å˜åŒ–å¯ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ã€‚</li><li><strong>Template Method</strong>: å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚Template Methodä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</li><li><strong>Visitor</strong>: è¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œã€‚å®ƒä½¿ä½ å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ çš„ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œã€‚</li></ol><h3 id="1-2-ç»„ç»‡ç¼–ç›®"><a href="#1-2-ç»„ç»‡ç¼–ç›®" class="headerlink" title="1.2 ç»„ç»‡ç¼–ç›®"></a>1.2 ç»„ç»‡ç¼–ç›®</h3><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è®¾è®¡æ¨¡å¼ç©ºé—´.png" alt="è®¾è®¡æ¨¡å¼ç©ºé—´"></p><h3 id="1-3-æ€æ ·é€‰æ‹©è®¾è®¡æ¨¡å¼"><a href="#1-3-æ€æ ·é€‰æ‹©è®¾è®¡æ¨¡å¼" class="headerlink" title="1.3 æ€æ ·é€‰æ‹©è®¾è®¡æ¨¡å¼"></a>1.3 æ€æ ·é€‰æ‹©è®¾è®¡æ¨¡å¼</h3><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è®¾è®¡æ¨¡å¼æ‰€æ”¯æŒçš„è®¾è®¡çš„å¯å˜æ–¹é¢.png" alt="è®¾è®¡æ¨¡å¼æ‰€æ”¯æŒçš„è®¾è®¡çš„å¯å˜æ–¹é¢"></p><hr><h2 id="äºŒã€åˆ›å»ºå‹æ¨¡å¼"><a href="#äºŒã€åˆ›å»ºå‹æ¨¡å¼" class="headerlink" title="äºŒã€åˆ›å»ºå‹æ¨¡å¼"></a>äºŒã€åˆ›å»ºå‹æ¨¡å¼</h2><h3 id="2-1-Abstract-Factory-æŠ½è±¡å·¥å‚"><a href="#2-1-Abstract-Factory-æŠ½è±¡å·¥å‚" class="headerlink" title="2.1 Abstract Factory(æŠ½è±¡å·¥å‚)"></a>2.1 Abstract Factory(æŠ½è±¡å·¥å‚)</h3><h4 id="2-1-1-ç±»å›¾"><a href="#2-1-1-ç±»å›¾" class="headerlink" title="2.1.1 ç±»å›¾"></a>2.1.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/æŠ½è±¡å·¥å‚ç±»å›¾.png" alt="æŠ½è±¡å·¥å‚ç±»å›¾"></p><h4 id="2-1-2-å‚ä¸è€…"><a href="#2-1-2-å‚ä¸è€…" class="headerlink" title="2.1.2 å‚ä¸è€…"></a>2.1.2 å‚ä¸è€…</h4><p>AbstractFactory</p><ol><li>å£°æ˜ä¸€ä¸ªåˆ›å»ºæŠ½è±¡äº§å“å¯¹è±¡çš„æ“ä½œæ¥å£ã€‚</li></ol><p>ConcreteFactory</p><ol><li>å®ç°åˆ›å»ºå…·ä½“äº§å“å¯¹è±¡çš„æ“ä½œã€‚</li></ol><p>AbstractProduct</p><ol><li>ä¸ºä¸€ç±»äº§å“å£°æ˜ä¸€ä¸ªæ¥å£ã€‚</li></ol><p>ConcreteProduct</p><ol><li>å®šä¹‰ä¸€ä¸ªå°†è¢«ç›¸åº”çš„å…·ä½“å·¥å‚åˆ›å»ºçš„äº§å“å¯¹è±¡ã€‚</li><li>å®ç°AbstractProductæ¥å£ã€‚</li></ol><p>Client</p><ol><li>ä»…ä½¿ç”¨ç”±AbstractFactoryå’ŒAbstractProductç±»å£°æ˜çš„æ¥å£ã€‚</li></ol><h4 id="2-1-3-åä½œ"><a href="#2-1-3-åä½œ" class="headerlink" title="2.1.3 åä½œ"></a>2.1.3 åä½œ</h4><ol><li>é€šå¸¸åœ¨è¿è¡Œæ—¶åˆ»åˆ›å»ºä¸€ä¸ªConcreteFactoryç±»çš„å®ä¾‹ã€‚è¿™ä¸€å…·ä½“çš„å·¥å‚åˆ›å»ºå…·æœ‰ç‰¹å®šå®ç°çš„äº§å“å¯¹è±¡ã€‚ä¸ºåˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡ï¼Œå®¢æˆ·åº”ä½¿ç”¨ä¸åŒçš„å…·ä½“å·¥ç¨‹ã€‚</li><li>AbstractFactoryå°†äº§å“å¯¹è±¡çš„åˆ›å»ºå»¶è¿Ÿåˆ°å®ƒçš„ConcreteFactoryå­ç±»ã€‚</li></ol><h3 id="2-2-Builder-ç”Ÿæˆå™¨"><a href="#2-2-Builder-ç”Ÿæˆå™¨" class="headerlink" title="2.2 Builder(ç”Ÿæˆå™¨)"></a>2.2 Builder(ç”Ÿæˆå™¨)</h3><h4 id="2-2-1-ç±»å›¾"><a href="#2-2-1-ç±»å›¾" class="headerlink" title="2.2.1 ç±»å›¾"></a>2.2.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ç”Ÿæˆå™¨ç±»å›¾.png" alt="ç”Ÿæˆå™¨ç±»å›¾"></p><h4 id="2-2-2-å‚ä¸è€…"><a href="#2-2-2-å‚ä¸è€…" class="headerlink" title="2.2.2 å‚ä¸è€…"></a>2.2.2 å‚ä¸è€…</h4><p>Builder</p><ol><li>ä¸ºåˆ›å»ºä¸€ä¸ªProductå¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šæŠ½è±¡æ¥å£ã€‚</li></ol><p>ConcreteBuilder</p><ol><li>å®ç°Builderçš„æ¥å£ä»¥æ„é€ å’Œè£…é…è¯¥äº§å“çš„å„ä¸ªéƒ¨ä»¶ã€‚</li><li>å®šä¹‰å¹¶æ˜ç¡®å®ƒæ‰€åˆ›å»ºçš„è¡¨ç¤ºã€‚</li><li>æä¾›ä¸€ä¸ªæ£€ç´¢äº§å“çš„æ¥å£ã€‚</li></ol><p>Director</p><ol><li>æ„é€ ä¸€ä¸ªä½¿ç”¨Builderæ¥å£çš„å¯¹è±¡ã€‚</li></ol><p>Product</p><ol><li>è¡¨ç¤ºè¢«æ„é€ çš„å¤æ‚å¯¹è±¡ã€‚ConcreteBuilderåˆ›å»ºè¯¥äº§å“çš„å†…éƒ¨è¡¨ç¤ºå¹¶å®šä¹‰å®ƒçš„è£…é…è¿‡ç¨‹ã€‚</li><li>åŒ…å«å®šä¹‰ç»„æˆéƒ¨ä»¶çš„ç±»ï¼ŒåŒ…æ‹¬å°†è¿™äº›éƒ¨ä»¶è£…é…æˆæœ€ç»ˆäº§å“çš„æ¥å£ã€‚</li></ol><h4 id="2-2-3-åä½œ"><a href="#2-2-3-åä½œ" class="headerlink" title="2.2.3 åä½œ"></a>2.2.3 åä½œ</h4><ol><li>å®¢æˆ·åˆ›å»ºDirectorå¯¹è±¡ï¼Œå¹¶ç”¨å®ƒæ‰€æƒ³è¦çš„Builderå¯¹è±¡è¿›è¡Œé…ç½®ã€‚</li><li>ä¸€æ—¦äº§å“éƒ¨ä»¶è¢«ç”Ÿæˆï¼Œå¯¼å‘å™¨å°±ä¼šé€šçŸ¥ç”Ÿæˆå™¨ã€‚</li><li>ç”Ÿæˆå™¨å¤„ç†å¯¼å‘å™¨çš„è¯·æ±‚ï¼Œå¹¶å°†éƒ¨ä»¶æ·»åŠ åˆ°è¯¥äº§å“ä¸­ã€‚</li><li>å®¢æˆ·ä»ç”Ÿæˆå™¨ä¸­æ£€ç´¢äº§å“ã€‚</li></ol><p>äº¤äº’å›¾</p><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ç”Ÿæˆå™¨åä½œç±»å›¾.png" alt="ç”Ÿæˆå™¨åä½œç±»å›¾"></p><h3 id="2-3-Factory-Method-å·¥å‚æ–¹æ³•"><a href="#2-3-Factory-Method-å·¥å‚æ–¹æ³•" class="headerlink" title="2.3 Factory Method(å·¥å‚æ–¹æ³•)"></a>2.3 Factory Method(å·¥å‚æ–¹æ³•)</h3><h4 id="2-3-1-ç±»å›¾"><a href="#2-3-1-ç±»å›¾" class="headerlink" title="2.3.1 ç±»å›¾"></a>2.3.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/å·¥å‚æ–¹æ³•ç±»å›¾.png" alt="å·¥å‚æ–¹æ³•ç±»å›¾"></p><h4 id="2-3-2-å‚ä¸è€…"><a href="#2-3-2-å‚ä¸è€…" class="headerlink" title="2.3.2 å‚ä¸è€…"></a>2.3.2 å‚ä¸è€…</h4><p>Product</p><ol><li>å®šä¹‰å·¥å‚æ–¹æ³•æ‰€åˆ›å»ºçš„å¯¹è±¡çš„æ¥å£ã€‚</li></ol><p>ConcreteProduct</p><ol><li>å®ç°Productæ¥å£ã€‚</li></ol><p>Creator</p><ol><li>å£°æ˜å·¥å‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªProductç±»å‹çš„å¯¹è±¡ã€‚Creatorä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªå·¥å‚æ–¹æ³•çš„ç¼ºçœå®ç°ï¼Œå®ƒè¿”å›ä¸€ä¸ªç¼ºçœçš„ConcreteProductå¯¹è±¡ã€‚</li><li>ä¹Ÿå¯ä»¥è°ƒç”¨å·¥å‚æ–¹æ³•ä»¥åˆ›å»ºä¸€ä¸ªProductå¯¹è±¡ã€‚</li></ol><p>ConcreteCreator</p><ol><li>é‡å®šä¹‰å·¥å‚æ–¹æ³•ä»¥è¿”å›ä¸€ä¸ªConcreteProductå®ä¾‹ã€‚</li></ol><h4 id="2-3-3-åä½œ"><a href="#2-3-3-åä½œ" class="headerlink" title="2.3.3 åä½œ"></a>2.3.3 åä½œ</h4><ol><li>Creatorä¾èµ–äºå®ƒçš„å­ç±»æ¥å®šä¹‰å·¥å‚æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒè¿”å›ä¸€ä¸ªé€‚å½“çš„ConcreteProductå®ä¾‹ã€‚</li></ol><h3 id="2-4-Prototype-åŸå‹"><a href="#2-4-Prototype-åŸå‹" class="headerlink" title="2.4 Prototype(åŸå‹)"></a>2.4 Prototype(åŸå‹)</h3><h4 id="2-4-1-ç±»å›¾"><a href="#2-4-1-ç±»å›¾" class="headerlink" title="2.4.1 ç±»å›¾"></a>2.4.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/åŸå‹ç±»å›¾.png" alt="åŸå‹ç±»å›¾"></p><h4 id="2-4-2-å‚ä¸è€…"><a href="#2-4-2-å‚ä¸è€…" class="headerlink" title="2.4.2 å‚ä¸è€…"></a>2.4.2 å‚ä¸è€…</h4><p>Prototype</p><ol><li>å£°æ˜ä¸€ä¸ªå…‹éš†è‡ªèº«çš„æ¥å£ã€‚</li></ol><p>ConcretePrototype</p><ol><li>å®ç°ä¸€ä¸ªå…‹éš†è‡ªèº«çš„æ“ä½œã€‚</li></ol><p>Client</p><ol><li>è®©ä¸€ä¸ªåŸå‹å…‹éš†è‡ªèº«ä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li></ol><h4 id="2-4-3-åä½œ"><a href="#2-4-3-åä½œ" class="headerlink" title="2.4.3 åä½œ"></a>2.4.3 åä½œ</h4><ol><li>å®¢æˆ·è¯·æ±‚ä¸€ä¸ªåŸå‹å…‹éš†è‡ªèº«ã€‚</li></ol><h3 id="2-5-Singleton-å•ä»¶"><a href="#2-5-Singleton-å•ä»¶" class="headerlink" title="2.5 Singleton(å•ä»¶)"></a>2.5 Singleton(å•ä»¶)</h3><h4 id="2-5-1-ç±»å›¾"><a href="#2-5-1-ç±»å›¾" class="headerlink" title="2.5.1 ç±»å›¾"></a>2.5.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/å•ä»¶ç±»å›¾.png" alt="å•ä»¶ç±»å›¾"></p><h4 id="2-5-2-å‚ä¸è€…"><a href="#2-5-2-å‚ä¸è€…" class="headerlink" title="2.5.2 å‚ä¸è€…"></a>2.5.2 å‚ä¸è€…</h4><p>Singleton</p><ol><li>å®šä¹‰ä¸€ä¸ªInstanceæ“ä½œï¼Œå…è®¸å®¢æˆ·è®¿é—®å®ƒçš„å”¯ä¸€å®ä¾‹ã€‚Instanceæ˜¯ä¸€ä¸ªç±»æ“ä½œï¼ˆC++ä¸­çš„ä¸€ä¸ªé™æ€æˆå‘˜å‡½æ•°ï¼‰ã€‚</li><li>å¯èƒ½è´Ÿè´£åˆ›å»ºå®ƒè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚</li></ol><h4 id="2-5-3-åä½œ"><a href="#2-5-3-åä½œ" class="headerlink" title="2.5.3 åä½œ"></a>2.5.3 åä½œ</h4><ol><li>å®¢æˆ·åªèƒ½é€šè¿‡Singletonçš„Instanceæ“ä½œè®¿é—®ä¸€ä¸ªSingletonçš„å®ä¾‹ã€‚</li></ol><hr><h2 id="ä¸‰ã€ç»“æ„å‹æ¨¡å¼"><a href="#ä¸‰ã€ç»“æ„å‹æ¨¡å¼" class="headerlink" title="ä¸‰ã€ç»“æ„å‹æ¨¡å¼"></a>ä¸‰ã€ç»“æ„å‹æ¨¡å¼</h2><h3 id="3-1-Adapter-é€‚é…å™¨"><a href="#3-1-Adapter-é€‚é…å™¨" class="headerlink" title="3.1 Adapter(é€‚é…å™¨)"></a>3.1 Adapter(é€‚é…å™¨)</h3><h4 id="3-1-1-ç±»å›¾"><a href="#3-1-1-ç±»å›¾" class="headerlink" title="3.1.1 ç±»å›¾"></a>3.1.1 ç±»å›¾</h4><p>ç±»ç‰ˆæœ¬</p><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/é€‚é…å™¨ç±»ç‰ˆæœ¬ç±»å›¾.png" alt="é€‚é…å™¨ç±»ç‰ˆæœ¬ç±»å›¾"></p><p>å¯¹è±¡ç‰ˆæœ¬</p><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/é€‚é…å™¨å¯¹è±¡ç‰ˆæœ¬ç±»å›¾.png" alt="é€‚é…å™¨å¯¹è±¡ç‰ˆæœ¬ç±»å›¾"></p><h4 id="3-1-2-å‚ä¸è€…"><a href="#3-1-2-å‚ä¸è€…" class="headerlink" title="3.1.2 å‚ä¸è€…"></a>3.1.2 å‚ä¸è€…</h4><p>Target</p><ol><li>å®šä¹‰Clientä½¿ç”¨çš„ä¸ç‰¹å®šé¢†åŸŸç›¸å…³çš„æ¥å£ã€‚</li></ol><p>Client</p><ol><li>ä¸ç¬¦åˆTargetæ¥å£çš„å¯¹è±¡ååŒã€‚</li></ol><p>Adaptee</p><ol><li>å®šä¹‰ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£éœ€è¦é€‚é…ã€‚</li></ol><p>Adapter</p><ol><li>å¯¹Adapteeçš„æ¥å£ä¸Targetæ¥å£è¿›è¡Œé€‚é…ã€‚</li></ol><h4 id="3-1-3-åä½œ"><a href="#3-1-3-åä½œ" class="headerlink" title="3.1.3 åä½œ"></a>3.1.3 åä½œ</h4><ol><li>Clientåœ¨Adapterå®ä¾‹ä¸Šè°ƒç”¨ä¸€äº›æ“ä½œã€‚æ¥ç€é€‚é…å™¨è°ƒç”¨Adapteeçš„æ“ä½œå®ç°è¿™ä¸ªè¯·æ±‚ã€‚</li></ol><h3 id="3-2-Bridge-æ¡¥æ¥"><a href="#3-2-Bridge-æ¡¥æ¥" class="headerlink" title="3.2 Bridge(æ¡¥æ¥)"></a>3.2 Bridge(æ¡¥æ¥)</h3><h4 id="3-2-1-ç±»å›¾"><a href="#3-2-1-ç±»å›¾" class="headerlink" title="3.2.1 ç±»å›¾"></a>3.2.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/æ¡¥æ¥ç±»å›¾.png" alt="æ¡¥æ¥ç±»å›¾"></p><h4 id="3-2-2-å‚ä¸è€…"><a href="#3-2-2-å‚ä¸è€…" class="headerlink" title="3.2.2 å‚ä¸è€…"></a>3.2.2 å‚ä¸è€…</h4><p>Abstraction</p><ol><li>å®šä¹‰æŠ½è±¡ç±»çš„æ¥å£ã€‚</li><li>ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘Implementorç±»å‹å¯¹è±¡çš„æŒ‡é’ˆã€‚</li></ol><p>RefinedAbstraction</p><ol><li>æ‰©å……ç”±Abstractionå®šä¹‰çš„æ¥å£ã€‚</li></ol><p>Implementor</p><ol><li>å®šä¹‰å®ç°ç±»çš„æ¥å£ï¼Œè¯¥æ¥å£ä¸ä¸€å®šè¦ä¸Abstractionçš„æ¥å£å®Œå…¨ä¸€è‡´ï¼›äº‹å®ä¸Šè¿™ä¸¤ä¸ªæ¥å£å¯ä»¥å®Œå…¨ä¸åŒã€‚ä¸€èˆ¬æ¥è®²ï¼ŒImplementoræ¥å£ä»…æä¾›åŸºæœ¬æ“ä½œï¼Œè€ŒAbstractionåˆ™å®šä¹‰äº†åŸºäºè¿™äº›åŸºæœ¬æ“ä½œçš„è¾ƒé«˜å±‚æ¬¡çš„æ“ä½œã€‚</li></ol><p>ConcreteImplementor</p><ol><li>å®ç°Implementoræ¥å£å¹¶å®šä¹‰å®ƒçš„å…·ä½“å®ç°ã€‚</li></ol><h4 id="3-2-3-åä½œ"><a href="#3-2-3-åä½œ" class="headerlink" title="3.2.3 åä½œ"></a>3.2.3 åä½œ</h4><ol><li>Abstractionå°†clientçš„è¯·æ±‚è½¬å‘ç»™å®ƒçš„Implementorå¯¹è±¡ã€‚</li></ol><h3 id="3-3-Composite-ç»„åˆ"><a href="#3-3-Composite-ç»„åˆ" class="headerlink" title="3.3 Composite(ç»„åˆ)"></a>3.3 Composite(ç»„åˆ)</h3><h4 id="3-3-1-ç±»å›¾"><a href="#3-3-1-ç±»å›¾" class="headerlink" title="3.3.1 ç±»å›¾"></a>3.3.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ç»„åˆç±»å›¾.png" alt="ç»„åˆç±»å›¾"></p><h4 id="3-3-2-å‚ä¸è€…"><a href="#3-3-2-å‚ä¸è€…" class="headerlink" title="3.3.2 å‚ä¸è€…"></a>3.3.2 å‚ä¸è€…</h4><p>Component</p><ol><li>ä¸ºç»„åˆä¸­çš„å¯¹è±¡å£°æ˜æ¥å£ã€‚</li><li>åœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œå®ç°æ‰€æœ‰ç±»å…±æœ‰æ¥å£çš„ç¼ºçœè¡Œä¸ºã€‚</li><li>å£°æ˜ä¸€ä¸ªæ¥å£ç”¨äºè®¿é—®å’Œç®¡ç†Componentçš„å­ç»„ä»¶ã€‚</li><li>(å¯é€‰)åœ¨é€’å½’ç»“æ„ä¸­å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè®¿é—®ä¸€ä¸ªçˆ¶ç»„ä»¶ï¼Œå¹¶åœ¨åˆé€‚çš„æƒ…å†µä¸‹å®ç°å®ƒã€‚</li></ol><p>Leaf</p><ol><li>åœ¨ç»„åˆä¸­è¡¨ç¤ºå¶èŠ‚ç‚¹å¯¹è±¡ï¼Œå¶èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ã€‚</li><li>åœ¨ç»„åˆä¸­å®šä¹‰å›¾å…ƒå¯¹è±¡çš„è¡Œä¸ºã€‚</li></ol><p>Composite</p><ol><li>å®šä¹‰æœ‰å­éƒ¨ä»¶çš„é‚£äº›éƒ¨ä»¶çš„è¡Œä¸ºã€‚</li><li>å­˜å‚¨å­éƒ¨ä»¶ã€‚</li><li>åœ¨Componentæ¥å£ä¸­å®ç°ä¸å­éƒ¨ä»¶æœ‰å…³çš„æ“ä½œã€‚</li></ol><p>Client</p><ol><li>é€šè¿‡Componentæ¥å£æ“çºµç»„åˆéƒ¨ä»¶çš„å¯¹è±¡ã€‚</li></ol><h4 id="3-3-3-åä½œ"><a href="#3-3-3-åä½œ" class="headerlink" title="3.3.3 åä½œ"></a>3.3.3 åä½œ</h4><ol><li>ç”¨æˆ·ä½¿ç”¨Componentç±»æ¥å£ä¸ç»„åˆç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚å¦‚æœæ¥æ”¶è€…æ˜¯ä¸€ä¸ªå¶èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥å¤„ç†è¯·æ±‚ã€‚å¦‚æœæ¥æ”¶è€…æ˜¯Compositeï¼Œå®ƒé€šå¸¸å°†è¯·æ±‚å‘é€ç»™å®ƒçš„å­éƒ¨ä»¶ï¼Œåœ¨è½¬å‘è¯·æ±‚ä¹‹å‰ä¸/æˆ–ä¹‹åå¯èƒ½æ‰§è¡Œä¸€äº›è¾…åŠ©æ“ä½œã€‚</li></ol><h3 id="3-4-Decorator-è£…é¥°"><a href="#3-4-Decorator-è£…é¥°" class="headerlink" title="3.4 Decorator(è£…é¥°)"></a>3.4 Decorator(è£…é¥°)</h3><h4 id="3-4-1-ç±»å›¾"><a href="#3-4-1-ç±»å›¾" class="headerlink" title="3.4.1 ç±»å›¾"></a>3.4.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è£…é¥°ç±»å›¾.png" alt="è£…é¥°ç±»å›¾"></p><h4 id="3-4-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"><a href="#3-4-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾" class="headerlink" title="3.4.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></a>3.4.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è£…é¥°å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾.png" alt="è£…é¥°å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></p><h4 id="3-4-3-å‚ä¸è€…"><a href="#3-4-3-å‚ä¸è€…" class="headerlink" title="3.4.3 å‚ä¸è€…"></a>3.4.3 å‚ä¸è€…</h4><p>Component</p><ol><li>å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥å£ï¼Œå¯ä»¥ç»™è¿™äº›å¯¹è±¡åŠ¨æ€åœ°æ·»åŠ èŒè´£ã€‚</li></ol><p>ConcreteComponent</p><ol><li>å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç»™è¿™ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›èŒè´£ã€‚</li></ol><p>Decorator</p><ol><li>ç»´æŒä¸€ä¸ªæŒ‡å‘Componentå¯¹è±¡çš„æŒ‡é’ˆï¼Œå¹¶å®šä¹‰ä¸€ä¸ªä¸Componentæ¥å£ä¸€è‡´çš„æ¥å£ã€‚</li></ol><p>ConcreteDecorator</p><ol><li>å‘ç»„ä»¶æ·»åŠ èŒè´£ã€‚</li></ol><h4 id="3-4-4-åä½œ"><a href="#3-4-4-åä½œ" class="headerlink" title="3.4.4 åä½œ"></a>3.4.4 åä½œ</h4><ol><li>Decoratorå°†è¯·æ±‚è½¬å‘ç»™å®ƒçš„Componentå¯¹è±¡ï¼Œå¹¶æœ‰å¯èƒ½åœ¨è½¬å‘è¯·æ±‚å‰åæ‰§è¡Œä¸€äº›é™„åŠ çš„åŠ¨ä½œã€‚</li></ol><h3 id="3-5-Facade-å¤–è§‚"><a href="#3-5-Facade-å¤–è§‚" class="headerlink" title="3.5 Facade(å¤–è§‚)"></a>3.5 Facade(å¤–è§‚)</h3><h4 id="3-5-1-ç±»å›¾"><a href="#3-5-1-ç±»å›¾" class="headerlink" title="3.5.1 ç±»å›¾"></a>3.5.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/å¤–è§‚ç±»å›¾.png" alt="å¤–è§‚ç±»å›¾"></p><h4 id="3-5-2-å‚ä¸è€…"><a href="#3-5-2-å‚ä¸è€…" class="headerlink" title="3.5.2 å‚ä¸è€…"></a>3.5.2 å‚ä¸è€…</h4><p>Facade</p><ol><li>çŸ¥é“å“ªäº›å­ç³»ç»Ÿç±»è´Ÿè´£å¤„ç†è¯·æ±‚ã€‚</li><li>å°†å®¢æˆ·çš„è¯·æ±‚ä»£ç†ç»™é€‚å½“çš„å­ç³»ç»Ÿå¯¹è±¡ã€‚</li></ol><p>Subsystem classes</p><ol><li>å®ç°å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</li><li>å¤„ç†ç”±Facadeå¯¹è±¡æŒ‡æ´¾çš„ä»»åŠ¡ã€‚</li><li>æ²¡æœ‰facadeçš„ä»»ä½•ç›¸å…³ä¿¡æ¯ï¼›å³æ²¡æœ‰æŒ‡å‘facadeçš„æŒ‡é’ˆã€‚</li></ol><h4 id="3-5-3-åä½œ"><a href="#3-5-3-åä½œ" class="headerlink" title="3.5.3 åä½œ"></a>3.5.3 åä½œ</h4><ol><li>å®¢æˆ·ç¨‹åºé€šè¿‡å‘é€è¯·æ±‚ç»™Facadeçš„æ–¹å¼ä¸å­ç³»ç»Ÿé€šä¿¡ï¼ŒFacadeå°†è¿™äº›æ¶ˆæ¯è½¬å‘ç»™é€‚å½“çš„å­ç³»ç»Ÿå¯¹è±¡ã€‚å°½ç®¡æ˜¯å­ç³»ç»Ÿä¸­çš„æœ‰å…³å¯¹è±¡åœ¨åšå®é™…å·¥ä½œï¼Œä½†Facadeæ¨¡å¼æœ¬èº«ä¹Ÿå¿…é¡»å°†å®ƒçš„æ¥å£è½¬æ¢æˆå­ç³»ç»Ÿçš„æ¥å£ã€‚</li><li>ä½¿ç”¨Facadeçš„å®¢æˆ·ç¨‹åºä¸éœ€è¦ç›´æ¥è®¿é—®å­ç³»ç»Ÿå¯¹è±¡ã€‚</li></ol><h3 id="3-6-Flyweight-äº«å…ƒ"><a href="#3-6-Flyweight-äº«å…ƒ" class="headerlink" title="3.6 Flyweight(äº«å…ƒ)"></a>3.6 Flyweight(äº«å…ƒ)</h3><h4 id="3-6-1-ç±»å›¾"><a href="#3-6-1-ç±»å›¾" class="headerlink" title="3.6.1 ç±»å›¾"></a>3.6.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/äº«å…ƒç±»å›¾.png" alt="äº«å…ƒç±»å›¾"></p><h4 id="3-6-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"><a href="#3-6-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾" class="headerlink" title="3.6.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></a>3.6.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/äº«å…ƒå¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾.png" alt="äº«å…ƒå¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></p><h4 id="3-6-3-å‚ä¸è€…"><a href="#3-6-3-å‚ä¸è€…" class="headerlink" title="3.6.3 å‚ä¸è€…"></a>3.6.3 å‚ä¸è€…</h4><p>Flyweight</p><ol><li>æè¿°ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£flyweightå¯ä»¥æ¥å—å¹¶ä½œç”¨äºå¤–éƒ¨çŠ¶æ€ã€‚</li></ol><p>ConcreteFlyweight</p><ol><li>å®ç°Flyweightæ¥å£ï¼Œå¹¶ä¸ºå†…éƒ¨çŠ¶æ€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å¢åŠ å­˜å‚¨ç©ºé—´ã€‚ConcreteFlyweightå¯¹è±¡å¿…é¡»æ˜¯å¯å…±äº«çš„ã€‚å®ƒæ‰€å­˜å‚¨çš„çŠ¶æ€å¿…é¡»æ˜¯å†…éƒ¨çš„ï¼›å³ï¼Œå®ƒå¿…é¡»ç‹¬ç«‹äºConcreteFlyweightå¯¹è±¡çš„åœºæ™¯ã€‚</li></ol><p>UnsharedConcreteFlyweight</p><ol><li>å¹¶éæ‰€æœ‰çš„Flyweightå­ç±»éƒ½éœ€è¦è¢«å…±äº«ã€‚Flyweightæ¥å£ä½¿å…±äº«æˆä¸ºå¯èƒ½ï¼Œä½†å®ƒå¹¶ä¸å¼ºåˆ¶å…±äº«ã€‚åœ¨Flyweightå¯¹è±¡ç»“æ„çš„æŸäº›å±‚æ¬¡ï¼ŒUnsharedConcreteFlyweightå¯¹è±¡é€šå¸¸å°†ConcreteFlyweightå¯¹è±¡ä½œä¸ºå­èŠ‚ç‚¹ã€‚</li></ol><p>FlyweightFactory</p><ol><li>åˆ›å»ºå¹¶ç®¡ç†flyweightå¯¹è±¡ã€‚</li><li>ç¡®ä¿åˆç†åœ°å…±äº«flyweightã€‚å½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªflyweightæ—¶ï¼ŒFlyweightFactoryå¯¹è±¡æä¾›ä¸€ä¸ªå·²åˆ›å»ºçš„å®ä¾‹æˆ–è€…åˆ›å»ºä¸€ä¸ªï¼ˆå¦‚æœä¸å­˜åœ¨çš„è¯ï¼‰ã€‚</li></ol><p>Client</p><ol><li>ç»´æŒä¸€ä¸ªå¯¹flyweightçš„å¼•ç”¨ã€‚</li><li>è®¡ç®—æˆ–å­˜å‚¨ä¸€ä¸ªï¼ˆå¤šä¸ªï¼‰flyweightçš„å¤–éƒ¨çŠ¶æ€ã€‚</li></ol><h4 id="3-6-4-åä½œ"><a href="#3-6-4-åä½œ" class="headerlink" title="3.6.4 åä½œ"></a>3.6.4 åä½œ</h4><ol><li>flyweightæ‰§è¡Œæ—¶æ‰€éœ€çš„çŠ¶æ€å¿…å®šæ—¶å†…éƒ¨çš„æˆ–å¤–éƒ¨çš„ã€‚å†…éƒ¨çŠ¶æ€å­˜å‚¨äºConcreteFlyweightå¯¹è±¡ä¹‹ä¸­ï¼›è€Œå¤–éƒ¨å¯¹è±¡åˆ™ç”±Clientå¯¹è±¡å­˜å‚¨æˆ–è®¡ç®—ã€‚å½“ç”¨æˆ·è°ƒç”¨flyweightå¯¹è±¡çš„æ“ä½œæ—¶ï¼Œå°†è¯¥çŠ¶æ€ä¼ é€’ç»™å®ƒã€‚</li><li>ç”¨æˆ·ä¸åº”ç›´æ¥å¯¹ConcreteFlyweightç±»è¿›è¡Œå®ä¾‹åŒ–ï¼Œè€Œåªèƒ½ä»FlyeightFactoryå¯¹è±¡å¾—åˆ°ConcreteFlyweightå¯¹è±¡ï¼Œè¿™å¯ä»¥ä¿è¯å¯¹å®ƒä»¬é€‚å½“åœ°è¿›è¡Œå…±äº«ã€‚</li></ol><h3 id="3-7-Proxy-ä»£ç†"><a href="#3-7-Proxy-ä»£ç†" class="headerlink" title="3.7 Proxy(ä»£ç†)"></a>3.7 Proxy(ä»£ç†)</h3><h4 id="3-7-1-ç±»å›¾"><a href="#3-7-1-ç±»å›¾" class="headerlink" title="3.7.1 ç±»å›¾"></a>3.7.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ä»£ç†ç±»å›¾.png" alt="ä»£ç†ç±»å›¾"></p><h4 id="3-7-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"><a href="#3-7-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾" class="headerlink" title="3.7.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></a>3.7.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ä»£ç†å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾.png" alt="ä»£ç†å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></p><h4 id="3-7-3-å‚ä¸è€…"><a href="#3-7-3-å‚ä¸è€…" class="headerlink" title="3.7.3 å‚ä¸è€…"></a>3.7.3 å‚ä¸è€…</h4><p>Proxy</p><ol><li>ä¿æŒä¸€ä¸ªå¼•ç”¨ä½¿å¾—ä»£ç†å¯ä»¥è®¿é—®å®ä½“ã€‚è‹¥RealSubjectå’ŒSubjectçš„æ¥å£ç›¸åŒï¼ŒProxyä¼šå¼•ç”¨Subjectã€‚</li><li>æä¾›ä¸€ä¸ªä¸Subjectçš„æ¥å£ç›¸åŒçš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å°±å¯ä»¥ç”¨æ¥æ›¿ä»£å®ä½“ã€‚</li><li>æ§åˆ¶å¯¹å®ä½“çš„å­˜å–ï¼Œå¹¶å¯èƒ½è´Ÿè´£åˆ›å»ºå’Œåˆ é™¤å®ƒã€‚</li><li><p>å…¶ä»–åŠŸèƒ½ä¾èµ–äºä»£ç†çš„ç±»å‹ï¼š</p><ol><li>Remote Proxyè´Ÿè´£å¯¹è¯·æ±‚åŠå…¶å‚æ•°è¿›è¡Œç¼–ç ï¼Œå¹¶å‘ä¸åŒåœ°å€ç©ºé—´ä¸­çš„å®ä½“å‘é€å·²ç¼–ç çš„è¯·æ±‚ã€‚</li><li>Virtual Proxyå¯ä»¥ç¼“å­˜å®ä½“çš„é™„åŠ ä¿¡æ¯ï¼Œä»¥ä¾¿å»¶è¿Ÿå¯¹å®ƒçš„è®¿é—®ã€‚</li><li>Protection Proxyæ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦å…·æœ‰å®ç°ä¸€ä¸ªè¯·æ±‚æ‰€å¿…é¡»çš„è®¿é—®æƒé™ã€‚</li></ol></li></ol><p>Subject</p><ol><li>å®šä¹‰RealSubjectå’ŒProxyçš„å…±ç”¨æ¥å£ï¼Œè¿™æ ·å°±åœ¨ä»»ä½•ä½¿ç”¨RealSubjectçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨Proxyã€‚</li></ol><p>RealSubject</p><ol><li>å®šä¹‰Proxyæ‰€ä»£è¡¨çš„å®ä½“ã€‚</li></ol><h4 id="3-7-4-åä½œ"><a href="#3-7-4-åä½œ" class="headerlink" title="3.7.4 åä½œ"></a>3.7.4 åä½œ</h4><ol><li>ä»£ç†æ ¹æ®å…¶ç§ç±»ï¼Œåœ¨é€‚å½“çš„æ—¶å€™å‘RealSubjectè½¬å‘è¯·æ±‚ã€‚</li></ol><hr><h2 id="å››ã€è¡Œä¸ºæ¨¡å¼"><a href="#å››ã€è¡Œä¸ºæ¨¡å¼" class="headerlink" title="å››ã€è¡Œä¸ºæ¨¡å¼"></a>å››ã€è¡Œä¸ºæ¨¡å¼</h2><h3 id="4-1-Chain-of-Responsibility-èŒè´£é“¾"><a href="#4-1-Chain-of-Responsibility-èŒè´£é“¾" class="headerlink" title="4.1 Chain of Responsibility(èŒè´£é“¾)"></a>4.1 Chain of Responsibility(èŒè´£é“¾)</h3><h4 id="4-1-1-ç±»å›¾"><a href="#4-1-1-ç±»å›¾" class="headerlink" title="4.1.1 ç±»å›¾"></a>4.1.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/èŒè´£é“¾ç±»å›¾.png" alt="èŒè´£é“¾ç±»å›¾"></p><h4 id="4-1-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"><a href="#4-1-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾" class="headerlink" title="4.1.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></a>4.1.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/èŒè´£é“¾å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾.png" alt="èŒè´£é“¾å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></p><h4 id="4-1-3-å‚ä¸è€…"><a href="#4-1-3-å‚ä¸è€…" class="headerlink" title="4.1.3 å‚ä¸è€…"></a>4.1.3 å‚ä¸è€…</h4><p>Handler</p><ol><li>å®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ã€‚</li><li>ï¼ˆå¯é€‰ï¼‰å®ç°åç»§é“¾ã€‚</li></ol><p>ConcreteHandler</p><ol><li>å¤„ç†å®ƒæ‰€è´Ÿè´£çš„è¯·æ±‚ã€‚</li><li>å¯è®¿é—®å®ƒçš„åç»§è€…ã€‚</li><li>å¦‚æœå¯å¤„ç†è¯¥è¯·æ±‚ï¼Œå°±å¤„ç†ï¼›å¦åˆ™å°†è¯¥è¯·æ±‚è½¬å‘ç»™å®ƒçš„åç»§è€…ã€‚</li></ol><p>Client</p><ol><li>å‘é“¾ä¸Šçš„å…·ä½“å¤„ç†è€…(ConcreteHandler)å¯¹è±¡æäº¤è¯·æ±‚ã€‚</li></ol><h4 id="4-1-4-åä½œ"><a href="#4-1-4-åä½œ" class="headerlink" title="4.1.4 åä½œ"></a>4.1.4 åä½œ</h4><ol><li>å½“å®¢æˆ·æäº¤ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œè¯·æ±‚æ²¿é“¾ä¼ é€’ç›´è‡³æœ‰ä¸€ä¸ªConcreteHandlerå¯¹è±¡è´Ÿè´£å¤„ç†å®ƒã€‚</li></ol><h3 id="4-2-Command-å‘½ä»¤"><a href="#4-2-Command-å‘½ä»¤" class="headerlink" title="4.2 Command(å‘½ä»¤)"></a>4.2 Command(å‘½ä»¤)</h3><h4 id="4-2-1-ç±»å›¾"><a href="#4-2-1-ç±»å›¾" class="headerlink" title="4.2.1 ç±»å›¾"></a>4.2.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/å‘½ä»¤ç±»å›¾.png" alt="å‘½ä»¤ç±»å›¾"></p><h4 id="4-2-2-å‚ä¸è€…"><a href="#4-2-2-å‚ä¸è€…" class="headerlink" title="4.2.2 å‚ä¸è€…"></a>4.2.2 å‚ä¸è€…</h4><p>Command</p><ol><li>å£°æ˜æ‰§è¡Œæ“ä½œçš„æ¥å£ã€‚</li></ol><p>ConcreteCommand</p><ol><li>å°†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡ç»‘å®šäºä¸€ä¸ªåŠ¨ä½œã€‚</li><li>è°ƒç”¨æ¥æ”¶è€…ç›¸åº”çš„æ“ä½œï¼Œä»¥å®ç°Executeã€‚</li></ol><p>Client</p><ol><li>åˆ›å»ºä¸€ä¸ªå…·ä½“å‘½ä»¤å¯¹è±¡å¹¶è®¾å®šå®ƒçš„æ¥æ”¶è€…ã€‚</li></ol><p>Invoker</p><ol><li>è¦æ±‚è¯¥å‘½ä»¤æ‰§è¡Œè¿™ä¸ªè¯·æ±‚ã€‚</li></ol><p>Receiver</p><ol><li>çŸ¥é“å¦‚ä½•å®æ–½ä¸æ‰§è¡Œä¸€ä¸ªè¯·æ±‚ç›¸å…³çš„æ“ä½œã€‚ä»»ä½•ç±»éƒ½å¯èƒ½ä½œä¸ºä¸€ä¸ªæ¥æ”¶è€…ã€‚</li></ol><h4 id="4-2-3-åä½œ"><a href="#4-2-3-åä½œ" class="headerlink" title="4.2.3 åä½œ"></a>4.2.3 åä½œ</h4><ol><li>Clientåˆ›å»ºä¸€ä¸ªConcreteCommandå¯¹è±¡å¹¶æŒ‡å®šå®ƒçš„Receiverå¯¹è±¡ã€‚</li><li>æŸInvokerå¯¹è±¡å­˜å‚¨è¯¥ConcreteCommandå¯¹è±¡ã€‚</li><li>è¯¥Invokeré€šè¿‡è°ƒç”¨Commandå¯¹è±¡çš„Executeæ“ä½œæ¥æäº¤ä¸€ä¸ªè¯·æ±‚ã€‚è‹¥è¯¥å‘½ä»¤æ˜¯å¯æ’¤é”€çš„ï¼ŒConcreteCommandå°±åœ¨æ‰§è¡ŒExecuteæ“ä½œä¹‹å‰å­˜å‚¨å½“å‰çŠ¶æ€å·²ç”¨äºå–æ¶ˆè¯¥å‘½ä»¤ã€‚</li><li>ConcreteCommandå¯¹è±¡å¯¹è°ƒç”¨å®ƒçš„Recevierçš„è¿›è¡Œæ“ä½œä»¥æ‰§è¡Œè¯¥è¯·æ±‚ã€‚</li></ol><h4 id="4-2-4-æ—¶åºå›¾"><a href="#4-2-4-æ—¶åºå›¾" class="headerlink" title="4.2.4 æ—¶åºå›¾"></a>4.2.4 æ—¶åºå›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/å‘½ä»¤æ—¶åºå›¾.png" alt="å‘½ä»¤æ—¶åºå›¾"></p><h3 id="4-3-Interpreter-è§£é‡Šå™¨"><a href="#4-3-Interpreter-è§£é‡Šå™¨" class="headerlink" title="4.3 Interpreter(è§£é‡Šå™¨)"></a>4.3 Interpreter(è§£é‡Šå™¨)</h3><h4 id="4-3-1-ç±»å›¾"><a href="#4-3-1-ç±»å›¾" class="headerlink" title="4.3.1 ç±»å›¾"></a>4.3.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è§£é‡Šå™¨ç±»å›¾.png" alt="è§£é‡Šå™¨ç±»å›¾"></p><h4 id="4-3-2-å‚ä¸è€…"><a href="#4-3-2-å‚ä¸è€…" class="headerlink" title="4.3.2 å‚ä¸è€…"></a>4.3.2 å‚ä¸è€…</h4><p>AbstractExpression(æŠ½è±¡è¡¨è¾¾å¼)</p><ol><li>å£°æ˜ä¸€ä¸ªæŠ½è±¡çš„è§£é‡Šæ“ä½œï¼Œè¿™ä¸ªæ¥å£ä¸ºæŠ½è±¡è¯­æ³•æ ‘ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹æ‰€å…±äº«ã€‚</li></ol><p>TerminalExpression(ç»ˆç»“ç¬¦è¡¨è¾¾å¼)</p><ol><li>å®ç°ä¸æ–‡æ³•ä¸­çš„ç»ˆç»“ç¬¦ç›¸å…³è”çš„è§£é‡Šæ“ä½œã€‚</li><li>ä¸€ä¸ªå¥å­ä¸­çš„æ¯ä¸ªç»ˆç»“ç¬¦éœ€è¦è¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚</li></ol><p>NonterminalExpression(éç»ˆç»“ç¬¦è¡¨è¾¾å¼)</p><ol><li>å¯¹æ–‡æ³•ä¸­çš„æ¯ä¸€æ¡è§„åˆ™<code>R ::=R&lt;sub&gt;1&lt;/sub&gt;R&lt;sub&gt;2&lt;/sub&gt;...R&lt;sub&gt;n&lt;/sub&gt;</code>éƒ½éœ€è¦ä¸€ä¸ªNonterminalExpressionç±»ã€‚</li><li>ä¸ºä»<code>R&lt;sub&gt;1&lt;/sub&gt;</code>åˆ°<code>R&lt;sub&gt;n&lt;/sub&gt;</code>çš„æ¯ä¸ªç¬¦å·éƒ½ç»´æŠ¤ä¸€ä¸ªAbstractExpressionç±»å‹çš„å®ä¾‹å˜é‡ã€‚</li><li>ä¸ºæ–‡æ³•ä¸­çš„éç»ˆç»“ç¬¦å®ç°è§£é‡Š(Interpret)æ“ä½œã€‚è§£é‡Š(Interpret)ä¸€èˆ¬è¦é€’å½’åœ°è°ƒç”¨è¡¨ç¤º<code>R&lt;sub&gt;1&lt;/sub&gt;</code>åˆ°<code>R&lt;sub&gt;n&lt;/sub&gt;</code>çš„é‚£äº›å¯¹è±¡çš„è§£é‡Šæ“ä½œã€‚</li></ol><p>Context</p><ol><li>åŒ…å«è§£é‡Šå™¨ä¹‹å¤–çš„ä¸€äº›å…¨å±€ä¿¡æ¯ã€‚</li></ol><p>Client</p><ol><li>æ„å»ºï¼ˆæˆ–è¢«ç»™å®šï¼‰è¡¨ç¤ºè¯¥æ–‡æ³•å®šä¹‰çš„è¯­è¨€ä¸­ä¸€ä¸ªç‰¹å®šçš„å¥å­çš„æŠ½è±¡è¯­æ³•æ ‘ã€‚è¯¥æŠ½è±¡è¯­æ³•æ ‘ç”±NonterminalExpressionå’ŒTerminalExpressionçš„å®ä¾‹è£…é…è€Œæˆã€‚</li><li>è°ƒç”¨è§£é‡Šæ“ä½œã€‚</li></ol><h4 id="4-3-3-åä½œ"><a href="#4-3-3-åä½œ" class="headerlink" title="4.3.3 åä½œ"></a>4.3.3 åä½œ</h4><ol><li>Clientæ„å»ºï¼ˆæˆ–è¢«ç»™å®šï¼‰ä¸€ä¸ªå¥å­ï¼Œå®ƒæ˜¯NonterminalExpressionå’ŒTerminalExpressionçš„å®ä¾‹çš„ä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶ååˆå§‹åŒ–ä¸Šä¸‹æ–‡å¹¶è°ƒç”¨è§£é‡Šæ“ä½œã€‚</li><li>æ¯ä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼èŠ‚ç‚¹å®šä¹‰ç›¸åº”å­è¡¨è¾¾å¼çš„è§£é‡Šæ“ä½œã€‚è€Œå„ç»ˆç»“ç¬¦è¡¨è¾¾å¼çš„è§£é‡Šæ“ä½œæ„æˆäº†é€’å½’çš„åŸºç¡€ã€‚</li><li>æ¯ä¸€èŠ‚ç‚¹çš„è§£é‡Šæ“ä½œç”¨ä¸Šä¸‹æ–‡æ¥å­˜å‚¨å’Œè®¿é—®è§£é‡Šå™¨çš„çŠ¶æ€ã€‚</li></ol><h3 id="4-4-Iterator-è¿­ä»£å™¨"><a href="#4-4-Iterator-è¿­ä»£å™¨" class="headerlink" title="4.4 Iterator(è¿­ä»£å™¨)"></a>4.4 Iterator(è¿­ä»£å™¨)</h3><h4 id="4-4-1-ç±»å›¾"><a href="#4-4-1-ç±»å›¾" class="headerlink" title="4.4.1 ç±»å›¾"></a>4.4.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è¿­ä»£å™¨ç±»å›¾.png" alt="è¿­ä»£å™¨ç±»å›¾"></p><h4 id="4-4-2-å‚ä¸è€…"><a href="#4-4-2-å‚ä¸è€…" class="headerlink" title="4.4.2 å‚ä¸è€…"></a>4.4.2 å‚ä¸è€…</h4><p>Iterator</p><ol><li>è¿­ä»£å™¨å®šä¹‰è®¿é—®å’Œéå†å…ƒç´ çš„æ¥å£ã€‚</li></ol><p>ConcreteIterator</p><ol><li>å…·ä½“è¿­ä»£å™¨å®ç°è¿­ä»£å™¨æ¥å£ã€‚</li><li>å¯¹è¯¥èšåˆéå†æ—¶è·Ÿè¸ªå½“å‰ä½ç½®ã€‚</li></ol><p>Aggregate</p><ol><li>èšåˆå®šä¹‰åˆ›å»ºç›¸åº”è¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚</li></ol><p>ConcreteAggregate</p><ol><li>å…·ä½“èšåˆå®ç°åˆ›å»ºç›¸åº”è¿­ä»£å™¨çš„æ¥å£ï¼Œè¯¥æ“ä½œè¿”å›ConcreteIteratorçš„ä¸€ä¸ªé€‚å½“çš„å®ä¾‹ã€‚</li></ol><h4 id="4-4-3-åä½œ"><a href="#4-4-3-åä½œ" class="headerlink" title="4.4.3 åä½œ"></a>4.4.3 åä½œ</h4><ol><li>ConcreteIteratorè·Ÿè¸ªèšåˆä¸­çš„å½“å‰å¯¹è±¡ï¼Œå¹¶èƒ½å¤Ÿè®¡ç®—å‡ºå¾…éå†çš„åç»§å¯¹è±¡ã€‚</li></ol><h3 id="4-5-Mediator-ä¸­ä»‹è€…"><a href="#4-5-Mediator-ä¸­ä»‹è€…" class="headerlink" title="4.5 Mediator(ä¸­ä»‹è€…)"></a>4.5 Mediator(ä¸­ä»‹è€…)</h3><h4 id="4-5-1-ç±»å›¾"><a href="#4-5-1-ç±»å›¾" class="headerlink" title="4.5.1 ç±»å›¾"></a>4.5.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ä¸­ä»‹è€…ç±»å›¾.png" alt="ä¸­ä»‹è€…ç±»å›¾"></p><h4 id="4-5-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"><a href="#4-5-2-å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾" class="headerlink" title="4.5.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></a>4.5.2 å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ä¸­ä»‹è€…å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾.png" alt="ä¸­ä»‹è€…å¯¹è±¡ç»“æ„ç¤ºä¾‹å›¾"></p><h4 id="4-5-3-å‚ä¸è€…"><a href="#4-5-3-å‚ä¸è€…" class="headerlink" title="4.5.3 å‚ä¸è€…"></a>4.5.3 å‚ä¸è€…</h4><p>Mediator</p><ol><li>ä¸­ä»‹è€…å®šä¹‰ä¸€ä¸ªæ¥å£ç”¨äºä¸å„åŒäº‹(Colleague)å¯¹è±¡é€šä¿¡ã€‚</li></ol><p>ConcreteMediator</p><ol><li>å…·ä½“ä¸­ä»‹è€…é€šè¿‡åè°ƒå„åŒäº‹å¯¹è±¡å®ç°åä½œè¡Œä¸ºã€‚</li><li>äº†è§£å¹¶ç»´æŠ¤å®ƒçš„å„ä¸ªåŒäº‹ã€‚</li></ol><p>Colleague class</p><ol><li>æ¯ä¸€ä¸ªåŒäº‹ç±»éƒ½çŸ¥é“å®ƒçš„ä¸­ä»‹å¯¹è±¡ã€‚</li><li>æ¯ä¸€ä¸ªåŒäº‹å¯¹è±¡åœ¨éœ€ä¸å…¶ä»–çš„åŒäº‹é€šä¿¡çš„æ—¶å€™ï¼Œä¸å®ƒçš„ä¸­ä»‹è€…é€šä¿¡ã€‚</li></ol><h4 id="4-5-4-åä½œ"><a href="#4-5-4-åä½œ" class="headerlink" title="4.5.4 åä½œ"></a>4.5.4 åä½œ</h4><ol><li>åŒäº‹å‘ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡å‘é€å’Œæ¥å—è¯·æ±‚ã€‚ä¸­ä»‹ç€åœ¨å„åŒäº‹é—´é€‚å½“åœ°è½¬å‘è¯·æ±‚ä»¥å®ç°åä½œè¡Œä¸ºã€‚</li></ol><h3 id="4-6-Memento-å¤‡å¿˜å½•"><a href="#4-6-Memento-å¤‡å¿˜å½•" class="headerlink" title="4.6 Memento(å¤‡å¿˜å½•)"></a>4.6 Memento(å¤‡å¿˜å½•)</h3><h4 id="4-6-1-ç±»å›¾"><a href="#4-6-1-ç±»å›¾" class="headerlink" title="4.6.1 ç±»å›¾"></a>4.6.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/å¤‡å¿˜å½•ç±»å›¾.png" alt="å¤‡å¿˜å½•ç±»å›¾"></p><h4 id="4-6-2-å‚ä¸è€…"><a href="#4-6-2-å‚ä¸è€…" class="headerlink" title="4.6.2 å‚ä¸è€…"></a>4.6.2 å‚ä¸è€…</h4><p>Memento</p><ol><li>å¤‡å¿˜å½•å­˜å‚¨åŸå‘å™¨å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚åŸå‘å™¨æ ¹æ®éœ€è¦å†³å®šå¤‡å¿˜å½•å­˜å‚¨åŸå‘å™¨çš„å“ªäº›å†…éƒ¨çŠ¶æ€ã€‚</li><li>é˜²æ­¢åŸå‘å™¨ä»¥å¤–çš„å…¶ä»–å¯¹è±¡è®¿é—®å¤‡å¿˜å½•ã€‚å¤‡å¿˜å½•å®é™…ä¸Šæœ‰ä¸¤ä¸ªæ¥å£ï¼Œç®¡ç†è€…(caretaker)åªèƒ½çœ‹åˆ°å¤‡å¿˜å½•çš„çª„æ¥å£â€”â€”å®ƒåªèƒ½å°†å¤‡å¿˜å½•ä¼ é€’ç»™å…¶ä»–å¯¹è±¡ã€‚ç›¸åï¼ŒåŸå‘å™¨èƒ½å¤Ÿçœ‹åˆ°ä¸€ä¸ªå®½æ¥å£ï¼Œå…è®¸å®ƒè®¿é—®è¿”å›åˆ°å…ˆå‰çŠ¶æ€æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚ç†æƒ³çš„æƒ…å†µæ˜¯åªå…è®¸ç”Ÿæˆæœ¬å¤‡å¿˜å½•çš„é‚£ä¸ªåŸå‘å™¨è®¿é—®æœ¬å¤‡å¿˜å½•çš„å†…éƒ¨çŠ¶æ€ã€‚</li></ol><p>Originator</p><ol><li>åŸå‘å™¨åˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•ï¼Œç”¨ä»¥è®°å½•å½“å‰æ—¶åˆ»å®ƒçš„å†…éƒ¨çŠ¶æ€ã€‚</li><li>ä½¿ç”¨å¤‡å¿˜å½•æ¢å¤å†…éƒ¨çŠ¶æ€ã€‚</li></ol><p>CareTaker</p><ol><li>è´Ÿè´£ä¿å­˜å¥½å¤‡å¿˜å½•ã€‚</li><li>ä¸èƒ½å¯¹å¤‡å¿˜å½•çš„å†…å®¹è¿›è¡Œæ“ä½œæˆ–æ£€æŸ¥ã€‚</li></ol><h4 id="4-6-3-åä½œ"><a href="#4-6-3-åä½œ" class="headerlink" title="4.6.3 åä½œ"></a>4.6.3 åä½œ</h4><ol><li>ç®¡ç†å™¨å‘åŸå‘å™¨è¯·æ±‚ä¸€ä¸ªå¤‡å¿˜å½•ï¼Œä¿ç•™ä¸€æ®µæ—¶é—´åï¼Œå°†å…¶é€å›ç»™åŸå‘å™¨ã€‚</li></ol><h4 id="4-6-4-æ—¶åºå›¾"><a href="#4-6-4-æ—¶åºå›¾" class="headerlink" title="4.6.4 æ—¶åºå›¾"></a>4.6.4 æ—¶åºå›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/å¤‡å¿˜å½•æ—¶åºå›¾.png" alt="å¤‡å¿˜å½•æ—¶åºå›¾"></p><h3 id="4-7-Observer-è§‚å¯Ÿè€…"><a href="#4-7-Observer-è§‚å¯Ÿè€…" class="headerlink" title="4.7 Observer(è§‚å¯Ÿè€…)"></a>4.7 Observer(è§‚å¯Ÿè€…)</h3><h4 id="4-7-1-ç±»å›¾"><a href="#4-7-1-ç±»å›¾" class="headerlink" title="4.7.1 ç±»å›¾"></a>4.7.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è§‚å¯Ÿè€…ç±»å›¾.png" alt="è§‚å¯Ÿè€…ç±»å›¾"></p><h4 id="4-7-2-å‚ä¸è€…"><a href="#4-7-2-å‚ä¸è€…" class="headerlink" title="4.7.2 å‚ä¸è€…"></a>4.7.2 å‚ä¸è€…</h4><p>Subject</p><ol><li>ç›®æ ‡çŸ¥é“å®ƒçš„è§‚å¯Ÿè€…ã€‚å¯ä»¥æœ‰ä»»æ„å¤šä¸ªè§‚å¯Ÿè€…è§‚å¯ŸåŒä¸€ç›®æ ‡ã€‚</li><li>æä¾›æ³¨å†Œå’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡çš„æ¥å£ã€‚</li></ol><p>Observer</p><ol><li>ä¸ºé‚£äº›åœ¨ç›®æ ‡å‘ç”Ÿæ”¹å˜æ—¶éœ€è·å¾—é€šçŸ¥çš„å¯¹è±¡å®šä¹‰ä¸€ä¸ªæ›´æ–°æ¥å£ã€‚</li></ol><p>ConcreteSubject</p><ol><li>å°†æœ‰å…³çŠ¶æ€å­˜å…¥å„ConcreteObserverå¯¹è±¡ã€‚</li><li>å½“å®ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ã€‚</li></ol><p>ConcreteObserver</p><ol><li>ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘ConcreteSubjectå¯¹è±¡çš„å¼•ç”¨ã€‚</li><li>å­˜å‚¨æœ‰å…³çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€åº”ä¸ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´ã€‚<br>å®ç°Observerçš„æ›´æ–°æ¥å£ä»¥ä½¿è‡ªèº«çŠ¶æ€ä¸ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</li></ol><h4 id="4-7-3-åä½œ"><a href="#4-7-3-åä½œ" class="headerlink" title="4.7.3 åä½œ"></a>4.7.3 åä½œ</h4><ol><li>å½“ConcreteSubjectå‘ç”Ÿä»»ä½•å¯èƒ½å¯¼è‡´å…¶è§‚å¯Ÿè€…ä¸æœ¬èº«çŠ¶æ€ä¸ä¸€è‡´çš„æ”¹å˜æ—¶ï¼Œå®ƒå°†é€šçŸ¥å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…ã€‚</li><li>åœ¨å¾—åˆ°ä¸€ä¸ªå…·ä½“ç›®æ ‡çš„æ”¹å˜é€šçŸ¥åï¼ŒConcreteObserverå¯¹è±¡å¯å‘ç›®æ ‡å¯¹è±¡æŸ¥è¯¢ä¿¡æ¯ã€‚ConcreteObserverä½¿ç”¨è¿™äº›ä¿¡æ¯ä»¥ä½¿å®ƒçš„çŠ¶æ€ä¸ç›®æ ‡å¯¹è±¡çš„çŠ¶æ€ä¸€è‡´ã€‚</li></ol><h4 id="4-7-4-æ—¶åºå›¾"><a href="#4-7-4-æ—¶åºå›¾" class="headerlink" title="4.7.4 æ—¶åºå›¾"></a>4.7.4 æ—¶åºå›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è§‚å¯Ÿè€…æ—¶åºå›¾.png" alt="è§‚å¯Ÿè€…æ—¶åºå›¾"></p><h3 id="4-8-State-çŠ¶æ€"><a href="#4-8-State-çŠ¶æ€" class="headerlink" title="4.8 State(çŠ¶æ€)"></a>4.8 State(çŠ¶æ€)</h3><h4 id="4-8-1-ç±»å›¾"><a href="#4-8-1-ç±»å›¾" class="headerlink" title="4.8.1 ç±»å›¾"></a>4.8.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/çŠ¶æ€ç±»å›¾.png" alt="çŠ¶æ€ç±»å›¾"></p><h4 id="4-8-2-å‚ä¸è€…"><a href="#4-8-2-å‚ä¸è€…" class="headerlink" title="4.8.2 å‚ä¸è€…"></a>4.8.2 å‚ä¸è€…</h4><p>Context</p><ol><li>å®šä¹‰å®¢æˆ·æ„Ÿå…´è¶£çš„æ¥å£ã€‚</li><li>ç»´æŠ¤ä¸€ä¸ªConcreteStateå­ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å®šä¹‰å½“å‰çŠ¶æ€ã€‚</li></ol><p>State</p><ol><li>å®šä¹‰ä¸€ä¸ªæ¥å£ä»¥å°è£…ä¸Contextçš„ä¸€ä¸ªç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºã€‚</li></ol><p>ConcreteState subclasses</p><ol><li>æ¯ä¸€å­ç±»å®ç°ä¸€ä¸ªä¸Contextçš„ä¸€ä¸ªçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºã€‚</li></ol><h4 id="4-8-3-åä½œ"><a href="#4-8-3-åä½œ" class="headerlink" title="4.8.3 åä½œ"></a>4.8.3 åä½œ</h4><ol><li>Contextå°†ä¸çŠ¶æ€ç›¸å…³çš„è¯·æ±‚å§”æ‰˜ç»™å½“å‰çš„ConcreteStateå¯¹è±¡å¤„ç†ã€‚</li><li>Contextå¯å°†è‡ªèº«ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å¤„ç†è¯¥è¯·æ±‚çš„çŠ¶æ€å¯¹è±¡ã€‚è¿™ä½¿å¾—çŠ¶æ€å¯¹è±¡åœ¨å¿…è¦æ—¶å¯è®¿é—®Contextã€‚</li><li>Contextæ˜¯å®¢æˆ·ä½¿ç”¨çš„ä¸»è¦æ¥å£ã€‚å®¢æˆ·å¯ç”¨çŠ¶æ€å¯¹è±¡æ¥é…ç½®ä¸€ä¸ªContextï¼Œä¸€æ—¦ä¸€ä¸ªContexté…ç½®å®Œæ¯•ï¼Œå®ƒçš„å®¢æˆ·ä¸å†éœ€è¦ç›´æ¥ä¸çŠ¶æ€å¯¹è±¡æ‰“äº¤é“ã€‚</li><li>Contextæˆ–ConcreteStateå­ç±»éƒ½å¯å†³å®šå“ªä¸ªçŠ¶æ€æ˜¯å¦å¤–å“ªä¸€ä¸ªçš„åç»§è€…ï¼Œä»¥åŠæ˜¯åœ¨ä½•ç§æ¡ä»¶ä¸‹è¿›è¡ŒçŠ¶æ€è½¬æ¢ã€‚</li></ol><h3 id="4-9-Strategy-ç­–ç•¥"><a href="#4-9-Strategy-ç­–ç•¥" class="headerlink" title="4.9 Strategy(ç­–ç•¥)"></a>4.9 Strategy(ç­–ç•¥)</h3><h4 id="4-9-1-ç±»å›¾"><a href="#4-9-1-ç±»å›¾" class="headerlink" title="4.9.1 ç±»å›¾"></a>4.9.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/ç­–ç•¥ç±»å›¾.png" alt="ç­–ç•¥ç±»å›¾"></p><h4 id="4-9-2-å‚ä¸è€…"><a href="#4-9-2-å‚ä¸è€…" class="headerlink" title="4.9.2 å‚ä¸è€…"></a>4.9.2 å‚ä¸è€…</h4><p>Strategy</p><ol><li>å®šä¹‰æ‰€æœ‰æ”¯æŒçš„ç®—æ³•çš„å…¬å…±æ¥å£ã€‚Contextä½¿ç”¨è¿™ä¸ªæ¥å£æ¥è°ƒç”¨æŸConcreteStrategyå®šä¹‰çš„ç®—æ³•ã€‚</li></ol><p>ConcreteStrategy</p><ol><li>ä»¥Strategyæ¥å£å®ç°æŸå…·ä½“ç®—æ³•ã€‚</li></ol><p>Context</p><ol><li>ç”¨ä¸€ä¸ªConcreteStrategyå¯¹è±¡æ¥é…ç½®ã€‚</li><li>ç»´æŠ¤ä¸€ä¸ªå¯¹Strategyå¯¹è±¡çš„å¼•ç”¨ã€‚</li><li>å¯å®šä¹‰ä¸€ä¸ªæ¥å£æ¥è®©Strategyè®¿é—®å®ƒçš„æ•°æ®ã€‚</li></ol><h4 id="4-9-3-åä½œ"><a href="#4-9-3-åä½œ" class="headerlink" title="4.9.3 åä½œ"></a>4.9.3 åä½œ</h4><ol><li>Strategyå’ŒContextç›¸äº’ä½œç”¨ä»¥å®ç°é€‰å®šçš„ç®—æ³•ã€‚å½“ç®—æ³•è¢«è°ƒç”¨æ—¶ï¼ŒContextå¯ä»¥å°†è¯¥ç®—æ³•æ‰€éœ€è¦çš„æ‰€æœ‰æ•°æ®éƒ½ä¼ é€’ç»™è¯¥Strategyã€‚æˆ–è€…ï¼ŒContextå¯ä»¥å°†è‡ªèº«ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™Strategyæ“ä½œã€‚è¿™å°±è®©Strategyåœ¨éœ€è¦æ—¶å¯ä»¥å›è°ƒContextã€‚</li><li>Contextå°†å®ƒçš„å®¢æˆ·çš„è¯·æ±‚è½¬å‘ç»™å®ƒçš„Strategyã€‚å®¢æˆ·é€šå¸¸åˆ›å»ºå¹¶ä¼ é€’ä¸€ä¸ªConcreteStrategyå¯¹è±¡ç»™è¯¥Contextï¼›è¿™æ ·ï¼Œå®¢æˆ·ä»…ä¸Contextäº¤äº’ã€‚é€šå¸¸æœ‰ä¸€ç³»åˆ—çš„ConcreteStrategyç±»å¯ä¾›å®¢æˆ·ä»ä¸­é€‰æ‹©ã€‚</li></ol><h3 id="4-10-Template-Method-æ¨¡æ¿æ–¹æ³•"><a href="#4-10-Template-Method-æ¨¡æ¿æ–¹æ³•" class="headerlink" title="4.10 Template Method(æ¨¡æ¿æ–¹æ³•)"></a>4.10 Template Method(æ¨¡æ¿æ–¹æ³•)</h3><h4 id="4-10-1-ç±»å›¾"><a href="#4-10-1-ç±»å›¾" class="headerlink" title="4.10.1 ç±»å›¾"></a>4.10.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/æ¨¡æ¿æ–¹æ³•ç±»å›¾.png" alt="æ¨¡æ¿æ–¹æ³•ç±»å›¾"></p><h4 id="4-10-2-å‚ä¸è€…"><a href="#4-10-2-å‚ä¸è€…" class="headerlink" title="4.10.2 å‚ä¸è€…"></a>4.10.2 å‚ä¸è€…</h4><p>AbstractClass</p><ol><li>å®šä¹‰æŠ½è±¡çš„åŸè¯­æ“ä½œ(primitive operation)ï¼Œå…·ä½“çš„å­ç±»å°†é‡å®šä¹‰å®ƒä»¬ä»¥å®ç°ä¸€ä¸ªç®—æ³•çš„å„ä¸ªæ­¥éª¤ã€‚</li><li>å®ç°ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œå®šä¹‰ä¸€ä¸ªç®—æ³•éª¨æ¶ã€‚è¯¥æ¨¡æ¿æ–¹æ³•ä¸ä»…è°ƒç”¨åŸè¯­æ“ä½œï¼Œä¹Ÿè°ƒç”¨å®šä¹‰åœ¨AbstractClassæˆ–å…¶ä»–å¯¹è±¡ä¸­çš„æ“ä½œã€‚</li></ol><p>ConcreteClass</p><ol><li>å®ç°åŸè¯­æ“ä½œä»¥å®Œæˆç®—æ³•ä¸­ä¸ç‰¹å®šå­ç±»ç›¸å…³çš„æ­¥éª¤ã€‚</li></ol><h4 id="4-10-3-åä½œ"><a href="#4-10-3-åä½œ" class="headerlink" title="4.10.3 åä½œ"></a>4.10.3 åä½œ</h4><ol><li>ConcreteClassé AbstractClassæ¥å®ç°ç®—æ³•ä¸­ä¸å˜çš„æ­¥éª¤ã€‚</li></ol><h3 id="4-11-Visitor-è®¿é—®è€…"><a href="#4-11-Visitor-è®¿é—®è€…" class="headerlink" title="4.11 Visitor(è®¿é—®è€…)"></a>4.11 Visitor(è®¿é—®è€…)</h3><h4 id="4-11-1-ç±»å›¾"><a href="#4-11-1-ç±»å›¾" class="headerlink" title="4.11.1 ç±»å›¾"></a>4.11.1 ç±»å›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è®¿é—®è€…ç±»å›¾.png" alt="è®¿é—®è€…ç±»å›¾"></p><h4 id="4-11-2-å‚ä¸è€…"><a href="#4-11-2-å‚ä¸è€…" class="headerlink" title="4.11.2 å‚ä¸è€…"></a>4.11.2 å‚ä¸è€…</h4><p>Visitor</p><ol><li>ä¸ºè¯¥å¯¹è±¡ç»“æ„ä¸­ConcreteElementçš„æ¯ä¸€ä¸ªç±»å£°æ˜ä¸€ä¸ªVisitæ“ä½œã€‚è¯¥æ“ä½œçš„åå­—å’Œç‰¹å¾æ ‡è¯†äº†å‘é€Visitè¯·æ±‚ç»™è¯¥è®¿é—®è€…çš„é‚£ä¸ªç±»ã€‚è¿™ä½¿å¾—è®¿é—®è€…å¯ä»¥ç¡®å®šæ­£è¢«è®¿é—®å…ƒç´ çš„å…·ä½“çš„ç±»ã€‚è¿™æ ·è®¿é—®è€…å°±å¯ä»¥é€šè¿‡è¯¥å…ƒç´ çš„ç‰¹å®šæ¥å£ç›´æ¥è®¿é—®å®ƒã€‚</li></ol><p>ConcreteVisitor</p><ol><li>å®ç°æ¯ä¸ªç”±Visitorå£°æ˜çš„æ“ä½œã€‚æ¯ä¸ªæ“ä½œå®ç°æœ¬ç®—æ³•çš„ä¸€éƒ¨åˆ†ï¼Œè€Œè¯¥ç®—æ³•ç‰‡æ®µä¹ƒæ˜¯å¯¹åº”äºç»“æ„ä¸­å¯¹è±¡çš„ç±»ã€‚ConcreteVisitorä¸ºè¯¥ç®—æ³•æä¾›äº†ä¸Šä¸‹æ–‡å¹¶å­˜å‚¨å®ƒçš„å±€éƒ¨çŠ¶æ€ã€‚è¿™ä¸€çŠ¶æ€å¸¸å¸¸åœ¨éå†è¯¥ç»“æ„çš„è¿‡ç¨‹ä¸­ç´¯è®¡ç»“æœã€‚</li></ol><p>Element</p><ol><li>å®šä¹‰ä¸€ä¸ªAcceptæ“ä½œï¼Œå®ƒä»¥ä¸€ä¸ªè®¿é—®è€…ä¸ºå‚æ•°ã€‚</li></ol><p>ConcreteElement</p><ol><li>å®ç°Acceptæ“ä½œï¼Œè¯¥æ“ä½œä»¥ä¸€ä¸ªè®¿é—®è€…ä¸ºå‚æ•°ã€‚</li></ol><p>ObjectStructure</p><ol><li>èƒ½æšä¸¾å®ƒçš„å…ƒç´ ã€‚</li><li>å¯ä»¥æä¾›ä¸€ä¸ªé«˜å±‚çš„æ¥å£ä»¥å…è®¸è¯¥è®¿é—®è€…è®¿é—®å®ƒçš„å…ƒç´ ã€‚</li><li>å¯ä»¥æ˜¯ä¸€ä¸ªå¤åˆæˆ–æ˜¯ä¸€ä¸ªé›†åˆï¼Œå¦‚ä¸€ä¸ªåˆ—è¡¨æˆ–ä¸€ä¸ªæ— åºé›†åˆã€‚</li></ol><h4 id="4-11-3-åä½œ"><a href="#4-11-3-åä½œ" class="headerlink" title="4.11.3 åä½œ"></a>4.11.3 åä½œ</h4><ol><li>ä¸€ä¸ªä½¿ç”¨Visitoræ¨¡å¼çš„å®¢æˆ·å¿…é¡»åˆ›å»ºä¸€ä¸ªConcreteVisitorå¯¹è±¡ï¼Œç„¶åéå†è¯¥å¯¹è±¡ç»“æ„ï¼Œå¹¶ç”¨è¯¥è®¿é—®è€…è®¿é—®æ¯ä¸€ä¸ªå…ƒç´ ã€‚</li><li>å½“ä¸€ä¸ªå…ƒç´ è¢«è®¿é—®æ˜¯ï¼Œå®ƒè°ƒç”¨å¯¹åº”äºå®ƒçš„ç±»çš„Visitoræ“ä½œã€‚å¦‚æœå¿…è¦ï¼Œè¯¥å…ƒç´ å°†è‡ªèº«ä½œä¸ºè¿™ä¸ªæ“ä½œçš„ä¸€ä¸ªå‚æ•°ä»¥ä¾¿è®¿é—®è€…è®¿é—®å®ƒçš„çŠ¶æ€ã€‚</li></ol><h4 id="4-11-4-æ—¶åºå›¾"><a href="#4-11-4-æ—¶åºå›¾" class="headerlink" title="4.11.4 æ—¶åºå›¾"></a>4.11.4 æ—¶åºå›¾</h4><p><img src="/images/ã€Šè®¾è®¡æ¨¡å¼ã€‹è¯»ä¹¦ç¬”è®°/è®¿é—®è€…æ—¶åºå›¾.png" alt="è®¿é—®è€…æ—¶åºå›¾"></p>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢å‘å¯¹è±¡ </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹æ‰“åŒ…ç¨‹åºç”Ÿæˆè‡ªè§£å‹è‡ªè¿è¡Œæ–‡ä»¶</title>
      <link href="linux-xia-da-bao-cheng-xu-sheng-cheng-zi-jie-ya-zi-yun-xing-wen-jian/"/>
      <url>linux-xia-da-bao-cheng-xu-sheng-cheng-zi-jie-ya-zi-yun-xing-wen-jian/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span><span class="token comment"># Program:</span><span class="token comment">#   æ‰“åŒ…ç¨‹åºç”Ÿæˆè‡ªè§£å‹è‡ªè¿è¡Œæ–‡ä»¶</span><span class="token comment"># History:</span><span class="token comment">#   2020/03/25  [KibaAmor](https://kibazen.cn)    Create this file</span><span class="token comment"># é‡åˆ°é”™è¯¯æ—¶é€€å‡º</span><span class="token builtin class-name">set</span> -e<span class="token comment"># é…ç½®</span><span class="token comment">#################################################################</span><span class="token comment"># æ‰“åŒ…åå¯æ‰§è¡Œæ–‡ä»¶çš„åå­—</span><span class="token assign-left variable">PACKAGE_NAME</span><span class="token operator">=</span><span class="token string">"server.run"</span><span class="token comment"># éœ€è¦è¢«æ‰“åŒ…ç¨‹åºçš„ç›®å½•å(ä¸è¦åŒ…å«è·¯å¾„)</span><span class="token assign-left variable">TARGET_DIR</span><span class="token operator">=</span>server<span class="token comment"># è¢«æ‰“åŒ…ç¨‹åºçš„å¯æ‰§è¡Œç¨‹åº</span><span class="token assign-left variable">EXEC_NAME</span><span class="token operator">=</span><span class="token string">"run.sh"</span><span class="token comment"># å¼€å§‹ç”Ÿæˆè‡ªè§£å‹çš„å¯æ‰§è¡Œç¨‹åº</span><span class="token comment">#################################################################</span><span class="token comment"># åˆ›å»ºè‡ªè§£å‹è„šæœ¬</span><span class="token function">cat</span> <span class="token operator">&gt;</span> <span class="token variable">${PACKAGE_NAME}</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'END'#!/usr/bin/env bash# Program:#   æ‰“åŒ…ç›®å½•'TARGET_DIR'ç”Ÿæˆè‡ªè§£å‹è‡ªè¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶# History:#   CURRENT_DATETIME  [KibaAmor](https://kibazen.cn)    Create this file# é‡åˆ°é”™è¯¯æ—¶é€€å‡ºset -e# è§£å‹ç›®å½•å¿…é¡»ä¸å­˜åœ¨test -e TARGET_DIR &amp;&amp; echo "'TARGET_DIR' already exist. Remove?" &amp;&amp;  rm -Ir TARGET_DIRtest -e TARGET_DIR &amp;&amp; echo "'TARGET_DIR' is still exist. please remove manual" &amp;&amp; exit -1# ç”Ÿæˆä¸€ä¸ªç©ºçš„ï¼Œç”¨äºè§£å‹æ–‡ä»¶çš„ç›®å½•mkdir TARGET_DIR# å®šä½ç¨‹åºå‹ç¼©åäºŒè¿›åˆ¶æ•°æ®åœ¨è„šæœ¬ä¸­çš„ä½ç½®BIN_LINE_NUM=$(awk '/^__LAST_LINE__/ { print NR+1; exit 0; }' $0)# è§£å‹è¢«æ‰“åŒ…çš„ç¨‹åºtail -n +${BIN_LINE_NUM} $0 | tar -xz -C TARGET_DIR --strip-components=1# è¿›å…¥ç›®å½•cd TARGET_DIR# èµ‹äºˆå¯æ‰§è¡Œæƒé™chmod +x ./EXEC_NAME# å¼€å§‹æ‰§è¡Œè¢«æ‰“åŒ…çš„ç¨‹åº./EXEC_NAME $*# æ­£å¸¸é€€å‡ºexit 0__LAST_LINE__END</span><span class="token assign-left variable">CURRENT_DATETIME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y/%m/%d %H:%M:%S'</span><span class="token variable">)</span></span><span class="token comment"># æ›¿æ¢è‡ªè§£å‹è„šæœ¬ä¸­çš„å˜é‡</span><span class="token function">sed</span> -i <span class="token string">"s/TARGET_DIR/<span class="token variable">${TARGET_DIR}</span>/g"</span> <span class="token variable">${PACKAGE_NAME}</span><span class="token function">sed</span> -i <span class="token string">"s/EXEC_NAME/<span class="token variable">${EXEC_NAME}</span>/g"</span> <span class="token variable">${PACKAGE_NAME}</span><span class="token function">sed</span> -i <span class="token string">"s@CURRENT_DATETIME@<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y/%m/%d %H:%M:%S'</span><span class="token variable">)</span></span>@g"</span> <span class="token variable">${PACKAGE_NAME}</span><span class="token comment"># å°†æ‰“åŒ…çš„ç¨‹åºå‹ç¼©ï¼Œå¹¶å°†å‹ç¼©åçš„äºŒè¿›åˆ¶æ•°æ®é™„åŠ åˆ°è‡ªè§£å‹è„šæœ¬åé¢</span><span class="token function">tar</span> c <span class="token variable">${TARGET_DIR}</span> <span class="token operator">|</span> <span class="token function">gzip</span> -f <span class="token operator">&gt;&gt;</span> <span class="token variable">${PACKAGE_NAME}</span><span class="token comment"># ç»™è‡ªè§£å‹è„šæœ¬æ‰§è¡Œæƒé™</span><span class="token function">chmod</span> +x <span class="token variable">${PACKAGE_NAME}</span><span class="token comment"># è¾“å‡ºä¿¡æ¯</span><span class="token builtin class-name">echo</span> <span class="token string">"æ‰“åŒ…æˆåŠŸ. æ‰“åŒ…åçš„æ–‡ä»¶ä¸ºï¼š<span class="token variable">${PACKAGE_NAME}</span>"</span><span class="token comment"># æ­£å¸¸é€€å‡º</span><span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ­£ç¡®çš„å­¦ä¹ è®¾è®¡æ¨¡å¼</title>
      <link href="ru-he-zheng-que-de-xue-xi-she-ji-mo-shi/"/>
      <url>ru-he-zheng-que-de-xue-xi-she-ji-mo-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç¼–ç¨‹åˆæœŸé‡åˆ°çš„é—®é¢˜"><a href="#ä¸€ã€ç¼–ç¨‹åˆæœŸé‡åˆ°çš„é—®é¢˜" class="headerlink" title="ä¸€ã€ç¼–ç¨‹åˆæœŸé‡åˆ°çš„é—®é¢˜"></a>ä¸€ã€ç¼–ç¨‹åˆæœŸé‡åˆ°çš„é—®é¢˜</h2><p>åˆå­¦ç¼–ç¨‹æ—¶ï¼Œå†™çš„ä»£ç åŸºæœ¬ä¸Šéƒ½ç¼–ç¨‹ä½œä¸šï¼ŒACMä¹‹ç±»çš„ï¼Œä»£ç é‡ä¸€èˆ¬éƒ½ä¸å¤šï¼Œå‡ ç™¾è¡Œï¼Œå°‘æœ‰ä¸Šåƒè¡Œã€‚æ‰€ä»¥ï¼Œåˆè¯»è®¾è®¡æ¨¡å¼ç›¸å…³ä¹¦ç±æ—¶ï¼Œåªæ˜¯è§‰å¾—å¾ˆå‰å®³ï¼Œå¹¶æ²¡æœ‰åˆ‡å®çš„ä½“ä¼šåˆ°ä½¿ç”¨è®¾è®¡æ¨¡å¼å¸¦æ¥çš„å¥½å¤„ã€‚éšç€å†™çš„ç¨‹åºä»£ç é‡é€æ¸å¢å¤šï¼Œå‘ç°ä»£ç çš„é€»è¾‘è¶Šæ¥è¶Šæ··ä¹±ï¼Œå®ç°çš„åŠŸèƒ½BUGä¹Ÿè¶Šæ¥è¶Šå¤šã€‚</p><p>åœ¨ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ¥è§¦åˆ°äº†å¾ˆå¤šä¼˜ç§€çš„ä»£ç åº“ï¼Œæ¯”å¦‚ï¼š<a href="https://www.ogre3d.org/">OGRE(Open-source Graphics Rendering Engines)</a>ï¼Œä¸€ä¸ªä¼˜ç§€åŒæ—¶ä¹Ÿæ˜¯å¼€æºçš„3Då›¾å½¢å›¾åƒæ¸²æŸ“å¼•æ“ã€‚åœ¨å­¦ä¹ ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å…¶ä»£ç é€»è¾‘æ¸…æ™°ï¼Œä¾¿äºé˜…è¯»ã€‚å¯¹æ¯”è‡ªå·±å†™çš„ä»£ç å’Œ<a href="https://www.ogre3d.org/">OGRE</a>çš„ä»£ç ï¼Œå‘ç°OGREçš„ä»£ç ä¸­ä½¿ç”¨äº†å¾ˆå¤šçš„è®¾è®¡æ¨¡å¼ã€‚æ‰€æœ‰å°±ç®€å•çš„è®¤ä¸ºï¼š</p><blockquote><p>ä½¿ç”¨è®¾è®¡æ¨¡å¼å°±èƒ½è®©ä»£ç ç»„ç»‡æ›´åŠ ç®€å•ï¼Œè®©ä»£ç çš„é€»è¾‘ä¹Ÿæ›´åŠ æ¸…æ™°æ˜äº†ï¼ŒåŒæ—¶å¤§å¤§çš„æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œé™ä½äº†ç¨‹åºå‡ºBUGçš„å‡ ç‡ã€‚</p></blockquote><h2 id="äºŒã€å¯¹è®¾è®¡æ¨¡å¼é”™è¯¯çš„è®¤è¯†"><a href="#äºŒã€å¯¹è®¾è®¡æ¨¡å¼é”™è¯¯çš„è®¤è¯†" class="headerlink" title="äºŒã€å¯¹è®¾è®¡æ¨¡å¼é”™è¯¯çš„è®¤è¯†"></a>äºŒã€å¯¹è®¾è®¡æ¨¡å¼é”™è¯¯çš„è®¤è¯†</h2><p>æœ‰äº†ä¸Šé¢çš„ç»“è®ºï¼Œè®¤ä¸ºåªè¦å­¦ä¼šäº†æ‰€æœ‰çš„è®¾è®¡æ¨¡å¼ï¼Œå°±èƒ½å¤Ÿæé«˜ç¼–ç¨‹çš„èƒ½åŠ›ã€‚ä½†æ˜¯åœ¨èƒŒå®Œæ‰€æœ‰çš„è®¾è®¡æ¨¡å¼åå‘ç°ï¼š</p><ul><li><code>ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™è¯¥ç”¨è®¾è®¡æ¨¡å¼ã€‚</code> è®¾è®¡æ¨¡å¼ç¡®å®å¾ˆå¥½ï¼Œä½†æ˜¯è¿˜æ˜¯ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™è¯¥ç”¨è®¾è®¡æ¨¡å¼ï¼Œå› ä¸ºå¹³æ—¶çš„ç¼–ç¨‹ä¸­ä¸ç”¨è®¾è®¡æ¨¡å¼ï¼ŒåŠŸèƒ½ä¹Ÿèƒ½å®ç°å‡ºæ¥ã€‚</li><li><code>å¥—ç”¨äº†è®¾è®¡æ¨¡å¼åä»£ç è´¨é‡ä¹Ÿæ²¡æå‡ã€‚</code> å³ä½¿åœ¨ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œåˆ»æ„çš„ä½¿ç”¨äº†ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿæ²¡ä½“ä¼šåˆ°è®¾è®¡æ¨¡å¼å¸¦æ¥çš„å¥½å¤„ï¼Œæ›´æ²¡æœ‰ä½“ä¼šåˆ°æƒ³è±¡ä¸­ä»£ç è´¨é‡ä¼šç«‹ç«¿è§å½±çš„æé«˜ã€‚</li></ul><p>ä¼´éšç€å¯¹è®¾è®¡æ¨¡å¼ä½¿ç”¨çš„ç–‘é—®ï¼Œé˜…è¯»äº†æ›´å¤šçš„ä¹¦ç±ã€‚å½“è¯»åˆ°ã€Šé‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹è¿™æœ¬ä¹¦æ—¶ï¼ŒæŒ‰ç…§ä¹¦ä¸­çš„æŒ‡å¯¼ï¼Œé‡æ„äº†å·²æœ‰çš„ä»£ç ï¼Œå‘ç°ä¿®æ”¹åçš„ä»£ç ï¼Œé˜…è¯»èµ·æ¥æ›´åŠ çš„å®¹æ˜“ï¼Œä»£ç é€»è¾‘ä¹Ÿæ¯”ä¿®æ”¹ä¹‹å‰æ›´åŠ æ¸…æ™°ã€‚å†å¯¹æ¯”ä¿®æ”¹å‰åçš„ä»£ç ï¼Œå‘ç°ï¼š</p><ul><li><code>å¦‚æœæœ‰å¤šä¸ªåœ°æ–¹éƒ½éœ€è¦å®Œæˆç›¸åŒçš„åŠŸèƒ½ï¼Œåº”è¯¥æŠŠä»£ç å°è£…æˆä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å¤åˆ¶ç²˜è´´ã€‚</code> å› ä¸ºå¤åˆ¶ç²˜è´´åï¼Œä»£ç å¤šäº†ï¼Œæ”¹èµ·æ¥å®¹æ˜“æ¼ï¼Œä¹Ÿå°±å®¹æ˜“å‡ºé—®é¢˜äº†ï¼ŒåŒæ—¶ä»£ç ä¹Ÿå˜å¾—éš¾è¯»ã€‚</li><li><code>å¦‚æœä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸€ä¸ªç±»çš„ä»£ç æœ‰å¾ˆå¤šï¼Œé€šå¸¸æ›´å®¹æ˜“å‡ºBUGã€‚</code> å¦‚æœä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸€ä¸ªç±»é‡Œé¢çš„ä»£ç æœ‰å¾ˆå¤šçš„è¯ï¼Œè¯»èµ·æ¥é€»è¾‘å¤æ‚ï¼Œåšçš„äº‹æƒ…ä¹Ÿå¤šï¼Œå°±è€æ˜¯å®¹æ˜“å‡ºé—®é¢˜ã€‚</li></ul><p>å…¶ä»–çš„ç»†èŠ‚è¿˜æœ‰å¾ˆå¤šã€‚æ¯”å¦‚ï¼Œå¦‚æœæ³¨é‡Šéƒ½è¯´ä¸æ¸…æ¥šä¸€æ®µä»£ç åœ¨å¹²ä»€ä¹ˆï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å¸¸å¸¸æ›´å®¹æ˜“å‡ºé—®é¢˜ã€‚</p><p>å†æ¬¡è¯»<a href="https://www.ogre3d.org/">OGRE</a>çš„æºä»£ç æ—¶å°±å‘ç°ï¼Œæ•´ä¸ªæºä»£ç åœ¨è¿™äº›ç»†èŠ‚ä¸Šéƒ½åšçš„å¾ˆå¥½ã€‚æ¯”å¦‚ï¼šä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œè€Œä¸”ä»å‡½æ•°çš„åå­—é‡Œå°±èƒ½çŸ¥é“å…·ä½“åšçš„ä»€ä¹ˆã€‚è€Œæºä»£ç ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼æ›´æ˜¯å·§å¦™çš„è®©ä¸€ä¸ªå¤æ‚çš„åŠŸèƒ½å˜å¾—ç®€å•å¥½ç†è§£ã€‚</p><h2 id="ä¸‰ã€è®¤è¯†è½¯ä»¶å·¥ç¨‹"><a href="#ä¸‰ã€è®¤è¯†è½¯ä»¶å·¥ç¨‹" class="headerlink" title="ä¸‰ã€è®¤è¯†è½¯ä»¶å·¥ç¨‹"></a>ä¸‰ã€è®¤è¯†è½¯ä»¶å·¥ç¨‹</h2><p>é˜…è¯»ä¹¦ç±è¿‡ç¨‹ä¸­ä¹Ÿå¤šæ¬¡æ¥è§¦åˆ°äº†<code>è½¯ä»¶å·¥ç¨‹</code>è¿™ä¸ªæœ¯è¯­ï¼Œä½†æ˜¯ä¸€ç›´ä¸æ˜¯å¾ˆæ˜ç™½<code>è½¯ä»¶å·¥ç¨‹</code>å…·ä½“æ˜¯åšä»€ä¹ˆçš„ï¼Œç›´åˆ°è¯»åˆ°äº†ã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹è¿™æœ¬ä¹¦ã€‚<code>è½¯ä»¶å·¥ç¨‹æ˜¯ä¸€é—¨ç ”ç©¶ç”¨å·¥ç¨‹åŒ–æ–¹æ³•æ„å»ºå’Œç»´æŠ¤æœ‰æ•ˆçš„ã€å®ç”¨çš„å’Œé«˜è´¨é‡çš„è½¯ä»¶çš„å­¦ç§‘ã€‚</code>è€Œã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹è¿™æœ¬ä¹¦æ­£æ˜¯è®²è¿°å¦‚ä½•å®è·µè½¯ä»¶å·¥ç¨‹çš„ç»å…¸å·¨è‘—ã€‚ç†è§£ä¸€ä¸‹ï¼Œ<code>è½¯ä»¶å·¥ç¨‹</code>å°±æ˜¯ä¸€é—¨å­¦ä¹ ç ”ç©¶å†™å‡ºé«˜è´¨é‡è½¯ä»¶(ä»£ç )çš„å­¦ç§‘ã€‚è€Œã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹åˆ™æ˜¯ä»‹ç»å…·ä½“ç”¨æŸç§æ–¹æ³•æ¥å®ç°å†™å‡ºé«˜è´¨é‡è½¯ä»¶ç›®çš„çš„ä¹¦ã€‚</p><p>ã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹è¿™æœ¬ä¹¦ä¸­æå‡ºäº†<code>æ•æ·è®¾è®¡</code>è¿™ä¸€æ–¹æ³•ï¼Œå¹¶å°†å…¶å®šä¹‰ä¸ºï¼š</p><blockquote><p>æ•æ·è®¾è®¡æ˜¯ä¸€ä¸ªæŒç»­çš„åº”ç”¨åŸåˆ™ã€æ¨¡å¼ä»¥åŠå®ç°æ¥æ”¹è¿›è½¯ä»¶çš„ç»“æ„å’Œå¯è¯»æ€§çš„è¿‡ç¨‹ã€‚å®ƒæ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€ä¸ªäº‹ä»¶ã€‚</p></blockquote><p>å®ƒè®¤ä¸ºï¼Œåªè¦åœ¨ç¼–å†™ä»£ç å®ç°è½¯ä»¶æ—¶ï¼Œéµå®ˆä¸€äº›è½¯ä»¶å¼€å‘åŸåˆ™å’Œæ¨¡å¼ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿæé«˜ä»£ç çš„è´¨é‡ã€‚</p><h2 id="å››ã€äº†è§£æ•æ·å¼€å‘çš„åŸåˆ™"><a href="#å››ã€äº†è§£æ•æ·å¼€å‘çš„åŸåˆ™" class="headerlink" title="å››ã€äº†è§£æ•æ·å¼€å‘çš„åŸåˆ™"></a>å››ã€äº†è§£æ•æ·å¼€å‘çš„åŸåˆ™</h2><p>ã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹ç€é‡ä»‹ç»å¹¶è§£é‡Šäº†5ç§è½¯ä»¶å¼€å‘åŸåˆ™ã€‚åˆ†åˆ«æ˜¯ï¼š</p><ol><li><code>å•ä¸€èŒè´£åŸåˆ™(SRP)</code>ï¼šå°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚</li><li><code>å¼€æ”¾-å°é—­åŸåˆ™(OCP)</code>ï¼šè½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ç­‰ï¼‰åº”è¯¥æ˜¯å¯ä»¥æ‰©å±•çš„ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚</li><li><code>é‡Œæ°æ›¿æ¢åŸåˆ™(LSP)</code>ï¼šå­ç±»å‹(subtype)å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰å®ƒä»¬çš„åŸºç±»å‹(base type)ã€‚</li><li><code>ä¾èµ–å€’ç½®åŸåˆ™(DIP)</code>ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ã€‚äºŒè€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ã€‚ç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</li><li><code>æ¥å£éš”ç¦»åŸåˆ™(ISP)</code>ï¼šä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ä¾èµ–äºå®ƒä»¬ä¸ç”¨çš„æ–¹æ³•ã€‚</li></ol><p>ä¸å…¶è¯´æ˜¯<code>åŸåˆ™</code>ï¼Œä¸å¦‚è¯´æ˜¯<code>æ ‡å‡†</code>ã€‚å› ä¸ºå®ƒä»¬å‘Šè¯‰äº†æˆ‘ä»¬ä¸€ä¸ªæ ‡å‡†ï¼šåº”è¯¥æŠŠä»£ç è®¾è®¡æˆä¸€ä¸ªä»€ä¹ˆæ ·å­ï¼Œæ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Œæœ‰ä»€ä¹ˆç‰¹å¾ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¯´åº”è¯¥å¦‚ä½•ç¼–å†™ä»£ç ã€‚</p><p>æ­¤æ—¶ï¼Œå†å›è¿‡å¤´é˜…è¯»<a href="https://www.ogre3d.org/">OGRE</a>ç­‰ä¼˜ç§€çš„ä»£ç åº“æ—¶æ‰æ˜ç™½ï¼Œè¿™äº›ä»£ç åº“ä¼˜ç§€çš„åŸå› ä¹‹ä¸€æ˜¯å®ƒä»¬éµå¾ªäº†è‰¯å¥½çš„è½¯ä»¶å¼€å‘åŸåˆ™ï¼Œè€Œä½¿ç”¨è®¾è®¡æ¨¡å¼åˆ™æ˜¯è®©ä»£ç éµå¾ªè¿™äº›è½¯ä»¶å¼€å‘åŸåˆ™çš„æ–¹æ³•ã€‚è¿™ä¹Ÿæ˜¯åˆå­¦è®¾è®¡æ¨¡å¼æ—¶ï¼Œç”Ÿæ¬ç¡¬å¥—è®¾è®¡æ¨¡å¼å¹¶æ²¡æœ‰æ”¹å–„ä»£ç è´¨é‡çš„æ ¹æœ¬åŸå› ã€‚å› ä¸ºæ ¹æœ¬å°±ä¸çŸ¥é“åº”è¯¥æŠŠä»£ç æ”¹æˆä»€ä¹ˆæ ·ï¼Œéœ€è¦æ»¡è¶³ä»€ä¹ˆè¦æ±‚ã€‚ç»“æœå°±æ˜¯æŠŠåŠ£è´¨çš„ä»£ç æ¢ä¸€ç§æ–¹å¼å†™å‡ºæ¥è€Œå·²ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œé‚£å°±æ˜¯ï¼š</p><blockquote><p>ä¼˜ç§€çš„è½¯ä»¶ç”±é«˜è´¨é‡çš„ä»£ç ç¼–å†™è€Œæˆï¼Œè€Œéµä»è½¯ä»¶å¼€å‘åŸåˆ™æ˜¯ä»£ç æˆä¸ºé«˜è´¨é‡ä»£ç çš„æ¡ä»¶ä¹‹ä¸€ï¼Œè®¾è®¡æ¨¡å¼åªæ˜¯è®©ä»£ç éµä»å¼€å‘åŸåˆ™çš„æ–¹æ³•ã€‚</p></blockquote><h2 id="äº”ã€æ­£ç¡®çš„å­¦ä¹ è®¾è®¡æ¨¡å¼"><a href="#äº”ã€æ­£ç¡®çš„å­¦ä¹ è®¾è®¡æ¨¡å¼" class="headerlink" title="äº”ã€æ­£ç¡®çš„å­¦ä¹ è®¾è®¡æ¨¡å¼"></a>äº”ã€æ­£ç¡®çš„å­¦ä¹ è®¾è®¡æ¨¡å¼</h2><p>æœ€åï¼Œå¦‚ä½•æ­£ç¡®çš„å­¦ä¹ è®¾è®¡æ¨¡å¼å‘¢ï¼Ÿ</p><ol><li>å‘ç°è‡ªå·±å†™çš„ä»£ç è¶Šæ¥è¶Šå¤æ‚ï¼ŒBUGè¶Šæ¥è¶Šå¤šã€‚</li><li>å¯»æ±‚æé«˜ä»£ç è´¨é‡çš„æ–¹æ³•ã€‚</li><li>å­¦ä¹ è½¯ä»¶å·¥ç¨‹ã€‚<code>è®¤è¯†åˆ°åˆ«äººä»£ç è´¨é‡é«˜çš„åŸå› ä¹‹ä¸€æ˜¯å› ä¸ºåˆ«äººéµå¾ªäº†è‰¯å¥½è½¯ä»¶å¼€å‘åŸåˆ™ã€‚</code></li><li>å¼€å§‹çœŸæ­£çš„å­¦ä¹ å¹¶è¿ç”¨è®¾è®¡æ¨¡å¼ã€‚</li><li>æœ€åï¼Œæ˜ç™½äº†ä»€ä¹ˆæ—¶å€™åº”è¯¥æ€ä¹ˆç”¨è®¾è®¡æ¨¡å¼ï¼Œæ›´æ¸…æ¥šäº†è½¯ä»¶å·¥ç¨‹çš„é‡è¦æ€§ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶å·¥ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…¨å±€å”¯ä¸€IDç”Ÿæˆæ–¹æ³•æ€»ç»“</title>
      <link href="quan-ju-wei-yi-id-sheng-cheng-fang-fa-zong-jie/"/>
      <url>quan-ju-wei-yi-id-sheng-cheng-fang-fa-zong-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å…¨å±€å”¯ä¸€ID"><a href="#ä¸€ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å…¨å±€å”¯ä¸€ID" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å…¨å±€å”¯ä¸€ID"></a>ä¸€ã€ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å…¨å±€å”¯ä¸€ID</h2><p>åœ¨ä¸€ä¸ªç”±å¤šä¸ªæœåŠ¡å™¨ç»„æˆçš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæœ‰å¾ˆå¤šå¯¹è±¡éƒ½éœ€è¦ä¸€ä¸ªIDæ¥æ ‡è¯†è¯¥å¯¹è±¡ï¼Œä»¥ç¤ºåŒºåˆ†ã€‚è¿™ä¸ªIDåº”è¯¥æ˜¯ç³»ç»Ÿ(å…¨å±€)èŒƒå›´å†…å”¯ä¸€çš„ï¼Œè¿™ç§IDå°±æ˜¯<code>å…¨å±€å”¯ä¸€ID(GUIDï¼ŒGlobally Unique Identifier)</code>ã€‚æ¯”å¦‚ï¼šè´­ç‰©å•†åŸä¸­çš„ç”¨æˆ·IDå’Œè®¢å•IDå°±åº”è¯¥æ˜¯<code>å…¨å±€å”¯ä¸€ID</code>ã€‚</p><h2 id="äºŒã€ç”Ÿæˆå…¨å±€å”¯ä¸€IDè¦æ±‚"><a href="#äºŒã€ç”Ÿæˆå…¨å±€å”¯ä¸€IDè¦æ±‚" class="headerlink" title="äºŒã€ç”Ÿæˆå…¨å±€å”¯ä¸€IDè¦æ±‚"></a>äºŒã€ç”Ÿæˆå…¨å±€å”¯ä¸€IDè¦æ±‚</h2><p>æ—¢ç„¶è¦ä½¿ç”¨<code>å…¨å±€å”¯ä¸€ID</code>ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>ã€‚ç”Ÿæˆæ—¶ä¸»è¦è€ƒè™‘ä»¥ä¸‹é¢å‡ ç‚¹ï¼š</p><ol><li><code>å…¨ç³»ç»ŸèŒƒå›´å†…å”¯ä¸€ã€‚</code> æ˜¾è€Œæ˜“è§ï¼Œå…¨å±€å”¯ä¸€IDè‚¯å®šåº”è¯¥æ˜¯å…¨ç³»ç»Ÿå”¯ä¸€ä¸é‡å¤çš„ã€‚</li><li><code>IDæ˜“äºå­˜å‚¨å’Œæ¯”è¾ƒã€‚</code> <code>å…¨å±€å”¯ä¸€ID</code>çš„å ç”¨ç©ºé—´åº”è¯¥å°½é‡çš„å°ä¸”ä¾¿äºæ¯”è¾ƒã€‚æ¯”å¦‚ï¼šç±»å‹ä¸º64ä½æ•´å½¢(int64)çš„<code>å…¨å±€å”¯ä¸€ID</code>å°±æ˜æ˜¾æ¯”ç±»å‹ä¸ºå­—ç¬¦ä¸²(string)çš„<code>å…¨å±€å”¯ä¸€ID</code>æ›´æ˜“äºå­˜å‚¨å’Œæ¯”è¾ƒï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ›´å¥½ç”¨ã€‚</li><li><code>ç”Ÿæˆç»“æœæ˜¯æœ‰åºé€’å¢(é€’å‡)çš„ã€‚</code> ä¸€èˆ¬ä¼šå°†ç”Ÿæˆåçš„<code>å…¨å±€å”¯ä¸€ID</code>ä½œä¸ºæ•°æ®åº“çš„ä¸»é”®æ¥å­˜å‚¨è¯¥å¯¹è±¡çš„ä¿¡æ¯ã€‚æœ‰åºçš„ä¸»é”®åœ¨æ’å…¥æ•°æ®åº“æ—¶æ€§èƒ½ä¸€èˆ¬ä¼šæ›´å¥½ã€‚</li><li><code>ç”Ÿæˆç»“æœä¸å¯é¢„æµ‹ã€‚</code> ç”Ÿæˆçš„ç»“æœåº”å½“æ˜¯ä¸èƒ½é¢„æµ‹çš„ã€‚å¦‚æœèƒ½å¤Ÿé¢„æµ‹å‡ºä¸‹ä¸€ä¸ªç”Ÿæˆç»“æœï¼ŒåŸºæœ¬ä¸Šå°±èƒ½çŒœæµ‹å‡ºæ‰€æœ‰çš„ç”Ÿæˆç»“æœï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªè®¢å•ç³»ç»Ÿä¸­ï¼Œå°±èƒ½è·å–åˆ°æ‰€æœ‰çš„è®¢å•ä¿¡æ¯ï¼Œè¿™åœ¨å®‰å…¨æ€§ä¸Šæ˜¯éš¾ä»¥æ¥å—çš„ã€‚</li><li><code>ç”Ÿæˆå¿«é€Ÿä¸”ç¨³å®šã€‚</code> åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦é¢‘ç¹çš„ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>ï¼Œä¸€æ—¦ç”Ÿæˆçš„é€Ÿåº¦è¿‡æ…¢ç”šè‡³ç”Ÿæˆæ—¶å¡é¡¿ï¼Œå°†å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å¡é¡¿æˆ–è€…å´©æºƒã€‚æ‰€ä»¥ï¼Œ<code>å…¨å±€å”¯ä¸€ID</code>çš„ç”Ÿæˆåº”å½“æ˜¯å¿«é€Ÿä¸”ç¨³å®šçš„ã€‚</li></ol><h2 id="ä¸‰ã€ç›®å‰æˆç†Ÿçš„ç”Ÿæˆæ–¹æ³•"><a href="#ä¸‰ã€ç›®å‰æˆç†Ÿçš„ç”Ÿæˆæ–¹æ³•" class="headerlink" title="ä¸‰ã€ç›®å‰æˆç†Ÿçš„ç”Ÿæˆæ–¹æ³•"></a>ä¸‰ã€ç›®å‰æˆç†Ÿçš„ç”Ÿæˆæ–¹æ³•</h2><h3 id="1-æ•°æ®åº“è‡ªå¢ID"><a href="#1-æ•°æ®åº“è‡ªå¢ID" class="headerlink" title="1. æ•°æ®åº“è‡ªå¢ID"></a>1. æ•°æ®åº“è‡ªå¢ID</h3><p>å¾ˆå¤šæ•°æ®åº“æä¾›ç”Ÿæˆè‡ªå¢IDçš„åŠŸèƒ½ï¼Œå¦‚MySQLæä¾›äº†å˜é‡<code>auto_increment_offset</code>æ¥è®¾ç½®è‡ªå¢çš„åˆå§‹å€¼ï¼Œå˜é‡<code>auto_increment_increment</code>è®¾ç½®æ¯æ¬¡è‡ªå¢çš„æ­¥é•¿ã€‚å€ŸåŠ©æ•°æ®åº“æä¾›çš„è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å°±èƒ½ç®€å•çš„å®ç°ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>çš„åŠŸèƒ½äº†ã€‚</p><p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼Œé‚£å°±æ˜¯ç®€å•ã€‚ä¸éœ€è¦å¼€å‘ä¸€ä¸ªå•ç‹¬çš„ç³»ç»Ÿï¼Œä¹Ÿä¸éœ€è¦ä¸“äººå»ç»´æŠ¤ã€‚<br>ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼š</p><ol><li><code>ç”Ÿæˆæ€§èƒ½ä¸å¤Ÿå¥½ã€‚</code> æ¯æ¬¡ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>éƒ½éœ€è¦é€šè¿‡ç½‘ç»œè®¿é—®æ•°æ®åº“ä¸€æ¬¡ï¼Œç”Ÿæˆæ—¶é—´å¯èƒ½è¾¾åˆ°å‡ åä¸Šç™¾æ¯«ç§’ã€‚è€Œä¸”åœ¨æ•°æ®åº“å†…éƒ¨ç”Ÿæˆè‡ªå¢IDæ—¶ï¼Œå¸¸å¸¸è¿˜ä¼šåŠ é”ï¼Œå¤šä¸ªåœ°æ–¹åŒæ—¶ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>æ—¶ï¼Œè¿˜éœ€è¦ç«äº‰æŠ¢é”ã€‚å¹¶å‘æ€§èƒ½ä¹Ÿå°±ä¸å¥½ã€‚</li><li><code>ç¨³å®šæ€§ä¸å¤Ÿå¥½ã€‚</code> ä½¿ç”¨æ•°æ®åº“æ¥ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>æ–¹æ³•çš„ç‰¹ç‚¹å°±æ˜¯æ‰€æœ‰éœ€è¦ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>çš„ä¸šåŠ¡éƒ½éœ€è¦è¿æ¥ç›¸åŒçš„æ•°æ®åº“ï¼Œå‹åŠ›é›†ä¸­äºä¸€ç‚¹ã€‚ä¸€æ—¦æ•°æ®åº“å´©æºƒï¼Œå°†ä¸èƒ½ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>ï¼Œè¿™ä¼šä¸¥é‡å½±å“ä½¿ç”¨<code>å…¨å±€å”¯ä¸€ID</code>çš„ä¸šåŠ¡ç³»ç»Ÿã€‚å³ä½¿æ•°æ®åº“é‡‡ç”¨äº†ä¸»ä»ç»“æ„ï¼Œä¹Ÿéš¾ä»¥ä¿è¯åœ¨ä¸»ä»æ•°æ®åº“åˆ‡æ¢æ—¶ï¼Œç”Ÿæˆçš„<code>å…¨å±€å”¯ä¸€ID</code>ä¸é‡å¤ã€‚</li><li><code>ç”Ÿæˆç»“æœå¯ä»¥é¢„æµ‹ã€‚</code> ä¸€æ—¦ç¡®å®šäº†è‡ªå¢åˆå§‹å€¼å’Œè‡ªå¢æ­¥é•¿åï¼ŒåŸºæœ¬ä¸Šä¸ä¼šå†åŠ¨æ€ä¿®æ”¹è¿™ä¸¤ä¸ªå€¼ï¼Œé‚£ä¹ˆæ ¹æ®è¿™ä¸¤ä¸ªå€¼ç”Ÿæˆå‡ºæ¥çš„IDä¹Ÿå°±æ˜¯å¯é¢„æµ‹çš„äº†ã€‚</li></ol><p>è™½ç„¶ä½¿ç”¨æ•°æ®åº“æ¥ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>æœ‰ä¸Šé¢çš„ç§ç§ç¼ºç‚¹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•æ¥æ”¹å–„è¿™äº›é—®é¢˜ï¼š</p><h4 id="A-Flickrçš„åˆ†å¸ƒå¼å”¯ä¸€ä¸»é”®ç”Ÿæˆç®—æ³•"><a href="#A-Flickrçš„åˆ†å¸ƒå¼å”¯ä¸€ä¸»é”®ç”Ÿæˆç®—æ³•" class="headerlink" title="A. Flickrçš„åˆ†å¸ƒå¼å”¯ä¸€ä¸»é”®ç”Ÿæˆç®—æ³•"></a>A. Flickrçš„<a href="https://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/">åˆ†å¸ƒå¼å”¯ä¸€ä¸»é”®ç”Ÿæˆç®—æ³•</a></h4><p>é’ˆå¯¹ä½¿ç”¨æ•°æ®åº“ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>æ€§èƒ½ä¸å¥½çš„é—®é¢˜ï¼ŒFlickræä¾›äº†è¿™æ ·çš„è§£å†³æ–¹æ¡ˆï¼š</p><blockquote><p>éƒ¨ç½²å¤šå°æ•°æ®åº“ï¼Œæ¯å°æ•°æ®åº“è®¾ç½®ä¸åŒçš„è‡ªå¢åˆå§‹å€¼ï¼Œç›¸åŒçš„è‡ªå¢æ­¥é•¿å€¼ã€‚åŒæ—¶è‡ªå¢æ­¥é•¿å€¼å¿…é¡»å¤§äºç­‰äºæ•°æ®åº“çš„æ•°é‡ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ¯å°æ•°æ®éƒ½èƒ½ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>ï¼Œä¸”æ‰€æœ‰ç”Ÿæˆçš„<code>å…¨å±€å”¯ä¸€ID</code>éƒ½ä¸é‡å¤ã€‚</p></blockquote><p>ä¸¾ä¾‹ï¼Œæ¯”å¦‚éƒ¨ç½²äº†ä¸¤å°æ•°æ®åº“ï¼Œå…¶è‡ªå¢åˆå§‹å€¼ï¼Œè‡ªå¢æ­¥é•¿å€¼åŠç»“æœåˆ†åˆ«å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">æ•°æ®åº“</th><th style="text-align:center">è‡ªå¢åˆå§‹å€¼</th><th style="text-align:center">è‡ªå¢æ­¥é•¿å€¼</th><th style="text-align:center">ç”Ÿæˆç»“æœ</th></tr></thead><tbody><tr><td style="text-align:center">æ•°æ®åº“A</td><td style="text-align:center">0</td><td style="text-align:center">2</td><td style="text-align:center">0,2,4,6,8â€¦</td></tr><tr><td style="text-align:center">æ•°æ®åº“B</td><td style="text-align:center">1</td><td style="text-align:center">2</td><td style="text-align:center">1,3,5,7,9â€¦</td></tr></tbody></table></div><p>å®é™…ä½¿ç”¨æ­¤æ–¹æ¡ˆæ—¶ç”Ÿæˆçš„<code>å…¨å±€å”¯ä¸€ID</code>å¯èƒ½ä¸æ˜¯ä¸Šé¢è¿™ç§è¿ç»­çš„ç»“æœï¼ŒMySQLçš„ä¸‹ä¸ªè‡ªå¢IDçš„å®é™…è®¡ç®—å…¬å¼æ˜¯<code>INT(current_value / increment) x increment + offset</code>ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒ<a href="https://stackoverflow.com/questions/35766521/mysql-master-master-replication-causing-missing-autoincrement-values/">MySql Master-Master Replication Causing Missing AutoIncrement Values</a>ã€‚</p><p>Flickr<a href="https://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/">åˆ†å¸ƒå¼å”¯ä¸€ä¸»é”®ç”Ÿæˆç®—æ³•</a>çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p><blockquote><p>åˆ†æ•£å•ç‚¹æ•°æ®åº“çš„å‹åŠ›åˆ°äº†å¤šç‚¹æ•°æ®åº“ï¼Œä»è€Œåœ¨æå‡äº†ç”Ÿæˆçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p></blockquote><p>ä½†æ˜¯è¿™ç§æ–¹æ³•ä¸­æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼Œé‚£å°±æ˜¯å› ä¸ºè¦æå‰çš„ç¡®å®šè‡ªå¢çš„æ­¥é•¿ï¼Œæ‰€ä»¥æ‰©å±•æ€§å¾ˆå·®ã€‚</p><h4 id="B-ç¾å›¢çš„Leaf-segmentç®—æ³•"><a href="#B-ç¾å›¢çš„Leaf-segmentç®—æ³•" class="headerlink" title="B. ç¾å›¢çš„Leaf-segmentç®—æ³•"></a>B. ç¾å›¢çš„<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leaf-segmentç®—æ³•</a></h4><p>åŒæ ·æ˜¯é’ˆå¯¹ä½¿ç”¨æ•°æ®åº“ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>æ€§èƒ½ä¸å¥½çš„é—®é¢˜ï¼Œç¾å›¢æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p><blockquote><p>ä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„è‡ªå¢IDã€‚åŒä¸€ä¸ªä¸šåŠ¡ä¸€æ¬¡è·å–å¤šä¸ª<code>å…¨å±€å”¯ä¸€ID</code>ï¼Œç¼“å­˜èµ·æ¥æ…¢æ…¢ä½¿ç”¨ã€‚åŒæ—¶åœ¨è¦ç”¨å®Œæ—¶å‰å°±å†æ¬¡å¼‚æ­¥è·å–æ–°çš„<code>å…¨å±€å”¯ä¸€ID</code>ç¼“å­˜èµ·æ¥å¤‡ç”¨ï¼Œå°±èƒ½ä¸ºä¸šåŠ¡æä¾›æŒç»­ä¸æ–­çš„<code>å…¨å±€å”¯ä¸€ID</code>ç”ŸæˆåŠŸèƒ½ã€‚</p></blockquote><p>ä¸¾ä¾‹ï¼Œç³»ç»Ÿä¸­æœ‰ç”¨æˆ·å’Œè®¢å•éƒ½éœ€è¦ä½¿ç”¨<code>å…¨å±€å”¯ä¸€ID</code>æ¥æ ‡è¯†ã€‚é‚£ä¹ˆæ•°æ®åº“ä¸­å°±åˆ†åˆ«ä¸ºç”¨æˆ·å’Œè®¢å•ä½¿ç”¨ä¸åŒçš„è‡ªå¢IDã€‚æ¯æ¬¡è·å–10000ä¸ª<code>å…¨å±€å”¯ä¸€ID</code>ã€‚å¹¶è§„å®šå½“å‰æ¶ˆè€—10%çš„<code>å…¨å±€å”¯ä¸€ID</code>å°±é©¬ä¸Šå¼‚æ­¥çš„è·å–ä¸‹ä¸€æ‰¹å¹¶å°†ç»“æœç¼“å­˜èµ·æ¥å¤‡ç”¨ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">è‡ªå¢ID</th><th style="text-align:center">è‡ªå¢åˆå§‹å€¼</th><th style="text-align:center">è‡ªå¢æ­¥é•¿å€¼</th><th style="text-align:center">ç”Ÿæˆç»“æœ</th></tr></thead><tbody><tr><td style="text-align:center">ç”¨æˆ·</td><td style="text-align:center">0</td><td style="text-align:center">10000</td><td style="text-align:center">0,10000,20000â€¦</td></tr><tr><td style="text-align:center">è®¢å•</td><td style="text-align:center">0</td><td style="text-align:center">10000</td><td style="text-align:center">0,10000,20000â€¦</td></tr></tbody></table></div><p>ç¾å›¢<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leaf-segmentç®—æ³•</a>çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæ‰¹é‡è·å–å’Œæå‰ç¼“å­˜ã€‚</p><ul><li>æ‰¹é‡è·å–çš„åŒæ—¶ï¼Œä¹Ÿå‡å°‘è¯·æ±‚æ•°æ®åº“çš„æ¬¡æ•°ï¼Œä¹Ÿå°±é™ä½äº†æ•°æ®åº“çš„å‹åŠ›ã€‚</li><li>è€Œæå‰ç¼“å­˜åˆ™æ˜¯ä¿è¯äº†å³ä½¿åœ¨ç½‘ç»œæ³¢åŠ¨æ—¶å’Œä¸šåŠ¡é«˜å³°æ—¶éƒ½èƒ½å¤ŸæŒç»­ä¸é˜»å¡çš„ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>ã€‚</li></ul><h3 id="2-UUIDç®—æ³•"><a href="#2-UUIDç®—æ³•" class="headerlink" title="2. UUIDç®—æ³•"></a>2. UUIDç®—æ³•</h3><p>UUIDçš„å…¨ç§°æ˜¯Universally Unique Identifierï¼Œä¸­æ–‡åä¸ºé€šç”¨å”¯ä¸€è¯†åˆ«ç ã€‚</p><p>UUIDåŒ…å«32ä¸ª16è¿›åˆ¶çš„æ•°å­—ï¼Œå¤§å°æ˜¯16å­—èŠ‚128ä¸ºï¼Œä¸€èˆ¬ä»¥è¿å­—å·åˆ†ä¸ºäº”æ®µï¼Œå½¢å¼ä¸º8-4-4-4-12çš„36ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚ï¼š12fae663-e3dd-4b9e-b1a9-b7e598d2f853ã€‚å…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒUUIDçš„IETFæ ‡å‡†<a href="https://www.ietf.org/rfc/rfc4122.txt">A Universally Unique IDentifier (UUID) URN Namespace</a>ã€‚</p><p>UUIDç”Ÿæˆçš„ç®—æ³•ä¸»è¦æœ‰5ç§ï¼Œéƒ½ä¸éœ€è¦è”ç½‘ï¼Œæœ¬åœ°å³å¯ç”Ÿæˆã€‚æ‰€ä»¥ï¼Œä½¿ç”¨UUIDç®—æ³•ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>çš„ä¼˜ç‚¹æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œé‚£å°±æ˜¯ï¼š<code>é«˜æ€§èƒ½ä¸”éš¾äºé¢„æµ‹ç»“æœ</code>ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p><ol><li><code>UUIDä¸æ˜“å­˜å‚¨å’Œä½¿ç”¨ã€‚</code> ç›®å‰çš„ä¸»æµç¼–ç¨‹è¯­è¨€å’Œæ•°æ®åº“ï¼Œæœ€å¤§æ”¯æŒ64ä½çš„æ•´æ•°ã€‚128ä½çš„UUIDéš¾ä»¥åŸç”Ÿçš„ä»¥æ•´æ•°æ–¹å¼å­˜å‚¨å’Œä½¿ç”¨ã€‚</li><li><code>UUIDä¸æ˜¯æœ‰åºé€’å¢(é€’å‡)çš„ã€‚</code> UUIDç®—æ³•ç”Ÿæˆå‡ºæ¥çš„IDä¸€èˆ¬ä¸æ˜¯æœ‰åºçš„ï¼Œè¿™å¯¹å°†UUIDä½œä¸ºä¸»é”®å­˜å…¥æ•°æ®åº“çš„ä½¿ç”¨æ–¹å¼æ¥è¯´å¹¶ä¸å‹å¥½ã€‚</li></ol><p>åŸºäºä¸Šé¢çš„ç¼ºç‚¹ï¼ŒUUIDå¾ˆå°‘ä½œä¸º<code>å…¨å±€å”¯ä¸€ID</code>æ¥ä½¿ç”¨ã€‚</p><h3 id="3-å­—èŠ‚-ä½-åˆ†æ®µç®—æ³•"><a href="#3-å­—èŠ‚-ä½-åˆ†æ®µç®—æ³•" class="headerlink" title="3. å­—èŠ‚(ä½)åˆ†æ®µç®—æ³•"></a>3. å­—èŠ‚(ä½)åˆ†æ®µç®—æ³•</h3><p>è¿™ç§ç®—æ³•çš„æ€æƒ³å…¶å®æ¥è‡ªTwitterçš„<a href="https://github.com/twitter-archive/snowflake">é›ªèŠ±ç®—æ³•</a>ï¼Œå…¶ä»–çš„åŒç±»ç®—æ³•éƒ½æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šçš„ä¸€äº›å˜ç§ã€‚ç®—æ³•æ ¸å¿ƒæ˜¯ï¼š</p><blockquote><p>å°†ç»„æˆ<code>å…¨å±€å”¯ä¸€ID</code>çš„å¤šä¸ªå­—èŠ‚çœ‹åšä¸€ä¸ªæ•´ä½“ï¼Œå¹¶å…¶åˆ’åˆ†æˆä¸åŒçš„æ®µï¼Œåˆ†åˆ«æ§åˆ¶ä¸åŒæ®µçš„å€¼ã€‚</p></blockquote><p>è¯¥ç®—æ³•å…·æœ‰ä¸UUIDç®—æ³•ç›¸åŒçš„å¥½å¤„ï¼Œé‚£å°±æ˜¯éƒ½ä¸éœ€è¦è”ç½‘ï¼Œæœ¬åœ°å³å¯ç”Ÿæˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æ”¯æŒå¤šä¸ªæœåŠ¡å™¨åŒæ—¶ç”Ÿæˆï¼Œä¸”ç”Ÿæˆçš„ç»“æœæ€»ä½“çš„ä¿æŒé€’å¢æˆ–é€’å‡ã€‚åœ¨æ§åˆ¶å­—èŠ‚å¤§å°çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½è¾ƒå¥½çš„å­˜å‚¨å’Œæ¯”è¾ƒã€‚</p><h4 id="A-Twitterçš„é›ªèŠ±ç®—æ³•"><a href="#A-Twitterçš„é›ªèŠ±ç®—æ³•" class="headerlink" title="A. Twitterçš„é›ªèŠ±ç®—æ³•"></a>A. Twitterçš„<a href="https://github.com/twitter-archive/snowflake">é›ªèŠ±ç®—æ³•</a></h4><p>è¯¥ç®—æ³•ç”Ÿæˆçš„<code>å…¨å±€å”¯ä¸€ID</code>çš„å¤§å°ä¸º64å­—èŠ‚ï¼Œèƒ½å¤Ÿä½¿ç”¨64ä½æ•´å‹æ¥å­˜å‚¨ã€‚å…¶æ ¼å¼ä¸ºï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+------------------------------------------------------------------------------------+| UNUSED(1BIT) |     TIMESTAMP(41BIT)     |  MACHINE-ID(10BIT)  |   SERIAL-NO(12BIT) |+------------------------------------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ï¼š</p><ul><li><code>1ä½ä¸ç”¨ã€‚</code> æœ€é«˜ä½ä¸ç”¨ï¼Œå›ºå®šä¸º0ã€‚å› ä¸ºäºŒè¿›åˆ¶ä¸­æœ€é«˜ä½ä¸º1çš„è¡¨ç¤ºæ˜¯è´Ÿæ•°ï¼Œè€Œæˆ‘ä»¬ä¸€èˆ¬æ•´æ•°æ¥è¡¨ç¤ºIDï¼Œä¸å¸Œæœ›æœ‰è´Ÿæ•°çš„IDï¼Œæ‰€ä»¥ä¸ç”¨ã€‚</li><li><code>41ä½çš„æ—¶é—´æˆ³ã€‚</code> ç”¨41ä½çš„ç©ºé—´æ¥è¡¨ç¤ºå•ä½ä¸ºæ¯«ç§’çš„æ—¶é—´æˆ³ï¼Œå¤§çº¦å¯ä»¥è¡¨ç¤º<code>(1L &lt;&lt; 41) /ï¼ˆ1000 * 60 * 60 * 24 * 365ï¼‰= 69</code>å¹´çš„æ—¶é—´ã€‚</li><li><code>10ä½çš„æœºå™¨ä½ã€‚</code> ç”¨æ¥åŒºåˆ†ä¸åŒæœåŠ¡å™¨ç”Ÿæˆå‡ºæ¥çš„IDã€‚10ä½ç©ºé—´æœ€å¤šå¯ä»¥è¡¨ç¤º(1L &lt;&lt; 10) = 1024å°æœåŠ¡å™¨ã€‚</li><li><code>12ä½çš„åºåˆ—åŒ–ã€‚</code> ç”¨12ä½ç©ºé—´æ¥å­˜å‚¨åœ¨åŒä¸€æ¯«ç§’å†…ï¼ŒåŒä¸€å°æœåŠ¡å™¨ç”Ÿæˆå‡ºæ¥çš„IDæ•°é‡ã€‚æœ€å¤šå¯ä»¥å­˜å‚¨(1L &lt;&lt; 12) = 4096ä¸ªã€‚</li></ul><p>ä½¿ç”¨Twitterçš„<a href="https://github.com/twitter-archive/snowflake">é›ªèŠ±ç®—æ³•</a>åªæœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå°±æ˜¯ï¼š</p><blockquote><p>ç®—æ³•é«˜åº¦ä¾èµ–æ—¶é—´æˆ³ï¼Œå¦‚æœå„ä¸ªç”ŸæˆIDçš„æœåŠ¡å™¨æ—¶é—´ä¸åŒæ­¥ï¼Œå°†ä¼šå¯¼è‡´ç”Ÿæˆå‡ºæ¥çš„IDæ˜¯ä¹±åºæˆ–è€…é‡å¤çš„ã€‚</p></blockquote><h4 id="B-ç™¾åº¦çš„UidGeneratorç®—æ³•"><a href="#B-ç™¾åº¦çš„UidGeneratorç®—æ³•" class="headerlink" title="B. ç™¾åº¦çš„UidGeneratorç®—æ³•"></a>B. ç™¾åº¦çš„<a href="https://github.com/baidu/uid-generator">UidGeneratorç®—æ³•</a></h4><p>ç™¾åº¦<a href="https://github.com/baidu/uid-generator">UidGeneratorç®—æ³•</a>ä¸Twitter<a href="https://github.com/twitter-archive/snowflake">é›ªèŠ±ç®—æ³•</a>çš„ä¸»è¦åŒºåˆ«åœ¨äºè°ƒæ•´äº†å„ä¸ªåˆ†æ®µçš„å¤§å°ï¼Œæ”¹å˜äº†å„ä¸ªåˆ†åº¦çš„æ„ä¹‰ï¼Œæœ¬è´¨æ²¡å˜ã€‚</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">+-------------------------------------------------------------------------------------+| UNUSED(1BIT) |  DELTA SECONDS(28BIT)  |  WORKER-NODE-ID(22BIT)  |  SERIAL-NO(13BIT) |+-------------------------------------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><code>1ä½ä¸ç”¨ã€‚</code> æœ€é«˜ä½ä¾æ—§ä¸ç”¨ï¼Œå›ºå®šä¸º0ã€‚</li><li><code>28ä½çš„æ—¶é—´å·®ã€‚</code> è¡¨ç¤ºå½“å‰æ—¶é—´ç›¸å¯¹ä¸â€2016-05-20â€çš„å·®å€¼ï¼Œå•ä½ä¸ºç§’ã€‚æœ€å¤šå¯æ”¯æŒçº¦8.7å¹´ã€‚</li><li><code>22ä½çš„æœºå™¨ä½ã€‚</code> è¡¨ç¤ºæœºå™¨IDã€‚æ¯æ¬¡æœºå™¨é‡å¯åéƒ½åºŸå¼ƒé‡æ–°ä»æ•°æ®åº“ç”³è¯·ï¼Œæœ€å¤šå¯æ”¯æŒçº¦420wæ¬¡æœºå™¨å¯åŠ¨ã€‚</li><li><code>13ä½çš„åºåˆ—åŒ–ã€‚</code> æ¯ç§’ä¸‹çš„å¹¶å‘åºåˆ—ï¼Œå¯æ”¯æŒæ¯ç§’8192ä¸ªå¹¶å‘ã€‚</li></ul><h4 id="C-ç¾å›¢çš„Leaf-snowflakeç®—æ³•"><a href="#C-ç¾å›¢çš„Leaf-snowflakeç®—æ³•" class="headerlink" title="C. ç¾å›¢çš„Leaf-snowflakeç®—æ³•"></a>C. ç¾å›¢çš„<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leaf-snowflakeç®—æ³•</a></h4><p>ç¾å›¢<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leaf-snowflakeç®—æ³•</a>æ²¿ç”¨äº†Twitter<a href="https://github.com/twitter-archive/snowflake">é›ªèŠ±ç®—æ³•</a>å„ä¸ªå­—æ®µçš„æ„ä¹‰ï¼Œä½†æ˜¯æ‰©å±•äº†ç®—æ³•çš„ä½¿ç”¨æ–¹å¼ï¼Œæé«˜äº†ç®—æ³•çš„æ˜“ç”¨æ€§å’Œåœ¨æ—¶é’Ÿä¹±åºæ—¶çš„å®¹é”™æ€§ã€‚</p><h5 id="æå‡ç®—æ³•çš„æ˜“ç”¨æ€§"><a href="#æå‡ç®—æ³•çš„æ˜“ç”¨æ€§" class="headerlink" title="æå‡ç®—æ³•çš„æ˜“ç”¨æ€§"></a>æå‡ç®—æ³•çš„æ˜“ç”¨æ€§</h5><p>åœ¨ç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>çš„æœåŠ¡å™¨é›†ç¾¤ä¸­åŠ å…¥äº†Zookeeperã€‚æ¯æ¬¡æœåŠ¡å™¨å¯åŠ¨æ—¶éƒ½å»ZooKeeperè¯»å–(ä¸å­˜åœ¨æ—¶åˆ™æ³¨å†Œ)è‡ªå·±çš„ç”¨äºç”Ÿæˆ<code>å…¨å±€å”¯ä¸€ID</code>æ—¶çš„æœåŠ¡å™¨IDå€¼ã€‚å› ä¸ºæœåŠ¡å™¨IDä¸€èˆ¬ä¸ä¼šå˜ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™ä¸ªå€¼ç¼“å­˜èµ·æ¥ï¼Œå³ä½¿ä»¥åé‡åˆ°è¿æ¥ZooKeeperæ—¶ï¼Œä¹Ÿèƒ½æ­£å¸¸çš„å¯åŠ¨æœåŠ¡å™¨ï¼Œå¹¶æä¾›ç”ŸæˆIDçš„æœåŠ¡ã€‚</p><h5 id="æå‡æ—¶é’Ÿä¹±åºæ—¶çš„å®¹é”™æ€§"><a href="#æå‡æ—¶é’Ÿä¹±åºæ—¶çš„å®¹é”™æ€§" class="headerlink" title="æå‡æ—¶é’Ÿä¹±åºæ—¶çš„å®¹é”™æ€§"></a>æå‡æ—¶é’Ÿä¹±åºæ—¶çš„å®¹é”™æ€§</h5><p>æœåŠ¡å™¨ä¼šåœ¨å¯åŠ¨æ—¶åˆ¤æ–­æ—¶é’Ÿå‘ç”Ÿæ˜¯å¦å‘ç”Ÿäº†å›æ‹¨ï¼Œå…·ä½“ç»†èŠ‚å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼ŒZookeeperæ— æ­¤æœåŠ¡å™¨çš„æ—¶é—´è®°å½•ï¼Œé‚£ä¹ˆå°±åˆ¤æ–­å½“å‰æœåŠ¡å™¨çš„æ—¶é—´å’Œå…¶ä»–çš„è¿è¡Œ<a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leaf-snowflakeç®—æ³•</a>æœåŠ¡å™¨çš„æ—¶é—´çš„å¹³å‡å€¼(é€šè¿‡RPCè·å–)ä¹‹é—´çš„å·®å€¼ï¼Œå¦‚æœå·®å€¼å¤§äºæŸä¸ªé˜ˆå€¼ï¼Œè®¤ä¸ºæœ¬æœºç³»ç»Ÿæ—¶é—´å‘ç”Ÿå¤§æ­¥é•¿åç§»ï¼Œå¯åŠ¨å¤±è´¥å¹¶æŠ¥è­¦ã€‚</li><li>å¦‚æœæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼ŒZookeeperå·²ç»æœ‰æ­¤æœåŠ¡å™¨çš„æ—¶é—´è®°å½•ï¼Œä¸”å½“å‰æœåŠ¡å™¨çš„æ—¶é—´å°äºè®°å½•çš„æ—¶é—´ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæœåŠ¡å™¨æ—¶é—´å‘ç”Ÿäº†å¤§æ­¥é•¿å›æ‹¨ï¼ŒæœåŠ¡å¯åŠ¨å¤±è´¥å¹¶æŠ¥è­¦ã€‚</li><li>æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨åï¼Œå®šæ—¶(å¦‚æ¯éš”3ç§’)çš„å‘Zookeeperè®°å½•æœ¬æœåŠ¡å™¨å½“å‰æ—¶é—´ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è´Ÿè½½å‡è¡¡ç®€ä»‹</title>
      <link href="fu-zai-jun-heng-jian-jie/"/>
      <url>fu-zai-jun-heng-jian-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è´Ÿè½½å‡è¡¡"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è´Ÿè½½å‡è¡¡" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è´Ÿè½½å‡è¡¡"></a>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è´Ÿè½½å‡è¡¡</h2><p>éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œä¸šåŠ¡çš„æµé‡ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œä»¥å‰å•å°æœåŠ¡å™¨æä¾›çš„æœåŠ¡ï¼Œæ— è®ºå¦‚ä½•ä¼˜åŒ–ï¼Œéƒ½ä¸èƒ½æ»¡è¶³ç°æœ‰ä¸šåŠ¡çš„éœ€æ±‚ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦å°†ä¸šåŠ¡æµé‡åˆ†æ‘Šåˆ°å¤šä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šæ¥å‡å°‘å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ã€‚è€Œ<code>è´Ÿè½½å‡è¡¡(Load Balance)</code>å°±æ˜¯ç”¨æ¥å°†ä¸šåŠ¡æµé‡åˆ†å‘åˆ°ä¸ç”¨çš„æœåŠ¡å™¨ä¸Šé¢çš„ã€‚</p><h2 id="äºŒã€ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡"><a href="#äºŒã€ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡" class="headerlink" title="äºŒã€ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡"></a>äºŒã€ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">+---------------------------------------------------------------------------+|                                                                           ||                                                             +----------+  ||                                                             |          |  ||                                              +------------&gt; |  Server  |  ||                                              |              |          |  ||                                              |              +----------+  ||                                              |                            ||  +----------+         +----------------+     |              +----------+  ||  |          |         |                |     |              |          |  ||  |  Client  | +-----&gt; |  Load Balance  | +----------------&gt; |  Server  |  ||  |          |         |                |     |              |          |  ||  +----------+         +----------------+     |              +----------+  ||                                              |                            ||                                              |              +----------+  ||                                              |              |          |  ||                                              +------------&gt; |  Server  |  ||                                                             |          |  ||                                                             +----------+  ||                                                                           |+---------------------------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è´Ÿè½½å‡è¡¡(è½¯ä»¶æˆ–ç¡¬ä»¶)ä¼šå°†æ‰€æœ‰çš„å®¢æˆ·ç«¯æµé‡ï¼Œé€šè¿‡ç‰¹å®šçš„è°ƒåº¦ç®—æ³•åˆ†å‘åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ä¸Šï¼ŒåŒæ—¶è¿˜ä¼šç›‘æ§åç«¯æœåŠ¡å™¨çš„å‹åŠ›å’Œç›‘æ§çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨æŸäº›åç«¯æœåŠ¡å™¨å‹åŠ›è¿‡å¤§æˆ–æ•…éšœæ—¶ï¼Œå‡å°‘å¯¹è¯¥æœåŠ¡å™¨çš„æµé‡åˆ†å‘ï¼Œä»è€Œä¿è¯äº†æ•´ä¸ªä¸šåŠ¡çš„ç¨³å®šã€‚</p><h2 id="ä¸‰ã€åˆ©ç”¨DNSå®ç°è´Ÿè½½å‡è¡¡"><a href="#ä¸‰ã€åˆ©ç”¨DNSå®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="ä¸‰ã€åˆ©ç”¨DNSå®ç°è´Ÿè½½å‡è¡¡"></a>ä¸‰ã€åˆ©ç”¨DNSå®ç°è´Ÿè½½å‡è¡¡</h2><p>æ—©æœŸè§£å†³å•ä¸ªæœåŠ¡å™¨å‹åŠ›è¿‡å¤§çš„æ–¹æ³•ä¹‹ä¸€æ˜¯åˆ©ç”¨DNSå°†åŸŸåè§£æåˆ°ä¸åŒçš„IPçš„æ–¹å¼æ¥å®ç°çš„ã€‚å¦‚ï¼šå®¢æˆ·ç«¯åœ¨ä¸åŒçš„åœ°åŒºè§£æç›¸åŒçš„åŸŸåæ—¶ï¼ŒDNSè§£æå‡ºç¦»å®¢æˆ·ç«¯æœ€è¿‘çš„æœåŠ¡å™¨IPã€‚è¿™æ ·ï¼Œä¸åŒçš„å®¢æˆ·ç«¯å°±è¿æ¥åˆ°æä¾›äº†ç›¸åŒæœåŠ¡ä½†æ˜¯æœºå™¨ä¸åŒçš„æœåŠ¡å™¨ã€‚ä»è€Œåˆ†æ•£äº†æœåŠ¡å™¨å‹åŠ›ï¼ŒåŒæ—¶ä¹Ÿç¼©çŸ­æœåŠ¡å“åº”æ—¶é—´ã€‚è¿™ä¹Ÿæ˜¯CDNåŸç†ã€‚</p><p>åˆ©ç”¨DNSæ¥å®ç°è´Ÿè½½å‡è¡¡å¥½å¤„æœ‰æˆæœ¬ä½ï¼Œå®ç°ç®€å•ç­‰ã€‚ä½†æ˜¯å¼Šç«¯ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼š</p><ol><li><code>æµé‡åˆ†å‘çš„ä¸å¤Ÿå‡åŒ€ã€‚</code> DNSåœ¨è§£æIPæ—¶ï¼Œèƒ½å¤Ÿæ ¹æ®å®¢æˆ·ç«¯åœ°ç†ä½ç½®æ¥åˆ†å‘æµé‡ï¼Œä½†æ˜¯æ²¡æ³•æ ¹æ®åç«¯æœåŠ¡å™¨çš„å®é™…å‹åŠ›æ¥åˆ†å‘æµé‡ã€‚è¿™æ ·å°±å¯èƒ½ä¼šå‡ºç°ä¸€å°æœåŠ¡å™¨å‹åŠ›æ»¡è½½ï¼Œè€Œå…¶ä»–çš„æœåŠ¡å™¨æ— å‹åŠ›çš„æƒ…å†µã€‚</li><li><code>æ”¯æŒçš„åˆ†å‘ç­–ç•¥å°‘ã€‚</code>DNSä¸€èˆ¬åªæ”¯æŒè½®è¯¢æ–¹å¼æ¥è§£æã€‚å¤§å¤§çš„é™åˆ¶äº†ä½¿ç”¨åœºæ™¯ã€‚</li><li><code>æœåŠ¡å™¨æ•…éšœæ—¶åˆ‡æ¢å»¶è¿Ÿå¤§ã€‚</code> ç”±äºDNSæœåŠ¡å™¨æ˜¯å¤šå±‚ï¼Œä¸”å„å±‚æœåŠ¡å™¨ä¸­æœ‰ç¼“å­˜ï¼Œå¯¼è‡´äº†DNSä¿®æ”¹åä¸èƒ½ç«‹å³ç”Ÿæ•ˆã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªåç«¯æœåŠ¡å™¨å´©æºƒåœæ­¢æœåŠ¡å™¨ï¼Œå³ä½¿æˆ‘ä»¬ç«‹å³ä¿®æ”¹DNSï¼Œéƒ¨åˆ†çš„å®¢æˆ·ç«¯ä¹Ÿæ— æ³•ç«‹å³æ¢å¤æœåŠ¡ã€‚è¿™ä¼šä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒã€‚</li><li><code>DNSåŠ«æŒå’Œç¼“å­˜æ±¡æŸ“å¯¼è‡´çš„å®‰å…¨é—®é¢˜ã€‚</code> ç”±äºDNSå­˜åœ¨è¢«åŠ«æŒå’Œç¼“å­˜è¢«æ±¡æŸ“å¯èƒ½ï¼Œè¿™ä¼šå¯¼è‡´åŸŸåè§£æå‡ºæ¥çš„IPå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æœåŠ¡å™¨çš„IPï¼Œä»è€Œä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿æ¥åˆ°äº†é”™è¯¯çš„æœåŠ¡å™¨ï¼Œé€ æˆå®‰å…¨é—®é¢˜ã€‚</li></ol><p>æ‰€ä»¥ä¸¥æ ¼æ¥è¯´ï¼Œä½¿ç”¨DNSåªèƒ½ç®—æ˜¯åˆ†å‘æµé‡ï¼Œè€Œä¸èƒ½ç®—ä½œçœŸæ­£çš„è´Ÿè½½å‡è¡¡ã€‚</p><blockquote><p>Tips:</p><ol><li><code>DNSåŠ«æŒ:</code> DNSæœåŠ¡å™¨è¢«æ§åˆ¶ï¼ŒæŸ¥è¯¢DNSæ—¶ï¼ŒæœåŠ¡å™¨ç›´æ¥è¿”å›ç»™ä½ å®ƒæƒ³è®©ä½ çœ‹çš„ä¿¡æ¯ã€‚</li><li><code>DNSç¼“å­˜æ±¡æŸ“:</code> é»‘å®¢é€šè¿‡æŠ€æœ¯æ‰‹æ®µä½¿ç”¨æˆ·æŸ¥è¯¢åˆ°è™šå‡è§£æä¿¡æ¯ã€‚</li></ol></blockquote><h2 id="å››ã€åŸºäºOSIåˆ†å±‚åˆ†ç±»çš„è´Ÿè½½å‡è¡¡"><a href="#å››ã€åŸºäºOSIåˆ†å±‚åˆ†ç±»çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="å››ã€åŸºäºOSIåˆ†å±‚åˆ†ç±»çš„è´Ÿè½½å‡è¡¡"></a>å››ã€åŸºäºOSIåˆ†å±‚åˆ†ç±»çš„è´Ÿè½½å‡è¡¡</h2><div class="table-container"><table><thead><tr><th style="text-align:center">å±‚çº§</th><th style="text-align:center">OSIå‚è€ƒæ¨¡å‹</th><th style="text-align:center">å„å±‚è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:center">7</td><td style="text-align:center">åº”ç”¨å±‚(Application)</td><td style="text-align:center">æä¾›ç½‘ç»œä¸ç”¨æˆ·åº”ç”¨è½¯ä»¶ä¹‹é—´çš„æ¥å£æœåŠ¡</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">è¡¨è¾¾å±‚(Presentation)</td><td style="text-align:center">æä¾›æ ¼å¼åŒ–çš„è¡¨ç¤ºå’Œè½¬æ¢æ•°æ®æœåŠ¡ï¼Œå¦‚åŠ å¯†å’Œå‹ç¼©</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">ä¼šè¯å±‚(Session)</td><td style="text-align:center">æä¾›åŒ…æ‹¬è®¿é—®éªŒè¯å’Œä¼šè¯ç®¡ç†åœ¨å†…çš„å»ºç«‹å’Œç»´æŠ¤åº”ç”¨ä¹‹é—´é€šä¿¡çš„æœºåˆ¶</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">ä¼ è¾“å±‚(Transimission)</td><td style="text-align:center">æä¾›å»ºç«‹ã€ç»´æŠ¤å’Œå–æ¶ˆä¼ è¾“è¿æ¥åŠŸèƒ½ï¼Œè´Ÿè´£å¯é åœ°ä¼ è¾“æ•°æ®(PC)</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">ç½‘ç»œå±‚(Network)</td><td style="text-align:center">å¤„ç†ç½‘ç»œé—´è·¯ç”±ï¼Œç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€(è·¯ç”±å™¨)</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">æ•°æ®é“¾è·¯å±‚(DataLink)</td><td style="text-align:center">è´Ÿè´£æ— é”™ä¼ è¾“æ•°æ®ï¼Œç¡®è®¤å¸§ã€å‘é”™é‡ä¼ ç­‰(äº¤æ¢æœº)</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">ç‰©ç†å±‚(Physics)</td><td style="text-align:center">æä¾›æœºæ¢°ã€ç”µæ°”ã€åŠŸèƒ½å’Œè¿‡ç¨‹ç‰¹æ€§(ç½‘å¡ã€ç½‘çº¿ã€åŒç»çº¿ã€åŒè½´ç”µç¼†ã€ä¸­ç»§å™¨)</td></tr></tbody></table></div><p>å‚è€ƒOSIçš„ä¸ƒå±‚æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p><ol><li>åœ¨ç¬¬äºŒå±‚(æ•°æ®é“¾è·¯å±‚)åšåŸºäºMACåœ°å€çš„<code>äºŒå±‚è´Ÿè½½å‡è¡¡</code>ã€‚é€šè¿‡ä¸€ä¸ªè™šæ‹ŸMACåœ°å€æ¥æ”¶è¯·æ±‚ï¼Œç„¶åå†å°†æ•°æ®è½¬å‘åˆ°çœŸå®çš„MACåœ°å€ã€‚</li><li>åœ¨ç¬¬ä¸‰å±‚(ç½‘ç»œå±‚)åšåŸºäºIPåœ°å€çš„<code>ä¸‰å±‚è´Ÿè½½å‡è¡¡</code>ã€‚é€šè¿‡ä¸€ä¸ªè™šæ‹ŸIPåœ°å€æ¥æ”¶è¯·æ±‚ï¼Œç„¶åå†å°†æ•°æ®è½¬å‘åˆ°çœŸå®çš„IPåœ°å€ã€‚</li><li>åœ¨ç¬¬å››å±‚(ä¼ è¾“å±‚)åšåŸºäºIPå’Œç«¯å£çš„<code>å››å±‚è´Ÿè½½å‡è¡¡</code>ã€‚é€šè¿‡ä¸€ä¸ªè™šæ‹ŸIPåœ°å€å’Œç«¯å£æ¥æ”¶è¯·æ±‚ï¼Œç„¶åå†å°†æ•°æ®è½¬å‘åˆ°çœŸå®çš„IPåœ°å€å’Œç«¯å£ã€‚</li><li>åœ¨ç¬¬ä¸ƒå±‚(åº”ç”¨å±‚)åšåŸºäºåº”ç”¨å±‚ä¿¡æ¯(å¦‚ï¼šURL)çš„<code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>ã€‚é€šè¿‡ä¸€ä¸ªè™šæ‹Ÿçš„URLæ¥æ”¶è¯·æ±‚ï¼Œç„¶åå†å°†æ•°æ®è½¬å‘åˆ°çœŸå®URLæ‰€åœ¨çš„æœåŠ¡å™¨ã€‚</li></ol><p>å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡æœ‰ï¼š<a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡">ä¸ƒå±‚è´Ÿè½½å‡è¡¡</a>å’Œ<a href="#å››å±‚è´Ÿè½½å‡è¡¡">å››å±‚è´Ÿè½½å‡è¡¡</a>ã€‚</p><blockquote><p>Tips:</p><ol><li>DNSå±äºåº”ç”¨å±‚çš„åè®®ï¼Œæ‰€ä»¥<a href="#åˆ©ç”¨DNSå®ç°è´Ÿè½½å‡è¡¡">åˆ©ç”¨DNSå®ç°è´Ÿè½½å‡è¡¡</a>ç®—æ˜¯<a href="#ä¸ƒå±‚è´Ÿè½½å‡è¡¡">ä¸ƒå±‚è´Ÿè½½å‡è¡¡</a>ã€‚</li></ol></blockquote><h2 id="äº”ã€ä¸ƒå±‚è´Ÿè½½å‡è¡¡"><a href="#äº”ã€ä¸ƒå±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="äº”ã€ä¸ƒå±‚è´Ÿè½½å‡è¡¡"></a>äº”ã€ä¸ƒå±‚è´Ÿè½½å‡è¡¡</h2><p><code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>å·¥ä½œåœ¨OSIçš„ç¬¬ä¸ƒå±‚(ä¼ è¾“å±‚)ï¼Œä½äºç¬¬å››å±‚(åº”ç”¨å±‚)ä¹‹ä¸Šï¼Œæ‰€ä»¥éœ€è¦å®Œæ•´çš„TCP/IPåè®®æ ˆçš„å®ç°ï¼Œè¿™ä¹Ÿè®©è´Ÿè½½å‡è¡¡èƒ½å¤Ÿè§£ææµé‡çš„å†…å®¹ã€‚</p><p>å®¢æˆ·ç«¯ä¸èƒ½ä¸ç›´æ¥ä¸åç«¯æœåŠ¡å™¨å»ºç«‹ä¼ è¾“å±‚çš„è¿æ¥(å¦‚TCPè¿æ¥)ï¼Œå–è€Œä»£ä¹‹ï¼Œå®¢æˆ·ç«¯å°†ç›´æ¥ä¸è´Ÿè½½å‡è¡¡å»ºç«‹è¿æ¥ï¼Œè´Ÿè½½å‡è¡¡è§£æå®Œåè®®å†…å®¹åï¼Œæ ¹æ®åè®®å†…å®¹ã€æµé‡åˆ†å‘ç­–ç•¥å’Œåç«¯å‹åŠ›ç­‰ä¿¡æ¯é€‰æ‹©ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¹¶ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œç„¶åå°†è¿›è¡Œæµé‡åˆ†å‘ã€‚æ‰€ä»¥ï¼Œ<code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„ä¸»è¦å·¥ä½œå°±æ˜¯ä»£ç†ã€‚</code></p><p><code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š</p><ol><li><code>å¯ä»¥æŸ¥çœ‹ä¿®æ”¹æµé‡å†…å®¹ã€‚</code> èƒ½å¤ŸæŸ¥çœ‹æµé‡å†…å®¹è®©è´Ÿè½½å‡è¡¡èƒ½å¤Ÿè®°å½•æ—¥å¿—ï¼Œæ–¹ä¾¿è¿›è¡Œå¤§æ•°æ®åˆ†æï¼›ä¹Ÿèƒ½å¤Ÿæ ¹æ®å†…å®¹æ¥åšæ›´åŠ æ™ºèƒ½çš„æµé‡åˆ†å‘ï¼›è¿˜èƒ½å¯¹æ˜æ˜¾éæ³•çš„è®¿é—®è¿›è¡Œç®€å•çš„è¿‡æ»¤ã€‚èƒ½å¤Ÿä¿®æ”¹æµé‡è®©è´Ÿè½½å‡è¡¡èƒ½å¤Ÿæ·»åŠ é¢å¤–çš„ä¿¡æ¯åˆ°æµé‡ä¸­ï¼Œä¸ºåç«¯çš„ä¸šåŠ¡å¤„ç†æä¾›æ›´ä¸°å¯Œçš„ä¿¡æ¯ã€‚</li><li><code>å¯ä»¥é¿å…åç«¯æœåŠ¡é­å—ä¼ è¾“å±‚çš„æµé‡æ”»å‡»ã€‚</code> å› ä¸ºå®¢æˆ·ç«¯ä¸å†ç›´æ¥ä¸åç«¯æœåŠ¡å™¨å»ºç«‹ä¼ è¾“å±‚çš„è¿æ¥ï¼Œåç«¯æœåŠ¡å™¨ä¹Ÿå°±ä¸ä¼šå†å—åˆ°å¯èƒ½çš„SYN Floodæ”»å‡»ã€‚</li><li><code>æ— éœ€ç‰¹åˆ«çš„ç¡¬ä»¶å°±èƒ½å®ç°ã€‚</code> å› ä¸º<code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>å·¥ä½œåœ¨åº”ç”¨å±‚ï¼Œæ‰€ä»¥åˆ©ç”¨æ™®é€šçš„è½¯ä»¶å³å¯å®ç°ã€‚å¸¸ç”¨çš„è½¯ä»¶æœ‰ï¼šNginxã€HAProxyç­‰ã€‚</li></ol><p>åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›ä¸ä¾¿ï¼š</p><ol><li><code>éšè—äº†å®¢æˆ·ç«¯çš„è¿æ¥ä¿¡æ¯ã€‚</code> å› ä¸ºè´Ÿè½½å‡è¡¡å–ä»£äº†åç«¯æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€‚æ‰€ä»¥åç«¯æœåŠ¡å™¨<code>æ— æ³•ç›´æ¥è·å–</code>çœŸå®çš„å®¢æˆ·ç«¯IPä¿¡æ¯ç­‰ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ä¿®æ”¹æµé‡çš„å†…å®¹ï¼Œå°†å®¢æˆ·ç«¯çš„ä¿¡æ¯æ·»åŠ åˆ°æµé‡ä¸­æ¥é¿å…æ­¤é—®é¢˜ã€‚</li><li><code>å¢åŠ äº†æ’é”™çš„éš¾åº¦ã€‚</code> å¢åŠ ä¸ƒå±‚è´Ÿè½½çš„åŒæ—¶ï¼Œä¹Ÿä¸ºå°†ä¸šåŠ¡æµç¨‹å¤æ‚åŒ–äº†ï¼Œå‡ºé”™æ—¶ä¹Ÿå¢åŠ äº†æ’é”™çš„éš¾åº¦ã€‚</li></ol><p>æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨<code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>ä¹‹å‰ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ä½¿ç”¨<code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>èƒ½å¸¦æ¥çš„å¥½å¤„ä»¥åŠä¸ä¾¿ã€‚å¦‚æœä½¿ç”¨è´Ÿè½½å‡è¡¡çš„ä¸»è¦ç›®çš„æ˜¯åˆ†å‘æµé‡ï¼Œå‡è¡¡åç«¯å‹åŠ›ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä½¿ç”¨<a href="#å››å±‚è´Ÿè½½å‡è¡¡">å››å±‚è´Ÿè½½å‡è¡¡</a>ã€‚</p><h2 id="å…­ã€å››å±‚è´Ÿè½½å‡è¡¡"><a href="#å…­ã€å››å±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="å…­ã€å››å±‚è´Ÿè½½å‡è¡¡"></a>å…­ã€å››å±‚è´Ÿè½½å‡è¡¡</h2><p><code>å››å±‚è´Ÿè½½å‡è¡¡</code>å·¥ä½œåœ¨OSIçš„ç¬¬å››å±‚(ä¼ è¾“å±‚)ï¼Œä¸éœ€è¦å®Œæ•´çš„TCP/IPåè®®æ ˆçš„å®ç°ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½è§£ææµé‡çš„å†…å®¹ã€‚åœ¨è¿™ä¸€ç‚¹æ¥è¯´ï¼Œæ•ˆç‡æ¯”<code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>æ›´é«˜ã€‚</p><p>è´Ÿè½½å‡è¡¡ä»…èƒ½æ ¹æ®æµé‡ä¸­ç›®æ ‡åœ°å€å’Œç«¯å£ï¼ŒåŠ ä¸ŠæŒ‡å®šçš„æµé‡åˆ†å‘ç­–ç•¥ç­‰ä¿¡æ¯è¿›è¡Œæµé‡åˆ†å‘ã€‚å®¢æˆ·ç«¯èƒ½å¤Ÿç›´æ¥ä¸åç«¯æœåŠ¡å™¨å»ºç«‹ä¼ è¾“å±‚çš„è¿æ¥(å¦‚TCPè¿æ¥)ï¼Œæ­¤æ—¶è´Ÿè½½å‡è¡¡çš„ä½œç”¨ç±»ä¼¼äºè·¯ç”±å™¨è½¬å‘æŠ¥æ–‡ï¼Œåªæ˜¯æ›´åŠ æ™ºèƒ½å¯æ§ã€‚æ‰€ä»¥ï¼Œ<code>å››å±‚è´Ÿè½½å‡è¡¡çš„ä¸»è¦å·¥ä½œå°±æ˜¯è½¬å‘ã€‚</code></p><p>ä½¿ç”¨<code>å››å±‚è´Ÿè½½å‡è¡¡</code>æœ€æ˜æ˜¾çš„å¥½å¤„æ˜¯åœ¨ä¿æŒåˆ†å‘ç­–ç•¥æœ€å¤§åŒ–å¯æ§çš„åŒæ—¶æ€§èƒ½çš„æœ€å¤§åŒ–ã€‚å› ä¸º<code>å››å±‚è´Ÿè½½å‡è¡¡</code>å¹¶ä¸éœ€è¦è§£æä¼ è¾“å±‚çš„åè®®å†…å®¹ï¼Œç›¸æ¯”ä¸<code>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</code>æ¥è¯´ï¼Œå°‘äº†å¾ˆå¤šå·¥ä½œã€‚</p><p>ä½†æ˜¯ï¼Œä½¿ç”¨<code>å››å±‚è´Ÿè½½å‡è¡¡</code>çš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼š</p><ol><li><code>æˆæœ¬é«˜æ˜‚ã€‚</code> <code>å››å±‚è´Ÿè½½å‡è¡¡</code>å¤§å¤šåŸºäºç¡¬ä»¶æ¥å®ç°ï¼Œè™½ç„¶ä¹Ÿæœ‰è½¯ä»¶å®ç°çš„ã€‚</li><li><code>æš´éœ²äº†åç«¯çš„æœåŠ¡å™¨ã€‚</code> è¿™ä¸ä¸ç”¨è´Ÿè½½å‡è¡¡å‰çš„æƒ…å†µç›¸åŒï¼Œåç«¯æœåŠ¡å™¨ç›´æ¥æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚æœåŠ¡å™¨é­å—æ”»å‡»æ—¶ä¼šç›´æ¥å½±å“ä¸šåŠ¡ã€‚</li></ol><hr><p>å‚è€ƒ</p><ul><li><a href="https://tech.meituan.com/2017/01/05/mgw.html">MGWâ€”â€”ç¾å›¢ç‚¹è¯„é«˜æ€§èƒ½å››å±‚è´Ÿè½½å‡è¡¡</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯æ¶æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹Bashé…ç½®æ–‡ä»¶çš„æ‰§è¡Œé¡ºåº</title>
      <link href="linux-xia-bash-pei-zhi-wen-jian-de-zhi-xing-shun-xu/"/>
      <url>linux-xia-bash-pei-zhi-wen-jian-de-zhi-xing-shun-xu/</url>
      
        <content type="html"><![CDATA[<blockquote><p><em>ç¿»è¯‘è‡ª<a href="https://linux.101hacks.com/bash-scripting/execution-sequence-of-bash-files/">Linux 101 Hacks: 84</a></em></p></blockquote><h2 id="ä¸‹åˆ—æ–‡ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆ"><a href="#ä¸‹åˆ—æ–‡ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸‹åˆ—æ–‡ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆ"></a>ä¸‹åˆ—æ–‡ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/etc/profile~/.bash_profile~/.bashrc~/.bash_login~/.profile~/.bash_logout<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº¤äº’å¼ç™»å½•shellçš„æ‰§è¡Œé¡ºåº"><a href="#äº¤äº’å¼ç™»å½•shellçš„æ‰§è¡Œé¡ºåº" class="headerlink" title="äº¤äº’å¼ç™»å½•shellçš„æ‰§è¡Œé¡ºåº"></a>äº¤äº’å¼ç™»å½•shellçš„æ‰§è¡Œé¡ºåº</h2><p>ä¸‹é¢çš„ä¼ªä»£ç å°†è¯´æ˜è¿™äº›æ–‡ä»¶çš„æ‰§è¡Œé¡ºåº</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">execute /etc/profileIF ~/.bash_profile exists THEN    execute ~/.bash_profileELSE    IF ~/.bash_login exist THEN        execute ~/.bash_login    ELSE        IF ~/.profile exist THEN            execute ~/.profile        END IF    END IFEND IF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ä½ ä»äº¤äº’å¼shellä¸­æ³¨é”€ï¼Œä»¥ä¸‹æ˜¯æ‰§è¡Œé¡ºåºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">IF ~/.bash_logout exists THEN    execute ~/.bash_logoutEND IF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¯·æ³¨æ„/etc/bashrcæ˜¯é€šè¿‡~/.bashrcæ‰§è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># cat ~/.bashrc</span>IF <span class="token punctuation">[</span> -f /etc/bashrc <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><span class="token builtin class-name">.</span> /etc/bashrcFI<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="éç™»å½•äº¤äº’å¼shellçš„æ‰§è¡Œé¡ºåº"><a href="#éç™»å½•äº¤äº’å¼shellçš„æ‰§è¡Œé¡ºåº" class="headerlink" title="éç™»å½•äº¤äº’å¼shellçš„æ‰§è¡Œé¡ºåº"></a>éç™»å½•äº¤äº’å¼shellçš„æ‰§è¡Œé¡ºåº</h2><p>å½“ä½ å¯åŠ¨ä¸€ä¸ªéç™»å½•äº¤äº’å¼shell,ä¸‹é¢æ˜¯æ‰§è¡Œé¡ºåº</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">IF ~/.bashrc exists THEN    execute ~/.bashrcEND IF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>æ³¨æ„</code>ï¼šå½“ä¸€ä¸ªéäº¤äº’å¼shellå¯åŠ¨ï¼Œå®ƒä¼šå¯»æ‰¾ç¯å¢ƒå˜é‡ENVï¼Œå¹¶æ‰§è¡ŒåŒ…å«åœ¨ç¯å¢ƒå˜é‡ENVä¸­çš„æ–‡ä»¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Boostç¼–è¯‘é€‰é¡¹å¤‡å¿˜</title>
      <link href="boost-bian-yi-xuan-xiang-bei-wang/"/>
      <url>boost-bian-yi-xuan-xiang-bei-wang/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆå§‹åŒ–Boost"><a href="#åˆå§‹åŒ–Boost" class="headerlink" title="åˆå§‹åŒ–Boost"></a>åˆå§‹åŒ–Boost</h2><p>è¿›å…¥boostæ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆå§‹åŒ–boost</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Windows</span>./bootstrap.bat<span class="token comment"># Linux</span>./bootstrap.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¼–è¯‘ä½¿ç”¨C-é™æ€CRTçš„64ä½Boosté™æ€åº“"><a href="#ç¼–è¯‘ä½¿ç”¨C-é™æ€CRTçš„64ä½Boosté™æ€åº“" class="headerlink" title="ç¼–è¯‘ä½¿ç”¨C++é™æ€CRTçš„64ä½Boosté™æ€åº“"></a>ç¼–è¯‘ä½¿ç”¨C++é™æ€CRTçš„64ä½Boosté™æ€åº“</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./b2.exe --prefix<span class="token operator">=</span>./install64_staticlib_staticrt --stagedir<span class="token operator">=</span>./stage64_staticlib_staticrt --build-dir<span class="token operator">=</span>./build64_staticlib_staticrt --build-type<span class="token operator">=</span>complete --layout<span class="token operator">=</span>versioned --buildid<span class="token operator">=</span>amd64 --without-mpi --without-graph --without-graph_parallel --without-python address-model<span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">variant</span><span class="token operator">=</span>debug,release <span class="token assign-left variable">threading</span><span class="token operator">=</span>multi <span class="token assign-left variable">link</span><span class="token operator">=</span>static runtime-link<span class="token operator">=</span>static -a -q -j16 <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">libboost_atomic-vc140-mt-s-1_59-amd64.liblibboost_atomic-vc140-mt-sgd-1_59-amd64.liblibboost_chrono-vc140-mt-s-1_59-amd64.liblibboost_chrono-vc140-mt-sgd-1_59-amd64.liblibboost_container-vc140-mt-s-1_59-amd64.liblibboost_container-vc140-mt-sgd-1_59-amd64.liblibboost_context-vc140-mt-s-1_59-amd64.liblibboost_context-vc140-mt-sgd-1_59-amd64.liblibboost_coroutine-vc140-mt-s-1_59-amd64.liblibboost_coroutine-vc140-mt-sgd-1_59-amd64.liblibboost_date_time-vc140-mt-s-1_59-amd64.liblibboost_date_time-vc140-mt-sgd-1_59-amd64.liblibboost_exception-vc140-mt-s-1_59-amd64.liblibboost_exception-vc140-mt-sgd-1_59-amd64.liblibboost_filesystem-vc140-mt-s-1_59-amd64.liblibboost_filesystem-vc140-mt-sgd-1_59-amd64.liblibboost_iostreams-vc140-mt-s-1_59-amd64.liblibboost_iostreams-vc140-mt-sgd-1_59-amd64.liblibboost_locale-vc140-mt-s-1_59-amd64.liblibboost_locale-vc140-mt-sgd-1_59-amd64.liblibboost_log-vc140-mt-s-1_59-amd64.liblibboost_log-vc140-mt-sgd-1_59-amd64.liblibboost_log_setup-vc140-mt-s-1_59-amd64.liblibboost_log_setup-vc140-mt-sgd-1_59-amd64.liblibboost_math_c99-vc140-mt-s-1_59-amd64.liblibboost_math_c99-vc140-mt-sgd-1_59-amd64.liblibboost_math_c99f-vc140-mt-s-1_59-amd64.liblibboost_math_c99f-vc140-mt-sgd-1_59-amd64.liblibboost_math_c99l-vc140-mt-s-1_59-amd64.liblibboost_math_c99l-vc140-mt-sgd-1_59-amd64.liblibboost_math_tr1-vc140-mt-s-1_59-amd64.liblibboost_math_tr1-vc140-mt-sgd-1_59-amd64.liblibboost_math_tr1f-vc140-mt-s-1_59-amd64.liblibboost_math_tr1f-vc140-mt-sgd-1_59-amd64.liblibboost_math_tr1l-vc140-mt-s-1_59-amd64.liblibboost_math_tr1l-vc140-mt-sgd-1_59-amd64.liblibboost_prg_exec_monitor-vc140-mt-s-1_59-amd64.liblibboost_prg_exec_monitor-vc140-mt-sgd-1_59-amd64.liblibboost_program_options-vc140-mt-s-1_59-amd64.liblibboost_program_options-vc140-mt-sgd-1_59-amd64.liblibboost_random-vc140-mt-s-1_59-amd64.liblibboost_random-vc140-mt-sgd-1_59-amd64.liblibboost_regex-vc140-mt-s-1_59-amd64.liblibboost_regex-vc140-mt-sgd-1_59-amd64.liblibboost_serialization-vc140-mt-s-1_59-amd64.liblibboost_serialization-vc140-mt-sgd-1_59-amd64.liblibboost_signals-vc140-mt-s-1_59-amd64.liblibboost_signals-vc140-mt-sgd-1_59-amd64.liblibboost_system-vc140-mt-s-1_59-amd64.liblibboost_system-vc140-mt-sgd-1_59-amd64.liblibboost_test_exec_monitor-vc140-mt-s-1_59-amd64.liblibboost_test_exec_monitor-vc140-mt-sgd-1_59-amd64.liblibboost_thread-vc140-mt-s-1_59-amd64.liblibboost_thread-vc140-mt-sgd-1_59-amd64.liblibboost_timer-vc140-mt-s-1_59-amd64.liblibboost_timer-vc140-mt-sgd-1_59-amd64.liblibboost_unit_test_framework-vc140-mt-s-1_59-amd64.liblibboost_unit_test_framework-vc140-mt-sgd-1_59-amd64.liblibboost_wave-vc140-mt-s-1_59-amd64.liblibboost_wave-vc140-mt-sgd-1_59-amd64.liblibboost_wserialization-vc140-mt-s-1_59-amd64.liblibboost_wserialization-vc140-mt-sgd-1_59-amd64.lib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./b2 --prefix<span class="token operator">=</span>./install64_staticlib_staticrt --stagedir<span class="token operator">=</span>./stage64_staticlib_staticrt --build-dir<span class="token operator">=</span>./build64_staticlib_staticrt --build-type<span class="token operator">=</span>complete --layout<span class="token operator">=</span>versioned --buildid<span class="token operator">=</span>amd64 --without-mpi --without-graph --without-graph_parallel --without-python <span class="token assign-left variable">cxxflags</span><span class="token operator">=</span>-fPIC <span class="token assign-left variable">cflags</span><span class="token operator">=</span>-fPIC address-model<span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">variant</span><span class="token operator">=</span>debug,release <span class="token assign-left variable">threading</span><span class="token operator">=</span>multi <span class="token assign-left variable">link</span><span class="token operator">=</span>static runtime-link<span class="token operator">=</span>static -a -q -j6 <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">libboost_atomic-gcc49-mt-s-1_59-amd64.alibboost_atomic-gcc49-mt-sd-1_59-amd64.alibboost_chrono-gcc49-mt-s-1_59-amd64.alibboost_chrono-gcc49-mt-sd-1_59-amd64.alibboost_container-gcc49-mt-s-1_59-amd64.alibboost_container-gcc49-mt-sd-1_59-amd64.alibboost_context-gcc49-mt-s-1_59-amd64.alibboost_context-gcc49-mt-sd-1_59-amd64.alibboost_coroutine-gcc49-mt-s-1_59-amd64.alibboost_coroutine-gcc49-mt-sd-1_59-amd64.alibboost_date_time-gcc49-mt-s-1_59-amd64.alibboost_date_time-gcc49-mt-sd-1_59-amd64.alibboost_exception-gcc49-mt-s-1_59-amd64.alibboost_exception-gcc49-mt-sd-1_59-amd64.alibboost_filesystem-gcc49-mt-s-1_59-amd64.alibboost_filesystem-gcc49-mt-sd-1_59-amd64.alibboost_iostreams-gcc49-mt-s-1_59-amd64.alibboost_iostreams-gcc49-mt-sd-1_59-amd64.alibboost_locale-gcc49-mt-s-1_59-amd64.alibboost_locale-gcc49-mt-sd-1_59-amd64.alibboost_log-gcc49-mt-s-1_59-amd64.alibboost_log-gcc49-mt-sd-1_59-amd64.alibboost_log_setup-gcc49-mt-s-1_59-amd64.alibboost_log_setup-gcc49-mt-sd-1_59-amd64.alibboost_math_c99f-gcc49-mt-s-1_59-amd64.alibboost_math_c99f-gcc49-mt-sd-1_59-amd64.alibboost_math_c99-gcc49-mt-s-1_59-amd64.alibboost_math_c99-gcc49-mt-sd-1_59-amd64.alibboost_math_c99l-gcc49-mt-s-1_59-amd64.alibboost_math_c99l-gcc49-mt-sd-1_59-amd64.alibboost_math_tr1f-gcc49-mt-s-1_59-amd64.alibboost_math_tr1f-gcc49-mt-sd-1_59-amd64.alibboost_math_tr1-gcc49-mt-s-1_59-amd64.alibboost_math_tr1-gcc49-mt-sd-1_59-amd64.alibboost_math_tr1l-gcc49-mt-s-1_59-amd64.alibboost_math_tr1l-gcc49-mt-sd-1_59-amd64.alibboost_prg_exec_monitor-gcc49-mt-s-1_59-amd64.alibboost_prg_exec_monitor-gcc49-mt-sd-1_59-amd64.alibboost_program_options-gcc49-mt-s-1_59-amd64.alibboost_program_options-gcc49-mt-sd-1_59-amd64.alibboost_random-gcc49-mt-s-1_59-amd64.alibboost_random-gcc49-mt-sd-1_59-amd64.alibboost_regex-gcc49-mt-s-1_59-amd64.alibboost_regex-gcc49-mt-sd-1_59-amd64.alibboost_serialization-gcc49-mt-s-1_59-amd64.alibboost_serialization-gcc49-mt-sd-1_59-amd64.alibboost_signals-gcc49-mt-s-1_59-amd64.alibboost_signals-gcc49-mt-sd-1_59-amd64.alibboost_system-gcc49-mt-s-1_59-amd64.alibboost_system-gcc49-mt-sd-1_59-amd64.alibboost_test_exec_monitor-gcc49-mt-s-1_59-amd64.alibboost_test_exec_monitor-gcc49-mt-sd-1_59-amd64.alibboost_thread-gcc49-mt-s-1_59-amd64.alibboost_thread-gcc49-mt-sd-1_59-amd64.alibboost_timer-gcc49-mt-s-1_59-amd64.alibboost_timer-gcc49-mt-sd-1_59-amd64.alibboost_unit_test_framework-gcc49-mt-s-1_59-amd64.alibboost_unit_test_framework-gcc49-mt-sd-1_59-amd64.alibboost_wave-gcc49-mt-s-1_59-amd64.alibboost_wave-gcc49-mt-sd-1_59-amd64.alibboost_wserialization-gcc49-mt-s-1_59-amd64.alibboost_wserialization-gcc49-mt-sd-1_59-amd64.a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¿®æ”¹boostçš„å¤´æ–‡ä»¶"><a href="#ä¿®æ”¹boostçš„å¤´æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹boostçš„å¤´æ–‡ä»¶"></a>ä¿®æ”¹boostçš„å¤´æ–‡ä»¶</h2><p>æŠŠä¸‹é¢çš„å†…å®¹åŠ åˆ°æ–‡ä»¶<code>install64_staticlib_staticrt/include/boost-1_59/boost/config</code>çš„æœ€åï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">BOOST_LIB_BUILDID amd64</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Archå®‰è£…å¤‡å¿˜</title>
      <link href="arch-an-zhuang-bei-wang/"/>
      <url>arch-an-zhuang-bei-wang/</url>
      
        <content type="html"><![CDATA[<h2 id="è·å–ISO"><a href="#è·å–ISO" class="headerlink" title="è·å–ISO"></a>è·å–<a href="http://mirrors.163.com/archlinux/iso/latest/">ISO</a></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://mirrors.163.com/archlinux/iso/latest/archlinux-2018.05.01-x86_64.iso<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ"><a href="#ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ" class="headerlink" title="ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ"></a>ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ</h2><h2 id="æ›´æ–°ç³»ç»Ÿæ—¶é—´"><a href="#æ›´æ–°ç³»ç»Ÿæ—¶é—´" class="headerlink" title="æ›´æ–°ç³»ç»Ÿæ—¶é—´"></a>æ›´æ–°ç³»ç»Ÿæ—¶é—´</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">timedatectl set-ntp <span class="token boolean">true</span>timedatectl status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ç£ç›˜åˆ†åŒº"><a href="#ç£ç›˜åˆ†åŒº" class="headerlink" title="ç£ç›˜åˆ†åŒº"></a>ç£ç›˜åˆ†åŒº</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">parted</span> -a optimal /dev/sdamklabel gptunit mibmkpart primary <span class="token number">1</span> <span class="token number">3</span>name <span class="token number">1</span> grub<span class="token builtin class-name">set</span> <span class="token number">1</span> bios_grub onmkpart primary <span class="token number">3</span> <span class="token number">256</span>name <span class="token number">2</span> boot<span class="token builtin class-name">set</span> <span class="token number">2</span> boot onmkpart primary <span class="token number">256</span> <span class="token number">8448</span>name <span class="token number">3</span> swapmkpart primary <span class="token number">8448</span> -1name <span class="token number">4</span> rootfsprintquitmkfs.ext4 /dev/sda2mkfs.ext4 /dev/sda4<span class="token function">mkswap</span> /dev/sda3<span class="token function">swapon</span> /dev/sda3<span class="token function">mount</span> /dev/sda4 /mnt<span class="token function">mkdir</span> /mnt/boot<span class="token function">mount</span> /dev/sda2 /mnt/boot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…Arch"><a href="#å®‰è£…Arch" class="headerlink" title="å®‰è£…Arch"></a>å®‰è£…Arch</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.bk<span class="token function">grep</span> <span class="token number">163</span>.com /etc/pacman.d/mirrorlist.bk <span class="token operator">&gt;</span> /etc/pacman.d/mirrorlistpacstrap /mnt base base-develgenfstab -U /mnt <span class="token operator">&gt;&gt;</span> /mnt/etc/fstab<span class="token function">cat</span> /mnt/etc/fstabarch-chroot /mnt<span class="token function">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtimehwclock --systohc<span class="token function">mv</span> /etc/locale.gen /etc/locale.gen.bk<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>/etc/locale.gen</span>en_US ISO-8859-1en_US.UTF-8 UTF-8zh_CN GB18030zh_CN.GBK GBKzh_CN.GB2312 GB2312zh_CN.UTF-8 UTF-8EOF</span>locale-genlocale -a<span class="token builtin class-name">echo</span> <span class="token string">"LANG=en_US.UTF-8"</span> <span class="token operator">&gt;</span> /etc/locale.conf<span class="token builtin class-name">echo</span> <span class="token string">"kiba"</span> <span class="token operator">&gt;</span> /etc/hostname<span class="token function">passwd</span>systemctl <span class="token builtin class-name">enable</span> dhcpcdpacman -S <span class="token function">vim</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…Grub"><a href="#å®‰è£…Grub" class="headerlink" title="å®‰è£…Grub"></a>å®‰è£…Grub</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman -S grubgrub-install /dev/sda<span class="token function">grub-mkconfig</span> -o /boot/grub/grub.cfg<span class="token builtin class-name">exit</span><span class="token builtin class-name">cd</span><span class="token function">umount</span> -R /mnt<span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…å¸¸ç”¨è½¯ä»¶"><a href="#å®‰è£…å¸¸ç”¨è½¯ä»¶" class="headerlink" title="å®‰è£…å¸¸ç”¨è½¯ä»¶"></a>å®‰è£…å¸¸ç”¨è½¯ä»¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯ä»¥ä½¿ç”¨å‘½ä»¤`pacman -Fs binname`æ ¹æ®æ‰§è¡Œæ–‡ä»¶çš„åå­—æœç´¢è½¯ä»¶åŒ…çš„åå­—</span>pacman -S openssh<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span>/etc/ssh/sshd_config</span>PermitRootLogin yesPasswordAuthentication yesEOF</span>systemctl <span class="token builtin class-name">enable</span> sshdsystemctl start sshd<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span>/etc/pacman.conf</span>[archlinuxcn]SigLevel = Optional TrustAllServer = http://mirrors.163.com/archlinux-cn/<span class="token variable">$arch</span>EOF</span>pacman -Syy <span class="token operator">&amp;&amp;</span> pcman -Syu <span class="token operator">&amp;&amp;</span> pacman -S archlinuxcn-keyringpacman -S yaourtpacman -S <span class="token function">wget</span> <span class="token function">git</span><span class="token function">mkdir</span> /usr/share/pictures<span class="token function">wget</span> http://b.hiphotos.baidu.com/zhidao/pic/item/1ad5ad6eddc451da88f9f31ab3fd5266d0163237.jpg -O /usr/share/pictures/background.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…GUI"><a href="#å®‰è£…GUI" class="headerlink" title="å®‰è£…GUI"></a>å®‰è£…GUI</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pacman -S xorg xorg-xinit xf86-video-fbdevpacman -S i3-wm i3status i3lock dmenu rxvt-unicode rxvt-unicode-terminfo conky fehpacman -S ttf-font-awesome<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arch </tag>
            
            <tag> ç³»ç»Ÿå®‰è£… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gentooå®‰è£…å¤‡å¿˜</title>
      <link href="gentoo-an-zhuang-bei-wang/"/>
      <url>gentoo-an-zhuang-bei-wang/</url>
      
        <content type="html"><![CDATA[<h2 id="è·å–ISO"><a href="#è·å–ISO" class="headerlink" title="è·å–ISO"></a>è·å–<a href="http://mirrors.163.com/gentoo/releases/amd64/autobuilds/">ISO</a></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://mirrors.163.com/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/install-amd64-minimal-20180415T214502Z.iso<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ"><a href="#ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ" class="headerlink" title="ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ"></a>ä»ISOæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿ</h2><h2 id="ç£ç›˜åˆ†åŒº"><a href="#ç£ç›˜åˆ†åŒº" class="headerlink" title="ç£ç›˜åˆ†åŒº"></a>ç£ç›˜åˆ†åŒº</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">parted</span> -a optimal /dev/sdamklabel gptunit mibmkpart primary <span class="token number">1</span> <span class="token number">3</span>name <span class="token number">1</span> grub<span class="token builtin class-name">set</span> <span class="token number">1</span> bios_grub onmkpart primary <span class="token number">3</span> <span class="token number">256</span>name <span class="token number">2</span> boot<span class="token builtin class-name">set</span> <span class="token number">2</span> boot onmkpart primary <span class="token number">256</span> <span class="token number">8448</span>name <span class="token number">3</span> swapmkpart primary <span class="token number">8448</span> -1name <span class="token number">4</span> rootfsprintquitmkfs.ext4 /dev/sda2mkfs.ext4 /dev/sda4<span class="token function">mkswap</span> /dev/sda3<span class="token function">swapon</span> /dev/sda3<span class="token function">mount</span> /dev/sda4 /mnt/gentoo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…Gentoo"><a href="#å®‰è£…Gentoo" class="headerlink" title="å®‰è£…Gentoo"></a>å®‰è£…Gentoo</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /mnt/gentoo<span class="token function">wget</span> http://mirrors.163.com/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/stage3-amd64-20180415T214502Z.tar.xz<span class="token comment"># hardened</span><span class="token function">wget</span> http://mirrors.163.com/gentoo/releases/amd64/autobuilds/current-stage3-amd64-hardened/stage3-amd64-hardened-20180517T214504Z.tar.xz<span class="token comment"># systemd</span><span class="token function">wget</span> http://mirrors.163.com/gentoo/releases/amd64/autobuilds/current-stage3-amd64-systemd/stage3-amd64-systemd-20180518.tar.bz2<span class="token function">tar</span> xpf stage3-amd64-20180415T214502Z.tar.xz --xattrs-include<span class="token operator">=</span><span class="token string">'*.*'</span> --numeric-owner<span class="token function">cp</span> /mnt/gentoo/etc/portage/make.conf /mnt/gentoo/etc/portage/make.conf.bk<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /mnt/gentoo/etc/portage/make.conf</span>CFLAGS="-march=native -O2 -pipe"CXXFLAGS="-march=native -O2 -pipe"CHOST="x86_64-pc-linux-gnu"MAKEOPTS="-j9 -l8"EMERGE_DEFAULT_OPTS="--jobs=8 --load-average=8 --ask --verbose --with-bdeps=y"PORTAGE_NICENESS=15# get by cpuid2cpuflags(emerge app-portage/cpuid2cpuflags)CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3"ACCEPT_KEYWORDS="amd64"#GENTOO_MIRRORS="https://mirrors.tuna.tsinghua.edu.cn/gentoo/"#GENTOO_MIRRORS="https://mirrors.163.com/gentoo/"GENTOO_MIRRORS="http://mirrors.ustc.edu.cn/gentoo/"L10N="en-US zh-CN"#LINGUAS="en_US zh_CN"LC_MESSAGES="C"PORTDIR="/usr/portage"DISTDIR="/usr/portage/distfiles"PKGDIR="/usr/portage/packages"#FEATURES="ccache"#CCACHE_SIZE="8G"#USE="dbus policykit udisks udev consolekit X"#VIDEO_CARDS="vmware"#INPUT_DEVICES="keyboard mouse"EOF</span><span class="token function">mkdir</span> --parents /mnt/gentoo/etc/portage/repos.conf<span class="token function">cp</span> /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf.bk<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /mnt/gentoo/etc/portage/repos.conf/gentoo.conf</span>[DEFAULT]main-repo = gentoo[gentoo]location = /usr/portagesync-type = rsync#sync-uri = rsync://rsync.gentoo.org/gentoo-portage#sync-uri = rsync://rsync.cn.gentoo.org/gentoo-portagesync-uri = rsync://rsync.mirrors.ustc.edu.cn/gentoo-portage/auto-sync = yessync-rsync-verify-jobs = 1sync-rsync-verify-metamanifest = nosync-rsync-verify-max-age = 24sync-openpgp-key-path = /usr/share/openpgp-keys/gentoo-release.ascsync-openpgp-key-refresh-retry-count = 40sync-openpgp-key-refresh-retry-overall-timeout = 1200sync-openpgp-key-refresh-retry-delay-exp-base = 2sync-openpgp-key-refresh-retry-delay-max = 60sync-openpgp-key-refresh-retry-delay-mult = 4# for daily squashfs snapshots#sync-type = squashdelta#sync-uri = mirror://gentoo/../snapshots/squashfsEOF</span><span class="token function">cp</span> --dereference /etc/resolv.conf /mnt/gentoo/etc/<span class="token function">mount</span> --types proc /proc /mnt/gentoo/proc<span class="token function">mount</span> --rbind /sys /mnt/gentoo/sys<span class="token function">mount</span> --make-rslave /mnt/gentoo/sys<span class="token function">mount</span> --rbind /dev /mnt/gentoo/dev<span class="token function">mount</span> --make-rslave /mnt/gentoo/dev<span class="token function">chroot</span> /mnt/gentoo /bin/bash<span class="token builtin class-name">source</span> /etc/profile<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">"(chroot) <span class="token variable">${<span class="token environment constant">PS1</span>}</span>"</span><span class="token function">mkdir</span> /boot<span class="token function">mount</span> /dev/sda2 /bootemerge-webrsyncemerge --synceselect profile listeselect profile <span class="token builtin class-name">set</span> default/linux/amd64/17.0/desktop/plasmaemerge --ask --update --deep --newuse @world<span class="token function">ls</span> /usr/share/zoneinfo<span class="token builtin class-name">echo</span> <span class="token string">"Asia/Shanghai"</span> <span class="token operator">&gt;</span> /etc/timezoneemerge --config sys-libs/timezone-data<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>/etc/locale.gen</span>en_US ISO-8859-1en_US.UTF-8 UTF-8zh_CN GB18030zh_CN.GBK GBKzh_CN.GB2312 GB2312zh_CN.UTF-8 UTF-8EOF</span>locale-genlocale -aeselect locale listeselect locale <span class="token builtin class-name">set</span> en_US.utf8env-update <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">source</span> /etc/profile <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">"(chroot) <span class="token environment constant">$PS1</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é…ç½®å†…æ ¸"><a href="#é…ç½®å†…æ ¸" class="headerlink" title="é…ç½®å†…æ ¸"></a>é…ç½®å†…æ ¸</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emerge sys-kernel/gentoo-sources<span class="token function">ls</span> -l /usr/src/linuxemerge sys-kernel/genkernel<span class="token function">nano</span> -w /etc/fstab<span class="token comment"># /dev/sda2 /boot ext2 defaults 0 2</span>genkernel all<span class="token comment"># or genkernel --lvm all</span><span class="token function">ls</span> /boot/kernel* /boot/initramfs*emerge sys-kernel/linux-firmware<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é…ç½®ç³»ç»Ÿ"><a href="#é…ç½®ç³»ç»Ÿ" class="headerlink" title="é…ç½®ç³»ç»Ÿ"></a>é…ç½®ç³»ç»Ÿ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> -w /etc/fstab<span class="token comment">#/dev/sda2  /boot       ext4    defaults,noatime    0 2</span><span class="token comment">#/dev/sda3  none        swap    sw                  0 0</span><span class="token comment">#/dev/sda4  /           ext4    noatime             0 1</span><span class="token comment">#/dev/cdrom /mnt/cdrom  auto    noauto,user         0 0</span><span class="token function">cp</span> /etc/conf.d/hostname /etc/conf.d/hostname.bk<span class="token builtin class-name">echo</span> <span class="token string">"hostname=<span class="token entity" title="\&quot;">\"</span>gentoo<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">&gt;</span> /etc/conf.d/hostnameemerge --noreplace net-misc/netifrc<span class="token builtin class-name">echo</span> <span class="token string">"config_eno16777736=<span class="token entity" title="\&quot;">\"</span>dhcp<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">&gt;</span> /etc/conf.d/net<span class="token function">passwd</span><span class="token builtin class-name">cd</span> /etc/init.d<span class="token function">ln</span> -s net.lo net.eno16777736rc-update <span class="token function">add</span> net.eno16777736 default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…ç³»ç»Ÿå·¥å…·"><a href="#å®‰è£…ç³»ç»Ÿå·¥å…·" class="headerlink" title="å®‰è£…ç³»ç»Ÿå·¥å…·"></a>å®‰è£…ç³»ç»Ÿå·¥å…·</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emerge app-admin/sysklogdrc-update <span class="token function">add</span> sysklogd defaultemerge sys-process/cronierc-update <span class="token function">add</span> cronie defaultemerge sys-apps/mlocaterc-update <span class="token function">add</span> sshd defaultemerge net-misc/dhcpcdrc-update <span class="token function">add</span> dhcpcd defaultrc-update <span class="token function">add</span> dbus defaultrc-update <span class="token function">add</span> udev sysinitrc-update <span class="token function">add</span> consolekit default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…Grub"><a href="#å®‰è£…Grub" class="headerlink" title="å®‰è£…Grub"></a>å®‰è£…Grub</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emerge sys-boot/grub:2grub-install /dev/sda<span class="token function">grub-mkconfig</span> -o /boot/grub/grub.cfg<span class="token builtin class-name">exit</span><span class="token builtin class-name">cd</span><span class="token function">umount</span> -l /mnt/gentoo/dev<span class="token punctuation">{</span>/shm,/pts,<span class="token punctuation">}</span><span class="token function">umount</span> -R /mnt/gentoo<span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…ç³»ç»Ÿå†…æ ¸å·¥å…·"><a href="#å®‰è£…ç³»ç»Ÿå†…æ ¸å·¥å…·" class="headerlink" title="å®‰è£…ç³»ç»Ÿå†…æ ¸å·¥å…·"></a>å®‰è£…ç³»ç»Ÿå†…æ ¸å·¥å…·</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emerge app-portage/eix app-portage/gentoolkit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ›´æ–°ç³»ç»Ÿ"><a href="#æ›´æ–°ç³»ç»Ÿ" class="headerlink" title="æ›´æ–°ç³»ç»Ÿ"></a>æ›´æ–°ç³»ç»Ÿ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">eix-syncemerge -avuDN --tree worldemerge -av --depcleanrevdep-rebuild -v -- --askdispatch-confeclean-dist -deix-test-obsoleteglsa-check -t allglsa-check -f all<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…Xorg"><a href="#å®‰è£…Xorg" class="headerlink" title="å®‰è£…Xorg"></a>å®‰è£…Xorg</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emerge --ask x11-base/xorg-drivers media-libs/mesa x11-base/xorg-x11 x11-wm/twm x11-terms/xtermstartx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å®‰è£…Kde"><a href="#å®‰è£…Kde" class="headerlink" title="å®‰è£…Kde"></a>å®‰è£…Kde</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emerge --ask kde-plasma/plasma-meta<span class="token builtin class-name">echo</span> <span class="token string">"DISPLAYMANAGER=<span class="token entity" title="\&quot;">\"</span>sddm<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">&gt;&gt;</span> /etc/conf.d/xdmrc-update <span class="token function">add</span> xdm default<span class="token function">useradd</span> -m k<span class="token function">passwd</span> k<span class="token comment">#su k</span><span class="token comment">#groups</span><span class="token comment">#usermod -a -G plugdev k</span>emerge app-portage/laymanlayman -Llayman -a gentoo-zhemerge app-i18n/fcitx app-i18n/fcitx-cloudpinyin app-i18n/kcm-fcitx<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;&gt;</span>/home/k/.xprofile</span>eval "<span class="token variable"><span class="token variable">$(</span>dbus-launch --sh-syntax --exit-with-session<span class="token variable">)</span></span>"export XMODIFIERS="@im=fcitx"export QT_IM_MODULE=fcitxexport GTK_IM_MODULE=fcitxEOF</span><span class="token comment">#/etc/init.d/xdm restart</span><span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emerge --ask kde-apps/kde-apps-metaemerge --ask www-client/google-chromeemerge --ask app-portage/pfl<span class="token comment"># e-file = apt-file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ›´æ–°ç³»ç»Ÿæ—¶é—´"><a href="#æ›´æ–°ç³»ç»Ÿæ—¶é—´" class="headerlink" title="æ›´æ–°ç³»ç»Ÿæ—¶é—´"></a>æ›´æ–°ç³»ç»Ÿæ—¶é—´</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ntp</span>emerge --ask net-misc/openntpd<span class="token function">mv</span> /etc/ntpd.conf /etc/ntpd.conf.bk<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>/etc/ntpd.conf</span>servers 0.cn.pool.ntp.orgservers 1.cn.pool.ntp.orgservers 2.cn.pool.ntp.orgservers 3.cn.pool.ntp.orgEOF</span>/etc/init.d/ntpd startrc-update <span class="token function">add</span> ntpd default<span class="token function">cp</span> /etc/conf.d/hwclock /etc/conf.d/hwclock.bk<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>/etc/conf.d/hwclock</span>clock="local"clock_args=""EOF</span>hwclock --systohc --utchwclock --hctosys --localtime<span class="token function">date</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç³»ç»Ÿå®‰è£… </tag>
            
            <tag> Gentoo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¤æ–­ä¸¤ä¸ªçŸ©å½¢æ˜¯å¦ç›¸äº¤</title>
      <link href="pan-duan-liang-ge-ju-xing-shi-fou-xiang-jiao/"/>
      <url>pan-duan-liang-ge-ju-xing-shi-fou-xiang-jiao/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å‡ºä¸¤ä¸ªçŸ©å½¢çš„ä¸€ä¸ªé¡¶ç‚¹å’Œå®½åº¦é«˜åº¦ï¼Œåˆ¤æ–­ä¸¤ä¸ªçŸ©å½¢æ˜¯å¦ç›¸äº¤å¹¶è®¡ç®—å‡ºç›¸äº¤çš„åŒºåŸŸã€‚</p><h2 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>ä¸‹é¢ç»™äº†å‡ºå‡ ç§ç®—æ³•çš„Cä»£ç å¹¶å¯¹å…¶è¿›è¡Œäº†æµ‹è¯•ï¼Œç®—æ³•ä¾æ¬¡æ›´ç®€å•å¿«é€Ÿï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">IsOverlap1</span><span class="token punctuation">(</span><span class="token keyword">double</span> ax1<span class="token punctuation">,</span> <span class="token keyword">double</span> ay1<span class="token punctuation">,</span> <span class="token keyword">double</span> aw<span class="token punctuation">,</span> <span class="token keyword">double</span> ah<span class="token punctuation">,</span>    <span class="token keyword">double</span> bx1<span class="token punctuation">,</span> <span class="token keyword">double</span> by1<span class="token punctuation">,</span> <span class="token keyword">double</span> bw<span class="token punctuation">,</span> <span class="token keyword">double</span> bh<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">double</span> ax2<span class="token punctuation">,</span> ay2<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> by2<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a <span class="token operator">+=</span> b<span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> bh<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">_PARAM_CHECK_</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> b <span class="token operator">&amp;&amp;</span> b <span class="token operator">&lt;=</span> c<span class="token punctuation">)</span></span></span>    <span class="token comment">/*    1.Bæœ‰é¡¶ç‚¹åœ¨Aä¸­    -------A    |     |    |   ------B    |   | |  |    ----|--  |        |    |        ------    */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> by2<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> by2<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">/*    2.Aæœ‰2æˆ–4ä¸ªé¡¶ç‚¹åœ¨Bä¸­    -------B    | --- |    --|-|--      ---A    -------    | --- |    | |A| |    | --- |    -------B    */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> ax1<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> ax2<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> ay2<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">/*    3.Aä¸Båå­—ç›¸äº¤ä¸”Aæ¨ªBç«–       ---B       | |    ---|-|---A    |  | |  |    ---|-|---       | |       ---    */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> by2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> ay2<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">/*    3.Aä¸Båå­—ç›¸äº¤ä¸”Aç«–Bæ¨ª       ---A       | |    ---|-|---B    |  | |  |    ---|-|---       | |       ---    */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> ax1<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> ax2<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">_IS_BETWEEN_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> by2<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">IsOverlap2</span><span class="token punctuation">(</span><span class="token keyword">double</span> ax1<span class="token punctuation">,</span> <span class="token keyword">double</span> ay1<span class="token punctuation">,</span> <span class="token keyword">double</span> aw<span class="token punctuation">,</span> <span class="token keyword">double</span> ah<span class="token punctuation">,</span>    <span class="token keyword">double</span> bx1<span class="token punctuation">,</span> <span class="token keyword">double</span> by1<span class="token punctuation">,</span> <span class="token keyword">double</span> bw<span class="token punctuation">,</span> <span class="token keyword">double</span> bh<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">/*    å¦‚æœAä¸Bä¸­å¿ƒåœ¨Xå’ŒYè½´ä¸Šçš„è·ç¦»å°äºä»–ä»¬è¾¹é•¿å’Œçš„ä¸€åŠå°±ç›¸äº¤    */</span>    <span class="token keyword">double</span> ax2<span class="token punctuation">,</span> ay2<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> by2<span class="token punctuation">;</span>    <span class="token keyword">double</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a <span class="token operator">+=</span> b<span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> bh<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">_PARAM_CHECK_</span></span>    dx <span class="token operator">=</span> ax1 <span class="token operator">+</span> ax2 <span class="token operator">-</span> <span class="token punctuation">(</span>bx1 <span class="token operator">+</span> bx2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Aä¸Bä¸­å¿ƒåœ¨Xè½´ä¸Šè·ç¦»çš„2å€ */</span>    dy <span class="token operator">=</span> ay1 <span class="token operator">+</span> ay2 <span class="token operator">-</span> <span class="token punctuation">(</span>by1 <span class="token operator">+</span> by2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Aä¸Bä¸­å¿ƒåœ¨Yè½´ä¸Šè·ç¦»çš„2å€ */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dx <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> dx <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> dx<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dy <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> dy <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> dy<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dx <span class="token operator">&lt;=</span> aw <span class="token operator">+</span> bw <span class="token operator">&amp;&amp;</span> dy <span class="token operator">&lt;=</span> ah <span class="token operator">+</span> bh<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">IsOverlap3</span><span class="token punctuation">(</span><span class="token keyword">double</span> ax1<span class="token punctuation">,</span> <span class="token keyword">double</span> ay1<span class="token punctuation">,</span> <span class="token keyword">double</span> aw<span class="token punctuation">,</span> <span class="token keyword">double</span> ah<span class="token punctuation">,</span>    <span class="token keyword">double</span> bx1<span class="token punctuation">,</span> <span class="token keyword">double</span> by1<span class="token punctuation">,</span> <span class="token keyword">double</span> bw<span class="token punctuation">,</span> <span class="token keyword">double</span> bh<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">/*    æ‰¾å‡ºä¸ç›¸äº¤çš„æƒ…å†µï¼Œå–å    */</span>    <span class="token keyword">double</span> ax2<span class="token punctuation">,</span> ay2<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> by2<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a <span class="token operator">+=</span> b<span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> bh<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">_PARAM_CHECK_</span></span>    <span class="token comment">/* Aåœ¨Bå·¦è¾¹ */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ax2 <span class="token operator">&lt;</span> bx1<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">/* Aåœ¨Bå³è¾¹ */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>bx2 <span class="token operator">&lt;</span> ax1<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">/* Aåœ¨Bä¸Šè¾¹ */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>by2 <span class="token operator">&lt;</span> ay1<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">/* Aåœ¨Bä¸‹è¾¹ */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ay2 <span class="token operator">&lt;</span> by1<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">IsOverlap4</span><span class="token punctuation">(</span><span class="token keyword">double</span> ax1<span class="token punctuation">,</span> <span class="token keyword">double</span> ay1<span class="token punctuation">,</span> <span class="token keyword">double</span> aw<span class="token punctuation">,</span> <span class="token keyword">double</span> ah<span class="token punctuation">,</span>    <span class="token keyword">double</span> bx1<span class="token punctuation">,</span> <span class="token keyword">double</span> by1<span class="token punctuation">,</span> <span class="token keyword">double</span> bw<span class="token punctuation">,</span> <span class="token keyword">double</span> bh<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">double</span> ax2<span class="token punctuation">,</span> ay2<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> by2<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a <span class="token operator">+=</span> b<span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> bh<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">_PARAM_CHECK_</span></span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>ax1 <span class="token operator">&lt;=</span> bx2 <span class="token operator">&amp;&amp;</span> bx1 <span class="token operator">&lt;=</span> ax2 <span class="token operator">&amp;&amp;</span> ay1 <span class="token operator">&lt;=</span> by2 <span class="token operator">&amp;&amp;</span> by1 <span class="token operator">&lt;=</span> ay2<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">GetOverlap</span><span class="token punctuation">(</span><span class="token keyword">double</span> ax1<span class="token punctuation">,</span> <span class="token keyword">double</span> ay1<span class="token punctuation">,</span> <span class="token keyword">double</span> aw<span class="token punctuation">,</span> <span class="token keyword">double</span> ah<span class="token punctuation">,</span>    <span class="token keyword">double</span> bx1<span class="token punctuation">,</span> <span class="token keyword">double</span> by1<span class="token punctuation">,</span> <span class="token keyword">double</span> bw<span class="token punctuation">,</span> <span class="token keyword">double</span> bh<span class="token punctuation">,</span>    <span class="token keyword">double</span><span class="token operator">*</span> cx1<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> cy1<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> cw<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> ch<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">double</span> ax2<span class="token punctuation">,</span> ay2<span class="token punctuation">,</span> bx2<span class="token punctuation">,</span> by2<span class="token punctuation">;</span>    <span class="token keyword">double</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a <span class="token operator">+=</span> b<span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>ay1<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> ay2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>bx1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bx2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_PARAM_CHECK_</span><span class="token punctuation">(</span>by1<span class="token punctuation">,</span> bh<span class="token punctuation">,</span> by2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">_PARAM_CHECK_</span></span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ax1 <span class="token operator">&lt;=</span> bx2 <span class="token operator">&amp;&amp;</span> bx1 <span class="token operator">&lt;=</span> ax2 <span class="token operator">&amp;&amp;</span> ay1 <span class="token operator">&lt;=</span> by2 <span class="token operator">&amp;&amp;</span> by1 <span class="token operator">&lt;=</span> ay2<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        x1 <span class="token operator">=</span> ax1 <span class="token operator">&gt;</span> bx1 <span class="token operator">?</span> ax1 <span class="token operator">:</span> bx1<span class="token punctuation">;</span>        y1 <span class="token operator">=</span> ay1 <span class="token operator">&gt;</span> by1 <span class="token operator">?</span> ay1 <span class="token operator">:</span> by1<span class="token punctuation">;</span>        x2 <span class="token operator">=</span> ax2 <span class="token operator">&lt;</span> bx2 <span class="token operator">?</span> ax2 <span class="token operator">:</span> bx2<span class="token punctuation">;</span>        y2 <span class="token operator">=</span> ay2 <span class="token operator">&lt;</span> by2 <span class="token operator">?</span> ay2 <span class="token operator">:</span> by2<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> cx1<span class="token punctuation">)</span> <span class="token operator">*</span>cx1 <span class="token operator">=</span> x1<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> cy1<span class="token punctuation">)</span> <span class="token operator">*</span>cy1 <span class="token operator">=</span> y1<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> cw<span class="token punctuation">)</span> <span class="token operator">*</span>cw <span class="token operator">=</span> x2 <span class="token operator">-</span> x1<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">)</span> <span class="token operator">*</span>ch <span class="token operator">=</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">,</span> <span class="token keyword">double</span> ax1<span class="token punctuation">,</span> <span class="token keyword">double</span> ay1<span class="token punctuation">,</span> <span class="token keyword">double</span> aw<span class="token punctuation">,</span> <span class="token keyword">double</span> ah<span class="token punctuation">,</span>    <span class="token keyword">double</span> bx1<span class="token punctuation">,</span> <span class="token keyword">double</span> by1<span class="token punctuation">,</span> <span class="token keyword">double</span> bw<span class="token punctuation">,</span> <span class="token keyword">double</span> bh<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">double</span> cx1 <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> cy1 <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> cw <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> ch <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> s<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Test:%s\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"A:%lf, %lf, %lf, %lf\n"</span><span class="token punctuation">,</span> ax1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ah<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"B:%lf, %lf, %lf, %lf\n"</span><span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bh<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Result1:%d\n"</span><span class="token punctuation">,</span> <span class="token function">IsOverlap1</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Result2:%d\n"</span><span class="token punctuation">,</span> <span class="token function">IsOverlap2</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Result3:%d\n"</span><span class="token punctuation">,</span> <span class="token function">IsOverlap3</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Result4:%d\n"</span><span class="token punctuation">,</span> <span class="token function">IsOverlap4</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">GetOverlap</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ay1<span class="token punctuation">,</span> aw<span class="token punctuation">,</span> ah<span class="token punctuation">,</span> bx1<span class="token punctuation">,</span> by1<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> bh<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cx1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cy1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cw<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Overlap:%lf, %lf, %lf, %lf\n"</span><span class="token punctuation">,</span> cx1<span class="token punctuation">,</span> cy1<span class="token punctuation">,</span> cw<span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The left-up    of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The left-down  of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The right-up   of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The right-down of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The left-up    of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The left-down  of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The right-up   of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The right-down of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The up    of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The down  of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The left  of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The right of B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">4.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The up    of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The down  of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The left  of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The right of A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span>  <span class="token number">4.0</span><span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The B in A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"The A in B"</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"horizontal A cross vertical B"</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Test</span><span class="token punctuation">(</span><span class="token string">"horizontal B cross vertical A"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»£ç æµ‹è¯•ç»“æœ"><a href="#ä»£ç æµ‹è¯•ç»“æœ" class="headerlink" title="ä»£ç æµ‹è¯•ç»“æœ"></a>ä»£ç æµ‹è¯•ç»“æœ</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">-----------------------------------------------Test:The left-up    of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, 2.000000, -2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 1.000000, 1.000000, 1.000000-----------------------------------------------Test:The left-down  of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 1.000000, 1.000000-----------------------------------------------Test:The right-up   of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, -2.000000, -2.000000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 1.000000, 1.000000, 1.000000-----------------------------------------------Test:The right-down of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, -2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 2.000000, 1.000000, 1.000000-----------------------------------------------Test:The left-up    of A in BA:2.000000, 2.000000, 2.000000, -2.000000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 1.000000, 1.000000, 1.000000-----------------------------------------------Test:The left-down  of A in BA:2.000000, 2.000000, 2.000000, 2.000000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 1.000000, 1.000000-----------------------------------------------Test:The right-up   of A in BA:2.000000, 2.000000, -2.000000, -2.000000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 1.000000, 1.000000, 1.000000-----------------------------------------------Test:The right-down of A in BA:2.000000, 2.000000, -2.000000, 2.000000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 2.000000, 1.000000, 1.000000-----------------------------------------------Test:The up    of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, 0.500000, -4.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 1.000000, 0.500000, 1.000000-----------------------------------------------Test:The down  of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, 0.500000, 4.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 0.500000, 1.000000-----------------------------------------------Test:The left  of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, -4.000000, 0.500000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 2.000000, 1.000000, 0.500000-----------------------------------------------Test:The right of B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, 4.000000, 0.500000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 1.000000, 0.500000-----------------------------------------------Test:The up    of A in BA:2.000000, 2.000000, 0.500000, -4.000000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 1.000000, 0.500000, 1.000000-----------------------------------------------Test:The down  of A in BA:2.000000, 2.000000, 0.500000, 4.000000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 0.500000, 1.000000-----------------------------------------------Test:The left  of A in BA:2.000000, 2.000000, -4.000000, 0.500000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 2.000000, 1.000000, 0.500000-----------------------------------------------Test:The right of A in BA:2.000000, 2.000000, 4.000000, 0.500000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 1.000000, 0.500000-----------------------------------------------Test:The B in AA:1.000000, 1.000000, 2.000000, 2.000000B:2.000000, 2.000000, 0.500000, 0.500000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 0.500000, 0.500000-----------------------------------------------Test:The A in BA:2.000000, 2.000000, 0.500000, 0.500000B:1.000000, 1.000000, 2.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:2.000000, 2.000000, 0.500000, 0.500000-----------------------------------------------Test:horizontal A cross vertical BA:0.000000, 1.000000, 2.000000, 1.000000B:1.000000, 0.000000, 1.000000, 2.000000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 1.000000, 1.000000, 1.000000-----------------------------------------------Test:horizontal B cross vertical AA:1.000000, 0.000000, 1.000000, 2.000000B:0.000000, 1.000000, 2.000000, 1.000000Result1:1Result2:1Result3:1Result4:1Overlap:1.000000, 1.000000, 1.000000, 1.000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çŸ©å½¢ç›¸äº¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹Bashä¸­caseç”¨æ³•è¯¦è§£</title>
      <link href="linux-xia-bash-zhong-case-yong-fa-xiang-jie/"/>
      <url>linux-xia-bash-zhong-case-yong-fa-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>Linuxä¸‹Bashä¸­çš„caseå’ŒC/C++ä¸­çš„switchç±»ä¼¼ï¼Œä½†æ˜¯Bashä¸­çš„caseæ›´å¼ºå¤§å’Œå¤æ‚ã€‚</p><ol><li>å¼ºå¤§ä¸»è¦ä½“ç°åœ¨ï¼šBashä¸­caseä¸­çš„å…³é”®å­—å¯ä»¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œæ¯ä¸€é¡¹ä¸­å¯ä»¥åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ã€‚</li><li>å¤æ‚ä¸»è¦ä½“ç°åœ¨ï¼šBashä¸­caseçš„æ¯ä¸€ä¸ªé¡¹åæœ‰ä¸‰ä¸ªé€‰æ‹©ï¼šbreak(å¸¸è§„çš„break)ã€unconditional follow up(æ— æ¡ä»¶ç»§ç»­)å’Œconditional follow up(æœ‰æ¡ä»¶ç»§ç»­)ã€‚</li></ol><p>è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹æ˜¯ä¸Šé¢çš„ç¬¬2ç‚¹ã€‚</p><blockquote><p><code>æ³¨æ„</code>: caseçš„æ— æ¡ä»¶ç»§ç»­å’Œæœ‰æ¡ä»¶ç»§ç»­æ˜¯bash 4.1.xåŠä¹‹åçš„ç‰ˆæœ¬ä¸­æ‰æœ‰çš„ç‰¹æ€§ã€‚</p></blockquote><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä½ å½“å‰bashçš„ç‰ˆæœ¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token environment constant">$BASH_VERSION</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å¸¸è§„çš„breakæ˜¯åœ¨æ¯ä¸€é¡¹åé¢åŠ ;;</li><li>æ— æ¡ä»¶ç»§ç»­æ˜¯åœ¨æ¯ä¸€é¡¹åé¢åŠ ;&amp;</li><li>æœ‰æ¡ä»¶ç»§ç»­å®åœ¨æ¯ä¸€é¡¹åé¢åŠ ;;&amp;</li></ul><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token builtin class-name">echo</span> <span class="token string">"Test No.1 ..."</span><span class="token keyword">case</span> <span class="token string">"1"</span> <span class="token keyword">in</span>    <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'1'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>    <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'2'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'3'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    ?<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'?'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    *<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'*'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span class="token builtin class-name">echo</span> <span class="token string">"Test No.2 ..."</span><span class="token keyword">case</span> <span class="token string">"1"</span> <span class="token keyword">in</span>    <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'1'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'2'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>    <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'3'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    ?<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'?'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    *<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'*'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span class="token builtin class-name">echo</span> <span class="token string">"Test No.3 ..."</span><span class="token keyword">case</span> <span class="token string">"1"</span> <span class="token keyword">in</span>    <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'1'</span>        <span class="token punctuation">;</span><span class="token operator">&amp;</span>    <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'2'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'3'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    ?<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'?'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    *<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'*'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span class="token builtin class-name">echo</span> <span class="token string">"Test No.4 ..."</span><span class="token keyword">case</span> <span class="token string">"1"</span> <span class="token keyword">in</span>    <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'1'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'2'</span>        <span class="token punctuation">;</span><span class="token operator">&amp;</span>    <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'3'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    ?<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'?'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span>    *<span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">'*'</span>        <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰§è¡Œç»“æœ"><a href="#æ‰§è¡Œç»“æœ" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">Test No.1 ...1?Test No.2 ...1Test No.3 ...12Test No.4 ...1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªå¸¦å‚æ•°è§£æçš„Shellä¾‹å­</title>
      <link href="yi-ge-dai-can-shu-jie-xi-de-shell-li-zi/"/>
      <url>yi-ge-dai-can-shu-jie-xi-de-shell-li-zi/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># Program:</span><span class="token comment">#   LZSH server log filter</span><span class="token comment"># History:</span><span class="token comment">#   2014/07/01  Kom     First release</span><span class="token comment">#   2014/07/03  Kom     Remote and multi-param support</span><span class="token comment">#   2014/07/18  Kom     Fix multi keyword bug</span><span class="token comment">#   2014/07/18  Kom     Continue exe even if some cmd failed</span><span class="token comment">#   2014/07/18  Kom     optimize</span><span class="token comment"># Set PATH</span><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span><span class="token comment">#Disable filename globbing</span><span class="token builtin class-name">set</span> -f<span class="token comment"># Set script name variable</span><span class="token assign-left variable">SCRIPT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $<span class="token punctuation">{</span><span class="token environment constant">BASH_SOURCE</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token assign-left variable">SCRIPT_VER</span><span class="token operator">=</span><span class="token number">20140718</span>-1809<span class="token comment"># Initialize variables to default values</span><span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token assign-left variable">TMPOUTPUT</span><span class="token operator">=</span><span class="token builtin class-name">declare</span> -a KEYS<span class="token builtin class-name">declare</span> -a INPUTS<span class="token assign-left variable">OUTPUT</span><span class="token operator">=</span><span class="token comment"># Set fonts for help</span><span class="token assign-left variable">NORM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>tput sgr0<span class="token variable">`</span></span><span class="token assign-left variable">BOLD</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>tput bold<span class="token variable">`</span></span><span class="token assign-left variable">REV</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>tput smso<span class="token variable">`</span></span><span class="token comment"># Help function</span><span class="token keyword">function</span> <span class="token function-name function">HELP</span><span class="token punctuation">{</span>    <span class="token builtin class-name">echo</span> -e <span class="token punctuation">\</span>n<span class="token string">"<span class="token variable">${BOLD}</span>é¾™ä¹‹å®ˆæŠ¤æ•°æ®è¿‡æ»¤è„šæœ¬<span class="token variable">${SCRIPT}</span><span class="token variable">${NORM}</span>çš„å¸®åŠ©æ–‡æ¡£"</span>    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">${BOLD}</span>ç‰ˆæœ¬ï¼š<span class="token variable">${SCRIPT_VER}</span><span class="token variable">${NORM}</span>"</span><span class="token punctuation">\</span>n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">${REV}</span>ç”¨æ³•:<span class="token variable">${NORM}</span> <span class="token variable">${BOLD}</span><span class="token variable">$SCRIPT</span> å‚æ•°<span class="token variable">${NORM}</span>"</span><span class="token punctuation">\</span>n    <span class="token builtin class-name">echo</span> <span class="token string">"å¯é€‰å‚æ•°:"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${REV}</span>-a<span class="token variable">${NORM}</span>  --è¾“å…¥æ–‡ä»¶æ‰€åœ¨çš„IPï¼Œä¸ºç©ºè¡¨ç¤ºæœ¬åœ°ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${REV}</span>-u<span class="token variable">${NORM}</span>  --è®¿é—®è¾“å…¥æ–‡ä»¶æ‰€ç”¨çš„ç”¨æˆ·åï¼Œå½“æ–‡ä»¶åœ¨æœ¬åœ°æ—¶ä¸ä½¿ç”¨æ­¤å‚æ•°"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${REV}</span>-k<span class="token variable">${NORM}</span>  --ç”¨äºè¿‡æ»¤çš„å…³é”®å­—ï¼Œæ­¤å‚æ•°å¯ä»¥å¤šä¸ªè”åˆä½¿ç”¨(ä¾‹å¦‚ï¼š-kç‰©å“åˆ›å»º -kå¼ºåŒ–çŸ³)"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${REV}</span>-i<span class="token variable">${NORM}</span>  --è¾“å…¥æ–‡ä»¶çš„å…¨è·¯å¾„ï¼Œæ­¤å‚æ•°å¯ä»¥å¤šä¸ªè”åˆä½¿ç”¨(ä¾‹å¦‚ï¼š-i/home/log/objscenesserver21.log.140701-* -i/home/log/objscenesserver40.log.140701-*)"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${REV}</span>-o<span class="token variable">${NORM}</span>  --æœ¬åœ°è¾“å‡ºæ–‡ä»¶çš„å…¨è·¯å¾„(ä¾‹å¦‚ï¼š-o/local/lzsh.log)"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${REV}</span>-t<span class="token variable">${NORM}</span>  --ä¸´æ—¶è¾“å‡ºæ–‡ä»¶çš„å…¨è·¯å¾„ï¼Œå½“æ–‡ä»¶åœ¨æœ¬åœ°æ—¶ä¸ä½¿ç”¨æ­¤å‚æ•°"</span>    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">${REV}</span>-h<span class="token variable">${NORM}</span>  --æ˜¾ç¤ºæ­¤å¸®åŠ©å¹¶é€€å‡º"</span><span class="token punctuation">\</span>n    <span class="token builtin class-name">echo</span> -e <span class="token string">"ç¤ºä¾‹: "</span>    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">${BOLD}</span><span class="token variable">$SCRIPT</span> -a127.0.0.1 -uUsername -kç‰©å“åˆ›å»º -kå¼ºåŒ–çŸ³ -i/home/log/objscenesserver21.log.140701-* -o/local/lzsh.log -t/tmp/lzsh.log<span class="token variable">${NORM}</span>"</span><span class="token punctuation">\</span>n    <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token comment"># Check the number of argument. If none are passed, print help and exit.</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    HELP<span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"è¾“å…¥å‚æ•°ï¼š<span class="token variable">${BOLD}</span><span class="token variable">$*</span><span class="token variable">${NORM}</span>"</span><span class="token keyword">fi</span><span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> :a:u:t:i:o:k:h FLAG<span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token keyword">case</span> <span class="token variable">$FLAG</span> <span class="token keyword">in</span>        a<span class="token punctuation">)</span>            <span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token variable">$OPTARG</span>            <span class="token punctuation">;</span><span class="token punctuation">;</span>        u<span class="token punctuation">)</span>            <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable">$OPTARG</span>            <span class="token punctuation">;</span><span class="token punctuation">;</span>        t<span class="token punctuation">)</span>            <span class="token assign-left variable">TMPOUTPUT</span><span class="token operator">=</span><span class="token variable">$OPTARG</span>            <span class="token punctuation">;</span><span class="token punctuation">;</span>        i<span class="token punctuation">)</span>            <span class="token assign-left variable">INPUTS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">${INPUTS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> <span class="token variable">$OPTARG</span><span class="token punctuation">)</span>            <span class="token punctuation">;</span><span class="token punctuation">;</span>        o<span class="token punctuation">)</span>            <span class="token assign-left variable">OUTPUT</span><span class="token operator">=</span><span class="token variable">$OPTARG</span>            <span class="token punctuation">;</span><span class="token punctuation">;</span>        k<span class="token punctuation">)</span>            <span class="token assign-left variable">KEYS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">${KEYS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> <span class="token variable">$OPTARG</span><span class="token punctuation">)</span>            <span class="token punctuation">;</span><span class="token punctuation">;</span>        h<span class="token punctuation">)</span> <span class="token comment"># show help</span>            HELP            <span class="token punctuation">;</span><span class="token punctuation">;</span>        ?<span class="token punctuation">)</span> <span class="token comment"># unrecognized option - show help</span>            <span class="token builtin class-name">echo</span> -e <span class="token punctuation">\</span>n<span class="token string">"éæ³•å‚æ•°ï¼š-<span class="token variable">${BOLD}</span><span class="token variable">$OPTARG</span><span class="token variable">${NORM}</span>"</span>            HELP            <span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token keyword">esac</span><span class="token keyword">done</span><span class="token builtin class-name">shift</span> <span class="token variable"><span class="token variable">$((</span>OPTIND<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> <span class="token comment">#  This tells getopts to move on to the next argument</span><span class="token comment">#######################################################################</span><span class="token comment"># Parameters check</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${<span class="token operator">#</span>KEYS}</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"ä½ å¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª<span class="token variable">${BOLD}</span>å…³é”®å­—<span class="token variable">${NORM}</span>"</span>    <span class="token builtin class-name">exit</span> -1<span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"å…³é”®å­—ï¼š<span class="token variable">${BOLD}</span><span class="token variable">${KEYS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token variable">${NORM}</span>"</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${<span class="token operator">#</span>INPUTS}</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"ä½ å¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª<span class="token variable">${BOLD}</span>è¾“å…¥æ–‡ä»¶<span class="token variable">${NORM}</span>"</span>    <span class="token builtin class-name">exit</span> -1<span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"è¾“å…¥æ–‡ä»¶ï¼š<span class="token variable">${BOLD}</span><span class="token variable">${INPUTS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token variable">${NORM}</span>"</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token variable">$OUTPUT</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"ä½ å¿…é¡»æŒ‡å®š<span class="token variable">${BOLD}</span>æœ¬åœ°è¾“å‡ºæ–‡ä»¶<span class="token variable">${NORM}</span>"</span>    <span class="token builtin class-name">exit</span> -1<span class="token keyword">fi</span><span class="token builtin class-name">echo</span> <span class="token string">"è¾“å‡ºæ–‡ä»¶ï¼š<span class="token variable">${BOLD}</span><span class="token variable">${OUTPUT<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token variable">${NORM}</span>"</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token variable">$IP</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token environment constant">$USER</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        <span class="token builtin class-name">echo</span> <span class="token string">"å¿…é¡»æŒ‡å®šç”¨äºè®¿é—®<span class="token variable">${BOLD}</span><span class="token variable">${IP}</span><span class="token variable">${NORM}</span>çš„<span class="token variable">${BOLD}</span>ç”¨æˆ·å<span class="token variable">${NORM}</span>"</span>        <span class="token builtin class-name">exit</span> -1    <span class="token keyword">fi</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token variable">$TMPOUTPUT</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        <span class="token builtin class-name">echo</span> <span class="token string">"å¿…é¡»æŒ‡å®šåœ¨<span class="token variable">${BOLD}</span><span class="token variable">${IP}</span><span class="token variable">${NORM}</span>ä¸Šçš„<span class="token variable">${BOLD}</span>ä¸´æ—¶è¾“å‡ºæ–‡ä»¶<span class="token variable">${NORM}</span>"</span>        <span class="token builtin class-name">exit</span> -1    <span class="token keyword">fi</span><span class="token keyword">fi</span><span class="token comment">#######################################################################</span><span class="token comment"># Work</span><span class="token assign-left variable">TARGETOUTPUT</span><span class="token operator">=</span><span class="token string">""</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token variable">$IP</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token assign-left variable">TARGETOUTPUT</span><span class="token operator">=</span><span class="token variable">$TMPOUTPUT</span><span class="token keyword">else</span>    <span class="token assign-left variable">TARGETOUTPUT</span><span class="token operator">=</span><span class="token variable">$OUTPUT</span><span class="token keyword">fi</span><span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> <span class="token for-or-select variable">k</span> <span class="token keyword">in</span> <span class="token variable">${KEYS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token keyword">do</span>    <span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token variable">${CMD}</span><span class="token string">"grep <span class="token variable">$k</span> <span class="token variable">${INPUTS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> &gt;&gt; <span class="token variable">$TARGETOUTPUT</span>; "</span><span class="token keyword">done</span><span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token string">"echo &gt; <span class="token variable">$TARGETOUTPUT</span>; <span class="token variable">$CMD</span>"</span><span class="token builtin class-name">echo</span> <span class="token variable">$CMD</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token variable">$IP</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> -e <span class="token punctuation">\</span>n<span class="token string">"å°†è¦æ‰§è¡Œsshå‘½ä»¤ï¼š"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${BOLD}</span>ssh <span class="token environment constant">$USER</span>@<span class="token variable">$IP</span> "</span><span class="token variable">$CMD</span><span class="token string">"<span class="token variable">${NORM}</span>"</span>    <span class="token function">sh</span> -c <span class="token string">"ssh <span class="token environment constant">$USER</span>@<span class="token variable">$IP</span> "</span><span class="token variable">$CMD</span><span class="token string">""</span>    <span class="token builtin class-name">echo</span> -e <span class="token punctuation">\</span>n<span class="token string">"å°†è¦æ‰§è¡Œscpå‘½ä»¤ï¼š"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${BOLD}</span>scp <span class="token environment constant">$USER</span>@<span class="token variable">$IP</span>:<span class="token variable">$TMPOUTPUT</span> <span class="token variable">$OUTPUT</span><span class="token variable">${NORM}</span>"</span>    <span class="token function">sh</span> -c <span class="token string">"scp <span class="token environment constant">$USER</span>@<span class="token variable">$IP</span>:<span class="token variable">$TMPOUTPUT</span> <span class="token variable">$OUTPUT</span>"</span><span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> -e <span class="token punctuation">\</span>n<span class="token string">"å°†è¦æ‰§è¡Œå‘½ä»¤ï¼š"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${BOLD}</span><span class="token variable">$CMD</span><span class="token variable">${NORM}</span>"</span>    <span class="token function">sh</span> -c <span class="token string">"<span class="token variable">$CMD</span>"</span><span class="token keyword">fi</span><span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Win32ç¨‹åºå‘ç”Ÿå¼‚å¸¸æ—¶å¤„ç†çš„æµç¨‹</title>
      <link href="win32-cheng-xu-fa-sheng-yi-chang-shi-chu-li-de-liu-cheng/"/>
      <url>win32-cheng-xu-fa-sheng-yi-chang-shi-chu-li-de-liu-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç¨‹åºæ²¡æœ‰è¢«è°ƒè¯•"><a href="#ä¸€ã€ç¨‹åºæ²¡æœ‰è¢«è°ƒè¯•" class="headerlink" title="ä¸€ã€ç¨‹åºæ²¡æœ‰è¢«è°ƒè¯•"></a>ä¸€ã€ç¨‹åºæ²¡æœ‰è¢«è°ƒè¯•</h2><ol><li>çº¿ç¨‹å»ºç«‹æ—¶ï¼Œç³»ç»Ÿå®‰è£…ä¸€ä¸ªç³»ç»Ÿçº¿ç¨‹å¼‚å¸¸å¤„ç†ä¾‹ç¨‹ã€‚</li><li>å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒWin2K/XPæ§åˆ¶æƒè½¬ç§»ç»™NTDLL.KiUserExceptionDispatcherã€‚</li><li>å¦‚æœä½ å®‰è£…äº†çº¿ç¨‹ç›¸å…³çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹ï¼Œç³»ç»Ÿå°±æŠŠå¼‚å¸¸å‘é€ç»™ä½ çš„å¤„ç†ä¾‹ç¨‹ï¼Œäº¤ç”±å…¶å¤„ç†ã€‚</li><li>æ¯ä¸ªçº¿ç¨‹ç›¸å…³çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹å¯ä»¥å¤„ç†æˆ–è€…ä¸å¤„ç†è¿™ä¸ªå¼‚å¸¸,å¦‚æœä»–ä¸å¤„ç†å¹¶ä¸”å®‰è£…äº†å¤šä¸ªçº¿ç¨‹ç›¸å…³çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹ï¼Œå¯äº¤ç”±é“¾èµ·æ¥çš„å…¶ä»–ä¾‹ç¨‹å¤„ç†ã€‚</li><li>å¦‚æœè¿™äº›ä¾‹ç¨‹å‡é€‰æ‹©ä¸å¤„ç†å¼‚å¸¸ï¼Œç³»ç»Ÿçº¿ç¨‹å¼‚å¸¸å¤„ç†ä¾‹ç¨‹å°†èµ·ä½œç”¨ï¼Œè°ƒç”¨ZwQueryInformationProcessåˆ¤æ–­æ˜¯å¦è¢«è°ƒè¯•ï¼Œæ²¡æœ‰è°ƒè¯•å¹¶ä¸”ä½ è°ƒç”¨SetUnhandledExceptionFilterå®‰è£…äº†æœ€åå¼‚å¸¸å¤„ç†ä¾‹ç¨‹çš„è¯ï¼Œç³»ç»Ÿè½¬å‘å¯¹å®ƒçš„è°ƒç”¨ã€‚</li><li>å¦‚æœä½ æ²¡æœ‰å®‰è£…æœ€åå¼‚å¸¸å¤„ç†ä¾‹ç¨‹æˆ–è€…ä»–æ²¡æœ‰å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œç³»ç»Ÿä¼šè°ƒç”¨é»˜è®¤çš„ç³»ç»Ÿå¤„ç†ç¨‹åºï¼Œé€šå¸¸æ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œä½ å¯ä»¥é€‰æ‹©å…³é—­æˆ–è€…æœ€åå°†å…¶é™„åŠ åˆ°è°ƒè¯•å™¨ä¸Šçš„è°ƒè¯•æŒ‰é’®ã€‚å¦‚æœæ²¡æœ‰è°ƒè¯•å™¨èƒ½è¢«é™„åŠ äºå…¶ä¸Šæˆ–è€…è°ƒè¯•å™¨ä¹Ÿå¤„ç†ä¸äº†ï¼Œç³»ç»Ÿå°±è°ƒç”¨ExitProcessç»ˆç»“ç¨‹åºã€‚</li><li>ä¸è¿‡åœ¨ç»ˆç»“ä¹‹å‰ï¼Œç³»ç»Ÿä»ç„¶å¯¹å‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹å¼‚å¸¸å¤„ç†å¥æŸ„æ¥ä¸€æ¬¡å±•å¼€ï¼Œè¿™æ˜¯çº¿ç¨‹å¼‚å¸¸å¤„ç†ä¾‹ç¨‹æœ€åæ¸…ç†çš„æœºä¼šã€‚ä¸€èˆ¬åªç”¨æ¥é‡Šæ”¾èµ„æºï¼Œä¸è¦è¯•å›¾ä¿®å¤ä»€ä¹ˆã€‚æ³¨æ„åªå¯¹çº¿ç¨‹å¼‚å¸¸æœ‰å±•å¼€ã€‚</li></ol><h2 id="äºŒã€ç¨‹åºè¢«è°ƒè¯•"><a href="#äºŒã€ç¨‹åºè¢«è°ƒè¯•" class="headerlink" title="äºŒã€ç¨‹åºè¢«è°ƒè¯•"></a>äºŒã€ç¨‹åºè¢«è°ƒè¯•</h2><ol><li>çº¿ç¨‹å»ºç«‹æ—¶ï¼Œç³»ç»Ÿå®‰è£…ä¸€ä¸ªç³»ç»Ÿçº¿ç¨‹å¼‚å¸¸å¤„ç†ä¾‹ç¨‹ã€‚</li><li>å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œç³»ç»ŸæŒ‚èµ·ç¨‹åºå¹¶å‘è°ƒè¯•å™¨å‘é€ã€‚EXCEPTION_DEBUG_EVENTæ¶ˆæ¯ã€‚</li><li>è°ƒè¯•å™¨æœªèƒ½å¤„ç†å¼‚å¸¸(æ¯”å¦‚æˆ‘ä»¬åœ¨ODé‡ŒæŒ‰Shift+F7)ï¼Œæ§åˆ¶æƒè½¬ç§»ç»™ NTDLLã€‚KiUserExceptionDispatcherå¦‚æœä½ å®‰è£…äº†çº¿ç¨‹ç›¸å…³çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹ï¼Œç³»ç»Ÿå°±æŠŠå¼‚å¸¸å‘é€ç»™ä½ çš„ç¨‹åºsehå¤„ç†ä¾‹ç¨‹ï¼Œäº¤ç”±å…¶å¤„ç†ã€‚</li><li>æ¯ä¸ªçº¿ç¨‹ç›¸å…³çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹å¯ä»¥å¤„ç†æˆ–è€…ä¸å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œå¦‚æœä»–ä¸å¤„ç†å¹¶ä¸”å®‰è£…äº†å¤šä¸ªçº¿ç¨‹ç›¸å…³çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹ï¼Œå¯äº¤ç”±é“¾èµ·æ¥çš„å…¶ä»–ä¾‹ç¨‹å¤„ç†ã€‚</li><li>å¦‚æœè¿™äº›ä¾‹ç¨‹å‡é€‰æ‹©ä¸å¤„ç†å¼‚å¸¸ï¼Œç³»ç»Ÿçº¿ç¨‹å¼‚å¸¸å¤„ç†ä¾‹ç¨‹å°†èµ·ä½œç”¨ï¼Œè°ƒç”¨ZwQueryInformationProcessåˆ¤æ–­æ˜¯å¦è¢«è°ƒè¯•ã€‚</li><li>ç”±äºè¢«è°ƒè¯•ï¼Œæ“ä½œç³»ç»Ÿä»ä¼šå†æ¬¡æŒ‚èµ·ç¨‹åºé€šçŸ¥debuggerã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é€†å‘å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++é‡è½½å†…å­˜åˆ†é…æ—¶éœ€è¦æ³¨æ„çš„åœ°æ–¹</title>
      <link href="c-chong-zai-nei-cun-fen-pei-shi-xu-yao-zhu-yi-de-di-fang/"/>
      <url>c-chong-zai-nei-cun-fen-pei-shi-xu-yao-zhu-yi-de-di-fang/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€æµ‹è¯•ä»£ç "><a href="#ä¸€ã€æµ‹è¯•ä»£ç " class="headerlink" title="ä¸€ã€æµ‹è¯•ä»£ç "></a>ä¸€ã€æµ‹è¯•ä»£ç </h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;malloc.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;new&gt;</span></span><span class="token comment">//#define VF</span><span class="token comment">//#define FLAG</span><span class="token keyword">class</span> <span class="token class-name">MemObj</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">VF</span></span>    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">MemObj</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// VF</span></span>    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size_t stSize<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"operator new(size_t) %d\n"</span><span class="token punctuation">,</span> stSize<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">malloc</span><span class="token punctuation">(</span>stSize<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">FLAG</span></span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"operator delete(void*)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">free</span><span class="token punctuation">(</span>pMemory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">,</span> size_t stSize<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"operator delete(void*, size_t) %d\n"</span><span class="token punctuation">,</span> stSize<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">free</span><span class="token punctuation">(</span>pMemory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">MemObj</span></span><span class="token punctuation">{</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">int</span> m_nValue<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    MemObj<span class="token operator">*</span> pObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MemObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">delete</span> pObj<span class="token punctuation">;</span>    Test<span class="token operator">*</span> pTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">delete</span> pTest<span class="token punctuation">;</span>    pObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">delete</span> pObj<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒã€æµ‹è¯•"><a href="#äºŒã€æµ‹è¯•" class="headerlink" title="äºŒã€æµ‹è¯•"></a>äºŒã€æµ‹è¯•</h2><p>é€šè¿‡æ§åˆ¶å®VFå’Œå®FLAGçš„å®šä¹‰ä¸å¦æ¥æŸ¥çœ‹å„ä¸ªæƒ…å†µä¸‹ä»£ç è¿è¡Œçš„ç»“æœã€‚</p><h3 id="æµ‹è¯•1ï¼šä¸å®šä¹‰å®VFå’ŒFLAG"><a href="#æµ‹è¯•1ï¼šä¸å®šä¹‰å®VFå’ŒFLAG" class="headerlink" title="æµ‹è¯•1ï¼šä¸å®šä¹‰å®VFå’ŒFLAG"></a>æµ‹è¯•1ï¼šä¸å®šä¹‰å®VFå’ŒFLAG</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">operator new(size_t) 1operator delete(void*, size_t) 1operator new(size_t) 4operator delete(void*, size_t) 1operator new(size_t) 4operator delete(void*, size_t) 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•2ï¼šå®šä¹‰å®FLAGä½†ä¸å®šä¹‰å®VF"><a href="#æµ‹è¯•2ï¼šå®šä¹‰å®FLAGä½†ä¸å®šä¹‰å®VF" class="headerlink" title="æµ‹è¯•2ï¼šå®šä¹‰å®FLAGä½†ä¸å®šä¹‰å®VF"></a>æµ‹è¯•2ï¼šå®šä¹‰å®FLAGä½†ä¸å®šä¹‰å®VF</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">operator new(size_t) 1operator delete(void*)operator new(size_t) 4operator delete(void*)operator new(size_t) 4operator delete(void*)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•3ï¼šå®šä¹‰å®VFä½†ä¸å®šä¹‰å®FLAG"><a href="#æµ‹è¯•3ï¼šå®šä¹‰å®VFä½†ä¸å®šä¹‰å®FLAG" class="headerlink" title="æµ‹è¯•3ï¼šå®šä¹‰å®VFä½†ä¸å®šä¹‰å®FLAG"></a>æµ‹è¯•3ï¼šå®šä¹‰å®VFä½†ä¸å®šä¹‰å®FLAG</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">operator new(size_t) 4operator delete(void*, size_t) 4operator new(size_t) 8operator delete(void*, size_t) 8operator new(size_t) 8operator delete(void*, size_t) 8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•4ï¼šåŒæ—¶å®šä¹‰å®VFå’ŒFLAG"><a href="#æµ‹è¯•4ï¼šåŒæ—¶å®šä¹‰å®VFå’ŒFLAG" class="headerlink" title="æµ‹è¯•4ï¼šåŒæ—¶å®šä¹‰å®VFå’ŒFLAG"></a>æµ‹è¯•4ï¼šåŒæ—¶å®šä¹‰å®VFå’ŒFLAG</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">operator new(size_t) 4operator delete(void*)operator new(size_t) 8operator delete(void*)operator new(size_t) 8operator delete(void*)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸‰ã€ç»“æœåˆ†æ"><a href="#ä¸‰ã€ç»“æœåˆ†æ" class="headerlink" title="ä¸‰ã€ç»“æœåˆ†æ"></a>ä¸‰ã€ç»“æœåˆ†æ</h2><h3 id="1-å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•2"><a href="#1-å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•2" class="headerlink" title="1. å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•2"></a>1. å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•2</h3><p>é‡è½½äº†operator new(size_t stSize)åï¼Œåœ¨åˆ é™¤çš„æ—¶å€™ï¼š</p><ol><li>å¦‚æœæ²¡æœ‰å®šä¹‰<code>void operator delete(void* pMemory)ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨void operator delete(void* pMemory, size_t stSize)</code>ï¼›</li><li>å¦‚æœå®šä¹‰äº†<code>void operator delete(void* pMemory)ï¼Œä¸ç®¡æ˜¯å¦å®šä¹‰void operator delete(void* pMemory, size_t stSize)éƒ½ä¼šè°ƒç”¨void operator delete(void* pMemory)</code>ã€‚</li></ol><p>ç»“è®ºï¼š<br>é‡è½½operator new(size_t)åï¼Œå¦‚æœåŒæ—¶é‡è½½äº†operator delete(void<em>)ï¼Œåˆ é™¤æ—¶å€™ä¼šè°ƒç”¨operator delete(void</em>)ï¼Œå¦åˆ™æ‰ä¼šè°ƒç”¨operator delete(void*, size_t)ã€‚</p><h3 id="2-å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•3"><a href="#2-å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•3" class="headerlink" title="2. å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•3"></a>2. å¯¹æ¯”æµ‹è¯•1å’Œæµ‹è¯•3</h3><p>å¦‚æœä¸å°†åŸºç±»çš„ææ„å‡½æ•°å®šä¹‰ä¸ºè™šææ„å‡½æ•°ï¼Œä¼šæœ‰å†…å­˜æ³„æ¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Win32ä¸‹FSå¯„å­˜å™¨ã€TEBå’ŒPEBè¯¦è§£</title>
      <link href="win32-xia-fs-ji-cun-qi-teb-he-peb-xiang-jie/"/>
      <url>win32-xia-fs-ji-cun-qi-teb-he-peb-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>åœ¨Win32ä¸‹ï¼ŒFSæ®µå¯„å­˜å™¨æŒ‡å‘å½“å‰çš„TEBç»“æ„ï¼Œåœ¨TEBç¼–è¯‘0x30å¤„æ˜¯PEBæŒ‡é’ˆï¼Œé€šè¿‡è¿™ä¸ªæŒ‡é’ˆå³å¯è·å¾—PEDçš„åœ°å€ã€‚</p><p>å®ç°æ–¹æ³•ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">__asm<span class="token punctuation">{</span>    mov eax<span class="token punctuation">,</span> fs<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0x30</span><span class="token punctuation">]</span>    mov PED<span class="token punctuation">,</span> eax<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>TEBå’ŒPEBçš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">PEB_BASE</span> <span class="token punctuation">(</span><span class="token number">0x7ffdf000</span><span class="token punctuation">)</span></span></span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_NT_TIB</span><span class="token punctuation">{</span>                                           <span class="token comment">// Size: 01C</span>    <span class="token keyword">struct</span> <span class="token class-name">_EXCEPTION_REGISTRATION_RECORD</span> <span class="token operator">*</span>ExceptionList<span class="token punctuation">;</span> <span class="token comment">// 000</span>    PVOID StackBase<span class="token punctuation">;</span>                        <span class="token comment">// 004</span>    PVOID StackLimit<span class="token punctuation">;</span>                       <span class="token comment">// 008</span>    PVOID SubSystemTib<span class="token punctuation">;</span>                     <span class="token comment">// 00C</span>    <span class="token keyword">union</span>                                   <span class="token comment">// 010</span>    <span class="token punctuation">{</span>        PVOID FiberData<span class="token punctuation">;</span>        ULONG Version<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    PVOID ArbitraryUserPointer<span class="token punctuation">;</span>             <span class="token comment">// 014</span>    <span class="token keyword">struct</span> <span class="token class-name">_NT_TIB</span> <span class="token operator">*</span>Self<span class="token punctuation">;</span>                   <span class="token comment">// 018</span><span class="token punctuation">}</span> NT_TIB<span class="token punctuation">,</span> <span class="token operator">*</span>PNT_TIB<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_TEB</span><span class="token punctuation">{</span>                                           <span class="token comment">// Size:  FBC</span>    NT_TIB Tib<span class="token punctuation">;</span>                             <span class="token comment">// 000</span>    PVOID EnvironmentPointer<span class="token punctuation">;</span>               <span class="token comment">// 01C</span>    CLIENT_ID Cid<span class="token punctuation">;</span>                          <span class="token comment">// 020</span>    PVOID ActiveRpcHandle<span class="token punctuation">;</span>                  <span class="token comment">// 028</span>    PVOID ThreadLocalStoragePointer<span class="token punctuation">;</span>        <span class="token comment">// 02C</span>    <span class="token keyword">struct</span> <span class="token class-name">_PEB</span> <span class="token operator">*</span>ProcessEnvironmentBlock<span class="token punctuation">;</span>   <span class="token comment">// 030</span>    ULONG LastErrorValue<span class="token punctuation">;</span>                   <span class="token comment">// 034</span>    ULONG CountOfOwnedCriticalSections<span class="token punctuation">;</span>     <span class="token comment">// 038</span>    PVOID CsrClientThread<span class="token punctuation">;</span>                  <span class="token comment">// 03C</span>    <span class="token keyword">struct</span> <span class="token class-name">_W32THREAD</span><span class="token operator">*</span> Win32ThreadInfo<span class="token punctuation">;</span>     <span class="token comment">// 040</span>    ULONG User32Reserved<span class="token punctuation">[</span><span class="token number">0x1A</span><span class="token punctuation">]</span><span class="token punctuation">;</span>             <span class="token comment">// 044</span>    ULONG UserReserved<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                  <span class="token comment">// 0AC</span>    PVOID WOW32Reserved<span class="token punctuation">;</span>                    <span class="token comment">// 0C0</span>    LCID CurrentLocale<span class="token punctuation">;</span>                     <span class="token comment">// 0C4</span>    ULONG FpSoftwareStatusRegister<span class="token punctuation">;</span>         <span class="token comment">// 0C8</span>    PVOID SystemReserved1<span class="token punctuation">[</span><span class="token number">0x36</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// 0CC</span>    LONG ExceptionCode<span class="token punctuation">;</span>                     <span class="token comment">// 1A4</span>    <span class="token keyword">struct</span> <span class="token class-name">_ACTIVATION_CONTEXT_STACK</span> <span class="token operator">*</span>ActivationContextStackPointer<span class="token punctuation">;</span> <span class="token comment">// 1A8</span>    UCHAR SpareBytes1<span class="token punctuation">[</span><span class="token number">0x28</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// 1AC</span>    GDI_TEB_BATCH GdiTebBatch<span class="token punctuation">;</span>              <span class="token comment">// 1D4</span>    CLIENT_ID RealClientId<span class="token punctuation">;</span>                 <span class="token comment">// 6B4</span>    PVOID GdiCachedProcessHandle<span class="token punctuation">;</span>           <span class="token comment">// 6BC</span>    ULONG GdiClientPID<span class="token punctuation">;</span>                     <span class="token comment">// 6C0</span>    ULONG GdiClientTID<span class="token punctuation">;</span>                     <span class="token comment">// 6C4</span>    PVOID GdiThreadLocalInfo<span class="token punctuation">;</span>               <span class="token comment">// 6C8</span>    ULONG Win32ClientInfo<span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token comment">// 6CC</span>    PVOID glDispatchTable<span class="token punctuation">[</span><span class="token number">0xE9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// 7C4</span>    ULONG glReserved1<span class="token punctuation">[</span><span class="token number">0x1D</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// B68</span>    PVOID glReserved2<span class="token punctuation">;</span>                      <span class="token comment">// BDC</span>    PVOID glSectionInfo<span class="token punctuation">;</span>                    <span class="token comment">// BE0</span>    PVOID glSection<span class="token punctuation">;</span>                        <span class="token comment">// BE4</span>    PVOID glTable<span class="token punctuation">;</span>                          <span class="token comment">// BE8</span>    PVOID glCurrentRC<span class="token punctuation">;</span>                      <span class="token comment">// BEC</span>    PVOID glContext<span class="token punctuation">;</span>                        <span class="token comment">// BF0</span>    NTSTATUS LastStatusValue<span class="token punctuation">;</span>               <span class="token comment">// BF4</span>    UNICODE_STRING StaticUnicodeString<span class="token punctuation">;</span>     <span class="token comment">// BF8</span>    WCHAR StaticUnicodeBuffer<span class="token punctuation">[</span><span class="token number">0x105</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// C00</span>    PVOID DeallocationStack<span class="token punctuation">;</span>                <span class="token comment">// E0C</span>    PVOID TlsSlots<span class="token punctuation">[</span><span class="token number">0x40</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                   <span class="token comment">// E10</span>    LIST_ENTRY TlsLinks<span class="token punctuation">;</span>                    <span class="token comment">// F10</span>    PVOID Vdm<span class="token punctuation">;</span>                              <span class="token comment">// F18</span>    PVOID ReservedForNtRpc<span class="token punctuation">;</span>                 <span class="token comment">// F1C</span>    PVOID DbgSsReserved<span class="token punctuation">[</span><span class="token number">0x2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>               <span class="token comment">// F20</span>    ULONG HardErrorDisabled<span class="token punctuation">;</span>                <span class="token comment">// F28</span>    PVOID Instrumentation<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token comment">// F2C</span>    PVOID SubProcessTag<span class="token punctuation">;</span>                    <span class="token comment">// F64</span>    PVOID EtwTraceData<span class="token punctuation">;</span>                     <span class="token comment">// F68</span>    PVOID WinSockData<span class="token punctuation">;</span>                      <span class="token comment">// F6C</span>    ULONG GdiBatchCount<span class="token punctuation">;</span>                    <span class="token comment">// F70</span>    BOOLEAN InDbgPrint<span class="token punctuation">;</span>                     <span class="token comment">// F74</span>    BOOLEAN FreeStackOnTermination<span class="token punctuation">;</span>         <span class="token comment">// F75</span>    BOOLEAN HasFiberData<span class="token punctuation">;</span>                   <span class="token comment">// F76</span>    UCHAR IdealProcessor<span class="token punctuation">;</span>                   <span class="token comment">// F77</span>    ULONG GuaranteedStackBytes<span class="token punctuation">;</span>             <span class="token comment">// F78</span>    PVOID ReservedForPerf<span class="token punctuation">;</span>                  <span class="token comment">// F7C</span>    PVOID ReservedForOle<span class="token punctuation">;</span>                   <span class="token comment">// F80</span>    ULONG WaitingOnLoaderLock<span class="token punctuation">;</span>              <span class="token comment">// F84</span>    ULONG SparePointer1<span class="token punctuation">;</span>                    <span class="token comment">// F88</span>    ULONG SoftPatchPtr1<span class="token punctuation">;</span>                    <span class="token comment">// F8C</span>    ULONG SoftPatchPtr2<span class="token punctuation">;</span>                    <span class="token comment">// F90</span>    PVOID <span class="token operator">*</span>TlsExpansionSlots<span class="token punctuation">;</span>               <span class="token comment">// F94</span>    ULONG ImpersionationLocale<span class="token punctuation">;</span>             <span class="token comment">// F98</span>    ULONG IsImpersonating<span class="token punctuation">;</span>                  <span class="token comment">// F9C</span>    PVOID NlsCache<span class="token punctuation">;</span>                         <span class="token comment">// FA0</span>    PVOID pShimData<span class="token punctuation">;</span>                        <span class="token comment">// FA4</span>    ULONG HeapVirualAffinity<span class="token punctuation">;</span>               <span class="token comment">// FA8</span>    PVOID CurrentTransactionHandle<span class="token punctuation">;</span>         <span class="token comment">// FAC</span>    PTEB_ACTIVE_FRAME ActiveFrame<span class="token punctuation">;</span>          <span class="token comment">// FB0</span>    PVOID FlsData<span class="token punctuation">;</span>                          <span class="token comment">// FB4</span>    UCHAR SafeThunkCall<span class="token punctuation">;</span>                    <span class="token comment">// FB8</span>    UCHAR BooleanSpare<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                  <span class="token comment">// FB9</span><span class="token punctuation">}</span> TEB<span class="token punctuation">,</span> <span class="token operator">*</span>PTEB<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_LIST_ENTRY</span><span class="token punctuation">{</span>                                           <span class="token comment">// Size: 008</span>    <span class="token keyword">struct</span> <span class="token class-name">_LIST_ENTRY</span> <span class="token operator">*</span>Flink<span class="token punctuation">;</span>              <span class="token comment">// 000 ä»å‰åˆ°å</span>    <span class="token keyword">struct</span> <span class="token class-name">_LIST_ENTRY</span> <span class="token operator">*</span>Blink<span class="token punctuation">;</span>              <span class="token comment">// 004 ä»ååˆ°å‰</span><span class="token punctuation">}</span> LIST_ENTRY<span class="token punctuation">,</span> <span class="token operator">*</span>PLIST_ENTRY<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_PER_LDR_DATA</span><span class="token punctuation">{</span>                                           <span class="token comment">// Size: 0024</span>    ULONG Length<span class="token punctuation">;</span>                           <span class="token comment">// 000</span>    BOOLEAN Initialize<span class="token punctuation">;</span>                     <span class="token comment">// 004</span>    PVOID SsHandle<span class="token punctuation">;</span>                         <span class="token comment">// 008</span>    LIST_ENTRY InLoadOrderModuleList<span class="token punctuation">;</span>       <span class="token comment">// 00C</span>    LIST_ENTRY InMemoryOrderModuleList<span class="token punctuation">;</span>     <span class="token comment">// 014</span>    LIST_ENTRY InInitializationOrderModuleList<span class="token punctuation">;</span> <span class="token comment">// 01C</span><span class="token punctuation">}</span> PER_LDR_DATA<span class="token punctuation">,</span> <span class="token operator">*</span>PPER_LDR_DATA<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_UNICODE_STRING</span><span class="token punctuation">{</span>                                           <span class="token comment">// Size: 008</span>  USHORT  Length<span class="token punctuation">;</span>                           <span class="token comment">// 000 å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼Œä¸ªæ•°*2ï¼›</span>  USHORT  MaximumLength<span class="token punctuation">;</span>                    <span class="token comment">// 002</span>  PWSTR  Buffer<span class="token punctuation">;</span>                            <span class="token comment">// 004</span><span class="token punctuation">}</span> UNICODE_STRING <span class="token punctuation">,</span><span class="token operator">*</span>PUNICODE_STRING<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_LDR_DATA_TABLE_ENTRY</span><span class="token punctuation">{</span>                                           <span class="token comment">// Size: 050</span>     LIST_ENTRY InLoadOrderLinks<span class="token punctuation">;</span>           <span class="token comment">// 000 LIST_ENTRYé‡Œçš„Flinkå’ŒBlinkå…¶å®æ˜¯æŒ‡å‘LDR_MODULEç»“æ„ï¼Œå³LDR_DATA_TABLE_ENTRY</span>     LIST_ENTRY InMemoryOrderLinks<span class="token punctuation">;</span>         <span class="token comment">// 008 åŒä¸Š</span>     LIST_ENTRY InInitializationOrderLinks<span class="token punctuation">;</span> <span class="token comment">// 010 åŒä¸Š</span>     PVOID DllBase<span class="token punctuation">;</span>                         <span class="token comment">// 018</span>     PVOID EntryPoint<span class="token punctuation">;</span>                      <span class="token comment">// 01C</span>     ULONG SizeOfImage<span class="token punctuation">;</span>                     <span class="token comment">// 020</span>     UNICODE_STRING FullDllName<span class="token punctuation">;</span>            <span class="token comment">// 024</span>     UNICODE_STRING BaseDllName<span class="token punctuation">;</span>            <span class="token comment">// 02C</span>     ULONG Flags<span class="token punctuation">;</span>                           <span class="token comment">// 034</span>     WORD LoadCount<span class="token punctuation">;</span>                        <span class="token comment">// 038</span>     WORD TlsIndex<span class="token punctuation">;</span>                         <span class="token comment">// 03A</span>     <span class="token keyword">union</span>                                  <span class="token comment">// 03C</span>     <span class="token punctuation">{</span>          LIST_ENTRY HashLinks<span class="token punctuation">;</span>             <span class="token comment">// 03C</span>          <span class="token keyword">struct</span>          <span class="token punctuation">{</span>               PVOID SectionPointer<span class="token punctuation">;</span>        <span class="token comment">// 03C</span>               ULONG CheckSum<span class="token punctuation">;</span>              <span class="token comment">// 040</span>          <span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token keyword">union</span>     <span class="token punctuation">{</span>          ULONG TimeDateStamp<span class="token punctuation">;</span>              <span class="token comment">// 044</span>          PVOID LoadedImports<span class="token punctuation">;</span>              <span class="token comment">// 044</span>     <span class="token punctuation">}</span><span class="token punctuation">;</span>     _ACTIVATION_CONTEXT <span class="token operator">*</span> EntryPointActivationContext<span class="token punctuation">;</span> <span class="token comment">// 048</span>     PVOID PatchInformation<span class="token punctuation">;</span>                <span class="token comment">// 04C</span><span class="token punctuation">}</span> LDR_DATA_TABLE_ENTRY<span class="token punctuation">,</span> <span class="token operator">*</span>PLDR_DATA_TABLE_ENTRY<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_PEB</span><span class="token punctuation">{</span>                                           <span class="token comment">// Size: 1D8</span>    UCHAR InheritedAddressSpace<span class="token punctuation">;</span>            <span class="token comment">// 000</span>    UCHAR ReadImageFileExecOptions<span class="token punctuation">;</span>         <span class="token comment">// 001</span>    UCHAR BeingDebugged<span class="token punctuation">;</span>                    <span class="token comment">// 002</span>    UCHAR SpareBool<span class="token punctuation">;</span>                        <span class="token comment">// 003 Allocation size</span>    HANDLE Mutant<span class="token punctuation">;</span>                          <span class="token comment">// 004</span>    HINSTANCE ImageBaseAddress<span class="token punctuation">;</span>             <span class="token comment">// 008</span>    <span class="token keyword">struct</span> <span class="token class-name">_PER_LDR_DATA</span> <span class="token operator">*</span>Ldr<span class="token punctuation">;</span>              <span class="token comment">// 00C</span>    strcut _RTL_USER_PPROCESS_PARAMETERS <span class="token operator">*</span>ProcessParameters<span class="token punctuation">;</span> <span class="token comment">// 010</span>    ULONG SubSystemData<span class="token punctuation">;</span>                    <span class="token comment">// 014</span>    HANDLE DefaultHeap<span class="token punctuation">;</span>                     <span class="token comment">// 018</span>    KSPIN_LOCK FastPebLock<span class="token punctuation">;</span>                 <span class="token comment">// 01C</span>    ULONG FastPebLockRoutine<span class="token punctuation">;</span>               <span class="token comment">// 020</span>    ULONG FastPebUnlockRoutine<span class="token punctuation">;</span>             <span class="token comment">// 024</span>    ULONG EnvironmentUpdateCount<span class="token punctuation">;</span>           <span class="token comment">// 028</span>    ULONG KernelCallbackTable<span class="token punctuation">;</span>              <span class="token comment">// 02C</span>    LARGE_INTEGER SystemReserved<span class="token punctuation">;</span>           <span class="token comment">// 030</span>    <span class="token keyword">struct</span> <span class="token class-name">_PER_FREE_BLOCK</span> <span class="token operator">*</span>FreeList<span class="token punctuation">;</span>       <span class="token comment">// 038</span>    ULONG TlsExpansionCounter<span class="token punctuation">;</span>              <span class="token comment">// 03C</span>    ULONG TlsBitmap<span class="token punctuation">;</span>                        <span class="token comment">// 040</span>    LARGE_INTEGER TlsBitmapBits<span class="token punctuation">;</span>            <span class="token comment">// 044</span>    ULONG ReadOnlySharedMemoryBase<span class="token punctuation">;</span>         <span class="token comment">// 04C</span>    ULONG ReadOnlySharedMemoryHeap<span class="token punctuation">;</span>         <span class="token comment">// 050</span>    ULONG ReadOnlyStaticServerData<span class="token punctuation">;</span>         <span class="token comment">// 054</span>    ULONG AnsiCodePageData<span class="token punctuation">;</span>                 <span class="token comment">// 058</span>    ULONG OemCodePageData<span class="token punctuation">;</span>                  <span class="token comment">// 05C</span>    ULONG UnicodeCaseTableData<span class="token punctuation">;</span>             <span class="token comment">// 060</span>    ULONG NumberOfProcessors<span class="token punctuation">;</span>               <span class="token comment">// 064</span>    LARGE_INTEGER NtGlobalFlag<span class="token punctuation">;</span>             <span class="token comment">// 068 Address of a local copy</span>    LARGE_INTEGER CriticalSectionTimeout<span class="token punctuation">;</span>   <span class="token comment">// 070</span>    ULONG HeapSegmentReserve<span class="token punctuation">;</span>               <span class="token comment">// 078</span>    ULONG HeapSegmentCommit<span class="token punctuation">;</span>                <span class="token comment">// 07C</span>    ULONG HeapDeCommitTotalFreeThreshold<span class="token punctuation">;</span>   <span class="token comment">// 080</span>    ULONG HeapDeCommitFreeBlockThreshold<span class="token punctuation">;</span>   <span class="token comment">// 084</span>    ULONG NumberOfHeaps<span class="token punctuation">;</span>                    <span class="token comment">// 088</span>    ULONG MaximumNumberOfHeaps<span class="token punctuation">;</span>             <span class="token comment">// 08C</span>    ULONG ProcessHeaps<span class="token punctuation">;</span>                     <span class="token comment">// 090</span>    ULONG GdiSharedHandleTable<span class="token punctuation">;</span>             <span class="token comment">// 094</span>    ULONG ProcessStarterHelper<span class="token punctuation">;</span>             <span class="token comment">// 098</span>    ULONG GdiDCAttributeList<span class="token punctuation">;</span>               <span class="token comment">// 09C</span>    KSPIN_LOCK LoaderLock<span class="token punctuation">;</span>                  <span class="token comment">// 0A0</span>    ULONG OSMajorVersion<span class="token punctuation">;</span>                   <span class="token comment">// 0A4</span>    ULONG OSMinorVersion<span class="token punctuation">;</span>                   <span class="token comment">// 0A8</span>    USHORT OSBuildNumber<span class="token punctuation">;</span>                   <span class="token comment">// 0AC</span>    USHORT OSCSDVersion<span class="token punctuation">;</span>                    <span class="token comment">// 0AE</span>    ULONG OSPlatformId<span class="token punctuation">;</span>                     <span class="token comment">// 0B0</span>    ULONG ImageSubsystem<span class="token punctuation">;</span>                   <span class="token comment">// 0B4</span>    ULONG ImageSubsystemMajorVersion<span class="token punctuation">;</span>       <span class="token comment">// 0B8</span>    ULONG ImageSubsystemMinorVersion<span class="token punctuation">;</span>       <span class="token comment">// 0BC</span>    ULONG ImageProcessAffinityMask<span class="token punctuation">;</span>         <span class="token comment">// 0C0</span>    ULONG GdiHandleBuffer<span class="token punctuation">[</span><span class="token number">0x22</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// 0C4</span>    ULONG PostProcessInitRoutine<span class="token punctuation">;</span>           <span class="token comment">// 14C</span>    ULONG TlsExpansionBitmap<span class="token punctuation">;</span>               <span class="token comment">// 150</span>    UCHAR TlsExpansionBitmapBits<span class="token punctuation">[</span><span class="token number">0x80</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// 154</span>    ULONG SessionId<span class="token punctuation">;</span>                        <span class="token comment">// 1D4</span><span class="token punctuation">}</span> PEB<span class="token punctuation">,</span> <span class="token operator">*</span>PPEB<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> é€†å‘å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>elfæ–‡ä»¶æŸ¥çœ‹å·¥å…·</title>
      <link href="elf-wen-jian-cha-kan-gong-ju/"/>
      <url>elf-wen-jian-cha-kan-gong-ju/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* * Copyright (c) 2013 Kiba Amor &lt;KibaAmor@gmai.com&gt; * All rights reserved. * * Redistribution and use in source and binary forms, with or without * modification, are permitted provided that the following conditions * are met: * *  * Redistributions of source code must retain the above copyright *    notice, this list ofconditions and the following disclaimer. * *  * Redistributions in binary form must reproduce the above copyright *    notice, this list of conditions and the following disclaimer in *    the documentation and/or other materialsprovided with the *    distribution. * * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE * COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE * POSSIBILITY OF SUCH DAMAGE. */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;elf.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_countof</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">_countof</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">safe_free</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>  <span class="token expression"><span class="token keyword">if</span> <span class="token punctuation">(</span>X <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span>  <span class="token expression"><span class="token punctuation">{</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">free</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span>    <span class="token expression">X <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span>  <span class="token expression"><span class="token punctuation">}</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__x86_64__<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">ARCH </span><span class="token string">"x86_64"</span></span><span class="token keyword">typedef</span> Elf64_Ehdr Elf_Ehdr<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf64_Phdr Elf_Phdr<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf64_Shdr Elf_Shdr<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf64_Sym  Elf_Sym<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_ST_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF64_ST_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_ST_BIND</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF64_ST_BIND</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_ST_VISIBILITY</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF64_ST_VISIBILITY</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token keyword">typedef</span> Elf64_Rel  Elf_Rel<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf64_Rela Elf_Rela<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_R_SYM</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>  <span class="token function">ELF64_R_SYM</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_R_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF64_R_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">ARCH </span><span class="token string">"x86"</span></span><span class="token keyword">typedef</span> Elf32_Ehdr Elf_Ehdr<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf32_Phdr Elf_Phdr<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf32_Shdr Elf_Shdr<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf32_Sym  Elf_Sym<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_ST_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF32_ST_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_ST_BIND</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF32_ST_BIND</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_ST_VISIBILITY</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF32_ST_VISIBILITY</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token keyword">typedef</span> Elf32_Rel  Elf_Rel<span class="token punctuation">;</span><span class="token keyword">typedef</span> Elf32_Rela Elf_Rela<span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_R_SYM</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>  <span class="token function">ELF32_R_SYM</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">ELF_R_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">ELF32_R_TYPE</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// __x86_64__</span></span><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>  <span class="token keyword">int</span>         key<span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> value<span class="token punctuation">;</span><span class="token punctuation">}</span> pair_t<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> g_selfname <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> g_filename <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">int</span>         g_file <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>Elf_Ehdr<span class="token operator">*</span>   g_ehdr <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>Elf_Phdr<span class="token operator">*</span>   g_phdrs <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">int</span>         g_phdr_num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>Elf_Shdr<span class="token operator">*</span>   g_shdrs <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">int</span>         g_shdr_num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">char</span><span class="token operator">*</span>       g_shdr_str_tab <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">clean_up</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_file <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">close</span><span class="token punctuation">(</span>g_file<span class="token punctuation">)</span><span class="token punctuation">;</span>    g_file <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">safe_free</span><span class="token punctuation">(</span>g_ehdr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">safe_free</span><span class="token punctuation">(</span>g_phdrs<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">safe_free</span><span class="token punctuation">(</span>g_shdrs<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">safe_free</span><span class="token punctuation">(</span>g_shdr_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">get_file</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_file <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    g_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>g_filename<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>g_file <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open input file failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> g_file<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">read_at</span><span class="token punctuation">(</span><span class="token keyword">int</span> file<span class="token punctuation">,</span> <span class="token keyword">int</span> pos<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> buf<span class="token punctuation">,</span> <span class="token keyword">int</span> cnt<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">==</span> <span class="token function">lseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> cnt<span class="token punctuation">)</span> <span class="token operator">==</span> cnt <span class="token operator">?</span> cnt <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">is_elf_file</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> ident<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ident      <span class="token operator">||</span> ident<span class="token punctuation">[</span>EI_MAG0<span class="token punctuation">]</span> <span class="token operator">!=</span> ELFMAG0      <span class="token operator">||</span> ident<span class="token punctuation">[</span>EI_MAG1<span class="token punctuation">]</span> <span class="token operator">!=</span> ELFMAG1      <span class="token operator">||</span> ident<span class="token punctuation">[</span>EI_MAG2<span class="token punctuation">]</span> <span class="token operator">!=</span> ELFMAG2      <span class="token operator">||</span> ident<span class="token punctuation">[</span>EI_MAG3<span class="token punctuation">]</span> <span class="token operator">!=</span> ELFMAG3<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> Elf_Ehdr<span class="token operator">*</span> <span class="token function">get_ehdr</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_ehdr <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    g_ehdr <span class="token operator">=</span> <span class="token punctuation">(</span>Elf_Ehdr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Ehdr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read_at</span><span class="token punctuation">(</span><span class="token function">get_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> g_ehdr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Ehdr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read elf header failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_elf_file</span><span class="token punctuation">(</span>g_ehdr<span class="token operator">-&gt;</span>e_ident<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"'%s' is not a elf file\n"</span><span class="token punctuation">,</span> g_filename<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Ehdr<span class="token punctuation">)</span> <span class="token operator">!=</span> g_ehdr<span class="token operator">-&gt;</span>e_ehsize<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"elf header size mismatch\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> g_ehdr<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> Elf_Phdr<span class="token operator">*</span> <span class="token function">get_phdrs</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> Elf_Ehdr<span class="token operator">*</span> ehdr <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_phdrs <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    ehdr <span class="token operator">=</span> <span class="token function">get_ehdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Phdr<span class="token punctuation">)</span> <span class="token operator">!=</span> ehdr<span class="token operator">-&gt;</span>e_phentsize<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"program header size mismatch\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    g_phdr_num <span class="token operator">=</span> ehdr<span class="token operator">-&gt;</span>e_phnum<span class="token punctuation">;</span>    g_phdrs <span class="token operator">=</span> <span class="token punctuation">(</span>Elf_Phdr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Phdr<span class="token punctuation">)</span> <span class="token operator">*</span> g_phdr_num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read_at</span><span class="token punctuation">(</span><span class="token function">get_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_phoff<span class="token punctuation">,</span> g_phdrs<span class="token punctuation">,</span>        <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Phdr<span class="token punctuation">)</span> <span class="token operator">*</span> g_phdr_num<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read program header failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> g_phdrs<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> Elf_Ehdr<span class="token operator">*</span> ehdr <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_shdrs <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    ehdr <span class="token operator">=</span> <span class="token function">get_ehdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Shdr<span class="token punctuation">)</span> <span class="token operator">!=</span> ehdr<span class="token operator">-&gt;</span>e_shentsize<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"section header size mismatch\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    g_shdr_num <span class="token operator">=</span> ehdr<span class="token operator">-&gt;</span>e_shnum<span class="token punctuation">;</span>    g_shdrs <span class="token operator">=</span> <span class="token punctuation">(</span>Elf_Shdr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Shdr<span class="token punctuation">)</span> <span class="token operator">*</span> g_shdr_num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read_at</span><span class="token punctuation">(</span><span class="token function">get_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_shoff<span class="token punctuation">,</span> g_shdrs<span class="token punctuation">,</span>          <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Shdr<span class="token punctuation">)</span> <span class="token operator">*</span> g_shdr_num<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read section header failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> g_shdrs<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span><span class="token keyword">int</span> sect_idx<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> shdrs <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">void</span><span class="token operator">*</span> sect_cont <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>sect_idx <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> sect_idx <span class="token operator">&gt;=</span> g_shdr_num<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  shdrs <span class="token operator">=</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  sect_cont <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>sect_idx<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_size<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read_at</span><span class="token punctuation">(</span><span class="token function">get_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>sect_idx<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_offset<span class="token punctuation">,</span>    sect_cont<span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>sect_idx<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_size<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">safe_free</span><span class="token punctuation">(</span>sect_cont<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> sect_cont<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">get_shdr_str_tab</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_shdr_str_tab <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>    g_shdr_str_tab <span class="token operator">=</span> <span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span><span class="token function">get_ehdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>e_shstrndx<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> g_shdr_str_tab<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">get_sect_idx_by_name</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> sect_name<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> shdrs <span class="token operator">=</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> shdr_str_tab <span class="token operator">=</span> <span class="token function">get_shdr_str_tab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> g_shdr_num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>sect_name<span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_name <span class="token operator">+</span> shdr_str_tab<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> i<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_pair</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">const</span> pair_t<span class="token operator">*</span> pairs<span class="token punctuation">,</span> <span class="token keyword">int</span> cnt<span class="token punctuation">,</span> <span class="token keyword">int</span> linefeed<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>cnt <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> pairs<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> pairs<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>linefeed<span class="token punctuation">)</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_ehdr_ident</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> pair_t classpairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>ELFCLASSNONE<span class="token punctuation">,</span>  <span class="token string">"None"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFCLASS32<span class="token punctuation">,</span>    <span class="token string">"ELF32"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFCLASS64<span class="token punctuation">,</span>    <span class="token string">"ELF64"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> pair_t datapairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>ELFDATANONE<span class="token punctuation">,</span> <span class="token string">"None"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFDATA2LSB<span class="token punctuation">,</span> <span class="token string">"2's complement, little endian"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFDATA2MSB<span class="token punctuation">,</span> <span class="token string">"2's complement, big endian"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> pair_t osabipairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token comment">//{ELFOSABI_NONE,     "UNIX System VB ABI"},</span>    <span class="token punctuation">{</span>ELFOSABI_SYSV<span class="token punctuation">,</span>       <span class="token string">"UNIX System VB ABI"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_HPUX<span class="token punctuation">,</span>       <span class="token string">"HP-UX"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_NETBSD<span class="token punctuation">,</span>     <span class="token string">"NetBSD"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">//{ELFOSABI_GNU,      "Object uses GNU ELF extensions"},</span>    <span class="token punctuation">{</span>ELFOSABI_LINUX<span class="token punctuation">,</span>      <span class="token string">"Object uses GNU ELF extensions"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_SOLARIS<span class="token punctuation">,</span>    <span class="token string">"Sun Solaris"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_AIX<span class="token punctuation">,</span>        <span class="token string">"AIX"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_IRIX<span class="token punctuation">,</span>       <span class="token string">"IBM Irix"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_FREEBSD<span class="token punctuation">,</span>    <span class="token string">"FreeBSD"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_TRU64<span class="token punctuation">,</span>      <span class="token string">"Compaq TRU64 UNIX"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_MODESTO<span class="token punctuation">,</span>    <span class="token string">"Novell Modesto"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_OPENBSD<span class="token punctuation">,</span>    <span class="token string">"OpenBSD"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_ARM_AEABI<span class="token punctuation">,</span>  <span class="token string">"ARM EABI"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_ARM<span class="token punctuation">,</span>        <span class="token string">"ARM"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ELFOSABI_STANDALONE<span class="token punctuation">,</span> <span class="token string">"Standlone (embedded) application"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> Elf_Ehdr<span class="token operator">*</span> ehdr <span class="token operator">=</span> <span class="token function">get_ehdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> ident <span class="token operator">=</span> ehdr<span class="token operator">-&gt;</span>e_ident<span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ELF Header:\n  Magic:  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> EI_NIDENT<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%02X "</span><span class="token punctuation">,</span> ident<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n  Class:                              "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_pair</span><span class="token punctuation">(</span>ident<span class="token punctuation">[</span>EI_CLASS<span class="token punctuation">]</span><span class="token punctuation">,</span> classpairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>classpairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Data:                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_pair</span><span class="token punctuation">(</span>ident<span class="token punctuation">[</span>EI_DATA<span class="token punctuation">]</span><span class="token punctuation">,</span> datapairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>datapairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Version:                            %d%s\n"</span><span class="token punctuation">,</span> ident<span class="token punctuation">[</span>EI_VERSION<span class="token punctuation">]</span><span class="token punctuation">,</span>      ident<span class="token punctuation">[</span>EI_VERSION<span class="token punctuation">]</span> <span class="token operator">==</span> EV_CURRENT <span class="token operator">?</span> <span class="token string">"(current)"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  OS/ABI:                             "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_pair</span><span class="token punctuation">(</span>ident<span class="token punctuation">[</span>EI_OSABI<span class="token punctuation">]</span><span class="token punctuation">,</span> osabipairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>osabipairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_ehdr</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> pair_t objtypepairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>ET_NONE<span class="token punctuation">,</span> <span class="token string">"None"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ET_REL<span class="token punctuation">,</span>  <span class="token string">"Relocatable file"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ET_EXEC<span class="token punctuation">,</span> <span class="token string">"Executable file"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ET_DYN<span class="token punctuation">,</span>  <span class="token string">"Shared object file"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>ET_CORE<span class="token punctuation">,</span> <span class="token string">"Core file"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> pair_t machinepairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>EM_NONE<span class="token punctuation">,</span>       <span class="token string">"None"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_M32<span class="token punctuation">,</span>        <span class="token string">"AT&amp;T WE 32100"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_SPARC<span class="token punctuation">,</span>      <span class="token string">"SUN SPARC"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_386<span class="token punctuation">,</span>        <span class="token string">"Intel 80386"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_68K<span class="token punctuation">,</span>        <span class="token string">"Motorola m68k family"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_88K<span class="token punctuation">,</span>        <span class="token string">"Motorola m88k family"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_860<span class="token punctuation">,</span>        <span class="token string">"Intel 80860"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_MIPS<span class="token punctuation">,</span>       <span class="token string">"MIPS R3000 big-endian"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_S370<span class="token punctuation">,</span>       <span class="token string">"IBM System/370"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_MIPS_RS3_LE<span class="token punctuation">,</span><span class="token string">"MIPS R3000 little-endian"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_PARISC<span class="token punctuation">,</span>     <span class="token string">"HPPA"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_VPP500<span class="token punctuation">,</span>     <span class="token string">"Fujitsu VPP500"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_SPARC32PLUS<span class="token punctuation">,</span><span class="token string">"Sun's \"v8plus\""</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_960<span class="token punctuation">,</span>        <span class="token string">"Intel 80960"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_PPC<span class="token punctuation">,</span>        <span class="token string">"PowerPC"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_PPC64<span class="token punctuation">,</span>      <span class="token string">"PowerPC 64-bit"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_S390<span class="token punctuation">,</span>       <span class="token string">"IBM S390"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_V800<span class="token punctuation">,</span>       <span class="token string">"NEC V800 series"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_FR20<span class="token punctuation">,</span>       <span class="token string">"Fujitsu FR20"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_RH32<span class="token punctuation">,</span>       <span class="token string">"TRW RH-32"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_RCE<span class="token punctuation">,</span>        <span class="token string">"Motorola RCE"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ARM<span class="token punctuation">,</span>        <span class="token string">"ARM"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_FAKE_ALPHA<span class="token punctuation">,</span> <span class="token string">"Digital Alpha"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_SH<span class="token punctuation">,</span>         <span class="token string">"Hitachi SH"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_SPARCV9<span class="token punctuation">,</span>    <span class="token string">"SPARC v9 64-bit"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_TRICORE<span class="token punctuation">,</span>    <span class="token string">"Siemens Tricore"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ARC<span class="token punctuation">,</span>        <span class="token string">"Argonaut RISC Core"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_H8_300<span class="token punctuation">,</span>     <span class="token string">"Hitachi H8/300"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_H8_300H<span class="token punctuation">,</span>    <span class="token string">"Hitachi H8/300H"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_H8S<span class="token punctuation">,</span>        <span class="token string">"Hitachi H8S"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_H8_500<span class="token punctuation">,</span>     <span class="token string">"Hitachi H8/500"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_IA_64<span class="token punctuation">,</span>      <span class="token string">"Intel Merced"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_MIPS_X<span class="token punctuation">,</span>     <span class="token string">"Stanford MIPS-X"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_COLDFIRE<span class="token punctuation">,</span>   <span class="token string">"Motorola Coldfire"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_68HC12<span class="token punctuation">,</span>     <span class="token string">"Motorola M68HC12"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_MMA<span class="token punctuation">,</span>        <span class="token string">"Fujitsu MMA Multimedia Accelerator"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_PCP<span class="token punctuation">,</span>        <span class="token string">"Siemens PCP"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_NCPU<span class="token punctuation">,</span>       <span class="token string">"Sony nCPU embeeded RISC"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_NDR1<span class="token punctuation">,</span>       <span class="token string">"Denso NDR1 microprocessor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_STARCORE<span class="token punctuation">,</span>   <span class="token string">"Motorola Start*Core processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ME16<span class="token punctuation">,</span>       <span class="token string">"Toyota ME16 processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ST100<span class="token punctuation">,</span>      <span class="token string">"STMicroelectronic ST100 processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_TINYJ<span class="token punctuation">,</span>      <span class="token string">"Advanced Logic Corp. Tinyj emb.fam"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_X86_64<span class="token punctuation">,</span>     <span class="token string">"AMD x86-64 architecture"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_PDSP<span class="token punctuation">,</span>       <span class="token string">"Sony DSP Processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_FX66<span class="token punctuation">,</span>       <span class="token string">"Siemens FX66 microcontroller"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ST9PLUS<span class="token punctuation">,</span>    <span class="token string">"STMicroelectronics ST9+ 8/16 mc"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ST7<span class="token punctuation">,</span>        <span class="token string">"STmicroelectronics ST7 8 bit mc"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_68HC16<span class="token punctuation">,</span>     <span class="token string">"Motorola MC68HC16 microcontroller"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_68HC11<span class="token punctuation">,</span>     <span class="token string">"Motorola MC68HC11 microcontroller"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_68HC08<span class="token punctuation">,</span>     <span class="token string">"Motorola MC68HC08 microcontroller"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_68HC05<span class="token punctuation">,</span>     <span class="token string">"Motorola MC68HC05 microcontroller"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_SVX<span class="token punctuation">,</span>        <span class="token string">"Silicon Graphics SVx"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ST19<span class="token punctuation">,</span>       <span class="token string">"STMicroelectronics ST19 8 bit mc"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_VAX<span class="token punctuation">,</span>        <span class="token string">"Digital VAX"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_CRIS<span class="token punctuation">,</span>       <span class="token string">"Axis Communications 32-bit embedded processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_JAVELIN<span class="token punctuation">,</span>    <span class="token string">"Infineon Technologies 32-bit embedded processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_FIREPATH<span class="token punctuation">,</span>   <span class="token string">"Element 14 64-bit DSP Processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ZSP<span class="token punctuation">,</span>        <span class="token string">"LSI Logic 16-bit DSP Processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_MMIX<span class="token punctuation">,</span>       <span class="token string">"Donald Knuth's educational 64-bit processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_HUANY<span class="token punctuation">,</span>      <span class="token string">"Harvard University machine-independent object files"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_PRISM<span class="token punctuation">,</span>      <span class="token string">"SiTera Prism"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_AVR<span class="token punctuation">,</span>        <span class="token string">"Atmel AVR 8-bit microcontroller"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_FR30<span class="token punctuation">,</span>       <span class="token string">"Fujitsu FR30"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_D10V<span class="token punctuation">,</span>       <span class="token string">"Mitsubishi D10V"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_D30V<span class="token punctuation">,</span>       <span class="token string">"Mitsubishi D30V"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_V850<span class="token punctuation">,</span>       <span class="token string">"NEC v850"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_M32R<span class="token punctuation">,</span>       <span class="token string">"Mitsubishi M32R"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_MN10300<span class="token punctuation">,</span>    <span class="token string">"Matsushita MN10300"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_MN10200<span class="token punctuation">,</span>    <span class="token string">"Matsushita MN10200"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_PJ<span class="token punctuation">,</span>         <span class="token string">"picoJava"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_OPENRISC<span class="token punctuation">,</span>   <span class="token string">"OpenRISC 32-bit embedded processor"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_ARC_A5<span class="token punctuation">,</span>     <span class="token string">"ARC Cores Tangent-A5"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EM_XTENSA<span class="token punctuation">,</span>     <span class="token string">"Tensilica Xtensa Architecture"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> pair_t versionpairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>EV_NONE<span class="token punctuation">,</span>     <span class="token string">"None"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>EV_CURRENT<span class="token punctuation">,</span>  <span class="token string">"Current version"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> Elf_Ehdr<span class="token operator">*</span> ehdr <span class="token operator">=</span> <span class="token function">get_ehdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_ehdr_ident</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Object file type:                   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_pair</span><span class="token punctuation">(</span>ehdr<span class="token operator">-&gt;</span>e_type<span class="token punctuation">,</span> objtypepairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>objtypepairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Machine:                            "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_pair</span><span class="token punctuation">(</span>ehdr<span class="token operator">-&gt;</span>e_machine<span class="token punctuation">,</span> machinepairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>machinepairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Version:                            "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">print_pair</span><span class="token punctuation">(</span>ehdr<span class="token operator">-&gt;</span>e_version<span class="token punctuation">,</span> versionpairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>versionpairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Entry point address:                0x%08x\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_entry<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Start of program headers:           0x%08x (bytes into file)\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_phoff<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Start of section headers:           0x%08x (bytes into file)\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_shoff<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Flags:                              0x%08x\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_flags<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Size of this header:                %d (bytes)\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_ehsize<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Size of program headers:            %d (bytes)\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_phentsize<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Number of program headers:          %d\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_phnum<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Size of section headers:            %d (bytes)\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_shentsize<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Number of section headers:          %d\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_shnum<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Section header string table index:  %d\n\n"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-&gt;</span>e_shstrndx<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_phdrs</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> pair_t typepairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>PT_NULL<span class="token punctuation">,</span>         <span class="token string">"NULL        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_LOAD<span class="token punctuation">,</span>         <span class="token string">"LOAD        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_DYNAMIC<span class="token punctuation">,</span>      <span class="token string">"DYNAMIC     "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_INTERP<span class="token punctuation">,</span>       <span class="token string">"INTERP      "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_NOTE<span class="token punctuation">,</span>         <span class="token string">"NOTE        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_SHLIB<span class="token punctuation">,</span>        <span class="token string">"SHLIB       "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_PHDR<span class="token punctuation">,</span>         <span class="token string">"PHDR        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_TLS<span class="token punctuation">,</span>          <span class="token string">"TLS         "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_GNU_EH_FRAME<span class="token punctuation">,</span> <span class="token string">"GNU_EH_FRAME"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_GNU_STACK<span class="token punctuation">,</span>    <span class="token string">"GUN_STACK   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>PT_GNU_RELRO<span class="token punctuation">,</span>    <span class="token string">"GNU_RELRO   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> Elf_Phdr<span class="token operator">*</span> phdrs <span class="token operator">=</span> <span class="token function">get_phdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i<span class="token punctuation">;</span>  <span class="token keyword">char</span> tmp_buf<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Program Headers:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Type         Offset     VirtAddr   PhysAddr   FileSize   MemSize    Flag Align\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> g_phdr_num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_pair</span><span class="token punctuation">(</span>phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_type<span class="token punctuation">,</span> typepairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>typepairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_offset<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_vaddr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_paddr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_filesz<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_memsz<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">snprintf</span><span class="token punctuation">(</span>tmp_buf<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">"%s%s%s"</span><span class="token punctuation">,</span>        phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_flags <span class="token operator">&amp;</span> PF_X <span class="token operator">?</span> <span class="token string">"X"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_flags <span class="token operator">&amp;</span> PF_W <span class="token operator">?</span> <span class="token string">"W"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_flags <span class="token operator">&amp;</span> PF_R <span class="token operator">?</span> <span class="token string">"R"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" %-4s"</span><span class="token punctuation">,</span> tmp_buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%04x\n"</span><span class="token punctuation">,</span> phdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p_align<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_shdrs</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> pair_t typepairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>SHT_NULL<span class="token punctuation">,</span>            <span class="token string">"NULL          "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_PROGBITS<span class="token punctuation">,</span>        <span class="token string">"PROGBITS      "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_SYMTAB<span class="token punctuation">,</span>          <span class="token string">"SYMTAB        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_STRTAB<span class="token punctuation">,</span>          <span class="token string">"STRTAB        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_RELA<span class="token punctuation">,</span>            <span class="token string">"RELA          "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_HASH<span class="token punctuation">,</span>            <span class="token string">"HASH          "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_DYNAMIC<span class="token punctuation">,</span>         <span class="token string">"DYNAMIC       "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_NOTE<span class="token punctuation">,</span>            <span class="token string">"NOTE          "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_NOBITS<span class="token punctuation">,</span>          <span class="token string">"NOBITS        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_REL<span class="token punctuation">,</span>             <span class="token string">"REL           "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_SHLIB<span class="token punctuation">,</span>           <span class="token string">"SHLIB         "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_DYNSYM<span class="token punctuation">,</span>          <span class="token string">"DYNSYM        "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_INIT_ARRAY<span class="token punctuation">,</span>      <span class="token string">"INIT_ARRAY    "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_FINI_ARRAY<span class="token punctuation">,</span>      <span class="token string">"FINI_ARRAY    "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_PREINIT_ARRAY<span class="token punctuation">,</span>   <span class="token string">"PREINIT_ARRAY "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_GROUP<span class="token punctuation">,</span>           <span class="token string">"GROUP         "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_SYMTAB_SHNDX<span class="token punctuation">,</span>    <span class="token string">"SYMTAB_SHNDX  "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_GNU_ATTRIBUTES<span class="token punctuation">,</span>  <span class="token string">"GNU_ATTRIBUTES"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_GNU_HASH<span class="token punctuation">,</span>        <span class="token string">"GNU_HASH      "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_GNU_LIBLIST<span class="token punctuation">,</span>     <span class="token string">"GNU_LIBLIST   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_GNU_verdef<span class="token punctuation">,</span>      <span class="token string">"GNU_verdef    "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_GNU_verneed<span class="token punctuation">,</span>     <span class="token string">"GNU_verneed   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>SHT_GNU_versym<span class="token punctuation">,</span>      <span class="token string">"GNU_versym    "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> shdrs <span class="token operator">=</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> shdr_str_tab <span class="token operator">=</span> <span class="token function">get_shdr_str_tab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i<span class="token punctuation">;</span>  <span class="token keyword">char</span> tmp_buf<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Section Headers:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Idx Name               Type           Flags VirtAddr   Offset     Size       Link Info Align  EntrySize\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> g_shdr_num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" %- 3d "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" %-18s "</span><span class="token punctuation">,</span> shdr_str_tab <span class="token operator">+</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_pair</span><span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_type<span class="token punctuation">,</span> typepairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>typepairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">snprintf</span><span class="token punctuation">(</span>tmp_buf<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">" %s%s%s%s%s%s%s%s%s%s"</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_WRITE             <span class="token operator">?</span> <span class="token string">"W"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_ALLOC             <span class="token operator">?</span> <span class="token string">"A"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_EXECINSTR         <span class="token operator">?</span> <span class="token string">"E"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_MERGE             <span class="token operator">?</span> <span class="token string">"M"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_STRINGS           <span class="token operator">?</span> <span class="token string">"S"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_INFO_LINK         <span class="token operator">?</span> <span class="token string">"I"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_LINK_ORDER        <span class="token operator">?</span> <span class="token string">"L"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_OS_NONCONFORMING  <span class="token operator">?</span> <span class="token string">"O"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_GROUP             <span class="token operator">?</span> <span class="token string">"G"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SHF_TLS               <span class="token operator">?</span> <span class="token string">"T"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-5s "</span><span class="token punctuation">,</span> tmp_buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_offset<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%- 4d "</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_link<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%- 4d "</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%04x"</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_addralign<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x\n"</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_entsize<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Key to Flags:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  W (Writable), A (Alloc), E(Executable), M (Merge), S (Strings),\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  I (Info), L (Link Order), O (Os Nonconforming), G (Group), T (TLS)\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_symbol_info_by_sect_idx</span><span class="token punctuation">(</span><span class="token keyword">int</span> sect_idx<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> pair_t typepairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>STT_NOTYPE<span class="token punctuation">,</span>    <span class="token string">"NOTYPE   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STT_OBJECT<span class="token punctuation">,</span>    <span class="token string">"OBJECT   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STT_FUNC<span class="token punctuation">,</span>      <span class="token string">"FUNC     "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STT_SECTION<span class="token punctuation">,</span>   <span class="token string">"SECTION  "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STT_FILE<span class="token punctuation">,</span>      <span class="token string">"FILE     "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STT_COMMON<span class="token punctuation">,</span>    <span class="token string">"COMMON   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STT_TLS<span class="token punctuation">,</span>       <span class="token string">"TLS      "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STT_GNU_IFUNC<span class="token punctuation">,</span> <span class="token string">"GUN_IFUNC"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> pair_t bindpairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>STB_LOCAL<span class="token punctuation">,</span>       <span class="token string">"LOCAL     "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STB_GLOBAL<span class="token punctuation">,</span>      <span class="token string">"GLOBAL    "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STB_WEAK<span class="token punctuation">,</span>        <span class="token string">"WEAK      "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STB_GNU_UNIQUE<span class="token punctuation">,</span>  <span class="token string">"GUN_UNIQUE"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> pair_t visiblepairs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>    <span class="token punctuation">{</span>STV_DEFAULT<span class="token punctuation">,</span>   <span class="token string">"DEFAULT   "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STV_INTERNAL<span class="token punctuation">,</span>  <span class="token string">"INTERNAL  "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STV_HIDDEN<span class="token punctuation">,</span>    <span class="token string">"HIDDEN    "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>STV_PROTECTED<span class="token punctuation">,</span> <span class="token string">"PROTECTED "</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> shdrs <span class="token operator">=</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> shdr_str_tab <span class="token operator">=</span> <span class="token function">get_shdr_str_tab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Elf_Sym<span class="token operator">*</span> symbol <span class="token operator">=</span> <span class="token punctuation">(</span>Elf_Sym <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span>sect_idx<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> symbol_num <span class="token operator">=</span> shdrs<span class="token punctuation">[</span>sect_idx<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_size <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Sym<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">char</span><span class="token operator">*</span> symbol_str_tab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>sect_idx<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_link<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token constant">NULL</span>    <span class="token operator">||</span> symbol_str_tab <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">safe_free</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">safe_free</span><span class="token punctuation">(</span>symbol_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Symbol Info For '%s':\n"</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>sect_idx<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_name <span class="token operator">+</span> shdr_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Idx Value      Size   Type      Bind       Visibility Shndx  Name\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> symbol_num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  %3d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%04x "</span><span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_pair</span><span class="token punctuation">(</span><span class="token function">ELF_ST_TYPE</span><span class="token punctuation">(</span>symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_info<span class="token punctuation">)</span><span class="token punctuation">,</span> typepairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>typepairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_pair</span><span class="token punctuation">(</span><span class="token function">ELF_ST_BIND</span><span class="token punctuation">(</span>symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_info<span class="token punctuation">)</span><span class="token punctuation">,</span> bindpairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>bindpairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_pair</span><span class="token punctuation">(</span><span class="token function">ELF_ST_VISIBILITY</span><span class="token punctuation">(</span>symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_other<span class="token punctuation">)</span><span class="token punctuation">,</span> visiblepairs<span class="token punctuation">,</span> <span class="token function">_countof</span><span class="token punctuation">(</span>visiblepairs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_shndx<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token keyword">case</span> SHN_UNDEF<span class="token operator">:</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"UNDEF "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token keyword">case</span> SHN_ABS<span class="token operator">:</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ABS   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token keyword">case</span> SHN_COMMON<span class="token operator">:</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"COMMON"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-6d"</span><span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_shndx<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" %s\n"</span><span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>st_name <span class="token operator">+</span> symbol_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">safe_free</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">safe_free</span><span class="token punctuation">(</span>symbol_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_symbol_info</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> shdrs <span class="token operator">=</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Symbol Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> g_shdr_num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_type <span class="token operator">==</span> SHT_SYMTAB      <span class="token operator">||</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_type <span class="token operator">==</span> SHT_DYNSYM<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">print_symbol_info_by_sect_idx</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_relocation_info</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> shdrs <span class="token operator">=</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> shdr_str_tab <span class="token operator">=</span> <span class="token function">get_shdr_str_tab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Elf_Rel<span class="token operator">*</span> rel <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> rel_num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  Elf_Sym<span class="token operator">*</span> sym <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">char</span><span class="token operator">*</span> sym_str_tab <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Relocation Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> g_shdr_num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_type <span class="token operator">==</span> SHT_REL<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Relocation Info Without Addends For '%s':\n"</span><span class="token punctuation">,</span>          shdrs<span class="token punctuation">[</span>shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_info<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_name <span class="token operator">+</span> shdr_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>      rel_num <span class="token operator">=</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_size <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Elf_Rel<span class="token punctuation">)</span><span class="token punctuation">;</span>      rel <span class="token operator">=</span> <span class="token punctuation">(</span>Elf_Rel <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>      sym <span class="token operator">=</span> <span class="token punctuation">(</span>Elf_Sym <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_link<span class="token punctuation">)</span><span class="token punctuation">;</span>      sym_str_tab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_link<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_link<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  OFFSET     TYPE       VALUE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rel_num<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span>      <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  0x%08x"</span><span class="token punctuation">,</span> rel<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>r_offset<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 0x%08x"</span><span class="token punctuation">,</span> <span class="token function">ELF_R_TYPE</span><span class="token punctuation">(</span>rel<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>r_info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" %s\n"</span><span class="token punctuation">,</span> sym<span class="token punctuation">[</span><span class="token function">ELF_R_SYM</span><span class="token punctuation">(</span>rel<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>r_info<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>st_name <span class="token operator">+</span> sym_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">safe_free</span><span class="token punctuation">(</span>rel<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">safe_free</span><span class="token punctuation">(</span>sym<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">safe_free</span><span class="token punctuation">(</span>sym_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_all_str_tab</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">const</span> Elf_Shdr<span class="token operator">*</span> shdrs <span class="token operator">=</span> <span class="token function">get_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> shdr_str_tab <span class="token operator">=</span> <span class="token function">get_shdr_str_tab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">char</span><span class="token operator">*</span> str_tab <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> str_tab_pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"All String Table:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> g_shdr_num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_type <span class="token operator">==</span> SHT_STRTAB<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"String Table '%s':\n"</span><span class="token punctuation">,</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_name <span class="token operator">+</span> shdr_str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  Idx Value\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      str_tab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">get_sect_cont_by_idx</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> str_tab_pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> str_tab_pos <span class="token operator">&lt;</span> shdrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sh_size<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span>      <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"  %3d %s\n"</span><span class="token punctuation">,</span> j<span class="token punctuation">,</span> str_tab <span class="token operator">+</span> str_tab_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>        str_tab_pos <span class="token operator">+=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str_tab <span class="token operator">+</span> str_tab_pos<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">safe_free</span><span class="token punctuation">(</span>str_tab<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_usage</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Usage: %s file\n"</span><span class="token punctuation">,</span> g_selfname<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -a  same as -h -p -s -S -r -d\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -h  dump ELF file header\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -p  dump ELF file program header\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -s  dump ELF file section header\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -S  dump Symbol Info\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -r  dump relocation info\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -d  dump all string table\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">" -v  print version info and exit\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">print_version</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Elf(Executable Linkable Format) file dump tool("</span>ARCH<span class="token string">")\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Copyright (c) 2013 Kiba Amor &lt;KibaAmor@gmai.com&gt;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"All rights reserved.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Version 1.0\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> show_ehdr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> show_phdrs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> show_shdrs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> show_symbol_info <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> show_relocation_info <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> show_all_str_tab <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  g_selfname <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> argc<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'-'</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>g_filename <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"multi input file detected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> EXIT_FAILURE<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">else</span>      <span class="token punctuation">{</span>        g_filename <span class="token operator">=</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">continue</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">;</span> <span class="token operator">--</span>j<span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token keyword">switch</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'a'</span><span class="token operator">:</span>          show_ehdr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          show_phdrs <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          show_shdrs <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          show_symbol_info <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          show_relocation_info <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          show_all_str_tab <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'h'</span><span class="token operator">:</span>          show_ehdr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'p'</span><span class="token operator">:</span>          show_phdrs <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'s'</span><span class="token operator">:</span>          show_shdrs <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'S'</span><span class="token operator">:</span>          show_symbol_info <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'r'</span><span class="token operator">:</span>          show_relocation_info <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'d'</span><span class="token operator">:</span>          show_all_str_tab <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'v'</span><span class="token operator">:</span>          <span class="token function">print_version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> EXIT_FAILURE<span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token operator">:</span>          <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"unkown option: '%c'\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> EXIT_FAILURE<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>g_filename <span class="token operator">==</span> <span class="token constant">NULL</span>      <span class="token operator">||</span> <span class="token punctuation">(</span>show_ehdr <span class="token operator">==</span> <span class="token number">0</span>      <span class="token operator">&amp;&amp;</span> show_phdrs <span class="token operator">==</span> <span class="token number">0</span>      <span class="token operator">&amp;&amp;</span> show_shdrs <span class="token operator">==</span> <span class="token number">0</span>      <span class="token operator">&amp;&amp;</span> show_symbol_info <span class="token operator">==</span> <span class="token number">0</span>      <span class="token operator">&amp;&amp;</span> show_relocation_info <span class="token operator">==</span> <span class="token number">0</span>      <span class="token operator">&amp;&amp;</span> show_all_str_tab <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">print_usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> EXIT_FAILURE<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">atexit</span><span class="token punctuation">(</span>clean_up<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>show_ehdr<span class="token punctuation">)</span>    <span class="token function">print_ehdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>show_phdrs<span class="token punctuation">)</span>    <span class="token function">print_phdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>show_shdrs<span class="token punctuation">)</span>    <span class="token function">print_shdrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>show_symbol_info<span class="token punctuation">)</span>    <span class="token function">print_symbol_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>show_relocation_info<span class="token punctuation">)</span>    <span class="token function">print_relocation_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>show_all_str_tab<span class="token punctuation">)</span>    <span class="token function">print_all_str_tab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> é€†å‘å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨socatæ¥æµ‹è¯•echoæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</title>
      <link href="li-yong-socat-lai-ce-shi-echo-fu-wu-qi-he-ke-hu-duan/"/>
      <url>li-yong-socat-lai-ce-shi-echo-fu-wu-qi-he-ke-hu-duan/</url>
      
        <content type="html"><![CDATA[<h2 id="ç”¨socatå¼€å¯echoæœåŠ¡å™¨"><a href="#ç”¨socatå¼€å¯echoæœåŠ¡å™¨" class="headerlink" title="ç”¨socatå¼€å¯echoæœåŠ¡å™¨"></a>ç”¨socatå¼€å¯echoæœåŠ¡å™¨</h2><p>åœ¨æœ¬åœ°9999ç«¯å£å¼€å¯ä¸€ä¸ªechoæœåŠ¡å™¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">socat tcp-listen:8888 <span class="token builtin class-name">echo</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ç”¨socatæµ‹è¯•echoæœåŠ¡å™¨"><a href="#ç”¨socatæµ‹è¯•echoæœåŠ¡å™¨" class="headerlink" title="ç”¨socatæµ‹è¯•echoæœåŠ¡å™¨"></a>ç”¨socatæµ‹è¯•echoæœåŠ¡å™¨</h2><p>æŠŠæ–‡ä»¶in.datä¸­å†…å®¹å‘é€åˆ°æœ¬åœ°çš„8888ç«¯å£ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜æ”¾åœ¨outä¸­ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">socat tcp:127.0.0.1:8888 open:in.dat,rdonly<span class="token operator">!</span><span class="token operator">!</span>open:out.dat,create,wronly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å¯ç”¨äºå¯¹echoæœåŠ¡å™¨è¿›è¡Œæ•°æ®å‹åŠ›æµ‹è¯•ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…·ä½¿ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
